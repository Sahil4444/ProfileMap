function yI(m,b){for(var E=0;E<b.length;E++){const C=b[E];if(typeof C!="string"&&!Array.isArray(C)){for(const L in C)if(L!=="default"&&!(L in m)){const N=Object.getOwnPropertyDescriptor(C,L);N&&Object.defineProperty(m,L,N.get?N:{enumerable:!0,get:()=>C[L]})}}}return Object.freeze(Object.defineProperty(m,Symbol.toStringTag,{value:"Module"}))}(function(){const b=document.createElement("link").relList;if(b&&b.supports&&b.supports("modulepreload"))return;for(const L of document.querySelectorAll('link[rel="modulepreload"]'))C(L);new MutationObserver(L=>{for(const N of L)if(N.type==="childList")for(const G of N.addedNodes)G.tagName==="LINK"&&G.rel==="modulepreload"&&C(G)}).observe(document,{childList:!0,subtree:!0});function E(L){const N={};return L.integrity&&(N.integrity=L.integrity),L.referrerPolicy&&(N.referrerPolicy=L.referrerPolicy),L.crossOrigin==="use-credentials"?N.credentials="include":L.crossOrigin==="anonymous"?N.credentials="omit":N.credentials="same-origin",N}function C(L){if(L.ep)return;L.ep=!0;const N=E(L);fetch(L.href,N)}})();function Wb(m){return m&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m}var eb={exports:{}},ly={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JT;function vI(){if(JT)return ly;JT=1;var m=Symbol.for("react.transitional.element"),b=Symbol.for("react.fragment");function E(C,L,N){var G=null;if(N!==void 0&&(G=""+N),L.key!==void 0&&(G=""+L.key),"key"in L){N={};for(var r in L)r!=="key"&&(N[r]=L[r])}else N=L;return L=N.ref,{$$typeof:m,type:C,key:G,ref:L!==void 0?L:null,props:N}}return ly.Fragment=b,ly.jsx=E,ly.jsxs=E,ly}var e2;function xI(){return e2||(e2=1,eb.exports=vI()),eb.exports}var H=xI(),tb={exports:{}},or={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t2;function bI(){if(t2)return or;t2=1;var m=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),L=Symbol.for("react.profiler"),N=Symbol.for("react.consumer"),G=Symbol.for("react.context"),r=Symbol.for("react.forward_ref"),Z=Symbol.for("react.suspense"),$=Symbol.for("react.memo"),ie=Symbol.for("react.lazy"),oe=Symbol.iterator;function fe(Fe){return Fe===null||typeof Fe!="object"?null:(Fe=oe&&Fe[oe]||Fe["@@iterator"],typeof Fe=="function"?Fe:null)}var Re={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ie=Object.assign,be={};function ke(Fe,zt,_i){this.props=Fe,this.context=zt,this.refs=be,this.updater=_i||Re}ke.prototype.isReactComponent={},ke.prototype.setState=function(Fe,zt){if(typeof Fe!="object"&&typeof Fe!="function"&&Fe!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Fe,zt,"setState")},ke.prototype.forceUpdate=function(Fe){this.updater.enqueueForceUpdate(this,Fe,"forceUpdate")};function Oe(){}Oe.prototype=ke.prototype;function Be(Fe,zt,_i){this.props=Fe,this.context=zt,this.refs=be,this.updater=_i||Re}var je=Be.prototype=new Oe;je.constructor=Be,Ie(je,ke.prototype),je.isPureReactComponent=!0;var at=Array.isArray,ut={H:null,A:null,T:null,S:null,V:null},Xe=Object.prototype.hasOwnProperty;function Tt(Fe,zt,_i,Jt,bi,Ci){return _i=Ci.ref,{$$typeof:m,type:Fe,key:zt,ref:_i!==void 0?_i:null,props:Ci}}function vt(Fe,zt){return Tt(Fe.type,zt,void 0,void 0,void 0,Fe.props)}function ni(Fe){return typeof Fe=="object"&&Fe!==null&&Fe.$$typeof===m}function Pi(Fe){var zt={"=":"=0",":":"=2"};return"$"+Fe.replace(/[=:]/g,function(_i){return zt[_i]})}var xi=/\/+/g;function Fi(Fe,zt){return typeof Fe=="object"&&Fe!==null&&Fe.key!=null?Pi(""+Fe.key):zt.toString(36)}function Ei(){}function fi(Fe){switch(Fe.status){case"fulfilled":return Fe.value;case"rejected":throw Fe.reason;default:switch(typeof Fe.status=="string"?Fe.then(Ei,Ei):(Fe.status="pending",Fe.then(function(zt){Fe.status==="pending"&&(Fe.status="fulfilled",Fe.value=zt)},function(zt){Fe.status==="pending"&&(Fe.status="rejected",Fe.reason=zt)})),Fe.status){case"fulfilled":return Fe.value;case"rejected":throw Fe.reason}}throw Fe}function yi(Fe,zt,_i,Jt,bi){var Ci=typeof Fe;(Ci==="undefined"||Ci==="boolean")&&(Fe=null);var pi=!1;if(Fe===null)pi=!0;else switch(Ci){case"bigint":case"string":case"number":pi=!0;break;case"object":switch(Fe.$$typeof){case m:case b:pi=!0;break;case ie:return pi=Fe._init,yi(pi(Fe._payload),zt,_i,Jt,bi)}}if(pi)return bi=bi(Fe),pi=Jt===""?"."+Fi(Fe,0):Jt,at(bi)?(_i="",pi!=null&&(_i=pi.replace(xi,"$&/")+"/"),yi(bi,zt,_i,"",function(Vi){return Vi})):bi!=null&&(ni(bi)&&(bi=vt(bi,_i+(bi.key==null||Fe&&Fe.key===bi.key?"":(""+bi.key).replace(xi,"$&/")+"/")+pi)),zt.push(bi)),1;pi=0;var ri=Jt===""?".":Jt+":";if(at(Fe))for(var Yi=0;Yi<Fe.length;Yi++)Jt=Fe[Yi],Ci=ri+Fi(Jt,Yi),pi+=yi(Jt,zt,_i,Ci,bi);else if(Yi=fe(Fe),typeof Yi=="function")for(Fe=Yi.call(Fe),Yi=0;!(Jt=Fe.next()).done;)Jt=Jt.value,Ci=ri+Fi(Jt,Yi++),pi+=yi(Jt,zt,_i,Ci,bi);else if(Ci==="object"){if(typeof Fe.then=="function")return yi(fi(Fe),zt,_i,Jt,bi);throw zt=String(Fe),Error("Objects are not valid as a React child (found: "+(zt==="[object Object]"?"object with keys {"+Object.keys(Fe).join(", ")+"}":zt)+"). If you meant to render a collection of children, use an array instead.")}return pi}function Je(Fe,zt,_i){if(Fe==null)return Fe;var Jt=[],bi=0;return yi(Fe,Jt,"","",function(Ci){return zt.call(_i,Ci,bi++)}),Jt}function jt(Fe){if(Fe._status===-1){var zt=Fe._result;zt=zt(),zt.then(function(_i){(Fe._status===0||Fe._status===-1)&&(Fe._status=1,Fe._result=_i)},function(_i){(Fe._status===0||Fe._status===-1)&&(Fe._status=2,Fe._result=_i)}),Fe._status===-1&&(Fe._status=0,Fe._result=zt)}if(Fe._status===1)return Fe._result.default;throw Fe._result}var _t=typeof reportError=="function"?reportError:function(Fe){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var zt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Fe=="object"&&Fe!==null&&typeof Fe.message=="string"?String(Fe.message):String(Fe),error:Fe});if(!window.dispatchEvent(zt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Fe);return}console.error(Fe)};function $t(){}return or.Children={map:Je,forEach:function(Fe,zt,_i){Je(Fe,function(){zt.apply(this,arguments)},_i)},count:function(Fe){var zt=0;return Je(Fe,function(){zt++}),zt},toArray:function(Fe){return Je(Fe,function(zt){return zt})||[]},only:function(Fe){if(!ni(Fe))throw Error("React.Children.only expected to receive a single React element child.");return Fe}},or.Component=ke,or.Fragment=E,or.Profiler=L,or.PureComponent=Be,or.StrictMode=C,or.Suspense=Z,or.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ut,or.__COMPILER_RUNTIME={__proto__:null,c:function(Fe){return ut.H.useMemoCache(Fe)}},or.cache=function(Fe){return function(){return Fe.apply(null,arguments)}},or.cloneElement=function(Fe,zt,_i){if(Fe==null)throw Error("The argument must be a React element, but you passed "+Fe+".");var Jt=Ie({},Fe.props),bi=Fe.key,Ci=void 0;if(zt!=null)for(pi in zt.ref!==void 0&&(Ci=void 0),zt.key!==void 0&&(bi=""+zt.key),zt)!Xe.call(zt,pi)||pi==="key"||pi==="__self"||pi==="__source"||pi==="ref"&&zt.ref===void 0||(Jt[pi]=zt[pi]);var pi=arguments.length-2;if(pi===1)Jt.children=_i;else if(1<pi){for(var ri=Array(pi),Yi=0;Yi<pi;Yi++)ri[Yi]=arguments[Yi+2];Jt.children=ri}return Tt(Fe.type,bi,void 0,void 0,Ci,Jt)},or.createContext=function(Fe){return Fe={$$typeof:G,_currentValue:Fe,_currentValue2:Fe,_threadCount:0,Provider:null,Consumer:null},Fe.Provider=Fe,Fe.Consumer={$$typeof:N,_context:Fe},Fe},or.createElement=function(Fe,zt,_i){var Jt,bi={},Ci=null;if(zt!=null)for(Jt in zt.key!==void 0&&(Ci=""+zt.key),zt)Xe.call(zt,Jt)&&Jt!=="key"&&Jt!=="__self"&&Jt!=="__source"&&(bi[Jt]=zt[Jt]);var pi=arguments.length-2;if(pi===1)bi.children=_i;else if(1<pi){for(var ri=Array(pi),Yi=0;Yi<pi;Yi++)ri[Yi]=arguments[Yi+2];bi.children=ri}if(Fe&&Fe.defaultProps)for(Jt in pi=Fe.defaultProps,pi)bi[Jt]===void 0&&(bi[Jt]=pi[Jt]);return Tt(Fe,Ci,void 0,void 0,null,bi)},or.createRef=function(){return{current:null}},or.forwardRef=function(Fe){return{$$typeof:r,render:Fe}},or.isValidElement=ni,or.lazy=function(Fe){return{$$typeof:ie,_payload:{_status:-1,_result:Fe},_init:jt}},or.memo=function(Fe,zt){return{$$typeof:$,type:Fe,compare:zt===void 0?null:zt}},or.startTransition=function(Fe){var zt=ut.T,_i={};ut.T=_i;try{var Jt=Fe(),bi=ut.S;bi!==null&&bi(_i,Jt),typeof Jt=="object"&&Jt!==null&&typeof Jt.then=="function"&&Jt.then($t,_t)}catch(Ci){_t(Ci)}finally{ut.T=zt}},or.unstable_useCacheRefresh=function(){return ut.H.useCacheRefresh()},or.use=function(Fe){return ut.H.use(Fe)},or.useActionState=function(Fe,zt,_i){return ut.H.useActionState(Fe,zt,_i)},or.useCallback=function(Fe,zt){return ut.H.useCallback(Fe,zt)},or.useContext=function(Fe){return ut.H.useContext(Fe)},or.useDebugValue=function(){},or.useDeferredValue=function(Fe,zt){return ut.H.useDeferredValue(Fe,zt)},or.useEffect=function(Fe,zt,_i){var Jt=ut.H;if(typeof _i=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Jt.useEffect(Fe,zt)},or.useId=function(){return ut.H.useId()},or.useImperativeHandle=function(Fe,zt,_i){return ut.H.useImperativeHandle(Fe,zt,_i)},or.useInsertionEffect=function(Fe,zt){return ut.H.useInsertionEffect(Fe,zt)},or.useLayoutEffect=function(Fe,zt){return ut.H.useLayoutEffect(Fe,zt)},or.useMemo=function(Fe,zt){return ut.H.useMemo(Fe,zt)},or.useOptimistic=function(Fe,zt){return ut.H.useOptimistic(Fe,zt)},or.useReducer=function(Fe,zt,_i){return ut.H.useReducer(Fe,zt,_i)},or.useRef=function(Fe){return ut.H.useRef(Fe)},or.useState=function(Fe){return ut.H.useState(Fe)},or.useSyncExternalStore=function(Fe,zt,_i){return ut.H.useSyncExternalStore(Fe,zt,_i)},or.useTransition=function(){return ut.H.useTransition()},or.version="19.1.0",or}var i2;function Yb(){return i2||(i2=1,tb.exports=bI()),tb.exports}var ne=Yb();const zr=Wb(ne),wS=yI({__proto__:null,default:zr},[ne]);var ib={exports:{}},cy={},nb={exports:{}},rb={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n2;function wI(){return n2||(n2=1,function(m){function b(Je,jt){var _t=Je.length;Je.push(jt);e:for(;0<_t;){var $t=_t-1>>>1,Fe=Je[$t];if(0<L(Fe,jt))Je[$t]=jt,Je[_t]=Fe,_t=$t;else break e}}function E(Je){return Je.length===0?null:Je[0]}function C(Je){if(Je.length===0)return null;var jt=Je[0],_t=Je.pop();if(_t!==jt){Je[0]=_t;e:for(var $t=0,Fe=Je.length,zt=Fe>>>1;$t<zt;){var _i=2*($t+1)-1,Jt=Je[_i],bi=_i+1,Ci=Je[bi];if(0>L(Jt,_t))bi<Fe&&0>L(Ci,Jt)?(Je[$t]=Ci,Je[bi]=_t,$t=bi):(Je[$t]=Jt,Je[_i]=_t,$t=_i);else if(bi<Fe&&0>L(Ci,_t))Je[$t]=Ci,Je[bi]=_t,$t=bi;else break e}}return jt}function L(Je,jt){var _t=Je.sortIndex-jt.sortIndex;return _t!==0?_t:Je.id-jt.id}if(m.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var N=performance;m.unstable_now=function(){return N.now()}}else{var G=Date,r=G.now();m.unstable_now=function(){return G.now()-r}}var Z=[],$=[],ie=1,oe=null,fe=3,Re=!1,Ie=!1,be=!1,ke=!1,Oe=typeof setTimeout=="function"?setTimeout:null,Be=typeof clearTimeout=="function"?clearTimeout:null,je=typeof setImmediate<"u"?setImmediate:null;function at(Je){for(var jt=E($);jt!==null;){if(jt.callback===null)C($);else if(jt.startTime<=Je)C($),jt.sortIndex=jt.expirationTime,b(Z,jt);else break;jt=E($)}}function ut(Je){if(be=!1,at(Je),!Ie)if(E(Z)!==null)Ie=!0,Xe||(Xe=!0,Fi());else{var jt=E($);jt!==null&&yi(ut,jt.startTime-Je)}}var Xe=!1,Tt=-1,vt=5,ni=-1;function Pi(){return ke?!0:!(m.unstable_now()-ni<vt)}function xi(){if(ke=!1,Xe){var Je=m.unstable_now();ni=Je;var jt=!0;try{e:{Ie=!1,be&&(be=!1,Be(Tt),Tt=-1),Re=!0;var _t=fe;try{t:{for(at(Je),oe=E(Z);oe!==null&&!(oe.expirationTime>Je&&Pi());){var $t=oe.callback;if(typeof $t=="function"){oe.callback=null,fe=oe.priorityLevel;var Fe=$t(oe.expirationTime<=Je);if(Je=m.unstable_now(),typeof Fe=="function"){oe.callback=Fe,at(Je),jt=!0;break t}oe===E(Z)&&C(Z),at(Je)}else C(Z);oe=E(Z)}if(oe!==null)jt=!0;else{var zt=E($);zt!==null&&yi(ut,zt.startTime-Je),jt=!1}}break e}finally{oe=null,fe=_t,Re=!1}jt=void 0}}finally{jt?Fi():Xe=!1}}}var Fi;if(typeof je=="function")Fi=function(){je(xi)};else if(typeof MessageChannel<"u"){var Ei=new MessageChannel,fi=Ei.port2;Ei.port1.onmessage=xi,Fi=function(){fi.postMessage(null)}}else Fi=function(){Oe(xi,0)};function yi(Je,jt){Tt=Oe(function(){Je(m.unstable_now())},jt)}m.unstable_IdlePriority=5,m.unstable_ImmediatePriority=1,m.unstable_LowPriority=4,m.unstable_NormalPriority=3,m.unstable_Profiling=null,m.unstable_UserBlockingPriority=2,m.unstable_cancelCallback=function(Je){Je.callback=null},m.unstable_forceFrameRate=function(Je){0>Je||125<Je?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):vt=0<Je?Math.floor(1e3/Je):5},m.unstable_getCurrentPriorityLevel=function(){return fe},m.unstable_next=function(Je){switch(fe){case 1:case 2:case 3:var jt=3;break;default:jt=fe}var _t=fe;fe=jt;try{return Je()}finally{fe=_t}},m.unstable_requestPaint=function(){ke=!0},m.unstable_runWithPriority=function(Je,jt){switch(Je){case 1:case 2:case 3:case 4:case 5:break;default:Je=3}var _t=fe;fe=Je;try{return jt()}finally{fe=_t}},m.unstable_scheduleCallback=function(Je,jt,_t){var $t=m.unstable_now();switch(typeof _t=="object"&&_t!==null?(_t=_t.delay,_t=typeof _t=="number"&&0<_t?$t+_t:$t):_t=$t,Je){case 1:var Fe=-1;break;case 2:Fe=250;break;case 5:Fe=1073741823;break;case 4:Fe=1e4;break;default:Fe=5e3}return Fe=_t+Fe,Je={id:ie++,callback:jt,priorityLevel:Je,startTime:_t,expirationTime:Fe,sortIndex:-1},_t>$t?(Je.sortIndex=_t,b($,Je),E(Z)===null&&Je===E($)&&(be?(Be(Tt),Tt=-1):be=!0,yi(ut,_t-$t))):(Je.sortIndex=Fe,b(Z,Je),Ie||Re||(Ie=!0,Xe||(Xe=!0,Fi()))),Je},m.unstable_shouldYield=Pi,m.unstable_wrapCallback=function(Je){var jt=fe;return function(){var _t=fe;fe=jt;try{return Je.apply(this,arguments)}finally{fe=_t}}}}(rb)),rb}var r2;function TI(){return r2||(r2=1,nb.exports=wI()),nb.exports}var ab={exports:{}},Ts={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var a2;function SI(){if(a2)return Ts;a2=1;var m=Yb();function b(Z){var $="https://react.dev/errors/"+Z;if(1<arguments.length){$+="?args[]="+encodeURIComponent(arguments[1]);for(var ie=2;ie<arguments.length;ie++)$+="&args[]="+encodeURIComponent(arguments[ie])}return"Minified React error #"+Z+"; visit "+$+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function E(){}var C={d:{f:E,r:function(){throw Error(b(522))},D:E,C:E,L:E,m:E,X:E,S:E,M:E},p:0,findDOMNode:null},L=Symbol.for("react.portal");function N(Z,$,ie){var oe=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:L,key:oe==null?null:""+oe,children:Z,containerInfo:$,implementation:ie}}var G=m.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function r(Z,$){if(Z==="font")return"";if(typeof $=="string")return $==="use-credentials"?$:""}return Ts.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,Ts.createPortal=function(Z,$){var ie=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!$||$.nodeType!==1&&$.nodeType!==9&&$.nodeType!==11)throw Error(b(299));return N(Z,$,null,ie)},Ts.flushSync=function(Z){var $=G.T,ie=C.p;try{if(G.T=null,C.p=2,Z)return Z()}finally{G.T=$,C.p=ie,C.d.f()}},Ts.preconnect=function(Z,$){typeof Z=="string"&&($?($=$.crossOrigin,$=typeof $=="string"?$==="use-credentials"?$:"":void 0):$=null,C.d.C(Z,$))},Ts.prefetchDNS=function(Z){typeof Z=="string"&&C.d.D(Z)},Ts.preinit=function(Z,$){if(typeof Z=="string"&&$&&typeof $.as=="string"){var ie=$.as,oe=r(ie,$.crossOrigin),fe=typeof $.integrity=="string"?$.integrity:void 0,Re=typeof $.fetchPriority=="string"?$.fetchPriority:void 0;ie==="style"?C.d.S(Z,typeof $.precedence=="string"?$.precedence:void 0,{crossOrigin:oe,integrity:fe,fetchPriority:Re}):ie==="script"&&C.d.X(Z,{crossOrigin:oe,integrity:fe,fetchPriority:Re,nonce:typeof $.nonce=="string"?$.nonce:void 0})}},Ts.preinitModule=function(Z,$){if(typeof Z=="string")if(typeof $=="object"&&$!==null){if($.as==null||$.as==="script"){var ie=r($.as,$.crossOrigin);C.d.M(Z,{crossOrigin:ie,integrity:typeof $.integrity=="string"?$.integrity:void 0,nonce:typeof $.nonce=="string"?$.nonce:void 0})}}else $==null&&C.d.M(Z)},Ts.preload=function(Z,$){if(typeof Z=="string"&&typeof $=="object"&&$!==null&&typeof $.as=="string"){var ie=$.as,oe=r(ie,$.crossOrigin);C.d.L(Z,ie,{crossOrigin:oe,integrity:typeof $.integrity=="string"?$.integrity:void 0,nonce:typeof $.nonce=="string"?$.nonce:void 0,type:typeof $.type=="string"?$.type:void 0,fetchPriority:typeof $.fetchPriority=="string"?$.fetchPriority:void 0,referrerPolicy:typeof $.referrerPolicy=="string"?$.referrerPolicy:void 0,imageSrcSet:typeof $.imageSrcSet=="string"?$.imageSrcSet:void 0,imageSizes:typeof $.imageSizes=="string"?$.imageSizes:void 0,media:typeof $.media=="string"?$.media:void 0})}},Ts.preloadModule=function(Z,$){if(typeof Z=="string")if($){var ie=r($.as,$.crossOrigin);C.d.m(Z,{as:typeof $.as=="string"&&$.as!=="script"?$.as:void 0,crossOrigin:ie,integrity:typeof $.integrity=="string"?$.integrity:void 0})}else C.d.m(Z)},Ts.requestFormReset=function(Z){C.d.r(Z)},Ts.unstable_batchedUpdates=function(Z,$){return Z($)},Ts.useFormState=function(Z,$,ie){return G.H.useFormState(Z,$,ie)},Ts.useFormStatus=function(){return G.H.useHostTransitionStatus()},Ts.version="19.1.0",Ts}var o2;function TS(){if(o2)return ab.exports;o2=1;function m(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(m)}catch(b){console.error(b)}}return m(),ab.exports=SI(),ab.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s2;function EI(){if(s2)return cy;s2=1;var m=TI(),b=Yb(),E=TS();function C(s){var h="https://react.dev/errors/"+s;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var _=2;_<arguments.length;_++)h+="&args[]="+encodeURIComponent(arguments[_])}return"Minified React error #"+s+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function L(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function N(s){var h=s,_=s;if(s.alternate)for(;h.return;)h=h.return;else{s=h;do h=s,(h.flags&4098)!==0&&(_=h.return),s=h.return;while(s)}return h.tag===3?_:null}function G(s){if(s.tag===13){var h=s.memoizedState;if(h===null&&(s=s.alternate,s!==null&&(h=s.memoizedState)),h!==null)return h.dehydrated}return null}function r(s){if(N(s)!==s)throw Error(C(188))}function Z(s){var h=s.alternate;if(!h){if(h=N(s),h===null)throw Error(C(188));return h!==s?null:s}for(var _=s,S=h;;){var P=_.return;if(P===null)break;var U=P.alternate;if(U===null){if(S=P.return,S!==null){_=S;continue}break}if(P.child===U.child){for(U=P.child;U;){if(U===_)return r(P),s;if(U===S)return r(P),h;U=U.sibling}throw Error(C(188))}if(_.return!==S.return)_=P,S=U;else{for(var le=!1,Ee=P.child;Ee;){if(Ee===_){le=!0,_=P,S=U;break}if(Ee===S){le=!0,S=P,_=U;break}Ee=Ee.sibling}if(!le){for(Ee=U.child;Ee;){if(Ee===_){le=!0,_=U,S=P;break}if(Ee===S){le=!0,S=U,_=P;break}Ee=Ee.sibling}if(!le)throw Error(C(189))}}if(_.alternate!==S)throw Error(C(190))}if(_.tag!==3)throw Error(C(188));return _.stateNode.current===_?s:h}function $(s){var h=s.tag;if(h===5||h===26||h===27||h===6)return s;for(s=s.child;s!==null;){if(h=$(s),h!==null)return h;s=s.sibling}return null}var ie=Object.assign,oe=Symbol.for("react.element"),fe=Symbol.for("react.transitional.element"),Re=Symbol.for("react.portal"),Ie=Symbol.for("react.fragment"),be=Symbol.for("react.strict_mode"),ke=Symbol.for("react.profiler"),Oe=Symbol.for("react.provider"),Be=Symbol.for("react.consumer"),je=Symbol.for("react.context"),at=Symbol.for("react.forward_ref"),ut=Symbol.for("react.suspense"),Xe=Symbol.for("react.suspense_list"),Tt=Symbol.for("react.memo"),vt=Symbol.for("react.lazy"),ni=Symbol.for("react.activity"),Pi=Symbol.for("react.memo_cache_sentinel"),xi=Symbol.iterator;function Fi(s){return s===null||typeof s!="object"?null:(s=xi&&s[xi]||s["@@iterator"],typeof s=="function"?s:null)}var Ei=Symbol.for("react.client.reference");function fi(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===Ei?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case Ie:return"Fragment";case ke:return"Profiler";case be:return"StrictMode";case ut:return"Suspense";case Xe:return"SuspenseList";case ni:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case Re:return"Portal";case je:return(s.displayName||"Context")+".Provider";case Be:return(s._context.displayName||"Context")+".Consumer";case at:var h=s.render;return s=s.displayName,s||(s=h.displayName||h.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case Tt:return h=s.displayName||null,h!==null?h:fi(s.type)||"Memo";case vt:h=s._payload,s=s._init;try{return fi(s(h))}catch{}}return null}var yi=Array.isArray,Je=b.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,jt=E.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,_t={pending:!1,data:null,method:null,action:null},$t=[],Fe=-1;function zt(s){return{current:s}}function _i(s){0>Fe||(s.current=$t[Fe],$t[Fe]=null,Fe--)}function Jt(s,h){Fe++,$t[Fe]=s.current,s.current=h}var bi=zt(null),Ci=zt(null),pi=zt(null),ri=zt(null);function Yi(s,h){switch(Jt(pi,h),Jt(Ci,s),Jt(bi,null),h.nodeType){case 9:case 11:s=(s=h.documentElement)&&(s=s.namespaceURI)?ag(s):0;break;default:if(s=h.tagName,h=h.namespaceURI)h=ag(h),s=og(h,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}_i(bi),Jt(bi,s)}function Vi(){_i(bi),_i(Ci),_i(pi)}function rn(s){s.memoizedState!==null&&Jt(ri,s);var h=bi.current,_=og(h,s.type);h!==_&&(Jt(Ci,s),Jt(bi,_))}function xn(s){Ci.current===s&&(_i(bi),_i(Ci)),ri.current===s&&(_i(ri),Nf._currentValue=_t)}var _n=Object.prototype.hasOwnProperty,Rn=m.unstable_scheduleCallback,Jr=m.unstable_cancelCallback,io=m.unstable_shouldYield,ea=m.unstable_requestPaint,kr=m.unstable_now,is=m.unstable_getCurrentPriorityLevel,la=m.unstable_ImmediatePriority,vo=m.unstable_UserBlockingPriority,Uo=m.unstable_NormalPriority,Da=m.unstable_LowPriority,xo=m.unstable_IdlePriority,wa=m.log,za=m.unstable_setDisableYieldValue,Ta=null,Ir=null;function ja(s){if(typeof wa=="function"&&za(s),Ir&&typeof Ir.setStrictMode=="function")try{Ir.setStrictMode(Ta,s)}catch{}}var Hr=Math.clz32?Math.clz32:Qs,Es=Math.log,ta=Math.LN2;function Qs(s){return s>>>=0,s===0?32:31-(Es(s)/ta|0)|0}var bo=256,Ua=4194304;function no(s){var h=s&42;if(h!==0)return h;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function Vo(s,h,_){var S=s.pendingLanes;if(S===0)return 0;var P=0,U=s.suspendedLanes,le=s.pingedLanes;s=s.warmLanes;var Ee=S&134217727;return Ee!==0?(S=Ee&~U,S!==0?P=no(S):(le&=Ee,le!==0?P=no(le):_||(_=Ee&~s,_!==0&&(P=no(_))))):(Ee=S&~U,Ee!==0?P=no(Ee):le!==0?P=no(le):_||(_=S&~s,_!==0&&(P=no(_)))),P===0?0:h!==0&&h!==P&&(h&U)===0&&(U=P&-P,_=h&-h,U>=_||U===32&&(_&4194048)!==0)?h:P}function wo(s,h){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&h)===0}function Jn(s,h){switch(s){case 1:case 2:case 4:case 8:case 64:return h+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ro(){var s=bo;return bo<<=1,(bo&4194048)===0&&(bo=256),s}function fl(){var s=Ua;return Ua<<=1,(Ua&62914560)===0&&(Ua=4194304),s}function Pa(s){for(var h=[],_=0;31>_;_++)h.push(s);return h}function As(s,h){s.pendingLanes|=h,h!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Pc(s,h,_,S,P,U){var le=s.pendingLanes;s.pendingLanes=_,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=_,s.entangledLanes&=_,s.errorRecoveryDisabledLanes&=_,s.shellSuspendCounter=0;var Ee=s.entanglements,Ke=s.expirationTimes,Mt=s.hiddenUpdates;for(_=le&~_;0<_;){var Zt=31-Hr(_),oi=1<<Zt;Ee[Zt]=0,Ke[Zt]=-1;var Lt=Mt[Zt];if(Lt!==null)for(Mt[Zt]=null,Zt=0;Zt<Lt.length;Zt++){var kt=Lt[Zt];kt!==null&&(kt.lane&=-536870913)}_&=~oi}S!==0&&Ms(s,S,0),U!==0&&P===0&&s.tag!==0&&(s.suspendedLanes|=U&~(le&~h))}function Ms(s,h,_){s.pendingLanes|=h,s.suspendedLanes&=~h;var S=31-Hr(h);s.entangledLanes|=h,s.entanglements[S]=s.entanglements[S]|1073741824|_&4194090}function Bt(s,h){var _=s.entangledLanes|=h;for(s=s.entanglements;_;){var S=31-Hr(_),P=1<<S;P&h|s[S]&h&&(s[S]|=h),_&=~P}}function Go(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function $l(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function de(){var s=jt.p;return s!==0?s:(s=window.event,s===void 0?32:Ff(s.type))}function V(s,h){var _=jt.p;try{return jt.p=s,h()}finally{jt.p=_}}var W=Math.random().toString(36).slice(2),ae="__reactFiber$"+W,ye="__reactProps$"+W,we="__reactContainer$"+W,De="__reactEvents$"+W,Me="__reactListeners$"+W,Pe="__reactHandles$"+W,He="__reactResources$"+W,Ye="__reactMarker$"+W;function Ve(s){delete s[ae],delete s[ye],delete s[De],delete s[Me],delete s[Pe]}function ft(s){var h=s[ae];if(h)return h;for(var _=s.parentNode;_;){if(h=_[we]||_[ae]){if(_=h.alternate,h.child!==null||_!==null&&_.child!==null)for(s=bh(s);s!==null;){if(_=s[ae])return _;s=bh(s)}return h}s=_,_=s.parentNode}return null}function Pt(s){if(s=s[ae]||s[we]){var h=s.tag;if(h===5||h===6||h===13||h===26||h===27||h===3)return s}return null}function Vt(s){var h=s.tag;if(h===5||h===26||h===27||h===6)return s.stateNode;throw Error(C(33))}function vi(s){var h=s[He];return h||(h=s[He]={hoistableStyles:new Map,hoistableScripts:new Map}),h}function mi(s){s[Ye]=!0}var gi=new Set,Gi={};function In(s,h){Ui(s,h),Ui(s+"Capture",h)}function Ui(s,h){for(Gi[s]=h,s=0;s<h.length;s++)gi.add(h[s])}var yn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ln={},Dn={};function Gn(s){return _n.call(Dn,s)?!0:_n.call(ln,s)?!1:yn.test(s)?Dn[s]=!0:(ln[s]=!0,!1)}function Yn(s,h,_){if(Gn(h))if(_===null)s.removeAttribute(h);else{switch(typeof _){case"undefined":case"function":case"symbol":s.removeAttribute(h);return;case"boolean":var S=h.toLowerCase().slice(0,5);if(S!=="data-"&&S!=="aria-"){s.removeAttribute(h);return}}s.setAttribute(h,""+_)}}function Er(s,h,_){if(_===null)s.removeAttribute(h);else{switch(typeof _){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(h);return}s.setAttribute(h,""+_)}}function sn(s,h,_,S){if(S===null)s.removeAttribute(_);else{switch(typeof S){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(_);return}s.setAttributeNS(h,_,""+S)}}var gr,ya;function Nr(s){if(gr===void 0)try{throw Error()}catch(_){var h=_.stack.trim().match(/\n( *(at )?)/);gr=h&&h[1]||"",ya=-1<_.stack.indexOf(`
    at`)?" (<anonymous>)":-1<_.stack.indexOf("@")?"@unknown:0:0":""}return`
`+gr+s+ya}var aa=!1;function Bn(s,h){if(!s||aa)return"";aa=!0;var _=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var S={DetermineComponentFrameRoot:function(){try{if(h){var oi=function(){throw Error()};if(Object.defineProperty(oi.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(oi,[])}catch(kt){var Lt=kt}Reflect.construct(s,[],oi)}else{try{oi.call()}catch(kt){Lt=kt}s.call(oi.prototype)}}else{try{throw Error()}catch(kt){Lt=kt}(oi=s())&&typeof oi.catch=="function"&&oi.catch(function(){})}}catch(kt){if(kt&&Lt&&typeof kt.stack=="string")return[kt.stack,Lt.stack]}return[null,null]}};S.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var P=Object.getOwnPropertyDescriptor(S.DetermineComponentFrameRoot,"name");P&&P.configurable&&Object.defineProperty(S.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var U=S.DetermineComponentFrameRoot(),le=U[0],Ee=U[1];if(le&&Ee){var Ke=le.split(`
`),Mt=Ee.split(`
`);for(P=S=0;S<Ke.length&&!Ke[S].includes("DetermineComponentFrameRoot");)S++;for(;P<Mt.length&&!Mt[P].includes("DetermineComponentFrameRoot");)P++;if(S===Ke.length||P===Mt.length)for(S=Ke.length-1,P=Mt.length-1;1<=S&&0<=P&&Ke[S]!==Mt[P];)P--;for(;1<=S&&0<=P;S--,P--)if(Ke[S]!==Mt[P]){if(S!==1||P!==1)do if(S--,P--,0>P||Ke[S]!==Mt[P]){var Zt=`
`+Ke[S].replace(" at new "," at ");return s.displayName&&Zt.includes("<anonymous>")&&(Zt=Zt.replace("<anonymous>",s.displayName)),Zt}while(1<=S&&0<=P);break}}}finally{aa=!1,Error.prepareStackTrace=_}return(_=s?s.displayName||s.name:"")?Nr(_):""}function Wr(s){switch(s.tag){case 26:case 27:case 5:return Nr(s.type);case 16:return Nr("Lazy");case 13:return Nr("Suspense");case 19:return Nr("SuspenseList");case 0:case 15:return Bn(s.type,!1);case 11:return Bn(s.type.render,!1);case 1:return Bn(s.type,!0);case 31:return Nr("Activity");default:return""}}function To(s){try{var h="";do h+=Wr(s),s=s.return;while(s);return h}catch(_){return`
Error generating stack: `+_.message+`
`+_.stack}}function ma(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Bu(s){var h=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function Fu(s){var h=Bu(s)?"checked":"value",_=Object.getOwnPropertyDescriptor(s.constructor.prototype,h),S=""+s[h];if(!s.hasOwnProperty(h)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var P=_.get,U=_.set;return Object.defineProperty(s,h,{configurable:!0,get:function(){return P.call(this)},set:function(le){S=""+le,U.call(this,le)}}),Object.defineProperty(s,h,{enumerable:_.enumerable}),{getValue:function(){return S},setValue:function(le){S=""+le},stopTracking:function(){s._valueTracker=null,delete s[h]}}}}function Lc(s){s._valueTracker||(s._valueTracker=Fu(s))}function ju(s){if(!s)return!1;var h=s._valueTracker;if(!h)return!0;var _=h.getValue(),S="";return s&&(S=Bu(s)?s.checked?"true":"false":s.value),s=S,s!==_?(h.setValue(s),!0):!1}function Js(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Oh=/[\n"\\]/g;function So(s){return s.replace(Oh,function(h){return"\\"+h.charCodeAt(0).toString(16)+" "})}function Ho(s,h,_,S,P,U,le,Ee){s.name="",le!=null&&typeof le!="function"&&typeof le!="symbol"&&typeof le!="boolean"?s.type=le:s.removeAttribute("type"),h!=null?le==="number"?(h===0&&s.value===""||s.value!=h)&&(s.value=""+ma(h)):s.value!==""+ma(h)&&(s.value=""+ma(h)):le!=="submit"&&le!=="reset"||s.removeAttribute("value"),h!=null?Va(s,le,ma(h)):_!=null?Va(s,le,ma(_)):S!=null&&s.removeAttribute("value"),P==null&&U!=null&&(s.defaultChecked=!!U),P!=null&&(s.checked=P&&typeof P!="function"&&typeof P!="symbol"),Ee!=null&&typeof Ee!="function"&&typeof Ee!="symbol"&&typeof Ee!="boolean"?s.name=""+ma(Ee):s.removeAttribute("name")}function Qd(s,h,_,S,P,U,le,Ee){if(U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"&&(s.type=U),h!=null||_!=null){if(!(U!=="submit"&&U!=="reset"||h!=null))return;_=_!=null?""+ma(_):"",h=h!=null?""+ma(h):_,Ee||h===s.value||(s.value=h),s.defaultValue=h}S=S??P,S=typeof S!="function"&&typeof S!="symbol"&&!!S,s.checked=Ee?s.checked:!!S,s.defaultChecked=!!S,le!=null&&typeof le!="function"&&typeof le!="symbol"&&typeof le!="boolean"&&(s.name=le)}function Va(s,h,_){h==="number"&&Js(s.ownerDocument)===s||s.defaultValue===""+_||(s.defaultValue=""+_)}function Ga(s,h,_,S){if(s=s.options,h){h={};for(var P=0;P<_.length;P++)h["$"+_[P]]=!0;for(_=0;_<s.length;_++)P=h.hasOwnProperty("$"+s[_].value),s[_].selected!==P&&(s[_].selected=P),P&&S&&(s[_].defaultSelected=!0)}else{for(_=""+ma(_),h=null,P=0;P<s.length;P++){if(s[P].value===_){s[P].selected=!0,S&&(s[P].defaultSelected=!0);return}h!==null||s[P].disabled||(h=s[P])}h!==null&&(h.selected=!0)}}function el(s,h,_){if(h!=null&&(h=""+ma(h),h!==s.value&&(s.value=h),_==null)){s.defaultValue!==h&&(s.defaultValue=h);return}s.defaultValue=_!=null?""+ma(_):""}function ns(s,h,_,S){if(h==null){if(S!=null){if(_!=null)throw Error(C(92));if(yi(S)){if(1<S.length)throw Error(C(93));S=S[0]}_=S}_==null&&(_=""),h=_}_=ma(h),s.defaultValue=_,S=s.textContent,S===_&&S!==""&&S!==null&&(s.value=S)}function Eo(s,h){if(h){var _=s.firstChild;if(_&&_===s.lastChild&&_.nodeType===3){_.nodeValue=h;return}}s.textContent=h}var rs=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Uu(s,h,_){var S=h.indexOf("--")===0;_==null||typeof _=="boolean"||_===""?S?s.setProperty(h,""):h==="float"?s.cssFloat="":s[h]="":S?s.setProperty(h,_):typeof _!="number"||_===0||rs.has(h)?h==="float"?s.cssFloat=_:s[h]=(""+_).trim():s[h]=_+"px"}function Jd(s,h,_){if(h!=null&&typeof h!="object")throw Error(C(62));if(s=s.style,_!=null){for(var S in _)!_.hasOwnProperty(S)||h!=null&&h.hasOwnProperty(S)||(S.indexOf("--")===0?s.setProperty(S,""):S==="float"?s.cssFloat="":s[S]="");for(var P in h)S=h[P],h.hasOwnProperty(P)&&_[P]!==S&&Uu(s,P,S)}else for(var U in h)h.hasOwnProperty(U)&&Uu(s,U,h[U])}function Cs(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var kh=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ap=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Zl(s){return ap.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}var Sa=null;function Vu(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var pl=null,Rs=null;function op(s){var h=Pt(s);if(h&&(s=h.stateNode)){var _=s[ye]||null;e:switch(s=h.stateNode,h.type){case"input":if(Ho(s,_.value,_.defaultValue,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name),h=_.name,_.type==="radio"&&h!=null){for(_=s;_.parentNode;)_=_.parentNode;for(_=_.querySelectorAll('input[name="'+So(""+h)+'"][type="radio"]'),h=0;h<_.length;h++){var S=_[h];if(S!==s&&S.form===s.form){var P=S[ye]||null;if(!P)throw Error(C(90));Ho(S,P.value,P.defaultValue,P.defaultValue,P.checked,P.defaultChecked,P.type,P.name)}}for(h=0;h<_.length;h++)S=_[h],S.form===s.form&&ju(S)}break e;case"textarea":el(s,_.value,_.defaultValue);break e;case"select":h=_.value,h!=null&&Ga(s,!!_.multiple,h,!1)}}}var Gu=!1;function Nh(s,h,_){if(Gu)return s(h,_);Gu=!0;try{var S=s(h);return S}finally{if(Gu=!1,(pl!==null||Rs!==null)&&(kl(),pl&&(h=pl,s=Rs,Rs=pl=null,op(h),s)))for(h=0;h<s.length;h++)op(s[h])}}function gn(s,h){var _=s.stateNode;if(_===null)return null;var S=_[ye]||null;if(S===null)return null;_=S[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(s=s.type,S=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!S;break e;default:s=!1}if(s)return null;if(_&&typeof _!="function")throw Error(C(231,h,typeof _));return _}var Ao=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xl=!1;if(Ao)try{var Bh={};Object.defineProperty(Bh,"passive",{get:function(){Xl=!0}}),window.addEventListener("test",Bh,Bh),window.removeEventListener("test",Bh,Bh)}catch{Xl=!1}var ml=null,gl=null,Is=null;function Oc(){if(Is)return Is;var s,h=gl,_=h.length,S,P="value"in ml?ml.value:ml.textContent,U=P.length;for(s=0;s<_&&h[s]===P[s];s++);var le=_-s;for(S=1;S<=le&&h[_-S]===P[U-S];S++);return Is=P.slice(s,1<S?1-S:void 0)}function Fh(s){var h=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&h===13&&(s=13)):s=h,s===10&&(s=13),32<=s||s===13?s:0}function Hu(){return!0}function Wl(){return!1}function Ea(s){function h(_,S,P,U,le){this._reactName=_,this._targetInst=P,this.type=S,this.nativeEvent=U,this.target=le,this.currentTarget=null;for(var Ee in s)s.hasOwnProperty(Ee)&&(_=s[Ee],this[Ee]=_?_(U):U[Ee]);return this.isDefaultPrevented=(U.defaultPrevented!=null?U.defaultPrevented:U.returnValue===!1)?Hu:Wl,this.isPropagationStopped=Wl,this}return ie(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var _=this.nativeEvent;_&&(_.preventDefault?_.preventDefault():typeof _.returnValue!="unknown"&&(_.returnValue=!1),this.isDefaultPrevented=Hu)},stopPropagation:function(){var _=this.nativeEvent;_&&(_.stopPropagation?_.stopPropagation():typeof _.cancelBubble!="unknown"&&(_.cancelBubble=!0),this.isPropagationStopped=Hu)},persist:function(){},isPersistent:Hu}),h}var as={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},kc=Ea(as),Nc=ie({},as,{view:0,detail:0}),Mo=Ea(Nc),tl,jh,Bc,Fc=ie({},Nc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:di,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Bc&&(Bc&&s.type==="mousemove"?(tl=s.screenX-Bc.screenX,jh=s.screenY-Bc.screenY):jh=tl=0,Bc=s),tl)},movementY:function(s){return"movementY"in s?s.movementY:jh}}),Yl=Ea(Fc),Co=ie({},Fc,{dataTransfer:0}),sp=Ea(Co),ef=ie({},Nc,{relatedTarget:0}),jc=Ea(ef),Cn=ie({},as,{animationName:0,elapsedTime:0,pseudoElement:0}),Pm=Ea(Cn),Ti=ie({},as,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Lm=Ea(Ti),tf=ie({},as,{data:0}),Uh=Ea(tf),Vh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},os={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Uc={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Kl(s){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(s):(s=Uc[s])?!!h[s]:!1}function di(){return Kl}var qn=ie({},Nc,{key:function(s){if(s.key){var h=Vh[s.key]||s.key;if(h!=="Unidentified")return h}return s.type==="keypress"?(s=Fh(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?os[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:di,charCode:function(s){return s.type==="keypress"?Fh(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Fh(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),kn=Ea(qn),ao=ie({},Fc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_l=Ea(ao),On=ie({},Nc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:di}),Vc=Ea(On),Gh=ie({},as,{propertyName:0,elapsedTime:0,pseudoElement:0}),Hh=Ea(Gh),Ha=ie({},Fc,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),ia=Ea(Ha),i_=ie({},as,{newState:0,oldState:0}),qh=Ea(i_),lp=[9,13,27,32],Ql=Ao&&"CompositionEvent"in window,ss=null;Ao&&"documentMode"in document&&(ss=document.documentMode);var nf=Ao&&"TextEvent"in window&&!ss,La=Ao&&(!Ql||ss&&8<ss&&11>=ss),ls=" ",qa=!1;function cp(s,h){switch(s){case"keyup":return lp.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Gc(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Br=!1;function $a(s,h){switch(s){case"compositionend":return Gc(h);case"keypress":return h.which!==32?null:(qa=!0,ls);case"textInput":return s=h.data,s===ls&&qa?null:s;default:return null}}function Zi(s,h){if(Br)return s==="compositionend"||!Ql&&cp(s,h)?(s=Oc(),Is=gl=ml=null,Br=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return La&&h.locale!=="ko"?null:h.data;default:return null}}var ei={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qu(s){var h=s&&s.nodeName&&s.nodeName.toLowerCase();return h==="input"?!!ei[s.type]:h==="textarea"}function Di(s,h,_,S){pl?Rs?Rs.push(S):Rs=[S]:pl=S,h=tg(h,"onChange"),0<h.length&&(_=new kc("onChange","change",null,_,S),s.push({event:_,listeners:h}))}var Ds=null,il=null;function Li(s){qy(s,0)}function $h(s){var h=Vt(s);if(ju(h))return s}function cs(s,h){if(s==="change")return h}var up=!1;if(Ao){var $u;if(Ao){var va="oninput"in document;if(!va){var Oa=document.createElement("div");Oa.setAttribute("oninput","return;"),va=typeof Oa.oninput=="function"}$u=va}else $u=!1;up=$u&&(!document.documentMode||9<document.documentMode)}function Hc(){Ds&&(Ds.detachEvent("onpropertychange",yl),il=Ds=null)}function yl(s){if(s.propertyName==="value"&&$h(il)){var h=[];Di(h,il,s,Vu(s)),Nh(Li,h)}}function qc(s,h,_){s==="focusin"?(Hc(),Ds=h,il=_,Ds.attachEvent("onpropertychange",yl)):s==="focusout"&&Hc()}function $c(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return $h(il)}function Za(s,h){if(s==="click")return $h(h)}function Zh(s,h){if(s==="input"||s==="change")return $h(h)}function Xh(s,h){return s===h&&(s!==0||1/s===1/h)||s!==s&&h!==h}var qo=typeof Object.is=="function"?Object.is:Xh;function $o(s,h){if(qo(s,h))return!0;if(typeof s!="object"||s===null||typeof h!="object"||h===null)return!1;var _=Object.keys(s),S=Object.keys(h);if(_.length!==S.length)return!1;for(S=0;S<_.length;S++){var P=_[S];if(!_n.call(h,P)||!qo(s[P],h[P]))return!1}return!0}function rf(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function zs(s,h){var _=rf(s);s=0;for(var S;_;){if(_.nodeType===3){if(S=s+_.textContent.length,s<=h&&S>=h)return{node:_,offset:h-s};s=S}e:{for(;_;){if(_.nextSibling){_=_.nextSibling;break e}_=_.parentNode}_=void 0}_=rf(_)}}function af(s,h){return s&&h?s===h?!0:s&&s.nodeType===3?!1:h&&h.nodeType===3?af(s,h.parentNode):"contains"in s?s.contains(h):s.compareDocumentPosition?!!(s.compareDocumentPosition(h)&16):!1:!1}function vl(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var h=Js(s.document);h instanceof s.HTMLIFrameElement;){try{var _=typeof h.contentWindow.location.href=="string"}catch{_=!1}if(_)s=h.contentWindow;else break;h=Js(s.document)}return h}function hp(s){var h=s&&s.nodeName&&s.nodeName.toLowerCase();return h&&(h==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||h==="textarea"||s.contentEditable==="true")}var n_=Ao&&"documentMode"in document&&11>=document.documentMode,Zc=null,of=null,Wh=null,Zu=!1;function dp(s,h,_){var S=_.window===_?_.document:_.nodeType===9?_:_.ownerDocument;Zu||Zc==null||Zc!==Js(S)||(S=Zc,"selectionStart"in S&&hp(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),Wh&&$o(Wh,S)||(Wh=S,S=tg(of,"onSelect"),0<S.length&&(h=new kc("onSelect","select",null,h,_),s.push({event:h,listeners:S}),h.target=Zc)))}function Ro(s,h){var _={};return _[s.toLowerCase()]=h.toLowerCase(),_["Webkit"+s]="webkit"+h,_["Moz"+s]="moz"+h,_}var Xc={animationend:Ro("Animation","AnimationEnd"),animationiteration:Ro("Animation","AnimationIteration"),animationstart:Ro("Animation","AnimationStart"),transitionrun:Ro("Transition","TransitionRun"),transitionstart:Ro("Transition","TransitionStart"),transitioncancel:Ro("Transition","TransitionCancel"),transitionend:Ro("Transition","TransitionEnd")},sf={},nl={};Ao&&(nl=document.createElement("div").style,"AnimationEvent"in window||(delete Xc.animationend.animation,delete Xc.animationiteration.animation,delete Xc.animationstart.animation),"TransitionEvent"in window||delete Xc.transitionend.transition);function Ps(s){if(sf[s])return sf[s];if(!Xc[s])return s;var h=Xc[s],_;for(_ in h)if(h.hasOwnProperty(_)&&_ in nl)return sf[s]=h[_];return s}var lf=Ps("animationend"),Zo=Ps("animationiteration"),Wc=Ps("animationstart"),Xu=Ps("transitionrun"),fp=Ps("transitionstart"),cf=Ps("transitioncancel"),Io=Ps("transitionend"),Yh=new Map,Ut="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ut.push("scrollEnd");function Xo(s,h){Yh.set(s,h),In(h,[s])}var Kh=new WeakMap;function oo(s,h){if(typeof s=="object"&&s!==null){var _=Kh.get(s);return _!==void 0?_:(h={value:s,source:h,stack:To(h)},Kh.set(s,h),h)}return{value:s,source:h,stack:To(h)}}var Do=[],us=0,zo=0;function xl(){for(var s=us,h=zo=us=0;h<s;){var _=Do[h];Do[h++]=null;var S=Do[h];Do[h++]=null;var P=Do[h];Do[h++]=null;var U=Do[h];if(Do[h++]=null,S!==null&&P!==null){var le=S.pending;le===null?P.next=P:(P.next=le.next,le.next=P),S.pending=P}U!==0&&Kc(_,P,U)}}function Ls(s,h,_,S){Do[us++]=s,Do[us++]=h,Do[us++]=_,Do[us++]=S,zo|=S,s.lanes|=S,s=s.alternate,s!==null&&(s.lanes|=S)}function Yc(s,h,_,S){return Ls(s,h,_,S),cn(s)}function hs(s,h){return Ls(s,null,null,h),cn(s)}function Kc(s,h,_){s.lanes|=_;var S=s.alternate;S!==null&&(S.lanes|=_);for(var P=!1,U=s.return;U!==null;)U.childLanes|=_,S=U.alternate,S!==null&&(S.childLanes|=_),U.tag===22&&(s=U.stateNode,s===null||s._visibility&1||(P=!0)),s=U,U=U.return;return s.tag===3?(U=s.stateNode,P&&h!==null&&(P=31-Hr(_),s=U.hiddenUpdates,S=s[P],S===null?s[P]=[h]:S.push(h),h.lane=_|536870912),U):null}function cn(s){if(50<Fo)throw Fo=0,Jo=null,Error(C(185));for(var h=s.return;h!==null;)s=h,h=s.return;return s.tag===3?s.stateNode:null}var Jl={};function r_(s,h,_,S){this.tag=s,this.key=_,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Po(s,h,_,S){return new r_(s,h,_,S)}function Qh(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Os(s,h){var _=s.alternate;return _===null?(_=Po(s.tag,h,s.key,s.mode),_.elementType=s.elementType,_.type=s.type,_.stateNode=s.stateNode,_.alternate=s,s.alternate=_):(_.pendingProps=h,_.type=s.type,_.flags=0,_.subtreeFlags=0,_.deletions=null),_.flags=s.flags&65011712,_.childLanes=s.childLanes,_.lanes=s.lanes,_.child=s.child,_.memoizedProps=s.memoizedProps,_.memoizedState=s.memoizedState,_.updateQueue=s.updateQueue,h=s.dependencies,_.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},_.sibling=s.sibling,_.index=s.index,_.ref=s.ref,_.refCleanup=s.refCleanup,_}function br(s,h){s.flags&=65011714;var _=s.alternate;return _===null?(s.childLanes=0,s.lanes=h,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=_.childLanes,s.lanes=_.lanes,s.child=_.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=_.memoizedProps,s.memoizedState=_.memoizedState,s.updateQueue=_.updateQueue,s.type=_.type,h=_.dependencies,s.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),s}function uf(s,h,_,S,P,U){var le=0;if(S=s,typeof s=="function")Qh(s)&&(le=1);else if(typeof s=="string")le=ox(s,_,bi.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case ni:return s=Po(31,_,h,P),s.elementType=ni,s.lanes=U,s;case Ie:return Qc(_.children,P,U,h);case be:le=8,P|=24;break;case ke:return s=Po(12,_,h,P|2),s.elementType=ke,s.lanes=U,s;case ut:return s=Po(13,_,h,P),s.elementType=ut,s.lanes=U,s;case Xe:return s=Po(19,_,h,P),s.elementType=Xe,s.lanes=U,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case Oe:case je:le=10;break e;case Be:le=9;break e;case at:le=11;break e;case Tt:le=14;break e;case vt:le=16,S=null;break e}le=29,_=Error(C(130,s===null?"null":typeof s,"")),S=null}return h=Po(le,_,h,P),h.elementType=s,h.type=S,h.lanes=U,h}function Qc(s,h,_,S){return s=Po(7,s,S,h),s.lanes=_,s}function pp(s,h,_){return s=Po(6,s,null,h),s.lanes=_,s}function hf(s,h,_){return h=Po(4,s.children!==null?s.children:[],s.key,h),h.lanes=_,h.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},h}var Wu=[],bl=0,df=null,Jh=0,Lo=[],so=0,wl=null,lo=1,ks="";function ec(s,h){Wu[bl++]=Jh,Wu[bl++]=df,df=s,Jh=h}function Jc(s,h,_){Lo[so++]=lo,Lo[so++]=ks,Lo[so++]=wl,wl=s;var S=lo;s=ks;var P=32-Hr(S)-1;S&=~(1<<P),_+=1;var U=32-Hr(h)+P;if(30<U){var le=P-P%5;U=(S&(1<<le)-1).toString(32),S>>=le,P-=le,lo=1<<32-Hr(h)+P|_<<P|S,ks=U+s}else lo=1<<U|_<<P|S,ks=s}function eu(s){s.return!==null&&(ec(s,1),Jc(s,1,0))}function Yu(s){for(;s===df;)df=Wu[--bl],Wu[bl]=null,Jh=Wu[--bl],Wu[bl]=null;for(;s===wl;)wl=Lo[--so],Lo[so]=null,ks=Lo[--so],Lo[so]=null,lo=Lo[--so],Lo[so]=null}var Aa=null,Fr=null,_r=!1,Tl=null,Ns=!1,ed=Error(C(519));function rl(s){var h=Error(C(418,""));throw eh(oo(h,s)),ed}function Ku(s){var h=s.stateNode,_=s.type,S=s.memoizedProps;switch(h[ae]=s,h[ye]=S,_){case"dialog":dr("cancel",h),dr("close",h);break;case"iframe":case"object":case"embed":dr("load",h);break;case"video":case"audio":for(_=0;_<Qp.length;_++)dr(Qp[_],h);break;case"source":dr("error",h);break;case"img":case"image":case"link":dr("error",h),dr("load",h);break;case"details":dr("toggle",h);break;case"input":dr("invalid",h),Qd(h,S.value,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name,!0),Lc(h);break;case"select":dr("invalid",h);break;case"textarea":dr("invalid",h),ns(h,S.value,S.defaultValue,S.children),Lc(h)}_=S.children,typeof _!="string"&&typeof _!="number"&&typeof _!="bigint"||h.textContent===""+_||S.suppressHydrationWarning===!0||zf(h.textContent,_)?(S.popover!=null&&(dr("beforetoggle",h),dr("toggle",h)),S.onScroll!=null&&dr("scroll",h),S.onScrollEnd!=null&&dr("scrollend",h),S.onClick!=null&&(h.onclick=tm),h=!0):h=!1,h||rl(s)}function mp(s){for(Aa=s.return;Aa;)switch(Aa.tag){case 5:case 13:Ns=!1;return;case 27:case 3:Ns=!0;return;default:Aa=Aa.return}}function Qu(s){if(s!==Aa)return!1;if(!_r)return mp(s),_r=!0,!1;var h=s.tag,_;if((_=h!==3&&h!==27)&&((_=h===5)&&(_=s.type,_=!(_!=="form"&&_!=="button")||sg(s.type,s.memoizedProps)),_=!_),_&&Fr&&rl(s),mp(s),h===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(C(317));e:{for(s=s.nextSibling,h=0;s;){if(s.nodeType===8)if(_=s.data,_==="/$"){if(h===0){Fr=jl(s.nextSibling);break e}h--}else _!=="$"&&_!=="$!"&&_!=="$?"||h++;s=s.nextSibling}Fr=null}}else h===27?(h=Fr,Su(s.type)?(s=x_,x_=null,Fr=s):Fr=h):Fr=Aa?jl(s.stateNode.nextSibling):null;return!0}function Ju(){Fr=Aa=null,_r=!1}function tu(){var s=Tl;return s!==null&&(Sn===null?Sn=s:Sn.push.apply(Sn,s),Tl=null),s}function eh(s){Tl===null?Tl=[s]:Tl.push(s)}var gp=zt(null),Sl=null,El=null;function Bs(s,h,_){Jt(gp,h._currentValue),h._currentValue=_}function Fs(s){s._currentValue=gp.current,_i(gp)}function td(s,h,_){for(;s!==null;){var S=s.alternate;if((s.childLanes&h)!==h?(s.childLanes|=h,S!==null&&(S.childLanes|=h)):S!==null&&(S.childLanes&h)!==h&&(S.childLanes|=h),s===_)break;s=s.return}}function id(s,h,_,S){var P=s.child;for(P!==null&&(P.return=s);P!==null;){var U=P.dependencies;if(U!==null){var le=P.child;U=U.firstContext;e:for(;U!==null;){var Ee=U;U=P;for(var Ke=0;Ke<h.length;Ke++)if(Ee.context===h[Ke]){U.lanes|=_,Ee=U.alternate,Ee!==null&&(Ee.lanes|=_),td(U.return,_,s),S||(le=null);break e}U=Ee.next}}else if(P.tag===18){if(le=P.return,le===null)throw Error(C(341));le.lanes|=_,U=le.alternate,U!==null&&(U.lanes|=_),td(le,_,s),le=null}else le=P.child;if(le!==null)le.return=P;else for(le=P;le!==null;){if(le===s){le=null;break}if(P=le.sibling,P!==null){P.return=le.return,le=P;break}le=le.return}P=le}}function iu(s,h,_,S){s=null;for(var P=h,U=!1;P!==null;){if(!U){if((P.flags&524288)!==0)U=!0;else if((P.flags&262144)!==0)break}if(P.tag===10){var le=P.alternate;if(le===null)throw Error(C(387));if(le=le.memoizedProps,le!==null){var Ee=P.type;qo(P.pendingProps.value,le.value)||(s!==null?s.push(Ee):s=[Ee])}}else if(P===ri.current){if(le=P.alternate,le===null)throw Error(C(387));le.memoizedState.memoizedState!==P.memoizedState.memoizedState&&(s!==null?s.push(Nf):s=[Nf])}P=P.return}s!==null&&id(h,s,_,S),h.flags|=262144}function th(s){for(s=s.firstContext;s!==null;){if(!qo(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function ds(s){Sl=s,El=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function da(s){return _p(Sl,s)}function Al(s,h){return Sl===null&&ds(s),_p(s,h)}function _p(s,h){var _=h._currentValue;if(h={context:h,memoizedValue:_,next:null},El===null){if(s===null)throw Error(C(308));El=h,s.dependencies={lanes:0,firstContext:h},s.flags|=524288}else El=El.next=h;return _}var co=typeof AbortController<"u"?AbortController:function(){var s=[],h=this.signal={aborted:!1,addEventListener:function(_,S){s.push(S)}};this.abort=function(){h.aborted=!0,s.forEach(function(_){return _()})}},nd=m.unstable_scheduleCallback,ff=m.unstable_NormalPriority,ca={$$typeof:je,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ih(){return{controller:new co,data:new Map,refCount:0}}function tc(s){s.refCount--,s.refCount===0&&nd(ff,function(){s.controller.abort()})}var nu=null,nh=0,ic=0,Ml=null;function rd(s,h){if(nu===null){var _=nu=[];nh=0,ic=p_(),Ml={status:"pending",value:void 0,then:function(S){_.push(S)}}}return nh++,h.then(rh,rh),h}function rh(){if(--nh===0&&nu!==null){Ml!==null&&(Ml.status="fulfilled");var s=nu;nu=null,ic=0,Ml=null;for(var h=0;h<s.length;h++)(0,s[h])()}}function Om(s,h){var _=[],S={status:"pending",value:null,reason:null,then:function(P){_.push(P)}};return s.then(function(){S.status="fulfilled",S.value=h;for(var P=0;P<_.length;P++)(0,_[P])(h)},function(P){for(S.status="rejected",S.reason=P,P=0;P<_.length;P++)(0,_[P])(void 0)}),S}var nc=Je.S;Je.S=function(s,h){typeof h=="object"&&h!==null&&typeof h.then=="function"&&rd(s,h),nc!==null&&nc(s,h)};var ru=zt(null);function yp(){var s=ru.current;return s!==null?s:Hi.pooledCache}function ad(s,h){h===null?Jt(ru,ru.current):Jt(ru,h.pool)}function vp(){var s=yp();return s===null?null:{parent:ca._currentValue,pool:s}}var od=Error(C(460)),km=Error(C(474)),ah=Error(C(542)),au={then:function(){}};function xp(s){return s=s.status,s==="fulfilled"||s==="rejected"}function al(){}function bp(s,h,_){switch(_=s[_],_===void 0?s.push(h):_!==h&&(h.then(al,al),h=_),h.status){case"fulfilled":return h.value;case"rejected":throw s=h.reason,sd(s),s;default:if(typeof h.status=="string")h.then(al,al);else{if(s=Hi,s!==null&&100<s.shellSuspendCounter)throw Error(C(482));s=h,s.status="pending",s.then(function(S){if(h.status==="pending"){var P=h;P.status="fulfilled",P.value=S}},function(S){if(h.status==="pending"){var P=h;P.status="rejected",P.reason=S}})}switch(h.status){case"fulfilled":return h.value;case"rejected":throw s=h.reason,sd(s),s}throw oh=h,od}}var oh=null;function pf(){if(oh===null)throw Error(C(459));var s=oh;return oh=null,s}function sd(s){if(s===od||s===ah)throw Error(C(483))}var uo=!1;function mf(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ho(s,h){s=s.updateQueue,h.updateQueue===s&&(h.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function ol(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function js(s,h,_){var S=s.updateQueue;if(S===null)return null;if(S=S.shared,(Ai&2)!==0){var P=S.pending;return P===null?h.next=h:(h.next=P.next,P.next=h),S.pending=h,h=cn(s),Kc(s,null,_),h}return Ls(s,S,h,_),cn(s)}function sh(s,h,_){if(h=h.updateQueue,h!==null&&(h=h.shared,(_&4194048)!==0)){var S=h.lanes;S&=s.pendingLanes,_|=S,h.lanes=_,Bt(s,_)}}function ld(s,h){var _=s.updateQueue,S=s.alternate;if(S!==null&&(S=S.updateQueue,_===S)){var P=null,U=null;if(_=_.firstBaseUpdate,_!==null){do{var le={lane:_.lane,tag:_.tag,payload:_.payload,callback:null,next:null};U===null?P=U=le:U=U.next=le,_=_.next}while(_!==null);U===null?P=U=h:U=U.next=h}else P=U=h;_={baseState:S.baseState,firstBaseUpdate:P,lastBaseUpdate:U,shared:S.shared,callbacks:S.callbacks},s.updateQueue=_;return}s=_.lastBaseUpdate,s===null?_.firstBaseUpdate=h:s.next=h,_.lastBaseUpdate=h}var lh=!1;function rc(){if(lh){var s=Ml;if(s!==null)throw s}}function ch(s,h,_,S){lh=!1;var P=s.updateQueue;uo=!1;var U=P.firstBaseUpdate,le=P.lastBaseUpdate,Ee=P.shared.pending;if(Ee!==null){P.shared.pending=null;var Ke=Ee,Mt=Ke.next;Ke.next=null,le===null?U=Mt:le.next=Mt,le=Ke;var Zt=s.alternate;Zt!==null&&(Zt=Zt.updateQueue,Ee=Zt.lastBaseUpdate,Ee!==le&&(Ee===null?Zt.firstBaseUpdate=Mt:Ee.next=Mt,Zt.lastBaseUpdate=Ke))}if(U!==null){var oi=P.baseState;le=0,Zt=Mt=Ke=null,Ee=U;do{var Lt=Ee.lane&-536870913,kt=Lt!==Ee.lane;if(kt?(wi&Lt)===Lt:(S&Lt)===Lt){Lt!==0&&Lt===ic&&(lh=!0),Zt!==null&&(Zt=Zt.next={lane:0,tag:Ee.tag,payload:Ee.payload,callback:null,next:null});e:{var Ln=s,An=Ee;Lt=h;var Zr=_;switch(An.tag){case 1:if(Ln=An.payload,typeof Ln=="function"){oi=Ln.call(Zr,oi,Lt);break e}oi=Ln;break e;case 3:Ln.flags=Ln.flags&-65537|128;case 0:if(Ln=An.payload,Lt=typeof Ln=="function"?Ln.call(Zr,oi,Lt):Ln,Lt==null)break e;oi=ie({},oi,Lt);break e;case 2:uo=!0}}Lt=Ee.callback,Lt!==null&&(s.flags|=64,kt&&(s.flags|=8192),kt=P.callbacks,kt===null?P.callbacks=[Lt]:kt.push(Lt))}else kt={lane:Lt,tag:Ee.tag,payload:Ee.payload,callback:Ee.callback,next:null},Zt===null?(Mt=Zt=kt,Ke=oi):Zt=Zt.next=kt,le|=Lt;if(Ee=Ee.next,Ee===null){if(Ee=P.shared.pending,Ee===null)break;kt=Ee,Ee=kt.next,kt.next=null,P.lastBaseUpdate=kt,P.shared.pending=null}}while(!0);Zt===null&&(Ke=oi),P.baseState=Ke,P.firstBaseUpdate=Mt,P.lastBaseUpdate=Zt,U===null&&(P.shared.lanes=0),er|=le,s.lanes=le,s.memoizedState=oi}}function cd(s,h){if(typeof s!="function")throw Error(C(191,s));s.call(h)}function ac(s,h){var _=s.callbacks;if(_!==null)for(s.callbacks=null,s=0;s<_.length;s++)cd(_[s],h)}var ou=zt(null),gf=zt(0);function sl(s,h){s=wn,Jt(gf,s),Jt(ou,h),wn=s|h.baseLanes}function wp(){Jt(gf,wn),Jt(ou,ou.current)}function ud(){wn=gf.current,_i(ou),_i(gf)}var Us=0,Nn=null,yr=null,Yr=null,oc=!1,ll=!1,cl=!1,uh=0,sc=0,lc=null,hh=0;function Kr(){throw Error(C(321))}function Wt(s,h){if(h===null)return!1;for(var _=0;_<h.length&&_<s.length;_++)if(!qo(s[_],h[_]))return!1;return!0}function su(s,h,_,S,P,U){return Us=U,Nn=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,Je.H=s===null||s.memoizedState===null?mu:Sf,cl=!1,U=_(S,P),cl=!1,ll&&(U=Cl(h,_,S,P)),cc(s),U}function cc(s){Je.H=pu;var h=yr!==null&&yr.next!==null;if(Us=0,Yr=yr=Nn=null,oc=!1,sc=0,lc=null,h)throw Error(C(300));s===null||ga||(s=s.dependencies,s!==null&&th(s)&&(ga=!0))}function Cl(s,h,_,S){Nn=s;var P=0;do{if(ll&&(lc=null),sc=0,ll=!1,25<=P)throw Error(C(301));if(P+=1,Yr=yr=null,s.updateQueue!=null){var U=s.updateQueue;U.lastEffect=null,U.events=null,U.stores=null,U.memoCache!=null&&(U.memoCache.index=0)}Je.H=Pp,U=h(_,S)}while(ll);return U}function uc(){var s=Je.H,h=s.useState()[0];return h=typeof h.then=="function"?dd(h):h,s=s.useState()[0],(yr!==null?yr.memoizedState:null)!==s&&(Nn.flags|=1024),h}function Si(){var s=uh!==0;return uh=0,s}function hd(s,h,_){h.updateQueue=s.updateQueue,h.flags&=-2053,s.lanes&=~_}function Tp(s){if(oc){for(s=s.memoizedState;s!==null;){var h=s.queue;h!==null&&(h.pending=null),s=s.next}oc=!1}Us=0,Yr=yr=Nn=null,ll=!1,sc=uh=0,lc=null}function fo(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Yr===null?Nn.memoizedState=Yr=s:Yr=Yr.next=s,Yr}function na(){if(yr===null){var s=Nn.alternate;s=s!==null?s.memoizedState:null}else s=yr.next;var h=Yr===null?Nn.memoizedState:Yr.next;if(h!==null)Yr=h,yr=s;else{if(s===null)throw Nn.alternate===null?Error(C(467)):Error(C(310));yr=s,s={memoizedState:yr.memoizedState,baseState:yr.baseState,baseQueue:yr.baseQueue,queue:yr.queue,next:null},Yr===null?Nn.memoizedState=Yr=s:Yr=Yr.next=s}return Yr}function _f(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function dd(s){var h=sc;return sc+=1,lc===null&&(lc=[]),s=bp(lc,s,h),h=Nn,(Yr===null?h.memoizedState:Yr.next)===null&&(h=h.alternate,Je.H=h===null||h.memoizedState===null?mu:Sf),s}function fd(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return dd(s);if(s.$$typeof===je)return da(s)}throw Error(C(438,String(s)))}function Sp(s){var h=null,_=Nn.updateQueue;if(_!==null&&(h=_.memoCache),h==null){var S=Nn.alternate;S!==null&&(S=S.updateQueue,S!==null&&(S=S.memoCache,S!=null&&(h={data:S.data.map(function(P){return P.slice()}),index:0})))}if(h==null&&(h={data:[],index:0}),_===null&&(_=_f(),Nn.updateQueue=_),_.memoCache=h,_=h.data[h.index],_===void 0)for(_=h.data[h.index]=Array(s),S=0;S<s;S++)_[S]=Pi;return h.index++,_}function Rl(s,h){return typeof h=="function"?h(s):h}function dh(s){var h=na();return pd(h,yr,s)}function pd(s,h,_){var S=s.queue;if(S===null)throw Error(C(311));S.lastRenderedReducer=_;var P=s.baseQueue,U=S.pending;if(U!==null){if(P!==null){var le=P.next;P.next=U.next,U.next=le}h.baseQueue=P=U,S.pending=null}if(U=s.baseState,P===null)s.memoizedState=U;else{h=P.next;var Ee=le=null,Ke=null,Mt=h,Zt=!1;do{var oi=Mt.lane&-536870913;if(oi!==Mt.lane?(wi&oi)===oi:(Us&oi)===oi){var Lt=Mt.revertLane;if(Lt===0)Ke!==null&&(Ke=Ke.next={lane:0,revertLane:0,action:Mt.action,hasEagerState:Mt.hasEagerState,eagerState:Mt.eagerState,next:null}),oi===ic&&(Zt=!0);else if((Us&Lt)===Lt){Mt=Mt.next,Lt===ic&&(Zt=!0);continue}else oi={lane:0,revertLane:Mt.revertLane,action:Mt.action,hasEagerState:Mt.hasEagerState,eagerState:Mt.eagerState,next:null},Ke===null?(Ee=Ke=oi,le=U):Ke=Ke.next=oi,Nn.lanes|=Lt,er|=Lt;oi=Mt.action,cl&&_(U,oi),U=Mt.hasEagerState?Mt.eagerState:_(U,oi)}else Lt={lane:oi,revertLane:Mt.revertLane,action:Mt.action,hasEagerState:Mt.hasEagerState,eagerState:Mt.eagerState,next:null},Ke===null?(Ee=Ke=Lt,le=U):Ke=Ke.next=Lt,Nn.lanes|=oi,er|=oi;Mt=Mt.next}while(Mt!==null&&Mt!==h);if(Ke===null?le=U:Ke.next=Ee,!qo(U,s.memoizedState)&&(ga=!0,Zt&&(_=Ml,_!==null)))throw _;s.memoizedState=U,s.baseState=le,s.baseQueue=Ke,S.lastRenderedState=U}return P===null&&(S.lanes=0),[s.memoizedState,S.dispatch]}function md(s){var h=na(),_=h.queue;if(_===null)throw Error(C(311));_.lastRenderedReducer=s;var S=_.dispatch,P=_.pending,U=h.memoizedState;if(P!==null){_.pending=null;var le=P=P.next;do U=s(U,le.action),le=le.next;while(le!==P);qo(U,h.memoizedState)||(ga=!0),h.memoizedState=U,h.baseQueue===null&&(h.baseState=U),_.lastRenderedState=U}return[U,S]}function yf(s,h,_){var S=Nn,P=na(),U=_r;if(U){if(_===void 0)throw Error(C(407));_=_()}else _=h();var le=!qo((yr||P).memoizedState,_);le&&(P.memoizedState=_,ga=!0),P=P.queue;var Ee=hc.bind(null,S,P,s);if(pc(2048,8,Ee,[s]),P.getSnapshot!==h||le||Yr!==null&&Yr.memoizedState.tag&1){if(S.flags|=2048,ps(9,wr(),Il.bind(null,S,P,_,h),null),Hi===null)throw Error(C(349));U||(Us&124)!==0||po(S,h,_)}return _}function po(s,h,_){s.flags|=16384,s={getSnapshot:h,value:_},h=Nn.updateQueue,h===null?(h=_f(),Nn.updateQueue=h,h.stores=[s]):(_=h.stores,_===null?h.stores=[s]:_.push(s))}function Il(s,h,_,S){h.value=_,h.getSnapshot=S,gd(h)&&_d(s)}function hc(s,h,_){return _(function(){gd(h)&&_d(s)})}function gd(s){var h=s.getSnapshot;s=s.value;try{var _=h();return!qo(s,_)}catch{return!0}}function _d(s){var h=hs(s,2);h!==null&&Qa(h,s,2)}function dc(s){var h=fo();if(typeof s=="function"){var _=s;if(s=_(),cl){ja(!0);try{_()}finally{ja(!1)}}}return h.memoizedState=h.baseState=s,h.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Rl,lastRenderedState:s},h}function Ep(s,h,_,S){return s.baseState=_,pd(s,yr,typeof S=="function"?S:Rl)}function fs(s,h,_,S,P){if(du(s))throw Error(C(485));if(s=h.action,s!==null){var U={payload:P,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(le){U.listeners.push(le)}};Je.T!==null?_(!0):U.isTransition=!1,S(U),_=h.pending,_===null?(U.next=h.pending=U,Fn(h,U)):(U.next=_.next,h.pending=_.next=U)}}function Fn(s,h){var _=h.action,S=h.payload,P=s.state;if(h.isTransition){var U=Je.T,le={};Je.T=le;try{var Ee=_(P,S),Ke=Je.S;Ke!==null&&Ke(le,Ee),fh(s,h,Ee)}catch(Mt){vf(s,h,Mt)}finally{Je.T=U}}else try{U=_(P,S),fh(s,h,U)}catch(Mt){vf(s,h,Mt)}}function fh(s,h,_){_!==null&&typeof _=="object"&&typeof _.then=="function"?_.then(function(S){Dl(s,h,S)},function(S){return vf(s,h,S)}):Dl(s,h,_)}function Dl(s,h,_){h.status="fulfilled",h.value=_,Ap(h),s.state=_,h=s.pending,h!==null&&(_=h.next,_===h?s.pending=null:(_=_.next,h.next=_,Fn(s,_)))}function vf(s,h,_){var S=s.pending;if(s.pending=null,S!==null){S=S.next;do h.status="rejected",h.reason=_,Ap(h),h=h.next;while(h!==S)}s.action=null}function Ap(s){s=s.listeners;for(var h=0;h<s.length;h++)(0,s[h])()}function Mp(s,h){return h}function Nm(s,h){if(_r){var _=Hi.formState;if(_!==null){e:{var S=Nn;if(_r){if(Fr){t:{for(var P=Fr,U=Ns;P.nodeType!==8;){if(!U){P=null;break t}if(P=jl(P.nextSibling),P===null){P=null;break t}}U=P.data,P=U==="F!"||U==="F"?P:null}if(P){Fr=jl(P.nextSibling),S=P.data==="F!";break e}}rl(S)}S=!1}S&&(h=_[0])}}return _=fo(),_.memoizedState=_.baseState=h,S={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mp,lastRenderedState:h},_.queue=S,_=bn.bind(null,Nn,S),S.dispatch=_,S=dc(!1),U=Vs.bind(null,Nn,!1,S.queue),S=fo(),P={state:h,dispatch:null,action:s,pending:null},S.queue=P,_=fs.bind(null,Nn,P,U,_),P.dispatch=_,S.memoizedState=s,[h,_,!1]}function lu(s){var h=na();return fc(h,yr,s)}function fc(s,h,_){if(h=pd(s,h,Mp)[0],s=dh(Rl)[0],typeof h=="object"&&h!==null&&typeof h.then=="function")try{var S=dd(h)}catch(le){throw le===od?ah:le}else S=h;h=na();var P=h.queue,U=P.dispatch;return _!==h.memoizedState&&(Nn.flags|=2048,ps(9,wr(),Nt.bind(null,P,_),null)),[S,U,s]}function Nt(s,h){s.action=h}function Xt(s){var h=na(),_=yr;if(_!==null)return fc(h,_,s);na(),h=h.memoizedState,_=na();var S=_.queue.dispatch;return _.memoizedState=s,[h,S,!1]}function ps(s,h,_,S){return s={tag:s,create:_,deps:S,inst:h,next:null},h=Nn.updateQueue,h===null&&(h=_f(),Nn.updateQueue=h),_=h.lastEffect,_===null?h.lastEffect=s.next=s:(S=_.next,_.next=s,s.next=S,h.lastEffect=s),s}function wr(){return{destroy:void 0,resource:void 0}}function We(){return na().memoizedState}function Oo(s,h,_,S){var P=fo();S=S===void 0?null:S,Nn.flags|=s,P.memoizedState=ps(1|h,wr(),_,S)}function pc(s,h,_,S){var P=na();S=S===void 0?null:S;var U=P.memoizedState.inst;yr!==null&&S!==null&&Wt(S,yr.memoizedState.deps)?P.memoizedState=ps(h,U,_,S):(Nn.flags|=s,P.memoizedState=ps(1|h,U,_,S))}function yd(s,h){Oo(8390656,8,s,h)}function xf(s,h){pc(2048,8,s,h)}function Cp(s,h){return pc(4,2,s,h)}function Rp(s,h){return pc(4,4,s,h)}function cu(s,h){if(typeof h=="function"){s=s();var _=h(s);return function(){typeof _=="function"?_():h(null)}}if(h!=null)return s=s(),h.current=s,function(){h.current=null}}function Bm(s,h,_){_=_!=null?_.concat([s]):null,pc(4,4,cu.bind(null,h,s),_)}function Ip(){}function Dp(s,h){var _=na();h=h===void 0?null:h;var S=_.memoizedState;return h!==null&&Wt(h,S[1])?S[0]:(_.memoizedState=[s,h],s)}function vd(s,h){var _=na();h=h===void 0?null:h;var S=_.memoizedState;if(h!==null&&Wt(h,S[1]))return S[0];if(S=s(),cl){ja(!0);try{s()}finally{ja(!1)}}return _.memoizedState=[S,h],S}function xd(s,h,_){return _===void 0||(Us&1073741824)!==0?s.memoizedState=h:(s.memoizedState=_,s=Sc(),Nn.lanes|=s,er|=s,_)}function bf(s,h,_,S){return qo(_,h)?_:ou.current!==null?(s=xd(s,_,S),qo(s,h)||(ga=!0),s):(Us&42)===0?(ga=!0,s.memoizedState=_):(s=Sc(),Nn.lanes|=s,er|=s,h)}function zp(s,h,_,S,P){var U=jt.p;jt.p=U!==0&&8>U?U:8;var le=Je.T,Ee={};Je.T=Ee,Vs(s,!1,h,_);try{var Ke=P(),Mt=Je.S;if(Mt!==null&&Mt(Ee,Ke),Ke!==null&&typeof Ke=="object"&&typeof Ke.then=="function"){var Zt=Om(Ke,S);hu(s,h,Zt,Ra(s))}else hu(s,h,S,Ra(s))}catch(oi){hu(s,h,{then:function(){},status:"rejected",reason:oi},Ra())}finally{jt.p=U,Je.T=le}}function wf(){}function uu(s,h,_,S){if(s.tag!==5)throw Error(C(476));var P=mc(s).queue;zp(s,P,h,_t,_===null?wf:function(){return Tf(s),_(S)})}function mc(s){var h=s.memoizedState;if(h!==null)return h;h={memoizedState:_t,baseState:_t,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Rl,lastRenderedState:_t},next:null};var _={};return h.next={memoizedState:_,baseState:_,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Rl,lastRenderedState:_},next:null},s.memoizedState=h,s=s.alternate,s!==null&&(s.memoizedState=h),h}function Tf(s){var h=mc(s).next.queue;hu(s,h,{},Ra())}function ul(){return da(Nf)}function ka(){return na().memoizedState}function Fm(){return na().memoizedState}function bd(s){for(var h=s.return;h!==null;){switch(h.tag){case 24:case 3:var _=Ra();s=ol(_);var S=js(h,s,_);S!==null&&(Qa(S,h,_),sh(S,h,_)),h={cache:ih()},s.payload=h;return}h=h.return}}function hr(s,h,_){var S=Ra();_={lane:S,revertLane:0,action:_,hasEagerState:!1,eagerState:null,next:null},du(s)?gc(h,_):(_=Yc(s,h,_,S),_!==null&&(Qa(_,s,S),fu(_,h,S)))}function bn(s,h,_){var S=Ra();hu(s,h,_,S)}function hu(s,h,_,S){var P={lane:S,revertLane:0,action:_,hasEagerState:!1,eagerState:null,next:null};if(du(s))gc(h,P);else{var U=s.alternate;if(s.lanes===0&&(U===null||U.lanes===0)&&(U=h.lastRenderedReducer,U!==null))try{var le=h.lastRenderedState,Ee=U(le,_);if(P.hasEagerState=!0,P.eagerState=Ee,qo(Ee,le))return Ls(s,h,P,0),Hi===null&&xl(),!1}catch{}finally{}if(_=Yc(s,h,P,S),_!==null)return Qa(_,s,S),fu(_,h,S),!0}return!1}function Vs(s,h,_,S){if(S={lane:2,revertLane:p_(),action:S,hasEagerState:!1,eagerState:null,next:null},du(s)){if(h)throw Error(C(479))}else h=Yc(s,_,S,2),h!==null&&Qa(h,s,2)}function du(s){var h=s.alternate;return s===Nn||h!==null&&h===Nn}function gc(s,h){ll=oc=!0;var _=s.pending;_===null?h.next=h:(h.next=_.next,_.next=h),s.pending=h}function fu(s,h,_){if((_&4194048)!==0){var S=h.lanes;S&=s.pendingLanes,_|=S,h.lanes=_,Bt(s,_)}}var pu={readContext:da,use:fd,useCallback:Kr,useContext:Kr,useEffect:Kr,useImperativeHandle:Kr,useLayoutEffect:Kr,useInsertionEffect:Kr,useMemo:Kr,useReducer:Kr,useRef:Kr,useState:Kr,useDebugValue:Kr,useDeferredValue:Kr,useTransition:Kr,useSyncExternalStore:Kr,useId:Kr,useHostTransitionStatus:Kr,useFormState:Kr,useActionState:Kr,useOptimistic:Kr,useMemoCache:Kr,useCacheRefresh:Kr},mu={readContext:da,use:fd,useCallback:function(s,h){return fo().memoizedState=[s,h===void 0?null:h],s},useContext:da,useEffect:yd,useImperativeHandle:function(s,h,_){_=_!=null?_.concat([s]):null,Oo(4194308,4,cu.bind(null,h,s),_)},useLayoutEffect:function(s,h){return Oo(4194308,4,s,h)},useInsertionEffect:function(s,h){Oo(4,2,s,h)},useMemo:function(s,h){var _=fo();h=h===void 0?null:h;var S=s();if(cl){ja(!0);try{s()}finally{ja(!1)}}return _.memoizedState=[S,h],S},useReducer:function(s,h,_){var S=fo();if(_!==void 0){var P=_(h);if(cl){ja(!0);try{_(h)}finally{ja(!1)}}}else P=h;return S.memoizedState=S.baseState=P,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:P},S.queue=s,s=s.dispatch=hr.bind(null,Nn,s),[S.memoizedState,s]},useRef:function(s){var h=fo();return s={current:s},h.memoizedState=s},useState:function(s){s=dc(s);var h=s.queue,_=bn.bind(null,Nn,h);return h.dispatch=_,[s.memoizedState,_]},useDebugValue:Ip,useDeferredValue:function(s,h){var _=fo();return xd(_,s,h)},useTransition:function(){var s=dc(!1);return s=zp.bind(null,Nn,s.queue,!0,!1),fo().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,h,_){var S=Nn,P=fo();if(_r){if(_===void 0)throw Error(C(407));_=_()}else{if(_=h(),Hi===null)throw Error(C(349));(wi&124)!==0||po(S,h,_)}P.memoizedState=_;var U={value:_,getSnapshot:h};return P.queue=U,yd(hc.bind(null,S,U,s),[s]),S.flags|=2048,ps(9,wr(),Il.bind(null,S,U,_,h),null),_},useId:function(){var s=fo(),h=Hi.identifierPrefix;if(_r){var _=ks,S=lo;_=(S&~(1<<32-Hr(S)-1)).toString(32)+_,h=""+h+"R"+_,_=uh++,0<_&&(h+="H"+_.toString(32)),h+=""}else _=hh++,h=""+h+"r"+_.toString(32)+"";return s.memoizedState=h},useHostTransitionStatus:ul,useFormState:Nm,useActionState:Nm,useOptimistic:function(s){var h=fo();h.memoizedState=h.baseState=s;var _={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return h.queue=_,h=Vs.bind(null,Nn,!0,_),_.dispatch=h,[s,h]},useMemoCache:Sp,useCacheRefresh:function(){return fo().memoizedState=bd.bind(null,Nn)}},Sf={readContext:da,use:fd,useCallback:Dp,useContext:da,useEffect:xf,useImperativeHandle:Bm,useInsertionEffect:Cp,useLayoutEffect:Rp,useMemo:vd,useReducer:dh,useRef:We,useState:function(){return dh(Rl)},useDebugValue:Ip,useDeferredValue:function(s,h){var _=na();return bf(_,yr.memoizedState,s,h)},useTransition:function(){var s=dh(Rl)[0],h=na().memoizedState;return[typeof s=="boolean"?s:dd(s),h]},useSyncExternalStore:yf,useId:ka,useHostTransitionStatus:ul,useFormState:lu,useActionState:lu,useOptimistic:function(s,h){var _=na();return Ep(_,yr,s,h)},useMemoCache:Sp,useCacheRefresh:Fm},Pp={readContext:da,use:fd,useCallback:Dp,useContext:da,useEffect:xf,useImperativeHandle:Bm,useInsertionEffect:Cp,useLayoutEffect:Rp,useMemo:vd,useReducer:md,useRef:We,useState:function(){return md(Rl)},useDebugValue:Ip,useDeferredValue:function(s,h){var _=na();return yr===null?xd(_,s,h):bf(_,yr.memoizedState,s,h)},useTransition:function(){var s=md(Rl)[0],h=na().memoizedState;return[typeof s=="boolean"?s:dd(s),h]},useSyncExternalStore:yf,useId:ka,useHostTransitionStatus:ul,useFormState:Xt,useActionState:Xt,useOptimistic:function(s,h){var _=na();return yr!==null?Ep(_,yr,s,h):(_.baseState=s,[s,_.queue.dispatch])},useMemoCache:Sp,useCacheRefresh:Fm},mo=null,Wo=0;function gu(s){var h=Wo;return Wo+=1,mo===null&&(mo=[]),bp(mo,s,h)}function Gs(s,h){h=h.props.ref,s.ref=h!==void 0?h:null}function zl(s,h){throw h.$$typeof===oe?Error(C(525)):(s=Object.prototype.toString.call(h),Error(C(31,s==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":s)))}function Xa(s){var h=s._init;return h(s._payload)}function Hs(s){function h(mt,st){if(s){var Et=mt.deletions;Et===null?(mt.deletions=[st],mt.flags|=16):Et.push(st)}}function _(mt,st){if(!s)return null;for(;st!==null;)h(mt,st),st=st.sibling;return null}function S(mt){for(var st=new Map;mt!==null;)mt.key!==null?st.set(mt.key,mt):st.set(mt.index,mt),mt=mt.sibling;return st}function P(mt,st){return mt=Os(mt,st),mt.index=0,mt.sibling=null,mt}function U(mt,st,Et){return mt.index=Et,s?(Et=mt.alternate,Et!==null?(Et=Et.index,Et<st?(mt.flags|=67108866,st):Et):(mt.flags|=67108866,st)):(mt.flags|=1048576,st)}function le(mt){return s&&mt.alternate===null&&(mt.flags|=67108866),mt}function Ee(mt,st,Et,Kt){return st===null||st.tag!==6?(st=pp(Et,mt.mode,Kt),st.return=mt,st):(st=P(st,Et),st.return=mt,st)}function Ke(mt,st,Et,Kt){var Ki=Et.type;return Ki===Ie?Zt(mt,st,Et.props.children,Kt,Et.key):st!==null&&(st.elementType===Ki||typeof Ki=="object"&&Ki!==null&&Ki.$$typeof===vt&&Xa(Ki)===st.type)?(st=P(st,Et.props),Gs(st,Et),st.return=mt,st):(st=uf(Et.type,Et.key,Et.props,null,mt.mode,Kt),Gs(st,Et),st.return=mt,st)}function Mt(mt,st,Et,Kt){return st===null||st.tag!==4||st.stateNode.containerInfo!==Et.containerInfo||st.stateNode.implementation!==Et.implementation?(st=hf(Et,mt.mode,Kt),st.return=mt,st):(st=P(st,Et.children||[]),st.return=mt,st)}function Zt(mt,st,Et,Kt,Ki){return st===null||st.tag!==7?(st=Qc(Et,mt.mode,Kt,Ki),st.return=mt,st):(st=P(st,Et),st.return=mt,st)}function oi(mt,st,Et){if(typeof st=="string"&&st!==""||typeof st=="number"||typeof st=="bigint")return st=pp(""+st,mt.mode,Et),st.return=mt,st;if(typeof st=="object"&&st!==null){switch(st.$$typeof){case fe:return Et=uf(st.type,st.key,st.props,null,mt.mode,Et),Gs(Et,st),Et.return=mt,Et;case Re:return st=hf(st,mt.mode,Et),st.return=mt,st;case vt:var Kt=st._init;return st=Kt(st._payload),oi(mt,st,Et)}if(yi(st)||Fi(st))return st=Qc(st,mt.mode,Et,null),st.return=mt,st;if(typeof st.then=="function")return oi(mt,gu(st),Et);if(st.$$typeof===je)return oi(mt,Al(mt,st),Et);zl(mt,st)}return null}function Lt(mt,st,Et,Kt){var Ki=st!==null?st.key:null;if(typeof Et=="string"&&Et!==""||typeof Et=="number"||typeof Et=="bigint")return Ki!==null?null:Ee(mt,st,""+Et,Kt);if(typeof Et=="object"&&Et!==null){switch(Et.$$typeof){case fe:return Et.key===Ki?Ke(mt,st,Et,Kt):null;case Re:return Et.key===Ki?Mt(mt,st,Et,Kt):null;case vt:return Ki=Et._init,Et=Ki(Et._payload),Lt(mt,st,Et,Kt)}if(yi(Et)||Fi(Et))return Ki!==null?null:Zt(mt,st,Et,Kt,null);if(typeof Et.then=="function")return Lt(mt,st,gu(Et),Kt);if(Et.$$typeof===je)return Lt(mt,st,Al(mt,Et),Kt);zl(mt,Et)}return null}function kt(mt,st,Et,Kt,Ki){if(typeof Kt=="string"&&Kt!==""||typeof Kt=="number"||typeof Kt=="bigint")return mt=mt.get(Et)||null,Ee(st,mt,""+Kt,Ki);if(typeof Kt=="object"&&Kt!==null){switch(Kt.$$typeof){case fe:return mt=mt.get(Kt.key===null?Et:Kt.key)||null,Ke(st,mt,Kt,Ki);case Re:return mt=mt.get(Kt.key===null?Et:Kt.key)||null,Mt(st,mt,Kt,Ki);case vt:var nr=Kt._init;return Kt=nr(Kt._payload),kt(mt,st,Et,Kt,Ki)}if(yi(Kt)||Fi(Kt))return mt=mt.get(Et)||null,Zt(st,mt,Kt,Ki,null);if(typeof Kt.then=="function")return kt(mt,st,Et,gu(Kt),Ki);if(Kt.$$typeof===je)return kt(mt,st,Et,Al(st,Kt),Ki);zl(st,Kt)}return null}function Ln(mt,st,Et,Kt){for(var Ki=null,nr=null,un=st,Mn=st=0,Ba=null;un!==null&&Mn<Et.length;Mn++){un.index>Mn?(Ba=un,un=null):Ba=un.sibling;var Mr=Lt(mt,un,Et[Mn],Kt);if(Mr===null){un===null&&(un=Ba);break}s&&un&&Mr.alternate===null&&h(mt,un),st=U(Mr,st,Mn),nr===null?Ki=Mr:nr.sibling=Mr,nr=Mr,un=Ba}if(Mn===Et.length)return _(mt,un),_r&&ec(mt,Mn),Ki;if(un===null){for(;Mn<Et.length;Mn++)un=oi(mt,Et[Mn],Kt),un!==null&&(st=U(un,st,Mn),nr===null?Ki=un:nr.sibling=un,nr=un);return _r&&ec(mt,Mn),Ki}for(un=S(un);Mn<Et.length;Mn++)Ba=kt(un,mt,Mn,Et[Mn],Kt),Ba!==null&&(s&&Ba.alternate!==null&&un.delete(Ba.key===null?Mn:Ba.key),st=U(Ba,st,Mn),nr===null?Ki=Ba:nr.sibling=Ba,nr=Ba);return s&&un.forEach(function(Cc){return h(mt,Cc)}),_r&&ec(mt,Mn),Ki}function An(mt,st,Et,Kt){if(Et==null)throw Error(C(151));for(var Ki=null,nr=null,un=st,Mn=st=0,Ba=null,Mr=Et.next();un!==null&&!Mr.done;Mn++,Mr=Et.next()){un.index>Mn?(Ba=un,un=null):Ba=un.sibling;var Cc=Lt(mt,un,Mr.value,Kt);if(Cc===null){un===null&&(un=Ba);break}s&&un&&Cc.alternate===null&&h(mt,un),st=U(Cc,st,Mn),nr===null?Ki=Cc:nr.sibling=Cc,nr=Cc,un=Ba}if(Mr.done)return _(mt,un),_r&&ec(mt,Mn),Ki;if(un===null){for(;!Mr.done;Mn++,Mr=Et.next())Mr=oi(mt,Mr.value,Kt),Mr!==null&&(st=U(Mr,st,Mn),nr===null?Ki=Mr:nr.sibling=Mr,nr=Mr);return _r&&ec(mt,Mn),Ki}for(un=S(un);!Mr.done;Mn++,Mr=Et.next())Mr=kt(un,mt,Mn,Mr.value,Kt),Mr!==null&&(s&&Mr.alternate!==null&&un.delete(Mr.key===null?Mn:Mr.key),st=U(Mr,st,Mn),nr===null?Ki=Mr:nr.sibling=Mr,nr=Mr);return s&&un.forEach(function(fv){return h(mt,fv)}),_r&&ec(mt,Mn),Ki}function Zr(mt,st,Et,Kt){if(typeof Et=="object"&&Et!==null&&Et.type===Ie&&Et.key===null&&(Et=Et.props.children),typeof Et=="object"&&Et!==null){switch(Et.$$typeof){case fe:e:{for(var Ki=Et.key;st!==null;){if(st.key===Ki){if(Ki=Et.type,Ki===Ie){if(st.tag===7){_(mt,st.sibling),Kt=P(st,Et.props.children),Kt.return=mt,mt=Kt;break e}}else if(st.elementType===Ki||typeof Ki=="object"&&Ki!==null&&Ki.$$typeof===vt&&Xa(Ki)===st.type){_(mt,st.sibling),Kt=P(st,Et.props),Gs(Kt,Et),Kt.return=mt,mt=Kt;break e}_(mt,st);break}else h(mt,st);st=st.sibling}Et.type===Ie?(Kt=Qc(Et.props.children,mt.mode,Kt,Et.key),Kt.return=mt,mt=Kt):(Kt=uf(Et.type,Et.key,Et.props,null,mt.mode,Kt),Gs(Kt,Et),Kt.return=mt,mt=Kt)}return le(mt);case Re:e:{for(Ki=Et.key;st!==null;){if(st.key===Ki)if(st.tag===4&&st.stateNode.containerInfo===Et.containerInfo&&st.stateNode.implementation===Et.implementation){_(mt,st.sibling),Kt=P(st,Et.children||[]),Kt.return=mt,mt=Kt;break e}else{_(mt,st);break}else h(mt,st);st=st.sibling}Kt=hf(Et,mt.mode,Kt),Kt.return=mt,mt=Kt}return le(mt);case vt:return Ki=Et._init,Et=Ki(Et._payload),Zr(mt,st,Et,Kt)}if(yi(Et))return Ln(mt,st,Et,Kt);if(Fi(Et)){if(Ki=Fi(Et),typeof Ki!="function")throw Error(C(150));return Et=Ki.call(Et),An(mt,st,Et,Kt)}if(typeof Et.then=="function")return Zr(mt,st,gu(Et),Kt);if(Et.$$typeof===je)return Zr(mt,st,Al(mt,Et),Kt);zl(mt,Et)}return typeof Et=="string"&&Et!==""||typeof Et=="number"||typeof Et=="bigint"?(Et=""+Et,st!==null&&st.tag===6?(_(mt,st.sibling),Kt=P(st,Et),Kt.return=mt,mt=Kt):(_(mt,st),Kt=pp(Et,mt.mode,Kt),Kt.return=mt,mt=Kt),le(mt)):_(mt,st)}return function(mt,st,Et,Kt){try{Wo=0;var Ki=Zr(mt,st,Et,Kt);return mo=null,Ki}catch(un){if(un===od||un===ah)throw un;var nr=Po(29,un,null,mt.mode);return nr.lanes=Kt,nr.return=mt,nr}finally{}}}var _c=Hs(!0),Pl=Hs(!1),ko=zt(null),Yo=null;function ms(s){var h=s.alternate;Jt(fa,fa.current&1),Jt(ko,s),Yo===null&&(h===null||ou.current!==null||h.memoizedState!==null)&&(Yo=s)}function Ef(s){if(s.tag===22){if(Jt(fa,fa.current),Jt(ko,s),Yo===null){var h=s.alternate;h!==null&&h.memoizedState!==null&&(Yo=s)}}else Pr()}function Pr(){Jt(fa,fa.current),Jt(ko,ko.current)}function qs(s){_i(ko),Yo===s&&(Yo=null),_i(fa)}var fa=zt(0);function $s(s){for(var h=s;h!==null;){if(h.tag===13){var _=h.memoizedState;if(_!==null&&(_=_.dehydrated,_===null||_.data==="$?"||v_(_)))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if((h.flags&128)!==0)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===s)break;for(;h.sibling===null;){if(h.return===null||h.return===s)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}function _u(s,h,_,S){h=s.memoizedState,_=_(S,h),_=_==null?h:ie({},h,_),s.memoizedState=_,s.lanes===0&&(s.updateQueue.baseState=_)}var wd={enqueueSetState:function(s,h,_){s=s._reactInternals;var S=Ra(),P=ol(S);P.payload=h,_!=null&&(P.callback=_),h=js(s,P,S),h!==null&&(Qa(h,s,S),sh(h,s,S))},enqueueReplaceState:function(s,h,_){s=s._reactInternals;var S=Ra(),P=ol(S);P.tag=1,P.payload=h,_!=null&&(P.callback=_),h=js(s,P,S),h!==null&&(Qa(h,s,S),sh(h,s,S))},enqueueForceUpdate:function(s,h){s=s._reactInternals;var _=Ra(),S=ol(_);S.tag=2,h!=null&&(S.callback=h),h=js(s,S,_),h!==null&&(Qa(h,s,_),sh(h,s,_))}};function Td(s,h,_,S,P,U,le){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(S,U,le):h.prototype&&h.prototype.isPureReactComponent?!$o(_,S)||!$o(P,U):!0}function yc(s,h,_,S){s=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(_,S),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(_,S),h.state!==s&&wd.enqueueReplaceState(h,h.state,null)}function Ll(s,h){var _=h;if("ref"in h){_={};for(var S in h)S!=="ref"&&(_[S]=h[S])}if(s=s.defaultProps){_===h&&(_=ie({},_));for(var P in s)_[P]===void 0&&(_[P]=s[P])}return _}var vc=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var h=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(h))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)};function yu(s){vc(s)}function ph(s){console.error(s)}function Af(s){vc(s)}function vu(s,h){try{var _=s.onUncaughtError;_(h.value,{componentStack:h.stack})}catch(S){setTimeout(function(){throw S})}}function Lp(s,h,_){try{var S=s.onCaughtError;S(_.value,{componentStack:_.stack,errorBoundary:h.tag===1?h.stateNode:null})}catch(P){setTimeout(function(){throw P})}}function mh(s,h,_){return _=ol(_),_.tag=3,_.payload={element:null},_.callback=function(){vu(s,h)},_}function Op(s){return s=ol(s),s.tag=3,s}function kp(s,h,_,S){var P=_.type.getDerivedStateFromError;if(typeof P=="function"){var U=S.value;s.payload=function(){return P(U)},s.callback=function(){Lp(h,_,S)}}var le=_.stateNode;le!==null&&typeof le.componentDidCatch=="function"&&(s.callback=function(){Lp(h,_,S),typeof P!="function"&&(Ur===null?Ur=new Set([this]):Ur.add(this));var Ee=S.stack;this.componentDidCatch(S.value,{componentStack:Ee!==null?Ee:""})})}function jm(s,h,_,S,P){if(_.flags|=32768,S!==null&&typeof S=="object"&&typeof S.then=="function"){if(h=_.alternate,h!==null&&iu(h,_,P,!0),_=ko.current,_!==null){switch(_.tag){case 13:return Yo===null?Bl():_.alternate===null&&Pn===0&&(Pn=3),_.flags&=-257,_.flags|=65536,_.lanes=P,S===au?_.flags|=16384:(h=_.updateQueue,h===null?_.updateQueue=new Set([S]):h.add(S),u_(s,S,P)),!1;case 22:return _.flags|=65536,S===au?_.flags|=16384:(h=_.updateQueue,h===null?(h={transitions:null,markerInstances:null,retryQueue:new Set([S])},_.updateQueue=h):(_=h.retryQueue,_===null?h.retryQueue=new Set([S]):_.add(S)),u_(s,S,P)),!1}throw Error(C(435,_.tag))}return u_(s,S,P),Bl(),!1}if(_r)return h=ko.current,h!==null?((h.flags&65536)===0&&(h.flags|=256),h.flags|=65536,h.lanes=P,S!==ed&&(s=Error(C(422),{cause:S}),eh(oo(s,_)))):(S!==ed&&(h=Error(C(423),{cause:S}),eh(oo(h,_))),s=s.current.alternate,s.flags|=65536,P&=-P,s.lanes|=P,S=oo(S,_),P=mh(s.stateNode,S,P),ld(s,P),Pn!==4&&(Pn=2)),!1;var U=Error(C(520),{cause:S});if(U=oo(U,_),mn===null?mn=[U]:mn.push(U),Pn!==4&&(Pn=2),h===null)return!0;S=oo(S,_),_=h;do{switch(_.tag){case 3:return _.flags|=65536,s=P&-P,_.lanes|=s,s=mh(_.stateNode,S,s),ld(_,s),!1;case 1:if(h=_.type,U=_.stateNode,(_.flags&128)===0&&(typeof h.getDerivedStateFromError=="function"||U!==null&&typeof U.componentDidCatch=="function"&&(Ur===null||!Ur.has(U))))return _.flags|=65536,P&=-P,_.lanes|=P,P=Op(P),kp(P,s,_,S),ld(_,P),!1}_=_.return}while(_!==null);return!1}var Np=Error(C(461)),ga=!1;function Ma(s,h,_,S){h.child=s===null?Pl(h,null,_,S):_c(h,s.child,_,S)}function Bp(s,h,_,S,P){_=_.render;var U=h.ref;if("ref"in S){var le={};for(var Ee in S)Ee!=="ref"&&(le[Ee]=S[Ee])}else le=S;return ds(h),S=su(s,h,_,le,U,P),Ee=Si(),s!==null&&!ga?(hd(s,h,P),Ko(s,h,P)):(_r&&Ee&&eu(h),h.flags|=1,Ma(s,h,S,P),h.child)}function Fp(s,h,_,S,P){if(s===null){var U=_.type;return typeof U=="function"&&!Qh(U)&&U.defaultProps===void 0&&_.compare===null?(h.tag=15,h.type=U,jp(s,h,U,S,P)):(s=uf(_.type,null,S,h,h.mode,P),s.ref=h.ref,s.return=h,h.child=s)}if(U=s.child,!_h(s,P)){var le=U.memoizedProps;if(_=_.compare,_=_!==null?_:$o,_(le,S)&&s.ref===h.ref)return Ko(s,h,P)}return h.flags|=1,s=Os(U,S),s.ref=h.ref,s.return=h,h.child=s}function jp(s,h,_,S,P){if(s!==null){var U=s.memoizedProps;if($o(U,S)&&s.ref===h.ref)if(ga=!1,h.pendingProps=S=U,_h(s,P))(s.flags&131072)!==0&&(ga=!0);else return h.lanes=s.lanes,Ko(s,h,P)}return Gp(s,h,_,S,P)}function Up(s,h,_){var S=h.pendingProps,P=S.children,U=s!==null?s.memoizedState:null;if(S.mode==="hidden"){if((h.flags&128)!==0){if(S=U!==null?U.baseLanes|_:_,s!==null){for(P=h.child=s.child,U=0;P!==null;)U=U|P.lanes|P.childLanes,P=P.sibling;h.childLanes=U&~S}else h.childLanes=0,h.child=null;return Vp(s,h,S,_)}if((_&536870912)!==0)h.memoizedState={baseLanes:0,cachePool:null},s!==null&&ad(h,U!==null?U.cachePool:null),U!==null?sl(h,U):wp(),Ef(h);else return h.lanes=h.childLanes=536870912,Vp(s,h,U!==null?U.baseLanes|_:_,_)}else U!==null?(ad(h,U.cachePool),sl(h,U),Pr(),h.memoizedState=null):(s!==null&&ad(h,null),wp(),Pr());return Ma(s,h,P,_),h.child}function Vp(s,h,_,S){var P=yp();return P=P===null?null:{parent:ca._currentValue,pool:P},h.memoizedState={baseLanes:_,cachePool:P},s!==null&&ad(h,null),wp(),Ef(h),s!==null&&iu(s,h,S,!0),null}function Mf(s,h){var _=h.ref;if(_===null)s!==null&&s.ref!==null&&(h.flags|=4194816);else{if(typeof _!="function"&&typeof _!="object")throw Error(C(284));(s===null||s.ref!==_)&&(h.flags|=4194816)}}function Gp(s,h,_,S,P){return ds(h),_=su(s,h,_,S,void 0,P),S=Si(),s!==null&&!ga?(hd(s,h,P),Ko(s,h,P)):(_r&&S&&eu(h),h.flags|=1,Ma(s,h,_,P),h.child)}function vr(s,h,_,S,P,U){return ds(h),h.updateQueue=null,_=Cl(h,S,_,P),cc(s),S=Si(),s!==null&&!ga?(hd(s,h,U),Ko(s,h,U)):(_r&&S&&eu(h),h.flags|=1,Ma(s,h,_,U),h.child)}function Hp(s,h,_,S,P){if(ds(h),h.stateNode===null){var U=Jl,le=_.contextType;typeof le=="object"&&le!==null&&(U=da(le)),U=new _(S,U),h.memoizedState=U.state!==null&&U.state!==void 0?U.state:null,U.updater=wd,h.stateNode=U,U._reactInternals=h,U=h.stateNode,U.props=S,U.state=h.memoizedState,U.refs={},mf(h),le=_.contextType,U.context=typeof le=="object"&&le!==null?da(le):Jl,U.state=h.memoizedState,le=_.getDerivedStateFromProps,typeof le=="function"&&(_u(h,_,le,S),U.state=h.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof U.getSnapshotBeforeUpdate=="function"||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(le=U.state,typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount(),le!==U.state&&wd.enqueueReplaceState(U,U.state,null),ch(h,S,U,P),rc(),U.state=h.memoizedState),typeof U.componentDidMount=="function"&&(h.flags|=4194308),S=!0}else if(s===null){U=h.stateNode;var Ee=h.memoizedProps,Ke=Ll(_,Ee);U.props=Ke;var Mt=U.context,Zt=_.contextType;le=Jl,typeof Zt=="object"&&Zt!==null&&(le=da(Zt));var oi=_.getDerivedStateFromProps;Zt=typeof oi=="function"||typeof U.getSnapshotBeforeUpdate=="function",Ee=h.pendingProps!==Ee,Zt||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(Ee||Mt!==le)&&yc(h,U,S,le),uo=!1;var Lt=h.memoizedState;U.state=Lt,ch(h,S,U,P),rc(),Mt=h.memoizedState,Ee||Lt!==Mt||uo?(typeof oi=="function"&&(_u(h,_,oi,S),Mt=h.memoizedState),(Ke=uo||Td(h,_,Ke,S,Lt,Mt,le))?(Zt||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount()),typeof U.componentDidMount=="function"&&(h.flags|=4194308)):(typeof U.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=S,h.memoizedState=Mt),U.props=S,U.state=Mt,U.context=le,S=Ke):(typeof U.componentDidMount=="function"&&(h.flags|=4194308),S=!1)}else{U=h.stateNode,ho(s,h),le=h.memoizedProps,Zt=Ll(_,le),U.props=Zt,oi=h.pendingProps,Lt=U.context,Mt=_.contextType,Ke=Jl,typeof Mt=="object"&&Mt!==null&&(Ke=da(Mt)),Ee=_.getDerivedStateFromProps,(Mt=typeof Ee=="function"||typeof U.getSnapshotBeforeUpdate=="function")||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(le!==oi||Lt!==Ke)&&yc(h,U,S,Ke),uo=!1,Lt=h.memoizedState,U.state=Lt,ch(h,S,U,P),rc();var kt=h.memoizedState;le!==oi||Lt!==kt||uo||s!==null&&s.dependencies!==null&&th(s.dependencies)?(typeof Ee=="function"&&(_u(h,_,Ee,S),kt=h.memoizedState),(Zt=uo||Td(h,_,Zt,S,Lt,kt,Ke)||s!==null&&s.dependencies!==null&&th(s.dependencies))?(Mt||typeof U.UNSAFE_componentWillUpdate!="function"&&typeof U.componentWillUpdate!="function"||(typeof U.componentWillUpdate=="function"&&U.componentWillUpdate(S,kt,Ke),typeof U.UNSAFE_componentWillUpdate=="function"&&U.UNSAFE_componentWillUpdate(S,kt,Ke)),typeof U.componentDidUpdate=="function"&&(h.flags|=4),typeof U.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof U.componentDidUpdate!="function"||le===s.memoizedProps&&Lt===s.memoizedState||(h.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||le===s.memoizedProps&&Lt===s.memoizedState||(h.flags|=1024),h.memoizedProps=S,h.memoizedState=kt),U.props=S,U.state=kt,U.context=Ke,S=Zt):(typeof U.componentDidUpdate!="function"||le===s.memoizedProps&&Lt===s.memoizedState||(h.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||le===s.memoizedProps&&Lt===s.memoizedState||(h.flags|=1024),S=!1)}return U=S,Mf(s,h),S=(h.flags&128)!==0,U||S?(U=h.stateNode,_=S&&typeof _.getDerivedStateFromError!="function"?null:U.render(),h.flags|=1,s!==null&&S?(h.child=_c(h,s.child,null,P),h.child=_c(h,null,_,P)):Ma(s,h,_,P),h.memoizedState=U.state,s=h.child):s=Ko(s,h,P),s}function Um(s,h,_,S){return Ju(),h.flags|=256,Ma(s,h,_,S),h.child}var xc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function qp(s){return{baseLanes:s,cachePool:vp()}}function bc(s,h,_){return s=s!==null?s.childLanes&~_:0,h&&(s|=ki),s}function $p(s,h,_){var S=h.pendingProps,P=!1,U=(h.flags&128)!==0,le;if((le=U)||(le=s!==null&&s.memoizedState===null?!1:(fa.current&2)!==0),le&&(P=!0,h.flags&=-129),le=(h.flags&32)!==0,h.flags&=-33,s===null){if(_r){if(P?ms(h):Pr(),_r){var Ee=Fr,Ke;if(Ke=Ee){e:{for(Ke=Ee,Ee=Ns;Ke.nodeType!==8;){if(!Ee){Ee=null;break e}if(Ke=jl(Ke.nextSibling),Ke===null){Ee=null;break e}}Ee=Ke}Ee!==null?(h.memoizedState={dehydrated:Ee,treeContext:wl!==null?{id:lo,overflow:ks}:null,retryLane:536870912,hydrationErrors:null},Ke=Po(18,null,null,0),Ke.stateNode=Ee,Ke.return=h,h.child=Ke,Aa=h,Fr=null,Ke=!0):Ke=!1}Ke||rl(h)}if(Ee=h.memoizedState,Ee!==null&&(Ee=Ee.dehydrated,Ee!==null))return v_(Ee)?h.lanes=32:h.lanes=536870912,null;qs(h)}return Ee=S.children,S=S.fallback,P?(Pr(),P=h.mode,Ee=wc({mode:"hidden",children:Ee},P),S=Qc(S,P,_,null),Ee.return=h,S.return=h,Ee.sibling=S,h.child=Ee,P=h.child,P.memoizedState=qp(_),P.childLanes=bc(s,le,_),h.memoizedState=xc,S):(ms(h),gh(h,Ee))}if(Ke=s.memoizedState,Ke!==null&&(Ee=Ke.dehydrated,Ee!==null)){if(U)h.flags&256?(ms(h),h.flags&=-257,h=gs(s,h,_)):h.memoizedState!==null?(Pr(),h.child=s.child,h.flags|=128,h=null):(Pr(),P=S.fallback,Ee=h.mode,S=wc({mode:"visible",children:S.children},Ee),P=Qc(P,Ee,_,null),P.flags|=2,S.return=h,P.return=h,S.sibling=P,h.child=S,_c(h,s.child,null,_),S=h.child,S.memoizedState=qp(_),S.childLanes=bc(s,le,_),h.memoizedState=xc,h=P);else if(ms(h),v_(Ee)){if(le=Ee.nextSibling&&Ee.nextSibling.dataset,le)var Mt=le.dgst;le=Mt,S=Error(C(419)),S.stack="",S.digest=le,eh({value:S,source:null,stack:null}),h=gs(s,h,_)}else if(ga||iu(s,h,_,!1),le=(_&s.childLanes)!==0,ga||le){if(le=Hi,le!==null&&(S=_&-_,S=(S&42)!==0?1:Go(S),S=(S&(le.suspendedLanes|_))!==0?0:S,S!==0&&S!==Ke.retryLane))throw Ke.retryLane=S,hs(s,S),Qa(le,s,S),Np;Ee.data==="$?"||Bl(),h=gs(s,h,_)}else Ee.data==="$?"?(h.flags|=192,h.child=s.child,h=null):(s=Ke.treeContext,Fr=jl(Ee.nextSibling),Aa=h,_r=!0,Tl=null,Ns=!1,s!==null&&(Lo[so++]=lo,Lo[so++]=ks,Lo[so++]=wl,lo=s.id,ks=s.overflow,wl=h),h=gh(h,S.children),h.flags|=4096);return h}return P?(Pr(),P=S.fallback,Ee=h.mode,Ke=s.child,Mt=Ke.sibling,S=Os(Ke,{mode:"hidden",children:S.children}),S.subtreeFlags=Ke.subtreeFlags&65011712,Mt!==null?P=Os(Mt,P):(P=Qc(P,Ee,_,null),P.flags|=2),P.return=h,S.return=h,S.sibling=P,h.child=S,S=P,P=h.child,Ee=s.child.memoizedState,Ee===null?Ee=qp(_):(Ke=Ee.cachePool,Ke!==null?(Mt=ca._currentValue,Ke=Ke.parent!==Mt?{parent:Mt,pool:Mt}:Ke):Ke=vp(),Ee={baseLanes:Ee.baseLanes|_,cachePool:Ke}),P.memoizedState=Ee,P.childLanes=bc(s,le,_),h.memoizedState=xc,S):(ms(h),_=s.child,s=_.sibling,_=Os(_,{mode:"visible",children:S.children}),_.return=h,_.sibling=null,s!==null&&(le=h.deletions,le===null?(h.deletions=[s],h.flags|=16):le.push(s)),h.child=_,h.memoizedState=null,_)}function gh(s,h){return h=wc({mode:"visible",children:h},s.mode),h.return=s,s.child=h}function wc(s,h){return s=Po(22,s,null,h),s.lanes=0,s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},s}function gs(s,h,_){return _c(h,s.child,null,_),s=gh(h,h.pendingProps.children),s.flags|=2,h.memoizedState=null,s}function Sd(s,h,_){s.lanes|=h;var S=s.alternate;S!==null&&(S.lanes|=h),td(s.return,h,_)}function Lr(s,h,_,S,P){var U=s.memoizedState;U===null?s.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:S,tail:_,tailMode:P}:(U.isBackwards=h,U.rendering=null,U.renderingStartTime=0,U.last=S,U.tail=_,U.tailMode=P)}function _s(s,h,_){var S=h.pendingProps,P=S.revealOrder,U=S.tail;if(Ma(s,h,S.children,_),S=fa.current,(S&2)!==0)S=S&1|2,h.flags|=128;else{if(s!==null&&(s.flags&128)!==0)e:for(s=h.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Sd(s,_,h);else if(s.tag===19)Sd(s,_,h);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===h)break e;for(;s.sibling===null;){if(s.return===null||s.return===h)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}S&=1}switch(Jt(fa,S),P){case"forwards":for(_=h.child,P=null;_!==null;)s=_.alternate,s!==null&&$s(s)===null&&(P=_),_=_.sibling;_=P,_===null?(P=h.child,h.child=null):(P=_.sibling,_.sibling=null),Lr(h,!1,P,_,U);break;case"backwards":for(_=null,P=h.child,h.child=null;P!==null;){if(s=P.alternate,s!==null&&$s(s)===null){h.child=P;break}s=P.sibling,P.sibling=_,_=P,P=s}Lr(h,!0,_,null,U);break;case"together":Lr(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function Ko(s,h,_){if(s!==null&&(h.dependencies=s.dependencies),er|=h.lanes,(_&h.childLanes)===0)if(s!==null){if(iu(s,h,_,!1),(_&h.childLanes)===0)return null}else return null;if(s!==null&&h.child!==s.child)throw Error(C(153));if(h.child!==null){for(s=h.child,_=Os(s,s.pendingProps),h.child=_,_.return=h;s.sibling!==null;)s=s.sibling,_=_.sibling=Os(s,s.pendingProps),_.return=h;_.sibling=null}return h.child}function _h(s,h){return(s.lanes&h)!==0?!0:(s=s.dependencies,!!(s!==null&&th(s)))}function Vm(s,h,_){switch(h.tag){case 3:Yi(h,h.stateNode.containerInfo),Bs(h,ca,s.memoizedState.cache),Ju();break;case 27:case 5:rn(h);break;case 4:Yi(h,h.stateNode.containerInfo);break;case 10:Bs(h,h.type,h.memoizedProps.value);break;case 13:var S=h.memoizedState;if(S!==null)return S.dehydrated!==null?(ms(h),h.flags|=128,null):(_&h.child.childLanes)!==0?$p(s,h,_):(ms(h),s=Ko(s,h,_),s!==null?s.sibling:null);ms(h);break;case 19:var P=(s.flags&128)!==0;if(S=(_&h.childLanes)!==0,S||(iu(s,h,_,!1),S=(_&h.childLanes)!==0),P){if(S)return _s(s,h,_);h.flags|=128}if(P=h.memoizedState,P!==null&&(P.rendering=null,P.tail=null,P.lastEffect=null),Jt(fa,fa.current),S)break;return null;case 22:case 23:return h.lanes=0,Up(s,h,_);case 24:Bs(h,ca,s.memoizedState.cache)}return Ko(s,h,_)}function Gm(s,h,_){if(s!==null)if(s.memoizedProps!==h.pendingProps)ga=!0;else{if(!_h(s,_)&&(h.flags&128)===0)return ga=!1,Vm(s,h,_);ga=(s.flags&131072)!==0}else ga=!1,_r&&(h.flags&1048576)!==0&&Jc(h,Jh,h.index);switch(h.lanes=0,h.tag){case 16:e:{s=h.pendingProps;var S=h.elementType,P=S._init;if(S=P(S._payload),h.type=S,typeof S=="function")Qh(S)?(s=Ll(S,s),h.tag=1,h=Hp(null,h,S,s,_)):(h.tag=0,h=Gp(null,h,S,s,_));else{if(S!=null){if(P=S.$$typeof,P===at){h.tag=11,h=Bp(null,h,S,s,_);break e}else if(P===Tt){h.tag=14,h=Fp(null,h,S,s,_);break e}}throw h=fi(S)||S,Error(C(306,h,""))}}return h;case 0:return Gp(s,h,h.type,h.pendingProps,_);case 1:return S=h.type,P=Ll(S,h.pendingProps),Hp(s,h,S,P,_);case 3:e:{if(Yi(h,h.stateNode.containerInfo),s===null)throw Error(C(387));S=h.pendingProps;var U=h.memoizedState;P=U.element,ho(s,h),ch(h,S,null,_);var le=h.memoizedState;if(S=le.cache,Bs(h,ca,S),S!==U.cache&&id(h,[ca],_,!0),rc(),S=le.element,U.isDehydrated)if(U={element:S,isDehydrated:!1,cache:le.cache},h.updateQueue.baseState=U,h.memoizedState=U,h.flags&256){h=Um(s,h,S,_);break e}else if(S!==P){P=oo(Error(C(424)),h),eh(P),h=Um(s,h,S,_);break e}else{switch(s=h.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(Fr=jl(s.firstChild),Aa=h,_r=!0,Tl=null,Ns=!0,_=Pl(h,null,S,_),h.child=_;_;)_.flags=_.flags&-3|4096,_=_.sibling}else{if(Ju(),S===P){h=Ko(s,h,_);break e}Ma(s,h,S,_)}h=h.child}return h;case 26:return Mf(s,h),s===null?(_=hg(h.type,null,h.pendingProps,null))?h.memoizedState=_:_r||(_=h.type,s=h.pendingProps,S=Pf(pi.current).createElement(_),S[ae]=h,S[ye]=s,Na(S,_,s),mi(S),h.stateNode=S):h.memoizedState=hg(h.type,s.memoizedProps,h.pendingProps,s.memoizedState),null;case 27:return rn(h),s===null&&_r&&(S=h.stateNode=b_(h.type,h.pendingProps,pi.current),Aa=h,Ns=!0,P=Fr,Su(h.type)?(x_=P,Fr=jl(S.firstChild)):Fr=P),Ma(s,h,h.pendingProps.children,_),Mf(s,h),s===null&&(h.flags|=4194304),h.child;case 5:return s===null&&_r&&((P=S=Fr)&&(S=kd(S,h.type,h.pendingProps,Ns),S!==null?(h.stateNode=S,Aa=h,Fr=jl(S.firstChild),Ns=!1,P=!0):P=!1),P||rl(h)),rn(h),P=h.type,U=h.pendingProps,le=s!==null?s.memoizedProps:null,S=U.children,sg(P,U)?S=null:le!==null&&sg(P,le)&&(h.flags|=32),h.memoizedState!==null&&(P=su(s,h,uc,null,null,_),Nf._currentValue=P),Mf(s,h),Ma(s,h,S,_),h.child;case 6:return s===null&&_r&&((s=_=Fr)&&(_=Ky(_,h.pendingProps,Ns),_!==null?(h.stateNode=_,Aa=h,Fr=null,s=!0):s=!1),s||rl(h)),null;case 13:return $p(s,h,_);case 4:return Yi(h,h.stateNode.containerInfo),S=h.pendingProps,s===null?h.child=_c(h,null,S,_):Ma(s,h,S,_),h.child;case 11:return Bp(s,h,h.type,h.pendingProps,_);case 7:return Ma(s,h,h.pendingProps,_),h.child;case 8:return Ma(s,h,h.pendingProps.children,_),h.child;case 12:return Ma(s,h,h.pendingProps.children,_),h.child;case 10:return S=h.pendingProps,Bs(h,h.type,S.value),Ma(s,h,S.children,_),h.child;case 9:return P=h.type._context,S=h.pendingProps.children,ds(h),P=da(P),S=S(P),h.flags|=1,Ma(s,h,S,_),h.child;case 14:return Fp(s,h,h.type,h.pendingProps,_);case 15:return jp(s,h,h.type,h.pendingProps,_);case 19:return _s(s,h,_);case 31:return S=h.pendingProps,_=h.mode,S={mode:S.mode,children:S.children},s===null?(_=wc(S,_),_.ref=h.ref,h.child=_,_.return=h,h=_):(_=Os(s.child,S),_.ref=h.ref,h.child=_,_.return=h,h=_),h;case 22:return Up(s,h,_);case 24:return ds(h),S=da(ca),s===null?(P=yp(),P===null&&(P=Hi,U=ih(),P.pooledCache=U,U.refCount++,U!==null&&(P.pooledCacheLanes|=_),P=U),h.memoizedState={parent:S,cache:P},mf(h),Bs(h,ca,P)):((s.lanes&_)!==0&&(ho(s,h),ch(h,null,null,_),rc()),P=s.memoizedState,U=h.memoizedState,P.parent!==S?(P={parent:S,cache:S},h.memoizedState=P,h.lanes===0&&(h.memoizedState=h.updateQueue.baseState=P),Bs(h,ca,S)):(S=U.cache,Bs(h,ca,S),S!==P.cache&&id(h,[ca],_,!0))),Ma(s,h,h.pendingProps.children,_),h.child;case 29:throw h.pendingProps}throw Error(C(156,h.tag))}function Qo(s){s.flags|=4}function Zp(s,h){if(h.type!=="stylesheet"||(h.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!rm(h)){if(h=ko.current,h!==null&&((wi&4194048)===wi?Yo!==null:(wi&62914560)!==wi&&(wi&536870912)===0||h!==Yo))throw oh=au,km;s.flags|=8192}}function yh(s,h){h!==null&&(s.flags|=4),s.flags&16384&&(h=s.tag!==22?fl():536870912,s.lanes|=h,$n|=h)}function Wa(s,h){if(!_r)switch(s.tailMode){case"hidden":h=s.tail;for(var _=null;h!==null;)h.alternate!==null&&(_=h),h=h.sibling;_===null?s.tail=null:_.sibling=null;break;case"collapsed":_=s.tail;for(var S=null;_!==null;)_.alternate!==null&&(S=_),_=_.sibling;S===null?h||s.tail===null?s.tail=null:s.tail.sibling=null:S.sibling=null}}function jr(s){var h=s.alternate!==null&&s.alternate.child===s.child,_=0,S=0;if(h)for(var P=s.child;P!==null;)_|=P.lanes|P.childLanes,S|=P.subtreeFlags&65011712,S|=P.flags&65011712,P.return=s,P=P.sibling;else for(P=s.child;P!==null;)_|=P.lanes|P.childLanes,S|=P.subtreeFlags,S|=P.flags,P.return=s,P=P.sibling;return s.subtreeFlags|=S,s.childLanes=_,h}function Ed(s,h,_){var S=h.pendingProps;switch(Yu(h),h.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return jr(h),null;case 1:return jr(h),null;case 3:return _=h.stateNode,S=null,s!==null&&(S=s.memoizedState.cache),h.memoizedState.cache!==S&&(h.flags|=2048),Fs(ca),Vi(),_.pendingContext&&(_.context=_.pendingContext,_.pendingContext=null),(s===null||s.child===null)&&(Qu(h)?Qo(h):s===null||s.memoizedState.isDehydrated&&(h.flags&256)===0||(h.flags|=1024,tu())),jr(h),null;case 26:return _=h.memoizedState,s===null?(Qo(h),_!==null?(jr(h),Zp(h,_)):(jr(h),h.flags&=-16777217)):_?_!==s.memoizedState?(Qo(h),jr(h),Zp(h,_)):(jr(h),h.flags&=-16777217):(s.memoizedProps!==S&&Qo(h),jr(h),h.flags&=-16777217),null;case 27:xn(h),_=pi.current;var P=h.type;if(s!==null&&h.stateNode!=null)s.memoizedProps!==S&&Qo(h);else{if(!S){if(h.stateNode===null)throw Error(C(166));return jr(h),null}s=bi.current,Qu(h)?Ku(h):(s=b_(P,S,_),h.stateNode=s,Qo(h))}return jr(h),null;case 5:if(xn(h),_=h.type,s!==null&&h.stateNode!=null)s.memoizedProps!==S&&Qo(h);else{if(!S){if(h.stateNode===null)throw Error(C(166));return jr(h),null}if(s=bi.current,Qu(h))Ku(h);else{switch(P=Pf(pi.current),s){case 1:s=P.createElementNS("http://www.w3.org/2000/svg",_);break;case 2:s=P.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;default:switch(_){case"svg":s=P.createElementNS("http://www.w3.org/2000/svg",_);break;case"math":s=P.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;case"script":s=P.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof S.is=="string"?P.createElement("select",{is:S.is}):P.createElement("select"),S.multiple?s.multiple=!0:S.size&&(s.size=S.size);break;default:s=typeof S.is=="string"?P.createElement(_,{is:S.is}):P.createElement(_)}}s[ae]=h,s[ye]=S;e:for(P=h.child;P!==null;){if(P.tag===5||P.tag===6)s.appendChild(P.stateNode);else if(P.tag!==4&&P.tag!==27&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===h)break e;for(;P.sibling===null;){if(P.return===null||P.return===h)break e;P=P.return}P.sibling.return=P.return,P=P.sibling}h.stateNode=s;e:switch(Na(s,_,S),_){case"button":case"input":case"select":case"textarea":s=!!S.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&Qo(h)}}return jr(h),h.flags&=-16777217,null;case 6:if(s&&h.stateNode!=null)s.memoizedProps!==S&&Qo(h);else{if(typeof S!="string"&&h.stateNode===null)throw Error(C(166));if(s=pi.current,Qu(h)){if(s=h.stateNode,_=h.memoizedProps,S=null,P=Aa,P!==null)switch(P.tag){case 27:case 5:S=P.memoizedProps}s[ae]=h,s=!!(s.nodeValue===_||S!==null&&S.suppressHydrationWarning===!0||zf(s.nodeValue,_)),s||rl(h)}else s=Pf(s).createTextNode(S),s[ae]=h,h.stateNode=s}return jr(h),null;case 13:if(S=h.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(P=Qu(h),S!==null&&S.dehydrated!==null){if(s===null){if(!P)throw Error(C(318));if(P=h.memoizedState,P=P!==null?P.dehydrated:null,!P)throw Error(C(317));P[ae]=h}else Ju(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;jr(h),P=!1}else P=tu(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=P),P=!0;if(!P)return h.flags&256?(qs(h),h):(qs(h),null)}if(qs(h),(h.flags&128)!==0)return h.lanes=_,h;if(_=S!==null,s=s!==null&&s.memoizedState!==null,_){S=h.child,P=null,S.alternate!==null&&S.alternate.memoizedState!==null&&S.alternate.memoizedState.cachePool!==null&&(P=S.alternate.memoizedState.cachePool.pool);var U=null;S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(U=S.memoizedState.cachePool.pool),U!==P&&(S.flags|=2048)}return _!==s&&_&&(h.child.flags|=8192),yh(h,h.updateQueue),jr(h),null;case 4:return Vi(),s===null&&Jp(h.stateNode.containerInfo),jr(h),null;case 10:return Fs(h.type),jr(h),null;case 19:if(_i(fa),P=h.memoizedState,P===null)return jr(h),null;if(S=(h.flags&128)!==0,U=P.rendering,U===null)if(S)Wa(P,!1);else{if(Pn!==0||s!==null&&(s.flags&128)!==0)for(s=h.child;s!==null;){if(U=$s(s),U!==null){for(h.flags|=128,Wa(P,!1),s=U.updateQueue,h.updateQueue=s,yh(h,s),h.subtreeFlags=0,s=_,_=h.child;_!==null;)br(_,s),_=_.sibling;return Jt(fa,fa.current&1|2),h.child}s=s.sibling}P.tail!==null&&kr()>ra&&(h.flags|=128,S=!0,Wa(P,!1),h.lanes=4194304)}else{if(!S)if(s=$s(U),s!==null){if(h.flags|=128,S=!0,s=s.updateQueue,h.updateQueue=s,yh(h,s),Wa(P,!0),P.tail===null&&P.tailMode==="hidden"&&!U.alternate&&!_r)return jr(h),null}else 2*kr()-P.renderingStartTime>ra&&_!==536870912&&(h.flags|=128,S=!0,Wa(P,!1),h.lanes=4194304);P.isBackwards?(U.sibling=h.child,h.child=U):(s=P.last,s!==null?s.sibling=U:h.child=U,P.last=U)}return P.tail!==null?(h=P.tail,P.rendering=h,P.tail=h.sibling,P.renderingStartTime=kr(),h.sibling=null,s=fa.current,Jt(fa,S?s&1|2:s&1),h):(jr(h),null);case 22:case 23:return qs(h),ud(),S=h.memoizedState!==null,s!==null?s.memoizedState!==null!==S&&(h.flags|=8192):S&&(h.flags|=8192),S?(_&536870912)!==0&&(h.flags&128)===0&&(jr(h),h.subtreeFlags&6&&(h.flags|=8192)):jr(h),_=h.updateQueue,_!==null&&yh(h,_.retryQueue),_=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(_=s.memoizedState.cachePool.pool),S=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(S=h.memoizedState.cachePool.pool),S!==_&&(h.flags|=2048),s!==null&&_i(ru),null;case 24:return _=null,s!==null&&(_=s.memoizedState.cache),h.memoizedState.cache!==_&&(h.flags|=2048),Fs(ca),jr(h),null;case 25:return null;case 30:return null}throw Error(C(156,h.tag))}function vh(s,h){switch(Yu(h),h.tag){case 1:return s=h.flags,s&65536?(h.flags=s&-65537|128,h):null;case 3:return Fs(ca),Vi(),s=h.flags,(s&65536)!==0&&(s&128)===0?(h.flags=s&-65537|128,h):null;case 26:case 27:case 5:return xn(h),null;case 13:if(qs(h),s=h.memoizedState,s!==null&&s.dehydrated!==null){if(h.alternate===null)throw Error(C(340));Ju()}return s=h.flags,s&65536?(h.flags=s&-65537|128,h):null;case 19:return _i(fa),null;case 4:return Vi(),null;case 10:return Fs(h.type),null;case 22:case 23:return qs(h),ud(),s!==null&&_i(ru),s=h.flags,s&65536?(h.flags=s&-65537|128,h):null;case 24:return Fs(ca),null;case 25:return null;default:return null}}function hl(s,h){switch(Yu(h),h.tag){case 3:Fs(ca),Vi();break;case 26:case 27:case 5:xn(h);break;case 4:Vi();break;case 13:qs(h);break;case 19:_i(fa);break;case 10:Fs(h.type);break;case 22:case 23:qs(h),ud(),s!==null&&_i(ru);break;case 24:Fs(ca)}}function go(s,h){try{var _=h.updateQueue,S=_!==null?_.lastEffect:null;if(S!==null){var P=S.next;_=P;do{if((_.tag&s)===s){S=void 0;var U=_.create,le=_.inst;S=U(),le.destroy=S}_=_.next}while(_!==P)}}catch(Ee){Qr(h,h.return,Ee)}}function Ca(s,h,_){try{var S=h.updateQueue,P=S!==null?S.lastEffect:null;if(P!==null){var U=P.next;S=U;do{if((S.tag&s)===s){var le=S.inst,Ee=le.destroy;if(Ee!==void 0){le.destroy=void 0,P=h;var Ke=_,Mt=Ee;try{Mt()}catch(Zt){Qr(P,Ke,Zt)}}}S=S.next}while(S!==U)}}catch(Zt){Qr(h,h.return,Zt)}}function Ol(s){var h=s.updateQueue;if(h!==null){var _=s.stateNode;try{ac(h,_)}catch(S){Qr(s,s.return,S)}}}function Tc(s,h,_){_.props=Ll(s.type,s.memoizedProps),_.state=s.memoizedState;try{_.componentWillUnmount()}catch(S){Qr(s,h,S)}}function c(s,h){try{var _=s.ref;if(_!==null){switch(s.tag){case 26:case 27:case 5:var S=s.stateNode;break;case 30:S=s.stateNode;break;default:S=s.stateNode}typeof _=="function"?s.refCleanup=_(S):_.current=S}}catch(P){Qr(s,h,P)}}function t(s,h){var _=s.ref,S=s.refCleanup;if(_!==null)if(typeof S=="function")try{S()}catch(P){Qr(s,h,P)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof _=="function")try{_(null)}catch(P){Qr(s,h,P)}else _.current=null}function a(s){var h=s.type,_=s.memoizedProps,S=s.stateNode;try{e:switch(h){case"button":case"input":case"select":case"textarea":_.autoFocus&&S.focus();break e;case"img":_.src?S.src=_.src:_.srcSet&&(S.srcset=_.srcSet)}}catch(P){Qr(s,s.return,P)}}function u(s,h,_){try{var S=s.stateNode;ng(S,s.type,_,h),S[ye]=h}catch(P){Qr(s,s.return,P)}}function p(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Su(s.type)||s.tag===4}function g(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||p(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Su(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function v(s,h,_){var S=s.tag;if(S===5||S===6)s=s.stateNode,h?(_.nodeType===9?_.body:_.nodeName==="HTML"?_.ownerDocument.body:_).insertBefore(s,h):(h=_.nodeType===9?_.body:_.nodeName==="HTML"?_.ownerDocument.body:_,h.appendChild(s),_=_._reactRootContainer,_!=null||h.onclick!==null||(h.onclick=tm));else if(S!==4&&(S===27&&Su(s.type)&&(_=s.stateNode,h=null),s=s.child,s!==null))for(v(s,h,_),s=s.sibling;s!==null;)v(s,h,_),s=s.sibling}function w(s,h,_){var S=s.tag;if(S===5||S===6)s=s.stateNode,h?_.insertBefore(s,h):_.appendChild(s);else if(S!==4&&(S===27&&Su(s.type)&&(_=s.stateNode),s=s.child,s!==null))for(w(s,h,_),s=s.sibling;s!==null;)w(s,h,_),s=s.sibling}function A(s){var h=s.stateNode,_=s.memoizedProps;try{for(var S=s.type,P=h.attributes;P.length;)h.removeAttributeNode(P[0]);Na(h,S,_),h[ae]=s,h[ye]=_}catch(U){Qr(s,s.return,U)}}var I=!1,z=!1,k=!1,O=typeof WeakSet=="function"?WeakSet:Set,j=null;function Q(s,h){if(s=s.containerInfo,g_=_g,s=vl(s),hp(s)){if("selectionStart"in s)var _={start:s.selectionStart,end:s.selectionEnd};else e:{_=(_=s.ownerDocument)&&_.defaultView||window;var S=_.getSelection&&_.getSelection();if(S&&S.rangeCount!==0){_=S.anchorNode;var P=S.anchorOffset,U=S.focusNode;S=S.focusOffset;try{_.nodeType,U.nodeType}catch{_=null;break e}var le=0,Ee=-1,Ke=-1,Mt=0,Zt=0,oi=s,Lt=null;t:for(;;){for(var kt;oi!==_||P!==0&&oi.nodeType!==3||(Ee=le+P),oi!==U||S!==0&&oi.nodeType!==3||(Ke=le+S),oi.nodeType===3&&(le+=oi.nodeValue.length),(kt=oi.firstChild)!==null;)Lt=oi,oi=kt;for(;;){if(oi===s)break t;if(Lt===_&&++Mt===P&&(Ee=le),Lt===U&&++Zt===S&&(Ke=le),(kt=oi.nextSibling)!==null)break;oi=Lt,Lt=oi.parentNode}oi=kt}_=Ee===-1||Ke===-1?null:{start:Ee,end:Ke}}else _=null}_=_||{start:0,end:0}}else _=null;for(rg={focusedElem:s,selectionRange:_},_g=!1,j=h;j!==null;)if(h=j,s=h.child,(h.subtreeFlags&1024)!==0&&s!==null)s.return=h,j=s;else for(;j!==null;){switch(h=j,U=h.alternate,s=h.flags,h.tag){case 0:break;case 11:case 15:break;case 1:if((s&1024)!==0&&U!==null){s=void 0,_=h,P=U.memoizedProps,U=U.memoizedState,S=_.stateNode;try{var Ln=Ll(_.type,P,_.elementType===_.type);s=S.getSnapshotBeforeUpdate(Ln,U),S.__reactInternalSnapshotBeforeUpdate=s}catch(An){Qr(_,_.return,An)}}break;case 3:if((s&1024)!==0){if(s=h.stateNode.containerInfo,_=s.nodeType,_===9)Ec(s);else if(_===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":Ec(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(C(163))}if(s=h.sibling,s!==null){s.return=h.return,j=s;break}j=h.return}}function Y(s,h,_){var S=_.flags;switch(_.tag){case 0:case 11:case 15:ht(s,_),S&4&&go(5,_);break;case 1:if(ht(s,_),S&4)if(s=_.stateNode,h===null)try{s.componentDidMount()}catch(le){Qr(_,_.return,le)}else{var P=Ll(_.type,h.memoizedProps);h=h.memoizedState;try{s.componentDidUpdate(P,h,s.__reactInternalSnapshotBeforeUpdate)}catch(le){Qr(_,_.return,le)}}S&64&&Ol(_),S&512&&c(_,_.return);break;case 3:if(ht(s,_),S&64&&(s=_.updateQueue,s!==null)){if(h=null,_.child!==null)switch(_.child.tag){case 27:case 5:h=_.child.stateNode;break;case 1:h=_.child.stateNode}try{ac(s,h)}catch(le){Qr(_,_.return,le)}}break;case 27:h===null&&S&4&&A(_);case 26:case 5:ht(s,_),h===null&&S&4&&a(_),S&512&&c(_,_.return);break;case 12:ht(s,_);break;case 13:ht(s,_),S&4&&Ae(s,_),S&64&&(s=_.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(_=Q0.bind(null,_),Qy(s,_))));break;case 22:if(S=_.memoizedState!==null||I,!S){h=h!==null&&h.memoizedState!==null||z,P=I;var U=z;I=S,(z=h)&&!U?Ct(s,_,(_.subtreeFlags&8772)!==0):ht(s,_),I=P,z=U}break;case 30:break;default:ht(s,_)}}function ee(s){var h=s.alternate;h!==null&&(s.alternate=null,ee(h)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(h=s.stateNode,h!==null&&Ve(h)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var K=null,se=!1;function pe(s,h,_){for(_=_.child;_!==null;)ve(s,h,_),_=_.sibling}function ve(s,h,_){if(Ir&&typeof Ir.onCommitFiberUnmount=="function")try{Ir.onCommitFiberUnmount(Ta,_)}catch{}switch(_.tag){case 26:z||t(_,h),pe(s,h,_),_.memoizedState?_.memoizedState.count--:_.stateNode&&(_=_.stateNode,_.parentNode.removeChild(_));break;case 27:z||t(_,h);var S=K,P=se;Su(_.type)&&(K=_.stateNode,se=!1),pe(s,h,_),Nd(_.stateNode),K=S,se=P;break;case 5:z||t(_,h);case 6:if(S=K,P=se,K=null,pe(s,h,_),K=S,se=P,K!==null)if(se)try{(K.nodeType===9?K.body:K.nodeName==="HTML"?K.ownerDocument.body:K).removeChild(_.stateNode)}catch(U){Qr(_,h,U)}else try{K.removeChild(_.stateNode)}catch(U){Qr(_,h,U)}break;case 18:K!==null&&(se?(s=K,y_(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,_.stateNode),jf(s)):y_(K,_.stateNode));break;case 4:S=K,P=se,K=_.stateNode.containerInfo,se=!0,pe(s,h,_),K=S,se=P;break;case 0:case 11:case 14:case 15:z||Ca(2,_,h),z||Ca(4,_,h),pe(s,h,_);break;case 1:z||(t(_,h),S=_.stateNode,typeof S.componentWillUnmount=="function"&&Tc(_,h,S)),pe(s,h,_);break;case 21:pe(s,h,_);break;case 22:z=(S=z)||_.memoizedState!==null,pe(s,h,_),z=S;break;default:pe(s,h,_)}}function Ae(s,h){if(h.memoizedState===null&&(s=h.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{jf(s)}catch(_){Qr(h,h.return,_)}}function Se(s){switch(s.tag){case 13:case 19:var h=s.stateNode;return h===null&&(h=s.stateNode=new O),h;case 22:return s=s.stateNode,h=s._retryCache,h===null&&(h=s._retryCache=new O),h;default:throw Error(C(435,s.tag))}}function Te(s,h){var _=Se(s);h.forEach(function(S){var P=Vy.bind(null,s,S);_.has(S)||(_.add(S),S.then(P,P))})}function ge(s,h){var _=h.deletions;if(_!==null)for(var S=0;S<_.length;S++){var P=_[S],U=s,le=h,Ee=le;e:for(;Ee!==null;){switch(Ee.tag){case 27:if(Su(Ee.type)){K=Ee.stateNode,se=!1;break e}break;case 5:K=Ee.stateNode,se=!1;break e;case 3:case 4:K=Ee.stateNode.containerInfo,se=!0;break e}Ee=Ee.return}if(K===null)throw Error(C(160));ve(U,le,P),K=null,se=!1,U=P.alternate,U!==null&&(U.return=null),P.return=null}if(h.subtreeFlags&13878)for(h=h.child;h!==null;)Le(h,s),h=h.sibling}var Ce=null;function Le(s,h){var _=s.alternate,S=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:ge(h,s),Qe(s),S&4&&(Ca(3,s,s.return),go(3,s),Ca(5,s,s.return));break;case 1:ge(h,s),Qe(s),S&512&&(z||_===null||t(_,_.return)),S&64&&I&&(s=s.updateQueue,s!==null&&(S=s.callbacks,S!==null&&(_=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=_===null?S:_.concat(S))));break;case 26:var P=Ce;if(ge(h,s),Qe(s),S&512&&(z||_===null||t(_,_.return)),S&4){var U=_!==null?_.memoizedState:null;if(S=s.memoizedState,_===null)if(S===null)if(s.stateNode===null){e:{S=s.type,_=s.memoizedProps,P=P.ownerDocument||P;t:switch(S){case"title":U=P.getElementsByTagName("title")[0],(!U||U[Ye]||U[ae]||U.namespaceURI==="http://www.w3.org/2000/svg"||U.hasAttribute("itemprop"))&&(U=P.createElement(S),P.head.insertBefore(U,P.querySelector("head > title"))),Na(U,S,_),U[ae]=s,mi(U),S=U;break e;case"link":var le=iv("link","href",P).get(S+(_.href||""));if(le){for(var Ee=0;Ee<le.length;Ee++)if(U=le[Ee],U.getAttribute("href")===(_.href==null||_.href===""?null:_.href)&&U.getAttribute("rel")===(_.rel==null?null:_.rel)&&U.getAttribute("title")===(_.title==null?null:_.title)&&U.getAttribute("crossorigin")===(_.crossOrigin==null?null:_.crossOrigin)){le.splice(Ee,1);break t}}U=P.createElement(S),Na(U,S,_),P.head.appendChild(U);break;case"meta":if(le=iv("meta","content",P).get(S+(_.content||""))){for(Ee=0;Ee<le.length;Ee++)if(U=le[Ee],U.getAttribute("content")===(_.content==null?null:""+_.content)&&U.getAttribute("name")===(_.name==null?null:_.name)&&U.getAttribute("property")===(_.property==null?null:_.property)&&U.getAttribute("http-equiv")===(_.httpEquiv==null?null:_.httpEquiv)&&U.getAttribute("charset")===(_.charSet==null?null:_.charSet)){le.splice(Ee,1);break t}}U=P.createElement(S),Na(U,S,_),P.head.appendChild(U);break;default:throw Error(C(468,S))}U[ae]=s,mi(U),S=U}s.stateNode=S}else nv(P,s.type,s.stateNode);else s.stateNode=M_(P,S,s.memoizedProps);else U!==S?(U===null?_.stateNode!==null&&(_=_.stateNode,_.parentNode.removeChild(_)):U.count--,S===null?nv(P,s.type,s.stateNode):M_(P,S,s.memoizedProps)):S===null&&s.stateNode!==null&&u(s,s.memoizedProps,_.memoizedProps)}break;case 27:ge(h,s),Qe(s),S&512&&(z||_===null||t(_,_.return)),_!==null&&S&4&&u(s,s.memoizedProps,_.memoizedProps);break;case 5:if(ge(h,s),Qe(s),S&512&&(z||_===null||t(_,_.return)),s.flags&32){P=s.stateNode;try{Eo(P,"")}catch(kt){Qr(s,s.return,kt)}}S&4&&s.stateNode!=null&&(P=s.memoizedProps,u(s,P,_!==null?_.memoizedProps:P)),S&1024&&(k=!0);break;case 6:if(ge(h,s),Qe(s),S&4){if(s.stateNode===null)throw Error(C(162));S=s.memoizedProps,_=s.stateNode;try{_.nodeValue=S}catch(kt){Qr(s,s.return,kt)}}break;case 3:if(fg=null,P=Ce,Ce=nm(h.containerInfo),ge(h,s),Ce=P,Qe(s),S&4&&_!==null&&_.memoizedState.isDehydrated)try{jf(h.containerInfo)}catch(kt){Qr(s,s.return,kt)}k&&(k=!1,Ze(s));break;case 4:S=Ce,Ce=nm(s.stateNode.containerInfo),ge(h,s),Qe(s),Ce=S;break;case 12:ge(h,s),Qe(s);break;case 13:ge(h,s),Qe(s),s.child.flags&8192&&s.memoizedState!==null!=(_!==null&&_.memoizedState!==null)&&(ir=kr()),S&4&&(S=s.updateQueue,S!==null&&(s.updateQueue=null,Te(s,S)));break;case 22:P=s.memoizedState!==null;var Ke=_!==null&&_.memoizedState!==null,Mt=I,Zt=z;if(I=Mt||P,z=Zt||Ke,ge(h,s),z=Zt,I=Mt,Qe(s),S&8192)e:for(h=s.stateNode,h._visibility=P?h._visibility&-2:h._visibility|1,P&&(_===null||Ke||I||z||lt(s)),_=null,h=s;;){if(h.tag===5||h.tag===26){if(_===null){Ke=_=h;try{if(U=Ke.stateNode,P)le=U.style,typeof le.setProperty=="function"?le.setProperty("display","none","important"):le.display="none";else{Ee=Ke.stateNode;var oi=Ke.memoizedProps.style,Lt=oi!=null&&oi.hasOwnProperty("display")?oi.display:null;Ee.style.display=Lt==null||typeof Lt=="boolean"?"":(""+Lt).trim()}}catch(kt){Qr(Ke,Ke.return,kt)}}}else if(h.tag===6){if(_===null){Ke=h;try{Ke.stateNode.nodeValue=P?"":Ke.memoizedProps}catch(kt){Qr(Ke,Ke.return,kt)}}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===s)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===s)break e;for(;h.sibling===null;){if(h.return===null||h.return===s)break e;_===h&&(_=null),h=h.return}_===h&&(_=null),h.sibling.return=h.return,h=h.sibling}S&4&&(S=s.updateQueue,S!==null&&(_=S.retryQueue,_!==null&&(S.retryQueue=null,Te(s,_))));break;case 19:ge(h,s),Qe(s),S&4&&(S=s.updateQueue,S!==null&&(s.updateQueue=null,Te(s,S)));break;case 30:break;case 21:break;default:ge(h,s),Qe(s)}}function Qe(s){var h=s.flags;if(h&2){try{for(var _,S=s.return;S!==null;){if(p(S)){_=S;break}S=S.return}if(_==null)throw Error(C(160));switch(_.tag){case 27:var P=_.stateNode,U=g(s);w(s,U,P);break;case 5:var le=_.stateNode;_.flags&32&&(Eo(le,""),_.flags&=-33);var Ee=g(s);w(s,Ee,le);break;case 3:case 4:var Ke=_.stateNode.containerInfo,Mt=g(s);v(s,Mt,Ke);break;default:throw Error(C(161))}}catch(Zt){Qr(s,s.return,Zt)}s.flags&=-3}h&4096&&(s.flags&=-4097)}function Ze(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var h=s;Ze(h),h.tag===5&&h.flags&1024&&h.stateNode.reset(),s=s.sibling}}function ht(s,h){if(h.subtreeFlags&8772)for(h=h.child;h!==null;)Y(s,h.alternate,h),h=h.sibling}function lt(s){for(s=s.child;s!==null;){var h=s;switch(h.tag){case 0:case 11:case 14:case 15:Ca(4,h,h.return),lt(h);break;case 1:t(h,h.return);var _=h.stateNode;typeof _.componentWillUnmount=="function"&&Tc(h,h.return,_),lt(h);break;case 27:Nd(h.stateNode);case 26:case 5:t(h,h.return),lt(h);break;case 22:h.memoizedState===null&&lt(h);break;case 30:lt(h);break;default:lt(h)}s=s.sibling}}function Ct(s,h,_){for(_=_&&(h.subtreeFlags&8772)!==0,h=h.child;h!==null;){var S=h.alternate,P=s,U=h,le=U.flags;switch(U.tag){case 0:case 11:case 15:Ct(P,U,_),go(4,U);break;case 1:if(Ct(P,U,_),S=U,P=S.stateNode,typeof P.componentDidMount=="function")try{P.componentDidMount()}catch(Mt){Qr(S,S.return,Mt)}if(S=U,P=S.updateQueue,P!==null){var Ee=S.stateNode;try{var Ke=P.shared.hiddenCallbacks;if(Ke!==null)for(P.shared.hiddenCallbacks=null,P=0;P<Ke.length;P++)cd(Ke[P],Ee)}catch(Mt){Qr(S,S.return,Mt)}}_&&le&64&&Ol(U),c(U,U.return);break;case 27:A(U);case 26:case 5:Ct(P,U,_),_&&S===null&&le&4&&a(U),c(U,U.return);break;case 12:Ct(P,U,_);break;case 13:Ct(P,U,_),_&&le&4&&Ae(P,U);break;case 22:U.memoizedState===null&&Ct(P,U,_),c(U,U.return);break;case 30:break;default:Ct(P,U,_)}h=h.sibling}}function $e(s,h){var _=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(_=s.memoizedState.cachePool.pool),s=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(s=h.memoizedState.cachePool.pool),s!==_&&(s!=null&&s.refCount++,_!=null&&tc(_))}function et(s,h){s=null,h.alternate!==null&&(s=h.alternate.memoizedState.cache),h=h.memoizedState.cache,h!==s&&(h.refCount++,s!=null&&tc(s))}function Ge(s,h,_,S){if(h.subtreeFlags&10256)for(h=h.child;h!==null;)pt(s,h,_,S),h=h.sibling}function pt(s,h,_,S){var P=h.flags;switch(h.tag){case 0:case 11:case 15:Ge(s,h,_,S),P&2048&&go(9,h);break;case 1:Ge(s,h,_,S);break;case 3:Ge(s,h,_,S),P&2048&&(s=null,h.alternate!==null&&(s=h.alternate.memoizedState.cache),h=h.memoizedState.cache,h!==s&&(h.refCount++,s!=null&&tc(s)));break;case 12:if(P&2048){Ge(s,h,_,S),s=h.stateNode;try{var U=h.memoizedProps,le=U.id,Ee=U.onPostCommit;typeof Ee=="function"&&Ee(le,h.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(Ke){Qr(h,h.return,Ke)}}else Ge(s,h,_,S);break;case 13:Ge(s,h,_,S);break;case 23:break;case 22:U=h.stateNode,le=h.alternate,h.memoizedState!==null?U._visibility&2?Ge(s,h,_,S):bt(s,h):U._visibility&2?Ge(s,h,_,S):(U._visibility|=2,tt(s,h,_,S,(h.subtreeFlags&10256)!==0)),P&2048&&$e(le,h);break;case 24:Ge(s,h,_,S),P&2048&&et(h.alternate,h);break;default:Ge(s,h,_,S)}}function tt(s,h,_,S,P){for(P=P&&(h.subtreeFlags&10256)!==0,h=h.child;h!==null;){var U=s,le=h,Ee=_,Ke=S,Mt=le.flags;switch(le.tag){case 0:case 11:case 15:tt(U,le,Ee,Ke,P),go(8,le);break;case 23:break;case 22:var Zt=le.stateNode;le.memoizedState!==null?Zt._visibility&2?tt(U,le,Ee,Ke,P):bt(U,le):(Zt._visibility|=2,tt(U,le,Ee,Ke,P)),P&&Mt&2048&&$e(le.alternate,le);break;case 24:tt(U,le,Ee,Ke,P),P&&Mt&2048&&et(le.alternate,le);break;default:tt(U,le,Ee,Ke,P)}h=h.sibling}}function bt(s,h){if(h.subtreeFlags&10256)for(h=h.child;h!==null;){var _=s,S=h,P=S.flags;switch(S.tag){case 22:bt(_,S),P&2048&&$e(S.alternate,S);break;case 24:bt(_,S),P&2048&&et(S.alternate,S);break;default:bt(_,S)}h=h.sibling}}var dt=8192;function wt(s){if(s.subtreeFlags&dt)for(s=s.child;s!==null;)At(s),s=s.sibling}function At(s){switch(s.tag){case 26:wt(s),s.flags&dt&&s.memoizedState!==null&&rv(Ce,s.memoizedState,s.memoizedProps);break;case 5:wt(s);break;case 3:case 4:var h=Ce;Ce=nm(s.stateNode.containerInfo),wt(s),Ce=h;break;case 22:s.memoizedState===null&&(h=s.alternate,h!==null&&h.memoizedState!==null?(h=dt,dt=16777216,wt(s),dt=h):wt(s));break;default:wt(s)}}function Qt(s){var h=s.alternate;if(h!==null&&(s=h.child,s!==null)){h.child=null;do h=s.sibling,s.sibling=null,s=h;while(s!==null)}}function ai(s){var h=s.deletions;if((s.flags&16)!==0){if(h!==null)for(var _=0;_<h.length;_++){var S=h[_];j=S,ii(S,s)}Qt(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Yt(s),s=s.sibling}function Yt(s){switch(s.tag){case 0:case 11:case 15:ai(s),s.flags&2048&&Ca(9,s,s.return);break;case 3:ai(s);break;case 12:ai(s);break;case 22:var h=s.stateNode;s.memoizedState!==null&&h._visibility&2&&(s.return===null||s.return.tag!==13)?(h._visibility&=-3,ci(s)):ai(s);break;default:ai(s)}}function ci(s){var h=s.deletions;if((s.flags&16)!==0){if(h!==null)for(var _=0;_<h.length;_++){var S=h[_];j=S,ii(S,s)}Qt(s)}for(s=s.child;s!==null;){switch(h=s,h.tag){case 0:case 11:case 15:Ca(8,h,h.return),ci(h);break;case 22:_=h.stateNode,_._visibility&2&&(_._visibility&=-3,ci(h));break;default:ci(h)}s=s.sibling}}function ii(s,h){for(;j!==null;){var _=j;switch(_.tag){case 0:case 11:case 15:Ca(8,_,h);break;case 23:case 22:if(_.memoizedState!==null&&_.memoizedState.cachePool!==null){var S=_.memoizedState.cachePool.pool;S!=null&&S.refCount++}break;case 24:tc(_.memoizedState.cache)}if(S=_.child,S!==null)S.return=_,j=S;else e:for(_=s;j!==null;){S=j;var P=S.sibling,U=S.return;if(ee(S),S===_){j=null;break e}if(P!==null){P.return=U,j=P;break e}j=U}}}var Mi={getCacheForType:function(s){var h=da(ca),_=h.data.get(s);return _===void 0&&(_=s(),h.data.set(s,_)),_}},Ni=typeof WeakMap=="function"?WeakMap:Map,Ai=0,Hi=null,zi=null,wi=0,an=0,zn=null,Bi=!1,on=!1,vn=!1,wn=0,Pn=0,er=0,Ar=0,tr=0,ki=0,$n=0,mn=null,Sn=null,En=!1,ir=0,ra=1/0,Zn=null,Ur=null,jn=0,qr=null,Ya=null,No=0,Ka=0,Bo=null,Zs=null,Fo=0,Jo=null;function Ra(){if((Ai&2)!==0&&wi!==0)return wi&-wi;if(Je.T!==null){var s=ic;return s!==0?s:p_()}return de()}function Sc(){ki===0&&(ki=(wi&536870912)===0||_r?ro():536870912);var s=ko.current;return s!==null&&(s.flags|=32),ki}function Qa(s,h,_){(s===Hi&&(an===2||an===9)||s.cancelPendingCommit!==null)&&(Id(s,0),Un(s,wi,ki,!1)),As(s,_),((Ai&2)===0||s!==Hi)&&(s===Hi&&((Ai&2)===0&&(Ar|=_),Pn===4&&Un(s,wi,ki,!1)),Fl(s))}function Ad(s,h,_){if((Ai&6)!==0)throw Error(C(327));var S=!_&&(h&124)===0&&(h&s.expiredLanes)===0||wo(s,h),P=S?$m(s,h):qm(s,h,!0),U=S;do{if(P===0){on&&!S&&Un(s,h,0,!1);break}else{if(_=s.current.alternate,U&&!Cd(_)){P=qm(s,h,!1),U=!1;continue}if(P===2){if(U=h,s.errorRecoveryDisabledLanes&U)var le=0;else le=s.pendingLanes&-536870913,le=le!==0?le:le&536870912?536870912:0;if(le!==0){h=le;e:{var Ee=s;P=mn;var Ke=Ee.current.memoizedState.isDehydrated;if(Ke&&(Id(Ee,le).flags|=256),le=qm(Ee,le,!1),le!==2){if(vn&&!Ke){Ee.errorRecoveryDisabledLanes|=U,Ar|=U,P=4;break e}U=Sn,Sn=P,U!==null&&(Sn===null?Sn=U:Sn.push.apply(Sn,U))}P=le}if(U=!1,P!==2)continue}}if(P===1){Id(s,0),Un(s,h,0,!0);break}e:{switch(S=s,U=P,U){case 0:case 1:throw Error(C(345));case 4:if((h&4194048)!==h)break;case 6:Un(S,h,ki,!Bi);break e;case 2:Sn=null;break;case 3:case 5:break;default:throw Error(C(329))}if((h&62914560)===h&&(P=ir+300-kr(),10<P)){if(Un(S,h,ki,!Bi),Vo(S,0,!0)!==0)break e;S.timeoutHandle=lg(Md.bind(null,S,_,Sn,Zn,En,h,ki,Ar,$n,Bi,U,2,-0,0),P);break e}Md(S,_,Sn,Zn,En,h,ki,Ar,$n,Bi,U,0,-0,0)}}break}while(!0);Fl(s)}function Md(s,h,_,S,P,U,le,Ee,Ke,Mt,Zt,oi,Lt,kt){if(s.timeoutHandle=-1,oi=h.subtreeFlags,(oi&8192||(oi&16785408)===16785408)&&(Of={stylesheets:null,count:0,unsuspend:pg},At(h),oi=I_(),oi!==null)){s.cancelPendingCommit=oi(Xm.bind(null,s,h,U,_,S,P,le,Ee,Ke,Zt,1,Lt,kt)),Un(s,U,le,!Mt);return}Xm(s,h,U,_,S,P,le,Ee,Ke)}function Cd(s){for(var h=s;;){var _=h.tag;if((_===0||_===11||_===15)&&h.flags&16384&&(_=h.updateQueue,_!==null&&(_=_.stores,_!==null)))for(var S=0;S<_.length;S++){var P=_[S],U=P.getSnapshot;P=P.value;try{if(!qo(U(),P))return!1}catch{return!1}}if(_=h.child,h.subtreeFlags&16384&&_!==null)_.return=h,h=_;else{if(h===s)break;for(;h.sibling===null;){if(h.return===null||h.return===s)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function Un(s,h,_,S){h&=~tr,h&=~Ar,s.suspendedLanes|=h,s.pingedLanes&=~h,S&&(s.warmLanes|=h),S=s.expirationTimes;for(var P=h;0<P;){var U=31-Hr(P),le=1<<U;S[U]=-1,P&=~le}_!==0&&Ms(s,_,h)}function kl(){return(Ai&6)===0?(If(0),!1):!0}function Rd(){if(zi!==null){if(an===0)var s=zi.return;else s=zi,El=Sl=null,Tp(s),mo=null,Wo=0,s=zi;for(;s!==null;)hl(s.alternate,s),s=s.return;zi=null}}function Id(s,h){var _=s.timeoutHandle;_!==-1&&(s.timeoutHandle=-1,Wy(_)),_=s.cancelPendingCommit,_!==null&&(s.cancelPendingCommit=null,_()),Rd(),Hi=s,zi=_=Os(s.current,null),wi=h,an=0,zn=null,Bi=!1,on=wo(s,h),vn=!1,$n=ki=tr=Ar=er=Pn=0,Sn=mn=null,En=!1,(h&8)!==0&&(h|=h&32);var S=s.entangledLanes;if(S!==0)for(s=s.entanglements,S&=h;0<S;){var P=31-Hr(S),U=1<<P;h|=s[P],S&=~U}return wn=h,xl(),_}function By(s,h){Nn=null,Je.H=pu,h===od||h===ah?(h=pf(),an=3):h===km?(h=pf(),an=4):an=h===Np?8:h!==null&&typeof h=="object"&&typeof h.then=="function"?6:1,zn=h,zi===null&&(Pn=1,vu(s,oo(h,s.current)))}function Hm(){var s=Je.H;return Je.H=pu,s===null?pu:s}function Nl(){var s=Je.A;return Je.A=Mi,s}function Bl(){Pn=4,Bi||(wi&4194048)!==wi&&ko.current!==null||(on=!0),(er&134217727)===0&&(Ar&134217727)===0||Hi===null||Un(Hi,wi,ki,!1)}function qm(s,h,_){var S=Ai;Ai|=2;var P=Hm(),U=Nl();(Hi!==s||wi!==h)&&(Zn=null,Id(s,h)),h=!1;var le=Pn;e:do try{if(an!==0&&zi!==null){var Ee=zi,Ke=zn;switch(an){case 8:Rd(),le=6;break e;case 3:case 2:case 9:case 6:ko.current===null&&(h=!0);var Mt=an;if(an=0,zn=null,Dd(s,Ee,Ke,Mt),_&&on){le=0;break e}break;default:Mt=an,an=0,zn=null,Dd(s,Ee,Ke,Mt)}}Fy(),le=Pn;break}catch(Zt){By(s,Zt)}while(!0);return h&&s.shellSuspendCounter++,El=Sl=null,Ai=S,Je.H=P,Je.A=U,zi===null&&(Hi=null,wi=0,xl()),le}function Fy(){for(;zi!==null;)Cf(zi)}function $m(s,h){var _=Ai;Ai|=2;var S=Hm(),P=Nl();Hi!==s||wi!==h?(Zn=null,ra=kr()+500,Id(s,h)):on=wo(s,h);e:do try{if(an!==0&&zi!==null){h=zi;var U=zn;t:switch(an){case 1:an=0,zn=null,Dd(s,h,U,1);break;case 2:case 9:if(xp(U)){an=0,zn=null,Xp(h);break}h=function(){an!==2&&an!==9||Hi!==s||(an=7),Fl(s)},U.then(h,h);break e;case 3:an=7;break e;case 4:an=5;break e;case 7:xp(U)?(an=0,zn=null,Xp(h)):(an=0,zn=null,Dd(s,h,U,7));break;case 5:var le=null;switch(zi.tag){case 26:le=zi.memoizedState;case 5:case 27:var Ee=zi;if(!le||rm(le)){an=0,zn=null;var Ke=Ee.sibling;if(Ke!==null)zi=Ke;else{var Mt=Ee.return;Mt!==null?(zi=Mt,zd(Mt)):zi=null}break t}}an=0,zn=null,Dd(s,h,U,5);break;case 6:an=0,zn=null,Dd(s,h,U,6);break;case 8:Rd(),Pn=6;break e;default:throw Error(C(462))}}a_();break}catch(Zt){By(s,Zt)}while(!0);return El=Sl=null,Je.H=S,Je.A=P,Ai=_,zi!==null?0:(Hi=null,wi=0,xl(),Pn)}function a_(){for(;zi!==null&&!io();)Cf(zi)}function Cf(s){var h=Gm(s.alternate,s,wn);s.memoizedProps=s.pendingProps,h===null?zd(s):zi=h}function Xp(s){var h=s,_=h.alternate;switch(h.tag){case 15:case 0:h=vr(_,h,h.pendingProps,h.type,void 0,wi);break;case 11:h=vr(_,h,h.pendingProps,h.type.render,h.ref,wi);break;case 5:Tp(h);default:hl(_,h),h=zi=br(h,wn),h=Gm(_,h,wn)}s.memoizedProps=s.pendingProps,h===null?zd(s):zi=h}function Dd(s,h,_,S){El=Sl=null,Tp(h),mo=null,Wo=0;var P=h.return;try{if(jm(s,P,h,_,wi)){Pn=1,vu(s,oo(_,s.current)),zi=null;return}}catch(U){if(P!==null)throw zi=P,U;Pn=1,vu(s,oo(_,s.current)),zi=null;return}h.flags&32768?(_r||S===1?s=!0:on||(wi&536870912)!==0?s=!1:(Bi=s=!0,(S===2||S===9||S===3||S===6)&&(S=ko.current,S!==null&&S.tag===13&&(S.flags|=16384))),Zm(h,s)):zd(h)}function zd(s){var h=s;do{if((h.flags&32768)!==0){Zm(h,Bi);return}s=h.return;var _=Ed(h.alternate,h,wn);if(_!==null){zi=_;return}if(h=h.sibling,h!==null){zi=h;return}zi=h=s}while(h!==null);Pn===0&&(Pn=5)}function Zm(s,h){do{var _=vh(s.alternate,s);if(_!==null){_.flags&=32767,zi=_;return}if(_=s.return,_!==null&&(_.flags|=32768,_.subtreeFlags=0,_.deletions=null),!h&&(s=s.sibling,s!==null)){zi=s;return}zi=s=_}while(s!==null);Pn=6,zi=null}function Xm(s,h,_,S,P,U,le,Ee,Ke){s.cancelPendingCommit=null;do Rf();while(jn!==0);if((Ai&6)!==0)throw Error(C(327));if(h!==null){if(h===s.current)throw Error(C(177));if(U=h.lanes|h.childLanes,U|=zo,Pc(s,_,U,le,Ee,Ke),s===Hi&&(zi=Hi=null,wi=0),Ya=h,qr=s,No=_,Ka=U,Bo=P,Zs=S,(h.subtreeFlags&10256)!==0||(h.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,J0(Uo,function(){return c_(),null})):(s.callbackNode=null,s.callbackPriority=0),S=(h.flags&13878)!==0,(h.subtreeFlags&13878)!==0||S){S=Je.T,Je.T=null,P=jt.p,jt.p=2,le=Ai,Ai|=4;try{Q(s,h,_)}finally{Ai=le,jt.p=P,Je.T=S}}jn=1,o_(),s_(),xu()}}function o_(){if(jn===1){jn=0;var s=qr,h=Ya,_=(h.flags&13878)!==0;if((h.subtreeFlags&13878)!==0||_){_=Je.T,Je.T=null;var S=jt.p;jt.p=2;var P=Ai;Ai|=4;try{Le(h,s);var U=rg,le=vl(s.containerInfo),Ee=U.focusedElem,Ke=U.selectionRange;if(le!==Ee&&Ee&&Ee.ownerDocument&&af(Ee.ownerDocument.documentElement,Ee)){if(Ke!==null&&hp(Ee)){var Mt=Ke.start,Zt=Ke.end;if(Zt===void 0&&(Zt=Mt),"selectionStart"in Ee)Ee.selectionStart=Mt,Ee.selectionEnd=Math.min(Zt,Ee.value.length);else{var oi=Ee.ownerDocument||document,Lt=oi&&oi.defaultView||window;if(Lt.getSelection){var kt=Lt.getSelection(),Ln=Ee.textContent.length,An=Math.min(Ke.start,Ln),Zr=Ke.end===void 0?An:Math.min(Ke.end,Ln);!kt.extend&&An>Zr&&(le=Zr,Zr=An,An=le);var mt=zs(Ee,An),st=zs(Ee,Zr);if(mt&&st&&(kt.rangeCount!==1||kt.anchorNode!==mt.node||kt.anchorOffset!==mt.offset||kt.focusNode!==st.node||kt.focusOffset!==st.offset)){var Et=oi.createRange();Et.setStart(mt.node,mt.offset),kt.removeAllRanges(),An>Zr?(kt.addRange(Et),kt.extend(st.node,st.offset)):(Et.setEnd(st.node,st.offset),kt.addRange(Et))}}}}for(oi=[],kt=Ee;kt=kt.parentNode;)kt.nodeType===1&&oi.push({element:kt,left:kt.scrollLeft,top:kt.scrollTop});for(typeof Ee.focus=="function"&&Ee.focus(),Ee=0;Ee<oi.length;Ee++){var Kt=oi[Ee];Kt.element.scrollLeft=Kt.left,Kt.element.scrollTop=Kt.top}}_g=!!g_,rg=g_=null}finally{Ai=P,jt.p=S,Je.T=_}}s.current=h,jn=2}}function s_(){if(jn===2){jn=0;var s=qr,h=Ya,_=(h.flags&8772)!==0;if((h.subtreeFlags&8772)!==0||_){_=Je.T,Je.T=null;var S=jt.p;jt.p=2;var P=Ai;Ai|=4;try{Y(s,h.alternate,h)}finally{Ai=P,jt.p=S,Je.T=_}}jn=3}}function xu(){if(jn===4||jn===3){jn=0,ea();var s=qr,h=Ya,_=No,S=Zs;(h.subtreeFlags&10256)!==0||(h.flags&10256)!==0?jn=5:(jn=0,Ya=qr=null,l_(s,s.pendingLanes));var P=s.pendingLanes;if(P===0&&(Ur=null),$l(_),h=h.stateNode,Ir&&typeof Ir.onCommitFiberRoot=="function")try{Ir.onCommitFiberRoot(Ta,h,void 0,(h.current.flags&128)===128)}catch{}if(S!==null){h=Je.T,P=jt.p,jt.p=2,Je.T=null;try{for(var U=s.onRecoverableError,le=0;le<S.length;le++){var Ee=S[le];U(Ee.value,{componentStack:Ee.stack})}}finally{Je.T=h,jt.p=P}}(No&3)!==0&&Rf(),Fl(s),P=s.pendingLanes,(_&4194090)!==0&&(P&42)!==0?s===Jo?Fo++:(Fo=0,Jo=s):Fo=0,If(0)}}function l_(s,h){(s.pooledCacheLanes&=h)===0&&(h=s.pooledCache,h!=null&&(s.pooledCache=null,tc(h)))}function Rf(s){return o_(),s_(),xu(),c_()}function c_(){if(jn!==5)return!1;var s=qr,h=Ka;Ka=0;var _=$l(No),S=Je.T,P=jt.p;try{jt.p=32>_?32:_,Je.T=null,_=Bo,Bo=null;var U=qr,le=No;if(jn=0,Ya=qr=null,No=0,(Ai&6)!==0)throw Error(C(331));var Ee=Ai;if(Ai|=4,Yt(U.current),pt(U,U.current,le,_),Ai=Ee,If(0,!1),Ir&&typeof Ir.onPostCommitFiberRoot=="function")try{Ir.onPostCommitFiberRoot(Ta,U)}catch{}return!0}finally{jt.p=P,Je.T=S,l_(s,h)}}function jy(s,h,_){h=oo(_,h),h=mh(s.stateNode,h,2),s=js(s,h,2),s!==null&&(As(s,2),Fl(s))}function Qr(s,h,_){if(s.tag===3)jy(s,s,_);else for(;h!==null;){if(h.tag===3){jy(h,s,_);break}else if(h.tag===1){var S=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(Ur===null||!Ur.has(S))){s=oo(_,s),_=Op(2),S=js(h,_,2),S!==null&&(kp(_,S,h,s),As(S,2),Fl(S));break}}h=h.return}}function u_(s,h,_){var S=s.pingCache;if(S===null){S=s.pingCache=new Ni;var P=new Set;S.set(h,P)}else P=S.get(h),P===void 0&&(P=new Set,S.set(h,P));P.has(_)||(vn=!0,P.add(_),s=Uy.bind(null,s,h,_),h.then(s,s))}function Uy(s,h,_){var S=s.pingCache;S!==null&&S.delete(h),s.pingedLanes|=s.suspendedLanes&_,s.warmLanes&=~_,Hi===s&&(wi&_)===_&&(Pn===4||Pn===3&&(wi&62914560)===wi&&300>kr()-ir?(Ai&2)===0&&Id(s,0):tr|=_,$n===wi&&($n=0)),Fl(s)}function h_(s,h){h===0&&(h=fl()),s=hs(s,h),s!==null&&(As(s,h),Fl(s))}function Q0(s){var h=s.memoizedState,_=0;h!==null&&(_=h.retryLane),h_(s,_)}function Vy(s,h){var _=0;switch(s.tag){case 13:var S=s.stateNode,P=s.memoizedState;P!==null&&(_=P.retryLane);break;case 19:S=s.stateNode;break;case 22:S=s.stateNode._retryCache;break;default:throw Error(C(314))}S!==null&&S.delete(h),h_(s,_)}function J0(s,h){return Rn(s,h)}var Wm=null,Pd=null,Ym=!1,Wp=!1,Km=!1,xh=0;function Fl(s){s!==Pd&&s.next===null&&(Pd===null?Wm=Pd=s:Pd=Pd.next=s),Wp=!0,Ym||(Ym=!0,ex())}function If(s,h){if(!Km&&Wp){Km=!0;do for(var _=!1,S=Wm;S!==null;){if(s!==0){var P=S.pendingLanes;if(P===0)var U=0;else{var le=S.suspendedLanes,Ee=S.pingedLanes;U=(1<<31-Hr(42|s)+1)-1,U&=P&~(le&~Ee),U=U&201326741?U&201326741|1:U?U|2:0}U!==0&&(_=!0,Df(S,U))}else U=wi,U=Vo(S,S===Hi?U:0,S.cancelPendingCommit!==null||S.timeoutHandle!==-1),(U&3)===0||wo(S,U)||(_=!0,Df(S,U));S=S.next}while(_);Km=!1}}function d_(){bu()}function bu(){Wp=Ym=!1;var s=0;xh!==0&&(Xy()&&(s=xh),xh=0);for(var h=kr(),_=null,S=Wm;S!==null;){var P=S.next,U=xa(S,h);U===0?(S.next=null,_===null?Wm=P:_.next=P,P===null&&(Pd=_)):(_=S,(s!==0||(U&3)!==0)&&(Wp=!0)),S=P}If(s)}function xa(s,h){for(var _=s.suspendedLanes,S=s.pingedLanes,P=s.expirationTimes,U=s.pendingLanes&-62914561;0<U;){var le=31-Hr(U),Ee=1<<le,Ke=P[le];Ke===-1?((Ee&_)===0||(Ee&S)!==0)&&(P[le]=Jn(Ee,h)):Ke<=h&&(s.expiredLanes|=Ee),U&=~Ee}if(h=Hi,_=wi,_=Vo(s,s===h?_:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),S=s.callbackNode,_===0||s===h&&(an===2||an===9)||s.cancelPendingCommit!==null)return S!==null&&S!==null&&Jr(S),s.callbackNode=null,s.callbackPriority=0;if((_&3)===0||wo(s,_)){if(h=_&-_,h===s.callbackPriority)return h;switch(S!==null&&Jr(S),$l(_)){case 2:case 8:_=vo;break;case 32:_=Uo;break;case 268435456:_=xo;break;default:_=Uo}return S=f_.bind(null,s),_=Rn(_,S),s.callbackPriority=h,s.callbackNode=_,h}return S!==null&&S!==null&&Jr(S),s.callbackPriority=2,s.callbackNode=null,2}function f_(s,h){if(jn!==0&&jn!==5)return s.callbackNode=null,s.callbackPriority=0,null;var _=s.callbackNode;if(Rf()&&s.callbackNode!==_)return null;var S=wi;return S=Vo(s,s===Hi?S:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),S===0?null:(Ad(s,S,h),xa(s,kr()),s.callbackNode!=null&&s.callbackNode===_?f_.bind(null,s):null)}function Df(s,h){if(Rf())return null;Ad(s,h,!0)}function ex(){cg(function(){(Ai&6)!==0?Rn(la,d_):bu()})}function p_(){return xh===0&&(xh=ro()),xh}function Gy(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Zl(""+s)}function Hy(s,h){var _=h.ownerDocument.createElement("input");return _.name=h.name,_.value=h.value,s.id&&_.setAttribute("form",s.id),h.parentNode.insertBefore(_,h),s=new FormData(s),_.parentNode.removeChild(_),s}function Yp(s,h,_,S,P){if(h==="submit"&&_&&_.stateNode===P){var U=Gy((P[ye]||null).action),le=S.submitter;le&&(h=(h=le[ye]||null)?Gy(h.formAction):le.getAttribute("formAction"),h!==null&&(U=h,le=null));var Ee=new kc("action","action",null,S,P);s.push({event:Ee,listeners:[{instance:null,listener:function(){if(S.defaultPrevented){if(xh!==0){var Ke=le?Hy(P,le):new FormData(P);uu(_,{pending:!0,data:Ke,method:P.method,action:U},null,Ke)}}else typeof U=="function"&&(Ee.preventDefault(),Ke=le?Hy(P,le):new FormData(P),uu(_,{pending:!0,data:Ke,method:P.method,action:U},U,Ke))},currentTarget:P}]})}}for(var Qm=0;Qm<Ut.length;Qm++){var wu=Ut[Qm],Kp=wu.toLowerCase(),tx=wu[0].toUpperCase()+wu.slice(1);Xo(Kp,"on"+tx)}Xo(lf,"onAnimationEnd"),Xo(Zo,"onAnimationIteration"),Xo(Wc,"onAnimationStart"),Xo("dblclick","onDoubleClick"),Xo("focusin","onFocus"),Xo("focusout","onBlur"),Xo(Xu,"onTransitionRun"),Xo(fp,"onTransitionStart"),Xo(cf,"onTransitionCancel"),Xo(Io,"onTransitionEnd"),Ui("onMouseEnter",["mouseout","mouseover"]),Ui("onMouseLeave",["mouseout","mouseover"]),Ui("onPointerEnter",["pointerout","pointerover"]),Ui("onPointerLeave",["pointerout","pointerover"]),In("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),In("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),In("onBeforeInput",["compositionend","keypress","textInput","paste"]),In("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),In("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),In("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ix=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Qp));function qy(s,h){h=(h&4)!==0;for(var _=0;_<s.length;_++){var S=s[_],P=S.event;S=S.listeners;e:{var U=void 0;if(h)for(var le=S.length-1;0<=le;le--){var Ee=S[le],Ke=Ee.instance,Mt=Ee.currentTarget;if(Ee=Ee.listener,Ke!==U&&P.isPropagationStopped())break e;U=Ee,P.currentTarget=Mt;try{U(P)}catch(Zt){vc(Zt)}P.currentTarget=null,U=Ke}else for(le=0;le<S.length;le++){if(Ee=S[le],Ke=Ee.instance,Mt=Ee.currentTarget,Ee=Ee.listener,Ke!==U&&P.isPropagationStopped())break e;U=Ee,P.currentTarget=Mt;try{U(P)}catch(Zt){vc(Zt)}P.currentTarget=null,U=Ke}}}}function dr(s,h){var _=h[De];_===void 0&&(_=h[De]=new Set);var S=s+"__bubble";_.has(S)||($y(h,s,2,!1),_.add(S))}function m_(s,h,_){var S=0;h&&(S|=4),$y(_,s,S,h)}var Jm="_reactListening"+Math.random().toString(36).slice(2);function Jp(s){if(!s[Jm]){s[Jm]=!0,gi.forEach(function(_){_!=="selectionchange"&&(ix.has(_)||m_(_,!1,s),m_(_,!0,s))});var h=s.nodeType===9?s:s.ownerDocument;h===null||h[Jm]||(h[Jm]=!0,m_("selectionchange",!1,h))}}function $y(s,h,_,S){switch(Ff(h)){case 2:var P=sx;break;case 8:P=lv;break;default:P=Ac}_=P.bind(null,h,_,s),P=void 0,!Xl||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(P=!0),S?P!==void 0?s.addEventListener(h,_,{capture:!0,passive:P}):s.addEventListener(h,_,!0):P!==void 0?s.addEventListener(h,_,{passive:P}):s.addEventListener(h,_,!1)}function eg(s,h,_,S,P){var U=S;if((h&1)===0&&(h&2)===0&&S!==null)e:for(;;){if(S===null)return;var le=S.tag;if(le===3||le===4){var Ee=S.stateNode.containerInfo;if(Ee===P)break;if(le===4)for(le=S.return;le!==null;){var Ke=le.tag;if((Ke===3||Ke===4)&&le.stateNode.containerInfo===P)return;le=le.return}for(;Ee!==null;){if(le=ft(Ee),le===null)return;if(Ke=le.tag,Ke===5||Ke===6||Ke===26||Ke===27){S=U=le;continue e}Ee=Ee.parentNode}}S=S.return}Nh(function(){var Mt=U,Zt=Vu(_),oi=[];e:{var Lt=Yh.get(s);if(Lt!==void 0){var kt=kc,Ln=s;switch(s){case"keypress":if(Fh(_)===0)break e;case"keydown":case"keyup":kt=kn;break;case"focusin":Ln="focus",kt=jc;break;case"focusout":Ln="blur",kt=jc;break;case"beforeblur":case"afterblur":kt=jc;break;case"click":if(_.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":kt=Yl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":kt=sp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":kt=Vc;break;case lf:case Zo:case Wc:kt=Pm;break;case Io:kt=Hh;break;case"scroll":case"scrollend":kt=Mo;break;case"wheel":kt=ia;break;case"copy":case"cut":case"paste":kt=Lm;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":kt=_l;break;case"toggle":case"beforetoggle":kt=qh}var An=(h&4)!==0,Zr=!An&&(s==="scroll"||s==="scrollend"),mt=An?Lt!==null?Lt+"Capture":null:Lt;An=[];for(var st=Mt,Et;st!==null;){var Kt=st;if(Et=Kt.stateNode,Kt=Kt.tag,Kt!==5&&Kt!==26&&Kt!==27||Et===null||mt===null||(Kt=gn(st,mt),Kt!=null&&An.push(Tu(st,Kt,Et))),Zr)break;st=st.return}0<An.length&&(Lt=new kt(Lt,Ln,null,_,Zt),oi.push({event:Lt,listeners:An}))}}if((h&7)===0){e:{if(Lt=s==="mouseover"||s==="pointerover",kt=s==="mouseout"||s==="pointerout",Lt&&_!==Sa&&(Ln=_.relatedTarget||_.fromElement)&&(ft(Ln)||Ln[we]))break e;if((kt||Lt)&&(Lt=Zt.window===Zt?Zt:(Lt=Zt.ownerDocument)?Lt.defaultView||Lt.parentWindow:window,kt?(Ln=_.relatedTarget||_.toElement,kt=Mt,Ln=Ln?ft(Ln):null,Ln!==null&&(Zr=N(Ln),An=Ln.tag,Ln!==Zr||An!==5&&An!==27&&An!==6)&&(Ln=null)):(kt=null,Ln=Mt),kt!==Ln)){if(An=Yl,Kt="onMouseLeave",mt="onMouseEnter",st="mouse",(s==="pointerout"||s==="pointerover")&&(An=_l,Kt="onPointerLeave",mt="onPointerEnter",st="pointer"),Zr=kt==null?Lt:Vt(kt),Et=Ln==null?Lt:Vt(Ln),Lt=new An(Kt,st+"leave",kt,_,Zt),Lt.target=Zr,Lt.relatedTarget=Et,Kt=null,ft(Zt)===Mt&&(An=new An(mt,st+"enter",Ln,_,Zt),An.target=Et,An.relatedTarget=Zr,Kt=An),Zr=Kt,kt&&Ln)t:{for(An=kt,mt=Ln,st=0,Et=An;Et;Et=$r(Et))st++;for(Et=0,Kt=mt;Kt;Kt=$r(Kt))Et++;for(;0<st-Et;)An=$r(An),st--;for(;0<Et-st;)mt=$r(mt),Et--;for(;st--;){if(An===mt||mt!==null&&An===mt.alternate)break t;An=$r(An),mt=$r(mt)}An=null}else An=null;kt!==null&&Ld(oi,Lt,kt,An,!1),Ln!==null&&Zr!==null&&Ld(oi,Zr,Ln,An,!0)}}e:{if(Lt=Mt?Vt(Mt):window,kt=Lt.nodeName&&Lt.nodeName.toLowerCase(),kt==="select"||kt==="input"&&Lt.type==="file")var Ki=cs;else if(qu(Lt))if(up)Ki=Zh;else{Ki=$c;var nr=qc}else kt=Lt.nodeName,!kt||kt.toLowerCase()!=="input"||Lt.type!=="checkbox"&&Lt.type!=="radio"?Mt&&Cs(Mt.elementType)&&(Ki=cs):Ki=Za;if(Ki&&(Ki=Ki(s,Mt))){Di(oi,Ki,_,Zt);break e}nr&&nr(s,Lt,Mt),s==="focusout"&&Mt&&Lt.type==="number"&&Mt.memoizedProps.value!=null&&Va(Lt,"number",Lt.value)}switch(nr=Mt?Vt(Mt):window,s){case"focusin":(qu(nr)||nr.contentEditable==="true")&&(Zc=nr,of=Mt,Wh=null);break;case"focusout":Wh=of=Zc=null;break;case"mousedown":Zu=!0;break;case"contextmenu":case"mouseup":case"dragend":Zu=!1,dp(oi,_,Zt);break;case"selectionchange":if(n_)break;case"keydown":case"keyup":dp(oi,_,Zt)}var un;if(Ql)e:{switch(s){case"compositionstart":var Mn="onCompositionStart";break e;case"compositionend":Mn="onCompositionEnd";break e;case"compositionupdate":Mn="onCompositionUpdate";break e}Mn=void 0}else Br?cp(s,_)&&(Mn="onCompositionEnd"):s==="keydown"&&_.keyCode===229&&(Mn="onCompositionStart");Mn&&(La&&_.locale!=="ko"&&(Br||Mn!=="onCompositionStart"?Mn==="onCompositionEnd"&&Br&&(un=Oc()):(ml=Zt,gl="value"in ml?ml.value:ml.textContent,Br=!0)),nr=tg(Mt,Mn),0<nr.length&&(Mn=new Uh(Mn,s,null,_,Zt),oi.push({event:Mn,listeners:nr}),un?Mn.data=un:(un=Gc(_),un!==null&&(Mn.data=un)))),(un=nf?$a(s,_):Zi(s,_))&&(Mn=tg(Mt,"onBeforeInput"),0<Mn.length&&(nr=new Uh("onBeforeInput","beforeinput",null,_,Zt),oi.push({event:nr,listeners:Mn}),nr.data=un)),Yp(oi,s,Mt,_,Zt)}qy(oi,h)})}function Tu(s,h,_){return{instance:s,listener:h,currentTarget:_}}function tg(s,h){for(var _=h+"Capture",S=[];s!==null;){var P=s,U=P.stateNode;if(P=P.tag,P!==5&&P!==26&&P!==27||U===null||(P=gn(s,_),P!=null&&S.unshift(Tu(s,P,U)),P=gn(s,h),P!=null&&S.push(Tu(s,P,U))),s.tag===3)return S;s=s.return}return[]}function $r(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function Ld(s,h,_,S,P){for(var U=h._reactName,le=[];_!==null&&_!==S;){var Ee=_,Ke=Ee.alternate,Mt=Ee.stateNode;if(Ee=Ee.tag,Ke!==null&&Ke===S)break;Ee!==5&&Ee!==26&&Ee!==27||Mt===null||(Ke=Mt,P?(Mt=gn(_,U),Mt!=null&&le.unshift(Tu(_,Mt,Ke))):P||(Mt=gn(_,U),Mt!=null&&le.push(Tu(_,Mt,Ke)))),_=_.return}le.length!==0&&s.push({event:h,listeners:le})}var Zy=/\r\n?/g,ig=/\u0000|\uFFFD/g;function em(s){return(typeof s=="string"?s:""+s).replace(Zy,`
`).replace(ig,"")}function zf(s,h){return h=em(h),em(s)===h}function tm(){}function Vr(s,h,_,S,P,U){switch(_){case"children":typeof S=="string"?h==="body"||h==="textarea"&&S===""||Eo(s,S):(typeof S=="number"||typeof S=="bigint")&&h!=="body"&&Eo(s,""+S);break;case"className":Er(s,"class",S);break;case"tabIndex":Er(s,"tabindex",S);break;case"dir":case"role":case"viewBox":case"width":case"height":Er(s,_,S);break;case"style":Jd(s,S,U);break;case"data":if(h!=="object"){Er(s,"data",S);break}case"src":case"href":if(S===""&&(h!=="a"||_!=="href")){s.removeAttribute(_);break}if(S==null||typeof S=="function"||typeof S=="symbol"||typeof S=="boolean"){s.removeAttribute(_);break}S=Zl(""+S),s.setAttribute(_,S);break;case"action":case"formAction":if(typeof S=="function"){s.setAttribute(_,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof U=="function"&&(_==="formAction"?(h!=="input"&&Vr(s,h,"name",P.name,P,null),Vr(s,h,"formEncType",P.formEncType,P,null),Vr(s,h,"formMethod",P.formMethod,P,null),Vr(s,h,"formTarget",P.formTarget,P,null)):(Vr(s,h,"encType",P.encType,P,null),Vr(s,h,"method",P.method,P,null),Vr(s,h,"target",P.target,P,null)));if(S==null||typeof S=="symbol"||typeof S=="boolean"){s.removeAttribute(_);break}S=Zl(""+S),s.setAttribute(_,S);break;case"onClick":S!=null&&(s.onclick=tm);break;case"onScroll":S!=null&&dr("scroll",s);break;case"onScrollEnd":S!=null&&dr("scrollend",s);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(C(61));if(_=S.__html,_!=null){if(P.children!=null)throw Error(C(60));s.innerHTML=_}}break;case"multiple":s.multiple=S&&typeof S!="function"&&typeof S!="symbol";break;case"muted":s.muted=S&&typeof S!="function"&&typeof S!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(S==null||typeof S=="function"||typeof S=="boolean"||typeof S=="symbol"){s.removeAttribute("xlink:href");break}_=Zl(""+S),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",_);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":S!=null&&typeof S!="function"&&typeof S!="symbol"?s.setAttribute(_,""+S):s.removeAttribute(_);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":S&&typeof S!="function"&&typeof S!="symbol"?s.setAttribute(_,""):s.removeAttribute(_);break;case"capture":case"download":S===!0?s.setAttribute(_,""):S!==!1&&S!=null&&typeof S!="function"&&typeof S!="symbol"?s.setAttribute(_,S):s.removeAttribute(_);break;case"cols":case"rows":case"size":case"span":S!=null&&typeof S!="function"&&typeof S!="symbol"&&!isNaN(S)&&1<=S?s.setAttribute(_,S):s.removeAttribute(_);break;case"rowSpan":case"start":S==null||typeof S=="function"||typeof S=="symbol"||isNaN(S)?s.removeAttribute(_):s.setAttribute(_,S);break;case"popover":dr("beforetoggle",s),dr("toggle",s),Yn(s,"popover",S);break;case"xlinkActuate":sn(s,"http://www.w3.org/1999/xlink","xlink:actuate",S);break;case"xlinkArcrole":sn(s,"http://www.w3.org/1999/xlink","xlink:arcrole",S);break;case"xlinkRole":sn(s,"http://www.w3.org/1999/xlink","xlink:role",S);break;case"xlinkShow":sn(s,"http://www.w3.org/1999/xlink","xlink:show",S);break;case"xlinkTitle":sn(s,"http://www.w3.org/1999/xlink","xlink:title",S);break;case"xlinkType":sn(s,"http://www.w3.org/1999/xlink","xlink:type",S);break;case"xmlBase":sn(s,"http://www.w3.org/XML/1998/namespace","xml:base",S);break;case"xmlLang":sn(s,"http://www.w3.org/XML/1998/namespace","xml:lang",S);break;case"xmlSpace":sn(s,"http://www.w3.org/XML/1998/namespace","xml:space",S);break;case"is":Yn(s,"is",S);break;case"innerText":case"textContent":break;default:(!(2<_.length)||_[0]!=="o"&&_[0]!=="O"||_[1]!=="n"&&_[1]!=="N")&&(_=kh.get(_)||_,Yn(s,_,S))}}function Od(s,h,_,S,P,U){switch(_){case"style":Jd(s,S,U);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(C(61));if(_=S.__html,_!=null){if(P.children!=null)throw Error(C(60));s.innerHTML=_}}break;case"children":typeof S=="string"?Eo(s,S):(typeof S=="number"||typeof S=="bigint")&&Eo(s,""+S);break;case"onScroll":S!=null&&dr("scroll",s);break;case"onScrollEnd":S!=null&&dr("scrollend",s);break;case"onClick":S!=null&&(s.onclick=tm);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Gi.hasOwnProperty(_))e:{if(_[0]==="o"&&_[1]==="n"&&(P=_.endsWith("Capture"),h=_.slice(2,P?_.length-7:void 0),U=s[ye]||null,U=U!=null?U[_]:null,typeof U=="function"&&s.removeEventListener(h,U,P),typeof S=="function")){typeof U!="function"&&U!==null&&(_ in s?s[_]=null:s.hasAttribute(_)&&s.removeAttribute(_)),s.addEventListener(h,S,P);break e}_ in s?s[_]=S:S===!0?s.setAttribute(_,""):Yn(s,_,S)}}}function Na(s,h,_){switch(h){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":dr("error",s),dr("load",s);var S=!1,P=!1,U;for(U in _)if(_.hasOwnProperty(U)){var le=_[U];if(le!=null)switch(U){case"src":S=!0;break;case"srcSet":P=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(C(137,h));default:Vr(s,h,U,le,_,null)}}P&&Vr(s,h,"srcSet",_.srcSet,_,null),S&&Vr(s,h,"src",_.src,_,null);return;case"input":dr("invalid",s);var Ee=U=le=P=null,Ke=null,Mt=null;for(S in _)if(_.hasOwnProperty(S)){var Zt=_[S];if(Zt!=null)switch(S){case"name":P=Zt;break;case"type":le=Zt;break;case"checked":Ke=Zt;break;case"defaultChecked":Mt=Zt;break;case"value":U=Zt;break;case"defaultValue":Ee=Zt;break;case"children":case"dangerouslySetInnerHTML":if(Zt!=null)throw Error(C(137,h));break;default:Vr(s,h,S,Zt,_,null)}}Qd(s,U,Ee,Ke,Mt,le,P,!1),Lc(s);return;case"select":dr("invalid",s),S=le=U=null;for(P in _)if(_.hasOwnProperty(P)&&(Ee=_[P],Ee!=null))switch(P){case"value":U=Ee;break;case"defaultValue":le=Ee;break;case"multiple":S=Ee;default:Vr(s,h,P,Ee,_,null)}h=U,_=le,s.multiple=!!S,h!=null?Ga(s,!!S,h,!1):_!=null&&Ga(s,!!S,_,!0);return;case"textarea":dr("invalid",s),U=P=S=null;for(le in _)if(_.hasOwnProperty(le)&&(Ee=_[le],Ee!=null))switch(le){case"value":S=Ee;break;case"defaultValue":P=Ee;break;case"children":U=Ee;break;case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(C(91));break;default:Vr(s,h,le,Ee,_,null)}ns(s,S,P,U),Lc(s);return;case"option":for(Ke in _)if(_.hasOwnProperty(Ke)&&(S=_[Ke],S!=null))switch(Ke){case"selected":s.selected=S&&typeof S!="function"&&typeof S!="symbol";break;default:Vr(s,h,Ke,S,_,null)}return;case"dialog":dr("beforetoggle",s),dr("toggle",s),dr("cancel",s),dr("close",s);break;case"iframe":case"object":dr("load",s);break;case"video":case"audio":for(S=0;S<Qp.length;S++)dr(Qp[S],s);break;case"image":dr("error",s),dr("load",s);break;case"details":dr("toggle",s);break;case"embed":case"source":case"link":dr("error",s),dr("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Mt in _)if(_.hasOwnProperty(Mt)&&(S=_[Mt],S!=null))switch(Mt){case"children":case"dangerouslySetInnerHTML":throw Error(C(137,h));default:Vr(s,h,Mt,S,_,null)}return;default:if(Cs(h)){for(Zt in _)_.hasOwnProperty(Zt)&&(S=_[Zt],S!==void 0&&Od(s,h,Zt,S,_,void 0));return}}for(Ee in _)_.hasOwnProperty(Ee)&&(S=_[Ee],S!=null&&Vr(s,h,Ee,S,_,null))}function ng(s,h,_,S){switch(h){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var P=null,U=null,le=null,Ee=null,Ke=null,Mt=null,Zt=null;for(kt in _){var oi=_[kt];if(_.hasOwnProperty(kt)&&oi!=null)switch(kt){case"checked":break;case"value":break;case"defaultValue":Ke=oi;default:S.hasOwnProperty(kt)||Vr(s,h,kt,null,S,oi)}}for(var Lt in S){var kt=S[Lt];if(oi=_[Lt],S.hasOwnProperty(Lt)&&(kt!=null||oi!=null))switch(Lt){case"type":U=kt;break;case"name":P=kt;break;case"checked":Mt=kt;break;case"defaultChecked":Zt=kt;break;case"value":le=kt;break;case"defaultValue":Ee=kt;break;case"children":case"dangerouslySetInnerHTML":if(kt!=null)throw Error(C(137,h));break;default:kt!==oi&&Vr(s,h,Lt,kt,S,oi)}}Ho(s,le,Ee,Ke,Mt,Zt,U,P);return;case"select":kt=le=Ee=Lt=null;for(U in _)if(Ke=_[U],_.hasOwnProperty(U)&&Ke!=null)switch(U){case"value":break;case"multiple":kt=Ke;default:S.hasOwnProperty(U)||Vr(s,h,U,null,S,Ke)}for(P in S)if(U=S[P],Ke=_[P],S.hasOwnProperty(P)&&(U!=null||Ke!=null))switch(P){case"value":Lt=U;break;case"defaultValue":Ee=U;break;case"multiple":le=U;default:U!==Ke&&Vr(s,h,P,U,S,Ke)}h=Ee,_=le,S=kt,Lt!=null?Ga(s,!!_,Lt,!1):!!S!=!!_&&(h!=null?Ga(s,!!_,h,!0):Ga(s,!!_,_?[]:"",!1));return;case"textarea":kt=Lt=null;for(Ee in _)if(P=_[Ee],_.hasOwnProperty(Ee)&&P!=null&&!S.hasOwnProperty(Ee))switch(Ee){case"value":break;case"children":break;default:Vr(s,h,Ee,null,S,P)}for(le in S)if(P=S[le],U=_[le],S.hasOwnProperty(le)&&(P!=null||U!=null))switch(le){case"value":Lt=P;break;case"defaultValue":kt=P;break;case"children":break;case"dangerouslySetInnerHTML":if(P!=null)throw Error(C(91));break;default:P!==U&&Vr(s,h,le,P,S,U)}el(s,Lt,kt);return;case"option":for(var Ln in _)if(Lt=_[Ln],_.hasOwnProperty(Ln)&&Lt!=null&&!S.hasOwnProperty(Ln))switch(Ln){case"selected":s.selected=!1;break;default:Vr(s,h,Ln,null,S,Lt)}for(Ke in S)if(Lt=S[Ke],kt=_[Ke],S.hasOwnProperty(Ke)&&Lt!==kt&&(Lt!=null||kt!=null))switch(Ke){case"selected":s.selected=Lt&&typeof Lt!="function"&&typeof Lt!="symbol";break;default:Vr(s,h,Ke,Lt,S,kt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var An in _)Lt=_[An],_.hasOwnProperty(An)&&Lt!=null&&!S.hasOwnProperty(An)&&Vr(s,h,An,null,S,Lt);for(Mt in S)if(Lt=S[Mt],kt=_[Mt],S.hasOwnProperty(Mt)&&Lt!==kt&&(Lt!=null||kt!=null))switch(Mt){case"children":case"dangerouslySetInnerHTML":if(Lt!=null)throw Error(C(137,h));break;default:Vr(s,h,Mt,Lt,S,kt)}return;default:if(Cs(h)){for(var Zr in _)Lt=_[Zr],_.hasOwnProperty(Zr)&&Lt!==void 0&&!S.hasOwnProperty(Zr)&&Od(s,h,Zr,void 0,S,Lt);for(Zt in S)Lt=S[Zt],kt=_[Zt],!S.hasOwnProperty(Zt)||Lt===kt||Lt===void 0&&kt===void 0||Od(s,h,Zt,Lt,S,kt);return}}for(var mt in _)Lt=_[mt],_.hasOwnProperty(mt)&&Lt!=null&&!S.hasOwnProperty(mt)&&Vr(s,h,mt,null,S,Lt);for(oi in S)Lt=S[oi],kt=_[oi],!S.hasOwnProperty(oi)||Lt===kt||Lt==null&&kt==null||Vr(s,h,oi,Lt,S,kt)}var g_=null,rg=null;function Pf(s){return s.nodeType===9?s:s.ownerDocument}function ag(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function og(s,h){if(s===0)switch(h){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&h==="foreignObject"?0:s}function sg(s,h){return s==="textarea"||s==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.children=="bigint"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var im=null;function Xy(){var s=window.event;return s&&s.type==="popstate"?s===im?!1:(im=s,!0):(im=null,!1)}var lg=typeof setTimeout=="function"?setTimeout:void 0,Wy=typeof clearTimeout=="function"?clearTimeout:void 0,__=typeof Promise=="function"?Promise:void 0,cg=typeof queueMicrotask=="function"?queueMicrotask:typeof __<"u"?function(s){return __.resolve(null).then(s).catch(Yy)}:lg;function Yy(s){setTimeout(function(){throw s})}function Su(s){return s==="head"}function y_(s,h){var _=h,S=0,P=0;do{var U=_.nextSibling;if(s.removeChild(_),U&&U.nodeType===8)if(_=U.data,_==="/$"){if(0<S&&8>S){_=S;var le=s.ownerDocument;if(_&1&&Nd(le.documentElement),_&2&&Nd(le.body),_&4)for(_=le.head,Nd(_),le=_.firstChild;le;){var Ee=le.nextSibling,Ke=le.nodeName;le[Ye]||Ke==="SCRIPT"||Ke==="STYLE"||Ke==="LINK"&&le.rel.toLowerCase()==="stylesheet"||_.removeChild(le),le=Ee}}if(P===0){s.removeChild(U),jf(h);return}P--}else _==="$"||_==="$?"||_==="$!"?P++:S=_.charCodeAt(0)-48;else S=0;_=U}while(_);jf(h)}function Ec(s){var h=s.firstChild;for(h&&h.nodeType===10&&(h=h.nextSibling);h;){var _=h;switch(h=h.nextSibling,_.nodeName){case"HTML":case"HEAD":case"BODY":Ec(_),Ve(_);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(_.rel.toLowerCase()==="stylesheet")continue}s.removeChild(_)}}function kd(s,h,_,S){for(;s.nodeType===1;){var P=_;if(s.nodeName.toLowerCase()!==h.toLowerCase()){if(!S&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(S){if(!s[Ye])switch(h){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(U=s.getAttribute("rel"),U==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(U!==P.rel||s.getAttribute("href")!==(P.href==null||P.href===""?null:P.href)||s.getAttribute("crossorigin")!==(P.crossOrigin==null?null:P.crossOrigin)||s.getAttribute("title")!==(P.title==null?null:P.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(U=s.getAttribute("src"),(U!==(P.src==null?null:P.src)||s.getAttribute("type")!==(P.type==null?null:P.type)||s.getAttribute("crossorigin")!==(P.crossOrigin==null?null:P.crossOrigin))&&U&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(h==="input"&&s.type==="hidden"){var U=P.name==null?null:""+P.name;if(P.type==="hidden"&&s.getAttribute("name")===U)return s}else return s;if(s=jl(s.nextSibling),s===null)break}return null}function Ky(s,h,_){if(h==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!_||(s=jl(s.nextSibling),s===null))return null;return s}function v_(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState==="complete"}function Qy(s,h){var _=s.ownerDocument;if(s.data!=="$?"||_.readyState==="complete")h();else{var S=function(){h(),_.removeEventListener("DOMContentLoaded",S)};_.addEventListener("DOMContentLoaded",S),s._reactRetry=S}}function jl(s){for(;s!=null;s=s.nextSibling){var h=s.nodeType;if(h===1||h===3)break;if(h===8){if(h=s.data,h==="$"||h==="$!"||h==="$?"||h==="F!"||h==="F")break;if(h==="/$")return null}}return s}var x_=null;function bh(s){s=s.previousSibling;for(var h=0;s;){if(s.nodeType===8){var _=s.data;if(_==="$"||_==="$!"||_==="$?"){if(h===0)return s;h--}else _==="/$"&&h++}s=s.previousSibling}return null}function b_(s,h,_){switch(h=Pf(_),s){case"html":if(s=h.documentElement,!s)throw Error(C(452));return s;case"head":if(s=h.head,!s)throw Error(C(453));return s;case"body":if(s=h.body,!s)throw Error(C(454));return s;default:throw Error(C(451))}}function Nd(s){for(var h=s.attributes;h.length;)s.removeAttributeNode(h[0]);Ve(s)}var ys=new Map,w_=new Set;function nm(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var es=jt.d;jt.d={f:nx,r:vs,D:Jy,C:ug,L:rx,m:ax,X:ev,S:S_,M:E_};function nx(){var s=es.f(),h=kl();return s||h}function vs(s){var h=Pt(s);h!==null&&h.tag===5&&h.type==="form"?Tf(h):es.r(s)}var Bd=typeof document>"u"?null:document;function T_(s,h,_){var S=Bd;if(S&&typeof h=="string"&&h){var P=So(h);P='link[rel="'+s+'"][href="'+P+'"]',typeof _=="string"&&(P+='[crossorigin="'+_+'"]'),w_.has(P)||(w_.add(P),s={rel:s,crossOrigin:_,href:h},S.querySelector(P)===null&&(h=S.createElement("link"),Na(h,"link",s),mi(h),S.head.appendChild(h)))}}function Jy(s){es.D(s),T_("dns-prefetch",s,null)}function ug(s,h){es.C(s,h),T_("preconnect",s,h)}function rx(s,h,_){es.L(s,h,_);var S=Bd;if(S&&s&&h){var P='link[rel="preload"][as="'+So(h)+'"]';h==="image"&&_&&_.imageSrcSet?(P+='[imagesrcset="'+So(_.imageSrcSet)+'"]',typeof _.imageSizes=="string"&&(P+='[imagesizes="'+So(_.imageSizes)+'"]')):P+='[href="'+So(s)+'"]';var U=P;switch(h){case"style":U=Fd(s);break;case"script":U=wh(s)}ys.has(U)||(s=ie({rel:"preload",href:h==="image"&&_&&_.imageSrcSet?void 0:s,as:h},_),ys.set(U,s),S.querySelector(P)!==null||h==="style"&&S.querySelector(Lf(U))||h==="script"&&S.querySelector(xs(U))||(h=S.createElement("link"),Na(h,"link",s),mi(h),S.head.appendChild(h)))}}function ax(s,h){es.m(s,h);var _=Bd;if(_&&s){var S=h&&typeof h.as=="string"?h.as:"script",P='link[rel="modulepreload"][as="'+So(S)+'"][href="'+So(s)+'"]',U=P;switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":U=wh(s)}if(!ys.has(U)&&(s=ie({rel:"modulepreload",href:s},h),ys.set(U,s),_.querySelector(P)===null)){switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(_.querySelector(xs(U)))return}S=_.createElement("link"),Na(S,"link",s),mi(S),_.head.appendChild(S)}}}function S_(s,h,_){es.S(s,h,_);var S=Bd;if(S&&s){var P=vi(S).hoistableStyles,U=Fd(s);h=h||"default";var le=P.get(U);if(!le){var Ee={loading:0,preload:null};if(le=S.querySelector(Lf(U)))Ee.loading=5;else{s=ie({rel:"stylesheet",href:s,"data-precedence":h},_),(_=ys.get(U))&&C_(s,_);var Ke=le=S.createElement("link");mi(Ke),Na(Ke,"link",s),Ke._p=new Promise(function(Mt,Zt){Ke.onload=Mt,Ke.onerror=Zt}),Ke.addEventListener("load",function(){Ee.loading|=1}),Ke.addEventListener("error",function(){Ee.loading|=2}),Ee.loading|=4,dg(le,h,S)}le={type:"stylesheet",instance:le,count:1,state:Ee},P.set(U,le)}}}function ev(s,h){es.X(s,h);var _=Bd;if(_&&s){var S=vi(_).hoistableScripts,P=wh(s),U=S.get(P);U||(U=_.querySelector(xs(P)),U||(s=ie({src:s,async:!0},h),(h=ys.get(P))&&R_(s,h),U=_.createElement("script"),mi(U),Na(U,"link",s),_.head.appendChild(U)),U={type:"script",instance:U,count:1,state:null},S.set(P,U))}}function E_(s,h){es.M(s,h);var _=Bd;if(_&&s){var S=vi(_).hoistableScripts,P=wh(s),U=S.get(P);U||(U=_.querySelector(xs(P)),U||(s=ie({src:s,async:!0,type:"module"},h),(h=ys.get(P))&&R_(s,h),U=_.createElement("script"),mi(U),Na(U,"link",s),_.head.appendChild(U)),U={type:"script",instance:U,count:1,state:null},S.set(P,U))}}function hg(s,h,_,S){var P=(P=pi.current)?nm(P):null;if(!P)throw Error(C(446));switch(s){case"meta":case"title":return null;case"style":return typeof _.precedence=="string"&&typeof _.href=="string"?(h=Fd(_.href),_=vi(P).hoistableStyles,S=_.get(h),S||(S={type:"style",instance:null,count:0,state:null},_.set(h,S)),S):{type:"void",instance:null,count:0,state:null};case"link":if(_.rel==="stylesheet"&&typeof _.href=="string"&&typeof _.precedence=="string"){s=Fd(_.href);var U=vi(P).hoistableStyles,le=U.get(s);if(le||(P=P.ownerDocument||P,le={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},U.set(s,le),(U=P.querySelector(Lf(s)))&&!U._p&&(le.instance=U,le.state.loading=5),ys.has(s)||(_={rel:"preload",as:"style",href:_.href,crossOrigin:_.crossOrigin,integrity:_.integrity,media:_.media,hrefLang:_.hrefLang,referrerPolicy:_.referrerPolicy},ys.set(s,_),U||tv(P,s,_,le.state))),h&&S===null)throw Error(C(528,""));return le}if(h&&S!==null)throw Error(C(529,""));return null;case"script":return h=_.async,_=_.src,typeof _=="string"&&h&&typeof h!="function"&&typeof h!="symbol"?(h=wh(_),_=vi(P).hoistableScripts,S=_.get(h),S||(S={type:"script",instance:null,count:0,state:null},_.set(h,S)),S):{type:"void",instance:null,count:0,state:null};default:throw Error(C(444,s))}}function Fd(s){return'href="'+So(s)+'"'}function Lf(s){return'link[rel="stylesheet"]['+s+"]"}function A_(s){return ie({},s,{"data-precedence":s.precedence,precedence:null})}function tv(s,h,_,S){s.querySelector('link[rel="preload"][as="style"]['+h+"]")?S.loading=1:(h=s.createElement("link"),S.preload=h,h.addEventListener("load",function(){return S.loading|=1}),h.addEventListener("error",function(){return S.loading|=2}),Na(h,"link",_),mi(h),s.head.appendChild(h))}function wh(s){return'[src="'+So(s)+'"]'}function xs(s){return"script[async]"+s}function M_(s,h,_){if(h.count++,h.instance===null)switch(h.type){case"style":var S=s.querySelector('style[data-href~="'+So(_.href)+'"]');if(S)return h.instance=S,mi(S),S;var P=ie({},_,{"data-href":_.href,"data-precedence":_.precedence,href:null,precedence:null});return S=(s.ownerDocument||s).createElement("style"),mi(S),Na(S,"style",P),dg(S,_.precedence,s),h.instance=S;case"stylesheet":P=Fd(_.href);var U=s.querySelector(Lf(P));if(U)return h.state.loading|=4,h.instance=U,mi(U),U;S=A_(_),(P=ys.get(P))&&C_(S,P),U=(s.ownerDocument||s).createElement("link"),mi(U);var le=U;return le._p=new Promise(function(Ee,Ke){le.onload=Ee,le.onerror=Ke}),Na(U,"link",S),h.state.loading|=4,dg(U,_.precedence,s),h.instance=U;case"script":return U=wh(_.src),(P=s.querySelector(xs(U)))?(h.instance=P,mi(P),P):(S=_,(P=ys.get(U))&&(S=ie({},_),R_(S,P)),s=s.ownerDocument||s,P=s.createElement("script"),mi(P),Na(P,"link",S),s.head.appendChild(P),h.instance=P);case"void":return null;default:throw Error(C(443,h.type))}else h.type==="stylesheet"&&(h.state.loading&4)===0&&(S=h.instance,h.state.loading|=4,dg(S,_.precedence,s));return h.instance}function dg(s,h,_){for(var S=_.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),P=S.length?S[S.length-1]:null,U=P,le=0;le<S.length;le++){var Ee=S[le];if(Ee.dataset.precedence===h)U=Ee;else if(U!==P)break}U?U.parentNode.insertBefore(s,U.nextSibling):(h=_.nodeType===9?_.head:_,h.insertBefore(s,h.firstChild))}function C_(s,h){s.crossOrigin==null&&(s.crossOrigin=h.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=h.referrerPolicy),s.title==null&&(s.title=h.title)}function R_(s,h){s.crossOrigin==null&&(s.crossOrigin=h.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=h.referrerPolicy),s.integrity==null&&(s.integrity=h.integrity)}var fg=null;function iv(s,h,_){if(fg===null){var S=new Map,P=fg=new Map;P.set(_,S)}else P=fg,S=P.get(_),S||(S=new Map,P.set(_,S));if(S.has(s))return S;for(S.set(s,null),_=_.getElementsByTagName(s),P=0;P<_.length;P++){var U=_[P];if(!(U[Ye]||U[ae]||s==="link"&&U.getAttribute("rel")==="stylesheet")&&U.namespaceURI!=="http://www.w3.org/2000/svg"){var le=U.getAttribute(h)||"";le=s+le;var Ee=S.get(le);Ee?Ee.push(U):S.set(le,[U])}}return S}function nv(s,h,_){s=s.ownerDocument||s,s.head.insertBefore(_,h==="title"?s.querySelector("head > title"):null)}function ox(s,h,_){if(_===1||h.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof h.precedence!="string"||typeof h.href!="string"||h.href==="")break;return!0;case"link":if(typeof h.rel!="string"||typeof h.href!="string"||h.href===""||h.onLoad||h.onError)break;switch(h.rel){case"stylesheet":return s=h.disabled,typeof h.precedence=="string"&&s==null;default:return!0}case"script":if(h.async&&typeof h.async!="function"&&typeof h.async!="symbol"&&!h.onLoad&&!h.onError&&h.src&&typeof h.src=="string")return!0}return!1}function rm(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}var Of=null;function pg(){}function rv(s,h,_){if(Of===null)throw Error(C(475));var S=Of;if(h.type==="stylesheet"&&(typeof _.media!="string"||matchMedia(_.media).matches!==!1)&&(h.state.loading&4)===0){if(h.instance===null){var P=Fd(_.href),U=s.querySelector(Lf(P));if(U){s=U._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(S.count++,S=kf.bind(S),s.then(S,S)),h.state.loading|=4,h.instance=U,mi(U);return}U=s.ownerDocument||s,_=A_(_),(P=ys.get(P))&&C_(_,P),U=U.createElement("link"),mi(U);var le=U;le._p=new Promise(function(Ee,Ke){le.onload=Ee,le.onerror=Ke}),Na(U,"link",_),h.instance=U}S.stylesheets===null&&(S.stylesheets=new Map),S.stylesheets.set(h,s),(s=h.state.preload)&&(h.state.loading&3)===0&&(S.count++,h=kf.bind(S),s.addEventListener("load",h),s.addEventListener("error",h))}}function I_(){if(Of===null)throw Error(C(475));var s=Of;return s.stylesheets&&s.count===0&&D_(s,s.stylesheets),0<s.count?function(h){var _=setTimeout(function(){if(s.stylesheets&&D_(s,s.stylesheets),s.unsuspend){var S=s.unsuspend;s.unsuspend=null,S()}},6e4);return s.unsuspend=h,function(){s.unsuspend=null,clearTimeout(_)}}:null}function kf(){if(this.count--,this.count===0){if(this.stylesheets)D_(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var am=null;function D_(s,h){s.stylesheets=null,s.unsuspend!==null&&(s.count++,am=new Map,h.forEach(av,s),am=null,kf.call(s))}function av(s,h){if(!(h.state.loading&4)){var _=am.get(s);if(_)var S=_.get(null);else{_=new Map,am.set(s,_);for(var P=s.querySelectorAll("link[data-precedence],style[data-precedence]"),U=0;U<P.length;U++){var le=P[U];(le.nodeName==="LINK"||le.getAttribute("media")!=="not all")&&(_.set(le.dataset.precedence,le),S=le)}S&&_.set(null,S)}P=h.instance,le=P.getAttribute("data-precedence"),U=_.get(le)||S,U===S&&_.set(null,P),_.set(le,P),this.count++,S=kf.bind(this),P.addEventListener("load",S),P.addEventListener("error",S),U?U.parentNode.insertBefore(P,U.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(P,s.firstChild)),h.state.loading|=4}}var Nf={$$typeof:je,Provider:null,Consumer:null,_currentValue:_t,_currentValue2:_t,_threadCount:0};function ov(s,h,_,S,P,U,le,Ee){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Pa(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pa(0),this.hiddenUpdates=Pa(null),this.identifierPrefix=S,this.onUncaughtError=P,this.onCaughtError=U,this.onRecoverableError=le,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Ee,this.incompleteTransitions=new Map}function z_(s,h,_,S,P,U,le,Ee,Ke,Mt,Zt,oi){return s=new ov(s,h,_,le,Ee,Ke,Mt,oi),h=1,U===!0&&(h|=24),U=Po(3,null,null,h),s.current=U,U.stateNode=s,h=ih(),h.refCount++,s.pooledCache=h,h.refCount++,U.memoizedState={element:S,isDehydrated:_,cache:h},mf(U),s}function mg(s){return s?(s=Jl,s):Jl}function P_(s,h,_,S,P,U){P=mg(P),S.context===null?S.context=P:S.pendingContext=P,S=ol(h),S.payload={element:_},U=U===void 0?null:U,U!==null&&(S.callback=U),_=js(s,S,h),_!==null&&(Qa(_,s,h),sh(_,s,h))}function gg(s,h){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var _=s.retryLane;s.retryLane=_!==0&&_<h?_:h}}function L_(s,h){gg(s,h),(s=s.alternate)&&gg(s,h)}function sv(s){if(s.tag===13){var h=hs(s,67108864);h!==null&&Qa(h,s,67108864),L_(s,67108864)}}var _g=!0;function sx(s,h,_,S){var P=Je.T;Je.T=null;var U=jt.p;try{jt.p=2,Ac(s,h,_,S)}finally{jt.p=U,Je.T=P}}function lv(s,h,_,S){var P=Je.T;Je.T=null;var U=jt.p;try{jt.p=8,Ac(s,h,_,S)}finally{jt.p=U,Je.T=P}}function Ac(s,h,_,S){if(_g){var P=jd(S);if(P===null)eg(s,h,S,Th,_),O_(s,S);else if(cv(P,s,h,_,S))S.stopPropagation();else if(O_(s,S),h&4&&-1<vg.indexOf(s)){for(;P!==null;){var U=Pt(P);if(U!==null)switch(U.tag){case 3:if(U=U.stateNode,U.current.memoizedState.isDehydrated){var le=no(U.pendingLanes);if(le!==0){var Ee=U;for(Ee.pendingLanes|=2,Ee.entangledLanes|=2;le;){var Ke=1<<31-Hr(le);Ee.entanglements[1]|=Ke,le&=~Ke}Fl(U),(Ai&6)===0&&(ra=kr()+500,If(0))}}break;case 13:Ee=hs(U,2),Ee!==null&&Qa(Ee,U,2),kl(),L_(U,2)}if(U=jd(S),U===null&&eg(s,h,S,Th,_),U===P)break;P=U}P!==null&&S.stopPropagation()}else eg(s,h,S,null,_)}}function jd(s){return s=Vu(s),Bf(s)}var Th=null;function Bf(s){if(Th=null,s=ft(s),s!==null){var h=N(s);if(h===null)s=null;else{var _=h.tag;if(_===13){if(s=G(h),s!==null)return s;s=null}else if(_===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;s=null}else h!==s&&(s=null)}}return Th=s,null}function Ff(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(is()){case la:return 2;case vo:return 8;case Uo:case Da:return 32;case xo:return 268435456;default:return 32}default:return 32}}var yg=!1,Eu=null,Au=null,Mu=null,om=new Map,sm=new Map,Cu=[],vg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function O_(s,h){switch(s){case"focusin":case"focusout":Eu=null;break;case"dragenter":case"dragleave":Au=null;break;case"mouseover":case"mouseout":Mu=null;break;case"pointerover":case"pointerout":om.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":sm.delete(h.pointerId)}}function lm(s,h,_,S,P,U){return s===null||s.nativeEvent!==U?(s={blockedOn:h,domEventName:_,eventSystemFlags:S,nativeEvent:U,targetContainers:[P]},h!==null&&(h=Pt(h),h!==null&&sv(h)),s):(s.eventSystemFlags|=S,h=s.targetContainers,P!==null&&h.indexOf(P)===-1&&h.push(P),s)}function cv(s,h,_,S,P){switch(h){case"focusin":return Eu=lm(Eu,s,h,_,S,P),!0;case"dragenter":return Au=lm(Au,s,h,_,S,P),!0;case"mouseover":return Mu=lm(Mu,s,h,_,S,P),!0;case"pointerover":var U=P.pointerId;return om.set(U,lm(om.get(U)||null,s,h,_,S,P)),!0;case"gotpointercapture":return U=P.pointerId,sm.set(U,lm(sm.get(U)||null,s,h,_,S,P)),!0}return!1}function xg(s){var h=ft(s.target);if(h!==null){var _=N(h);if(_!==null){if(h=_.tag,h===13){if(h=G(_),h!==null){s.blockedOn=h,V(s.priority,function(){if(_.tag===13){var S=Ra();S=Go(S);var P=hs(_,S);P!==null&&Qa(P,_,S),L_(_,S)}});return}}else if(h===3&&_.stateNode.current.memoizedState.isDehydrated){s.blockedOn=_.tag===3?_.stateNode.containerInfo:null;return}}}s.blockedOn=null}function cm(s){if(s.blockedOn!==null)return!1;for(var h=s.targetContainers;0<h.length;){var _=jd(s.nativeEvent);if(_===null){_=s.nativeEvent;var S=new _.constructor(_.type,_);Sa=S,_.target.dispatchEvent(S),Sa=null}else return h=Pt(_),h!==null&&sv(h),s.blockedOn=_,!1;h.shift()}return!0}function k_(s,h,_){cm(s)&&_.delete(h)}function uv(){yg=!1,Eu!==null&&cm(Eu)&&(Eu=null),Au!==null&&cm(Au)&&(Au=null),Mu!==null&&cm(Mu)&&(Mu=null),om.forEach(k_),sm.forEach(k_)}function um(s,h){s.blockedOn===h&&(s.blockedOn=null,yg||(yg=!0,m.unstable_scheduleCallback(m.unstable_NormalPriority,uv)))}var hm=null;function hv(s){hm!==s&&(hm=s,m.unstable_scheduleCallback(m.unstable_NormalPriority,function(){hm===s&&(hm=null);for(var h=0;h<s.length;h+=3){var _=s[h],S=s[h+1],P=s[h+2];if(typeof S!="function"){if(Bf(S||_)===null)continue;break}var U=Pt(_);U!==null&&(s.splice(h,3),h-=3,uu(U,{pending:!0,data:P,method:_.method,action:S},S,P))}}))}function jf(s){function h(Ke){return um(Ke,s)}Eu!==null&&um(Eu,s),Au!==null&&um(Au,s),Mu!==null&&um(Mu,s),om.forEach(h),sm.forEach(h);for(var _=0;_<Cu.length;_++){var S=Cu[_];S.blockedOn===s&&(S.blockedOn=null)}for(;0<Cu.length&&(_=Cu[0],_.blockedOn===null);)xg(_),_.blockedOn===null&&Cu.shift();if(_=(s.ownerDocument||s).$$reactFormReplay,_!=null)for(S=0;S<_.length;S+=3){var P=_[S],U=_[S+1],le=P[ye]||null;if(typeof U=="function")le||hv(_);else if(le){var Ee=null;if(U&&U.hasAttribute("formAction")){if(P=U,le=U[ye]||null)Ee=le.formAction;else if(Bf(P)!==null)continue}else Ee=le.action;typeof Ee=="function"?_[S+1]=Ee:(_.splice(S,3),S-=3),hv(_)}}}function bg(s){this._internalRoot=s}Mc.prototype.render=bg.prototype.render=function(s){var h=this._internalRoot;if(h===null)throw Error(C(409));var _=h.current,S=Ra();P_(_,S,s,h,null,null)},Mc.prototype.unmount=bg.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var h=s.containerInfo;P_(s.current,2,null,s,null,null),kl(),h[we]=null}};function Mc(s){this._internalRoot=s}Mc.prototype.unstable_scheduleHydration=function(s){if(s){var h=de();s={blockedOn:null,target:s,priority:h};for(var _=0;_<Cu.length&&h!==0&&h<Cu[_].priority;_++);Cu.splice(_,0,s),_===0&&xg(s)}};var N_=b.version;if(N_!=="19.1.0")throw Error(C(527,N_,"19.1.0"));jt.findDOMNode=function(s){var h=s._reactInternals;if(h===void 0)throw typeof s.render=="function"?Error(C(188)):(s=Object.keys(s).join(","),Error(C(268,s)));return s=Z(h),s=s!==null?$(s):null,s=s===null?null:s.stateNode,s};var dv={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:Je,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var dm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!dm.isDisabled&&dm.supportsFiber)try{Ta=dm.inject(dv),Ir=dm}catch{}}return cy.createRoot=function(s,h){if(!L(s))throw Error(C(299));var _=!1,S="",P=yu,U=ph,le=Af,Ee=null;return h!=null&&(h.unstable_strictMode===!0&&(_=!0),h.identifierPrefix!==void 0&&(S=h.identifierPrefix),h.onUncaughtError!==void 0&&(P=h.onUncaughtError),h.onCaughtError!==void 0&&(U=h.onCaughtError),h.onRecoverableError!==void 0&&(le=h.onRecoverableError),h.unstable_transitionCallbacks!==void 0&&(Ee=h.unstable_transitionCallbacks)),h=z_(s,1,!1,null,null,_,S,P,U,le,Ee,null),s[we]=h.current,Jp(s),new bg(h)},cy.hydrateRoot=function(s,h,_){if(!L(s))throw Error(C(299));var S=!1,P="",U=yu,le=ph,Ee=Af,Ke=null,Mt=null;return _!=null&&(_.unstable_strictMode===!0&&(S=!0),_.identifierPrefix!==void 0&&(P=_.identifierPrefix),_.onUncaughtError!==void 0&&(U=_.onUncaughtError),_.onCaughtError!==void 0&&(le=_.onCaughtError),_.onRecoverableError!==void 0&&(Ee=_.onRecoverableError),_.unstable_transitionCallbacks!==void 0&&(Ke=_.unstable_transitionCallbacks),_.formState!==void 0&&(Mt=_.formState)),h=z_(s,1,!0,h,_??null,S,P,U,le,Ee,Ke,Mt),h.context=mg(null),_=h.current,S=Ra(),S=Go(S),P=ol(S),P.callback=null,js(_,P,S),_=S,h.current.lanes=_,As(h,_),Fl(h),s[we]=h.current,Jp(s),new Mc(h)},cy.version="19.1.0",cy}var l2;function AI(){if(l2)return ib.exports;l2=1;function m(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(m)}catch(b){console.error(b)}}return m(),ib.exports=EI(),ib.exports}var MI=AI(),uy={},c2;function CI(){if(c2)return uy;c2=1,Object.defineProperty(uy,"__esModule",{value:!0}),uy.parse=G,uy.serialize=$;const m=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,b=/^[\u0021-\u003A\u003C-\u007E]*$/,E=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,C=/^[\u0020-\u003A\u003D-\u007E]*$/,L=Object.prototype.toString,N=(()=>{const fe=function(){};return fe.prototype=Object.create(null),fe})();function G(fe,Re){const Ie=new N,be=fe.length;if(be<2)return Ie;const ke=(Re==null?void 0:Re.decode)||ie;let Oe=0;do{const Be=fe.indexOf("=",Oe);if(Be===-1)break;const je=fe.indexOf(";",Oe),at=je===-1?be:je;if(Be>at){Oe=fe.lastIndexOf(";",Be-1)+1;continue}const ut=r(fe,Oe,Be),Xe=Z(fe,Be,ut),Tt=fe.slice(ut,Xe);if(Ie[Tt]===void 0){let vt=r(fe,Be+1,at),ni=Z(fe,at,vt);const Pi=ke(fe.slice(vt,ni));Ie[Tt]=Pi}Oe=at+1}while(Oe<be);return Ie}function r(fe,Re,Ie){do{const be=fe.charCodeAt(Re);if(be!==32&&be!==9)return Re}while(++Re<Ie);return Ie}function Z(fe,Re,Ie){for(;Re>Ie;){const be=fe.charCodeAt(--Re);if(be!==32&&be!==9)return Re+1}return Ie}function $(fe,Re,Ie){const be=(Ie==null?void 0:Ie.encode)||encodeURIComponent;if(!m.test(fe))throw new TypeError(`argument name is invalid: ${fe}`);const ke=be(Re);if(!b.test(ke))throw new TypeError(`argument val is invalid: ${Re}`);let Oe=fe+"="+ke;if(!Ie)return Oe;if(Ie.maxAge!==void 0){if(!Number.isInteger(Ie.maxAge))throw new TypeError(`option maxAge is invalid: ${Ie.maxAge}`);Oe+="; Max-Age="+Ie.maxAge}if(Ie.domain){if(!E.test(Ie.domain))throw new TypeError(`option domain is invalid: ${Ie.domain}`);Oe+="; Domain="+Ie.domain}if(Ie.path){if(!C.test(Ie.path))throw new TypeError(`option path is invalid: ${Ie.path}`);Oe+="; Path="+Ie.path}if(Ie.expires){if(!oe(Ie.expires)||!Number.isFinite(Ie.expires.valueOf()))throw new TypeError(`option expires is invalid: ${Ie.expires}`);Oe+="; Expires="+Ie.expires.toUTCString()}if(Ie.httpOnly&&(Oe+="; HttpOnly"),Ie.secure&&(Oe+="; Secure"),Ie.partitioned&&(Oe+="; Partitioned"),Ie.priority)switch(typeof Ie.priority=="string"?Ie.priority.toLowerCase():void 0){case"low":Oe+="; Priority=Low";break;case"medium":Oe+="; Priority=Medium";break;case"high":Oe+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${Ie.priority}`)}if(Ie.sameSite)switch(typeof Ie.sameSite=="string"?Ie.sameSite.toLowerCase():Ie.sameSite){case!0:case"strict":Oe+="; SameSite=Strict";break;case"lax":Oe+="; SameSite=Lax";break;case"none":Oe+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${Ie.sameSite}`)}return Oe}function ie(fe){if(fe.indexOf("%")===-1)return fe;try{return decodeURIComponent(fe)}catch{return fe}}function oe(fe){return L.call(fe)==="[object Date]"}return uy}CI();/**
 * react-router v7.6.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var SS=m=>{throw TypeError(m)},RI=(m,b,E)=>b.has(m)||SS("Cannot "+E),ob=(m,b,E)=>(RI(m,b,"read from private field"),E?E.call(m):b.get(m)),II=(m,b,E)=>b.has(m)?SS("Cannot add the same private member more than once"):b instanceof WeakSet?b.add(m):b.set(m,E),u2="popstate";function DI(m={}){function b(C,L){let{pathname:N,search:G,hash:r}=C.location;return xy("",{pathname:N,search:G,hash:r},L.state&&L.state.usr||null,L.state&&L.state.key||"default")}function E(C,L){return typeof L=="string"?L:Yf(L)}return PI(b,E,null,m)}function Tr(m,b){if(m===!1||m===null||typeof m>"u")throw new Error(b)}function to(m,b){if(!m){typeof console<"u"&&console.warn(b);try{throw new Error(b)}catch{}}}function zI(){return Math.random().toString(36).substring(2,10)}function h2(m,b){return{usr:m.state,key:m.key,idx:b}}function xy(m,b,E=null,C){return{pathname:typeof m=="string"?m:m.pathname,search:"",hash:"",...typeof b=="string"?tp(b):b,state:E,key:b&&b.key||C||zI()}}function Yf({pathname:m="/",search:b="",hash:E=""}){return b&&b!=="?"&&(m+=b.charAt(0)==="?"?b:"?"+b),E&&E!=="#"&&(m+=E.charAt(0)==="#"?E:"#"+E),m}function tp(m){let b={};if(m){let E=m.indexOf("#");E>=0&&(b.hash=m.substring(E),m=m.substring(0,E));let C=m.indexOf("?");C>=0&&(b.search=m.substring(C),m=m.substring(0,C)),m&&(b.pathname=m)}return b}function PI(m,b,E,C={}){let{window:L=document.defaultView,v5Compat:N=!1}=C,G=L.history,r="POP",Z=null,$=ie();$==null&&($=0,G.replaceState({...G.state,idx:$},""));function ie(){return(G.state||{idx:null}).idx}function oe(){r="POP";let ke=ie(),Oe=ke==null?null:ke-$;$=ke,Z&&Z({action:r,location:be.location,delta:Oe})}function fe(ke,Oe){r="PUSH";let Be=xy(be.location,ke,Oe);$=ie()+1;let je=h2(Be,$),at=be.createHref(Be);try{G.pushState(je,"",at)}catch(ut){if(ut instanceof DOMException&&ut.name==="DataCloneError")throw ut;L.location.assign(at)}N&&Z&&Z({action:r,location:be.location,delta:1})}function Re(ke,Oe){r="REPLACE";let Be=xy(be.location,ke,Oe);$=ie();let je=h2(Be,$),at=be.createHref(Be);G.replaceState(je,"",at),N&&Z&&Z({action:r,location:be.location,delta:0})}function Ie(ke){return ES(ke)}let be={get action(){return r},get location(){return m(L,G)},listen(ke){if(Z)throw new Error("A history only accepts one active listener");return L.addEventListener(u2,oe),Z=ke,()=>{L.removeEventListener(u2,oe),Z=null}},createHref(ke){return b(L,ke)},createURL:Ie,encodeLocation(ke){let Oe=Ie(ke);return{pathname:Oe.pathname,search:Oe.search,hash:Oe.hash}},push:fe,replace:Re,go(ke){return G.go(ke)}};return be}function ES(m,b=!1){let E="http://localhost";typeof window<"u"&&(E=window.location.origin!=="null"?window.location.origin:window.location.href),Tr(E,"No window.location.(origin|href) available to create URL");let C=typeof m=="string"?m:Yf(m);return C=C.replace(/ $/,"%20"),!b&&C.startsWith("//")&&(C=E+C),new URL(C,E)}var my,d2=class{constructor(m){if(II(this,my,new Map),m)for(let[b,E]of m)this.set(b,E)}get(m){if(ob(this,my).has(m))return ob(this,my).get(m);if(m.defaultValue!==void 0)return m.defaultValue;throw new Error("No value found for context")}set(m,b){ob(this,my).set(m,b)}};my=new WeakMap;var LI=new Set(["lazy","caseSensitive","path","id","index","children"]);function OI(m){return LI.has(m)}var kI=new Set(["lazy","caseSensitive","path","id","index","unstable_middleware","children"]);function NI(m){return kI.has(m)}function BI(m){return m.index===!0}function d0(m,b,E=[],C={}){return m.map((L,N)=>{let G=[...E,String(N)],r=typeof L.id=="string"?L.id:G.join("-");if(Tr(L.index!==!0||!L.children,"Cannot specify children on an index route"),Tr(!C[r],`Found a route id collision on id "${r}".  Route id's must be globally unique within Data Router usages`),BI(L)){let Z={...L,...b(L),id:r};return C[r]=Z,Z}else{let Z={...L,...b(L),id:r,children:void 0};return C[r]=Z,L.children&&(Z.children=d0(L.children,b,G,C)),Z}})}function Wf(m,b,E="/"){return a0(m,b,E,!1)}function a0(m,b,E,C){let L=typeof b=="string"?tp(b):b,N=zc(L.pathname||"/",E);if(N==null)return null;let G=AS(m);jI(G);let r=null;for(let Z=0;r==null&&Z<G.length;++Z){let $=KI(N);r=WI(G[Z],$,C)}return r}function FI(m,b){let{route:E,pathname:C,params:L}=m;return{id:E.id,pathname:C,params:L,data:b[E.id],handle:E.handle}}function AS(m,b=[],E=[],C=""){let L=(N,G,r)=>{let Z={relativePath:r===void 0?N.path||"":r,caseSensitive:N.caseSensitive===!0,childrenIndex:G,route:N};Z.relativePath.startsWith("/")&&(Tr(Z.relativePath.startsWith(C),`Absolute route path "${Z.relativePath}" nested under path "${C}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),Z.relativePath=Z.relativePath.slice(C.length));let $=Mh([C,Z.relativePath]),ie=E.concat(Z);N.children&&N.children.length>0&&(Tr(N.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${$}".`),AS(N.children,b,ie,$)),!(N.path==null&&!N.index)&&b.push({path:$,score:ZI($,N.index),routesMeta:ie})};return m.forEach((N,G)=>{var r;if(N.path===""||!((r=N.path)!=null&&r.includes("?")))L(N,G);else for(let Z of MS(N.path))L(N,G,Z)}),b}function MS(m){let b=m.split("/");if(b.length===0)return[];let[E,...C]=b,L=E.endsWith("?"),N=E.replace(/\?$/,"");if(C.length===0)return L?[N,""]:[N];let G=MS(C.join("/")),r=[];return r.push(...G.map(Z=>Z===""?N:[N,Z].join("/"))),L&&r.push(...G),r.map(Z=>m.startsWith("/")&&Z===""?"/":Z)}function jI(m){m.sort((b,E)=>b.score!==E.score?E.score-b.score:XI(b.routesMeta.map(C=>C.childrenIndex),E.routesMeta.map(C=>C.childrenIndex)))}var UI=/^:[\w-]+$/,VI=3,GI=2,HI=1,qI=10,$I=-2,f2=m=>m==="*";function ZI(m,b){let E=m.split("/"),C=E.length;return E.some(f2)&&(C+=$I),b&&(C+=GI),E.filter(L=>!f2(L)).reduce((L,N)=>L+(UI.test(N)?VI:N===""?HI:qI),C)}function XI(m,b){return m.length===b.length&&m.slice(0,-1).every((C,L)=>C===b[L])?m[m.length-1]-b[b.length-1]:0}function WI(m,b,E=!1){let{routesMeta:C}=m,L={},N="/",G=[];for(let r=0;r<C.length;++r){let Z=C[r],$=r===C.length-1,ie=N==="/"?b:b.slice(N.length)||"/",oe=f0({path:Z.relativePath,caseSensitive:Z.caseSensitive,end:$},ie),fe=Z.route;if(!oe&&$&&E&&!C[C.length-1].route.index&&(oe=f0({path:Z.relativePath,caseSensitive:Z.caseSensitive,end:!1},ie)),!oe)return null;Object.assign(L,oe.params),G.push({params:L,pathname:Mh([N,oe.pathname]),pathnameBase:eD(Mh([N,oe.pathnameBase])),route:fe}),oe.pathnameBase!=="/"&&(N=Mh([N,oe.pathnameBase]))}return G}function f0(m,b){typeof m=="string"&&(m={path:m,caseSensitive:!1,end:!0});let[E,C]=YI(m.path,m.caseSensitive,m.end),L=b.match(E);if(!L)return null;let N=L[0],G=N.replace(/(.)\/+$/,"$1"),r=L.slice(1);return{params:C.reduce(($,{paramName:ie,isOptional:oe},fe)=>{if(ie==="*"){let Ie=r[fe]||"";G=N.slice(0,N.length-Ie.length).replace(/(.)\/+$/,"$1")}const Re=r[fe];return oe&&!Re?$[ie]=void 0:$[ie]=(Re||"").replace(/%2F/g,"/"),$},{}),pathname:N,pathnameBase:G,pattern:m}}function YI(m,b=!1,E=!0){to(m==="*"||!m.endsWith("*")||m.endsWith("/*"),`Route path "${m}" will be treated as if it were "${m.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${m.replace(/\*$/,"/*")}".`);let C=[],L="^"+m.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(G,r,Z)=>(C.push({paramName:r,isOptional:Z!=null}),Z?"/?([^\\/]+)?":"/([^\\/]+)"));return m.endsWith("*")?(C.push({paramName:"*"}),L+=m==="*"||m==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):E?L+="\\/*$":m!==""&&m!=="/"&&(L+="(?:(?=\\/|$))"),[new RegExp(L,b?void 0:"i"),C]}function KI(m){try{return m.split("/").map(b=>decodeURIComponent(b).replace(/\//g,"%2F")).join("/")}catch(b){return to(!1,`The URL path "${m}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${b}).`),m}}function zc(m,b){if(b==="/")return m;if(!m.toLowerCase().startsWith(b.toLowerCase()))return null;let E=b.endsWith("/")?b.length-1:b.length,C=m.charAt(E);return C&&C!=="/"?null:m.slice(E)||"/"}function QI(m,b="/"){let{pathname:E,search:C="",hash:L=""}=typeof m=="string"?tp(m):m;return{pathname:E?E.startsWith("/")?E:JI(E,b):b,search:tD(C),hash:iD(L)}}function JI(m,b){let E=b.replace(/\/+$/,"").split("/");return m.split("/").forEach(L=>{L===".."?E.length>1&&E.pop():L!=="."&&E.push(L)}),E.length>1?E.join("/"):"/"}function sb(m,b,E,C){return`Cannot include a '${m}' character in a manually specified \`to.${b}\` field [${JSON.stringify(C)}].  Please separate it out to the \`to.${E}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function CS(m){return m.filter((b,E)=>E===0||b.route.path&&b.route.path.length>0)}function Kb(m){let b=CS(m);return b.map((E,C)=>C===b.length-1?E.pathname:E.pathnameBase)}function Qb(m,b,E,C=!1){let L;typeof m=="string"?L=tp(m):(L={...m},Tr(!L.pathname||!L.pathname.includes("?"),sb("?","pathname","search",L)),Tr(!L.pathname||!L.pathname.includes("#"),sb("#","pathname","hash",L)),Tr(!L.search||!L.search.includes("#"),sb("#","search","hash",L)));let N=m===""||L.pathname==="",G=N?"/":L.pathname,r;if(G==null)r=E;else{let oe=b.length-1;if(!C&&G.startsWith("..")){let fe=G.split("/");for(;fe[0]==="..";)fe.shift(),oe-=1;L.pathname=fe.join("/")}r=oe>=0?b[oe]:"/"}let Z=QI(L,r),$=G&&G!=="/"&&G.endsWith("/"),ie=(N||G===".")&&E.endsWith("/");return!Z.pathname.endsWith("/")&&($||ie)&&(Z.pathname+="/"),Z}var Mh=m=>m.join("/").replace(/\/\/+/g,"/"),eD=m=>m.replace(/\/+$/,"").replace(/^\/*/,"/"),tD=m=>!m||m==="?"?"":m.startsWith("?")?m:"?"+m,iD=m=>!m||m==="#"?"":m.startsWith("#")?m:"#"+m,p0=class{constructor(m,b,E,C=!1){this.status=m,this.statusText=b||"",this.internal=C,E instanceof Error?(this.data=E.toString(),this.error=E):this.data=E}};function by(m){return m!=null&&typeof m.status=="number"&&typeof m.statusText=="string"&&typeof m.internal=="boolean"&&"data"in m}var RS=["POST","PUT","PATCH","DELETE"],nD=new Set(RS),rD=["GET",...RS],aD=new Set(rD),oD=new Set([301,302,303,307,308]),sD=new Set([307,308]),lb={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},lD={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},hy={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},Jb=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,cD=m=>({hasErrorBoundary:!!m.hasErrorBoundary}),IS="remix-router-transitions",DS=Symbol("ResetLoaderData");function uD(m){const b=m.window?m.window:typeof window<"u"?window:void 0,E=typeof b<"u"&&typeof b.document<"u"&&typeof b.document.createElement<"u";Tr(m.routes.length>0,"You must provide a non-empty routes array to createRouter");let C=m.hydrationRouteProperties||[],L=m.mapRouteProperties||cD,N={},G=d0(m.routes,L,void 0,N),r,Z=m.basename||"/",$=m.dataStrategy||mD,ie={unstable_middleware:!1,...m.future},oe=null,fe=new Set,Re=null,Ie=null,be=null,ke=m.hydrationData!=null,Oe=Wf(G,m.history.location,Z),Be=!1,je=null,at;if(Oe==null&&!m.patchRoutesOnNavigation){let de=Ic(404,{pathname:m.history.location.pathname}),{matches:V,route:W}=E2(G);at=!0,Oe=V,je={[W.id]:de}}else if(Oe&&!m.hydrationData&&Ms(Oe,G,m.history.location.pathname).active&&(Oe=null),Oe)if(Oe.some(de=>de.route.lazy))at=!1;else if(!Oe.some(de=>de.route.loader))at=!0;else{let de=m.hydrationData?m.hydrationData.loaderData:null,V=m.hydrationData?m.hydrationData.errors:null;if(V){let W=Oe.findIndex(ae=>V[ae.route.id]!==void 0);at=Oe.slice(0,W+1).every(ae=>!Ab(ae.route,de,V))}else at=Oe.every(W=>!Ab(W.route,de,V))}else{at=!1,Oe=[];let de=Ms(null,G,m.history.location.pathname);de.active&&de.matches&&(Be=!0,Oe=de.matches)}let ut,Xe={historyAction:m.history.action,location:m.history.location,matches:Oe,initialized:at,navigation:lb,restoreScrollPosition:m.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:m.hydrationData&&m.hydrationData.loaderData||{},actionData:m.hydrationData&&m.hydrationData.actionData||null,errors:m.hydrationData&&m.hydrationData.errors||je,fetchers:new Map,blockers:new Map},Tt="POP",vt=!1,ni,Pi=!1,xi=new Map,Fi=null,Ei=!1,fi=!1,yi=new Set,Je=new Map,jt=0,_t=-1,$t=new Map,Fe=new Set,zt=new Map,_i=new Map,Jt=new Set,bi=new Map,Ci,pi=null;function ri(){if(oe=m.history.listen(({action:de,location:V,delta:W})=>{if(Ci){Ci(),Ci=void 0;return}to(bi.size===0||W!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let ae=Jn({currentLocation:Xe.location,nextLocation:V,historyAction:de});if(ae&&W!=null){let ye=new Promise(we=>{Ci=we});m.history.go(W*-1),wo(ae,{state:"blocked",location:V,proceed(){wo(ae,{state:"proceeding",proceed:void 0,reset:void 0,location:V}),ye.then(()=>m.history.go(W))},reset(){let we=new Map(Xe.blockers);we.set(ae,hy),rn({blockers:we})}});return}return Jr(de,V)}),E){AD(b,xi);let de=()=>MD(b,xi);b.addEventListener("pagehide",de),Fi=()=>b.removeEventListener("pagehide",de)}return Xe.initialized||Jr("POP",Xe.location,{initialHydration:!0}),ut}function Yi(){oe&&oe(),Fi&&Fi(),fe.clear(),ni&&ni.abort(),Xe.fetchers.forEach((de,V)=>Hr(V)),Xe.blockers.forEach((de,V)=>Vo(V))}function Vi(de){return fe.add(de),()=>fe.delete(de)}function rn(de,V={}){Xe={...Xe,...de};let W=[],ae=[];Xe.fetchers.forEach((ye,we)=>{ye.state==="idle"&&(Jt.has(we)?W.push(we):ae.push(we))}),Jt.forEach(ye=>{!Xe.fetchers.has(ye)&&!Je.has(ye)&&W.push(ye)}),[...fe].forEach(ye=>ye(Xe,{deletedFetchers:W,viewTransitionOpts:V.viewTransitionOpts,flushSync:V.flushSync===!0})),W.forEach(ye=>Hr(ye)),ae.forEach(ye=>Xe.fetchers.delete(ye))}function xn(de,V,{flushSync:W}={}){var He,Ye;let ae=Xe.actionData!=null&&Xe.navigation.formMethod!=null&&Gl(Xe.navigation.formMethod)&&Xe.navigation.state==="loading"&&((He=de.state)==null?void 0:He._isRedirect)!==!0,ye;V.actionData?Object.keys(V.actionData).length>0?ye=V.actionData:ye=null:ae?ye=Xe.actionData:ye=null;let we=V.loaderData?T2(Xe.loaderData,V.loaderData,V.matches||[],V.errors):Xe.loaderData,De=Xe.blockers;De.size>0&&(De=new Map(De),De.forEach((Ve,ft)=>De.set(ft,hy)));let Me=vt===!0||Xe.navigation.formMethod!=null&&Gl(Xe.navigation.formMethod)&&((Ye=de.state)==null?void 0:Ye._isRedirect)!==!0;r&&(G=r,r=void 0),Ei||Tt==="POP"||(Tt==="PUSH"?m.history.push(de,de.state):Tt==="REPLACE"&&m.history.replace(de,de.state));let Pe;if(Tt==="POP"){let Ve=xi.get(Xe.location.pathname);Ve&&Ve.has(de.pathname)?Pe={currentLocation:Xe.location,nextLocation:de}:xi.has(de.pathname)&&(Pe={currentLocation:de,nextLocation:Xe.location})}else if(Pi){let Ve=xi.get(Xe.location.pathname);Ve?Ve.add(de.pathname):(Ve=new Set([de.pathname]),xi.set(Xe.location.pathname,Ve)),Pe={currentLocation:Xe.location,nextLocation:de}}rn({...V,actionData:ye,loaderData:we,historyAction:Tt,location:de,initialized:!0,navigation:lb,revalidation:"idle",restoreScrollPosition:Pc(de,V.matches||Xe.matches),preventScrollReset:Me,blockers:De},{viewTransitionOpts:Pe,flushSync:W===!0}),Tt="POP",vt=!1,Pi=!1,Ei=!1,fi=!1,pi==null||pi.resolve(),pi=null}async function _n(de,V){if(typeof de=="number"){m.history.go(de);return}let W=Eb(Xe.location,Xe.matches,Z,de,V==null?void 0:V.fromRouteId,V==null?void 0:V.relative),{path:ae,submission:ye,error:we}=p2(!1,W,V),De=Xe.location,Me=xy(Xe.location,ae,V&&V.state);Me={...Me,...m.history.encodeLocation(Me)};let Pe=V&&V.replace!=null?V.replace:void 0,He="PUSH";Pe===!0?He="REPLACE":Pe===!1||ye!=null&&Gl(ye.formMethod)&&ye.formAction===Xe.location.pathname+Xe.location.search&&(He="REPLACE");let Ye=V&&"preventScrollReset"in V?V.preventScrollReset===!0:void 0,Ve=(V&&V.flushSync)===!0,ft=Jn({currentLocation:De,nextLocation:Me,historyAction:He});if(ft){wo(ft,{state:"blocked",location:Me,proceed(){wo(ft,{state:"proceeding",proceed:void 0,reset:void 0,location:Me}),_n(de,V)},reset(){let Pt=new Map(Xe.blockers);Pt.set(ft,hy),rn({blockers:Pt})}});return}await Jr(He,Me,{submission:ye,pendingError:we,preventScrollReset:Ye,replace:V&&V.replace,enableViewTransition:V&&V.viewTransition,flushSync:Ve})}function Rn(){pi||(pi=CD()),za(),rn({revalidation:"loading"});let de=pi.promise;return Xe.navigation.state==="submitting"?de:Xe.navigation.state==="idle"?(Jr(Xe.historyAction,Xe.location,{startUninterruptedRevalidation:!0}),de):(Jr(Tt||Xe.historyAction,Xe.navigation.location,{overrideNavigation:Xe.navigation,enableViewTransition:Pi===!0}),de)}async function Jr(de,V,W){ni&&ni.abort(),ni=null,Tt=de,Ei=(W&&W.startUninterruptedRevalidation)===!0,As(Xe.location,Xe.matches),vt=(W&&W.preventScrollReset)===!0,Pi=(W&&W.enableViewTransition)===!0;let ae=r||G,ye=W&&W.overrideNavigation,we=W!=null&&W.initialHydration&&Xe.matches&&Xe.matches.length>0&&!Be?Xe.matches:Wf(ae,V,Z),De=(W&&W.flushSync)===!0;if(we&&Xe.initialized&&!fi&&bD(Xe.location,V)&&!(W&&W.submission&&Gl(W.submission.formMethod))){xn(V,{matches:we},{flushSync:De});return}let Me=Ms(we,ae,V.pathname);if(Me.active&&Me.matches&&(we=Me.matches),!we){let{error:vi,notFoundMatches:mi,route:gi}=ro(V.pathname);xn(V,{matches:mi,loaderData:{},errors:{[gi.id]:vi}},{flushSync:De});return}ni=new AbortController;let Pe=jg(m.history,V,ni.signal,W&&W.submission),He=new d2(m.unstable_getContext?await m.unstable_getContext():void 0),Ye;if(W&&W.pendingError)Ye=[bm(we).route.id,{type:"error",error:W.pendingError}];else if(W&&W.submission&&Gl(W.submission.formMethod)){let vi=await io(Pe,V,W.submission,we,He,Me.active,W&&W.initialHydration===!0,{replace:W.replace,flushSync:De});if(vi.shortCircuited)return;if(vi.pendingActionResult){let[mi,gi]=vi.pendingActionResult;if(Vl(gi)&&by(gi.error)&&gi.error.status===404){ni=null,xn(V,{matches:vi.matches,loaderData:{},errors:{[mi]:gi.error}});return}}we=vi.matches||we,Ye=vi.pendingActionResult,ye=cb(V,W.submission),De=!1,Me.active=!1,Pe=jg(m.history,Pe.url,Pe.signal)}let{shortCircuited:Ve,matches:ft,loaderData:Pt,errors:Vt}=await ea(Pe,V,we,He,Me.active,ye,W&&W.submission,W&&W.fetcherSubmission,W&&W.replace,W&&W.initialHydration===!0,De,Ye);Ve||(ni=null,xn(V,{matches:ft||we,...S2(Ye),loaderData:Pt,errors:Vt}))}async function io(de,V,W,ae,ye,we,De,Me={}){za();let Pe=SD(V,W);if(rn({navigation:Pe},{flushSync:Me.flushSync===!0}),we){let Ve=await Bt(ae,V.pathname,de.signal);if(Ve.type==="aborted")return{shortCircuited:!0};if(Ve.type==="error"){let ft=bm(Ve.partialMatches).route.id;return{matches:Ve.partialMatches,pendingActionResult:[ft,{type:"error",error:Ve.error}]}}else if(Ve.matches)ae=Ve.matches;else{let{notFoundMatches:ft,error:Pt,route:Vt}=ro(V.pathname);return{matches:ft,pendingActionResult:[Vt.id,{type:"error",error:Pt}]}}}let He,Ye=gy(ae,V);if(!Ye.route.action&&!Ye.route.lazy)He={type:"error",error:Ic(405,{method:de.method,pathname:V.pathname,routeId:Ye.route.id})};else{let Ve=Vg(L,N,de,ae,Ye,De?[]:C,ye),ft=await xo(de,Ve,ye,null);if(He=ft[Ye.route.id],!He){for(let Pt of ae)if(ft[Pt.route.id]){He=ft[Pt.route.id];break}}if(de.signal.aborted)return{shortCircuited:!0}}if(wm(He)){let Ve;return Me&&Me.replace!=null?Ve=Me.replace:Ve=x2(He.response.headers.get("Location"),new URL(de.url),Z)===Xe.location.pathname+Xe.location.search,await Da(de,He,!0,{submission:W,replace:Ve}),{shortCircuited:!0}}if(Vl(He)){let Ve=bm(ae,Ye.route.id);return(Me&&Me.replace)!==!0&&(Tt="PUSH"),{matches:ae,pendingActionResult:[Ve.route.id,He,Ye.route.id]}}return{matches:ae,pendingActionResult:[Ye.route.id,He]}}async function ea(de,V,W,ae,ye,we,De,Me,Pe,He,Ye,Ve){let ft=we||cb(V,De),Pt=De||Me||M2(ft),Vt=!Ei&&!He;if(ye){if(Vt){let gr=kr(Ve);rn({navigation:ft,...gr!==void 0?{actionData:gr}:{}},{flushSync:Ye})}let sn=await Bt(W,V.pathname,de.signal);if(sn.type==="aborted")return{shortCircuited:!0};if(sn.type==="error"){let gr=bm(sn.partialMatches).route.id;return{matches:sn.partialMatches,loaderData:{},errors:{[gr]:sn.error}}}else if(sn.matches)W=sn.matches;else{let{error:gr,notFoundMatches:ya,route:Nr}=ro(V.pathname);return{matches:ya,loaderData:{},errors:{[Nr.id]:gr}}}}let vi=r||G,{dsMatches:mi,revalidatingFetchers:gi}=m2(de,ae,L,N,m.history,Xe,W,Pt,V,He?[]:C,He===!0,fi,yi,Jt,zt,Fe,vi,Z,Ve);if(_t=++jt,!m.dataStrategy&&!mi.some(sn=>sn.shouldLoad)&&gi.length===0){let sn=bo();return xn(V,{matches:W,loaderData:{},errors:Ve&&Vl(Ve[1])?{[Ve[0]]:Ve[1].error}:null,...S2(Ve),...sn?{fetchers:new Map(Xe.fetchers)}:{}},{flushSync:Ye}),{shortCircuited:!0}}if(Vt){let sn={};if(!ye){sn.navigation=ft;let gr=kr(Ve);gr!==void 0&&(sn.actionData=gr)}gi.length>0&&(sn.fetchers=is(gi)),rn(sn,{flushSync:Ye})}gi.forEach(sn=>{ta(sn.key),sn.controller&&Je.set(sn.key,sn.controller)});let Gi=()=>gi.forEach(sn=>ta(sn.key));ni&&ni.signal.addEventListener("abort",Gi);let{loaderResults:In,fetcherResults:Ui}=await wa(mi,gi,de,ae);if(de.signal.aborted)return{shortCircuited:!0};ni&&ni.signal.removeEventListener("abort",Gi),gi.forEach(sn=>Je.delete(sn.key));let yn=Wv(In);if(yn)return await Da(de,yn.result,!0,{replace:Pe}),{shortCircuited:!0};if(yn=Wv(Ui),yn)return Fe.add(yn.key),await Da(de,yn.result,!0,{replace:Pe}),{shortCircuited:!0};let{loaderData:ln,errors:Dn}=w2(Xe,W,In,Ve,gi,Ui);He&&Xe.errors&&(Dn={...Xe.errors,...Dn});let Gn=bo(),Yn=Ua(_t),Er=Gn||Yn||gi.length>0;return{matches:W,loaderData:ln,errors:Dn,...Er?{fetchers:new Map(Xe.fetchers)}:{}}}function kr(de){if(de&&!Vl(de[1]))return{[de[0]]:de[1].data};if(Xe.actionData)return Object.keys(Xe.actionData).length===0?null:Xe.actionData}function is(de){return de.forEach(V=>{let W=Xe.fetchers.get(V.key),ae=dy(void 0,W?W.data:void 0);Xe.fetchers.set(V.key,ae)}),new Map(Xe.fetchers)}async function la(de,V,W,ae){ta(de);let ye=(ae&&ae.flushSync)===!0,we=r||G,De=Eb(Xe.location,Xe.matches,Z,W,V,ae==null?void 0:ae.relative),Me=Wf(we,De,Z),Pe=Ms(Me,we,De);if(Pe.active&&Pe.matches&&(Me=Pe.matches),!Me){Ir(de,V,Ic(404,{pathname:De}),{flushSync:ye});return}let{path:He,submission:Ye,error:Ve}=p2(!0,De,ae);if(Ve){Ir(de,V,Ve,{flushSync:ye});return}let ft=gy(Me,He),Pt=new d2(m.unstable_getContext?await m.unstable_getContext():void 0),Vt=(ae&&ae.preventScrollReset)===!0;if(Ye&&Gl(Ye.formMethod)){await vo(de,V,He,ft,Me,Pt,Pe.active,ye,Vt,Ye);return}zt.set(de,{routeId:V,path:He}),await Uo(de,V,He,ft,Me,Pt,Pe.active,ye,Vt,Ye)}async function vo(de,V,W,ae,ye,we,De,Me,Pe,He){za(),zt.delete(de);function Ye(Bn){if(!Bn.route.action&&!Bn.route.lazy){let Wr=Ic(405,{method:He.formMethod,pathname:W,routeId:V});return Ir(de,V,Wr,{flushSync:Me}),!0}return!1}if(!De&&Ye(ae))return;let Ve=Xe.fetchers.get(de);Ta(de,ED(He,Ve),{flushSync:Me});let ft=new AbortController,Pt=jg(m.history,W,ft.signal,He);if(De){let Bn=await Bt(ye,W,Pt.signal,de);if(Bn.type==="aborted")return;if(Bn.type==="error"){Ir(de,V,Bn.error,{flushSync:Me});return}else if(Bn.matches){if(ye=Bn.matches,ae=gy(ye,W),Ye(ae))return}else{Ir(de,V,Ic(404,{pathname:W}),{flushSync:Me});return}}Je.set(de,ft);let Vt=jt,vi=Vg(L,N,Pt,ye,ae,C,we),gi=(await xo(Pt,vi,we,de))[ae.route.id];if(Pt.signal.aborted){Je.get(de)===ft&&Je.delete(de);return}if(Jt.has(de)){if(wm(gi)||Vl(gi)){Ta(de,Zf(void 0));return}}else{if(wm(gi))if(Je.delete(de),_t>Vt){Ta(de,Zf(void 0));return}else return Fe.add(de),Ta(de,dy(He)),Da(Pt,gi,!1,{fetcherSubmission:He,preventScrollReset:Pe});if(Vl(gi)){Ir(de,V,gi.error);return}}let Gi=Xe.navigation.location||Xe.location,In=jg(m.history,Gi,ft.signal),Ui=r||G,yn=Xe.navigation.state!=="idle"?Wf(Ui,Xe.navigation.location,Z):Xe.matches;Tr(yn,"Didn't find any matches after fetcher action");let ln=++jt;$t.set(de,ln);let Dn=dy(He,gi.data);Xe.fetchers.set(de,Dn);let{dsMatches:Gn,revalidatingFetchers:Yn}=m2(In,we,L,N,m.history,Xe,yn,He,Gi,C,!1,fi,yi,Jt,zt,Fe,Ui,Z,[ae.route.id,gi]);Yn.filter(Bn=>Bn.key!==de).forEach(Bn=>{let Wr=Bn.key,To=Xe.fetchers.get(Wr),ma=dy(void 0,To?To.data:void 0);Xe.fetchers.set(Wr,ma),ta(Wr),Bn.controller&&Je.set(Wr,Bn.controller)}),rn({fetchers:new Map(Xe.fetchers)});let Er=()=>Yn.forEach(Bn=>ta(Bn.key));ft.signal.addEventListener("abort",Er);let{loaderResults:sn,fetcherResults:gr}=await wa(Gn,Yn,In,we);if(ft.signal.aborted)return;if(ft.signal.removeEventListener("abort",Er),$t.delete(de),Je.delete(de),Yn.forEach(Bn=>Je.delete(Bn.key)),Xe.fetchers.has(de)){let Bn=Zf(gi.data);Xe.fetchers.set(de,Bn)}let ya=Wv(sn);if(ya)return Da(In,ya.result,!1,{preventScrollReset:Pe});if(ya=Wv(gr),ya)return Fe.add(ya.key),Da(In,ya.result,!1,{preventScrollReset:Pe});let{loaderData:Nr,errors:aa}=w2(Xe,yn,sn,void 0,Yn,gr);Ua(ln),Xe.navigation.state==="loading"&&ln>_t?(Tr(Tt,"Expected pending action"),ni&&ni.abort(),xn(Xe.navigation.location,{matches:yn,loaderData:Nr,errors:aa,fetchers:new Map(Xe.fetchers)})):(rn({errors:aa,loaderData:T2(Xe.loaderData,Nr,yn,aa),fetchers:new Map(Xe.fetchers)}),fi=!1)}async function Uo(de,V,W,ae,ye,we,De,Me,Pe,He){let Ye=Xe.fetchers.get(de);Ta(de,dy(He,Ye?Ye.data:void 0),{flushSync:Me});let Ve=new AbortController,ft=jg(m.history,W,Ve.signal);if(De){let gi=await Bt(ye,W,ft.signal,de);if(gi.type==="aborted")return;if(gi.type==="error"){Ir(de,V,gi.error,{flushSync:Me});return}else if(gi.matches)ye=gi.matches,ae=gy(ye,W);else{Ir(de,V,Ic(404,{pathname:W}),{flushSync:Me});return}}Je.set(de,Ve);let Pt=jt,Vt=Vg(L,N,ft,ye,ae,C,we),mi=(await xo(ft,Vt,we,de))[ae.route.id];if(Je.get(de)===Ve&&Je.delete(de),!ft.signal.aborted){if(Jt.has(de)){Ta(de,Zf(void 0));return}if(wm(mi))if(_t>Pt){Ta(de,Zf(void 0));return}else{Fe.add(de),await Da(ft,mi,!1,{preventScrollReset:Pe});return}if(Vl(mi)){Ir(de,V,mi.error);return}Ta(de,Zf(mi.data))}}async function Da(de,V,W,{submission:ae,fetcherSubmission:ye,preventScrollReset:we,replace:De}={}){V.response.headers.has("X-Remix-Revalidate")&&(fi=!0);let Me=V.response.headers.get("Location");Tr(Me,"Expected a Location header on the redirect Response"),Me=x2(Me,new URL(de.url),Z);let Pe=xy(Xe.location,Me,{_isRedirect:!0});if(E){let Vt=!1;if(V.response.headers.has("X-Remix-Reload-Document"))Vt=!0;else if(Jb.test(Me)){const vi=ES(Me,!0);Vt=vi.origin!==b.location.origin||zc(vi.pathname,Z)==null}if(Vt){De?b.location.replace(Me):b.location.assign(Me);return}}ni=null;let He=De===!0||V.response.headers.has("X-Remix-Replace")?"REPLACE":"PUSH",{formMethod:Ye,formAction:Ve,formEncType:ft}=Xe.navigation;!ae&&!ye&&Ye&&Ve&&ft&&(ae=M2(Xe.navigation));let Pt=ae||ye;if(sD.has(V.response.status)&&Pt&&Gl(Pt.formMethod))await Jr(He,Pe,{submission:{...Pt,formAction:Me},preventScrollReset:we||vt,enableViewTransition:W?Pi:void 0});else{let Vt=cb(Pe,ae);await Jr(He,Pe,{overrideNavigation:Vt,fetcherSubmission:ye,preventScrollReset:we||vt,enableViewTransition:W?Pi:void 0})}}async function xo(de,V,W,ae){let ye,we={};try{ye=await gD($,de,V,ae,W,!1)}catch(De){return V.filter(Me=>Me.shouldLoad).forEach(Me=>{we[Me.route.id]={type:"error",error:De}}),we}if(de.signal.aborted)return we;for(let[De,Me]of Object.entries(ye))if(wD(Me)){let Pe=Me.result;we[De]={type:"redirect",response:vD(Pe,de,De,V,Z)}}else we[De]=await yD(Me);return we}async function wa(de,V,W,ae){let ye=xo(W,de,ae,null),we=Promise.all(V.map(async Pe=>{if(Pe.matches&&Pe.match&&Pe.request&&Pe.controller){let Ye=(await xo(Pe.request,Pe.matches,ae,Pe.key))[Pe.match.route.id];return{[Pe.key]:Ye}}else return Promise.resolve({[Pe.key]:{type:"error",error:Ic(404,{pathname:Pe.path})}})})),De=await ye,Me=(await we).reduce((Pe,He)=>Object.assign(Pe,He),{});return{loaderResults:De,fetcherResults:Me}}function za(){fi=!0,zt.forEach((de,V)=>{Je.has(V)&&yi.add(V),ta(V)})}function Ta(de,V,W={}){Xe.fetchers.set(de,V),rn({fetchers:new Map(Xe.fetchers)},{flushSync:(W&&W.flushSync)===!0})}function Ir(de,V,W,ae={}){let ye=bm(Xe.matches,V);Hr(de),rn({errors:{[ye.route.id]:W},fetchers:new Map(Xe.fetchers)},{flushSync:(ae&&ae.flushSync)===!0})}function ja(de){return _i.set(de,(_i.get(de)||0)+1),Jt.has(de)&&Jt.delete(de),Xe.fetchers.get(de)||lD}function Hr(de){let V=Xe.fetchers.get(de);Je.has(de)&&!(V&&V.state==="loading"&&$t.has(de))&&ta(de),zt.delete(de),$t.delete(de),Fe.delete(de),Jt.delete(de),yi.delete(de),Xe.fetchers.delete(de)}function Es(de){let V=(_i.get(de)||0)-1;V<=0?(_i.delete(de),Jt.add(de)):_i.set(de,V),rn({fetchers:new Map(Xe.fetchers)})}function ta(de){let V=Je.get(de);V&&(V.abort(),Je.delete(de))}function Qs(de){for(let V of de){let W=ja(V),ae=Zf(W.data);Xe.fetchers.set(V,ae)}}function bo(){let de=[],V=!1;for(let W of Fe){let ae=Xe.fetchers.get(W);Tr(ae,`Expected fetcher: ${W}`),ae.state==="loading"&&(Fe.delete(W),de.push(W),V=!0)}return Qs(de),V}function Ua(de){let V=[];for(let[W,ae]of $t)if(ae<de){let ye=Xe.fetchers.get(W);Tr(ye,`Expected fetcher: ${W}`),ye.state==="loading"&&(ta(W),$t.delete(W),V.push(W))}return Qs(V),V.length>0}function no(de,V){let W=Xe.blockers.get(de)||hy;return bi.get(de)!==V&&bi.set(de,V),W}function Vo(de){Xe.blockers.delete(de),bi.delete(de)}function wo(de,V){let W=Xe.blockers.get(de)||hy;Tr(W.state==="unblocked"&&V.state==="blocked"||W.state==="blocked"&&V.state==="blocked"||W.state==="blocked"&&V.state==="proceeding"||W.state==="blocked"&&V.state==="unblocked"||W.state==="proceeding"&&V.state==="unblocked",`Invalid blocker state transition: ${W.state} -> ${V.state}`);let ae=new Map(Xe.blockers);ae.set(de,V),rn({blockers:ae})}function Jn({currentLocation:de,nextLocation:V,historyAction:W}){if(bi.size===0)return;bi.size>1&&to(!1,"A router only supports one blocker at a time");let ae=Array.from(bi.entries()),[ye,we]=ae[ae.length-1],De=Xe.blockers.get(ye);if(!(De&&De.state==="proceeding")&&we({currentLocation:de,nextLocation:V,historyAction:W}))return ye}function ro(de){let V=Ic(404,{pathname:de}),W=r||G,{matches:ae,route:ye}=E2(W);return{notFoundMatches:ae,route:ye,error:V}}function fl(de,V,W){if(Re=de,be=V,Ie=W||null,!ke&&Xe.navigation===lb){ke=!0;let ae=Pc(Xe.location,Xe.matches);ae!=null&&rn({restoreScrollPosition:ae})}return()=>{Re=null,be=null,Ie=null}}function Pa(de,V){return Ie&&Ie(de,V.map(ae=>FI(ae,Xe.loaderData)))||de.key}function As(de,V){if(Re&&be){let W=Pa(de,V);Re[W]=be()}}function Pc(de,V){if(Re){let W=Pa(de,V),ae=Re[W];if(typeof ae=="number")return ae}return null}function Ms(de,V,W){if(m.patchRoutesOnNavigation)if(de){if(Object.keys(de[0].params).length>0)return{active:!0,matches:a0(V,W,Z,!0)}}else return{active:!0,matches:a0(V,W,Z,!0)||[]};return{active:!1,matches:null}}async function Bt(de,V,W,ae){if(!m.patchRoutesOnNavigation)return{type:"success",matches:de};let ye=de;for(;;){let we=r==null,De=r||G,Me=N;try{await m.patchRoutesOnNavigation({signal:W,path:V,matches:ye,fetcherKey:ae,patch:(Ye,Ve)=>{W.aborted||g2(Ye,Ve,De,Me,L)}})}catch(Ye){return{type:"error",error:Ye,partialMatches:ye}}finally{we&&!W.aborted&&(G=[...G])}if(W.aborted)return{type:"aborted"};let Pe=Wf(De,V,Z);if(Pe)return{type:"success",matches:Pe};let He=a0(De,V,Z,!0);if(!He||ye.length===He.length&&ye.every((Ye,Ve)=>Ye.route.id===He[Ve].route.id))return{type:"success",matches:null};ye=He}}function Go(de){N={},r=d0(de,L,void 0,N)}function $l(de,V){let W=r==null;g2(de,V,r||G,N,L),W&&(G=[...G],rn({}))}return ut={get basename(){return Z},get future(){return ie},get state(){return Xe},get routes(){return G},get window(){return b},initialize:ri,subscribe:Vi,enableScrollRestoration:fl,navigate:_n,fetch:la,revalidate:Rn,createHref:de=>m.history.createHref(de),encodeLocation:de=>m.history.encodeLocation(de),getFetcher:ja,deleteFetcher:Es,dispose:Yi,getBlocker:no,deleteBlocker:Vo,patchRoutes:$l,_internalFetchControllers:Je,_internalSetRoutes:Go},ut}function hD(m){return m!=null&&("formData"in m&&m.formData!=null||"body"in m&&m.body!==void 0)}function Eb(m,b,E,C,L,N){let G,r;if(L){G=[];for(let $ of b)if(G.push($),$.route.id===L){r=$;break}}else G=b,r=b[b.length-1];let Z=Qb(C||".",Kb(G),zc(m.pathname,E)||m.pathname,N==="path");if(C==null&&(Z.search=m.search,Z.hash=m.hash),(C==null||C===""||C===".")&&r){let $=e1(Z.search);if(r.route.index&&!$)Z.search=Z.search?Z.search.replace(/^\?/,"?index&"):"?index";else if(!r.route.index&&$){let ie=new URLSearchParams(Z.search),oe=ie.getAll("index");ie.delete("index"),oe.filter(Re=>Re).forEach(Re=>ie.append("index",Re));let fe=ie.toString();Z.search=fe?`?${fe}`:""}}return E!=="/"&&(Z.pathname=Z.pathname==="/"?E:Mh([E,Z.pathname])),Yf(Z)}function p2(m,b,E){if(!E||!hD(E))return{path:b};if(E.formMethod&&!TD(E.formMethod))return{path:b,error:Ic(405,{method:E.formMethod})};let C=()=>({path:b,error:Ic(400,{type:"invalid-body"})}),N=(E.formMethod||"get").toUpperCase(),G=NS(b);if(E.body!==void 0){if(E.formEncType==="text/plain"){if(!Gl(N))return C();let oe=typeof E.body=="string"?E.body:E.body instanceof FormData||E.body instanceof URLSearchParams?Array.from(E.body.entries()).reduce((fe,[Re,Ie])=>`${fe}${Re}=${Ie}
`,""):String(E.body);return{path:b,submission:{formMethod:N,formAction:G,formEncType:E.formEncType,formData:void 0,json:void 0,text:oe}}}else if(E.formEncType==="application/json"){if(!Gl(N))return C();try{let oe=typeof E.body=="string"?JSON.parse(E.body):E.body;return{path:b,submission:{formMethod:N,formAction:G,formEncType:E.formEncType,formData:void 0,json:oe,text:void 0}}}catch{return C()}}}Tr(typeof FormData=="function","FormData is not available in this environment");let r,Z;if(E.formData)r=Cb(E.formData),Z=E.formData;else if(E.body instanceof FormData)r=Cb(E.body),Z=E.body;else if(E.body instanceof URLSearchParams)r=E.body,Z=b2(r);else if(E.body==null)r=new URLSearchParams,Z=new FormData;else try{r=new URLSearchParams(E.body),Z=b2(r)}catch{return C()}let $={formMethod:N,formAction:G,formEncType:E&&E.formEncType||"application/x-www-form-urlencoded",formData:Z,json:void 0,text:void 0};if(Gl($.formMethod))return{path:b,submission:$};let ie=tp(b);return m&&ie.search&&e1(ie.search)&&r.append("index",""),ie.search=`?${r}`,{path:Yf(ie),submission:$}}function m2(m,b,E,C,L,N,G,r,Z,$,ie,oe,fe,Re,Ie,be,ke,Oe,Be){var Fi;let je=Be?Vl(Be[1])?Be[1].error:Be[1].data:void 0,at=L.createURL(N.location),ut=L.createURL(Z),Xe;if(ie&&N.errors){let Ei=Object.keys(N.errors)[0];Xe=G.findIndex(fi=>fi.route.id===Ei)}else if(Be&&Vl(Be[1])){let Ei=Be[0];Xe=G.findIndex(fi=>fi.route.id===Ei)-1}let Tt=Be?Be[1].statusCode:void 0,vt=Tt&&Tt>=400,ni={currentUrl:at,currentParams:((Fi=N.matches[0])==null?void 0:Fi.params)||{},nextUrl:ut,nextParams:G[0].params,...r,actionResult:je,actionStatus:Tt},Pi=G.map((Ei,fi)=>{let{route:yi}=Ei,Je=null;if(Xe!=null&&fi>Xe?Je=!1:yi.lazy?Je=!0:yi.loader==null?Je=!1:ie?Je=Ab(yi,N.loaderData,N.errors):dD(N.loaderData,N.matches[fi],Ei)&&(Je=!0),Je!==null)return Mb(E,C,m,Ei,$,b,Je);let jt=vt?!1:oe||at.pathname+at.search===ut.pathname+ut.search||at.search!==ut.search||fD(N.matches[fi],Ei),_t={...ni,defaultShouldRevalidate:jt},$t=m0(Ei,_t);return Mb(E,C,m,Ei,$,b,$t,_t)}),xi=[];return Ie.forEach((Ei,fi)=>{if(ie||!G.some(zt=>zt.route.id===Ei.routeId)||Re.has(fi))return;let yi=Wf(ke,Ei.path,Oe);if(!yi){xi.push({key:fi,routeId:Ei.routeId,path:Ei.path,matches:null,match:null,request:null,controller:null});return}if(be.has(fi))return;let Je=N.fetchers.get(fi),jt=gy(yi,Ei.path),_t=new AbortController,$t=jg(L,Ei.path,_t.signal),Fe=null;if(fe.has(fi))fe.delete(fi),Fe=Vg(E,C,$t,yi,jt,$,b);else if(Je&&Je.state!=="idle"&&Je.data===void 0)oe&&(Fe=Vg(E,C,$t,yi,jt,$,b));else{let zt={...ni,defaultShouldRevalidate:vt?!1:oe};m0(jt,zt)&&(Fe=Vg(E,C,$t,yi,jt,$,b,zt))}Fe&&xi.push({key:fi,routeId:Ei.routeId,path:Ei.path,matches:Fe,match:jt,request:$t,controller:_t})}),{dsMatches:Pi,revalidatingFetchers:xi}}function Ab(m,b,E){if(m.lazy)return!0;if(!m.loader)return!1;let C=b!=null&&m.id in b,L=E!=null&&E[m.id]!==void 0;return!C&&L?!1:typeof m.loader=="function"&&m.loader.hydrate===!0?!0:!C&&!L}function dD(m,b,E){let C=!b||E.route.id!==b.route.id,L=!m.hasOwnProperty(E.route.id);return C||L}function fD(m,b){let E=m.route.path;return m.pathname!==b.pathname||E!=null&&E.endsWith("*")&&m.params["*"]!==b.params["*"]}function m0(m,b){if(m.route.shouldRevalidate){let E=m.route.shouldRevalidate(b);if(typeof E=="boolean")return E}return b.defaultShouldRevalidate}function g2(m,b,E,C,L){let N;if(m){let Z=C[m];Tr(Z,`No route found to patch children into: routeId = ${m}`),Z.children||(Z.children=[]),N=Z.children}else N=E;let G=b.filter(Z=>!N.some($=>zS(Z,$))),r=d0(G,L,[m||"_","patch",String((N==null?void 0:N.length)||"0")],C);N.push(...r)}function zS(m,b){return"id"in m&&"id"in b&&m.id===b.id?!0:m.index===b.index&&m.path===b.path&&m.caseSensitive===b.caseSensitive?(!m.children||m.children.length===0)&&(!b.children||b.children.length===0)?!0:m.children.every((E,C)=>{var L;return(L=b.children)==null?void 0:L.some(N=>zS(E,N))}):!1}var _2=new WeakMap,PS=({key:m,route:b,manifest:E,mapRouteProperties:C})=>{let L=E[b.id];if(Tr(L,"No route found in manifest"),!L.lazy||typeof L.lazy!="object")return;let N=L.lazy[m];if(!N)return;let G=_2.get(L);G||(G={},_2.set(L,G));let r=G[m];if(r)return r;let Z=(async()=>{let $=OI(m),oe=L[m]!==void 0&&m!=="hasErrorBoundary";if($)to(!$,"Route property "+m+" is not a supported lazy route property. This property will be ignored."),G[m]=Promise.resolve();else if(oe)to(!1,`Route "${L.id}" has a static property "${m}" defined. The lazy property will be ignored.`);else{let fe=await N();fe!=null&&(Object.assign(L,{[m]:fe}),Object.assign(L,C(L)))}typeof L.lazy=="object"&&(L.lazy[m]=void 0,Object.values(L.lazy).every(fe=>fe===void 0)&&(L.lazy=void 0))})();return G[m]=Z,Z},y2=new WeakMap;function pD(m,b,E,C,L){let N=E[m.id];if(Tr(N,"No route found in manifest"),!m.lazy)return{lazyRoutePromise:void 0,lazyHandlerPromise:void 0};if(typeof m.lazy=="function"){let ie=y2.get(N);if(ie)return{lazyRoutePromise:ie,lazyHandlerPromise:ie};let oe=(async()=>{Tr(typeof m.lazy=="function","No lazy route function found");let fe=await m.lazy(),Re={};for(let Ie in fe){let be=fe[Ie];if(be===void 0)continue;let ke=NI(Ie),Be=N[Ie]!==void 0&&Ie!=="hasErrorBoundary";ke?to(!ke,"Route property "+Ie+" is not a supported property to be returned from a lazy route function. This property will be ignored."):Be?to(!Be,`Route "${N.id}" has a static property "${Ie}" defined but its lazy function is also returning a value for this property. The lazy route property "${Ie}" will be ignored.`):Re[Ie]=be}Object.assign(N,Re),Object.assign(N,{...C(N),lazy:void 0})})();return y2.set(N,oe),oe.catch(()=>{}),{lazyRoutePromise:oe,lazyHandlerPromise:oe}}let G=Object.keys(m.lazy),r=[],Z;for(let ie of G){if(L&&L.includes(ie))continue;let oe=PS({key:ie,route:m,manifest:E,mapRouteProperties:C});oe&&(r.push(oe),ie===b&&(Z=oe))}let $=r.length>0?Promise.all(r).then(()=>{}):void 0;return $==null||$.catch(()=>{}),Z==null||Z.catch(()=>{}),{lazyRoutePromise:$,lazyHandlerPromise:Z}}async function v2(m){let b=m.matches.filter(L=>L.shouldLoad),E={};return(await Promise.all(b.map(L=>L.resolve()))).forEach((L,N)=>{E[b[N].route.id]=L}),E}async function mD(m){return m.matches.some(b=>b.route.unstable_middleware)?LS(m,!1,()=>v2(m),(b,E)=>({[E]:{type:"error",result:b}})):v2(m)}async function LS(m,b,E,C){let{matches:L,request:N,params:G,context:r}=m,Z={handlerResult:void 0};try{let $=L.flatMap(oe=>oe.route.unstable_middleware?oe.route.unstable_middleware.map(fe=>[oe.route.id,fe]):[]),ie=await OS({request:N,params:G,context:r},$,b,Z,E);return b?ie:Z.handlerResult}catch($){if(!Z.middlewareError)throw $;let ie=await C(Z.middlewareError.error,Z.middlewareError.routeId);return Z.handlerResult?Object.assign(Z.handlerResult,ie):ie}}async function OS(m,b,E,C,L,N=0){let{request:G}=m;if(G.signal.aborted)throw G.signal.reason?G.signal.reason:new Error(`Request aborted without an \`AbortSignal.reason\`: ${G.method} ${G.url}`);let r=b[N];if(!r)return C.handlerResult=await L(),C.handlerResult;let[Z,$]=r,ie=!1,oe,fe=async()=>{if(ie)throw new Error("You may only call `next()` once per middleware");ie=!0,await OS(m,b,E,C,L,N+1)};try{let Re=await $({request:m.request,params:m.params,context:m.context},fe);return ie?Re===void 0?oe:Re:fe()}catch(Re){throw C.middlewareError?C.middlewareError.error!==Re&&(C.middlewareError={routeId:Z,error:Re}):C.middlewareError={routeId:Z,error:Re},Re}}function kS(m,b,E,C,L){let N=PS({key:"unstable_middleware",route:C.route,manifest:b,mapRouteProperties:m}),G=pD(C.route,Gl(E.method)?"action":"loader",b,m,L);return{middleware:N,route:G.lazyRoutePromise,handler:G.lazyHandlerPromise}}function Mb(m,b,E,C,L,N,G,r=null){let Z=!1,$=kS(m,b,E,C,L);return{...C,_lazyPromises:$,shouldLoad:G,unstable_shouldRevalidateArgs:r,unstable_shouldCallHandler(ie){return Z=!0,r?typeof ie=="boolean"?m0(C,{...r,defaultShouldRevalidate:ie}):m0(C,r):G},resolve(ie){return Z||G||ie&&E.method==="GET"&&(C.route.lazy||C.route.loader)?_D({request:E,match:C,lazyHandlerPromise:$==null?void 0:$.handler,lazyRoutePromise:$==null?void 0:$.route,handlerOverride:ie,scopedContext:N}):Promise.resolve({type:"data",result:void 0})}}}function Vg(m,b,E,C,L,N,G,r=null){return C.map(Z=>Z.route.id!==L.route.id?{...Z,shouldLoad:!1,unstable_shouldRevalidateArgs:r,unstable_shouldCallHandler:()=>!1,_lazyPromises:kS(m,b,E,Z,N),resolve:()=>Promise.resolve({type:"data",result:void 0})}:Mb(m,b,E,Z,N,G,!0,r))}async function gD(m,b,E,C,L,N){E.some($=>{var ie;return(ie=$._lazyPromises)==null?void 0:ie.middleware})&&await Promise.all(E.map($=>{var ie;return(ie=$._lazyPromises)==null?void 0:ie.middleware}));let G={request:b,params:E[0].params,context:L,matches:E},Z=await m({...G,fetcherKey:C,unstable_runClientMiddleware:$=>{let ie=G;return LS(ie,!1,()=>$({...ie,fetcherKey:C,unstable_runClientMiddleware:()=>{throw new Error("Cannot call `unstable_runClientMiddleware()` from within an `unstable_runClientMiddleware` handler")}}),(oe,fe)=>({[fe]:{type:"error",result:oe}}))}});try{await Promise.all(E.flatMap($=>{var ie,oe;return[(ie=$._lazyPromises)==null?void 0:ie.handler,(oe=$._lazyPromises)==null?void 0:oe.route]}))}catch{}return Z}async function _D({request:m,match:b,lazyHandlerPromise:E,lazyRoutePromise:C,handlerOverride:L,scopedContext:N}){let G,r,Z=Gl(m.method),$=Z?"action":"loader",ie=oe=>{let fe,Re=new Promise((ke,Oe)=>fe=Oe);r=()=>fe(),m.signal.addEventListener("abort",r);let Ie=ke=>typeof oe!="function"?Promise.reject(new Error(`You cannot call the handler for a route which defines a boolean "${$}" [routeId: ${b.route.id}]`)):oe({request:m,params:b.params,context:N},...ke!==void 0?[ke]:[]),be=(async()=>{try{return{type:"data",result:await(L?L(Oe=>Ie(Oe)):Ie())}}catch(ke){return{type:"error",result:ke}}})();return Promise.race([be,Re])};try{let oe=Z?b.route.action:b.route.loader;if(E||C)if(oe){let fe,[Re]=await Promise.all([ie(oe).catch(Ie=>{fe=Ie}),E,C]);if(fe!==void 0)throw fe;G=Re}else{await E;let fe=Z?b.route.action:b.route.loader;if(fe)[G]=await Promise.all([ie(fe),C]);else if($==="action"){let Re=new URL(m.url),Ie=Re.pathname+Re.search;throw Ic(405,{method:m.method,pathname:Ie,routeId:b.route.id})}else return{type:"data",result:void 0}}else if(oe)G=await ie(oe);else{let fe=new URL(m.url),Re=fe.pathname+fe.search;throw Ic(404,{pathname:Re})}}catch(oe){return{type:"error",result:oe}}finally{r&&m.signal.removeEventListener("abort",r)}return G}async function yD(m){var C,L,N,G,r,Z;let{result:b,type:E}=m;if(BS(b)){let $;try{let ie=b.headers.get("Content-Type");ie&&/\bapplication\/json\b/.test(ie)?b.body==null?$=null:$=await b.json():$=await b.text()}catch(ie){return{type:"error",error:ie}}return E==="error"?{type:"error",error:new p0(b.status,b.statusText,$),statusCode:b.status,headers:b.headers}:{type:"data",data:$,statusCode:b.status,headers:b.headers}}return E==="error"?A2(b)?b.data instanceof Error?{type:"error",error:b.data,statusCode:(C=b.init)==null?void 0:C.status,headers:(L=b.init)!=null&&L.headers?new Headers(b.init.headers):void 0}:{type:"error",error:new p0(((N=b.init)==null?void 0:N.status)||500,void 0,b.data),statusCode:by(b)?b.status:void 0,headers:(G=b.init)!=null&&G.headers?new Headers(b.init.headers):void 0}:{type:"error",error:b,statusCode:by(b)?b.status:void 0}:A2(b)?{type:"data",data:b.data,statusCode:(r=b.init)==null?void 0:r.status,headers:(Z=b.init)!=null&&Z.headers?new Headers(b.init.headers):void 0}:{type:"data",data:b}}function vD(m,b,E,C,L){let N=m.headers.get("Location");if(Tr(N,"Redirects returned/thrown from loaders/actions must have a Location header"),!Jb.test(N)){let G=C.slice(0,C.findIndex(r=>r.route.id===E)+1);N=Eb(new URL(b.url),G,L,N),m.headers.set("Location",N)}return m}function x2(m,b,E){if(Jb.test(m)){let C=m,L=C.startsWith("//")?new URL(b.protocol+C):new URL(C),N=zc(L.pathname,E)!=null;if(L.origin===b.origin&&N)return L.pathname+L.search+L.hash}return m}function jg(m,b,E,C){let L=m.createURL(NS(b)).toString(),N={signal:E};if(C&&Gl(C.formMethod)){let{formMethod:G,formEncType:r}=C;N.method=G.toUpperCase(),r==="application/json"?(N.headers=new Headers({"Content-Type":r}),N.body=JSON.stringify(C.json)):r==="text/plain"?N.body=C.text:r==="application/x-www-form-urlencoded"&&C.formData?N.body=Cb(C.formData):N.body=C.formData}return new Request(L,N)}function Cb(m){let b=new URLSearchParams;for(let[E,C]of m.entries())b.append(E,typeof C=="string"?C:C.name);return b}function b2(m){let b=new FormData;for(let[E,C]of m.entries())b.append(E,C);return b}function xD(m,b,E,C=!1,L=!1){let N={},G=null,r,Z=!1,$={},ie=E&&Vl(E[1])?E[1].error:void 0;return m.forEach(oe=>{if(!(oe.route.id in b))return;let fe=oe.route.id,Re=b[fe];if(Tr(!wm(Re),"Cannot handle redirect results in processLoaderData"),Vl(Re)){let Ie=Re.error;if(ie!==void 0&&(Ie=ie,ie=void 0),G=G||{},L)G[fe]=Ie;else{let be=bm(m,fe);G[be.route.id]==null&&(G[be.route.id]=Ie)}C||(N[fe]=DS),Z||(Z=!0,r=by(Re.error)?Re.error.status:500),Re.headers&&($[fe]=Re.headers)}else N[fe]=Re.data,Re.statusCode&&Re.statusCode!==200&&!Z&&(r=Re.statusCode),Re.headers&&($[fe]=Re.headers)}),ie!==void 0&&E&&(G={[E[0]]:ie},E[2]&&(N[E[2]]=void 0)),{loaderData:N,errors:G,statusCode:r||200,loaderHeaders:$}}function w2(m,b,E,C,L,N){let{loaderData:G,errors:r}=xD(b,E,C);return L.filter(Z=>!Z.matches||Z.matches.some($=>$.shouldLoad)).forEach(Z=>{let{key:$,match:ie,controller:oe}=Z,fe=N[$];if(Tr(fe,"Did not find corresponding fetcher result"),!(oe&&oe.signal.aborted))if(Vl(fe)){let Re=bm(m.matches,ie==null?void 0:ie.route.id);r&&r[Re.route.id]||(r={...r,[Re.route.id]:fe.error}),m.fetchers.delete($)}else if(wm(fe))Tr(!1,"Unhandled fetcher revalidation redirect");else{let Re=Zf(fe.data);m.fetchers.set($,Re)}}),{loaderData:G,errors:r}}function T2(m,b,E,C){let L=Object.entries(b).filter(([,N])=>N!==DS).reduce((N,[G,r])=>(N[G]=r,N),{});for(let N of E){let G=N.route.id;if(!b.hasOwnProperty(G)&&m.hasOwnProperty(G)&&N.route.loader&&(L[G]=m[G]),C&&C.hasOwnProperty(G))break}return L}function S2(m){return m?Vl(m[1])?{actionData:{}}:{actionData:{[m[0]]:m[1].data}}:{}}function bm(m,b){return(b?m.slice(0,m.findIndex(C=>C.route.id===b)+1):[...m]).reverse().find(C=>C.route.hasErrorBoundary===!0)||m[0]}function E2(m){let b=m.length===1?m[0]:m.find(E=>E.index||!E.path||E.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:b}],route:b}}function Ic(m,{pathname:b,routeId:E,method:C,type:L,message:N}={}){let G="Unknown Server Error",r="Unknown @remix-run/router error";return m===400?(G="Bad Request",C&&b&&E?r=`You made a ${C} request to "${b}" but did not provide a \`loader\` for route "${E}", so there is no way to handle the request.`:L==="invalid-body"&&(r="Unable to encode submission body")):m===403?(G="Forbidden",r=`Route "${E}" does not match URL "${b}"`):m===404?(G="Not Found",r=`No route matches URL "${b}"`):m===405&&(G="Method Not Allowed",C&&b&&E?r=`You made a ${C.toUpperCase()} request to "${b}" but did not provide an \`action\` for route "${E}", so there is no way to handle the request.`:C&&(r=`Invalid request method "${C.toUpperCase()}"`)),new p0(m||500,G,new Error(r),!0)}function Wv(m){let b=Object.entries(m);for(let E=b.length-1;E>=0;E--){let[C,L]=b[E];if(wm(L))return{key:C,result:L}}}function NS(m){let b=typeof m=="string"?tp(m):m;return Yf({...b,hash:""})}function bD(m,b){return m.pathname!==b.pathname||m.search!==b.search?!1:m.hash===""?b.hash!=="":m.hash===b.hash?!0:b.hash!==""}function wD(m){return BS(m.result)&&oD.has(m.result.status)}function Vl(m){return m.type==="error"}function wm(m){return(m&&m.type)==="redirect"}function A2(m){return typeof m=="object"&&m!=null&&"type"in m&&"data"in m&&"init"in m&&m.type==="DataWithResponseInit"}function BS(m){return m!=null&&typeof m.status=="number"&&typeof m.statusText=="string"&&typeof m.headers=="object"&&typeof m.body<"u"}function TD(m){return aD.has(m.toUpperCase())}function Gl(m){return nD.has(m.toUpperCase())}function e1(m){return new URLSearchParams(m).getAll("index").some(b=>b==="")}function gy(m,b){let E=typeof b=="string"?tp(b).search:b.search;if(m[m.length-1].route.index&&e1(E||""))return m[m.length-1];let C=CS(m);return C[C.length-1]}function M2(m){let{formMethod:b,formAction:E,formEncType:C,text:L,formData:N,json:G}=m;if(!(!b||!E||!C)){if(L!=null)return{formMethod:b,formAction:E,formEncType:C,formData:void 0,json:void 0,text:L};if(N!=null)return{formMethod:b,formAction:E,formEncType:C,formData:N,json:void 0,text:void 0};if(G!==void 0)return{formMethod:b,formAction:E,formEncType:C,formData:void 0,json:G,text:void 0}}}function cb(m,b){return b?{state:"loading",location:m,formMethod:b.formMethod,formAction:b.formAction,formEncType:b.formEncType,formData:b.formData,json:b.json,text:b.text}:{state:"loading",location:m,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function SD(m,b){return{state:"submitting",location:m,formMethod:b.formMethod,formAction:b.formAction,formEncType:b.formEncType,formData:b.formData,json:b.json,text:b.text}}function dy(m,b){return m?{state:"loading",formMethod:m.formMethod,formAction:m.formAction,formEncType:m.formEncType,formData:m.formData,json:m.json,text:m.text,data:b}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:b}}function ED(m,b){return{state:"submitting",formMethod:m.formMethod,formAction:m.formAction,formEncType:m.formEncType,formData:m.formData,json:m.json,text:m.text,data:b?b.data:void 0}}function Zf(m){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:m}}function AD(m,b){try{let E=m.sessionStorage.getItem(IS);if(E){let C=JSON.parse(E);for(let[L,N]of Object.entries(C||{}))N&&Array.isArray(N)&&b.set(L,new Set(N||[]))}}catch{}}function MD(m,b){if(b.size>0){let E={};for(let[C,L]of b)E[C]=[...L];try{m.sessionStorage.setItem(IS,JSON.stringify(E))}catch(C){to(!1,`Failed to save applied view transitions in sessionStorage (${C}).`)}}}function CD(){let m,b,E=new Promise((C,L)=>{m=async N=>{C(N);try{await E}catch{}},b=async N=>{L(N);try{await E}catch{}}});return{promise:E,resolve:m,reject:b}}var Im=ne.createContext(null);Im.displayName="DataRouter";var My=ne.createContext(null);My.displayName="DataRouterState";var t1=ne.createContext({isTransitioning:!1});t1.displayName="ViewTransition";var FS=ne.createContext(new Map);FS.displayName="Fetchers";var RD=ne.createContext(null);RD.displayName="Await";var zh=ne.createContext(null);zh.displayName="Navigation";var A0=ne.createContext(null);A0.displayName="Location";var Ph=ne.createContext({outlet:null,matches:[],isDataRoute:!1});Ph.displayName="Route";var i1=ne.createContext(null);i1.displayName="RouteError";function ID(m,{relative:b}={}){Tr(Cy(),"useHref() may be used only in the context of a <Router> component.");let{basename:E,navigator:C}=ne.useContext(zh),{hash:L,pathname:N,search:G}=Iy(m,{relative:b}),r=N;return E!=="/"&&(r=N==="/"?E:Mh([E,N])),C.createHref({pathname:r,search:G,hash:L})}function Cy(){return ne.useContext(A0)!=null}function ip(){return Tr(Cy(),"useLocation() may be used only in the context of a <Router> component."),ne.useContext(A0).location}var jS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function US(m){ne.useContext(zh).static||ne.useLayoutEffect(m)}function Ry(){let{isDataRoute:m}=ne.useContext(Ph);return m?GD():DD()}function DD(){Tr(Cy(),"useNavigate() may be used only in the context of a <Router> component.");let m=ne.useContext(Im),{basename:b,navigator:E}=ne.useContext(zh),{matches:C}=ne.useContext(Ph),{pathname:L}=ip(),N=JSON.stringify(Kb(C)),G=ne.useRef(!1);return US(()=>{G.current=!0}),ne.useCallback((Z,$={})=>{if(to(G.current,jS),!G.current)return;if(typeof Z=="number"){E.go(Z);return}let ie=Qb(Z,JSON.parse(N),L,$.relative==="path");m==null&&b!=="/"&&(ie.pathname=ie.pathname==="/"?b:Mh([b,ie.pathname])),($.replace?E.replace:E.push)(ie,$.state,$)},[b,E,N,L,m])}ne.createContext(null);function C2(){let{matches:m}=ne.useContext(Ph),b=m[m.length-1];return b?b.params:{}}function Iy(m,{relative:b}={}){let{matches:E}=ne.useContext(Ph),{pathname:C}=ip(),L=JSON.stringify(Kb(E));return ne.useMemo(()=>Qb(m,JSON.parse(L),C,b==="path"),[m,L,C,b])}function zD(m,b,E,C){Tr(Cy(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:L,static:N}=ne.useContext(zh),{matches:G}=ne.useContext(Ph),r=G[G.length-1],Z=r?r.params:{},$=r?r.pathname:"/",ie=r?r.pathnameBase:"/",oe=r&&r.route;{let Be=oe&&oe.path||"";VS($,!oe||Be.endsWith("*")||Be.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${$}" (under <Route path="${Be}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Be}"> to <Route path="${Be==="/"?"*":`${Be}/*`}">.`)}let fe=ip(),Re;Re=fe;let Ie=Re.pathname||"/",be=Ie;if(ie!=="/"){let Be=ie.replace(/^\//,"").split("/");be="/"+Ie.replace(/^\//,"").split("/").slice(Be.length).join("/")}let ke=!N&&E&&E.matches&&E.matches.length>0?E.matches:Wf(m,{pathname:be});return to(oe||ke!=null,`No routes matched location "${Re.pathname}${Re.search}${Re.hash}" `),to(ke==null||ke[ke.length-1].route.element!==void 0||ke[ke.length-1].route.Component!==void 0||ke[ke.length-1].route.lazy!==void 0,`Matched leaf route at location "${Re.pathname}${Re.search}${Re.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),ND(ke&&ke.map(Be=>Object.assign({},Be,{params:Object.assign({},Z,Be.params),pathname:Mh([ie,L.encodeLocation?L.encodeLocation(Be.pathname).pathname:Be.pathname]),pathnameBase:Be.pathnameBase==="/"?ie:Mh([ie,L.encodeLocation?L.encodeLocation(Be.pathnameBase).pathname:Be.pathnameBase])})),G,E,C)}function PD(){let m=VD(),b=by(m)?`${m.status} ${m.statusText}`:m instanceof Error?m.message:JSON.stringify(m),E=m instanceof Error?m.stack:null,C="rgba(200,200,200, 0.5)",L={padding:"0.5rem",backgroundColor:C},N={padding:"2px 4px",backgroundColor:C},G=null;return console.error("Error handled by React Router default ErrorBoundary:",m),G=ne.createElement(ne.Fragment,null,ne.createElement("p",null," Hey developer "),ne.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ne.createElement("code",{style:N},"ErrorBoundary")," or"," ",ne.createElement("code",{style:N},"errorElement")," prop on your route.")),ne.createElement(ne.Fragment,null,ne.createElement("h2",null,"Unexpected Application Error!"),ne.createElement("h3",{style:{fontStyle:"italic"}},b),E?ne.createElement("pre",{style:L},E):null,G)}var LD=ne.createElement(PD,null),OD=class extends ne.Component{constructor(m){super(m),this.state={location:m.location,revalidation:m.revalidation,error:m.error}}static getDerivedStateFromError(m){return{error:m}}static getDerivedStateFromProps(m,b){return b.location!==m.location||b.revalidation!=="idle"&&m.revalidation==="idle"?{error:m.error,location:m.location,revalidation:m.revalidation}:{error:m.error!==void 0?m.error:b.error,location:b.location,revalidation:m.revalidation||b.revalidation}}componentDidCatch(m,b){console.error("React Router caught the following error during render",m,b)}render(){return this.state.error!==void 0?ne.createElement(Ph.Provider,{value:this.props.routeContext},ne.createElement(i1.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function kD({routeContext:m,match:b,children:E}){let C=ne.useContext(Im);return C&&C.static&&C.staticContext&&(b.route.errorElement||b.route.ErrorBoundary)&&(C.staticContext._deepestRenderedBoundaryId=b.route.id),ne.createElement(Ph.Provider,{value:m},E)}function ND(m,b=[],E=null,C=null){if(m==null){if(!E)return null;if(E.errors)m=E.matches;else if(b.length===0&&!E.initialized&&E.matches.length>0)m=E.matches;else return null}let L=m,N=E==null?void 0:E.errors;if(N!=null){let Z=L.findIndex($=>$.route.id&&(N==null?void 0:N[$.route.id])!==void 0);Tr(Z>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(N).join(",")}`),L=L.slice(0,Math.min(L.length,Z+1))}let G=!1,r=-1;if(E)for(let Z=0;Z<L.length;Z++){let $=L[Z];if(($.route.HydrateFallback||$.route.hydrateFallbackElement)&&(r=Z),$.route.id){let{loaderData:ie,errors:oe}=E,fe=$.route.loader&&!ie.hasOwnProperty($.route.id)&&(!oe||oe[$.route.id]===void 0);if($.route.lazy||fe){G=!0,r>=0?L=L.slice(0,r+1):L=[L[0]];break}}}return L.reduceRight((Z,$,ie)=>{let oe,fe=!1,Re=null,Ie=null;E&&(oe=N&&$.route.id?N[$.route.id]:void 0,Re=$.route.errorElement||LD,G&&(r<0&&ie===0?(VS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),fe=!0,Ie=null):r===ie&&(fe=!0,Ie=$.route.hydrateFallbackElement||null)));let be=b.concat(L.slice(0,ie+1)),ke=()=>{let Oe;return oe?Oe=Re:fe?Oe=Ie:$.route.Component?Oe=ne.createElement($.route.Component,null):$.route.element?Oe=$.route.element:Oe=Z,ne.createElement(kD,{match:$,routeContext:{outlet:Z,matches:be,isDataRoute:E!=null},children:Oe})};return E&&($.route.ErrorBoundary||$.route.errorElement||ie===0)?ne.createElement(OD,{location:E.location,revalidation:E.revalidation,component:Re,error:oe,children:ke(),routeContext:{outlet:null,matches:be,isDataRoute:!0}}):ke()},null)}function n1(m){return`${m} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function BD(m){let b=ne.useContext(Im);return Tr(b,n1(m)),b}function FD(m){let b=ne.useContext(My);return Tr(b,n1(m)),b}function jD(m){let b=ne.useContext(Ph);return Tr(b,n1(m)),b}function r1(m){let b=jD(m),E=b.matches[b.matches.length-1];return Tr(E.route.id,`${m} can only be used on routes that contain a unique "id"`),E.route.id}function UD(){return r1("useRouteId")}function VD(){var C;let m=ne.useContext(i1),b=FD("useRouteError"),E=r1("useRouteError");return m!==void 0?m:(C=b.errors)==null?void 0:C[E]}function GD(){let{router:m}=BD("useNavigate"),b=r1("useNavigate"),E=ne.useRef(!1);return US(()=>{E.current=!0}),ne.useCallback(async(L,N={})=>{to(E.current,jS),E.current&&(typeof L=="number"?m.navigate(L):await m.navigate(L,{fromRouteId:b,...N}))},[m,b])}var R2={};function VS(m,b,E){!b&&!R2[m]&&(R2[m]=!0,to(!1,E))}var I2={};function D2(m,b){!m&&!I2[b]&&(I2[b]=!0,console.warn(b))}function HD(m){let b={hasErrorBoundary:m.hasErrorBoundary||m.ErrorBoundary!=null||m.errorElement!=null};return m.Component&&(m.element&&to(!1,"You should not include both `Component` and `element` on your route - `Component` will be used."),Object.assign(b,{element:ne.createElement(m.Component),Component:void 0})),m.HydrateFallback&&(m.hydrateFallbackElement&&to(!1,"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - `HydrateFallback` will be used."),Object.assign(b,{hydrateFallbackElement:ne.createElement(m.HydrateFallback),HydrateFallback:void 0})),m.ErrorBoundary&&(m.errorElement&&to(!1,"You should not include both `ErrorBoundary` and `errorElement` on your route - `ErrorBoundary` will be used."),Object.assign(b,{errorElement:ne.createElement(m.ErrorBoundary),ErrorBoundary:void 0})),b}var qD=["HydrateFallback","hydrateFallbackElement"],$D=class{constructor(){this.status="pending",this.promise=new Promise((m,b)=>{this.resolve=E=>{this.status==="pending"&&(this.status="resolved",m(E))},this.reject=E=>{this.status==="pending"&&(this.status="rejected",b(E))}})}};function ZD({router:m,flushSync:b}){let[E,C]=ne.useState(m.state),[L,N]=ne.useState(),[G,r]=ne.useState({isTransitioning:!1}),[Z,$]=ne.useState(),[ie,oe]=ne.useState(),[fe,Re]=ne.useState(),Ie=ne.useRef(new Map),be=ne.useCallback((je,{deletedFetchers:at,flushSync:ut,viewTransitionOpts:Xe})=>{je.fetchers.forEach((vt,ni)=>{vt.data!==void 0&&Ie.current.set(ni,vt.data)}),at.forEach(vt=>Ie.current.delete(vt)),D2(ut===!1||b!=null,'You provided the `flushSync` option to a router update, but you are not using the `<RouterProvider>` from `react-router/dom` so `ReactDOM.flushSync()` is unavailable.  Please update your app to `import { RouterProvider } from "react-router/dom"` and ensure you have `react-dom` installed as a dependency to use the `flushSync` option.');let Tt=m.window!=null&&m.window.document!=null&&typeof m.window.document.startViewTransition=="function";if(D2(Xe==null||Tt,"You provided the `viewTransition` option to a router update, but you do not appear to be running in a DOM environment as `window.startViewTransition` is not available."),!Xe||!Tt){b&&ut?b(()=>C(je)):ne.startTransition(()=>C(je));return}if(b&&ut){b(()=>{ie&&(Z&&Z.resolve(),ie.skipTransition()),r({isTransitioning:!0,flushSync:!0,currentLocation:Xe.currentLocation,nextLocation:Xe.nextLocation})});let vt=m.window.document.startViewTransition(()=>{b(()=>C(je))});vt.finished.finally(()=>{b(()=>{$(void 0),oe(void 0),N(void 0),r({isTransitioning:!1})})}),b(()=>oe(vt));return}ie?(Z&&Z.resolve(),ie.skipTransition(),Re({state:je,currentLocation:Xe.currentLocation,nextLocation:Xe.nextLocation})):(N(je),r({isTransitioning:!0,flushSync:!1,currentLocation:Xe.currentLocation,nextLocation:Xe.nextLocation}))},[m.window,b,ie,Z]);ne.useLayoutEffect(()=>m.subscribe(be),[m,be]),ne.useEffect(()=>{G.isTransitioning&&!G.flushSync&&$(new $D)},[G]),ne.useEffect(()=>{if(Z&&L&&m.window){let je=L,at=Z.promise,ut=m.window.document.startViewTransition(async()=>{ne.startTransition(()=>C(je)),await at});ut.finished.finally(()=>{$(void 0),oe(void 0),N(void 0),r({isTransitioning:!1})}),oe(ut)}},[L,Z,m.window]),ne.useEffect(()=>{Z&&L&&E.location.key===L.location.key&&Z.resolve()},[Z,ie,E.location,L]),ne.useEffect(()=>{!G.isTransitioning&&fe&&(N(fe.state),r({isTransitioning:!0,flushSync:!1,currentLocation:fe.currentLocation,nextLocation:fe.nextLocation}),Re(void 0))},[G.isTransitioning,fe]);let ke=ne.useMemo(()=>({createHref:m.createHref,encodeLocation:m.encodeLocation,go:je=>m.navigate(je),push:(je,at,ut)=>m.navigate(je,{state:at,preventScrollReset:ut==null?void 0:ut.preventScrollReset}),replace:(je,at,ut)=>m.navigate(je,{replace:!0,state:at,preventScrollReset:ut==null?void 0:ut.preventScrollReset})}),[m]),Oe=m.basename||"/",Be=ne.useMemo(()=>({router:m,navigator:ke,static:!1,basename:Oe}),[m,ke,Oe]);return ne.createElement(ne.Fragment,null,ne.createElement(Im.Provider,{value:Be},ne.createElement(My.Provider,{value:E},ne.createElement(FS.Provider,{value:Ie.current},ne.createElement(t1.Provider,{value:G},ne.createElement(YD,{basename:Oe,location:E.location,navigationType:E.historyAction,navigator:ke},ne.createElement(XD,{routes:m.routes,future:m.future,state:E})))))),null)}var XD=ne.memo(WD);function WD({routes:m,future:b,state:E}){return zD(m,void 0,E,b)}function YD({basename:m="/",children:b=null,location:E,navigationType:C="POP",navigator:L,static:N=!1}){Tr(!Cy(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let G=m.replace(/^\/*/,"/"),r=ne.useMemo(()=>({basename:G,navigator:L,static:N,future:{}}),[G,L,N]);typeof E=="string"&&(E=tp(E));let{pathname:Z="/",search:$="",hash:ie="",state:oe=null,key:fe="default"}=E,Re=ne.useMemo(()=>{let Ie=zc(Z,G);return Ie==null?null:{location:{pathname:Ie,search:$,hash:ie,state:oe,key:fe},navigationType:C}},[G,Z,$,ie,oe,fe,C]);return to(Re!=null,`<Router basename="${G}"> is not able to match the URL "${Z}${$}${ie}" because it does not start with the basename, so the <Router> won't render anything.`),Re==null?null:ne.createElement(zh.Provider,{value:r},ne.createElement(A0.Provider,{children:b,value:Re}))}var o0="get",s0="application/x-www-form-urlencoded";function M0(m){return m!=null&&typeof m.tagName=="string"}function KD(m){return M0(m)&&m.tagName.toLowerCase()==="button"}function QD(m){return M0(m)&&m.tagName.toLowerCase()==="form"}function JD(m){return M0(m)&&m.tagName.toLowerCase()==="input"}function ez(m){return!!(m.metaKey||m.altKey||m.ctrlKey||m.shiftKey)}function tz(m,b){return m.button===0&&(!b||b==="_self")&&!ez(m)}var Yv=null;function iz(){if(Yv===null)try{new FormData(document.createElement("form"),0),Yv=!1}catch{Yv=!0}return Yv}var nz=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function ub(m){return m!=null&&!nz.has(m)?(to(!1,`"${m}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${s0}"`),null):m}function rz(m,b){let E,C,L,N,G;if(QD(m)){let r=m.getAttribute("action");C=r?zc(r,b):null,E=m.getAttribute("method")||o0,L=ub(m.getAttribute("enctype"))||s0,N=new FormData(m)}else if(KD(m)||JD(m)&&(m.type==="submit"||m.type==="image")){let r=m.form;if(r==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let Z=m.getAttribute("formaction")||r.getAttribute("action");if(C=Z?zc(Z,b):null,E=m.getAttribute("formmethod")||r.getAttribute("method")||o0,L=ub(m.getAttribute("formenctype"))||ub(r.getAttribute("enctype"))||s0,N=new FormData(r,m),!iz()){let{name:$,type:ie,value:oe}=m;if(ie==="image"){let fe=$?`${$}.`:"";N.append(`${fe}x`,"0"),N.append(`${fe}y`,"0")}else $&&N.append($,oe)}}else{if(M0(m))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');E=o0,C=null,L=s0,G=m}return N&&L==="text/plain"&&(G=N,N=void 0),{action:C,method:E.toLowerCase(),encType:L,formData:N,body:G}}function a1(m,b){if(m===!1||m===null||typeof m>"u")throw new Error(b)}async function az(m,b){if(m.id in b)return b[m.id];try{let E=await import(m.module);return b[m.id]=E,E}catch(E){return console.error(`Error loading route module \`${m.module}\`, reloading page...`),console.error(E),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function oz(m){return m==null?!1:m.href==null?m.rel==="preload"&&typeof m.imageSrcSet=="string"&&typeof m.imageSizes=="string":typeof m.rel=="string"&&typeof m.href=="string"}async function sz(m,b,E){let C=await Promise.all(m.map(async L=>{let N=b.routes[L.route.id];if(N){let G=await az(N,E);return G.links?G.links():[]}return[]}));return hz(C.flat(1).filter(oz).filter(L=>L.rel==="stylesheet"||L.rel==="preload").map(L=>L.rel==="stylesheet"?{...L,rel:"prefetch",as:"style"}:{...L,rel:"prefetch"}))}function z2(m,b,E,C,L,N){let G=(Z,$)=>E[$]?Z.route.id!==E[$].route.id:!0,r=(Z,$)=>{var ie;return E[$].pathname!==Z.pathname||((ie=E[$].route.path)==null?void 0:ie.endsWith("*"))&&E[$].params["*"]!==Z.params["*"]};return N==="assets"?b.filter((Z,$)=>G(Z,$)||r(Z,$)):N==="data"?b.filter((Z,$)=>{var oe;let ie=C.routes[Z.route.id];if(!ie||!ie.hasLoader)return!1;if(G(Z,$)||r(Z,$))return!0;if(Z.route.shouldRevalidate){let fe=Z.route.shouldRevalidate({currentUrl:new URL(L.pathname+L.search+L.hash,window.origin),currentParams:((oe=E[0])==null?void 0:oe.params)||{},nextUrl:new URL(m,window.origin),nextParams:Z.params,defaultShouldRevalidate:!0});if(typeof fe=="boolean")return fe}return!0}):[]}function lz(m,b,{includeHydrateFallback:E}={}){return cz(m.map(C=>{let L=b.routes[C.route.id];if(!L)return[];let N=[L.module];return L.clientActionModule&&(N=N.concat(L.clientActionModule)),L.clientLoaderModule&&(N=N.concat(L.clientLoaderModule)),E&&L.hydrateFallbackModule&&(N=N.concat(L.hydrateFallbackModule)),L.imports&&(N=N.concat(L.imports)),N}).flat(1))}function cz(m){return[...new Set(m)]}function uz(m){let b={},E=Object.keys(m).sort();for(let C of E)b[C]=m[C];return b}function hz(m,b){let E=new Set;return new Set(b),m.reduce((C,L)=>{let N=JSON.stringify(uz(L));return E.has(N)||(E.add(N),C.push({key:N,link:L})),C},[])}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var dz=new Set([100,101,204,205]);function fz(m,b){let E=typeof m=="string"?new URL(m,typeof window>"u"?"server://singlefetch/":window.location.origin):m;return E.pathname==="/"?E.pathname="_root.data":b&&zc(E.pathname,b)==="/"?E.pathname=`${b.replace(/\/$/,"")}/_root.data`:E.pathname=`${E.pathname.replace(/\/$/,"")}.data`,E}function GS(){let m=ne.useContext(Im);return a1(m,"You must render this element inside a <DataRouterContext.Provider> element"),m}function pz(){let m=ne.useContext(My);return a1(m,"You must render this element inside a <DataRouterStateContext.Provider> element"),m}var o1=ne.createContext(void 0);o1.displayName="FrameworkContext";function HS(){let m=ne.useContext(o1);return a1(m,"You must render this element inside a <HydratedRouter> element"),m}function mz(m,b){let E=ne.useContext(o1),[C,L]=ne.useState(!1),[N,G]=ne.useState(!1),{onFocus:r,onBlur:Z,onMouseEnter:$,onMouseLeave:ie,onTouchStart:oe}=b,fe=ne.useRef(null);ne.useEffect(()=>{if(m==="render"&&G(!0),m==="viewport"){let be=Oe=>{Oe.forEach(Be=>{G(Be.isIntersecting)})},ke=new IntersectionObserver(be,{threshold:.5});return fe.current&&ke.observe(fe.current),()=>{ke.disconnect()}}},[m]),ne.useEffect(()=>{if(C){let be=setTimeout(()=>{G(!0)},100);return()=>{clearTimeout(be)}}},[C]);let Re=()=>{L(!0)},Ie=()=>{L(!1),G(!1)};return E?m!=="intent"?[N,fe,{}]:[N,fe,{onFocus:fy(r,Re),onBlur:fy(Z,Ie),onMouseEnter:fy($,Re),onMouseLeave:fy(ie,Ie),onTouchStart:fy(oe,Re)}]:[!1,fe,{}]}function fy(m,b){return E=>{m&&m(E),E.defaultPrevented||b(E)}}function gz({page:m,...b}){let{router:E}=GS(),C=ne.useMemo(()=>Wf(E.routes,m,E.basename),[E.routes,m,E.basename]);return C?ne.createElement(yz,{page:m,matches:C,...b}):null}function _z(m){let{manifest:b,routeModules:E}=HS(),[C,L]=ne.useState([]);return ne.useEffect(()=>{let N=!1;return sz(m,b,E).then(G=>{N||L(G)}),()=>{N=!0}},[m,b,E]),C}function yz({page:m,matches:b,...E}){let C=ip(),{manifest:L,routeModules:N}=HS(),{basename:G}=GS(),{loaderData:r,matches:Z}=pz(),$=ne.useMemo(()=>z2(m,b,Z,L,C,"data"),[m,b,Z,L,C]),ie=ne.useMemo(()=>z2(m,b,Z,L,C,"assets"),[m,b,Z,L,C]),oe=ne.useMemo(()=>{if(m===C.pathname+C.search+C.hash)return[];let Ie=new Set,be=!1;if(b.forEach(Oe=>{var je;let Be=L.routes[Oe.route.id];!Be||!Be.hasLoader||(!$.some(at=>at.route.id===Oe.route.id)&&Oe.route.id in r&&((je=N[Oe.route.id])!=null&&je.shouldRevalidate)||Be.hasClientLoader?be=!0:Ie.add(Oe.route.id))}),Ie.size===0)return[];let ke=fz(m,G);return be&&Ie.size>0&&ke.searchParams.set("_routes",b.filter(Oe=>Ie.has(Oe.route.id)).map(Oe=>Oe.route.id).join(",")),[ke.pathname+ke.search]},[G,r,C,L,$,b,m,N]),fe=ne.useMemo(()=>lz(ie,L),[ie,L]),Re=_z(ie);return ne.createElement(ne.Fragment,null,oe.map(Ie=>ne.createElement("link",{key:Ie,rel:"prefetch",as:"fetch",href:Ie,...E})),fe.map(Ie=>ne.createElement("link",{key:Ie,rel:"modulepreload",href:Ie,...E})),Re.map(({key:Ie,link:be})=>ne.createElement("link",{key:Ie,...be})))}function vz(...m){return b=>{m.forEach(E=>{typeof E=="function"?E(b):E!=null&&(E.current=b)})}}var qS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{qS&&(window.__reactRouterVersion="7.6.0")}catch{}function xz(m,b){return uD({basename:b==null?void 0:b.basename,unstable_getContext:b==null?void 0:b.unstable_getContext,future:b==null?void 0:b.future,history:DI({window:b==null?void 0:b.window}),hydrationData:bz(),routes:m,mapRouteProperties:HD,hydrationRouteProperties:qD,dataStrategy:b==null?void 0:b.dataStrategy,patchRoutesOnNavigation:b==null?void 0:b.patchRoutesOnNavigation,window:b==null?void 0:b.window}).initialize()}function bz(){let m=window==null?void 0:window.__staticRouterHydrationData;return m&&m.errors&&(m={...m,errors:wz(m.errors)}),m}function wz(m){if(!m)return null;let b=Object.entries(m),E={};for(let[C,L]of b)if(L&&L.__type==="RouteErrorResponse")E[C]=new p0(L.status,L.statusText,L.data,L.internal===!0);else if(L&&L.__type==="Error"){if(L.__subType){let N=window[L.__subType];if(typeof N=="function")try{let G=new N(L.message);G.stack="",E[C]=G}catch{}}if(E[C]==null){let N=new Error(L.message);N.stack="",E[C]=N}}else E[C]=L;return E}var $S=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Gd=ne.forwardRef(function({onClick:b,discover:E="render",prefetch:C="none",relative:L,reloadDocument:N,replace:G,state:r,target:Z,to:$,preventScrollReset:ie,viewTransition:oe,...fe},Re){let{basename:Ie}=ne.useContext(zh),be=typeof $=="string"&&$S.test($),ke,Oe=!1;if(typeof $=="string"&&be&&(ke=$,qS))try{let ni=new URL(window.location.href),Pi=$.startsWith("//")?new URL(ni.protocol+$):new URL($),xi=zc(Pi.pathname,Ie);Pi.origin===ni.origin&&xi!=null?$=xi+Pi.search+Pi.hash:Oe=!0}catch{to(!1,`<Link to="${$}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Be=ID($,{relative:L}),[je,at,ut]=mz(C,fe),Xe=Az($,{replace:G,state:r,target:Z,preventScrollReset:ie,relative:L,viewTransition:oe});function Tt(ni){b&&b(ni),ni.defaultPrevented||Xe(ni)}let vt=ne.createElement("a",{...fe,...ut,href:ke||Be,onClick:Oe||N?b:Tt,ref:vz(Re,at),target:Z,"data-discover":!be&&E==="render"?"true":void 0});return je&&!be?ne.createElement(ne.Fragment,null,vt,ne.createElement(gz,{page:Be})):vt});Gd.displayName="Link";var Tz=ne.forwardRef(function({"aria-current":b="page",caseSensitive:E=!1,className:C="",end:L=!1,style:N,to:G,viewTransition:r,children:Z,...$},ie){let oe=Iy(G,{relative:$.relative}),fe=ip(),Re=ne.useContext(My),{navigator:Ie,basename:be}=ne.useContext(zh),ke=Re!=null&&Dz(oe)&&r===!0,Oe=Ie.encodeLocation?Ie.encodeLocation(oe).pathname:oe.pathname,Be=fe.pathname,je=Re&&Re.navigation&&Re.navigation.location?Re.navigation.location.pathname:null;E||(Be=Be.toLowerCase(),je=je?je.toLowerCase():null,Oe=Oe.toLowerCase()),je&&be&&(je=zc(je,be)||je);const at=Oe!=="/"&&Oe.endsWith("/")?Oe.length-1:Oe.length;let ut=Be===Oe||!L&&Be.startsWith(Oe)&&Be.charAt(at)==="/",Xe=je!=null&&(je===Oe||!L&&je.startsWith(Oe)&&je.charAt(Oe.length)==="/"),Tt={isActive:ut,isPending:Xe,isTransitioning:ke},vt=ut?b:void 0,ni;typeof C=="function"?ni=C(Tt):ni=[C,ut?"active":null,Xe?"pending":null,ke?"transitioning":null].filter(Boolean).join(" ");let Pi=typeof N=="function"?N(Tt):N;return ne.createElement(Gd,{...$,"aria-current":vt,className:ni,ref:ie,style:Pi,to:G,viewTransition:r},typeof Z=="function"?Z(Tt):Z)});Tz.displayName="NavLink";var Sz=ne.forwardRef(({discover:m="render",fetcherKey:b,navigate:E,reloadDocument:C,replace:L,state:N,method:G=o0,action:r,onSubmit:Z,relative:$,preventScrollReset:ie,viewTransition:oe,...fe},Re)=>{let Ie=Rz(),be=Iz(r,{relative:$}),ke=G.toLowerCase()==="get"?"get":"post",Oe=typeof r=="string"&&$S.test(r),Be=je=>{if(Z&&Z(je),je.defaultPrevented)return;je.preventDefault();let at=je.nativeEvent.submitter,ut=(at==null?void 0:at.getAttribute("formmethod"))||G;Ie(at||je.currentTarget,{fetcherKey:b,method:ut,navigate:E,replace:L,state:N,relative:$,preventScrollReset:ie,viewTransition:oe})};return ne.createElement("form",{ref:Re,method:ke,action:be,onSubmit:C?Z:Be,...fe,"data-discover":!Oe&&m==="render"?"true":void 0})});Sz.displayName="Form";function Ez(m){return`${m} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ZS(m){let b=ne.useContext(Im);return Tr(b,Ez(m)),b}function Az(m,{target:b,replace:E,state:C,preventScrollReset:L,relative:N,viewTransition:G}={}){let r=Ry(),Z=ip(),$=Iy(m,{relative:N});return ne.useCallback(ie=>{if(tz(ie,b)){ie.preventDefault();let oe=E!==void 0?E:Yf(Z)===Yf($);r(m,{replace:oe,state:C,preventScrollReset:L,relative:N,viewTransition:G})}},[Z,r,$,E,C,b,m,L,N,G])}var Mz=0,Cz=()=>`__${String(++Mz)}__`;function Rz(){let{router:m}=ZS("useSubmit"),{basename:b}=ne.useContext(zh),E=UD();return ne.useCallback(async(C,L={})=>{let{action:N,method:G,encType:r,formData:Z,body:$}=rz(C,b);if(L.navigate===!1){let ie=L.fetcherKey||Cz();await m.fetch(ie,E,L.action||N,{preventScrollReset:L.preventScrollReset,formData:Z,body:$,formMethod:L.method||G,formEncType:L.encType||r,flushSync:L.flushSync})}else await m.navigate(L.action||N,{preventScrollReset:L.preventScrollReset,formData:Z,body:$,formMethod:L.method||G,formEncType:L.encType||r,replace:L.replace,state:L.state,fromRouteId:E,flushSync:L.flushSync,viewTransition:L.viewTransition})},[m,b,E])}function Iz(m,{relative:b}={}){let{basename:E}=ne.useContext(zh),C=ne.useContext(Ph);Tr(C,"useFormAction must be used inside a RouteContext");let[L]=C.matches.slice(-1),N={...Iy(m||".",{relative:b})},G=ip();if(m==null){N.search=G.search;let r=new URLSearchParams(N.search),Z=r.getAll("index");if(Z.some(ie=>ie==="")){r.delete("index"),Z.filter(oe=>oe).forEach(oe=>r.append("index",oe));let ie=r.toString();N.search=ie?`?${ie}`:""}}return(!m||m===".")&&L.route.index&&(N.search=N.search?N.search.replace(/^\?/,"?index&"):"?index"),E!=="/"&&(N.pathname=N.pathname==="/"?E:Mh([E,N.pathname])),Yf(N)}function Dz(m,b={}){let E=ne.useContext(t1);Tr(E!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:C}=ZS("useViewTransitionState"),L=Iy(m,{relative:b.relative});if(!E.isTransitioning)return!1;let N=zc(E.currentLocation.pathname,C)||E.currentLocation.pathname,G=zc(E.nextLocation.pathname,C)||E.nextLocation.pathname;return f0(L.pathname,G)!=null||f0(L.pathname,N)!=null}[...dz];var Yg=TS();const zz=Wb(Yg);/**
 * react-router v7.6.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Pz(m){return ne.createElement(ZD,{flushSync:Yg.flushSync,...m})}function XS(m){var b,E,C="";if(typeof m=="string"||typeof m=="number")C+=m;else if(typeof m=="object")if(Array.isArray(m)){var L=m.length;for(b=0;b<L;b++)m[b]&&(E=XS(m[b]))&&(C&&(C+=" "),C+=E)}else for(E in m)m[E]&&(C&&(C+=" "),C+=E);return C}function Hd(){for(var m,b,E=0,C="",L=arguments.length;E<L;E++)(m=arguments[E])&&(b=XS(m))&&(C&&(C+=" "),C+=b);return C}function Lz(m){if(typeof document>"u")return;let b=document.head||document.getElementsByTagName("head")[0],E=document.createElement("style");E.type="text/css",b.firstChild?b.insertBefore(E,b.firstChild):b.appendChild(E),E.styleSheet?E.styleSheet.cssText=m:E.appendChild(document.createTextNode(m))}Lz(`:root{--toastify-color-light: #fff;--toastify-color-dark: #121212;--toastify-color-info: #3498db;--toastify-color-success: #07bc0c;--toastify-color-warning: #f1c40f;--toastify-color-error: hsl(6, 78%, 57%);--toastify-color-transparent: rgba(255, 255, 255, .7);--toastify-icon-color-info: var(--toastify-color-info);--toastify-icon-color-success: var(--toastify-color-success);--toastify-icon-color-warning: var(--toastify-color-warning);--toastify-icon-color-error: var(--toastify-color-error);--toastify-container-width: fit-content;--toastify-toast-width: 320px;--toastify-toast-offset: 16px;--toastify-toast-top: max(var(--toastify-toast-offset), env(safe-area-inset-top));--toastify-toast-right: max(var(--toastify-toast-offset), env(safe-area-inset-right));--toastify-toast-left: max(var(--toastify-toast-offset), env(safe-area-inset-left));--toastify-toast-bottom: max(var(--toastify-toast-offset), env(safe-area-inset-bottom));--toastify-toast-background: #fff;--toastify-toast-padding: 14px;--toastify-toast-min-height: 64px;--toastify-toast-max-height: 800px;--toastify-toast-bd-radius: 6px;--toastify-toast-shadow: 0px 4px 12px rgba(0, 0, 0, .1);--toastify-font-family: sans-serif;--toastify-z-index: 9999;--toastify-text-color-light: #757575;--toastify-text-color-dark: #fff;--toastify-text-color-info: #fff;--toastify-text-color-success: #fff;--toastify-text-color-warning: #fff;--toastify-text-color-error: #fff;--toastify-spinner-color: #616161;--toastify-spinner-color-empty-area: #e0e0e0;--toastify-color-progress-light: linear-gradient(to right, #4cd964, #5ac8fa, #007aff, #34aadc, #5856d6, #ff2d55);--toastify-color-progress-dark: #bb86fc;--toastify-color-progress-info: var(--toastify-color-info);--toastify-color-progress-success: var(--toastify-color-success);--toastify-color-progress-warning: var(--toastify-color-warning);--toastify-color-progress-error: var(--toastify-color-error);--toastify-color-progress-bgo: .2}.Toastify__toast-container{z-index:var(--toastify-z-index);-webkit-transform:translate3d(0,0,var(--toastify-z-index));position:fixed;width:var(--toastify-container-width);box-sizing:border-box;color:#fff;display:flex;flex-direction:column}.Toastify__toast-container--top-left{top:var(--toastify-toast-top);left:var(--toastify-toast-left)}.Toastify__toast-container--top-center{top:var(--toastify-toast-top);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--top-right{top:var(--toastify-toast-top);right:var(--toastify-toast-right);align-items:end}.Toastify__toast-container--bottom-left{bottom:var(--toastify-toast-bottom);left:var(--toastify-toast-left)}.Toastify__toast-container--bottom-center{bottom:var(--toastify-toast-bottom);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--bottom-right{bottom:var(--toastify-toast-bottom);right:var(--toastify-toast-right);align-items:end}.Toastify__toast{--y: 0;position:relative;touch-action:none;width:var(--toastify-toast-width);min-height:var(--toastify-toast-min-height);box-sizing:border-box;margin-bottom:1rem;padding:var(--toastify-toast-padding);border-radius:var(--toastify-toast-bd-radius);box-shadow:var(--toastify-toast-shadow);max-height:var(--toastify-toast-max-height);font-family:var(--toastify-font-family);z-index:0;display:flex;flex:1 auto;align-items:center;word-break:break-word}@media only screen and (max-width: 480px){.Toastify__toast-container{width:100vw;left:env(safe-area-inset-left);margin:0}.Toastify__toast-container--top-left,.Toastify__toast-container--top-center,.Toastify__toast-container--top-right{top:env(safe-area-inset-top);transform:translate(0)}.Toastify__toast-container--bottom-left,.Toastify__toast-container--bottom-center,.Toastify__toast-container--bottom-right{bottom:env(safe-area-inset-bottom);transform:translate(0)}.Toastify__toast-container--rtl{right:env(safe-area-inset-right);left:initial}.Toastify__toast{--toastify-toast-width: 100%;margin-bottom:0;border-radius:0}}.Toastify__toast-container[data-stacked=true]{width:var(--toastify-toast-width)}.Toastify__toast--stacked{position:absolute;width:100%;transform:translate3d(0,var(--y),0) scale(var(--s));transition:transform .3s}.Toastify__toast--stacked[data-collapsed] .Toastify__toast-body,.Toastify__toast--stacked[data-collapsed] .Toastify__close-button{transition:opacity .1s}.Toastify__toast--stacked[data-collapsed=false]{overflow:visible}.Toastify__toast--stacked[data-collapsed=true]:not(:last-child)>*{opacity:0}.Toastify__toast--stacked:after{content:"";position:absolute;left:0;right:0;height:calc(var(--g) * 1px);bottom:100%}.Toastify__toast--stacked[data-pos=top]{top:0}.Toastify__toast--stacked[data-pos=bot]{bottom:0}.Toastify__toast--stacked[data-pos=bot].Toastify__toast--stacked:before{transform-origin:top}.Toastify__toast--stacked[data-pos=top].Toastify__toast--stacked:before{transform-origin:bottom}.Toastify__toast--stacked:before{content:"";position:absolute;left:0;right:0;bottom:0;height:100%;transform:scaleY(3);z-index:-1}.Toastify__toast--rtl{direction:rtl}.Toastify__toast--close-on-click{cursor:pointer}.Toastify__toast-icon{margin-inline-end:10px;width:22px;flex-shrink:0;display:flex}.Toastify--animate{animation-fill-mode:both;animation-duration:.5s}.Toastify--animate-icon{animation-fill-mode:both;animation-duration:.3s}.Toastify__toast-theme--dark{background:var(--toastify-color-dark);color:var(--toastify-text-color-dark)}.Toastify__toast-theme--light,.Toastify__toast-theme--colored.Toastify__toast--default{background:var(--toastify-color-light);color:var(--toastify-text-color-light)}.Toastify__toast-theme--colored.Toastify__toast--info{color:var(--toastify-text-color-info);background:var(--toastify-color-info)}.Toastify__toast-theme--colored.Toastify__toast--success{color:var(--toastify-text-color-success);background:var(--toastify-color-success)}.Toastify__toast-theme--colored.Toastify__toast--warning{color:var(--toastify-text-color-warning);background:var(--toastify-color-warning)}.Toastify__toast-theme--colored.Toastify__toast--error{color:var(--toastify-text-color-error);background:var(--toastify-color-error)}.Toastify__progress-bar-theme--light{background:var(--toastify-color-progress-light)}.Toastify__progress-bar-theme--dark{background:var(--toastify-color-progress-dark)}.Toastify__progress-bar--info{background:var(--toastify-color-progress-info)}.Toastify__progress-bar--success{background:var(--toastify-color-progress-success)}.Toastify__progress-bar--warning{background:var(--toastify-color-progress-warning)}.Toastify__progress-bar--error{background:var(--toastify-color-progress-error)}.Toastify__progress-bar-theme--colored.Toastify__progress-bar--info,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--success,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--warning,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--error{background:var(--toastify-color-transparent)}.Toastify__close-button{color:#fff;position:absolute;top:6px;right:6px;background:transparent;outline:none;border:none;padding:0;cursor:pointer;opacity:.7;transition:.3s ease;z-index:1}.Toastify__toast--rtl .Toastify__close-button{left:6px;right:unset}.Toastify__close-button--light{color:#000;opacity:.3}.Toastify__close-button>svg{fill:currentColor;height:16px;width:14px}.Toastify__close-button:hover,.Toastify__close-button:focus{opacity:1}@keyframes Toastify__trackProgress{0%{transform:scaleX(1)}to{transform:scaleX(0)}}.Toastify__progress-bar{position:absolute;bottom:0;left:0;width:100%;height:100%;z-index:1;opacity:.7;transform-origin:left}.Toastify__progress-bar--animated{animation:Toastify__trackProgress linear 1 forwards}.Toastify__progress-bar--controlled{transition:transform .2s}.Toastify__progress-bar--rtl{right:0;left:initial;transform-origin:right;border-bottom-left-radius:initial}.Toastify__progress-bar--wrp{position:absolute;overflow:hidden;bottom:0;left:0;width:100%;height:5px;border-bottom-left-radius:var(--toastify-toast-bd-radius);border-bottom-right-radius:var(--toastify-toast-bd-radius)}.Toastify__progress-bar--wrp[data-hidden=true]{opacity:0}.Toastify__progress-bar--bg{opacity:var(--toastify-color-progress-bgo);width:100%;height:100%}.Toastify__spinner{width:20px;height:20px;box-sizing:border-box;border:2px solid;border-radius:100%;border-color:var(--toastify-spinner-color-empty-area);border-right-color:var(--toastify-spinner-color);animation:Toastify__spin .65s linear infinite}@keyframes Toastify__bounceInRight{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0)}60%{opacity:1;transform:translate3d(-25px,0,0)}75%{transform:translate3d(10px,0,0)}90%{transform:translate3d(-5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutRight{20%{opacity:1;transform:translate3d(-20px,var(--y),0)}to{opacity:0;transform:translate3d(2000px,var(--y),0)}}@keyframes Toastify__bounceInLeft{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(-3000px,0,0)}60%{opacity:1;transform:translate3d(25px,0,0)}75%{transform:translate3d(-10px,0,0)}90%{transform:translate3d(5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutLeft{20%{opacity:1;transform:translate3d(20px,var(--y),0)}to{opacity:0;transform:translate3d(-2000px,var(--y),0)}}@keyframes Toastify__bounceInUp{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,3000px,0)}60%{opacity:1;transform:translate3d(0,-20px,0)}75%{transform:translate3d(0,10px,0)}90%{transform:translate3d(0,-5px,0)}to{transform:translateZ(0)}}@keyframes Toastify__bounceOutUp{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,-2000px,0)}}@keyframes Toastify__bounceInDown{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,-3000px,0)}60%{opacity:1;transform:translate3d(0,25px,0)}75%{transform:translate3d(0,-10px,0)}90%{transform:translate3d(0,5px,0)}to{transform:none}}@keyframes Toastify__bounceOutDown{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,2000px,0)}}.Toastify__bounce-enter--top-left,.Toastify__bounce-enter--bottom-left{animation-name:Toastify__bounceInLeft}.Toastify__bounce-enter--top-right,.Toastify__bounce-enter--bottom-right{animation-name:Toastify__bounceInRight}.Toastify__bounce-enter--top-center{animation-name:Toastify__bounceInDown}.Toastify__bounce-enter--bottom-center{animation-name:Toastify__bounceInUp}.Toastify__bounce-exit--top-left,.Toastify__bounce-exit--bottom-left{animation-name:Toastify__bounceOutLeft}.Toastify__bounce-exit--top-right,.Toastify__bounce-exit--bottom-right{animation-name:Toastify__bounceOutRight}.Toastify__bounce-exit--top-center{animation-name:Toastify__bounceOutUp}.Toastify__bounce-exit--bottom-center{animation-name:Toastify__bounceOutDown}@keyframes Toastify__zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes Toastify__zoomOut{0%{opacity:1}50%{opacity:0;transform:translate3d(0,var(--y),0) scale3d(.3,.3,.3)}to{opacity:0}}.Toastify__zoom-enter{animation-name:Toastify__zoomIn}.Toastify__zoom-exit{animation-name:Toastify__zoomOut}@keyframes Toastify__flipIn{0%{transform:perspective(400px) rotateX(90deg);animation-timing-function:ease-in;opacity:0}40%{transform:perspective(400px) rotateX(-20deg);animation-timing-function:ease-in}60%{transform:perspective(400px) rotateX(10deg);opacity:1}80%{transform:perspective(400px) rotateX(-5deg)}to{transform:perspective(400px)}}@keyframes Toastify__flipOut{0%{transform:translate3d(0,var(--y),0) perspective(400px)}30%{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(-20deg);opacity:1}to{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(90deg);opacity:0}}.Toastify__flip-enter{animation-name:Toastify__flipIn}.Toastify__flip-exit{animation-name:Toastify__flipOut}@keyframes Toastify__slideInRight{0%{transform:translate3d(110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInLeft{0%{transform:translate3d(-110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInUp{0%{transform:translate3d(0,110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInDown{0%{transform:translate3d(0,-110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideOutRight{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(110%,var(--y),0)}}@keyframes Toastify__slideOutLeft{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(-110%,var(--y),0)}}@keyframes Toastify__slideOutDown{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,500px,0)}}@keyframes Toastify__slideOutUp{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,-500px,0)}}.Toastify__slide-enter--top-left,.Toastify__slide-enter--bottom-left{animation-name:Toastify__slideInLeft}.Toastify__slide-enter--top-right,.Toastify__slide-enter--bottom-right{animation-name:Toastify__slideInRight}.Toastify__slide-enter--top-center{animation-name:Toastify__slideInDown}.Toastify__slide-enter--bottom-center{animation-name:Toastify__slideInUp}.Toastify__slide-exit--top-left,.Toastify__slide-exit--bottom-left{animation-name:Toastify__slideOutLeft;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-right,.Toastify__slide-exit--bottom-right{animation-name:Toastify__slideOutRight;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-center{animation-name:Toastify__slideOutUp;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--bottom-center{animation-name:Toastify__slideOutDown;animation-timing-function:ease-in;animation-duration:.3s}@keyframes Toastify__spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}
`);var Dy=m=>typeof m=="number"&&!isNaN(m),Sm=m=>typeof m=="string",$d=m=>typeof m=="function",Oz=m=>Sm(m)||Dy(m),Rb=m=>Sm(m)||$d(m)?m:null,kz=(m,b)=>m===!1||Dy(m)&&m>0?m:b,Ib=m=>ne.isValidElement(m)||Sm(m)||$d(m)||Dy(m);function Nz(m,b,E=300){let{scrollHeight:C,style:L}=m;requestAnimationFrame(()=>{L.minHeight="initial",L.height=C+"px",L.transition=`all ${E}ms`,requestAnimationFrame(()=>{L.height="0",L.padding="0",L.margin="0",setTimeout(b,E)})})}function Bz({enter:m,exit:b,appendPosition:E=!1,collapse:C=!0,collapseDuration:L=300}){return function({children:N,position:G,preventExitTransition:r,done:Z,nodeRef:$,isIn:ie,playToast:oe}){let fe=E?`${m}--${G}`:m,Re=E?`${b}--${G}`:b,Ie=ne.useRef(0);return ne.useLayoutEffect(()=>{let be=$.current,ke=fe.split(" "),Oe=Be=>{Be.target===$.current&&(oe(),be.removeEventListener("animationend",Oe),be.removeEventListener("animationcancel",Oe),Ie.current===0&&Be.type!=="animationcancel"&&be.classList.remove(...ke))};be.classList.add(...ke),be.addEventListener("animationend",Oe),be.addEventListener("animationcancel",Oe)},[]),ne.useEffect(()=>{let be=$.current,ke=()=>{be.removeEventListener("animationend",ke),C?Nz(be,Z,L):Z()};ie||(r?ke():(Ie.current=1,be.className+=` ${Re}`,be.addEventListener("animationend",ke)))},[ie]),zr.createElement(zr.Fragment,null,N)}}function P2(m,b){return{content:WS(m.content,m.props),containerId:m.props.containerId,id:m.props.toastId,theme:m.props.theme,type:m.props.type,data:m.props.data||{},isLoading:m.props.isLoading,icon:m.props.icon,reason:m.removalReason,status:b}}function WS(m,b,E=!1){return ne.isValidElement(m)&&!Sm(m.type)?ne.cloneElement(m,{closeToast:b.closeToast,toastProps:b,data:b.data,isPaused:E}):$d(m)?m({closeToast:b.closeToast,toastProps:b,data:b.data,isPaused:E}):m}function Fz({closeToast:m,theme:b,ariaLabel:E="close"}){return zr.createElement("button",{className:`Toastify__close-button Toastify__close-button--${b}`,type:"button",onClick:C=>{C.stopPropagation(),m(!0)},"aria-label":E},zr.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},zr.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function jz({delay:m,isRunning:b,closeToast:E,type:C="default",hide:L,className:N,controlledProgress:G,progress:r,rtl:Z,isIn:$,theme:ie}){let oe=L||G&&r===0,fe={animationDuration:`${m}ms`,animationPlayState:b?"running":"paused"};G&&(fe.transform=`scaleX(${r})`);let Re=Hd("Toastify__progress-bar",G?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${ie}`,`Toastify__progress-bar--${C}`,{"Toastify__progress-bar--rtl":Z}),Ie=$d(N)?N({rtl:Z,type:C,defaultClassName:Re}):Hd(Re,N),be={[G&&r>=1?"onTransitionEnd":"onAnimationEnd"]:G&&r<1?null:()=>{$&&E()}};return zr.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":oe},zr.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${ie} Toastify__progress-bar--${C}`}),zr.createElement("div",{role:"progressbar","aria-hidden":oe?"true":"false","aria-label":"notification timer",className:Ie,style:fe,...be}))}var Uz=1,YS=()=>`${Uz++}`;function Vz(m,b,E){let C=1,L=0,N=[],G=[],r=b,Z=new Map,$=new Set,ie=Be=>($.add(Be),()=>$.delete(Be)),oe=()=>{G=Array.from(Z.values()),$.forEach(Be=>Be())},fe=({containerId:Be,toastId:je,updateId:at})=>{let ut=Be?Be!==m:m!==1,Xe=Z.has(je)&&at==null;return ut||Xe},Re=(Be,je)=>{Z.forEach(at=>{var ut;(je==null||je===at.props.toastId)&&((ut=at.toggle)==null||ut.call(at,Be))})},Ie=Be=>{var je,at;(at=(je=Be.props)==null?void 0:je.onClose)==null||at.call(je,Be.removalReason),Be.isActive=!1},be=Be=>{if(Be==null)Z.forEach(Ie);else{let je=Z.get(Be);je&&Ie(je)}oe()},ke=()=>{L-=N.length,N=[]},Oe=Be=>{var je,at;let{toastId:ut,updateId:Xe}=Be.props,Tt=Xe==null;Be.staleId&&Z.delete(Be.staleId),Be.isActive=!0,Z.set(ut,Be),oe(),E(P2(Be,Tt?"added":"updated")),Tt&&((at=(je=Be.props).onOpen)==null||at.call(je))};return{id:m,props:r,observe:ie,toggle:Re,removeToast:be,toasts:Z,clearQueue:ke,buildToast:(Be,je)=>{if(fe(je))return;let{toastId:at,updateId:ut,data:Xe,staleId:Tt,delay:vt}=je,ni=ut==null;ni&&L++;let Pi={...r,style:r.toastStyle,key:C++,...Object.fromEntries(Object.entries(je).filter(([Fi,Ei])=>Ei!=null)),toastId:at,updateId:ut,data:Xe,isIn:!1,className:Rb(je.className||r.toastClassName),progressClassName:Rb(je.progressClassName||r.progressClassName),autoClose:je.isLoading?!1:kz(je.autoClose,r.autoClose),closeToast(Fi){Z.get(at).removalReason=Fi,be(at)},deleteToast(){let Fi=Z.get(at);if(Fi!=null){if(E(P2(Fi,"removed")),Z.delete(at),L--,L<0&&(L=0),N.length>0){Oe(N.shift());return}oe()}}};Pi.closeButton=r.closeButton,je.closeButton===!1||Ib(je.closeButton)?Pi.closeButton=je.closeButton:je.closeButton===!0&&(Pi.closeButton=Ib(r.closeButton)?r.closeButton:!0);let xi={content:Be,props:Pi,staleId:Tt};r.limit&&r.limit>0&&L>r.limit&&ni?N.push(xi):Dy(vt)?setTimeout(()=>{Oe(xi)},vt):Oe(xi)},setProps(Be){r=Be},setToggle:(Be,je)=>{let at=Z.get(Be);at&&(at.toggle=je)},isToastActive:Be=>{var je;return(je=Z.get(Be))==null?void 0:je.isActive},getSnapshot:()=>G}}var Ys=new Map,wy=[],Db=new Set,Gz=m=>Db.forEach(b=>b(m)),KS=()=>Ys.size>0;function Hz(){wy.forEach(m=>JS(m.content,m.options)),wy=[]}var qz=(m,{containerId:b})=>{var E;return(E=Ys.get(b||1))==null?void 0:E.toasts.get(m)};function QS(m,b){var E;if(b)return!!((E=Ys.get(b))!=null&&E.isToastActive(m));let C=!1;return Ys.forEach(L=>{L.isToastActive(m)&&(C=!0)}),C}function $z(m){if(!KS()){wy=wy.filter(b=>m!=null&&b.options.toastId!==m);return}if(m==null||Oz(m))Ys.forEach(b=>{b.removeToast(m)});else if(m&&("containerId"in m||"id"in m)){let b=Ys.get(m.containerId);b?b.removeToast(m.id):Ys.forEach(E=>{E.removeToast(m.id)})}}var Zz=(m={})=>{Ys.forEach(b=>{b.props.limit&&(!m.containerId||b.id===m.containerId)&&b.clearQueue()})};function JS(m,b){Ib(m)&&(KS()||wy.push({content:m,options:b}),Ys.forEach(E=>{E.buildToast(m,b)}))}function Xz(m){var b;(b=Ys.get(m.containerId||1))==null||b.setToggle(m.id,m.fn)}function eE(m,b){Ys.forEach(E=>{(b==null||!(b!=null&&b.containerId)||(b==null?void 0:b.containerId)===E.id)&&E.toggle(m,b==null?void 0:b.id)})}function Wz(m){let b=m.containerId||1;return{subscribe(E){let C=Vz(b,m,Gz);Ys.set(b,C);let L=C.observe(E);return Hz(),()=>{L(),Ys.delete(b)}},setProps(E){var C;(C=Ys.get(b))==null||C.setProps(E)},getSnapshot(){var E;return(E=Ys.get(b))==null?void 0:E.getSnapshot()}}}function Yz(m){return Db.add(m),()=>{Db.delete(m)}}function Kz(m){return m&&(Sm(m.toastId)||Dy(m.toastId))?m.toastId:YS()}function zy(m,b){return JS(m,b),b.toastId}function C0(m,b){return{...b,type:b&&b.type||m,toastId:Kz(b)}}function R0(m){return(b,E)=>zy(b,C0(m,E))}function sa(m,b){return zy(m,C0("default",b))}sa.loading=(m,b)=>zy(m,C0("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...b}));function Qz(m,{pending:b,error:E,success:C},L){let N;b&&(N=Sm(b)?sa.loading(b,L):sa.loading(b.render,{...L,...b}));let G={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},r=($,ie,oe)=>{if(ie==null){sa.dismiss(N);return}let fe={type:$,...G,...L,data:oe},Re=Sm(ie)?{render:ie}:ie;return N?sa.update(N,{...fe,...Re}):sa(Re.render,{...fe,...Re}),oe},Z=$d(m)?m():m;return Z.then($=>r("success",C,$)).catch($=>r("error",E,$)),Z}sa.promise=Qz;sa.success=R0("success");sa.info=R0("info");sa.error=R0("error");sa.warning=R0("warning");sa.warn=sa.warning;sa.dark=(m,b)=>zy(m,C0("default",{theme:"dark",...b}));function Jz(m){$z(m)}sa.dismiss=Jz;sa.clearWaitingQueue=Zz;sa.isActive=QS;sa.update=(m,b={})=>{let E=qz(m,b);if(E){let{props:C,content:L}=E,N={delay:100,...C,...b,toastId:b.toastId||m,updateId:YS()};N.toastId!==m&&(N.staleId=m);let G=N.render||L;delete N.render,zy(G,N)}};sa.done=m=>{sa.update(m,{progress:1})};sa.onChange=Yz;sa.play=m=>eE(!0,m);sa.pause=m=>eE(!1,m);function eP(m){var b;let{subscribe:E,getSnapshot:C,setProps:L}=ne.useRef(Wz(m)).current;L(m);let N=(b=ne.useSyncExternalStore(E,C,C))==null?void 0:b.slice();function G(r){if(!N)return[];let Z=new Map;return m.newestOnTop&&N.reverse(),N.forEach($=>{let{position:ie}=$.props;Z.has(ie)||Z.set(ie,[]),Z.get(ie).push($)}),Array.from(Z,$=>r($[0],$[1]))}return{getToastToRender:G,isToastActive:QS,count:N==null?void 0:N.length}}function tP(m){let[b,E]=ne.useState(!1),[C,L]=ne.useState(!1),N=ne.useRef(null),G=ne.useRef({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:r,pauseOnHover:Z,closeToast:$,onClick:ie,closeOnClick:oe}=m;Xz({id:m.toastId,containerId:m.containerId,fn:E}),ne.useEffect(()=>{if(m.pauseOnFocusLoss)return fe(),()=>{Re()}},[m.pauseOnFocusLoss]);function fe(){document.hasFocus()||Oe(),window.addEventListener("focus",ke),window.addEventListener("blur",Oe)}function Re(){window.removeEventListener("focus",ke),window.removeEventListener("blur",Oe)}function Ie(Tt){if(m.draggable===!0||m.draggable===Tt.pointerType){Be();let vt=N.current;G.canCloseOnClick=!0,G.canDrag=!0,vt.style.transition="none",m.draggableDirection==="x"?(G.start=Tt.clientX,G.removalDistance=vt.offsetWidth*(m.draggablePercent/100)):(G.start=Tt.clientY,G.removalDistance=vt.offsetHeight*(m.draggablePercent===80?m.draggablePercent*1.5:m.draggablePercent)/100)}}function be(Tt){let{top:vt,bottom:ni,left:Pi,right:xi}=N.current.getBoundingClientRect();Tt.nativeEvent.type!=="touchend"&&m.pauseOnHover&&Tt.clientX>=Pi&&Tt.clientX<=xi&&Tt.clientY>=vt&&Tt.clientY<=ni?Oe():ke()}function ke(){E(!0)}function Oe(){E(!1)}function Be(){G.didMove=!1,document.addEventListener("pointermove",at),document.addEventListener("pointerup",ut)}function je(){document.removeEventListener("pointermove",at),document.removeEventListener("pointerup",ut)}function at(Tt){let vt=N.current;if(G.canDrag&&vt){G.didMove=!0,b&&Oe(),m.draggableDirection==="x"?G.delta=Tt.clientX-G.start:G.delta=Tt.clientY-G.start,G.start!==Tt.clientX&&(G.canCloseOnClick=!1);let ni=m.draggableDirection==="x"?`${G.delta}px, var(--y)`:`0, calc(${G.delta}px + var(--y))`;vt.style.transform=`translate3d(${ni},0)`,vt.style.opacity=`${1-Math.abs(G.delta/G.removalDistance)}`}}function ut(){je();let Tt=N.current;if(G.canDrag&&G.didMove&&Tt){if(G.canDrag=!1,Math.abs(G.delta)>G.removalDistance){L(!0),m.closeToast(!0),m.collapseAll();return}Tt.style.transition="transform 0.2s, opacity 0.2s",Tt.style.removeProperty("transform"),Tt.style.removeProperty("opacity")}}let Xe={onPointerDown:Ie,onPointerUp:be};return r&&Z&&(Xe.onMouseEnter=Oe,m.stacked||(Xe.onMouseLeave=ke)),oe&&(Xe.onClick=Tt=>{ie&&ie(Tt),G.canCloseOnClick&&$(!0)}),{playToast:ke,pauseToast:Oe,isRunning:b,preventExitTransition:C,toastRef:N,eventHandlers:Xe}}var iP=typeof window<"u"?ne.useLayoutEffect:ne.useEffect,I0=({theme:m,type:b,isLoading:E,...C})=>zr.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:m==="colored"?"currentColor":`var(--toastify-icon-color-${b})`,...C});function nP(m){return zr.createElement(I0,{...m},zr.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))}function rP(m){return zr.createElement(I0,{...m},zr.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))}function aP(m){return zr.createElement(I0,{...m},zr.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))}function oP(m){return zr.createElement(I0,{...m},zr.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))}function sP(){return zr.createElement("div",{className:"Toastify__spinner"})}var zb={info:rP,warning:nP,success:aP,error:oP,spinner:sP},lP=m=>m in zb;function cP({theme:m,type:b,isLoading:E,icon:C}){let L=null,N={theme:m,type:b};return C===!1||($d(C)?L=C({...N,isLoading:E}):ne.isValidElement(C)?L=ne.cloneElement(C,N):E?L=zb.spinner():lP(b)&&(L=zb[b](N))),L}var uP=m=>{let{isRunning:b,preventExitTransition:E,toastRef:C,eventHandlers:L,playToast:N}=tP(m),{closeButton:G,children:r,autoClose:Z,onClick:$,type:ie,hideProgressBar:oe,closeToast:fe,transition:Re,position:Ie,className:be,style:ke,progressClassName:Oe,updateId:Be,role:je,progress:at,rtl:ut,toastId:Xe,deleteToast:Tt,isIn:vt,isLoading:ni,closeOnClick:Pi,theme:xi,ariaLabel:Fi}=m,Ei=Hd("Toastify__toast",`Toastify__toast-theme--${xi}`,`Toastify__toast--${ie}`,{"Toastify__toast--rtl":ut},{"Toastify__toast--close-on-click":Pi}),fi=$d(be)?be({rtl:ut,position:Ie,type:ie,defaultClassName:Ei}):Hd(Ei,be),yi=cP(m),Je=!!at||!Z,jt={closeToast:fe,type:ie,theme:xi},_t=null;return G===!1||($d(G)?_t=G(jt):ne.isValidElement(G)?_t=ne.cloneElement(G,jt):_t=Fz(jt)),zr.createElement(Re,{isIn:vt,done:Tt,position:Ie,preventExitTransition:E,nodeRef:C,playToast:N},zr.createElement("div",{id:Xe,tabIndex:0,onClick:$,"data-in":vt,className:fi,...L,style:ke,ref:C,...vt&&{role:je,"aria-label":Fi}},yi!=null&&zr.createElement("div",{className:Hd("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!ni})},yi),WS(r,m,!b),_t,!m.customProgressBar&&zr.createElement(jz,{...Be&&!Je?{key:`p-${Be}`}:{},rtl:ut,theme:xi,delay:Z,isRunning:b,isIn:vt,closeToast:fe,hide:oe,type:ie,className:Oe,controlledProgress:Je,progress:at||0})))},hP=(m,b=!1)=>({enter:`Toastify--animate Toastify__${m}-enter`,exit:`Toastify--animate Toastify__${m}-exit`,appendPosition:b}),dP=Bz(hP("bounce",!0)),fP={position:"top-right",transition:dP,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light","aria-label":"Notifications Alt+T",hotKeys:m=>m.altKey&&m.code==="KeyT"};function pP(m){let b={...fP,...m},E=m.stacked,[C,L]=ne.useState(!0),N=ne.useRef(null),{getToastToRender:G,isToastActive:r,count:Z}=eP(b),{className:$,style:ie,rtl:oe,containerId:fe,hotKeys:Re}=b;function Ie(ke){let Oe=Hd("Toastify__toast-container",`Toastify__toast-container--${ke}`,{"Toastify__toast-container--rtl":oe});return $d($)?$({position:ke,rtl:oe,defaultClassName:Oe}):Hd(Oe,Rb($))}function be(){E&&(L(!0),sa.play())}return iP(()=>{var ke;if(E){let Oe=N.current.querySelectorAll('[data-in="true"]'),Be=12,je=(ke=b.position)==null?void 0:ke.includes("top"),at=0,ut=0;Array.from(Oe).reverse().forEach((Xe,Tt)=>{let vt=Xe;vt.classList.add("Toastify__toast--stacked"),Tt>0&&(vt.dataset.collapsed=`${C}`),vt.dataset.pos||(vt.dataset.pos=je?"top":"bot");let ni=at*(C?.2:1)+(C?0:Be*Tt);vt.style.setProperty("--y",`${je?ni:ni*-1}px`),vt.style.setProperty("--g",`${Be}`),vt.style.setProperty("--s",`${1-(C?ut:0)}`),at+=vt.offsetHeight,ut+=.025})}},[C,Z,E]),ne.useEffect(()=>{function ke(Oe){var Be;let je=N.current;Re(Oe)&&((Be=je.querySelector('[tabIndex="0"]'))==null||Be.focus(),L(!1),sa.pause()),Oe.key==="Escape"&&(document.activeElement===je||je!=null&&je.contains(document.activeElement))&&(L(!0),sa.play())}return document.addEventListener("keydown",ke),()=>{document.removeEventListener("keydown",ke)}},[Re]),zr.createElement("section",{ref:N,className:"Toastify",id:fe,onMouseEnter:()=>{E&&(L(!1),sa.pause())},onMouseLeave:be,"aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text","aria-label":b["aria-label"]},G((ke,Oe)=>{let Be=Oe.length?{...ie}:{...ie,pointerEvents:"none"};return zr.createElement("div",{tabIndex:-1,className:Ie(ke),"data-stacked":E,style:Be,key:`c-${ke}`},Oe.map(({content:je,props:at})=>zr.createElement(uP,{...at,stacked:E,collapseAll:be,isIn:r(at.toastId,at.containerId),key:`t-${at.key}`},je)))}))}const ts=[];for(let m=0;m<256;++m)ts.push((m+256).toString(16).slice(1));function mP(m,b=0){return(ts[m[b+0]]+ts[m[b+1]]+ts[m[b+2]]+ts[m[b+3]]+"-"+ts[m[b+4]]+ts[m[b+5]]+"-"+ts[m[b+6]]+ts[m[b+7]]+"-"+ts[m[b+8]]+ts[m[b+9]]+"-"+ts[m[b+10]]+ts[m[b+11]]+ts[m[b+12]]+ts[m[b+13]]+ts[m[b+14]]+ts[m[b+15]]).toLowerCase()}let hb;const gP=new Uint8Array(16);function _P(){if(!hb){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");hb=crypto.getRandomValues.bind(crypto)}return hb(gP)}const yP=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),L2={randomUUID:yP};function tE(m,b,E){var L;if(L2.randomUUID&&!m)return L2.randomUUID();m=m||{};const C=m.random??((L=m.rng)==null?void 0:L.call(m))??_P();if(C.length<16)throw new Error("Random bytes length must be >= 16");return C[6]=C[6]&15|64,C[8]=C[8]&63|128,mP(C)}const vP="/ProfileMap/assets/a1-BLryAb-3.jpg",xP="/ProfileMap/assets/a2-BvB0JwVq.jpg",O2="/ProfileMap/assets/a3-1kg6TMeo.jpg",bP="/ProfileMap/assets/a4-BUMTIKj2.jpg",wP="/ProfileMap/assets/a5-CMPxVprs.jpg",TP="/ProfileMap/assets/a6-uZlezxnB.jpg",SP="/ProfileMap/assets/a7-DlHYhhey.jpg",k2=[{id:"1",name:"Emma Johnson",email:"emma.johnson@example.com",phone:"+1 (555) 123-4567",occupation:"Software Engineer",bio:"Emma is a senior software engineer with over 8 years of experience in full-stack development. She specializes in React, Node.js, and cloud architecture. In her free time, she contributes to open-source projects and mentors junior developers.",avatar:vP,joinedDate:"January 15, 2023",interests:["Programming","Hiking","Photography","Machine Learning"],location:{street:"123 Tech Avenue",city:"San Francisco",state:"CA",postalCode:"94105",country:"United States",coordinates:{lat:37.7749,lng:-122.4194}}},{id:"2",name:"Michael Chen",email:"michael.chen@example.com",phone:"+1 (555) 987-6543",occupation:"UX Designer",bio:"Michael is a creative UX designer who combines artistic vision with user-centered design principles. With a background in psychology, he brings a unique perspective to creating intuitive and engaging user experiences. He has worked with startups and enterprise clients across various industries.",avatar:xP,joinedDate:"March 3, 2023",interests:["Design","Travel","Cooking","Psychology"],location:{street:"456 Design Boulevard",city:"New York",state:"NY",postalCode:"10001",country:"United States",coordinates:{lat:40.7128,lng:-74.006}}},{id:"3",name:"Sophia Rodriguez",email:"sophia.rodriguez@example.com",phone:"+44 20 1234 5678",occupation:"Data Scientist",bio:"Sophia is a data scientist with expertise in machine learning and statistical analysis. She has a PhD in Computer Science and has published several papers on AI ethics. She is passionate about using data for social good and has worked on projects related to healthcare and climate change.",avatar:O2,joinedDate:"February 20, 2023",interests:["AI","Statistics","Reading","Yoga"],location:{street:"789 Data Drive",city:"London",state:"",postalCode:"EC1V 4PW",country:"United Kingdom",coordinates:{lat:51.5074,lng:-.1278}}},{id:"4",name:"Jamal Williams",email:"jamal.williams@example.com",phone:"+61 2 9876 5432",occupation:"Marketing Director",bio:"Jamal is a marketing director with over 15 years of experience in digital marketing and brand strategy. He has led successful campaigns for Fortune 500 companies and has a track record of driving growth through innovative marketing approaches. He is also a keynote speaker at industry conferences.",avatar:bP,joinedDate:"April 10, 2023",interests:["Marketing","Public Speaking","Jazz","Tennis"],location:{street:"101 Market Street",city:"Sydney",state:"NSW",postalCode:"2000",country:"Australia",coordinates:{lat:-33.8688,lng:151.2093}}},{id:"5",name:"Aisha Patel",email:"aisha.patel@example.com",phone:"+91 98765 43210",occupation:"Product Manager",bio:"Aisha is a product manager with a passion for creating products that solve real-world problems. With a background in engineering and an MBA, she bridges the gap between technical and business aspects of product development. She has launched several successful products in the fintech space.",avatar:wP,joinedDate:"May 5, 2023",interests:["Product Strategy","Fintech","Meditation","Painting"],location:{street:"234 Product Road",city:"Bangalore",state:"Karnataka",postalCode:"560001",country:"India",coordinates:{lat:12.9716,lng:77.5946}}},{id:"6",name:"Lucas Schmidt",email:"lucas.schmidt@example.com",phone:"+49 30 1234567",occupation:"Blockchain Developer",bio:"Lucas is a blockchain developer specializing in smart contracts and decentralized applications. He has contributed to several major blockchain projects and is an advocate for web3 technologies. He regularly speaks at tech conferences and runs workshops on blockchain development.",avatar:TP,joinedDate:"June 15, 2023",interests:["Blockchain","Cryptocurrency","Gaming","Snowboarding"],location:{street:"567 Blockchain Strasse",city:"Berlin",state:"",postalCode:"10115",country:"Germany",coordinates:{lat:52.52,lng:13.405}}},{id:"7",name:"Nadia Kim",email:"nadia.kim@example.com",phone:"+82 2 1234 5678",occupation:"UI/UX Researcher",bio:"Nadia is a UI/UX researcher who combines qualitative and quantitative methods to understand user behavior and needs. She has a background in cognitive psychology and has worked with companies across Asia and North America. She is passionate about creating accessible and inclusive digital experiences.",avatar:SP,joinedDate:"July 7, 2023",interests:["User Research","Accessibility","Travel","Photography"],location:{street:"890 Research Avenue",city:"Seoul",state:"",postalCode:"06164",country:"South Korea",coordinates:{lat:37.5665,lng:126.978}}},{id:"8",name:"Carlos Mendoza",email:"carlos.mendoza@example.com",phone:"+52 55 1234 5678",occupation:"DevOps Engineer",bio:"Carlos is a DevOps engineer with expertise in cloud infrastructure, CI/CD pipelines, and containerization. He has helped numerous companies implement efficient and scalable deployment processes. He is also an advocate for site reliability engineering practices and has authored several technical guides.",avatar:O2,joinedDate:"August 12, 2023",interests:["Cloud Computing","Automation","Soccer","Cooking"],location:{street:"345 DevOps Street",city:"Mexico City",state:"",postalCode:"06500",country:"Mexico",coordinates:{lat:19.4326,lng:-99.1332}}}];function s1(){const[m,b]=ne.useState(null),[E,C]=ne.useState(!0),[L,N]=ne.useState(null);return ne.useEffect(()=>{(async()=>{try{await new Promise(oe=>setTimeout(oe,1e3));const ie=localStorage.getItem("profiles");ie?b(JSON.parse(ie)):(b(k2),localStorage.setItem("profiles",JSON.stringify(k2))),C(!1)}catch(ie){console.error("Error fetching profiles:",ie),N("Failed to load profiles. Please try again."),C(!1)}})()},[]),{profiles:m,loading:E,error:L,addProfile:async $=>{try{const ie={...$,id:$.id||tE()};return b(oe=>{const fe=oe?[...oe,ie]:[ie];return localStorage.setItem("profiles",JSON.stringify(fe)),fe}),ie}catch(ie){throw console.error("Error adding profile:",ie),N("Failed to add profile. Please try again."),ie}},updateProfile:async $=>{try{return b(ie=>{if(!ie)return ie;const oe=ie.map(fe=>fe.id===$.id?$:fe);return localStorage.setItem("profiles",JSON.stringify(oe)),oe}),$}catch(ie){throw console.error("Error updating profile:",ie),N("Failed to update profile. Please try again."),ie}},deleteProfile:async $=>{try{return b(ie=>{if(!ie)return ie;const oe=ie.filter(fe=>fe.id!==$);return localStorage.setItem("profiles",JSON.stringify(oe)),oe}),$}catch(ie){throw console.error("Error deleting profile:",ie),N("Failed to delete profile. Please try again."),ie}}}}const l1="-",EP=m=>{const b=MP(m),{conflictingClassGroups:E,conflictingClassGroupModifiers:C}=m;return{getClassGroupId:G=>{const r=G.split(l1);return r[0]===""&&r.length!==1&&r.shift(),iE(r,b)||AP(G)},getConflictingClassGroupIds:(G,r)=>{const Z=E[G]||[];return r&&C[G]?[...Z,...C[G]]:Z}}},iE=(m,b)=>{var G;if(m.length===0)return b.classGroupId;const E=m[0],C=b.nextPart.get(E),L=C?iE(m.slice(1),C):void 0;if(L)return L;if(b.validators.length===0)return;const N=m.join(l1);return(G=b.validators.find(({validator:r})=>r(N)))==null?void 0:G.classGroupId},N2=/^\[(.+)\]$/,AP=m=>{if(N2.test(m)){const b=N2.exec(m)[1],E=b==null?void 0:b.substring(0,b.indexOf(":"));if(E)return"arbitrary.."+E}},MP=m=>{const{theme:b,classGroups:E}=m,C={nextPart:new Map,validators:[]};for(const L in E)Pb(E[L],C,L,b);return C},Pb=(m,b,E,C)=>{m.forEach(L=>{if(typeof L=="string"){const N=L===""?b:B2(b,L);N.classGroupId=E;return}if(typeof L=="function"){if(CP(L)){Pb(L(C),b,E,C);return}b.validators.push({validator:L,classGroupId:E});return}Object.entries(L).forEach(([N,G])=>{Pb(G,B2(b,N),E,C)})})},B2=(m,b)=>{let E=m;return b.split(l1).forEach(C=>{E.nextPart.has(C)||E.nextPart.set(C,{nextPart:new Map,validators:[]}),E=E.nextPart.get(C)}),E},CP=m=>m.isThemeGetter,RP=m=>{if(m<1)return{get:()=>{},set:()=>{}};let b=0,E=new Map,C=new Map;const L=(N,G)=>{E.set(N,G),b++,b>m&&(b=0,C=E,E=new Map)};return{get(N){let G=E.get(N);if(G!==void 0)return G;if((G=C.get(N))!==void 0)return L(N,G),G},set(N,G){E.has(N)?E.set(N,G):L(N,G)}}},Lb="!",Ob=":",IP=Ob.length,DP=m=>{const{prefix:b,experimentalParseClassName:E}=m;let C=L=>{const N=[];let G=0,r=0,Z=0,$;for(let Ie=0;Ie<L.length;Ie++){let be=L[Ie];if(G===0&&r===0){if(be===Ob){N.push(L.slice(Z,Ie)),Z=Ie+IP;continue}if(be==="/"){$=Ie;continue}}be==="["?G++:be==="]"?G--:be==="("?r++:be===")"&&r--}const ie=N.length===0?L:L.substring(Z),oe=zP(ie),fe=oe!==ie,Re=$&&$>Z?$-Z:void 0;return{modifiers:N,hasImportantModifier:fe,baseClassName:oe,maybePostfixModifierPosition:Re}};if(b){const L=b+Ob,N=C;C=G=>G.startsWith(L)?N(G.substring(L.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:G,maybePostfixModifierPosition:void 0}}if(E){const L=C;C=N=>E({className:N,parseClassName:L})}return C},zP=m=>m.endsWith(Lb)?m.substring(0,m.length-1):m.startsWith(Lb)?m.substring(1):m,PP=m=>{const b=Object.fromEntries(m.orderSensitiveModifiers.map(C=>[C,!0]));return C=>{if(C.length<=1)return C;const L=[];let N=[];return C.forEach(G=>{G[0]==="["||b[G]?(L.push(...N.sort(),G),N=[]):N.push(G)}),L.push(...N.sort()),L}},LP=m=>({cache:RP(m.cacheSize),parseClassName:DP(m),sortModifiers:PP(m),...EP(m)}),OP=/\s+/,kP=(m,b)=>{const{parseClassName:E,getClassGroupId:C,getConflictingClassGroupIds:L,sortModifiers:N}=b,G=[],r=m.trim().split(OP);let Z="";for(let $=r.length-1;$>=0;$-=1){const ie=r[$],{isExternal:oe,modifiers:fe,hasImportantModifier:Re,baseClassName:Ie,maybePostfixModifierPosition:be}=E(ie);if(oe){Z=ie+(Z.length>0?" "+Z:Z);continue}let ke=!!be,Oe=C(ke?Ie.substring(0,be):Ie);if(!Oe){if(!ke){Z=ie+(Z.length>0?" "+Z:Z);continue}if(Oe=C(Ie),!Oe){Z=ie+(Z.length>0?" "+Z:Z);continue}ke=!1}const Be=N(fe).join(":"),je=Re?Be+Lb:Be,at=je+Oe;if(G.includes(at))continue;G.push(at);const ut=L(Oe,ke);for(let Xe=0;Xe<ut.length;++Xe){const Tt=ut[Xe];G.push(je+Tt)}Z=ie+(Z.length>0?" "+Z:Z)}return Z};function NP(){let m=0,b,E,C="";for(;m<arguments.length;)(b=arguments[m++])&&(E=nE(b))&&(C&&(C+=" "),C+=E);return C}const nE=m=>{if(typeof m=="string")return m;let b,E="";for(let C=0;C<m.length;C++)m[C]&&(b=nE(m[C]))&&(E&&(E+=" "),E+=b);return E};function BP(m,...b){let E,C,L,N=G;function G(Z){const $=b.reduce((ie,oe)=>oe(ie),m());return E=LP($),C=E.cache.get,L=E.cache.set,N=r,r(Z)}function r(Z){const $=C(Z);if($)return $;const ie=kP(Z,E);return L(Z,ie),ie}return function(){return N(NP.apply(null,arguments))}}const yo=m=>{const b=E=>E[m]||[];return b.isThemeGetter=!0,b},rE=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,aE=/^\((?:(\w[\w-]*):)?(.+)\)$/i,FP=/^\d+\/\d+$/,jP=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,UP=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,VP=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,GP=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,HP=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Lg=m=>FP.test(m),mr=m=>!!m&&!Number.isNaN(Number(m)),$f=m=>!!m&&Number.isInteger(Number(m)),db=m=>m.endsWith("%")&&mr(m.slice(0,-1)),Vd=m=>jP.test(m),qP=()=>!0,$P=m=>UP.test(m)&&!VP.test(m),oE=()=>!1,ZP=m=>GP.test(m),XP=m=>HP.test(m),WP=m=>!tn(m)&&!nn(m),YP=m=>Kg(m,cE,oE),tn=m=>rE.test(m),vm=m=>Kg(m,uE,$P),fb=m=>Kg(m,t3,mr),F2=m=>Kg(m,sE,oE),KP=m=>Kg(m,lE,XP),Kv=m=>Kg(m,hE,ZP),nn=m=>aE.test(m),py=m=>Qg(m,uE),QP=m=>Qg(m,i3),j2=m=>Qg(m,sE),JP=m=>Qg(m,cE),e3=m=>Qg(m,lE),Qv=m=>Qg(m,hE,!0),Kg=(m,b,E)=>{const C=rE.exec(m);return C?C[1]?b(C[1]):E(C[2]):!1},Qg=(m,b,E=!1)=>{const C=aE.exec(m);return C?C[1]?b(C[1]):E:!1},sE=m=>m==="position"||m==="percentage",lE=m=>m==="image"||m==="url",cE=m=>m==="length"||m==="size"||m==="bg-size",uE=m=>m==="length",t3=m=>m==="number",i3=m=>m==="family-name",hE=m=>m==="shadow",n3=()=>{const m=yo("color"),b=yo("font"),E=yo("text"),C=yo("font-weight"),L=yo("tracking"),N=yo("leading"),G=yo("breakpoint"),r=yo("container"),Z=yo("spacing"),$=yo("radius"),ie=yo("shadow"),oe=yo("inset-shadow"),fe=yo("text-shadow"),Re=yo("drop-shadow"),Ie=yo("blur"),be=yo("perspective"),ke=yo("aspect"),Oe=yo("ease"),Be=yo("animate"),je=()=>["auto","avoid","all","avoid-page","page","left","right","column"],at=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],ut=()=>[...at(),nn,tn],Xe=()=>["auto","hidden","clip","visible","scroll"],Tt=()=>["auto","contain","none"],vt=()=>[nn,tn,Z],ni=()=>[Lg,"full","auto",...vt()],Pi=()=>[$f,"none","subgrid",nn,tn],xi=()=>["auto",{span:["full",$f,nn,tn]},$f,nn,tn],Fi=()=>[$f,"auto",nn,tn],Ei=()=>["auto","min","max","fr",nn,tn],fi=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],yi=()=>["start","end","center","stretch","center-safe","end-safe"],Je=()=>["auto",...vt()],jt=()=>[Lg,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...vt()],_t=()=>[m,nn,tn],$t=()=>[...at(),j2,F2,{position:[nn,tn]}],Fe=()=>["no-repeat",{repeat:["","x","y","space","round"]}],zt=()=>["auto","cover","contain",JP,YP,{size:[nn,tn]}],_i=()=>[db,py,vm],Jt=()=>["","none","full",$,nn,tn],bi=()=>["",mr,py,vm],Ci=()=>["solid","dashed","dotted","double"],pi=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ri=()=>[mr,db,j2,F2],Yi=()=>["","none",Ie,nn,tn],Vi=()=>["none",mr,nn,tn],rn=()=>["none",mr,nn,tn],xn=()=>[mr,nn,tn],_n=()=>[Lg,"full",...vt()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Vd],breakpoint:[Vd],color:[qP],container:[Vd],"drop-shadow":[Vd],ease:["in","out","in-out"],font:[WP],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Vd],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Vd],shadow:[Vd],spacing:["px",mr],text:[Vd],"text-shadow":[Vd],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Lg,tn,nn,ke]}],container:["container"],columns:[{columns:[mr,tn,nn,r]}],"break-after":[{"break-after":je()}],"break-before":[{"break-before":je()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:ut()}],overflow:[{overflow:Xe()}],"overflow-x":[{"overflow-x":Xe()}],"overflow-y":[{"overflow-y":Xe()}],overscroll:[{overscroll:Tt()}],"overscroll-x":[{"overscroll-x":Tt()}],"overscroll-y":[{"overscroll-y":Tt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:ni()}],"inset-x":[{"inset-x":ni()}],"inset-y":[{"inset-y":ni()}],start:[{start:ni()}],end:[{end:ni()}],top:[{top:ni()}],right:[{right:ni()}],bottom:[{bottom:ni()}],left:[{left:ni()}],visibility:["visible","invisible","collapse"],z:[{z:[$f,"auto",nn,tn]}],basis:[{basis:[Lg,"full","auto",r,...vt()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[mr,Lg,"auto","initial","none",tn]}],grow:[{grow:["",mr,nn,tn]}],shrink:[{shrink:["",mr,nn,tn]}],order:[{order:[$f,"first","last","none",nn,tn]}],"grid-cols":[{"grid-cols":Pi()}],"col-start-end":[{col:xi()}],"col-start":[{"col-start":Fi()}],"col-end":[{"col-end":Fi()}],"grid-rows":[{"grid-rows":Pi()}],"row-start-end":[{row:xi()}],"row-start":[{"row-start":Fi()}],"row-end":[{"row-end":Fi()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":Ei()}],"auto-rows":[{"auto-rows":Ei()}],gap:[{gap:vt()}],"gap-x":[{"gap-x":vt()}],"gap-y":[{"gap-y":vt()}],"justify-content":[{justify:[...fi(),"normal"]}],"justify-items":[{"justify-items":[...yi(),"normal"]}],"justify-self":[{"justify-self":["auto",...yi()]}],"align-content":[{content:["normal",...fi()]}],"align-items":[{items:[...yi(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...yi(),{baseline:["","last"]}]}],"place-content":[{"place-content":fi()}],"place-items":[{"place-items":[...yi(),"baseline"]}],"place-self":[{"place-self":["auto",...yi()]}],p:[{p:vt()}],px:[{px:vt()}],py:[{py:vt()}],ps:[{ps:vt()}],pe:[{pe:vt()}],pt:[{pt:vt()}],pr:[{pr:vt()}],pb:[{pb:vt()}],pl:[{pl:vt()}],m:[{m:Je()}],mx:[{mx:Je()}],my:[{my:Je()}],ms:[{ms:Je()}],me:[{me:Je()}],mt:[{mt:Je()}],mr:[{mr:Je()}],mb:[{mb:Je()}],ml:[{ml:Je()}],"space-x":[{"space-x":vt()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":vt()}],"space-y-reverse":["space-y-reverse"],size:[{size:jt()}],w:[{w:[r,"screen",...jt()]}],"min-w":[{"min-w":[r,"screen","none",...jt()]}],"max-w":[{"max-w":[r,"screen","none","prose",{screen:[G]},...jt()]}],h:[{h:["screen","lh",...jt()]}],"min-h":[{"min-h":["screen","lh","none",...jt()]}],"max-h":[{"max-h":["screen","lh",...jt()]}],"font-size":[{text:["base",E,py,vm]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[C,nn,fb]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",db,tn]}],"font-family":[{font:[QP,tn,b]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[L,nn,tn]}],"line-clamp":[{"line-clamp":[mr,"none",nn,fb]}],leading:[{leading:[N,...vt()]}],"list-image":[{"list-image":["none",nn,tn]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",nn,tn]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:_t()}],"text-color":[{text:_t()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Ci(),"wavy"]}],"text-decoration-thickness":[{decoration:[mr,"from-font","auto",nn,vm]}],"text-decoration-color":[{decoration:_t()}],"underline-offset":[{"underline-offset":[mr,"auto",nn,tn]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:vt()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",nn,tn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",nn,tn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:$t()}],"bg-repeat":[{bg:Fe()}],"bg-size":[{bg:zt()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},$f,nn,tn],radial:["",nn,tn],conic:[$f,nn,tn]},e3,KP]}],"bg-color":[{bg:_t()}],"gradient-from-pos":[{from:_i()}],"gradient-via-pos":[{via:_i()}],"gradient-to-pos":[{to:_i()}],"gradient-from":[{from:_t()}],"gradient-via":[{via:_t()}],"gradient-to":[{to:_t()}],rounded:[{rounded:Jt()}],"rounded-s":[{"rounded-s":Jt()}],"rounded-e":[{"rounded-e":Jt()}],"rounded-t":[{"rounded-t":Jt()}],"rounded-r":[{"rounded-r":Jt()}],"rounded-b":[{"rounded-b":Jt()}],"rounded-l":[{"rounded-l":Jt()}],"rounded-ss":[{"rounded-ss":Jt()}],"rounded-se":[{"rounded-se":Jt()}],"rounded-ee":[{"rounded-ee":Jt()}],"rounded-es":[{"rounded-es":Jt()}],"rounded-tl":[{"rounded-tl":Jt()}],"rounded-tr":[{"rounded-tr":Jt()}],"rounded-br":[{"rounded-br":Jt()}],"rounded-bl":[{"rounded-bl":Jt()}],"border-w":[{border:bi()}],"border-w-x":[{"border-x":bi()}],"border-w-y":[{"border-y":bi()}],"border-w-s":[{"border-s":bi()}],"border-w-e":[{"border-e":bi()}],"border-w-t":[{"border-t":bi()}],"border-w-r":[{"border-r":bi()}],"border-w-b":[{"border-b":bi()}],"border-w-l":[{"border-l":bi()}],"divide-x":[{"divide-x":bi()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":bi()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Ci(),"hidden","none"]}],"divide-style":[{divide:[...Ci(),"hidden","none"]}],"border-color":[{border:_t()}],"border-color-x":[{"border-x":_t()}],"border-color-y":[{"border-y":_t()}],"border-color-s":[{"border-s":_t()}],"border-color-e":[{"border-e":_t()}],"border-color-t":[{"border-t":_t()}],"border-color-r":[{"border-r":_t()}],"border-color-b":[{"border-b":_t()}],"border-color-l":[{"border-l":_t()}],"divide-color":[{divide:_t()}],"outline-style":[{outline:[...Ci(),"none","hidden"]}],"outline-offset":[{"outline-offset":[mr,nn,tn]}],"outline-w":[{outline:["",mr,py,vm]}],"outline-color":[{outline:_t()}],shadow:[{shadow:["","none",ie,Qv,Kv]}],"shadow-color":[{shadow:_t()}],"inset-shadow":[{"inset-shadow":["none",oe,Qv,Kv]}],"inset-shadow-color":[{"inset-shadow":_t()}],"ring-w":[{ring:bi()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:_t()}],"ring-offset-w":[{"ring-offset":[mr,vm]}],"ring-offset-color":[{"ring-offset":_t()}],"inset-ring-w":[{"inset-ring":bi()}],"inset-ring-color":[{"inset-ring":_t()}],"text-shadow":[{"text-shadow":["none",fe,Qv,Kv]}],"text-shadow-color":[{"text-shadow":_t()}],opacity:[{opacity:[mr,nn,tn]}],"mix-blend":[{"mix-blend":[...pi(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":pi()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[mr]}],"mask-image-linear-from-pos":[{"mask-linear-from":ri()}],"mask-image-linear-to-pos":[{"mask-linear-to":ri()}],"mask-image-linear-from-color":[{"mask-linear-from":_t()}],"mask-image-linear-to-color":[{"mask-linear-to":_t()}],"mask-image-t-from-pos":[{"mask-t-from":ri()}],"mask-image-t-to-pos":[{"mask-t-to":ri()}],"mask-image-t-from-color":[{"mask-t-from":_t()}],"mask-image-t-to-color":[{"mask-t-to":_t()}],"mask-image-r-from-pos":[{"mask-r-from":ri()}],"mask-image-r-to-pos":[{"mask-r-to":ri()}],"mask-image-r-from-color":[{"mask-r-from":_t()}],"mask-image-r-to-color":[{"mask-r-to":_t()}],"mask-image-b-from-pos":[{"mask-b-from":ri()}],"mask-image-b-to-pos":[{"mask-b-to":ri()}],"mask-image-b-from-color":[{"mask-b-from":_t()}],"mask-image-b-to-color":[{"mask-b-to":_t()}],"mask-image-l-from-pos":[{"mask-l-from":ri()}],"mask-image-l-to-pos":[{"mask-l-to":ri()}],"mask-image-l-from-color":[{"mask-l-from":_t()}],"mask-image-l-to-color":[{"mask-l-to":_t()}],"mask-image-x-from-pos":[{"mask-x-from":ri()}],"mask-image-x-to-pos":[{"mask-x-to":ri()}],"mask-image-x-from-color":[{"mask-x-from":_t()}],"mask-image-x-to-color":[{"mask-x-to":_t()}],"mask-image-y-from-pos":[{"mask-y-from":ri()}],"mask-image-y-to-pos":[{"mask-y-to":ri()}],"mask-image-y-from-color":[{"mask-y-from":_t()}],"mask-image-y-to-color":[{"mask-y-to":_t()}],"mask-image-radial":[{"mask-radial":[nn,tn]}],"mask-image-radial-from-pos":[{"mask-radial-from":ri()}],"mask-image-radial-to-pos":[{"mask-radial-to":ri()}],"mask-image-radial-from-color":[{"mask-radial-from":_t()}],"mask-image-radial-to-color":[{"mask-radial-to":_t()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":at()}],"mask-image-conic-pos":[{"mask-conic":[mr]}],"mask-image-conic-from-pos":[{"mask-conic-from":ri()}],"mask-image-conic-to-pos":[{"mask-conic-to":ri()}],"mask-image-conic-from-color":[{"mask-conic-from":_t()}],"mask-image-conic-to-color":[{"mask-conic-to":_t()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:$t()}],"mask-repeat":[{mask:Fe()}],"mask-size":[{mask:zt()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",nn,tn]}],filter:[{filter:["","none",nn,tn]}],blur:[{blur:Yi()}],brightness:[{brightness:[mr,nn,tn]}],contrast:[{contrast:[mr,nn,tn]}],"drop-shadow":[{"drop-shadow":["","none",Re,Qv,Kv]}],"drop-shadow-color":[{"drop-shadow":_t()}],grayscale:[{grayscale:["",mr,nn,tn]}],"hue-rotate":[{"hue-rotate":[mr,nn,tn]}],invert:[{invert:["",mr,nn,tn]}],saturate:[{saturate:[mr,nn,tn]}],sepia:[{sepia:["",mr,nn,tn]}],"backdrop-filter":[{"backdrop-filter":["","none",nn,tn]}],"backdrop-blur":[{"backdrop-blur":Yi()}],"backdrop-brightness":[{"backdrop-brightness":[mr,nn,tn]}],"backdrop-contrast":[{"backdrop-contrast":[mr,nn,tn]}],"backdrop-grayscale":[{"backdrop-grayscale":["",mr,nn,tn]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[mr,nn,tn]}],"backdrop-invert":[{"backdrop-invert":["",mr,nn,tn]}],"backdrop-opacity":[{"backdrop-opacity":[mr,nn,tn]}],"backdrop-saturate":[{"backdrop-saturate":[mr,nn,tn]}],"backdrop-sepia":[{"backdrop-sepia":["",mr,nn,tn]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":vt()}],"border-spacing-x":[{"border-spacing-x":vt()}],"border-spacing-y":[{"border-spacing-y":vt()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",nn,tn]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[mr,"initial",nn,tn]}],ease:[{ease:["linear","initial",Oe,nn,tn]}],delay:[{delay:[mr,nn,tn]}],animate:[{animate:["none",Be,nn,tn]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[be,nn,tn]}],"perspective-origin":[{"perspective-origin":ut()}],rotate:[{rotate:Vi()}],"rotate-x":[{"rotate-x":Vi()}],"rotate-y":[{"rotate-y":Vi()}],"rotate-z":[{"rotate-z":Vi()}],scale:[{scale:rn()}],"scale-x":[{"scale-x":rn()}],"scale-y":[{"scale-y":rn()}],"scale-z":[{"scale-z":rn()}],"scale-3d":["scale-3d"],skew:[{skew:xn()}],"skew-x":[{"skew-x":xn()}],"skew-y":[{"skew-y":xn()}],transform:[{transform:[nn,tn,"","none","gpu","cpu"]}],"transform-origin":[{origin:ut()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:_n()}],"translate-x":[{"translate-x":_n()}],"translate-y":[{"translate-y":_n()}],"translate-z":[{"translate-z":_n()}],"translate-none":["translate-none"],accent:[{accent:_t()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:_t()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",nn,tn]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":vt()}],"scroll-mx":[{"scroll-mx":vt()}],"scroll-my":[{"scroll-my":vt()}],"scroll-ms":[{"scroll-ms":vt()}],"scroll-me":[{"scroll-me":vt()}],"scroll-mt":[{"scroll-mt":vt()}],"scroll-mr":[{"scroll-mr":vt()}],"scroll-mb":[{"scroll-mb":vt()}],"scroll-ml":[{"scroll-ml":vt()}],"scroll-p":[{"scroll-p":vt()}],"scroll-px":[{"scroll-px":vt()}],"scroll-py":[{"scroll-py":vt()}],"scroll-ps":[{"scroll-ps":vt()}],"scroll-pe":[{"scroll-pe":vt()}],"scroll-pt":[{"scroll-pt":vt()}],"scroll-pr":[{"scroll-pr":vt()}],"scroll-pb":[{"scroll-pb":vt()}],"scroll-pl":[{"scroll-pl":vt()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",nn,tn]}],fill:[{fill:["none",..._t()]}],"stroke-w":[{stroke:[mr,py,vm,fb]}],stroke:[{stroke:["none",..._t()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},r3=BP(n3);function Sr(...m){return r3(Hd(m))}function Tm({className:m,...b}){return H.jsx("div",{"data-slot":"card",className:Sr("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",m),...b})}function vy({className:m,...b}){return H.jsx("div",{"data-slot":"card-content",className:Sr("px-6",m),...b})}function a3({className:m,...b}){return H.jsx("div",{"data-slot":"card-footer",className:Sr("flex items-center px-6 [.border-t]:pt-6",m),...b})}function U2(m,b){if(typeof m=="function")return m(b);m!=null&&(m.current=b)}function c1(...m){return b=>{let E=!1;const C=m.map(L=>{const N=U2(L,b);return!E&&typeof N=="function"&&(E=!0),N});if(E)return()=>{for(let L=0;L<C.length;L++){const N=C[L];typeof N=="function"?N():U2(m[L],null)}}}}function Xr(...m){return ne.useCallback(c1(...m),m)}function Em(m){const b=o3(m),E=ne.forwardRef((C,L)=>{const{children:N,...G}=C,r=ne.Children.toArray(N),Z=r.find(l3);if(Z){const $=Z.props.children,ie=r.map(oe=>oe===Z?ne.Children.count($)>1?ne.Children.only(null):ne.isValidElement($)?$.props.children:null:oe);return H.jsx(b,{...G,ref:L,children:ne.isValidElement($)?ne.cloneElement($,void 0,ie):null})}return H.jsx(b,{...G,ref:L,children:N})});return E.displayName=`${m}.Slot`,E}var dE=Em("Slot");function o3(m){const b=ne.forwardRef((E,C)=>{const{children:L,...N}=E,G=ne.isValidElement(L)?u3(L):void 0,r=Xr(G,C);if(ne.isValidElement(L)){const Z=c3(N,L.props);return L.type!==ne.Fragment&&(Z.ref=r),ne.cloneElement(L,Z)}return ne.Children.count(L)>1?ne.Children.only(null):null});return b.displayName=`${m}.SlotClone`,b}var fE=Symbol("radix.slottable");function s3(m){const b=({children:E})=>H.jsx(H.Fragment,{children:E});return b.displayName=`${m}.Slottable`,b.__radixId=fE,b}function l3(m){return ne.isValidElement(m)&&typeof m.type=="function"&&"__radixId"in m.type&&m.type.__radixId===fE}function c3(m,b){const E={...b};for(const C in b){const L=m[C],N=b[C];/^on[A-Z]/.test(C)?L&&N?E[C]=(...r)=>{const Z=N(...r);return L(...r),Z}:L&&(E[C]=L):C==="style"?E[C]={...L,...N}:C==="className"&&(E[C]=[L,N].filter(Boolean).join(" "))}return{...m,...E}}function u3(m){var C,L;let b=(C=Object.getOwnPropertyDescriptor(m.props,"ref"))==null?void 0:C.get,E=b&&"isReactWarning"in b&&b.isReactWarning;return E?m.ref:(b=(L=Object.getOwnPropertyDescriptor(m,"ref"))==null?void 0:L.get,E=b&&"isReactWarning"in b&&b.isReactWarning,E?m.props.ref:m.props.ref||m.ref)}const V2=m=>typeof m=="boolean"?`${m}`:m===0?"0":m,G2=Hd,pE=(m,b)=>E=>{var C;if((b==null?void 0:b.variants)==null)return G2(m,E==null?void 0:E.class,E==null?void 0:E.className);const{variants:L,defaultVariants:N}=b,G=Object.keys(L).map($=>{const ie=E==null?void 0:E[$],oe=N==null?void 0:N[$];if(ie===null)return null;const fe=V2(ie)||V2(oe);return L[$][fe]}),r=E&&Object.entries(E).reduce(($,ie)=>{let[oe,fe]=ie;return fe===void 0||($[oe]=fe),$},{}),Z=b==null||(C=b.compoundVariants)===null||C===void 0?void 0:C.reduce(($,ie)=>{let{class:oe,className:fe,...Re}=ie;return Object.entries(Re).every(Ie=>{let[be,ke]=Ie;return Array.isArray(ke)?ke.includes({...N,...r}[be]):{...N,...r}[be]===ke})?[...$,oe,fe]:$},[]);return G2(m,G,Z,E==null?void 0:E.class,E==null?void 0:E.className)},u1=pE("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function ba({className:m,variant:b,size:E,asChild:C=!1,...L}){const N=C?dE:"button";return H.jsx(N,{"data-slot":"button",className:Sr(u1({variant:b,size:E,className:m})),...L})}const h3=pE("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Ug({className:m,variant:b,asChild:E=!1,...C}){const L=E?dE:"span";return H.jsx(L,{"data-slot":"badge",className:Sr(h3({variant:b}),m),...C})}/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d3=m=>m.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),f3=m=>m.replace(/^([A-Z])|[\s-_]+(\w)/g,(b,E,C)=>C?C.toUpperCase():E.toLowerCase()),H2=m=>{const b=f3(m);return b.charAt(0).toUpperCase()+b.slice(1)},mE=(...m)=>m.filter((b,E,C)=>!!b&&b.trim()!==""&&C.indexOf(b)===E).join(" ").trim(),p3=m=>{for(const b in m)if(b.startsWith("aria-")||b==="role"||b==="title")return!0};/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var m3={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g3=ne.forwardRef(({color:m="currentColor",size:b=24,strokeWidth:E=2,absoluteStrokeWidth:C,className:L="",children:N,iconNode:G,...r},Z)=>ne.createElement("svg",{ref:Z,...m3,width:b,height:b,stroke:m,strokeWidth:C?Number(E)*24/Number(b):E,className:mE("lucide",L),...!N&&!p3(r)&&{"aria-hidden":"true"},...r},[...G.map(([$,ie])=>ne.createElement($,ie)),...Array.isArray(N)?N:[N]]));/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=(m,b)=>{const E=ne.forwardRef(({className:C,...L},N)=>ne.createElement(g3,{ref:N,iconNode:b,className:mE(`lucide-${d3(H2(m))}`,`lucide-${m}`,C),...L}));return E.displayName=H2(m),E};/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _3=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],q2=Gr("arrow-left",_3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y3=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],h1=Gr("briefcase",y3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v3=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],x3=Gr("calendar",v3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b3=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],w3=Gr("check",b3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T3=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],gE=Gr("chevron-down",T3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S3=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],E3=Gr("chevron-up",S3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A3=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],M3=Gr("ellipsis",A3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C3=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],R3=Gr("globe",C3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I3=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],$2=Gr("grid-3x3",I3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D3=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],z3=Gr("house",D3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P3=[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]],L3=Gr("list",P3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O3=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Py=Gr("loader-circle",O3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k3=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],d1=Gr("mail",k3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N3=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Lu=Gr("map-pin",N3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B3=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],Z2=Gr("map",B3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F3=[["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 18h16",key:"19g7jn"}],["path",{d:"M4 6h16",key:"1o0s65"}]],j3=Gr("menu",F3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U3=[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]],V3=Gr("moon",U3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G3=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],H3=Gr("pencil",G3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q3=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],f1=Gr("phone",q3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $3=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],_E=Gr("plus",$3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z3=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],X3=Gr("save",Z3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W3=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],kb=Gr("search",W3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y3=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],yE=Gr("settings",Y3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K3=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Q3=Gr("sun",K3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J3=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],eL=Gr("tag",J3);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tL=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],iL=Gr("trash-2",tL);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nL=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],rL=Gr("user-plus",nL);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aL=[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]],X2=Gr("user-round",aL);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oL=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],vE=Gr("user",oL);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sL=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Zg=Gr("users",sL);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lL=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],g0=Gr("x",lL),_0="/ProfileMap/placeholder.svg";function cL({profiles:m,viewMode:b,onProfileSelect:E,onProfileClick:C}){const[L,N]=ne.useState(null);return m.length===0?H.jsxs("div",{className:"text-center py-12 bg-white dark:bg-gray-800 rounded-lg shadow-sm",children:[H.jsx(Lu,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),H.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No profiles found"}),H.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Try adjusting your search or filter criteria"})]}):b==="grid"?H.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:m.map(G=>H.jsxs(Tm,{className:`overflow-hidden py-2 transition-all duration-300 hover:shadow-lg animate-scale-up ${L===G.id?"ring-2 ring-emerald-500 ring-offset-2":""}`,onMouseEnter:()=>N(G.id),onMouseLeave:()=>N(null),children:[H.jsx("div",{className:"aspect-square relative cursor-pointer",onClick:()=>C(G),children:H.jsx("img",{src:G.avatar||_0,alt:G.name,className:"object-cover h-100 w-100 transition-transform duration-500 hover:scale-105"})}),H.jsxs(vy,{className:"p-4",children:[H.jsx("h3",{className:"font-semibold text-lg mb-1 cursor-pointer hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors",onClick:()=>C(G),children:G.name}),H.jsxs("div",{className:"flex items-center text-gray-600 dark:text-gray-400 text-sm mb-2",children:[H.jsx(Lu,{className:"h-3.5 w-3.5 mr-1 text-emerald-600 dark:text-emerald-400"}),H.jsxs("span",{children:[G.location.city,", ",G.location.country]})]}),H.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm line-clamp-2 mb-2",children:G.bio}),H.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[G.interests.slice(0,3).map((r,Z)=>H.jsx(Ug,{variant:"secondary",className:"text-xs",children:r},Z)),G.interests.length>3&&H.jsxs(Ug,{variant:"outline",className:"text-xs",children:["+",G.interests.length-3]})]})]}),H.jsxs(a3,{className:"p-4 pt-0 flex justify-around",children:[H.jsxs(ba,{variant:"outline",size:"sm",className:"w-fit cursor-pointer",onClick:()=>E(G),children:[H.jsx(Z2,{className:"h-4 w-4 mr-2"}),"View on Map"]}),H.jsxs(ba,{variant:"outline",size:"sm",className:"w-fit cursor-pointer",onClick:()=>C(G),children:[H.jsx(X2,{className:"h-4 w-4 mr-2"}),"About Me"]})]})]},G.id))}):H.jsx("div",{className:"space-y-4",children:m.map(G=>H.jsx(Tm,{className:`overflow-hidden transition-all duration-300 hover:shadow-md animate-scale-up ${L===G.id?"ring-1 ring-emerald-500":""}`,onMouseEnter:()=>N(G.id),onMouseLeave:()=>N(null),children:H.jsxs("div",{className:"flex flex-col sm:flex-row items-center px-4",children:[H.jsx("div",{className:"sm:w-[120px] h-[120px] relative cursor-pointer flex items-center justify-center",onClick:()=>C(G),children:H.jsx("img",{src:G.avatar||_0,alt:G.name,className:"object-cover h-30 w-30 rounded-full"})}),H.jsxs("div",{className:"flex-1 p-4",children:[H.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-2",children:[H.jsx("h3",{className:"font-semibold text-lg cursor-pointer hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors",onClick:()=>C(G),children:G.name}),H.jsxs("div",{className:"flex items-center text-gray-600 dark:text-gray-400 text-sm mt-1 sm:mt-0",children:[H.jsx(Lu,{className:"h-3.5 w-3.5 mr-1 text-emerald-600 dark:text-emerald-400"}),H.jsxs("span",{children:[G.location.city,", ",G.location.country]})]})]}),H.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm line-clamp-2 mb-3",children:G.bio}),H.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-gray-600 dark:text-gray-400",children:[H.jsxs("div",{className:"flex items-center",children:[H.jsx(d1,{className:"h-3.5 w-3.5 mr-1 text-emerald-600 dark:text-emerald-400"}),H.jsx("span",{className:"truncate max-w-[150px]",children:G.email})]}),H.jsxs("div",{className:"flex items-center",children:[H.jsx(f1,{className:"h-3.5 w-3.5 mr-1 text-emerald-600 dark:text-emerald-400"}),H.jsx("span",{children:G.phone})]}),H.jsxs("div",{className:"flex items-center",children:[H.jsx(h1,{className:"h-3.5 w-3.5 mr-1 text-emerald-600 dark:text-emerald-400"}),H.jsx("span",{children:G.occupation})]})]}),H.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mt-3 gap-3 sm:gap-0",children:[H.jsxs("div",{className:"flex flex-wrap gap-1",children:[G.interests.slice(0,2).map((r,Z)=>H.jsx(Ug,{variant:"secondary",className:"text-xs",children:r},Z)),G.interests.length>2&&H.jsxs(Ug,{variant:"outline",className:"text-xs",children:["+",G.interests.length-2]})]}),H.jsxs("div",{className:"flex gap-2",children:[H.jsxs(ba,{variant:"outline",size:"sm",className:"w-fit cursor-pointer",onClick:()=>C(G),children:[H.jsx(X2,{className:"h-4 w-4 mr-2"}),"About Me"]}),H.jsxs(ba,{variant:"outline",className:"cursor-pointer",size:"sm",onClick:()=>E(G),children:[H.jsx(Z2,{className:"h-4 w-4 mr-2"}),"View on Map"]})]})]})]})]})},G.id))})}var l0={exports:{}},uL=l0.exports,W2;function hL(){return W2||(W2=1,function(m,b){(function(E,C){m.exports=C()})(uL,function(){var E,C,L;function N(r,Z){if(!E)E=Z;else if(!C)C=Z;else{var $="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+E+")(sharedChunk); ("+C+")(sharedChunk); self.onerror = null;",ie={};E(ie),L=Z(ie),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(L.workerUrl=window.URL.createObjectURL(new Blob([$],{type:"text/javascript"})))}}N(["exports"],function(r){var Z=1e-6,$=typeof Float32Array<"u"?Float32Array:Array;function ie(n,e){var i=e[0],o=e[1],l=e[2],d=e[3],f=i*d-l*o;return f?(n[0]=d*(f=1/f),n[1]=-o*f,n[2]=-l*f,n[3]=i*f,n):null}function oe(){var n=new $(9);return $!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function fe(n,e){var i=e[0],o=e[1],l=e[2],d=e[3],f=e[4],y=e[5],x=e[6],T=e[7],M=e[8];return n[0]=f*M-y*T,n[1]=l*T-o*M,n[2]=o*y-l*f,n[3]=y*x-d*M,n[4]=i*M-l*x,n[5]=l*d-i*y,n[6]=d*T-f*x,n[7]=o*x-i*T,n[8]=i*f-o*d,n}function Re(n,e,i){var o=e[0],l=e[1],d=e[2],f=e[3],y=e[4],x=e[5],T=e[6],M=e[7],R=e[8],D=i[0],B=i[1],F=i[2],q=i[3],J=i[4],te=i[5],he=i[6],ce=i[7],X=i[8];return n[0]=D*o+B*f+F*T,n[1]=D*l+B*y+F*M,n[2]=D*d+B*x+F*R,n[3]=q*o+J*f+te*T,n[4]=q*l+J*y+te*M,n[5]=q*d+J*x+te*R,n[6]=he*o+ce*f+X*T,n[7]=he*l+ce*y+X*M,n[8]=he*d+ce*x+X*R,n}function Ie(){var n=new $(16);return $!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function be(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ke(n,e){var i=e[0],o=e[1],l=e[2],d=e[3],f=e[4],y=e[5],x=e[6],T=e[7],M=e[8],R=e[9],D=e[10],B=e[11],F=e[12],q=e[13],J=e[14],te=e[15],he=i*y-o*f,ce=i*x-l*f,X=i*T-d*f,re=o*x-l*y,ue=o*T-d*y,_e=l*T-d*x,ze=M*q-R*F,Ne=M*J-D*F,Ue=M*te-B*F,qe=R*J-D*q,ot=R*te-B*q,St=D*te-B*J,gt=he*St-ce*ot+X*qe+re*Ue-ue*Ne+_e*ze;return gt?(n[0]=(y*St-x*ot+T*qe)*(gt=1/gt),n[1]=(l*ot-o*St-d*qe)*gt,n[2]=(q*_e-J*ue+te*re)*gt,n[3]=(D*ue-R*_e-B*re)*gt,n[4]=(x*Ue-f*St-T*Ne)*gt,n[5]=(i*St-l*Ue+d*Ne)*gt,n[6]=(J*X-F*_e-te*ce)*gt,n[7]=(M*_e-D*X+B*ce)*gt,n[8]=(f*ot-y*Ue+T*ze)*gt,n[9]=(o*Ue-i*ot-d*ze)*gt,n[10]=(F*ue-q*X+te*he)*gt,n[11]=(R*X-M*ue-B*he)*gt,n[12]=(y*Ne-f*qe-x*ze)*gt,n[13]=(i*qe-o*Ne+l*ze)*gt,n[14]=(q*ce-F*re-J*he)*gt,n[15]=(M*re-R*ce+D*he)*gt,n):null}function Oe(n,e,i){var o=e[0],l=e[1],d=e[2],f=e[3],y=e[4],x=e[5],T=e[6],M=e[7],R=e[8],D=e[9],B=e[10],F=e[11],q=e[12],J=e[13],te=e[14],he=e[15],ce=i[0],X=i[1],re=i[2],ue=i[3];return n[0]=ce*o+X*y+re*R+ue*q,n[1]=ce*l+X*x+re*D+ue*J,n[2]=ce*d+X*T+re*B+ue*te,n[3]=ce*f+X*M+re*F+ue*he,n[4]=(ce=i[4])*o+(X=i[5])*y+(re=i[6])*R+(ue=i[7])*q,n[5]=ce*l+X*x+re*D+ue*J,n[6]=ce*d+X*T+re*B+ue*te,n[7]=ce*f+X*M+re*F+ue*he,n[8]=(ce=i[8])*o+(X=i[9])*y+(re=i[10])*R+(ue=i[11])*q,n[9]=ce*l+X*x+re*D+ue*J,n[10]=ce*d+X*T+re*B+ue*te,n[11]=ce*f+X*M+re*F+ue*he,n[12]=(ce=i[12])*o+(X=i[13])*y+(re=i[14])*R+(ue=i[15])*q,n[13]=ce*l+X*x+re*D+ue*J,n[14]=ce*d+X*T+re*B+ue*te,n[15]=ce*f+X*M+re*F+ue*he,n}function Be(n,e,i){var o,l,d,f,y,x,T,M,R,D,B,F,q=i[0],J=i[1],te=i[2];return e===n?(n[12]=e[0]*q+e[4]*J+e[8]*te+e[12],n[13]=e[1]*q+e[5]*J+e[9]*te+e[13],n[14]=e[2]*q+e[6]*J+e[10]*te+e[14],n[15]=e[3]*q+e[7]*J+e[11]*te+e[15]):(l=e[1],d=e[2],f=e[3],y=e[4],x=e[5],T=e[6],M=e[7],R=e[8],D=e[9],B=e[10],F=e[11],n[0]=o=e[0],n[1]=l,n[2]=d,n[3]=f,n[4]=y,n[5]=x,n[6]=T,n[7]=M,n[8]=R,n[9]=D,n[10]=B,n[11]=F,n[12]=o*q+y*J+R*te+e[12],n[13]=l*q+x*J+D*te+e[13],n[14]=d*q+T*J+B*te+e[14],n[15]=f*q+M*J+F*te+e[15]),n}function je(n,e,i){var o=i[0],l=i[1],d=i[2];return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*l,n[5]=e[5]*l,n[6]=e[6]*l,n[7]=e[7]*l,n[8]=e[8]*d,n[9]=e[9]*d,n[10]=e[10]*d,n[11]=e[11]*d,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function at(n,e,i){var o=Math.sin(i),l=Math.cos(i),d=e[4],f=e[5],y=e[6],x=e[7],T=e[8],M=e[9],R=e[10],D=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=d*l+T*o,n[5]=f*l+M*o,n[6]=y*l+R*o,n[7]=x*l+D*o,n[8]=T*l-d*o,n[9]=M*l-f*o,n[10]=R*l-y*o,n[11]=D*l-x*o,n}function ut(n,e,i){var o=Math.sin(i),l=Math.cos(i),d=e[0],f=e[1],y=e[2],x=e[3],T=e[8],M=e[9],R=e[10],D=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*l-T*o,n[1]=f*l-M*o,n[2]=y*l-R*o,n[3]=x*l-D*o,n[8]=d*o+T*l,n[9]=f*o+M*l,n[10]=y*o+R*l,n[11]=x*o+D*l,n}function Xe(n,e,i){var o=Math.sin(i),l=Math.cos(i),d=e[0],f=e[1],y=e[2],x=e[3],T=e[4],M=e[5],R=e[6],D=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*l+T*o,n[1]=f*l+M*o,n[2]=y*l+R*o,n[3]=x*l+D*o,n[4]=T*l-d*o,n[5]=M*l-f*o,n[6]=R*l-y*o,n[7]=D*l-x*o,n}function Tt(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function vt(n,e,i){var o,l,d,f=i[0],y=i[1],x=i[2],T=Math.hypot(f,y,x);return T<Z?null:(f*=T=1/T,y*=T,x*=T,o=Math.sin(e),l=Math.cos(e),n[0]=f*f*(d=1-l)+l,n[1]=y*f*d+x*o,n[2]=x*f*d-y*o,n[3]=0,n[4]=f*y*d-x*o,n[5]=y*y*d+l,n[6]=x*y*d+f*o,n[7]=0,n[8]=f*x*d+y*o,n[9]=y*x*d-f*o,n[10]=x*x*d+l,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function ni(n,e){var i=e[0],o=e[1],l=e[2],d=e[3],f=i+i,y=o+o,x=l+l,T=i*f,M=o*f,R=o*y,D=l*f,B=l*y,F=l*x,q=d*f,J=d*y,te=d*x;return n[0]=1-R-F,n[1]=M+te,n[2]=D-J,n[3]=0,n[4]=M-te,n[5]=1-T-F,n[6]=B+q,n[7]=0,n[8]=D+J,n[9]=B-q,n[10]=1-T-R,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var Pi=Oe;function xi(){var n=new $(3);return $!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Fi(n){var e=new $(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Ei(n){return Math.hypot(n[0],n[1],n[2])}function fi(n,e,i){var o=new $(3);return o[0]=n,o[1]=e,o[2]=i,o}function yi(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function Je(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function jt(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function _t(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function $t(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function Fe(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function zt(n,e,i,o){return n[0]=e[0]+i[0]*o,n[1]=e[1]+i[1]*o,n[2]=e[2]+i[2]*o,n}function _i(n,e){var i=e[0]-n[0],o=e[1]-n[1],l=e[2]-n[2];return i*i+o*o+l*l}function Jt(n){var e=n[0],i=n[1],o=n[2];return e*e+i*i+o*o}function bi(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function Ci(n,e){var i=e[0],o=e[1],l=e[2],d=i*i+o*o+l*l;return d>0&&(d=1/Math.sqrt(d)),n[0]=e[0]*d,n[1]=e[1]*d,n[2]=e[2]*d,n}function pi(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function ri(n,e,i){var o=e[0],l=e[1],d=e[2],f=i[0],y=i[1],x=i[2];return n[0]=l*x-d*y,n[1]=d*f-o*x,n[2]=o*y-l*f,n}function Yi(n,e,i,o){var l=e[0],d=e[1],f=e[2];return n[0]=l+o*(i[0]-l),n[1]=d+o*(i[1]-d),n[2]=f+o*(i[2]-f),n}function Vi(n,e,i){var o=e[0],l=e[1],d=e[2],f=i[3]*o+i[7]*l+i[11]*d+i[15];return n[0]=(i[0]*o+i[4]*l+i[8]*d+i[12])/(f=f||1),n[1]=(i[1]*o+i[5]*l+i[9]*d+i[13])/f,n[2]=(i[2]*o+i[6]*l+i[10]*d+i[14])/f,n}function rn(n,e,i){var o=e[0],l=e[1],d=e[2];return n[0]=o*i[0]+l*i[3]+d*i[6],n[1]=o*i[1]+l*i[4]+d*i[7],n[2]=o*i[2]+l*i[5]+d*i[8],n}function xn(n,e,i){var o=i[0],l=i[1],d=i[2],f=e[0],y=e[1],x=e[2],T=l*x-d*y,M=d*f-o*x,R=o*y-l*f,D=l*R-d*M,B=d*T-o*R,F=o*M-l*T,q=2*i[3];return M*=q,R*=q,B*=2,F*=2,n[0]=f+(T*=q)+(D*=2),n[1]=y+M+B,n[2]=x+R+F,n}function _n(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}var Rn=Je,Jr=jt,io=Ei;function ea(){var n=new $(4);return $!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function kr(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function is(n,e){var i=e[0],o=e[1],l=e[2],d=e[3],f=i*i+o*o+l*l+d*d;return f>0&&(f=1/Math.sqrt(f)),n[0]=i*f,n[1]=o*f,n[2]=l*f,n[3]=d*f,n}function la(n,e,i){var o=e[0],l=e[1],d=e[2],f=e[3];return n[0]=i[0]*o+i[4]*l+i[8]*d+i[12]*f,n[1]=i[1]*o+i[5]*l+i[9]*d+i[13]*f,n[2]=i[2]*o+i[6]*l+i[10]*d+i[14]*f,n[3]=i[3]*o+i[7]*l+i[11]*d+i[15]*f,n}function vo(){var n=new $(4);return $!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Uo(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Da(n,e,i){i*=.5;var o=e[0],l=e[1],d=e[2],f=e[3],y=Math.sin(i),x=Math.cos(i);return n[0]=o*x+f*y,n[1]=l*x+d*y,n[2]=d*x-l*y,n[3]=f*x-o*y,n}function xo(n,e,i){i*=.5;var o=e[0],l=e[1],d=e[2],f=e[3],y=Math.sin(i),x=Math.cos(i);return n[0]=o*x-d*y,n[1]=l*x+f*y,n[2]=d*x+o*y,n[3]=f*x-l*y,n}xi(),ea();var wa,za,Ta,Ir,ja,Hr=is,Es=(wa=xi(),za=fi(1,0,0),Ta=fi(0,1,0),function(n,e,i){var o=pi(e,i);return o<-.999999?(ri(wa,za,e),io(wa)<1e-6&&ri(wa,Ta,e),Ci(wa,wa),function(l,d,f){f*=.5;var y=Math.sin(f);l[0]=y*d[0],l[1]=y*d[1],l[2]=y*d[2],l[3]=Math.cos(f)}(n,wa,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(ri(wa,e,i),n[0]=wa[0],n[1]=wa[1],n[2]=wa[2],n[3]=1+o,Hr(n,n))});function ta(){var n=new $(2);return $!=Float32Array&&(n[0]=0,n[1]=0),n}function Qs(n,e){var i=new $(2);return i[0]=n,i[1]=e,i}function bo(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n}function Ua(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n}function no(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n}function Vo(n){return Math.hypot(n[0],n[1])}function wo(n,e){var i=e[0],o=e[1],l=i*i+o*o;return l>0&&(l=1/Math.sqrt(l)),n[0]=e[0]*l,n[1]=e[1]*l,n}function Jn(n,e){return n[0]*e[0]+n[1]*e[1]}function ro(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}vo(),vo(),oe(),ta();var fl,Pa,As=function(){if(ja)return Ir;function n(e,i,o,l){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(l-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=l}return ja=1,Ir=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,l=0;l<8;l++){var d=this.sampleCurveX(o)-e;if(Math.abs(d)<i)return o;var f=this.sampleCurveDerivativeX(o);if(Math.abs(f)<1e-6)break;o-=d/f}var y=0,x=1;for(o=e,l=0;l<20&&(d=this.sampleCurveX(o),!(Math.abs(d-e)<i));l++)e>d?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Ir}(),Pc=ro(As);function Ms(){if(Pa)return fl;function n(e,i){this.x=e,this.y=i}return Pa=1,fl=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,o=e.y-this.y;return i*i+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),o=Math.sin(e),l=o*this.x+i*this.y;return this.x=i*this.x-o*this.y,this.y=l,this},_rotateAround:function(e,i){var o=Math.cos(e),l=Math.sin(e),d=i.y+l*(this.x-i.x)+o*(this.y-i.y);return this.x=i.x+o*(this.x-i.x)-l*(this.y-i.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(e){return e instanceof n?e:Array.isArray(e)?new n(e[0],e[1]):e},fl}var Bt=ro(Ms());function Go(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!Go(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!Go(n[i],e[i]))return!1;return!0}return n===e}const $l=Math.PI/180,de=180/Math.PI;function V(n){return n*$l}function W(n){return n*de}const ae=[[0,0],[1,0],[1,1],[0,1]];function ye(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function we(n,e,i,o){const l=new Pc(n,e,i,o);return function(d){return l.solve(d)}}const De=we(.25,.1,.25,1);function Me(n,e,i){return Math.min(i,Math.max(e,n))}function Pe(n,e,i){return(i=Me((i-n)/(e-n),0,1))*i*(3-2*i)}function He(n,e,i){const o=i-e,l=((n-e)%o+o)%o+e;return l===e?i:l}function Ye(n,e,i){if(!n.length)return i(null,[]);let o=n.length;const l=new Array(n.length);let d=null;n.forEach((f,y)=>{e(f,(x,T)=>{x&&(d=x),l[y]=T,--o==0&&i(d,l)})})}function Ve(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}let ft=1;function Pt(){return ft++}function Vt(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function vi(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function mi(n,e,i){const o={};for(const l in n)o[l]=e.call(this,n[l],l,n);return o}function gi(n,e,i){const o={};for(const l in n)e.call(this,n[l],l,n)&&(o[l]=n[l]);return o}function Gi(n){return Array.isArray(n)?n.map(Gi):typeof n=="object"&&n?mi(n,Gi):n}const In={};function Ui(n){In[n]||(typeof console<"u"&&console.warn(n),In[n]=!0)}function yn(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function ln(n){let e=0;for(let i,o,l=0,d=n.length,f=d-1;l<d;f=l++)i=n[l],o=n[f],e+=(o.x-i.x)*(i.y+o.y);return e}function Dn([n,e,i]){const o=V(e+90),l=V(i);return{x:n*Math.cos(o)*Math.sin(l),y:n*Math.sin(o)*Math.sin(l),z:n*Math.cos(l),azimuthal:e,polar:i}}function Gn(n){return(typeof self<"u"||n!==void 0)&&typeof WorkerGlobalScope<"u"&&(n!==void 0?n:self)instanceof WorkerGlobalScope}function Yn(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,l,d)=>{const f=l||d;return e[o]=!f||f.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Er=null;function sn(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function gr(n,e,i,o){for(;e<i;){const l=e+i>>1;n[l]<o?e=l+1:i=l}return e}function ya(n,e,i,o){for(;e<i;){const l=e+i>>1;n[l]<=o?e=l+1:i=l}return e}function Nr(n){return n>0?1/(1.001-n):1+n}function aa(n){return n>0?1-1/(1.001-n):-n}function Bn(n,e,i){return(n-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Wr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Wr.API_URL)return null;try{const n=new URL(Wr.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function To(n){return Wr.API_URL_REGEX.test(n)}function ma(n){return Wr.API_SPRITE_REGEX.test(n)}let Bu,Fu,Lc,ju,Js,Oh;function So(){return Bu==null&&(Bu=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Bu}const Ho={now:()=>ju!==void 0?ju:performance.now(),setNow(n){ju=n},restoreNow(){ju=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:o}=n;Js||(Js=document.createElement("canvas"));const l=Js.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(i>Js.width||o>Js.height)&&(Js.width=i,Js.height=o),l.clearRect(-e,-e,i+2*e,o+2*e),l.drawImage(n,0,0,i,o),l.getImageData(-e,-e,i+2*e,o+2*e)},resolveURL:n=>(Fu||(Fu=document.createElement("a")),Fu.href=n,Fu.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Lc==null&&(Lc=window.matchMedia("(prefers-reduced-motion: reduce)")),Lc.matches)},hasCanvasFingerprintNoise(){if(Oh!==void 0)return Oh;if(!So())return Oh=!1,!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let i=0;for(let l=0;l<n.width;++l)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(l,0,1,1);const o=e.getImageData(0,0,n.width,n.height);i=0;for(let l=0;l<o.data.length;++l)if(l%4!=3&&i++!==o.data[l])return Oh=!0,!0;return Oh=!1,!1}};function Qd(n,e){const i=n.indexOf("?");if(i<0)return`${n}?${new URLSearchParams(e).toString()}`;const o=new URLSearchParams(n.slice(i));for(const l in e)o.set(l,e[l]);return`${n.slice(0,i)}?${o.toString()}`}function Va(n,e={persistentParams:[]}){const i=n.indexOf("?");if(i<0)return n;const o=new URLSearchParams,l=new URLSearchParams(n.slice(i));for(const f of e.persistentParams){const y=l.get(f);y&&o.set(f,y)}const d=o.toString();return`${n.slice(0,i)}${d.length>0?`?${d}`:""}`}const Ga="mapbox-tiles";let el=500,ns=50;const Eo=["language","worldview","jobid"];let rs,Uu;function Jd(){try{return caches}catch{}}function Cs(){const n=Jd();n&&rs==null&&(rs=n.open(Ga))}let kh=1/0;const ap={supported:!1,testSupport:function(n){!Vu&&Sa&&(pl?op(n):Zl=n)}};let Zl,Sa,Vu=!1,pl=!1;const Rs=typeof self<"u"?self:{};function op(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Sa),n.isContextLost())return;ap.supported=!0}catch{}n.deleteTexture(e),Vu=!0}Rs.document&&(Sa=Rs.document.createElement("img"),Sa.onload=function(){Zl&&op(Zl),Zl=null,pl=!0},Sa.onerror=function(){Vu=!0,Zl=null},Sa.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Gu={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Gu);class Nh extends Error{constructor(e,i,o){i===401&&To(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const gn=Gn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ao=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(gn())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,l){const d=new AbortController,f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:gn(),referrerPolicy:o.referrerPolicy,signal:d.signal});let y=!1,x=!1;const T=(M=f.url).indexOf("sku=")>0&&To(M);var M;o.type==="json"&&f.headers.set("Accept","application/json");const R=(B,F,q)=>{if(x)return;if(B&&B.message!=="SecurityError"&&Ui(B.toString()),F&&q)return D(F);const J=Date.now();fetch(f).then(te=>{if(te.ok){const he=T?te.clone():null;return D(te,he,J)}return l(new Nh(te.statusText,te.status,o.url))}).catch(te=>{te.name!=="AbortError"&&l(new Error(`${te.message} ${o.url}`))})},D=(B,F,q)=>{(o.type==="arrayBuffer"?B.arrayBuffer():o.type==="json"?B.json():B.text()).then(J=>{x||(F&&q&&function(te,he,ce){if(Cs(),rs==null)return;const X=Yn(he.headers.get("Cache-Control")||"");if(X["no-store"])return;const re={status:he.status,statusText:he.statusText,headers:new Headers};he.headers.forEach((ze,Ne)=>re.headers.set(Ne,ze)),X["max-age"]&&re.headers.set("Expires",new Date(ce+1e3*X["max-age"]).toUTCString());const ue=re.headers.get("Expires");if(!ue||new Date(ue).getTime()-ce<42e4)return;let _e=Va(te.url,{persistentParams:Eo});if(he.status===206){const ze=te.headers.get("Range");if(!ze)return;re.status=200,_e=Qd(_e,{range:ze})}(function(ze,Ne){if(Uu===void 0)try{new Response(new ReadableStream),Uu=!0}catch{Uu=!1}Uu?Ne(ze.body):ze.blob().then(Ne).catch(Ue=>Ui(Ue.message))})(he,ze=>{const Ne=new Response((Ue=he.status)!==200&&Ue!==404&&[101,103,204,205,304].includes(Ue)?null:ze,re);var Ue;Cs(),rs!=null&&rs.then(qe=>qe.put(_e,Ne)).catch(qe=>Ui(qe.message))})}(f,F,q),y=!0,l(null,J,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(J=>{x||l(new Error(J.message))})};return T?function(B,F){if(Cs(),rs==null)return F(null);rs.then(q=>{let J=Va(B.url,{persistentParams:Eo});const te=B.headers.get("Range");te&&(J=Qd(J,{range:te})),q.match(J).then(he=>{const ce=function(X){if(!X)return!1;const re=new Date(X.headers.get("Expires")||0),ue=Yn(X.headers.get("Cache-Control")||"");return Number(re)>Date.now()&&!ue["no-cache"]}(he);q.delete(J).catch(F),ce&&q.put(J,he.clone()).catch(F),F(null,he,ce)}).catch(F)}).catch(F)}(f,R):R(null,null),{cancel:()=>{x=!0,y||d.abort()}}}(n,e);if(Gn(self)&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(o,l){const d=new XMLHttpRequest;d.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const f in o.headers)d.setRequestHeader(f,o.headers[f]);return o.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=o.credentials==="include",d.onerror=()=>{l(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let f=d.response;if(o.type==="json")try{f=JSON.parse(d.response)}catch(y){return l(y)}l(null,f,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else l(new Nh(d.statusText,d.status,o.url))},d.send(o.body),{cancel:()=>d.abort()}}(n,e)},Xl=function(n,e){return Ao(Ve(n,{type:"arrayBuffer"}),e)};function Bh(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const ml="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let gl,Is;gl=[],Is=0;const Oc=function(n,e){if(ap.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Is>=Wr.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return gl.push(d),d}Is++;let i=!1;const o=()=>{if(!i)for(i=!0,Is--;gl.length&&Is<Wr.MAX_PARALLEL_IMAGE_REQUESTS;){const d=gl.shift(),{requestParameters:f,callback:y,cancelled:x}=d;x||(d.cancel=Oc(f,y).cancel)}},l=Xl(n,(d,f,y,x)=>{o(),d?e(d):f&&(self.createImageBitmap?function(T,M){const R=new Blob([new Uint8Array(T)],{type:"image/png"});createImageBitmap(R).then(D=>{M(null,D)}).catch(D=>{M(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(T,M)=>e(T,M,y,x)):function(T,M){const R=new Image;R.onload=()=>{M(null,R),URL.revokeObjectURL(R.src),R.onload=null,requestAnimationFrame(()=>{R.src=ml})},R.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new Blob([new Uint8Array(T)],{type:"image/png"});R.src=T.byteLength?URL.createObjectURL(D):ml}(f,(T,M)=>e(T,M,y,x)))});return{cancel:()=>{l.cancel(),o()}}};var Fh,Hu,Wl,Ea={exports:{}},as={exports:{}},kc={exports:{}},Nc=function(){if(Wl)return Ea.exports;Wl=1;var n=(Fh||(Fh=1,as.exports=function(i,o){var l,d,f,y,x,T,M,R;for(d=i.length-(l=3&i.length),f=o,x=3432918353,T=461845907,R=0;R<d;)M=255&i.charCodeAt(R)|(255&i.charCodeAt(++R))<<8|(255&i.charCodeAt(++R))<<16|(255&i.charCodeAt(++R))<<24,++R,f=27492+(65535&(y=5*(65535&(f=(f^=M=(65535&(M=(M=(65535&M)*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*T+(((M>>>16)*T&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(M=0,l){case 3:M^=(255&i.charCodeAt(R+2))<<16;case 2:M^=(255&i.charCodeAt(R+1))<<8;case 1:f^=M=(65535&(M=(M=(65535&(M^=255&i.charCodeAt(R)))*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*T+(((M>>>16)*T&65535)<<16)&4294967295}return f^=i.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),as.exports),e=(Hu||(Hu=1,kc.exports=function(i,o){for(var l,d=i.length,f=o^d,y=0;d>=4;)l=1540483477*(65535&(l=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),d-=4,++y;switch(d){case 3:f^=(255&i.charCodeAt(y+2))<<16;case 2:f^=(255&i.charCodeAt(y+1))<<8;case 1:f=1540483477*(65535&(f^=255&i.charCodeAt(y)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),kc.exports);return Ea.exports=n,Ea.exports.murmur3=n,Ea.exports.murmur2=e,Ea.exports}(),Mo=ro(Nc);class tl{constructor(e,...i){Ve(this,i[0]||{}),this.type=e}}class jh extends tl{constructor(e,i={}){super("error",Ve({error:e},i))}}function Bc(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function Fc(n,e,i){if(i&&i[n]){const o=i[n].indexOf(e);o!==-1&&i[n].splice(o,1)}}class Yl{on(e,i){return this._listeners=this._listeners||{},Bc(e,i,this._listeners),this}off(e,i){return Fc(e,i,this._listeners),Fc(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Bc(e,i,this._oneTimeListeners),this):new Promise(o=>{this.once(e,o)})}fire(e,i){const o=typeof e=="string"?new tl(e,i):e,l=o.type;if(this.listens(l)){o.target=this;const d=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const x of d)x.call(this,o);const f=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const x of f)Fc(l,x,this._oneTimeListeners),x.call(this,o);const y=this._eventedParent;y&&(Ve(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(o))}else o instanceof jh&&console.error(o.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class Co{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Co(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,o]=e.split("");return new Co({name:i,iconsetId:o})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return Co.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var sp,ef={},jc=function(){if(sp)return ef;sp=1;var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(d){return(d=Math.round(d))<0?0:d>255?255:d}function i(d){return e(d[d.length-1]==="%"?parseFloat(d)/100*255:parseInt(d))}function o(d){return(f=d[d.length-1]==="%"?parseFloat(d)/100:parseFloat(d))<0?0:f>1?1:f;var f}function l(d,f,y){return y<0?y+=1:y>1&&(y-=1),6*y<1?d+(f-d)*y*6:2*y<1?f:3*y<2?d+(f-d)*(2/3-y)*6:d}try{ef.parseCSSColor=function(d){var f,y=d.replace(/ /g,"").toLowerCase();if(y in n)return n[y].slice();if(y[0]==="#")return y.length===4?(f=parseInt(y.substr(1),16))>=0&&f<=4095?[(3840&f)>>4|(3840&f)>>8,240&f|(240&f)>>4,15&f|(15&f)<<4,1]:null:y.length===7&&(f=parseInt(y.substr(1),16))>=0&&f<=16777215?[(16711680&f)>>16,(65280&f)>>8,255&f,1]:null;var x=y.indexOf("("),T=y.indexOf(")");if(x!==-1&&T+1===y.length){var M=y.substr(0,x),R=y.substr(x+1,T-(x+1)).split(","),D=1;switch(M){case"rgba":if(R.length!==4)return null;D=o(R.pop());case"rgb":return R.length!==3?null:[i(R[0]),i(R[1]),i(R[2]),D];case"hsla":if(R.length!==4)return null;D=o(R.pop());case"hsl":if(R.length!==3)return null;var B=(parseFloat(R[0])%360+360)%360/360,F=o(R[1]),q=o(R[2]),J=q<=.5?q*(F+1):q+F-q*F,te=2*q-J;return[e(255*l(te,J,B+1/3)),e(255*l(te,J,B)),e(255*l(te,J,B-1/3)),D];default:return null}}return null}}catch{}return ef}();class Cn{constructor(e,i,o,l=1){this.r=e,this.g=i,this.b=o,this.a=l}static parse(e){if(!e)return;if(e instanceof Cn)return e;if(typeof e!="string")return;const i=jc.parseCSSColor(e);return i?new Cn(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toStringPremultipliedAlpha(){const[e,i,o,l]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(o)},${l})`}toString(){const[e,i,o,l]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*o)},${l})`}toRenderColor(e){const{r:i,g:o,b:l,a:d}=this;return new Pm(e,i,o,l,d)}clone(){return new Cn(this.r,this.g,this.b,this.a)}}class Pm{constructor(e,i,o,l,d){if(e){const f=e.image.height,y=f*f;i=d===0?0:i/d*(f-1),o=d===0?0:o/d*(f-1),l=d===0?0:l/d*(f-1);const x=Math.floor(i),T=Math.floor(o),M=Math.floor(l),R=Math.ceil(i),D=Math.ceil(o),B=Math.ceil(l),F=i-x,q=o-T,J=l-M,te=e.image.data,he=4*(x+T*y+M*f),ce=4*(x+T*y+B*f),X=4*(x+D*y+M*f),re=4*(x+D*y+B*f),ue=4*(R+T*y+M*f),_e=4*(R+T*y+B*f),ze=4*(R+D*y+M*f),Ne=4*(R+D*y+B*f);if(he<0||Ne>=te.length)throw new Error("out of range");this.r=Ti(Ti(Ti(te[he],te[ce],J),Ti(te[X],te[re],J),q),Ti(Ti(te[ue],te[_e],J),Ti(te[ze],te[Ne],J),q),F)/255*d,this.g=Ti(Ti(Ti(te[he+1],te[ce+1],J),Ti(te[X+1],te[re+1],J),q),Ti(Ti(te[ue+1],te[_e+1],J),Ti(te[ze+1],te[Ne+1],J),q),F)/255*d,this.b=Ti(Ti(Ti(te[he+2],te[ce+2],J),Ti(te[X+2],te[re+2],J),q),Ti(Ti(te[ue+2],te[_e+2],J),Ti(te[ze+2],te[Ne+2],J),q),F)/255*d,this.a=d}else this.r=i,this.g=o,this.b=l,this.a=d}toArray(){const{r:e,g:i,b:o,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*i/l,255*o/l,l]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:i,b:o,a:l}=this,d=Math.min(Math.max(e/l,0),1),f=Math.min(Math.max(i/l,0),1),y=Math.min(Math.max(o/l,0),1),x=Math.min(d,f,y),T=Math.max(d,f,y),M=(x+T)/2;if(x===T)return[0,0,100*M,l];const R=T-x,D=M>.5?R/(2-T-x):R/(T+x);let B=0;return T===d?B=(f-y)/R+(f<y?6:0):T===f?B=(y-d)/R+2:T===y&&(B=(d-f)/R+4),B*=60,[Math.min(Math.max(B,0),360),Math.min(Math.max(100*D,0),100),Math.min(Math.max(100*M,0),100),l]}toArray01(){const{r:e,g:i,b:o,a:l}=this;return l===0?[0,0,0,0]:[e/l,i/l,o/l,l]}toArray01Scaled(e){const{r:i,g:o,b:l,a:d}=this;return d===0?[0,0,0]:[i/d*e,o/d*e,l/d*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:o,a:l}=this;return[e,i,o,l]}toArray01Linear(){const{r:e,g:i,b:o,a:l}=this;return l===0?[0,0,0,0]:[Math.pow(e/l,2.2),Math.pow(i/l,2.2),Math.pow(o/l,2.2),l]}}function Ti(n,e,i){return n*(1-i)+e*i}function Lm(n,e,i){return n.map((o,l)=>Ti(o,e[l],i))}function tf(n){return n*n*n*n*n}Cn.black=new Cn(0,0,0,1),Cn.white=new Cn(1,1,1,1),Cn.transparent=new Cn(0,0,0,0),Cn.red=new Cn(1,0,0,1),Cn.blue=new Cn(0,0,1,1);var Uh=Object.freeze({__proto__:null,array:Lm,color:function(n,e,i){return new Cn(Ti(n.r,e.r,i),Ti(n.g,e.g,i),Ti(n.b,e.b,i),Ti(n.a,e.a,i))},easeIn:tf,number:Ti});function Vh(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}class os extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Uc{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,l]of i)this.bindings[o]=l}concat(e){return new Uc(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Kl={kind:"null"},di={kind:"number"},qn={kind:"string"},kn={kind:"boolean"},ao={kind:"color"},_l={kind:"object"},On={kind:"value"},Vc={kind:"collator"},Gh={kind:"formatted"},Hh={kind:"resolvedImage"};function Ha(n,e){return{kind:"array",itemType:n,N:e}}function ia(n){if(n.kind==="array"){const e=ia(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const i_=[Kl,di,qn,kn,ao,Gh,_l,Ha(On),Hh];function qh(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!qh(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of i_)if(!qh(i,e))return null}}return`Expected ${ia(n)} but found ${ia(e)} instead.`}function lp(n,e){return e.some(i=>i.kind===n.kind)}function Ql(n,e){return e.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}class ss{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class nf{constructor(e,i,o,l,d){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=l,this.textColor=d}}class La{constructor(e){this.sections=e}static fromString(e){return new La([new nf(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof La?e:La.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const l=i.image.getPrimary().id.toString();e.push(["image",l]);continue}e.push(i.text);const o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(o)}return e}}class ls{constructor(e,i={}){if(this.id=Co.from(e),this.options=Object.assign({},i),i.transform){const{a:o,b:l,c:d,d:f,e:y,f:x}=i.transform;this.options.transform=new DOMMatrix([o,l,d,f,y,x])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:o,d:l,e:d,f}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:o,d:l,e:d,f}})}static parse(e){let i,o,l,d;try{({name:i,iconsetId:o,params:l,transform:d}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:f,b:y,c:x,d:T,e:M,f:R}=d||{};return new ls({name:i,iconsetId:o},{params:l,transform:new DOMMatrix([f,y,x,T,M,R])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class qa{constructor(e,i,o,l,d=!1){this.primaryId=Co.from(e),this.primaryOptions=i,o&&(this.secondaryId=Co.from(o)),this.secondaryOptions=l,this.available=d}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new ls(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new ls(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?qa.build({name:e}):e}static build(e,i,o,l){return!e||typeof e=="object"&&!("name"in e)?null:new qa(e,o,i,l)}}function cp(n,e,i,o){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,e,i,o]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Gc(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Cn||n instanceof ss||n instanceof La||n instanceof qa)return!0;if(Array.isArray(n)){for(const e of n)if(!Gc(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Gc(n[e]))return!1;return!0}return!1}function Br(n){if(n===null)return Kl;if(typeof n=="string")return qn;if(typeof n=="boolean")return kn;if(typeof n=="number")return di;if(n instanceof Cn)return ao;if(n instanceof ss)return Vc;if(n instanceof La)return Gh;if(n instanceof qa)return Hh;if(Array.isArray(n)){const e=n.length;let i;for(const o of n){const l=Br(o);if(i){if(i===l)continue;i=On;break}i=l}return Ha(i||On,e)}return _l}function $a(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Cn?n.toStringPremultipliedAlpha():n instanceof La||n instanceof qa?n.toString():JSON.stringify(n)}class Zi{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Gc(e[1]))return i.error("invalid value");const o=e[1];let l=Br(o);const d=i.expectedType;return l.kind!=="array"||l.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(l=d),new Zi(l,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Cn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof La?this.value.serialize():this.value}}class ei{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const qu={string:qn,number:di,boolean:kn,object:_l};class Di{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,l=1;const d=e[0];if(d==="array"){let y,x;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in qu)||T==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=qu[T],l++}else y=On;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=e[2],l++}o=Ha(y,x)}else o=qu[d];const f=[];for(;l<e.length;l++){const y=i.parse(e[l],l,On);if(!y)return null;f.push(y)}return new Di(o,f)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!qh(this.type,Br(o)))return o;if(i===this.args.length-1)throw new ei(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${ia(Br(o))} but was expected to be of type ${ia(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&i.push(l)}}return i.concat(this.args.map(o=>o.serialize()))}}class Ds{constructor(e){this.type=Gh,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const l=[];let d=!1;for(let f=1;f<=e.length-1;++f){const y=e[f];if(d&&typeof y=="object"&&!Array.isArray(y)){d=!1;let x=null;if(y["font-scale"]&&(x=i.parseObjectValue(y["font-scale"],f,"font-scale",di),!x))return null;let T=null;if(y["text-font"]&&(T=i.parseObjectValue(y["text-font"],f,"text-font",Ha(qn)),!T))return null;let M=null;if(y["text-color"]&&(M=i.parseObjectValue(y["text-color"],f,"text-color",ao),!M))return null;const R=l[l.length-1];R.scale=x,R.font=T,R.textColor=M}else{const x=i.parse(e[f],f,On);if(!x)return null;const T=x.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,l.push({content:x,scale:null,font:null,textColor:null})}}return new Ds(l)}evaluate(e){return new La(this.sections.map(i=>{const o=i.content.evaluate(e);return Br(o)===Hh?new nf("",o,null,null,null):new nf($a(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class il{constructor(e,i,o,l){this._imageWarnHistory={},this.type=Hh,this.namePrimary=e,this.nameSecondary=i,o&&(this.paramsPrimary=o.params,this.iconsetIdPrimary=o.iconset?o.iconset.id:void 0),l&&(this.paramsSecondary=l.params,this.iconsetIdSecondary=l.iconset?l.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let o=1;const l=[];function d(){if(o<e.length){const y=i.parse(e[o],o++,qn);return y?(l.push({image:y,options:{}}),!0):(i.error(l.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function f(){if(o<e.length){const x=e[o];if((y=x)===null||typeof y!="object"||Array.isArray(y))return!0;const T=x.params,M=x.iconset,R=i.concat(o);if(!T&&!M)return o++,!0;if(T){if(typeof T!="object"||T.constructor!==Object)return R.error('Image options "params" should be an object'),!1;const D={},B=R.concat(void 0,"params");for(const F in T){if(!F)return B.error("Image parameter name should be non-empty"),!1;const q=B.concat(void 0,F).parse(T[F],void 0,ao,void 0,{typeAnnotation:"coerce"});if(!q)return!1;D[F]=q}l[l.length-1].options.params=D}if(M){if(typeof M!="object"||M.constructor!==Object)return R.error('Image options "iconset" should be an object'),!1;if(!M.id)return R.error('Image options "iconset" should have an "id" property'),!1;l[l.length-1].options.iconset=M}return o++,!0}var y;return!0}for(let y=0;y<2;y++)if(!d()||!f())return;return new il(l[0].image,l[1]?l[1].image:void 0,l[0].options,l[1]?l[1].options:void 0)}evaluateParams(e,i){const o={};if(i){for(const l in i)if(i[l])try{o[l]=i[l].evaluate(e)}catch{continue}if(Object.keys(o).length!==0)return{params:o}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},o=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,l=qa.build(i,o,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(l&&e.availableImages){const d=l.getPrimary().id;if(l.available=e.availableImages.some(f=>Co.isEqual(f,d)),l.available){const f=l.getSecondary()?l.getSecondary().id:null;f&&(l.available=e.availableImages.some(y=>Co.isEqual(y,f)))}}return l}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const o={};if(i&&(o.iconset={id:i}),e){o.params={};for(const l in e)e[l]&&(o.params[l]=e[l].serialize())}return Object.keys(o).length>0?o:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function Li(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}const $h={"to-boolean":kn,"to-color":ao,"to-number":di,"to-string":qn};class cs{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0],l=[];let d=Kl;if(o==="to-array"){if(!Array.isArray(e[1]))return null;const f=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);d=Ha(i.expectedType.itemType,f)}else{if(!(f>0&&Gc(e[1][0])))return null;d=Ha(Br(e[1][0]),f)}for(let y=0;y<f;y++){const x=e[1][y];let T;if(Li(x)==="array")T=i.parse(x,void 0,d.itemType);else{const M=Li(x);if(M!==d.itemType.kind)return i.error(`Expected ${d.itemType.kind} but found ${M}.`);T=i.registry.literal.parse(["literal",x===void 0?null:x],i)}if(!T)return null;l.push(T)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");d=$h[o];for(let f=1;f<e.length;f++){const y=i.parse(e[f],f,On);if(!y)return null;l.push(y)}}return new cs(d,l)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,o;for(const l of this.args){if(i=l.evaluate(e),o=null,i instanceof Cn)return i;if(typeof i=="string"){const d=e.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:cp(i[0],i[1],i[2],i[3]),!o))return new Cn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new ei(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const l=Number(i);if(!isNaN(l))return l}throw new ei(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?La.fromString($a(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?qa.build($a(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):$a(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ds([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new il(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const up=["Unknown","Point","LineString","Polygon"];class $u{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?up[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:o,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*i-e[0])+this.featureDistanceData.bearing[1]*(l*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Cn.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class va{constructor(e,i,o,l,d){this.name=e,this.type=i,this._evaluate=o,this.args=l,this._overloadIndex=d}evaluate(e){if(!this._evaluate){const i=va.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const o=e[0],l=va.definitions[o];if(!l)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,y=[];let x=null,T=-1;for(const[M,R]of f){if(Array.isArray(M)&&M.length!==e.length-1)continue;y.push(M),T++,x=new Ns(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const D=[];let B=!1;for(let F=1;F<e.length;F++){const q=e[F],J=Array.isArray(M)?M[F-1]:M.type,te=x.parse(q,1+D.length,J);if(!te){B=!0;break}D.push(te)}if(!B)if(Array.isArray(M)&&M.length!==D.length)x.error(`Expected ${M.length} arguments, but found ${D.length} instead.`);else{for(let F=0;F<D.length;F++){const q=Array.isArray(M)?M[F]:M.type,J=D[F];x.concat(F+1).checkSubtype(q,J.type)}if(x.errors.length===0)return new va(o,d,R,D,T)}}if(y.length===1)i.errors.push(...x.errors);else{const M=(y.length?y:f.map(([D])=>D)).map(Oa).join(" | "),R=[];for(let D=1;D<e.length;D++){const B=i.parse(e[D],1+R.length);if(!B)return null;R.push(ia(B.type))}i.error(`Expected arguments of type ${M}, but found (${R.join(", ")}) instead.`)}return null}static register(e,i){va.definitions=i;for(const o in i)e[o]=va}}function Oa(n){return Array.isArray(n)?`(${n.map(ia).join(", ")})`:`(${ia(n.type)}...)`}class Hc{constructor(e,i,o){this.type=Vc,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const l=o["case-sensitive"]===void 0?i.parse(!1,1,kn):i.parseObjectValue(o["case-sensitive"],1,"case-sensitive",kn);if(!l)return null;const d=o["diacritic-sensitive"]===void 0?i.parse(!1,1,kn):i.parseObjectValue(o["diacritic-sensitive"],1,"diacritic-sensitive",kn);if(!d)return null;let f=null;return o.locale&&(f=i.parseObjectValue(o.locale,1,"locale",qn),!f)?null:new Hc(l,d,f)}evaluate(e){return new ss(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function yl(n,e,i=0,o=n.length-1,l=$c){for(;o>i;){if(o-i>600){const x=o-i+1,T=e-i+1,M=Math.log(x),R=.5*Math.exp(2*M/3),D=.5*Math.sqrt(M*R*(x-R)/x)*(T-x/2<0?-1:1);yl(n,e,Math.max(i,Math.floor(e-T*R/x+D)),Math.min(o,Math.floor(e+(x-T)*R/x+D)),l)}const d=n[e];let f=i,y=o;for(qc(n,i,e),l(n[o],d)>0&&qc(n,i,o);f<y;){for(qc(n,f,y),f++,y--;l(n[f],d)<0;)f++;for(;l(n[y],d)>0;)y--}l(n[i],d)===0?qc(n,i,y):(y++,qc(n,y,o)),y<=e&&(i=y+1),e<=y&&(o=y-1)}}function qc(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function $c(n,e){return n<e?-1:n>e?1:0}function Za(n){let e=0;for(let i,o,l=0,d=n.length,f=d-1;l<d;f=l++)i=n[l],o=n[f],e+=(o.x-i.x)*(i.y+o.y);return e}function Zh(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Xh(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function qo(n,e,i){const o=n[0]-e[0],l=n[1]-e[1],d=n[0]-i[0],f=n[1]-i[1];return o*f-d*l==0&&o*d<=0&&l*f<=0}function $o(n,e,i=!1){let o=!1;for(let y=0,x=e.length;y<x;y++){const T=e[y];for(let M=0,R=T.length,D=R-1;M<R;D=M++){const B=T[D],F=T[M];if(qo(n,B,F))return i;(d=B)[1]>(l=n)[1]!=(f=F)[1]>l[1]&&l[0]<(f[0]-d[0])*(l[1]-d[1])/(f[1]-d[1])+d[0]&&(o=!o)}}var l,d,f;return o}function rf(n,e,i,o){const l=o[0]-i[0],d=o[1]-i[1],f=(n[0]-i[0])*d-l*(n[1]-i[1]),y=(e[0]-i[0])*d-l*(e[1]-i[1]);return f>0&&y<0||f<0&&y>0}function zs(n,e,i,o){return(l=[o[0]-i[0],o[1]-i[1]])[0]*(d=[e[0]-n[0],e[1]-n[1]])[1]-l[1]*d[0]!=0&&!(!rf(n,e,i,o)||!rf(i,o,n,e));var l,d}function af(n){const e=new Bt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Bt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const o of n[0])e.x>o.x&&(e.x=o.x),e.y>o.y&&(e.y=o.y),i.x<o.x&&(i.x=o.x),i.y<o.y&&(i.y=o.y);return{min:e,max:i}}const vl=8192;function hp(n,e){const i=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(i*l*vl),Math.round(o*l*vl)]}function n_(n,e){for(let i=0;i<e.length;i++)if($o(n,e[i]))return!0;return!1}function Zc(n,e,i){for(const o of i)for(let l=0,d=o.length,f=d-1;l<d;f=l++)if(zs(n,e,o[f],o[l]))return!0;return!1}function of(n,e){for(let i=0;i<n.length;++i)if(!$o(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(Zc(n[i],n[i+1],e))return!1;return!0}function Wh(n,e){for(let i=0;i<e.length;i++)if(of(n,e[i]))return!0;return!1}function Zu(n,e,i){const o=[];for(let l=0;l<n.length;l++){const d=[];for(let f=0;f<n[l].length;f++){const y=hp(n[l][f],i);Zh(e,y),d.push(y)}o.push(d)}return o}function dp(n,e,i){const o=[];for(let l=0;l<n.length;l++){const d=Zu(n[l],e,i);o.push(d)}return o}function Ro(n,e,i,o){if(n[0]<i[0]||n[0]>i[2]){const l=.5*o;let d=n[0]-i[0]>l?-o:i[0]-n[0]>l?o:0;d===0&&(d=n[0]-i[2]>l?-o:i[2]-n[0]>l?o:0),n[0]+=d}Zh(e,n)}function Xc(n,e,i,o){const l=Math.pow(2,o.z)*vl,d=[o.x*vl,o.y*vl],f=[];if(!n)return f;for(const y of n)for(const x of y){const T=[x.x+d[0],x.y+d[1]];Ro(T,e,i,l),f.push(T)}return f}function sf(n,e,i,o){const l=Math.pow(2,o.z)*vl,d=[o.x*vl,o.y*vl],f=[];if(!n)return f;for(const x of n){const T=[];for(const M of x){const R=[M.x+d[0],M.y+d[1]];Zh(e,R),T.push(R)}f.push(T)}if(e[2]-e[0]<=l/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of f)for(const T of x)Ro(T,e,i,l)}var y;return f}class nl{constructor(e,i){this.type=kn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Gc(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let l=0;l<o.features.length;++l){const d=o.features[l].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new nl(o,o.features[l].geometry)}else if(o.type==="Feature"){const l=o.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new nl(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new nl(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const y=Zu(o.coordinates,d,f),x=Xc(i.geometry(),l,d,f);if(!Xh(l,d))return!1;for(const T of x)if(!$o(T,y))return!1}if(o.type==="MultiPolygon"){const y=dp(o.coordinates,d,f),x=Xc(i.geometry(),l,d,f);if(!Xh(l,d))return!1;for(const T of x)if(!n_(T,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const y=Zu(o.coordinates,d,f),x=sf(i.geometry(),l,d,f);if(!Xh(l,d))return!1;for(const T of x)if(!of(T,y))return!1}if(o.type==="MultiPolygon"){const y=dp(o.coordinates,d,f),x=sf(i.geometry(),l,d,f);if(!Xh(l,d))return!1;for(const T of x)if(!Wh(T,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ps={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},lf=1/298.257223563,Zo=lf*(2-lf),Wc=Math.PI/180;class Xu{static fromTile(e,i,o){const l=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),d=Math.atan(.5*(Math.exp(l)-Math.exp(-l)))/Wc;return new Xu(d,o)}static get units(){return Ps}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!Ps[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(Ps).join(", ")}`);const o=6378.137*Wc*(i?Ps[i]:1),l=Math.cos(e*Wc),d=1/(1-Zo*(1-l*l)),f=Math.sqrt(d);this.kx=o*f*l,this.ky=o*f*d*(1-Zo)}distance(e,i){const o=Io(e[0]-i[0])*this.kx,l=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+l*l)}bearing(e,i){const o=Io(i[0]-e[0])*this.kx;return Math.atan2(o,(i[1]-e[1])*this.ky)/Wc}destination(e,i,o){const l=o*Wc;return this.offset(e,Math.sin(l)*i,Math.cos(l)*i)}offset(e,i,o){return[e[0]+i/this.kx,e[1]+o/this.ky]}lineDistance(e){let i=0;for(let o=0;o<e.length-1;o++)i+=this.distance(e[o],e[o+1]);return i}area(e){let i=0;for(let o=0;o<e.length;o++){const l=e[o];for(let d=0,f=l.length,y=f-1;d<f;y=d++)i+=Io(l[d][0]-l[y][0])*(l[d][1]+l[y][1])*(o?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let o=0;if(i<=0)return e[0];for(let l=0;l<e.length-1;l++){const d=e[l],f=e[l+1],y=this.distance(d,f);if(o+=y,o>i)return cf(d,f,(i-(o-y))/y)}return e[e.length-1]}pointToSegmentDistance(e,i,o){let[l,d]=i,f=Io(o[0]-l)*this.kx,y=(o[1]-d)*this.ky;if(f!==0||y!==0){const x=(Io(e[0]-l)*this.kx*f+(e[1]-d)*this.ky*y)/(f*f+y*y);x>1?(l=o[0],d=o[1]):x>0&&(l+=f/this.kx*x,d+=y/this.ky*x)}return f=Io(e[0]-l)*this.kx,y=(e[1]-d)*this.ky,Math.sqrt(f*f+y*y)}pointOnLine(e,i){let o=1/0,l=e[0][0],d=e[0][1],f=0,y=0;for(let x=0;x<e.length-1;x++){let T=e[x][0],M=e[x][1],R=Io(e[x+1][0]-T)*this.kx,D=(e[x+1][1]-M)*this.ky,B=0;R===0&&D===0||(B=(Io(i[0]-T)*this.kx*R+(i[1]-M)*this.ky*D)/(R*R+D*D),B>1?(T=e[x+1][0],M=e[x+1][1]):B>0&&(T+=R/this.kx*B,M+=D/this.ky*B)),R=Io(i[0]-T)*this.kx,D=(i[1]-M)*this.ky;const F=R*R+D*D;F<o&&(o=F,l=T,d=M,f=x,y=B)}return{point:[l,d],index:f,t:Math.max(0,Math.min(1,y))}}lineSlice(e,i,o){let l=this.pointOnLine(o,e),d=this.pointOnLine(o,i);if(l.index>d.index||l.index===d.index&&l.t>d.t){const T=l;l=d,d=T}const f=[l.point],y=l.index+1,x=d.index;!fp(o[y],f[0])&&y<=x&&f.push(o[y]);for(let T=y+1;T<=x;T++)f.push(o[T]);return fp(o[x],d.point)||f.push(d.point),f}lineSliceAlong(e,i,o){let l=0;const d=[];for(let f=0;f<o.length-1;f++){const y=o[f],x=o[f+1],T=this.distance(y,x);if(l+=T,l>e&&d.length===0&&d.push(cf(y,x,(e-(l-T))/T)),l>=i)return d.push(cf(y,x,(i-(l-T))/T)),d;l>e&&d.push(x)}return d}bufferPoint(e,i){const o=i/this.ky,l=i/this.kx;return[e[0]-l,e[1]-o,e[0]+l,e[1]+o]}bufferBBox(e,i){const o=i/this.ky,l=i/this.kx;return[e[0]-l,e[1]-o,e[2]+l,e[3]+o]}insideBBox(e,i){return Io(e[0]-i[0])>=0&&Io(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function fp(n,e){return n[0]===e[0]&&n[1]===e[1]}function cf(n,e,i){const o=Io(e[0]-n[0]);return[n[0]+o*i,n[1]+(e[1]-n[1])*i]}function Io(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}class Yh{constructor(e=[],i=(o,l)=>o<l?-1:o>l?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,l=i[e];for(;e>0;){const d=e-1>>1,f=i[d];if(o(l,f)>=0)break;i[e]=f,e=d}i[e]=l}_down(e){const{data:i,compare:o}=this,l=this.length>>1,d=i[e];for(;e<l;){let f=1+(e<<1);const y=f+1;if(y<this.length&&o(i[y],i[f])<0&&(f=y),o(i[f],d)>=0)break;i[e]=i[f],e=f}i[e]=d}}var Ut=8192;function Xo(n,e){return e.dist-n.dist}const Kh=100,oo=50;function Do(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}function us(n){return n[1]-n[0]+1}function zo(n,e){const i=n[1]>=n[0]&&n[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function xl(n,e){if(n[0]>n[1])return[null,null];const i=us(n);if(e){if(i===2)return[n,null];const o=Math.floor(i/2);return[[n[0],n[0]+o],[n[0]+o,n[1]]]}{if(i===1)return[n,null];const o=Math.floor(i/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}}function Ls(n,e){const i=[1/0,1/0,-1/0,-1/0];if(!zo(e,n.length))return i;for(let o=e[0];o<=e[1];++o)Zh(i,n[o]);return i}function Yc(n){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<n.length;++i)for(let o=0;o<n[i].length;++o)Zh(e,n[i][o]);return e}function hs(n,e,i){if(Do(n)||Do(e))return NaN;let o=0,l=0;return n[2]<e[0]&&(o=e[0]-n[2]),n[0]>e[2]&&(o=n[0]-e[2]),n[1]>e[3]&&(l=n[1]-e[3]),n[3]<e[1]&&(l=e[1]-n[3]),i.distance([0,0],[o,l])}function Kc(n){return 360*n-180}function cn(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Jl(n,e){const i=Math.pow(2,e.z),o=(n.y/Ut+e.y)/i;return[Kc((n.x/Ut+e.x)/i),cn(o)]}function r_(n,e){const i=[];for(let o=0;o<n.length;++o)i.push(Jl(n[o],e));return i}function Po(n,e,i){const o=i.pointOnLine(e,n).point;return i.distance(n,o)}function Qh(n,e,i,o,l){const d=i.slice(o[0],o[1]+1);let f=1/0;for(let y=e[0];y<=e[1];++y)if((f=Math.min(f,Po(n[y],d,l)))===0)return 0;return f}function Os(n,e,i,o,l){const d=Math.min(l.pointToSegmentDistance(n,i,o),l.pointToSegmentDistance(e,i,o)),f=Math.min(l.pointToSegmentDistance(i,n,e),l.pointToSegmentDistance(o,n,e));return Math.min(d,f)}function br(n,e,i,o,l){if(!zo(e,n.length)||!zo(o,i.length))return NaN;let d=1/0;for(let f=e[0];f<e[1];++f)for(let y=o[0];y<o[1];++y){if(zs(n[f],n[f+1],i[y],i[y+1]))return 0;d=Math.min(d,Os(n[f],n[f+1],i[y],i[y+1],l))}return d}function uf(n,e,i,o,l){if(!zo(e,n.length)||!zo(o,i.length))return NaN;let d=1/0;for(let f=e[0];f<=e[1];++f)for(let y=o[0];y<=o[1];++y)if((d=Math.min(d,l.distance(n[f],i[y])))===0)return d;return d}function Qc(n,e,i){if($o(n,e,!0))return 0;let o=1/0;for(const l of e){const d=l.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(l[0]!==l[d-1]&&(o=Math.min(o,i.pointToSegmentDistance(n,l[d-1],l[0])))===0||(o=Math.min(o,Po(n,l,i)))===0)return o}return o}function pp(n,e,i,o){if(!zo(e,n.length))return NaN;for(let d=e[0];d<=e[1];++d)if($o(n[d],i,!0))return 0;let l=1/0;for(let d=e[0];d<e[1];++d)for(const f of i)for(let y=0,x=f.length,T=x-1;y<x;T=y++){if(zs(n[d],n[d+1],f[T],f[y]))return 0;l=Math.min(l,Os(n[d],n[d+1],f[T],f[y],o))}return l}function hf(n,e){for(const i of n)for(let o=0;o<=i.length-1;++o)if($o(i[o],e,!0))return!0;return!1}function Wu(n,e,i,o=1/0){const l=Yc(n),d=Yc(e);if(o!==1/0&&hs(l,d,i)>=o)return o;if(Xh(l,d)){if(hf(n,e))return 0}else if(hf(e,n))return 0;let f=o;for(const y of n)for(let x=0,T=y.length,M=T-1;x<T;M=x++)for(const R of e)for(let D=0,B=R.length,F=B-1;D<B;F=D++){if(zs(y[M],y[x],R[F],R[D]))return 0;f=Math.min(f,Os(y[M],y[x],R[F],R[D],i))}return f}function bl(n,e,i,o,l,d,f){if(d===null||f===null)return;const y=hs(Ls(o,d),Ls(l,f),i);y<e&&n.push({dist:y,range1:d,range2:f})}function df(n,e,i,o,l=1/0){let d=Math.min(o.distance(n[0],i[0][0]),l);if(d===0)return d;const f=new Yh([{dist:0,range1:[0,n.length-1],range2:[0,0]}],Xo),y=e?oo:Kh,x=Yc(i);for(;f.length;){const T=f.pop();if(T.dist>=d)continue;const M=T.range1;if(us(M)<=y){if(!zo(M,n.length))return NaN;if(e){const R=pp(n,M,i,o);if((d=Math.min(d,R))===0)return d}else for(let R=M[0];R<=M[1];++R){const D=Qc(n[R],i,o);if((d=Math.min(d,D))===0)return d}}else{const R=xl(M,e);if(R[0]!==null){const D=hs(Ls(n,R[0]),x,o);D<d&&f.push({dist:D,range1:R[0],range2:[0,0]})}if(R[1]!==null){const D=hs(Ls(n,R[1]),x,o);D<d&&f.push({dist:D,range1:R[1],range2:[0,0]})}}}return d}function Jh(n,e,i,o,l,d=1/0){let f=Math.min(d,l.distance(n[0],i[0]));if(f===0)return f;const y=new Yh([{dist:0,range1:[0,n.length-1],range2:[0,i.length-1]}],Xo),x=e?oo:Kh,T=o?oo:Kh;for(;y.length;){const M=y.pop();if(M.dist>=f)continue;const R=M.range1,D=M.range2;if(us(R)<=x&&us(D)<=T){if(!zo(R,n.length)||!zo(D,i.length))return NaN;if(e&&o?f=Math.min(f,br(n,R,i,D,l)):e||o?e&&!o?f=Math.min(f,Qh(i,D,n,R,l)):!e&&o&&(f=Math.min(f,Qh(n,R,i,D,l))):f=Math.min(f,uf(n,R,i,D,l)),f===0)return f}else{const B=xl(R,e),F=xl(D,o);bl(y,f,l,n,i,B[0],F[0]),bl(y,f,l,n,i,B[0],F[1]),bl(y,f,l,n,i,B[1],F[0]),bl(y,f,l,n,i,B[1],F[1])}}return f}function Lo(n,e,i,o,l=1/0){let d=l;const f=Ls(n,[0,n.length-1]);for(const y of i)if(!(d!==1/0&&hs(f,Ls(y,[0,y.length-1]),o)>=d)&&(d=Math.min(d,Jh(n,e,y,!0,o,d)),d===0))return d;return d}function so(n,e,i,o,l=1/0){let d=l;const f=Ls(n,[0,n.length-1]);for(const y of i){if(d!==1/0&&hs(f,Yc(y),o)>=d)continue;const x=df(n,e,y,o,d);if(isNaN(x))return x;if((d=Math.min(d,x))===0)return d}return d}function wl(n){return n==="Point"||n==="MultiPoint"||n==="LineString"||n==="MultiLineString"||n==="Polygon"||n==="MultiPolygon"}class lo{constructor(e,i){this.type=di,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Gc(e[1])){const o=e[1];if(o.type==="FeatureCollection"){for(let l=0;l<o.features.length;++l)if(wl(o.features[l].geometry.type))return new lo(o,o.features[l].geometry)}else if(o.type==="Feature"){if(wl(o.geometry.type))return new lo(o,o.geometry)}else if(wl(o.type))return new lo(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),o=e.canonicalID();if(i!=null&&o!=null){if(e.geometryType()==="Point")return function(l,d,f){const y=[];for(const T of l)for(const M of T)y.push(Jl(M,d));const x=new Xu(y[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?Jh(y,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",x):f.type==="MultiLineString"?Lo(y,!1,f.coordinates,x):f.type==="Polygon"||f.type==="MultiPolygon"?so(y,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,x):null}(i,o,this.geometries);if(e.geometryType()==="LineString")return function(l,d,f){const y=[];for(const T of l){const M=[];for(const R of T)M.push(Jl(R,d));y.push(M)}const x=new Xu(y[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return Lo(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",y,x);if(f.type==="MultiLineString"){let T=1/0;for(let M=0;M<f.coordinates.length;M++){const R=Lo(f.coordinates[M],!0,y,x,T);if(isNaN(R))return R;if((T=Math.min(T,R))===0)return T}return T}if(f.type==="Polygon"||f.type==="MultiPolygon"){let T=1/0;for(let M=0;M<y.length;M++){const R=so(y[M],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,x,T);if(isNaN(R))return R;if((T=Math.min(T,R))===0)return T}return T}return null}(i,o,this.geometries);if(e.geometryType()==="Polygon")return function(l,d,f){const y=[];for(const T of function(M,R){const D=M.length;if(D<=1)return[M];const B=[];let F,q;for(let J=0;J<D;J++){const te=Za(M[J]);te!==0&&(M[J].area=Math.abs(te),q===void 0&&(q=te<0),q===te<0?(F&&B.push(F),F=[M[J]]):F.push(M[J]))}return F&&B.push(F),B}(l)){const M=[];for(let R=0;R<T.length;++R)M.push(r_(T[R],d));y.push(M)}const x=new Xu(y[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return so(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",y,x);if(f.type==="MultiLineString"){let T=1/0;for(let M=0;M<f.coordinates.length;M++){const R=so(f.coordinates[M],!0,y,x,T);if(isNaN(R))return R;if((T=Math.min(T,R))===0)return T}return T}return f.type==="Polygon"||f.type==="MultiPolygon"?function(T,M,R){let D=1/0;for(const B of T)for(const F of M){const q=Wu(B,F,R,D);if(isNaN(q))return q;if((D=Math.min(D,q))===0)return D}return D}(f.type==="Polygon"?[f.coordinates]:f.coordinates,y,x):null}(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function ks(n,e){switch(n){case"string":return $a(e);case"number":return+e;case"boolean":return!!e;case"color":return Cn.parse(e);case"formatted":return La.fromString($a(e));case"resolvedImage":return qa.build($a(e))}return e}function ec(n,e,i,o){return o!==void 0&&(n=o*Math.round(n/o)),e!==void 0&&n<e&&(n=e),i!==void 0&&n>i&&(n=i),n}class Jc{constructor(e,i,o){this.type=e,this.key=i,this.scope=o}static parse(e,i){let o=i.expectedType;if(o==null&&(o=On),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const l=i.parse(e[1],1);if(!(l instanceof Zi))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const d=i.parse(e[2],2);return d instanceof Zi?new Jc(o,$a(l.value),$a(d.value)):i.error("Scope of 'config' expression must be a string literal.")}return new Jc(o,$a(l.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),o=e.getConfig(i);if(!o)return null;const{type:l,value:d,values:f,minValue:y,maxValue:x,stepValue:T}=o,M=o.default.evaluate(e);let R=M;if(d){const D=e.scope;e.scope=(D||"").split("").slice(1).join(""),R=d.evaluate(e),e.scope=D}return l&&(R=ks(l,R)),R===void 0||y===void 0&&x===void 0&&T===void 0||(typeof R=="number"?R=ec(R,y,x,T):Array.isArray(R)&&(R=R.map(D=>typeof D=="number"?ec(D,y,x,T):D))),d!==void 0&&R!==void 0&&f&&!f.includes(R)&&(R=M,l&&(R=ks(l,R))),(l&&l!==this.type||R!==void 0&&Br(R)!==this.type)&&(R=ks(this.type.kind,R)),R}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function eu(n){if(n instanceof va&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof nl||n instanceof lo)return!1;let e=!0;return n.eachChild(i=>{e&&!eu(i)&&(e=!1)}),e}function Yu(n){if(n instanceof va&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(i=>{e&&!Yu(i)&&(e=!1)}),e}function Aa(n){if(n instanceof Jc)return new Set([n.key]);let e=new Set;return n.eachChild(i=>{e=new Set([...e,...Aa(i)])}),e}function Fr(n,e){if(n instanceof va&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(o=>{i&&!Fr(o,e)&&(i=!1)}),i}class _r{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new _r(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Tl{constructor(e,i=[],o,l=new Uc,d=[],f,y){this.registry=e,this.path=i,this.key=i.map(x=>typeof x=="string"?`['${x}']`:`[${x}]`).join(""),this.scope=l,this.errors=d,this.expectedType=o,this._scope=f,this.options=y}parse(e,i,o,l,d={}){return i||o?this.concat(i,null,o,l)._parse(e,d):this._parse(e,d)}parseObjectValue(e,i,o,l,d,f={}){return this.concat(i,o,l,d)._parse(e,f)}_parse(e,i){function o(l,d,f){return f==="assert"?new Di(d,[l]):f==="coerce"?new cs(d,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(l){let d=l.parse(e,this);if(!d)return null;if(this.expectedType){const f=this.expectedType,y=d.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||y.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(f,y))return null}else d=o(d,f,i.typeAnnotation||"coerce");else d=o(d,f,i.typeAnnotation||"assert")}if(!(d instanceof Zi)&&d.type.kind!=="resolvedImage"&&ed(d)){const f=new $u(this._scope,this.options);try{d=new Zi(d.type,d.evaluate(f))}catch(y){return this.error(y.message),null}}return d}return cs.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o,l){let d=typeof e=="number"?this.path.concat(e):this.path;d=typeof i=="string"?d.concat(i):d;const f=l?this.scope.concat(l):this.scope;return new Tl(this.registry,d,o||null,f,this.errors,this._scope,this.options)}error(e,...i){const o=`${this.key}${i.map(l=>`[${l}]`).join("")}`;this.errors.push(new os(o,e))}checkSubtype(e,i){const o=qh(e,i);return o&&this.error(o),o}}var Ns=Tl;function ed(n){if(n instanceof _r)return ed(n.boundExpression);if(n instanceof va&&n.name==="error"||n instanceof Hc||n instanceof nl||n instanceof lo||n instanceof Jc)return!1;const e=n instanceof cs||n instanceof Di;let i=!0;return n.eachChild(o=>{i=e?i&&ed(o):i&&o instanceof Zi}),!!i&&eu(n)&&Fr(n,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function rl(n,e){const i=n.length-1;let o,l,d=0,f=i,y=0;for(;d<=f;)if(y=Math.floor((d+f)/2),o=n[y],l=n[y+1],o<=e){if(y===i||e<l)return y;d=y+1}else{if(!(o>e))throw new ei("Input is not a number.");f=y-1}return 0}class Ku{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[l,d]of o)this.labels.push(l),this.outputs.push(d)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,di);if(!o)return null;const l=[];let d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let f=1;f<e.length;f+=2){const y=f===1?-1/0:e[f],x=e[f+1],T=f,M=f+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(l.length&&l[l.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const R=i.parse(x,M,d);if(!R)return null;d=d||R.type,l.push([y,R])}return new Ku(d,o,l)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const l=this.input.evaluate(e);if(l<=i[0])return o[0].evaluate(e);const d=i.length;return l>=i[d-1]?o[d-1].evaluate(e):o[rl(i,l)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const mp=.95047,Qu=1.08883,Ju=4/29,tu=6/29,eh=3*tu*tu,gp=tu*tu*tu,Sl=Math.PI/180,El=180/Math.PI;function Bs(n){return n>gp?Math.pow(n,1/3):n/eh+Ju}function Fs(n){return n>tu?n*n*n:eh*(n-Ju)}function td(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function id(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function iu(n){const e=id(n.r),i=id(n.g),o=id(n.b),l=Bs((.4124564*e+.3575761*i+.1804375*o)/mp),d=Bs((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*d-16,a:500*(l-d),b:200*(d-Bs((.0193339*e+.119192*i+.9503041*o)/Qu)),alpha:n.a}}function th(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,o=isNaN(n.b)?e:e-n.b/200;return e=1*Fs(e),i=mp*Fs(i),o=Qu*Fs(o),new Cn(td(3.2404542*i-1.5371385*e-.4985314*o),td(-.969266*i+1.8760108*e+.041556*o),td(.0556434*i-.2040259*e+1.0572252*o),n.alpha)}function ds(n,e,i){const o=e-n;return n+i*(o>180||o<-180?o-360*Math.round(o/360):o)}const da={forward:iu,reverse:th,interpolate:function(n,e,i){return{l:Ti(n.l,e.l,i),a:Ti(n.a,e.a,i),b:Ti(n.b,e.b,i),alpha:Ti(n.alpha,e.alpha,i)}}},Al={forward:function(n){const{l:e,a:i,b:o}=iu(n),l=Math.atan2(o,i)*El;return{h:l<0?l+360:l,c:Math.sqrt(i*i+o*o),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Sl,i=n.c;return th({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:ds(n.h,e.h,i),c:Ti(n.c,e.c,i),l:Ti(n.l,e.l,i),alpha:Ti(n.alpha,e.alpha,i)}}};var _p=Object.freeze({__proto__:null,hcl:Al,lab:da});class co{constructor(e,i,o,l,d){this.type=e,this.operator=i,this.interpolation=o,this.input=l,this.labels=[],this.outputs=[];for(const[f,y]of d)this.labels.push(f),this.outputs.push(y)}static interpolationFactor(e,i,o,l){let d=0;if(e.name==="exponential")d=nd(i,e.base,o,l);else if(e.name==="linear")d=nd(i,1,o,l);else if(e.name==="cubic-bezier"){const f=e.controlPoints;d=new Pc(f[0],f[1],f[2],f[3]).solve(nd(i,1,o,l))}return d}static parse(e,i){let[o,l,d,...f]=e;if(!Array.isArray(l)||l.length===0)return i.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const T=l[1];if(typeof T!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:T}}else{if(l[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const T=l.slice(1);if(T.length!==4||T.some(M=>typeof M!="number"||M<0||M>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,di),!d)return null;const y=[];let x=null;o==="interpolate-hcl"||o==="interpolate-lab"?x=ao:i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType);for(let T=0;T<f.length;T+=2){const M=f[T],R=f[T+1],D=T+3,B=T+4;if(typeof M!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(y.length&&y[y.length-1][0]>=M)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const F=i.parse(R,B,x);if(!F)return null;x=x||F.type,y.push([M,F])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new co(x,o,l,d,y):i.error(`Type ${ia(x)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const l=this.input.evaluate(e);if(l<=i[0])return o[0].evaluate(e);const d=i.length;if(l>=i[d-1])return o[d-1].evaluate(e);const f=rl(i,l),y=co.interpolationFactor(this.interpolation,l,i[f],i[f+1]),x=o[f].evaluate(e),T=o[f+1].evaluate(e);return this.operator==="interpolate"?Uh[this.type.kind.toLowerCase()](x,T,y):this.operator==="interpolate-hcl"?Al.reverse(Al.interpolate(Al.forward(x),Al.forward(T),y)):da.reverse(da.interpolate(da.forward(x),da.forward(T),y))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function nd(n,e,i,o){const l=o-i,d=n-i;return l===0?0:e===1?d/l:(Math.pow(e,d)-1)/(Math.pow(e,l)-1)}class ff{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const l=i.expectedType;l&&l.kind!=="value"&&(o=l);const d=[];for(const y of e.slice(1)){const x=i.parse(y,1+d.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,d.push(x)}const f=l&&d.some(y=>qh(l,y.type));return new ff(f?On:o,d)}evaluate(e){let i,o=null,l=0;for(const d of this.args){if(l++,o=d.evaluate(e),o&&o instanceof qa&&!o.available&&(i||(i=o),o=null,l===this.args.length))return i;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class ca{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let d=1;d<e.length-1;d+=2){const f=e[d];if(typeof f!="string")return i.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);const y=i.parse(e[d+1],d+1);if(!y)return null;o.push([f,y])}const l=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return l?new ca(o,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}class ih{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,di),l=i.parse(e[2],2,Ha(i.expectedType||On));return o&&l?new ih(l.type.itemType,o,l):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new ei(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new ei(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new ei(`Array index must be an integer, but found ${i} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class tc{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,di),l=i.parse(e[2],2,Ha(i.expectedType||On));return o&&l?new tc(l.type.itemType,o,l):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new ei(`Array index out of bounds: ${i} < 0.`);if(i>o.length-1)throw new ei(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i===Math.floor(i))return o[i];const l=Math.floor(i),d=Math.ceil(i),f=o[l],y=o[d];if(typeof f!="number"||typeof y!="number")throw new ei(`Cannot interpolate between non-number values at index ${i}.`);const x=i-l;return f*(1-x)+y*x}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class nu{constructor(e,i){this.type=kn,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,On),l=i.parse(e[2],2,On);return o&&l?lp(o.type,[kn,qn,di,Kl,On])?new nu(o,l):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ia(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!Ql(i,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${ia(Br(i))} instead.`);if(!Ql(o,["string","array"]))throw new ei(`Expected second argument to be of type array or string, but found ${ia(Br(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class nh{constructor(e,i,o){this.type=di,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,On),l=i.parse(e[2],2,On);if(!o||!l)return null;if(!lp(o.type,[kn,qn,di,Kl,On]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ia(o.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,di);return d?new nh(o,l,d):null}return new nh(o,l)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Ql(i,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${ia(Br(i))} instead.`);if(!Ql(o,["string","array"]))throw new ei(`Expected second argument to be of type array or string, but found ${ia(Br(o))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return o.indexOf(i,l)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ic{constructor(e,i,o,l,d,f){this.inputType=e,this.type=i,this.input=o,this.cases=l,this.outputs=d,this.otherwise=f}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const d={},f=[];for(let T=2;T<e.length-1;T+=2){let M=e[T];const R=e[T+1];Array.isArray(M)||(M=[M]);const D=i.concat(T);if(M.length===0)return D.error("Expected at least one branch label.");for(const F of M){if(typeof F!="number"&&typeof F!="string")return D.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return D.error("Numeric branch labels must be integer values.");if(o){if(D.checkSubtype(o,Br(F)))return null}else o=Br(F);if(d[String(F)]!==void 0)return D.error("Branch labels must be unique.");d[String(F)]=f.length}const B=i.parse(R,T,l);if(!B)return null;l=l||B.type,f.push(B)}const y=i.parse(e[1],1,On);if(!y)return null;const x=i.parse(e[e.length-1],e.length-1,l);return x?y.type.kind!=="value"&&i.concat(1).checkSubtype(o,y.type)?null:new ic(o,l,y,d,f,x):null}evaluate(e){const i=this.input.evaluate(e);return(Br(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],l={};for(const f of i){const y=l[this.cases[f]];y===void 0?(l[this.cases[f]]=o.length,o.push([this.cases[f],[f]])):o[y][1].push(f)}const d=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,y]of o)e.push(y.length===1?d(y[0]):y.map(d)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class Ml{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const l=[];for(let f=1;f<e.length-1;f+=2){const y=i.parse(e[f],f,kn);if(!y)return null;const x=i.parse(e[f+1],f+1,o);if(!x)return null;l.push([y,x]),o=o||x.type}const d=i.parse(e[e.length-1],e.length-1,o);return d?new Ml(o,l,d):null}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class rd{constructor(e,i,o,l){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=l}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,On),l=i.parse(e[2],2,di);if(!o||!l)return null;if(!lp(o.type,[Ha(On),qn,On]))return i.error(`Expected first argument to be of type array or string, but found ${ia(o.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,di);return d?new rd(o.type,o,l,d):null}return new rd(o.type,o,l)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Ql(i,["string","array"]))throw new ei(`Expected first argument to be of type array or string, but found ${ia(Br(i))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return i.slice(o,l)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function rh(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Om(n,e,i,o){return o.compare(e,i)===0}function nc(n,e,i){const o=n!=="=="&&n!=="!=";return class xE{constructor(d,f,y){this.type=kn,this.lhs=d,this.rhs=f,this.collator=y,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");const y=d[0];let x=f.parse(d[1],1,On);if(!x)return null;if(!rh(y,x.type))return f.concat(1).error(`"${y}" comparisons are not supported for type '${ia(x.type)}'.`);let T=f.parse(d[2],2,On);if(!T)return null;if(!rh(y,T.type))return f.concat(2).error(`"${y}" comparisons are not supported for type '${ia(T.type)}'.`);if(x.type.kind!==T.type.kind&&x.type.kind!=="value"&&T.type.kind!=="value")return f.error(`Cannot compare types '${ia(x.type)}' and '${ia(T.type)}'.`);o&&(x.type.kind==="value"&&T.type.kind!=="value"?x=new Di(T.type,[x]):x.type.kind!=="value"&&T.type.kind==="value"&&(T=new Di(x.type,[T])));let M=null;if(d.length===4){if(x.type.kind!=="string"&&T.type.kind!=="string"&&x.type.kind!=="value"&&T.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(M=f.parse(d[3],3,Vc),!M)return null}return new xE(x,T,M)}evaluate(d){const f=this.lhs.evaluate(d),y=this.rhs.evaluate(d);if(o&&this.hasUntypedArgument){const x=Br(f),T=Br(y);if(x.kind!==T.kind||x.kind!=="string"&&x.kind!=="number")throw new ei(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${x.kind}, ${T.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=Br(f),T=Br(y);if(x.kind!=="string"||T.kind!=="string")return e(d,f,y)}return this.collator?i(d,f,y,this.collator.evaluate(d)):e(d,f,y)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[n];return this.eachChild(f=>{d.push(f.serialize())}),d}}}const ru=nc("==",function(n,e,i){return e===i},Om),yp=nc("!=",function(n,e,i){return e!==i},function(n,e,i,o){return!Om(0,e,i,o)}),ad=nc("<",function(n,e,i){return e<i},function(n,e,i,o){return o.compare(e,i)<0}),vp=nc(">",function(n,e,i){return e>i},function(n,e,i,o){return o.compare(e,i)>0}),od=nc("<=",function(n,e,i){return e<=i},function(n,e,i,o){return o.compare(e,i)<=0}),km=nc(">=",function(n,e,i){return e>=i},function(n,e,i,o){return o.compare(e,i)>=0});class ah{constructor(e,i,o,l,d,f){this.type=qn,this.number=e,this.locale=i,this.currency=o,this.unit=l,this.minFractionDigits=d,this.maxFractionDigits=f}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,di);if(!o)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return i.error("NumberFormat options argument must be an object.");let d=null;if(l.locale&&(d=i.parseObjectValue(l.locale,2,"locale",qn),!d))return null;let f=null;if(l.currency&&(f=i.parseObjectValue(l.currency,2,"currency",qn),!f))return null;let y=null;if(l.unit&&(y=i.parseObjectValue(l.unit,2,"unit",qn),!y))return null;let x=null;if(l["min-fraction-digits"]&&(x=i.parseObjectValue(l["min-fraction-digits"],2,"min-fraction-digits",di),!x))return null;let T=null;return l["max-fraction-digits"]&&(T=i.parseObjectValue(l["max-fraction-digits"],2,"max-fraction-digits",di),!T)?null:new ah(o,d,f,y,x,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class au{constructor(e){this.type=di,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${ia(o.type)} instead.`):new au(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new ei(`Expected value to be of type string or array, but found ${ia(Br(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function xp(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const al={"==":ru,"!=":yp,">":vp,"<":ad,">=":km,"<=":od,array:Di,at:ih,"at-interpolated":tc,boolean:Di,case:Ml,coalesce:ff,collator:Hc,format:Ds,image:il,in:nu,"index-of":nh,interpolate:co,"interpolate-hcl":co,"interpolate-lab":co,length:au,let:ca,literal:Zi,match:ic,number:Di,"number-format":ah,object:Di,slice:rd,step:Ku,string:Di,"to-boolean":cs,"to-color":cs,"to-number":cs,"to-string":cs,var:_r,within:nl,distance:lo,config:Jc};function bp(n,[e,i,o,l]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const d=l?l.evaluate(n):1,f=cp(e,i,o,d);if(f)throw new ei(f);return new Cn(e/255*d,i/255*d,o/255*d,d)}function oh(n,[e,i,o,l]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const d=l?l.evaluate(n):1,f=function(T,M,R,D){return typeof T=="number"&&T>=0&&T<=360?typeof M=="number"&&M>=0&&M<=100&&typeof R=="number"&&R>=0&&R<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[T,M,R,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[T,M,R,D]:[T,M,R]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[T,M,R,D]:[T,M,R]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,o,d);if(f)throw new ei(f);const y=`hsla(${e}, ${i}%, ${o}%, ${d})`,x=Cn.parse(y);if(!x)throw new ei(`Failed to parse HSLA color: ${y}`);return x}function pf(n,e){return n in e}function sd(n,e){const i=e[n];return i===void 0?null:i}function uo(n){return{type:n}}function mf(n){return{result:"success",value:n}}function ho(n){return{result:"error",value:n}}function ol(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function js(n){return n["property-type"]==="data-driven"}function sh(n){return ol(n.expression,"measure-light")}function ld(n){return ol(n.expression,"zoom")}function lh(n){return!!n.expression&&n.expression.interpolated}function rc(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function ch(n){return n}function cd(n,e){const i=e.type==="color",o=n.stops&&typeof n.stops[0][0]=="object",l=o||!(o||n.property!==void 0),d=n.type||(lh(e)?"exponential":"interval");if(i&&((n=Vh({},n)).stops&&(n.stops=n.stops.map(T=>[T[0],Cn.parse(T[1])])),n.default=Cn.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!_p[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let f,y,x;if(d==="exponential")f=sl;else if(d==="interval")f=gf;else if(d==="categorical"){f=ou,y=Object.create(null);for(const T of n.stops)y[T[0]]=T[1];x=typeof n.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);f=wp}if(o){const T={},M=[];for(let B=0;B<n.stops.length;B++){const F=n.stops[B],q=F[0].zoom;T[q]===void 0&&(T[q]={zoom:q,type:n.type,property:n.property,default:n.default,stops:[]},M.push(q)),T[q].stops.push([F[0].value,F[1]])}const R=[];for(const B of M)R.push([T[B].zoom,cd(T[B],e)]);const D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:co.interpolationFactor.bind(void 0,D),zoomStops:R.map(B=>B[0]),evaluate:({zoom:B},F)=>sl({stops:R,base:n.base},e,B).evaluate(B,F)}}if(l){const T=d==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:co.interpolationFactor.bind(void 0,T),zoomStops:n.stops.map(M=>M[0]),evaluate:({zoom:M})=>f(n,e,M,y,x)}}return{kind:"source",evaluate(T,M){const R=M&&M.properties?M.properties[n.property]:void 0;return R===void 0?ac(n.default,e.default):f(n,e,R,y,x)}}}function ac(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function ou(n,e,i,o,l){return ac(typeof i===l?o[i]:void 0,n.default,e.default)}function gf(n,e,i){if(Li(i)!=="number")return ac(n.default,e.default);const o=n.stops.length;if(o===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[o-1][0])return n.stops[o-1][1];const l=rl(n.stops.map(d=>d[0]),i);return n.stops[l][1]}function sl(n,e,i){const o=n.base!==void 0?n.base:1;if(Li(i)!=="number")return ac(n.default,e.default);const l=n.stops.length;if(l===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[l-1][0])return n.stops[l-1][1];const d=rl(n.stops.map(M=>M[0]),i),f=function(M,R,D,B){const F=B-D,q=M-D;return F===0?0:R===1?q/F:(Math.pow(R,q)-1)/(Math.pow(R,F)-1)}(i,o,n.stops[d][0],n.stops[d+1][0]),y=n.stops[d][1],x=n.stops[d+1][1];let T=Uh[e.type]||ch;if(n.colorSpace&&n.colorSpace!=="rgb"){const M=_p[n.colorSpace];T=(R,D)=>M.reverse(M.interpolate(M.forward(R),M.forward(D),f))}return typeof y.evaluate=="function"?{evaluate(...M){const R=y.evaluate.apply(void 0,M),D=x.evaluate.apply(void 0,M);if(R!==void 0&&D!==void 0)return T(R,D,f)}}:T(y,x,f)}function wp(n,e,i){return e.type==="color"?i=Cn.parse(i):e.type==="formatted"?i=La.fromString(i.toString()):e.type==="resolvedImage"?i=qa.build(i.toString()):Li(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),ac(i,n.default,e.default)}va.register(al,{error:[{kind:"error"},[qn],(n,[e])=>{throw new ei(e.evaluate(n))}],typeof:[qn,[On],(n,[e])=>ia(Br(e.evaluate(n)))],"to-rgba":[Ha(di,4),[ao],(n,[e])=>e.evaluate(n).toRenderColor(null).toArray()],"to-hsla":[Ha(di,4),[ao],(n,[e])=>e.evaluate(n).toRenderColor(null).toHslaArray()],rgb:[ao,[di,di,di],bp],rgba:[ao,[di,di,di,di],bp],hsl:[ao,[di,di,di],oh],hsla:[ao,[di,di,di,di],oh],has:{type:kn,overloads:[[[qn],(n,[e])=>pf(e.evaluate(n),n.properties())],[[qn,_l],(n,[e,i])=>pf(e.evaluate(n),i.evaluate(n))]]},get:{type:On,overloads:[[[qn],(n,[e])=>sd(e.evaluate(n),n.properties())],[[qn,_l],(n,[e,i])=>sd(e.evaluate(n),i.evaluate(n))]]},"feature-state":[On,[qn],(n,[e])=>sd(e.evaluate(n),n.featureState||{})],properties:[_l,[],n=>n.properties()],"geometry-type":[qn,[],n=>n.geometryType()],id:[On,[],n=>n.id()],zoom:[di,[],n=>n.globals.zoom],pitch:[di,[],n=>n.globals.pitch||0],"distance-from-center":[di,[],n=>n.distanceFromCenter()],"measure-light":[di,[qn],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[di,[],n=>n.globals.heatmapDensity||0],"line-progress":[di,[],n=>n.globals.lineProgress||0],"raster-value":[di,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[di,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[di,[],n=>n.globals.skyRadialProgress||0],accumulated:[On,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[di,uo(di),(n,e)=>{let i=0;for(const o of e)i+=o.evaluate(n);return i}],"*":[di,uo(di),(n,e)=>{let i=1;for(const o of e)i*=o.evaluate(n);return i}],"-":{type:di,overloads:[[[di,di],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[di],(n,[e])=>-e.evaluate(n)]]},"/":[di,[di,di],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[di,[di,di],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[di,[],()=>Math.LN2],pi:[di,[],()=>Math.PI],e:[di,[],()=>Math.E],"^":[di,[di,di],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[di,[di],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[di,[di],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[di,[di],(n,[e])=>Math.log(e.evaluate(n))],log2:[di,[di],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[di,[di],(n,[e])=>Math.sin(e.evaluate(n))],cos:[di,[di],(n,[e])=>Math.cos(e.evaluate(n))],tan:[di,[di],(n,[e])=>Math.tan(e.evaluate(n))],asin:[di,[di],(n,[e])=>Math.asin(e.evaluate(n))],acos:[di,[di],(n,[e])=>Math.acos(e.evaluate(n))],atan:[di,[di],(n,[e])=>Math.atan(e.evaluate(n))],min:[di,uo(di),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[di,uo(di),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[di,[di],(n,[e])=>Math.abs(e.evaluate(n))],round:[di,[di],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[di,[di],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[di,[di],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[kn,[qn,On],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[kn,[On],(n,[e])=>n.id()===e.value],"filter-type-==":[kn,[qn],(n,[e])=>n.geometryType()===e.value],"filter-<":[kn,[qn,On],(n,[e,i])=>{const o=n.properties()[e.value],l=i.value;return typeof o==typeof l&&o<l}],"filter-id-<":[kn,[On],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[kn,[qn,On],(n,[e,i])=>{const o=n.properties()[e.value],l=i.value;return typeof o==typeof l&&o>l}],"filter-id->":[kn,[On],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[kn,[qn,On],(n,[e,i])=>{const o=n.properties()[e.value],l=i.value;return typeof o==typeof l&&o<=l}],"filter-id-<=":[kn,[On],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[kn,[qn,On],(n,[e,i])=>{const o=n.properties()[e.value],l=i.value;return typeof o==typeof l&&o>=l}],"filter-id->=":[kn,[On],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[kn,[On],(n,[e])=>e.value in n.properties()],"filter-has-id":[kn,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[kn,[Ha(qn)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[kn,[Ha(On)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[kn,[qn,Ha(On)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[kn,[qn,Ha(On)],(n,[e,i])=>function(o,l,d,f){for(;d<=f;){const y=d+f>>1;if(l[y]===o)return!0;l[y]>o?f=y-1:d=y+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:kn,overloads:[[[kn,kn],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[uo(kn),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:kn,overloads:[[[kn,kn],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[uo(kn),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[kn,[kn],(n,[e])=>!e.evaluate(n)],"is-supported-script":[kn,[qn],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[qn,[qn],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[qn,[qn],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[qn,uo(On),(n,e)=>e.map(i=>$a(i.evaluate(n))).join("")],"resolved-locale":[qn,[Vc],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[di,[di,di,On],(n,e)=>{const[i,o,l]=e.map(f=>f.evaluate(n));if(i>o||i===o)return i;let d;if(typeof l=="string")d=function(f){let y=0;if(f.length===0)return y;for(let x=0;x<f.length;x++)y=(y<<5)-y+f.charCodeAt(x),y|=0;return y}(l);else{if(typeof l!="number")throw new ei(`Invalid seed input: ${l}`);d=l}return i+xp(d)()*(o-i)}]});class ud{constructor(e,i,o,l){this.expression=e,this._warningHistory={},this._evaluator=new $u(o,l),this._defaultValue=i?function(d){return d.type==="color"&&(rc(d.default)||Array.isArray(d.default))?new Cn(0,0,0,0):d.type==="color"?Cn.parse(d.default)||null:d.default===void 0?null:d.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=Aa(e)}evaluateWithoutErrorHandling(e,i,o,l,d,f,y,x){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=l||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,l,d,f,y,x){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=x||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new ei(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${T.message}`)),this._defaultValue}}}function Us(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in al}function Nn(n,e,i,o){const l=new Ns(al,[],e?function(f){const y={color:ao,string:qn,number:di,enum:qn,boolean:kn,formatted:Gh,resolvedImage:Hh};return f.type==="array"?Ha(y[f.value]||On,f.length):y[f.type]}(e):void 0,void 0,void 0,i,o),d=l.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?mf(new ud(d,e,i,o)):ho(l.errors)}class yr{constructor(e,i,o,l){this.kind=e,this._styleExpression=i,this.isLightConstant=o,this.isLineProgressConstant=l,this.isStateDependent=e!=="constant"&&!Yu(i.expression),this.configDependencies=Aa(i.expression)}evaluateWithoutErrorHandling(e,i,o,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,l,d,f)}evaluate(e,i,o,l,d,f){return this._styleExpression.evaluate(e,i,o,l,d,f)}}class Yr{constructor(e,i,o,l,d,f){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Yu(i.expression),this.isLightConstant=d,this.isLineProgressConstant=f,this.configDependencies=Aa(i.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,i,o,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,l,d,f)}evaluate(e,i,o,l,d,f){return this._styleExpression.evaluate(e,i,o,l,d,f)}interpolationFactor(e,i,o){return this.interpolationType?co.interpolationFactor(this.interpolationType,e,i,o):0}}function oc(n,e,i,o){if((n=Nn(n,e,i,o)).result==="error")return n;const l=n.value.expression,d=eu(l);if(!d&&!js(e))return ho([new os("","data expressions not supported")]);const f=Fr(l,["zoom","pitch","distance-from-center"]);if(!f&&!ld(e))return ho([new os("","zoom expressions not supported")]);const y=Fr(l,["measure-light"]);if(!y&&!sh(e))return ho([new os("","measure-light expression not supported")]);const x=Fr(l,["line-progress"]);if(!x&&!function(R){return ol(R.expression,"line-progress")}(e))return ho([new os("","line-progress expression not supported")]);const T=e.expression&&e.expression.relaxZoomRestriction,M=cl(l);return M||f||T?M instanceof os?ho([M]):M instanceof co&&!lh(e)?ho([new os("",'"interpolate" expressions cannot be used with this property')]):mf(M?new Yr(d&&x?"camera":"composite",n.value,M.labels,M instanceof co?M.interpolation:void 0,y,x):new yr(d&&x?"constant":"source",n.value,y,x)):ho([new os("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ll{constructor(e,i){this._parameters=e,this._specification=i,Vh(this,cd(this._parameters,this._specification))}static deserialize(e){return new ll(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function cl(n){let e=null;if(n instanceof ca)e=cl(n.result);else if(n instanceof ff){for(const i of n.args)if(e=cl(i),e)break}else(n instanceof Ku||n instanceof co)&&n.input instanceof va&&n.input.name==="zoom"&&(e=n);return e instanceof os||n.eachChild(i=>{const o=cl(i);o instanceof os?e=o:e&&o&&e!==o&&(e=new os("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var uh,sc,lc=function(){if(sc)return uh;sc=1,uh=e;var n=3;function e(i,o,l){var d=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var f=new Int32Array(this.arrayBuffer);i=f[0],this.d=(o=f[1])+2*(l=f[2]);for(var y=0;y<this.d*this.d;y++){var x=f[n+y],T=f[n+y+1];d.push(x===T?null:f.subarray(x,T))}var M=f[n+d.length+1];this.keys=f.subarray(f[n+d.length],M),this.bboxes=f.subarray(M),this.insert=this._insertReadonly}else{this.d=o+2*l;for(var R=0;R<this.d*this.d;R++)d.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=i,this.padding=l,this.scale=o/i,this.uid=0;var D=l/o*i;this.min=-D,this.max=i+D}return e.prototype.insert=function(i,o,l,d,f){this._forEachCell(o,l,d,f,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(f)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,o,l,d,f,y){this.cells[f].push(y)},e.prototype.query=function(i,o,l,d,f){var y=this.min,x=this.max;if(i<=y&&o<=y&&x<=l&&x<=d&&!f)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(i,o,l,d,this._queryCell,T,{},f),T},e.prototype._queryCell=function(i,o,l,d,f,y,x,T){var M=this.cells[f];if(M!==null)for(var R=this.keys,D=this.bboxes,B=0;B<M.length;B++){var F=M[B];if(x[F]===void 0){var q=4*F;(T?T(D[q+0],D[q+1],D[q+2],D[q+3]):i<=D[q+2]&&o<=D[q+3]&&l>=D[q+0]&&d>=D[q+1])?(x[F]=!0,y.push(R[F])):x[F]=!1}}},e.prototype._forEachCell=function(i,o,l,d,f,y,x,T){for(var M=this._convertToCellCoord(i),R=this._convertToCellCoord(o),D=this._convertToCellCoord(l),B=this._convertToCellCoord(d),F=M;F<=D;F++)for(var q=R;q<=B;q++){var J=this.d*q+F;if((!T||T(this._convertFromCellCoord(F),this._convertFromCellCoord(q),this._convertFromCellCoord(F+1),this._convertFromCellCoord(q+1)))&&f.call(this,i,o,l,d,J,y,x,T))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,o=n+this.cells.length+1+1,l=0,d=0;d<this.cells.length;d++)l+=this.cells[d].length;var f=new Int32Array(o+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var y=o,x=0;x<i.length;x++){var T=i[x];f[n+x]=y,f.set(T,y),y+=T.length}return f[n+i.length]=y,f.set(this.keys,y),f[n+i.length+1]=y+=this.keys.length,f.set(this.bboxes,y),y+=this.bboxes.length,f.buffer},uh}(),hh=ro(lc);const Kr={};function Wt(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writable:!1}),Kr[e]={klass:n,omit:i.omit||[]}}Wt(Object,"Object"),hh.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.add(i),{buffer:i}},hh.deserialize=function(n){return new hh(n.buffer)},Object.defineProperty(hh,"name",{value:"Grid"}),Wt(hh,"Grid"),typeof DOMMatrix<"u"&&Wt(DOMMatrix,"DOMMatrix"),Wt(Cn,"Color"),Wt(Error,"Error"),Wt(La,"Formatted"),Wt(nf,"FormattedSection"),Wt(Nh,"AJAXError"),Wt(qa,"ResolvedImage"),Wt(ll,"StylePropertyFunction"),Wt(ud,"StyleExpression",{omit:["_evaluator"]}),Wt(Co,"ImageId"),Wt(ls,"ImageVariant"),Wt(Yr,"ZoomDependentExpression"),Wt(yr,"ZoomConstantExpression"),Wt(va,"CompoundExpression",{omit:["_evaluate"]});for(const n in al)Kr[al[n]._classRegistryKey]||Wt(al[n],`Expression${n}`);function su(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function cc(n){return self.ImageBitmap&&n instanceof ImageBitmap}function Cl(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(su(n)||cc(n))return e&&e.add(n),n;if(ArrayBuffer.isView(n))return e&&e.add(n.buffer),n;if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const o of n)i.push(Cl(o,e));return i}if(n instanceof Map){const i={$name:"Map",entries:[]};for(const[o,l]of n.entries())i.entries.push(Cl(o),Cl(l,e));return i}if(n instanceof Set){const i={$name:"Set"};let o=0;for(const l of n.values())i[++o]=Cl(l);return i}if(n instanceof DOMMatrix){const i={$name:"DOMMatrix"},o=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const l of o)i[l]=n[l];return i}if(typeof n=="bigint")return{$name:"BigInt",value:n.toString()};if(typeof n=="object"){const i=n.constructor,o=i._classRegistryKey;if(!o)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const l=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const d in n)n.hasOwnProperty(d)&&(Kr[o].omit.indexOf(d)>=0||(l[d]=Cl(n[d],e)));n instanceof Error&&(l.message=n.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(l.$name=o),l}throw new Error("can't serialize object of type "+typeof n)}function uc(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||su(n)||cc(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(uc);if(typeof n=="object"){const e=n.$name||"Object";if(e==="Map"){const l=n.entries||[],d=new Map;for(let f=0;f<l.length;f+=2)d.set(uc(l[f]),uc(l[f+1]));return d}if(e==="Set"){const l=new Set;for(const d of Object.keys(n))d!=="$name"&&l.add(uc(n[d]));return l}if(e==="DOMMatrix"){let l;return l=n.is2D?[n.a,n.b,n.c,n.d,n.e,n.f]:[n.m11,n.m12,n.m13,n.m14,n.m21,n.m22,n.m23,n.m24,n.m31,n.m32,n.m33,n.m34,n.m41,n.m42,n.m43,n.m44],new DOMMatrix(l)}if(e==="BigInt")return BigInt(n.value);const{klass:i}=Kr[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(n);const o=Object.create(i.prototype);for(const l of Object.keys(n))l!=="$name"&&(o[l]=uc(n[l]));return o}throw new Error("can't deserialize object of type "+typeof n)}const Si={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,Osage:n=>n>=66736&&n<=66815,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function hd(n){for(const e of n)if(na(e.charCodeAt(0)))return!0;return!1}function Tp(n){for(const e of n)if(!fo(e.charCodeAt(0)))return!1;return!0}function fo(n){return!(Si.Arabic(n)||Si["Arabic Supplement"](n)||Si["Arabic Extended-A"](n)||Si["Arabic Presentation Forms-A"](n)||Si["Arabic Presentation Forms-B"](n))}function na(n){return!(n!==746&&n!==747&&(n<4352||!(Si["Bopomofo Extended"](n)||Si.Bopomofo(n)||Si["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Si["CJK Compatibility Ideographs"](n)||Si["CJK Compatibility"](n)||Si["CJK Radicals Supplement"](n)||Si["CJK Strokes"](n)||!(!Si["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Si["CJK Unified Ideographs Extension A"](n)||Si["CJK Unified Ideographs"](n)||Si["Enclosed CJK Letters and Months"](n)||Si["Hangul Compatibility Jamo"](n)||Si["Hangul Jamo Extended-A"](n)||Si["Hangul Jamo Extended-B"](n)||Si["Hangul Jamo"](n)||Si["Hangul Syllables"](n)||Si.Hiragana(n)||Si["Ideographic Description Characters"](n)||Si.Kanbun(n)||Si["Kangxi Radicals"](n)||Si["Katakana Phonetic Extensions"](n)||Si.Katakana(n)&&n!==12540||!(!Si["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Si["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Si["Unified Canadian Aboriginal Syllabics"](n)||Si["Unified Canadian Aboriginal Syllabics Extended"](n)||Si["Vertical Forms"](n)||Si["Yijing Hexagram Symbols"](n)||Si["Yi Syllables"](n)||Si["Yi Radicals"](n))))}function _f(n){return!(na(n)||function(e){return!!(Si["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Si["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Si["Letterlike Symbols"](e)||Si["Number Forms"](e)||Si["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Si["Control Pictures"](e)&&e!==9251||Si["Optical Character Recognition"](e)||Si["Enclosed Alphanumerics"](e)||Si["Geometric Shapes"](e)||Si["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Si["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Si["CJK Symbols and Punctuation"](e)||Si.Katakana(e)||Si["Private Use Area"](e)||Si["CJK Compatibility Forms"](e)||Si["Small Form Variants"](e)||Si["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function dd(n){return Si.Arabic(n)||Si["Arabic Supplement"](n)||Si["Arabic Extended-A"](n)||Si["Arabic Presentation Forms-A"](n)||Si["Arabic Presentation Forms-B"](n)}function fd(n){return n>=1424&&n<=2303||Si["Arabic Presentation Forms-A"](n)||Si["Arabic Presentation Forms-B"](n)}function Sp(n,e){return!(!e&&fd(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Si.Khmer(n))}function Rl(n){for(const e of n)if(fd(e.charCodeAt(0)))return!0;return!1}const dh="deferred",pd="loading",md="loaded";let yf=null,po="unavailable",Il=null;const hc=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(po="error"),yf&&yf(n)};function gd(){_d.fire(new tl("pluginStateChange",{pluginStatus:po,pluginURL:Il}))}const _d=new Yl,dc=function(){return po},Ep=function(){if(po!==dh||!Il)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");po=pd,gd(),Il&&Xl({url:Il},n=>{n?hc(n):(po=md,gd())})},fs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>po===md||fs.applyArabicShaping!=null,isLoading:()=>po===pd,setState(n){po=n.pluginStatus,Il=n.pluginURL},isParsed:()=>fs.applyArabicShaping!=null&&fs.processBidirectionalText!=null&&fs.processStyledBidirectionalText!=null,getPluginURL:()=>Il};class Fn{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,o){for(const l of i)if(!Sp(l.charCodeAt(0),o))return!1;return!0}(e,fs.isLoaded())}}class fh{constructor(e,i,o,l){this.property=e,this.value=i,this.expression=function(d,f,y,x){if(rc(d))return new ll(d,f);if(Us(d)||Array.isArray(d)&&d.length>0){const T=oc(d,f,y,x);if(T.result==="error")throw new Error(T.value.map(M=>`${M.key}: ${M.message}`).join(", "));return T.value}{let T=d;return typeof d=="string"&&f.type==="color"&&(T=Cn.parse(d)),{kind:"constant",configDependencies:new Set,evaluate:()=>T}}}(i===void 0?e.specification.default:i,e.specification,o,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class Dl{constructor(e,i,o){this.property=e,this.value=new fh(e,void 0,i,o)}transitioned(e,i){return new Ap(this.property,this.value,i,Ve({},e.transition,this.transition),e.now)}untransitioned(){return new Ap(this.property,this.value,null,{},0)}}class vf{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return Gi(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Dl(this._values[e].property,this._scope,this._options)),this._values[e].value=new fh(this._values[e].property,i===null?void 0:Gi(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const o=this._properties.properties;if(e)for(const l in e){const d=e[l];if(l.endsWith("-transition")){const f=l.slice(0,-11);o[f]&&this.setTransition(f,d)}else o.hasOwnProperty(l)&&this.setValue(l,d)}}getTransition(e){return Gi(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Dl(this._values[e].property)),this._values[e].transition=Gi(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const l=this.getTransition(i);l!==void 0&&(e[`${i}-transition`]=l)}return e}transitioned(e,i){const o=new Mp(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].transitioned(e,i._values[l]);return o}untransitioned(){const e=new Mp(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Ap{constructor(e,i,o,l,d){const f=l.delay||0,y=l.duration||0;d=d||0,this.property=e,this.value=i,this.begin=d+f,this.end=this.begin+y,e.specification.transition&&(l.delay||l.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const l=e.now||0,d=this.value.possiblyEvaluate(e,i,o),f=this.prior;if(f){if(l>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(l<this.begin)return f.possiblyEvaluate(e,i,o);{const y=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,i,o),d,ye(y))}}return d}}class Mp{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const l=new fc(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(e,i,o);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Nm{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return Gi(this._values[e].value)}setValue(e,i){this._values[e]=new fh(this._values[e].property,i===null?void 0:Gi(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const l=new fc(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(e,i,o);return l}}class lu{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,l){return this.property.evaluate(this.value,this.parameters,e,i,o,l)}}class fc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Nt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){const l=Uh[this.specification.type];return l?l(e,i,o):e}}class Xt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,l){return new lu(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,l)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new lu(this,{kind:"constant",value:void 0},e.parameters);const l=Uh[this.specification.type];return l?new lu(this,{kind:"constant",value:l(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,l,d,f){return e.kind==="constant"?e.value:e.evaluate(i,o,l,d,f)}}class ps{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,l){return!!e.expression.evaluate(i,null,{},o,l)}interpolate(){return!1}}class wr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Fn(0,{});for(const o in e){const l=e[o];l.specification.overridable&&this.overridableProperties.push(o);const d=this.defaultPropertyValues[o]=new fh(l,void 0),f=this.defaultTransitionablePropertyValues[o]=new Dl(l);this.defaultTransitioningPropertyValues[o]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=d.possiblyEvaluate(i)}}}Wt(Xt,"DataDrivenProperty"),Wt(Nt,"DataConstantProperty"),Wt(ps,"ColorRampProperty");var We=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white"},"sky-atmosphere-color":{"type":"color","default":"white"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Oo(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function pc(n){if(Array.isArray(n))return n.map(pc);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=pc(n[i]);return e}return Oo(n)}function yd(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!yd(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function xf(n,e="",i=null,o="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};yd(n)||(n=vd(n));const l=n;let d=!0;try{d=function(M){if(!cu(M))return M;let R=pc(M);return Rp(R),R=Cp(R),R}(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(l,null,2)}
        `)}let f=null,y=null;if(o!=="background"&&o!=="sky"&&o!=="slot"){y=We[`filter_${o}`];const M=Nn(d,y,e,i);if(M.result==="error")throw new Error(M.value.map(R=>`${R.key}: ${R.message}`).join(", "));f=(R,D,B)=>M.value.evaluate(R,D,{},B)}let x=null,T=null;if(d!==l){const M=Nn(l,y,e,i);if(M.result==="error")throw new Error(M.value.map(R=>`${R.key}: ${R.message}`).join(", "));x=(R,D,B,F,q)=>M.value.evaluate(R,D,{},B,void 0,void 0,F,q),T=!eu(M.value.expression)}return{filter:f,dynamicFilter:x||void 0,needGeometry:Dp(d),needFeature:!!T}}function Cp(n){if(!Array.isArray(n))return n;const e=function(i){if(Bm.has(i[0])){for(let o=1;o<i.length;o++)if(cu(i[o]))return!0}return i}(n);return e===!0?e:e.map(i=>Cp(i))}function Rp(n){let e=!1;const i=[];if(n[0]==="case"){for(let o=1;o<n.length-1;o+=2)e=e||cu(n[o]),i.push(n[o+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||cu(n[1]);for(let o=2;o<n.length-1;o+=2)i.push(n[o+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||cu(n[1]);for(let o=1;o<n.length-1;o+=2)i.push(n[o+1])}e&&(n.length=0,n.push("any",...i));for(let o=1;o<n.length;o++)Rp(n[o])}function cu(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(cu(n[i]))return!0;return!1}const Bm=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ip(n,e){return n<e?-1:n>e?1:0}function Dp(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(Dp(n[e]))return!0;return!1}function vd(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?xd(n[1],n[2],"=="):e==="!="?wf(xd(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?xd(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(vd))):e==="all"?["all"].concat(n.slice(1).map(vd)):e==="none"?["all"].concat(n.slice(1).map(vd).map(wf)):e==="in"?bf(n[1],n.slice(2)):e==="!in"?wf(bf(n[1],n.slice(2))):e==="has"?zp(n[1]):e!=="!has"||wf(zp(n[1]));var i}function xd(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function bf(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Ip)]]:["filter-in-small",n,["literal",e]]}}function zp(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function wf(n){return["!",n]}const uu="";function mc(n,e){return e?`${n}${uu}${e}`:n}const Tf="-transition",ul=new Set(["fill","line","background","hillshade","raster"]);class ka extends Yl{constructor(e,i,o,l,d){if(super(),this.id=e.id,this.fqid=mc(this.id,o),this.type=e.type,this.scope=o,this.lut=l,this.options=d,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const f=Nn(this.filter,We[`filter_${e.type}`]);f.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...f.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new Nm(i.layout,this.scope,d),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new vf(i.paint,this.scope,d);for(const f in e.paint)this.setPaintProperty(f,e.paint[f]);for(const f in e.layout)this.setLayoutProperty(f,e.layout[f]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fc(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&ul.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Tf)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const o=this._transitionablePaint,l=o._properties.properties;if(e.endsWith(Tf)){const R=e.slice(0,-11);return l[R]&&o.setTransition(R,i||void 0),!1}if(!l[e])return!1;const d=o._values[e],f=d.value.isDataDriven(),y=d.value;o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const x=o._values[e].value,T=x.isDataDriven(),M=e.endsWith("pattern")||e==="line-dasharray";return T||f||M||this._handleOverridablePaintPropertyUpdate(e,y,x)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,o){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return gi({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof lu&&js(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=xf(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,o,l,d,f,y,x,T){}}const Fm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class bd{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class hr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function bn(n,e=1){let i=0,o=0;return{members:n.map(l=>{const d=Fm[l.type].BYTES_PER_ELEMENT,f=i=hu(i,Math.max(e,d)),y=l.components||1;return o=Math.max(o,d),i+=d*y,{name:l.name,type:l.type,components:y,offset:f}}),size:hu(i,Math.max(o,e)),alignment:e}}function hu(n,e){return Math.ceil(n/e)*e}class Vs extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const l=2*e;return this.int16[l+0]=i,this.int16[l+1]=o,e}}Vs.prototype.bytesPerElement=4,Wt(Vs,"StructArrayLayout2i4");class du extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o)}emplace(e,i,o,l){const d=3*e;return this.int16[d+0]=i,this.int16[d+1]=o,this.int16[d+2]=l,e}}du.prototype.bytesPerElement=6,Wt(du,"StructArrayLayout3i6");class gc extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,l)}emplace(e,i,o,l,d){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=l,this.int16[f+3]=d,e}}gc.prototype.bytesPerElement=8,Wt(gc,"StructArrayLayout4i8");class fu extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}fu.prototype.bytesPerElement=4,Wt(fu,"StructArrayLayout1f4");class pu extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o)}emplace(e,i,o,l){const d=4*e,f=2*e;return this.int16[d+0]=i,this.int16[d+1]=o,this.float32[f+1]=l,e}}pu.prototype.bytesPerElement=8,Wt(pu,"StructArrayLayout2i1f8");class mu extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o)}emplace(e,i,o,l){const d=4*e;return this.int16[d+0]=i,this.int16[d+1]=o,this.int16[d+2]=l,e}}mu.prototype.bytesPerElement=8,Wt(mu,"StructArrayLayout3i8");class Sf extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,l,d)}emplace(e,i,o,l,d,f){const y=5*e;return this.int16[y+0]=i,this.int16[y+1]=o,this.int16[y+2]=l,this.int16[y+3]=d,this.int16[y+4]=f,e}}Sf.prototype.bytesPerElement=10,Wt(Sf,"StructArrayLayout5i10");class Pp extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,l,d,f,y)}emplace(e,i,o,l,d,f,y,x){const T=6*e,M=12*e,R=3*e;return this.int16[T+0]=i,this.int16[T+1]=o,this.uint8[M+4]=l,this.uint8[M+5]=d,this.uint8[M+6]=f,this.uint8[M+7]=y,this.float32[R+2]=x,e}}Pp.prototype.bytesPerElement=12,Wt(Pp,"StructArrayLayout2i4ub1f12");class mo extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o)}emplace(e,i,o,l){const d=3*e;return this.float32[d+0]=i,this.float32[d+1]=o,this.float32[d+2]=l,e}}mo.prototype.bytesPerElement=12,Wt(mo,"StructArrayLayout3f12");class Wo extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,l,d)}emplace(e,i,o,l,d,f){const y=6*e,x=3*e;return this.uint16[y+0]=i,this.uint16[y+1]=o,this.uint16[y+2]=l,this.uint16[y+3]=d,this.float32[x+2]=f,e}}Wo.prototype.bytesPerElement=12,Wt(Wo,"StructArrayLayout4ui1f12");class gu extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,l)}emplace(e,i,o,l,d){const f=4*e;return this.uint16[f+0]=i,this.uint16[f+1]=o,this.uint16[f+2]=l,this.uint16[f+3]=d,e}}gu.prototype.bytesPerElement=8,Wt(gu,"StructArrayLayout4ui8");class Gs extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,l,d,f)}emplace(e,i,o,l,d,f,y){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=l,this.int16[x+3]=d,this.int16[x+4]=f,this.int16[x+5]=y,e}}Gs.prototype.bytesPerElement=12,Wt(Gs,"StructArrayLayout6i12");class zl extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,y,x,T,M,R,D){const B=this.length;return this.resize(B+1),this.emplace(B,e,i,o,l,d,f,y,x,T,M,R,D)}emplace(e,i,o,l,d,f,y,x,T,M,R,D,B){const F=12*e;return this.int16[F+0]=i,this.int16[F+1]=o,this.int16[F+2]=l,this.int16[F+3]=d,this.uint16[F+4]=f,this.uint16[F+5]=y,this.uint16[F+6]=x,this.uint16[F+7]=T,this.int16[F+8]=M,this.int16[F+9]=R,this.int16[F+10]=D,this.int16[F+11]=B,e}}zl.prototype.bytesPerElement=24,Wt(zl,"StructArrayLayout4i4ui4i24");class Xa extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,l,d,f)}emplace(e,i,o,l,d,f,y){const x=10*e,T=5*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=l,this.float32[T+2]=d,this.float32[T+3]=f,this.float32[T+4]=y,e}}Xa.prototype.bytesPerElement=20,Wt(Xa,"StructArrayLayout3i3f20");class Hs extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,l)}emplace(e,i,o,l,d){const f=4*e;return this.float32[f+0]=i,this.float32[f+1]=o,this.float32[f+2]=l,this.float32[f+3]=d,e}}Hs.prototype.bytesPerElement=16,Wt(Hs,"StructArrayLayout4f16");class _c extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}_c.prototype.bytesPerElement=4,Wt(_c,"StructArrayLayout1ul4");class Pl extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const l=2*e;return this.uint16[l+0]=i,this.uint16[l+1]=o,e}}Pl.prototype.bytesPerElement=4,Wt(Pl,"StructArrayLayout2ui4");class ko extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,y,x,T,M,R,D,B){const F=this.length;return this.resize(F+1),this.emplace(F,e,i,o,l,d,f,y,x,T,M,R,D,B)}emplace(e,i,o,l,d,f,y,x,T,M,R,D,B,F){const q=20*e,J=10*e;return this.int16[q+0]=i,this.int16[q+1]=o,this.int16[q+2]=l,this.int16[q+3]=d,this.int16[q+4]=f,this.float32[J+3]=y,this.float32[J+4]=x,this.float32[J+5]=T,this.float32[J+6]=M,this.int16[q+14]=R,this.uint32[J+8]=D,this.uint16[q+18]=B,this.uint16[q+19]=F,e}}ko.prototype.bytesPerElement=40,Wt(ko,"StructArrayLayout5i4f1i1ul2ui40");class Yo extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,l,d,f,y)}emplace(e,i,o,l,d,f,y,x){const T=8*e;return this.int16[T+0]=i,this.int16[T+1]=o,this.int16[T+2]=l,this.int16[T+4]=d,this.int16[T+5]=f,this.int16[T+6]=y,this.int16[T+7]=x,e}}Yo.prototype.bytesPerElement=16,Wt(Yo,"StructArrayLayout3i2i2i16");class ms extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,l,d)}emplace(e,i,o,l,d,f){const y=4*e,x=8*e;return this.float32[y+0]=i,this.float32[y+1]=o,this.float32[y+2]=l,this.int16[x+6]=d,this.int16[x+7]=f,e}}ms.prototype.bytesPerElement=16,Wt(ms,"StructArrayLayout2f1f2i16");class Ef extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,l,d,f)}emplace(e,i,o,l,d,f,y){const x=20*e,T=5*e;return this.uint8[x+0]=i,this.uint8[x+1]=o,this.float32[T+1]=l,this.float32[T+2]=d,this.float32[T+3]=f,this.float32[T+4]=y,e}}Ef.prototype.bytesPerElement=20,Wt(Ef,"StructArrayLayout2ub4f20");class Pr extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o)}emplace(e,i,o,l){const d=3*e;return this.uint16[d+0]=i,this.uint16[d+1]=o,this.uint16[d+2]=l,e}}Pr.prototype.bytesPerElement=6,Wt(Pr,"StructArrayLayout3ui6");class qs extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,y,x,T,M,R,D,B,F,q,J,te,he,ce,X,re){const ue=this.length;return this.resize(ue+1),this.emplace(ue,e,i,o,l,d,f,y,x,T,M,R,D,B,F,q,J,te,he,ce,X,re)}emplace(e,i,o,l,d,f,y,x,T,M,R,D,B,F,q,J,te,he,ce,X,re,ue){const _e=30*e,ze=15*e,Ne=60*e;return this.int16[_e+0]=i,this.int16[_e+1]=o,this.int16[_e+2]=l,this.float32[ze+2]=d,this.float32[ze+3]=f,this.uint16[_e+8]=y,this.uint16[_e+9]=x,this.uint32[ze+5]=T,this.uint32[ze+6]=M,this.uint32[ze+7]=R,this.uint16[_e+16]=D,this.uint16[_e+17]=B,this.uint16[_e+18]=F,this.float32[ze+10]=q,this.float32[ze+11]=J,this.uint8[Ne+48]=te,this.uint8[Ne+49]=he,this.uint8[Ne+50]=ce,this.uint32[ze+13]=X,this.int16[_e+28]=re,this.uint8[Ne+58]=ue,e}}qs.prototype.bytesPerElement=60,Wt(qs,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class fa extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,y,x,T,M,R,D,B,F,q,J,te,he,ce,X,re,ue,_e,ze,Ne,Ue,qe,ot,St,gt,xt,Rt,nt){const yt=this.length;return this.resize(yt+1),this.emplace(yt,e,i,o,l,d,f,y,x,T,M,R,D,B,F,q,J,te,he,ce,X,re,ue,_e,ze,Ne,Ue,qe,ot,St,gt,xt,Rt,nt)}emplace(e,i,o,l,d,f,y,x,T,M,R,D,B,F,q,J,te,he,ce,X,re,ue,_e,ze,Ne,Ue,qe,ot,St,gt,xt,Rt,nt,yt){const it=20*e,rt=40*e,Dt=80*e;return this.float32[it+0]=i,this.float32[it+1]=o,this.int16[rt+4]=l,this.int16[rt+5]=d,this.int16[rt+6]=f,this.int16[rt+7]=y,this.int16[rt+8]=x,this.int16[rt+9]=T,this.int16[rt+10]=M,this.int16[rt+11]=R,this.int16[rt+12]=D,this.uint16[rt+13]=B,this.uint16[rt+14]=F,this.uint16[rt+15]=q,this.uint16[rt+16]=J,this.uint16[rt+17]=te,this.uint16[rt+18]=he,this.uint16[rt+19]=ce,this.uint16[rt+20]=X,this.uint16[rt+21]=re,this.uint16[rt+22]=ue,this.uint16[rt+23]=_e,this.uint16[rt+24]=ze,this.uint16[rt+25]=Ne,this.uint16[rt+26]=Ue,this.uint16[rt+27]=qe,this.uint32[it+14]=ot,this.float32[it+15]=St,this.float32[it+16]=gt,this.float32[it+17]=xt,this.float32[it+18]=Rt,this.uint8[Dt+76]=nt,this.uint16[rt+39]=yt,e}}fa.prototype.bytesPerElement=80,Wt(fa,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class $s extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,l,d)}emplace(e,i,o,l,d,f){const y=5*e;return this.float32[y+0]=i,this.float32[y+1]=o,this.float32[y+2]=l,this.float32[y+3]=d,this.float32[y+4]=f,e}}$s.prototype.bytesPerElement=20,Wt($s,"StructArrayLayout5f20");class _u extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,l,d,f,y)}emplace(e,i,o,l,d,f,y,x){const T=7*e;return this.float32[T+0]=i,this.float32[T+1]=o,this.float32[T+2]=l,this.float32[T+3]=d,this.float32[T+4]=f,this.float32[T+5]=y,this.float32[T+6]=x,e}}_u.prototype.bytesPerElement=28,Wt(_u,"StructArrayLayout7f28");class wd extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,y,x,T,M,R){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,o,l,d,f,y,x,T,M,R)}emplace(e,i,o,l,d,f,y,x,T,M,R,D){const B=11*e;return this.float32[B+0]=i,this.float32[B+1]=o,this.float32[B+2]=l,this.float32[B+3]=d,this.float32[B+4]=f,this.float32[B+5]=y,this.float32[B+6]=x,this.float32[B+7]=T,this.float32[B+8]=M,this.float32[B+9]=R,this.float32[B+10]=D,e}}wd.prototype.bytesPerElement=44,Wt(wd,"StructArrayLayout11f44");class Td extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,y,x,T){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,o,l,d,f,y,x,T)}emplace(e,i,o,l,d,f,y,x,T,M){const R=9*e;return this.float32[R+0]=i,this.float32[R+1]=o,this.float32[R+2]=l,this.float32[R+3]=d,this.float32[R+4]=f,this.float32[R+5]=y,this.float32[R+6]=x,this.float32[R+7]=T,this.float32[R+8]=M,e}}Td.prototype.bytesPerElement=36,Wt(Td,"StructArrayLayout9f36");class yc extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const l=2*e;return this.float32[l+0]=i,this.float32[l+1]=o,e}}yc.prototype.bytesPerElement=8,Wt(yc,"StructArrayLayout2f8");class Ll extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,l)}emplace(e,i,o,l,d){const f=6*e;return this.uint32[3*e+0]=i,this.uint16[f+2]=o,this.uint16[f+3]=l,this.uint16[f+4]=d,e}}Ll.prototype.bytesPerElement=12,Wt(Ll,"StructArrayLayout1ul3ui12");class vc extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}vc.prototype.bytesPerElement=2,Wt(vc,"StructArrayLayout1ui2");class yu extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,y,x,T,M,R,D,B,F,q,J){const te=this.length;return this.resize(te+1),this.emplace(te,e,i,o,l,d,f,y,x,T,M,R,D,B,F,q,J)}emplace(e,i,o,l,d,f,y,x,T,M,R,D,B,F,q,J,te){const he=16*e;return this.float32[he+0]=i,this.float32[he+1]=o,this.float32[he+2]=l,this.float32[he+3]=d,this.float32[he+4]=f,this.float32[he+5]=y,this.float32[he+6]=x,this.float32[he+7]=T,this.float32[he+8]=M,this.float32[he+9]=R,this.float32[he+10]=D,this.float32[he+11]=B,this.float32[he+12]=F,this.float32[he+13]=q,this.float32[he+14]=J,this.float32[he+15]=te,e}}yu.prototype.bytesPerElement=64,Wt(yu,"StructArrayLayout16f64");class ph extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,l,d,f,y)}emplace(e,i,o,l,d,f,y,x){const T=10*e,M=5*e;return this.uint16[T+0]=i,this.uint16[T+1]=o,this.uint16[T+2]=l,this.uint16[T+3]=d,this.float32[M+2]=f,this.float32[M+3]=y,this.float32[M+4]=x,e}}ph.prototype.bytesPerElement=20,Wt(ph,"StructArrayLayout4ui3f20");class Af extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Af.prototype.bytesPerElement=2,Wt(Af,"StructArrayLayout1i2");class vu extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}vu.prototype.bytesPerElement=1,Wt(vu,"StructArrayLayout1ub1");class Lp extends bd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Lp.prototype.size=40;class mh extends ko{get(e){return new Lp(this,e)}}Wt(mh,"CollisionBoxArray");class Op extends bd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Op.prototype.size=60;class kp extends qs{get(e){return new Op(this,e)}}Wt(kp,"PlacedSymbolArray");class jm extends bd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}jm.prototype.size=80;class Np extends fa{get(e){return new jm(this,e)}}Wt(Np,"SymbolInstanceArray");class ga extends fu{getoffsetX(e){return this.float32[1*e+0]}}Wt(ga,"GlyphOffsetArray");class Ma extends Vs{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Wt(Ma,"SymbolLineVertexArray");class Bp extends bd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Bp.prototype.size=12;class Fp extends Ll{get(e){return new Bp(this,e)}}Wt(Fp,"FeatureIndexArray");class jp extends Pl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Wt(jp,"FillExtrusionCentroidArray");class Up extends bd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Up.prototype.size=6;class Vp extends du{get(e){return new Up(this,e)}}Wt(Vp,"FillExtrusionWallArray");const Mf=bn([{name:"a_pos",components:2,type:"Int16"}],4),Gp=bn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class vr{constructor(e=[]){this.segments=e}_prepareSegment(e,i,o,l){let d=this.segments[this.segments.length-1];return e>vr.MAX_VERTEX_ARRAY_LENGTH&&Ui(`Max vertices per segment is ${vr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>vr.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==l)&&(d={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},l!==void 0&&(d.sortKey=l),this.segments.push(d)),d}prepareSegment(e,i,o,l){return this._prepareSegment(e,i.length,o.length,l)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,l){return new vr([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:l,vaos:{},sortKey:0}])}}function Hp(n,e){return 256*(n=Me(Math.floor(n),0,255))+Me(Math.floor(e),0,255)}vr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Wt(vr,"SegmentVector");const Um=bn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),xc=bn([{name:"a_pattern_b",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),qp=bn([{name:"a_dash",components:4,type:"Uint16"}]);class bc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,o,l){this.ids.push($p(e)),this.positions.push(i,o,l)}eachPosition(e,i){const o=$p(e);let l=0,d=this.ids.length-1;for(;l<d;){const f=l+d>>1;this.ids[f]>=o?d=f:l=f+1}for(;this.ids[l]===o;)i(this.positions[3*l],this.positions[3*l+1],this.positions[3*l+2]),l++}static serialize(e,i){const o=new Float64Array(e.ids),l=new Uint32Array(e.positions);return gh(o,l,0,o.length-1),i&&(i.add(o.buffer),i.add(l.buffer)),{ids:o,positions:l}}static deserialize(e){const i=new bc;let o;i.ids=e.ids,i.positions=e.positions;for(const l of i.ids)l!==o&&i.uniqueIds.push(l),o=l;return i.indexed=!0,i}}function $p(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Mo(String(n))}function gh(n,e,i,o){for(;i<o;){const l=n[i+o>>1];let d=i-1,f=o+1;for(;;){do d++;while(n[d]<l);do f--;while(n[f]>l);if(d>=f)break;wc(n,d,f),wc(e,3*d,3*f),wc(e,3*d+1,3*f+1),wc(e,3*d+2,3*f+2)}f-i<o-f?(gh(n,e,i,f),i=f+1):(gh(n,e,f+1,o),o=f)}}function wc(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}Wt(bc,"FeaturePositionMap");class gs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Sd extends gs{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class Lr extends gs{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class _s extends gs{constructor(e){super(e),this.current=[0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class Ko extends gs{constructor(e){super(e),this.current=[0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class _h extends gs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class Vm extends gs{constructor(e){super(e),this.current=Cn.transparent.toRenderColor(null)}set(e,i,o){this.fetchUniformLocation(e,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const Gm=new Float32Array(16);class Qo extends gs{constructor(e){super(e),this.current=Gm}set(e,i,o){if(this.fetchUniformLocation(e,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let l=1;l<16;l++)if(o[l]!==this.current[l]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}const Zp=new Float32Array(9),yh=new Float32Array(4);class Wa extends gs{constructor(e){super(e),this.current=yh}set(e,i,o){if(this.fetchUniformLocation(e,i)){for(let l=0;l<4;l++)if(o[l]!==this.current[l]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function jr(n){return[Hp(255*n.r,255*n.g),Hp(255*n.b,255*n.a)]}class Ed{constructor(e,i,o,l){this.value=e,this.uniformNames=i.map(d=>`u_${d}`),this.type=o,this.context=l}setUniform(e,i,o,l,d){const f=l.constantOr(this.value);i.set(e,d,f instanceof Cn?f.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):f)}getBinding(e,i){return this.type==="color"?new Vm(e):new Lr(e)}}class vh{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,o,l,d){let f=null;d!=="u_pattern"&&d!=="u_dash"||(f=this.pattern),d==="u_pattern_b"&&(f=this.patternTransition),d==="u_pixel_ratio"&&(f=this.pixelRatio),f&&i.set(e,d,f)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new _h(e):new Lr(e)}}class hl{constructor(e,i,o,l){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(d=>({name:`a_${d}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,i,o,l,d,f,y){const x=this.paintVertexArray.length,T=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Fn(0,{brightness:f}),i,{},d,l,y):this.expression.kind==="constant"&&this.expression.value,M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Fn(0,{brightness:f}),i,{},d,l,y):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(x,e,T,M?null:this.context.lut)}updatePaintArray(e,i,o,l,d,f,y){const x=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:y},o,l,void 0,d):this.expression.kind==="constant"&&this.expression.value,T=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Fn(0,{brightness:y}),o,l,void 0,d):this.lutExpression.value)==="none";this._setPaintValue(e,i,x,T?null:this.context.lut)}_setPaintValue(e,i,o,l){if(this.type==="color"){const d=jr(o.toRenderColor(l));for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,d[0],d[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class go{constructor(e,i,o,l,d,f){this.expression=e,this.uniformNames=i.map(y=>`u_${y}_t`),this.type=o,this.useIntegerZoom=l,this.context=d,this.maxValue=0,this.paintVertexAttributes=i.map(y=>({name:`a_${y}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,i,o,l,d,f,y){const x=this.expression.evaluate(new Fn(this.context.zoom,{brightness:f}),i,{},d,l,y),T=this.expression.evaluate(new Fn(this.context.zoom+1,{brightness:f}),i,{},d,l,y),M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Fn(0,{brightness:f}),i,{},d,l,y):this.lutExpression.value)==="none",R=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(R,e,x,T,M?null:this.context.lut)}updatePaintArray(e,i,o,l,d,f,y){const x=this.expression.evaluate({zoom:this.context.zoom,brightness:y},o,l,void 0,d),T=this.expression.evaluate({zoom:this.context.zoom+1,brightness:y},o,l,void 0,d),M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Fn(0,{brightness:y}),o,l,void 0,d):this.lutExpression.value)==="none";this._setPaintValue(e,i,x,T,M?null:this.context.lut)}_setPaintValue(e,i,o,l,d){if(this.type==="color"){const f=jr(o.toRenderColor(d)),y=jr(o.toRenderColor(d));for(let x=e;x<i;x++)this.paintVertexArray.emplace(x,f[0],f[1],y[0],y[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,o,l);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,o,l,d){const f=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,y=Me(this.expression.interpolationFactor(f,this.context.zoom,this.context.zoom+1),0,1);i.set(e,d,y)}getBinding(e,i){return new Lr(e)}}class Ca{constructor(e,i,o,l,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(o==="array"?qp:Um).members;for(let f=0;f<i.length;++f);this.paintVertexArray=new l,this.paintTransitionVertexArray=new Wo}populatePaintArray(e,i,o,l){const d=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(d,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,l,d,f,y){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],f)}_setPaintValues(e,i,o,l){if(!l||!o)return;const d=l[o[0]],f=l[o[1]];if(d){if(d){const{tl:y,br:x,pixelRatio:T}=d;for(let M=e;M<i;M++)this.paintVertexArray.emplace(M,y[0],y[1],x[0],x[1],T)}if(f){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:y,br:x,pixelRatio:T}=f;for(let M=e;M<i;M++)this.paintTransitionVertexArray.emplace(M,y[0],y[1],x[0],x[1],T)}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,xc.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Ol{constructor(e,i,o=()=>!0){this.binders={},this._buffers=[],this.context=i;const l=[];for(const d in e.paint._values){const f=e.paint.get(d);if(d.endsWith("-use-theme")||!o(d)||!(f instanceof lu&&js(f.property.specification)))continue;const y=t(d,e.type),x=f.value,T=f.property.specification.type,M=!!f.property.useIntegerZoom,R=d==="line-dasharray"||d.endsWith("pattern"),D=e.paint.get(`${d}-use-theme`),B=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||D&&D.value.kind!=="constant";if(x.kind!=="constant"||B)if(x.kind==="source"||B||R){const F=p(d,T,"source");this.binders[d]=R?new Ca(x,y,T,F,e.id):new hl(x,y,T,F),l.push(`/a_${d}`)}else{const F=p(d,T,"composite");this.binders[d]=new go(x,y,T,M,i,F),l.push(`/z_${d}`)}else this.binders[d]=R?new vh(x.value,y):new Ed(x.value,y,T,i),l.push(`/u_${d}`);D&&(this.binders[d].lutExpression=D.value)}this.cacheKey=l.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof hl||i instanceof go?i.maxValue:0}populatePaintArrays(e,i,o,l,d,f,y){for(const x in this.binders){const T=this.binders[x];T.context=this.context,(T instanceof hl||T instanceof go||T instanceof Ca)&&T.populatePaintArray(e,i,o,l,d,f,y)}}setConstantPatternPositions(e,i){for(const o in this.binders){const l=this.binders[o];l instanceof vh&&l.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof Ca?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,o,l,d,f,y,x,T){let M=!1;const R=Object.keys(e),D=R.length!==0&&!x,B=D?R:i.uniqueIds;this.context.lut=d.lut;for(const F in this.binders){const q=this.binders[F];if(q.context=this.context,(q instanceof hl||q instanceof go||q instanceof Ca)&&q.expression&&q.expression.kind&&q.expression.kind!=="constant"&&(q.expression.isStateDependent===!0||q.expression.isLightConstant===!1)){const J=d.paint.get(F);q.expression=J.value;for(const te of B){const he=e[te.toString()];i.eachPosition(te,(ce,X,re)=>{const ue=l.feature(ce);q.updatePaintArray(X,re,ue,he,f,y,T)})}if(!D)for(const te of o.uniqueIds){const he=e[te.toString()];o.eachPosition(te,(ce,X,re)=>{const ue=l.feature(ce);q.updatePaintArray(X,re,ue,he,f,y,T)})}M=!0}}return M}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof Ed||o instanceof vh)&&e.push(...o.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof hl||o instanceof go||o instanceof Ca)for(let l=0;l<o.paintVertexAttributes.length;l++)e.push(o.paintVertexAttributes[l].name);if(o instanceof Ca)for(let l=0;l<xc.members.length;l++)e.push(xc.members[l].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Ed||o instanceof vh||o instanceof go)for(const l of o.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof Ed||l instanceof vh||l instanceof go)for(const d of l.uniformNames)i.push({name:d,property:o,binding:l.getBinding(e,d)})}return i}setUniforms(e,i,o,l,d){for(const{name:f,property:y,binding:x}of o)this.binders[y].setUniform(e,x,d,l.get(y),f)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof hl||i instanceof go||i instanceof Ca)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof Ca&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof hl||o instanceof go||o instanceof Ca)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof hl||i instanceof go||i instanceof Ca)&&i.destroy()}}}class Tc{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new Ol(l,i,o);this.needsUpload=!1,this._featureMap=new bc,this._featureMapWithoutIds=new bc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,o,l,d,f,y,x){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,i,l,d,f,y,x);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,l,d,f,y){for(const x of o)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,x,l,d,f,y||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const c={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"]};function t(n,e){return c[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const a={"line-pattern":{source:Wo,composite:Wo},"fill-pattern":{source:Wo,composite:Wo},"fill-extrusion-pattern":{source:Wo,composite:Wo},"line-dasharray":{source:gu,composite:gu}},u={color:{source:yc,composite:Hs},number:{source:fu,composite:yc}};function p(n,e,i){const o=a[n];return o&&o[i]||u[e][i]}Wt(Ed,"ConstantBinder"),Wt(vh,"PatternConstantBinder"),Wt(hl,"SourceExpressionBinder"),Wt(Ca,"PatternCompositeBinder"),Wt(go,"CompositeExpressionBinder"),Wt(Ol,"ProgramConfiguration",{omit:["_buffers"]}),Wt(Tc,"ProgramConfigurationSet");const g=Ut/Math.PI/2,v=5,w=6,A=16383,I=64,z=[I,32,16],k=-g,O=g;function j(n,e,i,o=g){return i=V(i),[n*Math.sin(i)*o,-e*o,n*Math.cos(i)*o]}function Q(n,e,i){return j(Math.cos(V(n)),Math.sin(V(n)),e,i)}const Y=63710088e-1,ee=2*Math.PI*Y;class K{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new K(He(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,l=e.lat*i,d=Math.sin(o)*Math.sin(l)+Math.cos(o)*Math.cos(l)*Math.cos((e.lng-this.lng)*i);return Y*Math.acos(Math.min(d,1))}toBounds(e=0){const i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new se({lng:this.lng-o,lat:this.lat-i},{lng:this.lng+o,lat:this.lat+i})}toEcef(e){return Q(this.lat,this.lng,g+e*g/Y)}static convert(e){if(e instanceof K)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new K(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new K(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class se{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const o=e;this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]])}else{const o=e;this.setSouthWest(o[0]).setNorthEast(o[1])}}setNorthEast(e){return this._ne=e instanceof K?new K(e.lng,e.lat):K.convert(e),this}setSouthWest(e){return this._sw=e instanceof K?new K(e.lng,e.lat):K.convert(e),this}extend(e){const i=this._sw,o=this._ne;let l,d;if(e instanceof K)l=e,d=e;else{if(!(e instanceof se))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(se.convert(e)):this.extend(K.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(K.convert(e)):this;if(l=e._sw,d=e._ne,!l||!d)return this}return i||o?(i.lng=Math.min(l.lng,i.lng),i.lat=Math.min(l.lat,i.lat),o.lng=Math.max(d.lng,o.lng),o.lat=Math.max(d.lat,o.lat)):(this._sw=new K(l.lng,l.lat),this._ne=new K(d.lng,d.lat)),this}getCenter(){return new K((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new K(this.getWest(),this.getNorth())}getSouthEast(){return new K(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:o}=K.convert(e);let l=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&l}static convert(e){if(e)return e instanceof se?e:new se(e)}}const pe=0,ve=25.5;function Ae(n){return ee*Math.cos(n*Math.PI/180)}function Se(n){return(180+n)/360}function Te(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function ge(n,e){return n/Ae(e)}function Ce(n){return 360*n-180}function Le(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Qe(n,e){return n*Ae(Le(e))}const Ze=85.051129;function ht(n){return Math.cos(V(Me(n,-85.051129,Ze)))}function lt(n,e){const i=Me(e,pe,ve),o=Math.pow(2,i);return ht(n)*ee/(512*o)}function Ct(n){return 1/Math.cos(n*Math.PI/180)}function $e(n,e=0){const i=Math.exp(Math.PI*(1-(n.y+e/Ut)/(1<<n.z)*2));return 80150034*i/(i*i+1)/Ut/(1<<n.z)}class et{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=K.convert(e);return new et(Se(o.lng),Te(o.lat),ge(i,o.lat))}toLngLat(){return new K(Ce(this.x),Le(this.y))}toAltitude(){return Qe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ee*Ct(Le(this.y))}}function Ge(n,e,i,o,l,d,f,y,x){const T=(e+o)/2,M=(i+l)/2,R=new Bt(T,M);y(R),function(D,B,F,q,J,te){const he=F-J,ce=q-te;return Math.abs((q-B)*he-(F-D)*ce)/Math.hypot(he,ce)}(R.x,R.y,d.x,d.y,f.x,f.y)>=x?(Ge(n,e,i,T,M,d,R,y,x),Ge(n,T,M,o,l,R,f,y,x)):n.push(f)}function pt(n,e,i){let o=n[0],l=o.x,d=o.y;e(o);const f=[o];for(let y=1;y<n.length;y++){const x=n[y],{x:T,y:M}=x;e(x),Ge(f,l,d,T,M,o,x,e,i),l=T,d=M,o=x}return f}function tt(n,e,i,o){if(o(e,i)){const l=e.add(i)._mult(.5);tt(n,e,l,o),tt(n,l,i,o)}else n.push(i)}function bt(n,e){let i=n[0];const o=[i];for(let l=1;l<n.length;l++){const d=n[l];tt(o,i,d,e),i=d}return o}const dt=Math.pow(2,14)-1,wt=-dt-1;function At(n,e){const i=Math.round(n.x*e),o=Math.round(n.y*e);return n.x=Me(i,wt,dt),n.y=Me(o,wt,dt),(i<n.x||i>n.x+1||o<n.y||o>n.y+1)&&Ui("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Qt(n,e,i){const o=n.loadGeometry(),l=n.extent,d=Ut/l;if(e&&i&&i.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:y,x,y:T,projection:M}=i,R=D=>{const B=Ce((e.x+D.x/l)/f),F=Le((e.y+D.y/l)/f),q=M.project(B,F);D.x=(q.x*y-x)*l,D.y=(q.y*y-T)*l};for(let D=0;D<o.length;D++)if(n.type!==1)o[D]=pt(o[D],R,1);else{const B=[];for(const F of o[D])F.x<0||F.x>=l||F.y<0||F.y>=l||(R(F),B.push(F));o[D]=B}}for(const f of o)for(const y of f)At(y,d);return o}function ai(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Qt(n):[]}}function Yt(n,e,i,o,l){n.emplaceBack(2*e+(o+1)/2,2*i+(l+1)/2)}function ci(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class ii{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Vs,this.indexArray=new Pr,this.segments=new vr,this.programConfigurations=new Tc(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(e,i){}populate(e,i,o,l){const d=this.layers[0],f=[];let y=null;d.type==="circle"&&(y=d.layout.get("circle-sort-key"));for(const{feature:T,id:M,index:R,sourceLayerIndex:D}of e){const B=this.layers[0]._featureFilter.needGeometry,F=ai(T,B);if(!this.layers[0]._featureFilter.filter(new Fn(this.zoom),F,o))continue;const q=y?y.evaluate(F,{},o):void 0,J={id:M,properties:T.properties,type:T.type,sourceLayerIndex:D,index:R,geometry:B?F.geometry:Qt(T,o,l),patterns:{},sortKey:q};f.push(J)}y&&f.sort((T,M)=>T.sortKey-M.sortKey);let x=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new Gs,x=l.projection);for(const T of f){const{geometry:M,index:R,sourceLayerIndex:D}=T,B=e[R].feature;this.addFeature(T,M,R,i.availableImages,o,x,i.brightness),i.featureIndex.insert(B,M,R,D,this.index)}}update(e,i,o,l,d,f,y){this.programConfigurations.updatePaintArrays(e,i,d,o,l,f,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Mf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Gp.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,o,l,d,f,y){for(const x of i)for(const T of x){const M=T.x,R=T.y;if(M<0||M>=Ut||R<0||R>=Ut)continue;if(f){const F=f.projectTilePoint(M,R,d),q=f.upVector(d,M,R),J=this.globeExtVertexArray;ci(J,F,q),ci(J,F,q),ci(J,F,q),ci(J,F,q)}const D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),B=D.vertexLength;Yt(this.layoutVertexArray,M,R,-1,-1),Yt(this.layoutVertexArray,M,R,1,-1),Yt(this.layoutVertexArray,M,R,1,1),Yt(this.layoutVertexArray,M,R,-1,1),this.indexArray.emplaceBack(B,B+1,B+2),this.indexArray.emplaceBack(B,B+2,B+3),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},l,d,y)}}function Mi(n,e){for(let i=0;i<n.length;i++)if(wn(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(wn(n,e[i]))return!0;return!!zi(n,e)}function Ni(n,e,i){return!!wn(n,e)||!!Bi(e,n,i)}function Ai(n,e){if(n.length===1)return vn(e,n[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let l=0;l<o.length;l++)if(wn(n,o[l]))return!0}for(let i=0;i<n.length;i++)if(vn(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(zi(n,e[i]))return!0;return!1}function Hi(n,e,i){if(n.length>1){if(zi(n,e))return!0;for(let o=0;o<e.length;o++)if(Bi(e[o],n,i))return!0}for(let o=0;o<n.length;o++)if(Bi(n[o],e,i))return!0;return!1}function zi(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const o=n[i],l=n[i+1];for(let d=0;d<e.length-1;d++)if(wi(o,l,e[d],e[d+1]))return!0}return!1}function wi(n,e,i,o){return yn(n,i,o)!==yn(e,i,o)&&yn(n,e,i)!==yn(n,e,o)}function an(n,e,i){return(n.x-i.x)*(e.y-i.y)-(n.y-i.y)*(e.x-i.x)}function zn(n,e,i,o){const l=an(n,e,o),d=an(n,e,i);if(Math.sign(l)===Math.sign(d))return;const f=an(i,o,n),y=f+d-l;return Math.sign(f)!==Math.sign(y)?[f/(f-y),d/(d-l)]:void 0}function Bi(n,e,i){const o=i*i;if(e.length===1)return n.distSqr(e[0])<o;for(let l=1;l<e.length;l++)if(on(n,e[l-1],e[l])<o)return!0;return!1}function on(n,e,i){const o=e.distSqr(i);if(o===0)return n.distSqr(e);const l=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/o;return n.distSqr(l<0?e:l>1?i:i.sub(e)._mult(l)._add(e))}function vn(n,e){let i,o,l,d=!1;for(let f=0;f<n.length;f++){i=n[f];for(let y=0,x=i.length-1;y<i.length;x=y++)o=i[y],l=i[x],o.y>e.y!=l.y>e.y&&e.x<(l.x-o.x)*(e.y-o.y)/(l.y-o.y)+o.x&&(d=!d)}return d}function wn(n,e){let i=!1;for(let o=0,l=n.length-1;o<n.length;l=o++){const d=n[o],f=n[l];d.y>e.y!=f.y>e.y&&e.x<(f.x-d.x)*(e.y-d.y)/(f.y-d.y)+d.x&&(i=!i)}return i}function Pn(n,e,i,o,l){for(const f of n)if(e<=f.x&&i<=f.y&&o>=f.x&&l>=f.y)return!0;const d=[new Bt(e,i),new Bt(e,l),new Bt(o,l),new Bt(o,i)];if(n.length>2){for(const f of d)if(wn(n,f))return!0}for(let f=0;f<n.length-1;f++)if(er(n[f],n[f+1],d))return!0;return!1}function er(n,e,i){const o=i[0],l=i[2];if(n.x<o.x&&e.x<o.x||n.x>l.x&&e.x>l.x||n.y<o.y&&e.y<o.y||n.y>l.y&&e.y>l.y)return!1;const d=yn(n,e,i[0]);return d!==yn(n,e,i[1])||d!==yn(n,e,i[2])||d!==yn(n,e,i[3])}function Ar(n,e,i,o,l,d){let f=e.y-n.y,y=n.x-e.x;if(d=d||0){const x=f*f+y*y;if(x===0)return!0;const T=Math.sqrt(x);f/=T,y/=T}return!((i.x-n.x)*f+(i.y-n.y)*y-d<0||(o.x-n.x)*f+(o.y-n.y)*y-d<0||(l.x-n.x)*f+(l.y-n.y)*y-d<0)}function tr(n,e,i,o,l,d,f){return!(Ar(n,e,o,l,d,f)||Ar(e,i,o,l,d,f)||Ar(i,n,o,l,d,f)||Ar(o,l,n,e,i,f)||Ar(l,d,n,e,i,f)||Ar(d,o,n,e,i,f))}function ki(n,e,i){const o=e.paint.get(n).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(n)}function $n(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function mn(n,e,i,o,l){if(!e[0]&&!e[1])return n;const d=Bt.convert(e)._mult(l);i==="viewport"&&d._rotate(-o);const f=[];for(let y=0;y<n.length;y++)f.push(n[y].sub(d));return f}function Sn(n,e,i,o){const l=Bt.convert(n)._mult(o);return e==="viewport"&&l._rotate(-i),l}let En,ir;function ra(n,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[n*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}Wt(ii,"CircleBucket",{omit:["layers"]});class Zn{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=qr(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const o=function(d,f,y){var x=ra(256*d,256*(f=Math.pow(2,y)-f-1),y),T=ra(256*(d+1),256*(f+1),y);return x[0]+","+x[1]+","+T[0]+","+T[1]}(this.x,this.y,this.z),l=function(d,f,y){let x,T="";for(let M=d;M>0;M--)x=1<<M-1,T+=(f&x?1:0)+(y&x?2:0);return T}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ur{constructor(e,i){this.wrap=e,this.canonical=i,this.key=qr(e,i.z,i.z,i.x,i.y)}}class jn{constructor(e,i,o,l,d){this.overscaledZ=e,this.wrap=i,this.canonical=new Zn(o,+l,+d),this.key=i===0&&e===o?this.canonical.key:qr(i,e,o,l,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new jn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new jn(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return qr(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return qr(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new jn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,l=2*this.canonical.y;return[new jn(i,this.wrap,i,o,l),new jn(i,this.wrap,i,o+1,l),new jn(i,this.wrap,i,o,l+1),new jn(i,this.wrap,i,o+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new jn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new jn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ur(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function qr(n,e,i,o,l){const d=1<<Math.min(i,22);let f=d*(l%d)+o%d;return n&&i<22&&(f+=d*d*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*f+i)+(e-i)}const Ya=[n=>{let e=n.canonical.x-1,i=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,i--),new jn(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,i=n.wrap;return e===1<<n.canonical.z&&(e=0,i++),new jn(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>new jn(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(n.canonical.y===0?1<<n.canonical.z:n.canonical.y)-1),n=>new jn(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];Wt(Zn,"CanonicalTileID"),Wt(jn,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const No=bn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ka}=No,Bo=bn([{name:"a_pos_3",components:3,type:"Int16"}]);var Zs=bn([{name:"a_pos",type:"Int16",components:2}]);class Fo{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const l=Jn(i,this.dir);if(Math.abs(l)<1e-6)return!1;const d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/l;return o[0]=this.pos[0]+this.dir[0]*d,o[1]=this.pos[1]+this.dir[1]*d,!0}}class Jo{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const l=pi(i,this.dir);if(Math.abs(l)<1e-6)return!1;const d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/l;return o[0]=this.pos[0]+this.dir[0]*d,o[1]=this.pos[1]+this.dir[1]*d,o[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,i,o){if(function(B,F){var q=B[0],J=B[1],te=B[2],he=F[0],ce=F[1],X=F[2];return Math.abs(q-he)<=Z*Math.max(1,Math.abs(q),Math.abs(he))&&Math.abs(J-ce)<=Z*Math.max(1,Math.abs(J),Math.abs(ce))&&Math.abs(te-X)<=Z*Math.max(1,Math.abs(te),Math.abs(X))}(this.pos,e)||i===0)return o[0]=o[1]=o[2]=0,!1;const[l,d,f]=this.dir,y=this.pos[0]-e[0],x=this.pos[1]-e[1],T=this.pos[2]-e[2],M=l*l+d*d+f*f,R=2*(y*l+x*d+T*f),D=R*R-4*M*(y*y+x*x+T*T-i*i);if(D<0){const B=Math.max(-R/2,0),F=y+l*B,q=x+d*B,J=T+f*B,te=Math.hypot(F,q,J);return o[0]=F*i/te,o[1]=q*i/te,o[2]=J*i/te,!1}{const B=(-R-Math.sqrt(D))/(2*M);if(B<0){const F=Math.hypot(y,x,T);return o[0]=y*i/F,o[1]=x*i/F,o[2]=T*i/F,!1}return o[0]=y+l*B,o[1]=x+d*B,o[2]=T+f*B,!0}}}class Ra{constructor(e,i,o,l,d){this.TL=e,this.TR=i,this.BR=o,this.BL=l,this.horizon=d}static fromInvProjectionMatrix(e,i,o){const l=[-1,1,1],d=[1,1,1],f=[1,-1,1],y=[-1,-1,1],x=Vi(l,l,e),T=Vi(d,d,e),M=Vi(f,f,e),R=Vi(y,y,e);return new Ra(x,T,M,R,i/o)}}function Sc(n,e,i){let o=1/0,l=-1/0;const d=[];for(const f of n){Rn(d,f,e);const y=pi(d,i);o=Math.min(o,y),l=Math.max(l,y)}return[o,l]}function Qa(n,e){let i=!0;for(let o=0;o<n.planes.length;o++){const l=n.planes[o];let d=0;for(let f=0;f<e.length;f++)d+=pi(l,e[f])+l[3]>=0;if(d===0)return 0;d!==e.length&&(i=!1)}return i?2:1}function Ad(n,e){for(const i of n.projections){const o=Sc(e,n.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function Md(n,e){let i=0;const o=[0,0,0,0];for(let f=0;f<n.length;f++)o[0]=n[f][0],o[1]=n[f][1],o[2]=n[f][2],o[3]=1,(l=o)[0]*(d=e)[0]+l[1]*d[1]+l[2]*d[2]+l[3]*d[3]>=0&&i++;var l,d;return i}class Cd{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Un.fromPoints(this.points),this.projections=[],this.frustumEdges=[Rn([],this.points[2],this.points[3]),Rn([],this.points[0],this.points[3]),Rn([],this.points[4],this.points[0]),Rn([],this.points[5],this.points[1]),Rn([],this.points[6],this.points[2]),Rn([],this.points[7],this.points[3])];for(const o of this.frustumEdges){const l=[0,-o[2],o[1]],d=[o[2],0,-o[0]];this.projections.push({axis:l,projection:Sc(this.points,this.points[0],l)}),this.projections.push({axis:d,projection:Sc(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(e,i,o,l){const d=Math.pow(2,o),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const M=la([],T,e),R=1/M[3]/i*d;return(D=M)[0]=(B=M)[0]*(F=[R,R,l?1/M[3]:R,R])[0],D[1]=B[1]*F[1],D[2]=B[2]*F[2],D[3]=B[3]*F[3],D;var D,B,F}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const M=Ci([],ri([],Rn([],f[T[0]],f[T[1]]),Rn([],f[T[2]],f[T[1]]))),R=-pi(M,f[T[1]]);return M.concat(R)}),x=[];for(let T=0;T<f.length;T++)x.push([f[T][0],f[T][1],f[T][2]]);return new Cd(x,y)}intersectsPrecise(e,i,o){for(let l=0;l<i.length;l++)if(!Md(e,i[l]))return 0;for(let l=0;l<this.planes.length;l++)if(!Md(e,this.planes[l]))return 0;for(const l of o)for(const d of this.frustumEdges){const f=ri([],l,d),y=Ei(f);if(y===0)continue;Fe(f,f,1/y);const x=Sc(this.points,this.points[0],f),T=Sc(e,this.points[0],f);if(x[0]>T[1]||T[0]>x[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const o=i[3];if(pi([i[0],i[1],i[2]],e)+o<0)return!1}return!0}}class Un{static fromPoints(e){const i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const l of e)_t(i,i,l),$t(o,o,l);return new Un(i,o)}static fromTileIdAndHeight(e,i,o){const l=1<<e.canonical.z,d=e.canonical.x,f=e.canonical.y;return new Un([d/l,f/l,i],[(d+1)/l,(f+1)/l,o])}static applyTransform(e,i){const o=e.getCorners();for(let l=0;l<o.length;++l)Vi(o[l],o[l],i);return Un.fromPoints(o)}static applyTransformFast(e,i){const o=[i[12],i[13],i[14]],l=[...o];for(let d=0;d<3;d++)for(let f=0;f<3;f++){const y=i[4*f+d],x=y*e.min[f],T=y*e.max[f];o[d]+=Math.min(x,T),l[d]+=Math.max(x,T)}return new Un(o,l)}static projectAabbCorners(e,i){const o=e.getCorners();for(let l=0;l<o.length;++l)Vi(o[l],o[l],i);return o}constructor(e,i){this.min=e,this.max=i,this.center=Fe([],yi([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],o=Fi(this.min),l=Fi(this.max);for(let d=0;d<i.length;d++)o[d]=i[d]?this.min[d]:this.center[d],l[d]=i[d]?this.center[d]:this.max[d];return l[2]=this.max[2],new Un(o,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Qa(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Qa(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Ad(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Ad(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function kl(n){return n*g/Y}Wt(Un,"Aabb");const Rd=[new Un([k,k,k],[O,O,O]),new Un([k,k,k],[0,0,O]),new Un([0,k,k],[O,0,O]),new Un([k,0,k],[0,O,O]),new Un([0,0,k],[O,O,O])];function Id(n,e,i,o=!0){const l=Fe([],n._camera.position,n.worldSize),d=[e,i,1,1];la(d,d,n.pixelMatrixInverse),kr(d,d,1/d[3]);const f=Ci([],Rn([],d,l)),y=n.globeMatrix,x=[y[12],y[13],y[14]],T=Rn([],x,l),M=Ei(T),R=Ci([],T),D=n.worldSize/(2*Math.PI),B=pi(R,f),F=Math.asin(D/M);if(F<Math.acos(B)){if(!o)return null;const Ue=[],qe=[];Fe(Ue,f,M/B),Ci(qe,Rn(qe,Ue,T)),Ci(f,yi(f,T,Fe(f,qe,Math.tan(F)*M)))}const q=[];new Jo(l,f).closestPointOnSphere(x,D,q);const J=Ci([],sn(y,0)),te=Ci([],sn(y,1)),he=Ci([],sn(y,2)),ce=pi(J,q),X=pi(te,q),re=pi(he,q),ue=W(Math.asin(-X/D));let _e=W(Math.atan2(ce,re));_e=n.center.lng+function(Ue,qe){const ot=(qe-Ue+180)%360-180;return ot<-180?ot+360:ot}(n.center.lng,_e);const ze=Se(_e),Ne=Me(Te(ue),0,1);return new et(ze,Ne)}class By{constructor(e,i,o){this.a=Rn([],e,o),this.b=Rn([],i,o),this.center=o;const l=Ci([],this.a),d=Ci([],this.b);this.angle=Math.acos(pi(l,d))}}function Hm(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(o,l,d,f){const y=Math.sin(d);return o*(Math.sin((1-f)*d)/y)+l*(Math.sin(f*d)/y)}(n.a[e],n.b[e],n.angle,Me(i,0,1))+n.center[e]}function Nl(n){if(n.z<=1)return Rd[n.z+2*n.y+n.x];const e=a_($m(n));return Un.fromPoints(e)}function Bl(n,e,i){return Fe(n,n,1-i),zt(n,n,e,i)}function qm(n,e,i){for(const o of n)Vi(o,o,e),Fe(o,o,i)}function Fy(n,e,i,o){const l=e/n.worldSize,d=n.globeMatrix;if(i.z<=1){const Ne=Nl(i).getCorners();return qm(Ne,d,l),Un.fromPoints(Ne)}const f=$m(i,o),y=a_(f,g+kl(n._tileCoverLift));qm(y,d,l);const x=Number.MAX_VALUE,T=[-x,-x,-x],M=[x,x,x];if(f.contains(n.center)){for(const qe of y)_t(M,M,qe),$t(T,T,qe);T[2]=0;const Ne=n.point,Ue=[Ne.x*l,Ne.y*l,0];return _t(M,M,Ue),$t(T,T,Ue),new Un(M,T)}if(n._tileCoverLift>0){for(const Ne of y)_t(M,M,Ne),$t(T,T,Ne);return new Un(M,T)}const R=[d[12]*l,d[13]*l,d[14]*l],D=f.getCenter(),B=Me(n.center.lat,-85.051129,Ze),F=Me(D.lat,-85.051129,Ze),q=Se(n.center.lng),J=Te(B);let te=q-Se(D.lng);const he=J-Te(F);te>.5?te-=1:te<-.5&&(te+=1);let ce=0;Math.abs(te)>Math.abs(he)?ce=te>=0?1:3:(ce=he>=0?0:2,zt(R,R,[d[4]*l,d[5]*l,d[6]*l],-Math.sin(V(he>=0?f.getSouth():f.getNorth()))*g));const X=y[ce],re=y[(ce+1)%4],ue=new By(X,re,R),_e=[Hm(ue,0)||X[0],Hm(ue,1)||X[1],Hm(ue,2)||X[2]],ze=xu(n.zoom);if(ze>0){const Ne=function({x:qe,y:ot,z:St},gt,xt,Rt,nt){const yt=1/(1<<St);let it=qe*yt,rt=it+yt,Dt=ot*yt,Ot=Dt+yt,hi=0;const ti=(it+rt)/2-Rt;return ti>.5?hi=-1:ti<-.5&&(hi=1),it=((it+hi)*gt-(Rt*=gt))*xt+Rt,rt=((rt+hi)*gt-Rt)*xt+Rt,Dt=(Dt*gt-(nt*=gt))*xt+nt,Ot=(Ot*gt-nt)*xt+nt,[[it,Ot,0],[rt,Ot,0],[rt,Dt,0],[it,Dt,0]]}(i,e,n._pixelsPerMercatorPixel,q,J);for(let qe=0;qe<y.length;qe++)Bl(y[qe],Ne[qe],ze);const Ue=yi([],Ne[ce],Ne[(ce+1)%4]);Fe(Ue,Ue,.5),Bl(_e,Ue,ze)}for(const Ne of y)_t(M,M,Ne),$t(T,T,Ne);return M[2]=Math.min(X[2],re[2]),_t(M,M,_e),$t(T,T,_e),new Un(M,T)}function $m({x:n,y:e,z:i},o=!1){const l=1/(1<<i),d=new K(Ce(n*l),e===(1<<i)-1&&o?-90:Le((e+1)*l)),f=new K(Ce((n+1)*l),e===0&&o?90:Le(e*l));return new se(d,f)}function a_(n,e=g){const i=V(n.getNorth()),o=V(n.getSouth()),l=Math.cos(i),d=Math.cos(o),f=Math.sin(i),y=Math.sin(o),x=n.getWest(),T=n.getEast();return[j(d,y,x,e),j(d,y,T,e),j(l,f,T,e),j(l,f,x,e)]}function Cf(n,e,i,o){const l=1<<i.z,d=(n/Ut+i.x)/l;return Q(Le((e/Ut+i.y)/l),Ce(d),o)}function Xp({min:n,max:e}){return A/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const Dd=new Float64Array(16);function zd(n){const e=Xp(n),i=Tt(Dd,[e,e,e]);return Be(i,i,bi([],n.min))}function Zm(n){const e=(o=n.min,(i=Dd)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=o[0],i[13]=o[1],i[14]=o[2],i[15]=1,i);var i,o;const l=1/Xp(n);return je(e,e,[l,l,l])}function Xm(n){const e=Ut/(2*Math.PI);return n/(2*Math.PI)/e}function o_(n,e){return Ut/(512*Math.pow(2,n))*Xp(Nl(e))}function s_(n,e,i,o,l){const d=Xm(i),f=[n,e,-i/(2*Math.PI)],y=be(new Float64Array(16));return Be(y,y,f),je(y,y,[d,d,d]),at(y,y,V(-l)),ut(y,y,V(-o)),y}function xu(n){return Pe(v,w,n)}function l_(n,e){const i=Q(e.lat,e.lng),o=function(F){const q=Q(F._center.lat,F._center.lng);let J=ri([],fi(0,1,0),q);const te=vt([],-F.angle,q);J=Vi(J,J,te),vt(te,-F._pitch,J);const he=Ci([],q);return Fe(he,he,kl(F.cameraToCenterDistance/F.pixelsPerMeter)),Vi(he,he,te),yi([],q,he)}(n);return f=(l=Je([],o,i))[0],y=l[1],x=l[2],T=(d=i)[0],M=d[1],R=d[2],B=(D=Math.sqrt(f*f+y*y+x*x)*Math.sqrt(T*T+M*M+R*R))&&pi(l,d)/D,Math.acos(Math.min(Math.max(B,-1),1));var l,d,f,y,x,T,M,R,D,B}function Rf(n,e){return l_(n,e)>Math.PI/2*1.01}const c_=V(85),jy=Math.cos(c_),Qr=Math.sin(c_),u_=Ie(),Uy=n=>{const e=[];return n.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),n.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function h_(n,e,i,o,l,d,f,y,x){if(d&&n.queryGeometry.isAboveHorizon)return!1;d&&(x*=n.pixelToTileUnitsFactor);const T=n.tileID.canonical,M=i.projection.upVectorScale(T,i.center.lat,i.worldSize).metersToTile;for(const R of e)for(const D of R){const B=D.add(y),F=l&&i.elevation?i.elevation.exaggeration()*l.getElevationAt(B.x,B.y,!0):0,q=i.projection.projectTilePoint(B.x,B.y,T);if(F>0){const ce=i.projection.upVector(T,B.x,B.y);q.x+=ce[0]*M*F,q.y+=ce[1]*M*F,q.z+=ce[2]*M*F}const J=d?B:Q0(q.x,q.y,q.z,o),te=d?n.tilespaceRays.map(ce=>Wm(ce,F)):n.queryGeometry.screenGeometry,he=la([],[q.x,q.y,q.z,1],o);if(!f&&d?x*=he[3]/i.cameraToCenterDistance:f&&!d&&(x*=i.cameraToCenterDistance/he[3]),d){const ce=Le((D.y/Ut+T.y)/(1<<T.z));x/=i.projection.pixelsPerMeter(ce,1)/ge(1,ce)}if(Ni(te,J,x))return!0}return!1}function Q0(n,e,i,o){const l=la([],[n,e,i,1],o);return new Bt(l[0]/l[3],l[1]/l[3])}const Vy=fi(0,0,0),J0=fi(0,0,1);function Wm(n,e){const i=xi();return Vy[2]=e,n.intersectsPlane(Vy,J0,i),new Bt(i[0],i[1])}class Pd extends ii{}let Ym,Wp,Km,xh;function Fl(n,{width:e,height:i},o,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*i*o)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*i*o);return n.width=e,n.height=i,n.data=l,n}function If(n,e,i){const{width:o,height:l}=e;o===n.width&&l===n.height||(d_(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,o),height:Math.min(n.height,l)},i,null),n.width=o,n.height=l,n.data=e.data)}function d_(n,e,i,o,l,d,f,y){if(l.width===0||l.height===0)return e;if(l.width>n.width||l.height>n.height||i.x>n.width-l.width||i.y>n.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||o.x>e.width-l.width||o.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const x=n.data,T=e.data,M=d===4&&y;for(let R=0;R<l.height;R++){const D=((i.y+R)*n.width+i.x)*d,B=((o.y+R)*e.width+o.x)*d;if(M)for(let F=0;F<l.width;F++){const q=D+F*d+3,J=B+F*d;T[J+0]=255,T[J+1]=255,T[J+2]=255,T[J+3]=x[q]}else if(f)for(let F=0;F<l.width;F++){const q=D+F*d,J=B+F*d,te=x[q+3],he=new Cn(x[q+0]/255*te,x[q+1]/255*te,x[q+2]/255*te,te).toRenderColor(f).toArray();T[J+0]=he[0],T[J+1]=he[1],T[J+2]=he[2],T[J+3]=he[3]}else for(let F=0;F<l.width*d;F++)T[B+F]=x[D+F]}return e}Wt(Pd,"HeatmapBucket",{omit:["layers"]});class bu{constructor(e,i){Fl(this,e,1,i)}resize(e){If(this,new bu(e),1)}clone(){return new bu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,l,d){d_(e,i,o,l,d,1,null)}}class xa{constructor(e,i){Fl(this,e,4,i)}resize(e){If(this,new xa(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new xa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,l,d,f,y){d_(e,i,o,l,d,4,f,y)}}class f_{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Df(n){const e={},i=n.resolution||256,o=n.clips?n.clips.length:1,l=n.image||new xa({width:i,height:o}),d=(f,y,x)=>{e[n.evaluationKey]=x;const T=n.expression.evaluate(e);T&&(l.data[f+y+0]=Math.floor(255*T.r/T.a),l.data[f+y+1]=Math.floor(255*T.g/T.a),l.data[f+y+2]=Math.floor(255*T.b/T.a),l.data[f+y+3]=Math.floor(255*T.a))};if(n.clips)for(let f=0,y=0;f<o;++f,y+=4*i)for(let x=0,T=0;x<i;x++,T+=4){const M=x/(i-1),{start:R,end:D}=n.clips[f];d(y,T,R*(1-M)+D*M)}else for(let f=0,y=0;f<i;f++,y+=4)d(0,y,f/(i-1));return l}Wt(bu,"AlphaImage"),Wt(xa,"RGBAImage");const ex=bn([{name:"a_pos",components:2,type:"Int16"}],4),p_=bn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Gy=bn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Hy=bn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Yp(n,e,i=2){const o=e&&e.length,l=o?e[0]*i:n.length;let d=Qm(n,0,l,i,!0);const f=[];if(!d||d.next===d.prev)return f;let y,x,T;if(o&&(d=function(M,R,D,B){const F=[];for(let q=0,J=R.length;q<J;q++){const te=Qm(M,R[q]*B,q<J-1?R[q+1]*B:M.length,B,!1);te===te.next&&(te.steiner=!0),F.push($y(te))}F.sort(dr);for(let q=0;q<F.length;q++)D=m_(F[q],D);return D}(n,e,d,i)),n.length>80*i){y=1/0,x=1/0;let M=-1/0,R=-1/0;for(let D=i;D<l;D+=i){const B=n[D],F=n[D+1];B<y&&(y=B),F<x&&(x=F),B>M&&(M=B),F>R&&(R=F)}T=Math.max(M-y,R-x),T=T!==0?32767/T:0}return Kp(d,f,i,y,x,T,0),f}function Qm(n,e,i,o,l){let d;if(l===function(f,y,x,T){let M=0;for(let R=y,D=x-T;R<x;R+=T)M+=(f[D]-f[R])*(f[R+1]+f[D+1]),D=R;return M}(n,e,i,o)>0)for(let f=e;f<i;f+=o)d=Vr(f/o|0,n[f],n[f+1],d);else for(let f=i-o;f>=e;f-=o)d=Vr(f/o|0,n[f],n[f+1],d);return d&&Ld(d,d.next)&&(Od(d),d=d.next),d}function wu(n,e){if(!n)return n;e||(e=n);let i,o=n;do if(i=!1,o.steiner||!Ld(o,o.next)&&$r(o.prev,o,o.next)!==0)o=o.next;else{if(Od(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function Kp(n,e,i,o,l,d,f){if(!n)return;!f&&d&&function(x,T,M,R){let D=x;do D.z===0&&(D.z=Jp(D.x,D.y,T,M,R)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==x);D.prevZ.nextZ=null,D.prevZ=null,function(B){let F,q=1;do{let J,te=B;B=null;let he=null;for(F=0;te;){F++;let ce=te,X=0;for(let ue=0;ue<q&&(X++,ce=ce.nextZ,ce);ue++);let re=q;for(;X>0||re>0&&ce;)X!==0&&(re===0||!ce||te.z<=ce.z)?(J=te,te=te.nextZ,X--):(J=ce,ce=ce.nextZ,re--),he?he.nextZ=J:B=J,J.prevZ=he,he=J;te=ce}he.nextZ=null,q*=2}while(F>1)}(D)}(n,o,l,d);let y=n;for(;n.prev!==n.next;){const x=n.prev,T=n.next;if(d?Qp(n,o,l,d):tx(n))e.push(x.i,n.i,T.i),Od(n),n=T.next,y=T.next;else if((n=T)===y){f?f===1?Kp(n=ix(wu(n),e),e,i,o,l,d,2):f===2&&qy(n,e,i,o,l,d):Kp(wu(n),e,i,o,l,d,1);break}}}function tx(n){const e=n.prev,i=n,o=n.next;if($r(e,i,o)>=0)return!1;const l=e.x,d=i.x,f=o.x,y=e.y,x=i.y,T=o.y,M=Math.min(l,d,f),R=Math.min(y,x,T),D=Math.max(l,d,f),B=Math.max(y,x,T);let F=o.next;for(;F!==e;){if(F.x>=M&&F.x<=D&&F.y>=R&&F.y<=B&&Tu(l,y,d,x,f,T,F.x,F.y)&&$r(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function Qp(n,e,i,o){const l=n.prev,d=n,f=n.next;if($r(l,d,f)>=0)return!1;const y=l.x,x=d.x,T=f.x,M=l.y,R=d.y,D=f.y,B=Math.min(y,x,T),F=Math.min(M,R,D),q=Math.max(y,x,T),J=Math.max(M,R,D),te=Jp(B,F,e,i,o),he=Jp(q,J,e,i,o);let ce=n.prevZ,X=n.nextZ;for(;ce&&ce.z>=te&&X&&X.z<=he;){if(ce.x>=B&&ce.x<=q&&ce.y>=F&&ce.y<=J&&ce!==l&&ce!==f&&Tu(y,M,x,R,T,D,ce.x,ce.y)&&$r(ce.prev,ce,ce.next)>=0||(ce=ce.prevZ,X.x>=B&&X.x<=q&&X.y>=F&&X.y<=J&&X!==l&&X!==f&&Tu(y,M,x,R,T,D,X.x,X.y)&&$r(X.prev,X,X.next)>=0))return!1;X=X.nextZ}for(;ce&&ce.z>=te;){if(ce.x>=B&&ce.x<=q&&ce.y>=F&&ce.y<=J&&ce!==l&&ce!==f&&Tu(y,M,x,R,T,D,ce.x,ce.y)&&$r(ce.prev,ce,ce.next)>=0)return!1;ce=ce.prevZ}for(;X&&X.z<=he;){if(X.x>=B&&X.x<=q&&X.y>=F&&X.y<=J&&X!==l&&X!==f&&Tu(y,M,x,R,T,D,X.x,X.y)&&$r(X.prev,X,X.next)>=0)return!1;X=X.nextZ}return!0}function ix(n,e){let i=n;do{const o=i.prev,l=i.next.next;!Ld(o,l)&&Zy(o,i,i.next,l)&&zf(o,l)&&zf(l,o)&&(e.push(o.i,i.i,l.i),Od(i),Od(i.next),i=n=l),i=i.next}while(i!==n);return wu(i)}function qy(n,e,i,o,l,d){let f=n;do{let y=f.next.next;for(;y!==f.prev;){if(f.i!==y.i&&tg(f,y)){let x=tm(f,y);return f=wu(f,f.next),x=wu(x,x.next),Kp(f,e,i,o,l,d,0),void Kp(x,e,i,o,l,d,0)}y=y.next}f=f.next}while(f!==n)}function dr(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function m_(n,e){const i=function(l,d){let f=d;const y=l.x,x=l.y;let T,M=-1/0;if(Ld(l,f))return f;do{if(Ld(l,f.next))return f.next;if(x<=f.y&&x>=f.next.y&&f.next.y!==f.y){const q=f.x+(x-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(q<=y&&q>M&&(M=q,T=f.x<f.next.x?f:f.next,q===y))return T}f=f.next}while(f!==d);if(!T)return null;const R=T,D=T.x,B=T.y;let F=1/0;f=T;do{if(y>=f.x&&f.x>=D&&y!==f.x&&eg(x<B?y:M,x,D,B,x<B?M:y,x,f.x,f.y)){const q=Math.abs(x-f.y)/(y-f.x);zf(f,l)&&(q<F||q===F&&(f.x>T.x||f.x===T.x&&Jm(T,f)))&&(T=f,F=q)}f=f.next}while(f!==R);return T}(n,e);if(!i)return e;const o=tm(i,n);return wu(o,o.next),wu(i,i.next)}function Jm(n,e){return $r(n.prev,n,e.prev)<0&&$r(e.next,n,n.next)<0}function Jp(n,e,i,o,l){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*l|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function $y(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function eg(n,e,i,o,l,d,f,y){return(l-f)*(e-y)>=(n-f)*(d-y)&&(n-f)*(o-y)>=(i-f)*(e-y)&&(i-f)*(d-y)>=(l-f)*(o-y)}function Tu(n,e,i,o,l,d,f,y){return!(n===f&&e===y)&&eg(n,e,i,o,l,d,f,y)}function tg(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,o){let l=i;do{if(l.i!==i.i&&l.next.i!==i.i&&l.i!==o.i&&l.next.i!==o.i&&Zy(l,l.next,i,o))return!0;l=l.next}while(l!==i);return!1}(n,e)&&(zf(n,e)&&zf(e,n)&&function(i,o){let l=i,d=!1;const f=(i.x+o.x)/2,y=(i.y+o.y)/2;do l.y>y!=l.next.y>y&&l.next.y!==l.y&&f<(l.next.x-l.x)*(y-l.y)/(l.next.y-l.y)+l.x&&(d=!d),l=l.next;while(l!==i);return d}(n,e)&&($r(n.prev,n,e.prev)||$r(n,e.prev,e))||Ld(n,e)&&$r(n.prev,n,n.next)>0&&$r(e.prev,e,e.next)>0)}function $r(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Ld(n,e){return n.x===e.x&&n.y===e.y}function Zy(n,e,i,o){const l=em($r(n,e,i)),d=em($r(n,e,o)),f=em($r(i,o,n)),y=em($r(i,o,e));return l!==d&&f!==y||!(l!==0||!ig(n,i,e))||!(d!==0||!ig(n,o,e))||!(f!==0||!ig(i,n,o))||!(y!==0||!ig(i,e,o))}function ig(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function em(n){return n>0?1:n<0?-1:0}function zf(n,e){return $r(n.prev,n,n.next)<0?$r(n,e,n.next)>=0&&$r(n,n.prev,e)>=0:$r(n,e,n.prev)<0||$r(n,n.next,e)<0}function tm(n,e){const i=Na(n.i,n.x,n.y),o=Na(e.i,e.x,e.y),l=n.next,d=e.prev;return n.next=e,e.prev=n,i.next=l,l.prev=i,o.next=i,i.prev=o,d.next=o,o.prev=d,o}function Vr(n,e,i,o){const l=Na(n,e,i);return o?(l.next=o.next,l.prev=o,o.next.prev=l,o.next=l):(l.prev=l,l.next=l),l}function Od(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Na(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function ng(n,e){const i=n.length;if(i<=1)return[n];const o=[];let l,d;for(let f=0;f<i;f++){const y=ln(n[f]);y!==0&&(n[f].area=Math.abs(y),d===void 0&&(d=y<0),d===y<0?(l&&o.push(l),l=[n[f]]):l.push(n[f]))}if(l&&o.push(l),e>1)for(let f=0;f<o.length;f++)o[f].length<=e||(yl(o[f],e,1,o[f].length-1,g_),o[f]=o[f].slice(0,e));return o}function g_(n,e){return e.area-n.area}function rg(n,e,i=1){if(!n)return null;const o=typeof n=="string"?qa.from(n).getPrimary():n.getPrimary(),l=typeof n=="string"?null:n.getSecondary();for(const d of[o,l]){if(!d)continue;const f=d.id.toString();e.has(f)||e.set(f,[]),d.scaleSelf(i),e.get(f).push(d)}return{primary:o.toString(),secondary:l?l.toString():null}}function Pf(n,e,i,o){const l=o.patternDependencies;let d=!1;for(const f of e){const y=f.paint.get(`${n}-pattern`);y.isConstant()||(d=!0),rg(y.constantOr(null),l,i)&&(d=!0)}return d}function ag(n,e,i,o,l,d){const f=d.patternDependencies;for(const y of e){const x=y.paint.get(`${n}-pattern`).value;if(x.kind!=="constant"){let T=x.evaluate({zoom:o},i,{},d.availableImages);T=T&&T.name?T.name:T;const M=rg(T,f,l);if(!M)continue;const{primary:R,secondary:D}=M;R&&(i.patterns[y.id]=[R,D].filter(Boolean))}}return i}var og,sg,im,Xy,lg,Wy,__,cg={};function Yy(){if(sg)return og;sg=1;var n=Ms();function e(l,d,f,y,x){this.properties={},this.extent=f,this.type=0,this._pbf=l,this._geometry=-1,this._keys=y,this._values=x,l.readFields(i,this,d)}function i(l,d,f){l==1?d.id=f.readVarint():l==2?function(y,x){for(var T=y.readVarint()+y.pos;y.pos<T;){var M=x._keys[y.readVarint()],R=x._values[y.readVarint()];x.properties[M]=R}}(f,d):l==3?d.type=f.readVarint():l==4&&(d._geometry=f.pos)}function o(l){for(var d,f,y=0,x=0,T=l.length,M=T-1;x<T;M=x++)y+=((f=l[M]).x-(d=l[x]).x)*(d.y+f.y);return y}return og=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var l=this._pbf;l.pos=this._geometry;for(var d,f=l.readVarint()+l.pos,y=1,x=0,T=0,M=0,R=[];l.pos<f;){if(x<=0){var D=l.readVarint();y=7&D,x=D>>3}if(x--,y===1||y===2)T+=l.readSVarint(),M+=l.readSVarint(),y===1&&(d&&R.push(d),d=[]),d.push(new n(T,M));else{if(y!==7)throw new Error("unknown command "+y);d&&d.push(d[0].clone())}}return d&&R.push(d),R},e.prototype.bbox=function(){var l=this._pbf;l.pos=this._geometry;for(var d=l.readVarint()+l.pos,f=1,y=0,x=0,T=0,M=1/0,R=-1/0,D=1/0,B=-1/0;l.pos<d;){if(y<=0){var F=l.readVarint();f=7&F,y=F>>3}if(y--,f===1||f===2)(x+=l.readSVarint())<M&&(M=x),x>R&&(R=x),(T+=l.readSVarint())<D&&(D=T),T>B&&(B=T);else if(f!==7)throw new Error("unknown command "+f)}return[M,D,R,B]},e.prototype.toGeoJSON=function(l,d,f){var y,x,T=this.extent*Math.pow(2,f),M=this.extent*l,R=this.extent*d,D=this.loadGeometry(),B=e.types[this.type];function F(te){for(var he=0;he<te.length;he++){var ce=te[he];te[he]=[360*(ce.x+M)/T-180,360/Math.PI*Math.atan(Math.exp((180-360*(ce.y+R)/T)*Math.PI/180))-90]}}switch(this.type){case 1:var q=[];for(y=0;y<D.length;y++)q[y]=D[y][0];F(D=q);break;case 2:for(y=0;y<D.length;y++)F(D[y]);break;case 3:for(D=function(te){var he=te.length;if(he<=1)return[te];for(var ce,X,re=[],ue=0;ue<he;ue++){var _e=o(te[ue]);_e!==0&&(X===void 0&&(X=_e<0),X===_e<0?(ce&&re.push(ce),ce=[te[ue]]):ce.push(te[ue]))}return ce&&re.push(ce),re}(D),y=0;y<D.length;y++)for(x=0;x<D[y].length;x++)F(D[y][x])}D.length===1?D=D[0]:B="Multi"+B;var J={type:"Feature",geometry:{type:B,coordinates:D},properties:this.properties};return"id"in this&&(J.id=this.id),J},og}function Su(){if(Xy)return im;Xy=1;var n=Yy();function e(o,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(i,this,l),this.length=this._features.length}function i(o,l,d){o===15?l.version=d.readVarint():o===1?l.name=d.readString():o===5?l.extent=d.readVarint():o===2?l._features.push(d.pos):o===3?l._keys.push(d.readString()):o===4&&l._values.push(function(f){for(var y=null,x=f.readVarint()+f.pos;f.pos<x;){var T=f.readVarint()>>3;y=T===1?f.readString():T===2?f.readFloat():T===3?f.readDouble():T===4?f.readVarint64():T===5?f.readVarint():T===6?f.readSVarint():T===7?f.readBoolean():null}return y}(d))}return im=e,e.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var l=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,l,this.extent,this._keys,this._values)},im}function y_(){return __||(__=1,cg.VectorTile=function(){if(Wy)return lg;Wy=1;var n=Su();function e(i,o,l){if(i===3){var d=new n(l,l.readVarint()+l.pos);d.length&&(o[d.name]=d)}}return lg=function(i,o){this.layers=i.readFields(e,{},o)},lg}(),cg.VectorTileFeature=Yy(),cg.VectorTileLayer=Su()),cg}var Ec=y_();const kd="3d_elevation_id",Ky="level";class v_{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,o){return this.get(e,!0,i,o)}optional(e,i,o){return this.get(e,!1,i,o)}success(){return this._valid}get(e,i,o,l){const d=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&d!==void 0&&!Number.isNaN(d)?o(l?l(d):d):i&&(this._valid=!1),this}}class Qy{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,o){return this.featureFunc(e,i,o)}parseVertex(e,i,o){return this.vertexFunc(e,i,o)}}const jl=new Qy((n,e,i)=>n.reset(e).require(kd,o=>{i.id=o}).optional("fixed_height_relative",o=>{i.constantHeight=o},bh.decodeRelativeHeight).geometry(o=>{i.bounds=o},af).success(),(n,e,i)=>n.reset(e).require(kd,o=>{i.id=o}).require("elevation_idx",o=>{i.idx=o}).require("extent",o=>{i.extent=o}).require("height_relative",o=>{i.height=o},bh.decodeRelativeHeight).geometry(o=>{i.position=o},bh.getPoint).success()),x_=new Qy((n,e,i)=>n.reset(e).require(kd,o=>{i.id=o}).optional("fixed_height",o=>{i.constantHeight=o},bh.decodeMetricHeight).geometry(o=>{i.bounds=o},af).success(),(n,e,i)=>n.reset(e).require(kd,o=>{i.id=o}).require("elevation_idx",o=>{i.idx=o}).require("extent",o=>{i.extent=o}).require("height",o=>{i.height=o},bh.decodeMetricHeight).geometry(o=>{i.position=o},bh.getPoint).success());class bh{static getPoint(e){return Qs(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const i=[],o=[],l=e.length,d=new v_;for(let y=0;y<l;y++){const x=e.feature(y),T=x.properties.hasOwnProperty("version")?String(x.properties.version):void 0,M=(f=T)?f==="1.0.1"?x_:void 0:jl;if(M===void 0){Ui(`Unknown elevation feature version number ${T||"(unknown)"}`);continue}const R=x.properties.hasOwnProperty("type")?x.properties.type:void 0;if(R){if(Ec.VectorTileFeature.types[x.type]==="Point"&&R==="curve_point"){const D={};M.parseVertex(d,x,D)&&i.push(D)}else if(Ec.VectorTileFeature.types[x.type]==="Polygon"&&R==="curve_meta"){const D={};M.parseFeature(d,x,D)&&o.push(D)}}}var f;return{vertices:i,features:o}}}class b_{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,o=i[1],l=-i[0],d=(e.extent+1)*this.metersToTile;return[new Bt(Math.trunc(e.position[0]+o*d),Math.trunc(e.position[1]+l*d)),new Bt(Math.trunc(e.position[0]-o*d),Math.trunc(e.position[1]-l*d))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Nd{constructor(e,i,o,l,d,f){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:o,max:o},this.safeArea=i,this.constantHeight=o,this.constantHeight==null&&(this.constantHeight!=null||l.length!==0)){this.vertices=l,this.edges=d,this.edges=this.edges.filter(y=>{return y.a<this.vertices.length&&y.b<this.vertices.length&&!((x=this.vertices[y.a].position)[0]===(T=this.vertices[y.b].position)[0]&&x[1]===T[1]);var x,T}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const y of this.vertices)this.vertexProps.push({dir:Qs(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,y.height),this.heightRange.max=Math.max(this.heightRange.max,y.height);for(const y of this.edges){const x=this.vertices[y.a].position,T=this.vertices[y.b].position,M=Ua(ta(),T,x),R=Vo(M),D=no(ta(),M,1/R);this.edgeProps.push({vec:M,dir:D,len:R});const B=this.vertexProps[y.a].dir,F=this.vertexProps[y.b].dir;bo(B,B,D),bo(F,F,D)}for(const y of this.vertexProps)y.dir[0]===0&&y.dir[1]===0||wo(y.dir,y.dir);this.tessellate(f)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[o,l]=i;return((d,f,y)=>(1-y)*d+y*f)(this.vertices[this.edges[o].a].height,this.vertices[this.edges[o].b].height,l)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,o=Number.POSITIVE_INFINITY,l=0;const d=Qs(e.x,e.y);for(let f=0;f<this.edges.length;f++){const y=this.edges[f],x=this.edgeProps[f].dir,T=new Fo(d,this.edgeProps[f].dir),M=this.vertices[y.a].position,R=this.vertices[y.b].position,D=ta(),B=ta(),F=T.intersectsPlane(M,this.vertexProps[y.a].dir,D),q=T.intersectsPlane(R,this.vertexProps[y.b].dir,B);if(!F||!q)continue;const J=Ua(ta(),B,D),te=Ua(ta(),d,D),he=Jn(J,J),ce=he>0?Jn(te,J)/he:0,X=Me(ce,0,1),re=Math.abs((ce-X)*this.edgeProps[f].len),ue=Ua(ta(),d,M),_e=re+Math.abs(Jn(ue,Qs(x[1],-x[0])));_e<o&&(i=f,o=_e,l=X)}return[i,l]}tessellate(e){for(let i=this.edges.length-1;i>=0;--i){const o=this.edges[i].a,l=this.edges[i].b,{position:d,height:f,extent:y}=this.vertices[o],{position:x,height:T,extent:M}=this.vertices[l],R=this.vertexProps[o].dir,D=this.vertexProps[l].dir,B=fi(d[0]/e,d[1]/e,f),F=fi(x[0]/e,x[1]/e,T),q=fi(R[1],-R[0],0);Fe(q,q,y);const J=fi(D[1],-D[0],0);if(Fe(J,J,M),this.distSqLines(fi(B[0]+.5*q[0],B[1]+.5*q[1],B[2]+.5*q[2]),fi(F[0]-.5*J[0],F[1]-.5*J[1],F[2]-.5*J[2]),fi(B[0]-.5*q[0],B[1]-.5*q[1],B[2]-.5*q[2]),fi(F[0]+.5*J[0],F[1]+.5*J[1],F[2]+.5*J[2]))<=.0025000000000000005)continue;const te=this.vertices.length,he=bo(ta(),d,x);this.vertices.push({position:no(he,he,.5),height:.5*(f+T),extent:.5*(y+M)});const ce=bo(ta(),R,D);this.vertexProps.push({dir:wo(ce,ce)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a:o,b:te}),this.edges.push({a:te,b:l});const X=Ua(ta(),this.vertices[te].position,d),re=Vo(X),ue={vec:X,dir:no(ta(),X,1/re),len:re};this.edgeProps.push(ue),this.edgeProps.push(ue)}}distSqLines(e,i,o,l){const d=Je(xi(),i,e),f=Je(xi(),l,o),y=Je(xi(),e,o),x=pi(d,d),T=pi(d,f),M=pi(d,y),R=pi(f,f),D=pi(f,y),B=x*R-T*T;if(B===0){const J=pi(y,f)/pi(f,f);return _i(Yi(xi(),o,l,J),e)}const F=(T*D-M*R)/B,q=(x*D-T*M)/B;return _i(Yi(xi(),e,i,F),Yi(xi(),o,l,q))}}class ys{static parseFrom(e,i){const o=bh.parse(e);if(!o)return[];let{vertices:l,features:d}=o;const f=1/$e(i);d.sort((M,R)=>M.id-R.id),l.sort((M,R)=>M.id-R.id||M.idx-R.idx),l=l.filter((M,R,D)=>R===D.findIndex(B=>B.id===M.id&&B.idx===M.idx));const y=new Array;let x=0;const T=l.length;for(const M of d){if(M.constantHeight){y.push(new Nd(M.id,M.bounds,M.constantHeight));continue}for(;x!==T&&l[x].id<M.id;)x++;if(x===T||l[x].id!==M.id)continue;const R=new Array,D=new Array,B=x;for(;x!==T&&l[x].id===M.id;){const F=l[x];if(R.push({position:F.position,height:F.height,extent:F.extent}),x!==B&&l[x-1].idx===F.idx-1){const q=x-B;D.push({a:q-1,b:q})}x++}y.push(new Nd(M.id,M.bounds,void 0,R,D,f))}return y}static getElevationFeature(e,i){if(!i)return;const o=+e.properties[kd];return Number.isNaN(o)?void 0:i.find(l=>l.id===o)}}class w_{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*Ut,this.yOffset=(e.y*this.zScale-i.y)*Ut)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,o){const l=this.constantElevation(i,o);return l??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),o))}computeBiasedHeight(e,i){return i<=0?e:e+i*Pe(0,i,e>=0?e:Math.abs(.5*e))}}Wt(Nd,"ElevationFeature");class nm{constructor(){this.polygons=new Map}add(e,...i){this.polygons.has(e)?this.polygons.get(e).push(...i):this.polygons.set(e,i)}merge(e){for(const[i,o]of e.polygons)this.add(i,...o)}}class es{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new es;let i=[];for(const T of e)i.push(...T.portals);if(i.length===0)return new es;const o=(T,M)=>T<=0&&M<=0||T>=Ut&&M>=Ut;for(const T of i){const M=T.va,R=T.vb;(o(M.x,R.x)||o(M.y,R.y))&&(T.type="border")}const l=i.filter(T=>T.type!=="unevaluated"),d=i.filter(T=>T.type==="unevaluated");if(d.length===0)return new es;d.sort((T,M)=>T.hash===M.hash?T.isTunnel===M.isTunnel?0:T.isTunnel?-1:1:T.hash<M.hash?1:-1),i=l.concat(d);let f=l.length,y=f,x=f;do if(y++,y===i.length||i[f].hash!==i[y].hash){if(y-f==2){x<f&&(i[x]=i[f],i[f]=null);const T=i[x],M=i[y-1];T.type=T.isTunnel!==M.isTunnel?"tunnel":"polygon",T.connection={a:T.connection.a,b:M.connection.a},x++}f=y}while(f!==i.length);return i.splice(x),i.sort((T,M)=>T.hash<M.hash?1:-1),{portals:i}}}Wt(es,"ElevationPortalGraph"),Wt(nm,"ElevationPolygons");class nx{constructor(e,i,o){this.outPositions=e,this.outNormals=i,this.outIndices=o,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,i,o){let l=e[2];o!=null&&(l*=o);const d=this.getVec3Bits(e)<<96n|this.getVec3Bits(i),f=this.vertexLookup.get(d);if(f!=null)return f;const y=this.outPositions.length;this.vertexLookup.set(d,y);const x=Math.trunc(16384*i[0]),T=Math.trunc(16384*i[1]),M=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],l),this.outNormals.emplaceBack(x,T,M),y}addVertices(e,i,...o){const l=[];for(const d of o){const f=this.addVertex(d,e,i);l.push(f)}return l}addTriangles(e,i,o){if(i&&o){const l=o.length===1,d=fi(0,0,0);for(let f=0;f<e.length;f+=3){const y=i[e[f+0]],x=i[e[f+1]],T=i[e[f+2]],M=l?o[0]:o[e[f+1]],R=l?o[0]:o[e[f+2]],D=this.addVertex(fi(y.x,y.y,l?o[0]:o[e[f+0]]),d),B=this.addVertex(fi(x.x,x.y,M),d),F=this.addVertex(fi(T.x,T.y,R),d);this.outIndices.emplaceBack(D,B,F)}}else for(let l=0;l<e.length;l+=3)this.outIndices.emplaceBack(e[l+0],e[l+1],e[l+2])}addQuad(e,i){const o=this.addVertices(i,void 0,...e.map(x=>fi(x.coord.x,x.coord.y,x.height))),[l,d,f,y]=o;this.addTriangles([l,d,f,f,y,l])}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class vs{constructor(e){this.unevaluatedPortals=new es,this.portalPolygons=new nm,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new pu,this.vertexNormals=new mu,this.indexArray=new Pr,this.tileToMeters=$e(e)}addVertices(e,i){const o=this.unevalVertices.length;for(let l=0;l<e.length;l++)this.unevalVertices.push(e[l]),this.unevalHeights.push(i[l]);return o}addTriangles(e,i,o){const l=o?this.unevalTunnelTriangles:this.unevalTriangles;for(const d of e)l.push(d+i)}addRenderableRing(e,i,o,l,d){const f=[new Bt(d.min.x,d.min.y),new Bt(d.max.x,d.min.y),new Bt(d.max.x,d.max.y),new Bt(d.min.x,d.max.y)];for(let y=0;y<o-1;y++){const x=i+y,T=x+1,M=this.unevalVertices[x],R=this.unevalVertices[T];if(!(M.x>=d.min.x&&M.x<=d.max.x&&M.y>=d.min.y&&M.y<=d.max.y||R.x>=d.min.x&&R.x<=d.max.x&&R.y>=d.min.y&&R.y<=d.max.y||er(M,R,f))||this.isOnBorder(M.x,R.x)||this.isOnBorder(M.y,R.y))continue;const D=vs.computeEdgeHash(this.unevalVertices[x],this.unevalVertices[T]);let B,F=this.vertexHashLookup.get(vs.computePosHash(M));F!=null?B=F.next:(F=this.vertexHashLookup.get(vs.computePosHash(R)),B=F!=null?F.prev:D),this.unevalEdges.push({polygonIdx:e,a:x,b:T,hash:D,portalHash:B,isTunnel:l,type:"unevaluated"})}}addPortalCandidates(e,i,o,l,d){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:d});const f=i[0];this.vertexHashLookup.clear();let y=vs.computeEdgeHash(f[f.length-2],f[f.length-1]);for(let x=0;x<f.length-1;x++){const T=f[x+0],M=f[x+1],R=Qs(M.x-T.x,M.y-T.y),D=Vo(R);if(D===0)continue;let B="unevaluated";const F=l.pointElevation(T),q=l.pointElevation(M);Math.abs(F)<.01&&Math.abs(q)<.01?B="entrance":(this.isOnBorder(T.x,M.x)||this.isOnBorder(T.y,M.y))&&(B="border");const J=vs.computeEdgeHash(T,M);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:T,vb:M,vab:R,length:D,hash:J,isTunnel:o,type:B});const te=vs.computePosHash(T);this.vertexHashLookup.set(te,{prev:y,next:J}),y=J}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),o=R=>{R.primitiveLength=this.indexArray.length-R.primitiveOffset},l=new nx(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const d=i(),f=i(),y=i(),x=(R,D)=>{R.sort((F,q)=>F.type===D&&q.type!==D?-1:F.type!==D&&q.type===D?1:0);const B=R.findIndex(F=>F.type!==D);return B>=0?B:R.length};let T=0;this.unevalEdges.length>0&&(T=x(this.unevalEdges,"none"),this.constructBridgeStructures(l,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},this.tileToMeters));const M=i();if(this.unevalEdges.length>0){const R=this.unevalEdges.splice(T),D=x(R,"tunnel")+T;this.unevalEdges.push(...R),this.constructTunnelStructures(l,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},{min:T,max:D})}o(y),l.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),o(M),l.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),o(f),l.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),o(d),this.maskSegments=vr.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.depthSegments=vr.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength),this.renderableSegments=vr.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.shadowCasterSegments=vr.simpleSegment(0,d.primitiveOffset,0,d.primitiveLength)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,Gy.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,Hy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(e,i,o,l,d){const f=new Map;for(let y=l;y<d;y++){const x=o[y],T=x.a,M=x.b,R=vs.computePosHash(e[T]),D=vs.computePosHash(e[M]);f.has(R)||f.set(R,{}),f.has(D)||f.set(D,{});const B=f.get(R),F=f.get(D);i[T]<=0&&i[M]<=0||(B.to=M,F.from=T)}return f}constructBridgeStructures(e,i,o,l,d,f){const y=this.computeVertexConnections(i,o,l,d.min,d.max),x=1/f,T=.5*x,M=D=>fi(i[D].x,i[D].y,o[D]*x),R=D=>{const B=y.get(vs.computePosHash(i[D])),F=B.from,q=B.to;if(!F||!q)return;const J=M(F),te=M(D),he=M(q),ce=fi(0,0,0);if(!_n(J,te)){const re=Rn(xi(),te,J);yi(ce,ce,Ci(re,re))}if(!_n(he,te)){const re=Rn(xi(),he,te);yi(ce,ce,Ci(re,re))}const X=io(ce);return X>0?Fe(ce,ce,1/X):void 0};for(let D=d.min;D<d.max;D++){const B=l[D],F=this.prepareEdgePoints(i,o,B,(It,ji)=>It>ji);if(F==null)continue;const q=F[0],J=F[1],te=fi(q.coord.x,q.coord.y,x*q.height),he=fi(J.coord.x,J.coord.y,x*J.height);if(_n(te,he))continue;const ce=Rn(xi(),he,te);Ci(ce,ce);const X=It=>Ci(It,It),re=R(B.a)||ce,ue=R(B.b)||ce,_e=X(fi(re[1],-re[0],0)),ze=X(fi(ue[1],-ue[0],0)),Ne=X(ri(xi(),_e,re)),Ue=X(ri(xi(),ze,ue)),qe=xi(),ot=[yi(xi(),te,Fe(qe,Rn(qe,_e,Ne),T)),yi(xi(),te,Fe(qe,yi(qe,_e,Ne),T)),yi(xi(),te,Fe(qe,Ne,T)),te],St=[yi(xi(),he,Fe(qe,Rn(qe,ze,Ue),T)),yi(xi(),he,Fe(qe,yi(qe,ze,Ue),T)),yi(xi(),he,Fe(qe,Ue,T)),he],[gt,xt]=e.addVertices(_e,f,ot[0],ot[1]),[Rt,nt]=e.addVertices(ze,f,St[0],St[1]);e.addTriangles([gt,xt,Rt,xt,nt,Rt]);const[yt,it]=e.addVertices(Ne,f,ot[1],ot[2]),[rt,Dt]=e.addVertices(Ue,f,St[1],St[2]);e.addTriangles([yt,it,rt,it,Dt,rt]);const[Ot,hi]=e.addVertices(bi(_e,_e),f,ot[2],ot[3]),[ti,Gt]=e.addVertices(bi(ze,ze),f,St[2],St[3]);e.addTriangles([Ot,hi,ti,hi,Gt,ti])}}constructTunnelStructures(e,i,o,l,d,f){const y=x=>Ci(x,x);for(let x=d.min;x<d.max;x++){const T=this.prepareEdgePoints(i,o,l[x],(B,F)=>B<F);if(T==null)continue;const[M,R]=T,D=y(fi(R.coord.y-M.coord.y,-(R.coord.x-M.coord.x),0));e.addQuad([M,R,{coord:R.coord,height:l[x].isTunnel?-.1:0},{coord:M.coord,height:l[x].isTunnel?-.1:0}],D)}for(let x=f.min;x<f.max;x++){const T=l[x],M=i[T.a],R=i[T.b],D=y(fi(R.y-M.y,-(R.x-M.x),0));e.addQuad([{coord:R,height:0},{coord:M,height:0},{coord:M,height:o[T.a]+4},{coord:R,height:o[T.b]+4}],D),e.addQuad([{coord:M,height:0},{coord:R,height:0},{coord:R,height:o[T.b]+4},{coord:M,height:o[T.a]+4}],D)}}prepareEdgePoints(e,i,o,l){let d=i[o.a],f=i[o.b];const y=l(d,0),x=l(f,0);if(y&&x)return[{coord:e[o.a],height:d},{coord:e[o.b],height:f}];if(!y&&!x)return;const T=e[o.a].clone(),M=e[o.b].clone();if(y){if(!x){const R=f/(f-d);M.x=Ti(M.x,T.x,R),M.y=Ti(M.y,T.y,R),f=Ti(f,d,R)}}else{const R=d/(d-f);T.x=Ti(T.x,M.x,R),T.y=Ti(T.y,M.y,R),d=Ti(d,f,R)}return[{coord:T,height:d},{coord:M,height:f}]}prepareEdges(e,i){if(i.length===0)return;i.sort((y,x)=>y.hash===x.hash?x.polygonIdx-y.polygonIdx:x.hash>y.hash?1:-1);let o=0,l=0,d=0,f=i[o].polygonIdx;do l++,(l===i.length||i[o].hash!==i[l].hash)&&((l-o==1||i[l-1].polygonIdx!==f)&&(d<o&&(i[d]=i[o],i[o]=null),i[d].type="none",d++),o=l,o!==i.length&&(f=i[o].polygonIdx));while(o!==i.length);if(i.splice(d),i.length!==0&&e.length!==0){i.sort((T,M)=>T.portalHash<M.portalHash?1:-1);let y=0,x=0;for(;y!==i.length&&x!==e.length;){const T=i[y],M=e[x];T.portalHash>M.hash?y++:M.hash>T.portalHash?x++:(T.type=M.type,y++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=Ut&&i>=Ut}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(vs.computePosHash(e))<<32n|BigInt(vs.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var Bd,T_={exports:{}},Jy=(Bd||(Bd=1,function(n,e){(function(i){function o(me,xe){return me>xe?1:me<xe?-1:0}var l=function(me,xe){me===void 0&&(me=o),xe===void 0&&(xe=!1),this._compare=me,this._root=null,this._size=0,this._noDuplicates=!!xe},d={size:{configurable:!0}};function f(me,xe,ct,Ft,qt){var Ht=qt-Ft;if(Ht>0){var ui=Ft+Math.floor(Ht/2),Ii={key:xe[ui],data:ct[ui],parent:me};return Ii.left=f(Ii,xe,ct,Ft,ui),Ii.right=f(Ii,xe,ct,ui+1,qt),Ii}return null}function y(me,xe,ct,Ft,qt){if(!(ct>=Ft)){for(var Ht=me[ct+Ft>>1],ui=ct-1,Ii=Ft+1;;){do ui++;while(qt(me[ui],Ht)<0);do Ii--;while(qt(me[Ii],Ht)>0);if(ui>=Ii)break;var hn=me[ui];me[ui]=me[Ii],me[Ii]=hn,hn=xe[ui],xe[ui]=xe[Ii],xe[Ii]=hn}y(me,xe,ct,Ii,qt),y(me,xe,Ii+1,Ft,qt)}}l.prototype.rotateLeft=function(me){var xe=me.right;xe&&(me.right=xe.left,xe.left&&(xe.left.parent=me),xe.parent=me.parent),me.parent?me===me.parent.left?me.parent.left=xe:me.parent.right=xe:this._root=xe,xe&&(xe.left=me),me.parent=xe},l.prototype.rotateRight=function(me){var xe=me.left;xe&&(me.left=xe.right,xe.right&&(xe.right.parent=me),xe.parent=me.parent),me.parent?me===me.parent.left?me.parent.left=xe:me.parent.right=xe:this._root=xe,xe&&(xe.right=me),me.parent=xe},l.prototype._splay=function(me){for(;me.parent;){var xe=me.parent;xe.parent?xe.left===me&&xe.parent.left===xe?(this.rotateRight(xe.parent),this.rotateRight(xe)):xe.right===me&&xe.parent.right===xe?(this.rotateLeft(xe.parent),this.rotateLeft(xe)):xe.left===me&&xe.parent.right===xe?(this.rotateRight(xe),this.rotateLeft(xe)):(this.rotateLeft(xe),this.rotateRight(xe)):xe.left===me?this.rotateRight(xe):this.rotateLeft(xe)}},l.prototype.splay=function(me){for(var xe,ct,Ft,qt,Ht;me.parent;)(ct=(xe=me.parent).parent)&&ct.parent?((Ft=ct.parent).left===ct?Ft.left=me:Ft.right=me,me.parent=Ft):(me.parent=null,this._root=me),qt=me.left,Ht=me.right,me===xe.left?(ct&&(ct.left===xe?(xe.right?(ct.left=xe.right,ct.left.parent=ct):ct.left=null,xe.right=ct,ct.parent=xe):(qt?(ct.right=qt,qt.parent=ct):ct.right=null,me.left=ct,ct.parent=me)),Ht?(xe.left=Ht,Ht.parent=xe):xe.left=null,me.right=xe,xe.parent=me):(ct&&(ct.right===xe?(xe.left?(ct.right=xe.left,ct.right.parent=ct):ct.right=null,xe.left=ct,ct.parent=xe):(Ht?(ct.left=Ht,Ht.parent=ct):ct.left=null,me.right=ct,ct.parent=me)),qt?(xe.right=qt,qt.parent=xe):xe.right=null,me.left=xe,xe.parent=me)},l.prototype.replace=function(me,xe){me.parent?me===me.parent.left?me.parent.left=xe:me.parent.right=xe:this._root=xe,xe&&(xe.parent=me.parent)},l.prototype.minNode=function(me){if(me===void 0&&(me=this._root),me)for(;me.left;)me=me.left;return me},l.prototype.maxNode=function(me){if(me===void 0&&(me=this._root),me)for(;me.right;)me=me.right;return me},l.prototype.insert=function(me,xe){var ct=this._root,Ft=null,qt=this._compare;if(this._noDuplicates)for(;ct;){if(Ft=ct,qt(ct.key,me)===0)return;ct=qt(ct.key,me)<0?ct.right:ct.left}else for(;ct;)Ft=ct,ct=qt(ct.key,me)<0?ct.right:ct.left;return ct={key:me,data:xe,left:null,right:null,parent:Ft},Ft?qt(Ft.key,ct.key)<0?Ft.right=ct:Ft.left=ct:this._root=ct,this.splay(ct),this._size++,ct},l.prototype.find=function(me){for(var xe=this._root,ct=this._compare;xe;){var Ft=ct(xe.key,me);if(Ft<0)xe=xe.right;else{if(!(Ft>0))return xe;xe=xe.left}}return null},l.prototype.contains=function(me){for(var xe=this._root,ct=this._compare;xe;){var Ft=ct(me,xe.key);if(Ft===0)return!0;xe=Ft<0?xe.left:xe.right}return!1},l.prototype.remove=function(me){var xe=this.find(me);if(!xe)return!1;if(this.splay(xe),xe.left)if(xe.right){var ct=this.minNode(xe.right);ct.parent!==xe&&(this.replace(ct,ct.right),ct.right=xe.right,ct.right.parent=ct),this.replace(xe,ct),ct.left=xe.left,ct.left.parent=ct}else this.replace(xe,xe.left);else this.replace(xe,xe.right);return this._size--,!0},l.prototype.removeNode=function(me){if(!me)return!1;if(this.splay(me),me.left)if(me.right){var xe=this.minNode(me.right);xe.parent!==me&&(this.replace(xe,xe.right),xe.right=me.right,xe.right.parent=xe),this.replace(me,xe),xe.left=me.left,xe.left.parent=xe}else this.replace(me,me.left);else this.replace(me,me.right);return this._size--,!0},l.prototype.erase=function(me){var xe=this.find(me);if(xe){this.splay(xe);var ct=xe.left,Ft=xe.right,qt=null;ct&&(ct.parent=null,qt=this.maxNode(ct),this.splay(qt),this._root=qt),Ft&&(ct?qt.right=Ft:this._root=Ft,Ft.parent=qt),this._size--}},l.prototype.pop=function(){var me=this._root,xe=null;if(me){for(;me.left;)me=me.left;xe={key:me.key,data:me.data},this.remove(me.key)}return xe},l.prototype.next=function(me){var xe=me;if(xe)if(xe.right)for(xe=xe.right;xe&&xe.left;)xe=xe.left;else for(xe=me.parent;xe&&xe.right===me;)me=xe,xe=xe.parent;return xe},l.prototype.prev=function(me){var xe=me;if(xe)if(xe.left)for(xe=xe.left;xe&&xe.right;)xe=xe.right;else for(xe=me.parent;xe&&xe.left===me;)me=xe,xe=xe.parent;return xe},l.prototype.forEach=function(me){for(var xe=this._root,ct=[],Ft=!1,qt=0;!Ft;)xe?(ct.push(xe),xe=xe.left):ct.length>0?(me(xe=ct.pop(),qt++),xe=xe.right):Ft=!0;return this},l.prototype.range=function(me,xe,ct,Ft){for(var qt=[],Ht=this._compare,ui=this._root;qt.length!==0||ui;)if(ui)qt.push(ui),ui=ui.left;else{if(Ht((ui=qt.pop()).key,xe)>0)break;if(Ht(ui.key,me)>=0&&ct.call(Ft,ui))return this;ui=ui.right}return this},l.prototype.keys=function(){for(var me=this._root,xe=[],ct=[],Ft=!1;!Ft;)me?(xe.push(me),me=me.left):xe.length>0?(me=xe.pop(),ct.push(me.key),me=me.right):Ft=!0;return ct},l.prototype.values=function(){for(var me=this._root,xe=[],ct=[],Ft=!1;!Ft;)me?(xe.push(me),me=me.left):xe.length>0?(me=xe.pop(),ct.push(me.data),me=me.right):Ft=!0;return ct},l.prototype.at=function(me){for(var xe=this._root,ct=[],Ft=!1,qt=0;!Ft;)if(xe)ct.push(xe),xe=xe.left;else if(ct.length>0){if(xe=ct.pop(),qt===me)return xe;qt++,xe=xe.right}else Ft=!0;return null},l.prototype.load=function(me,xe,ct){if(me===void 0&&(me=[]),xe===void 0&&(xe=[]),ct===void 0&&(ct=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Ft=me.length;return ct&&y(me,xe,0,Ft-1,this._compare),this._root=f(null,me,xe,0,Ft),this._size=Ft,this},l.prototype.min=function(){var me=this.minNode(this._root);return me?me.key:null},l.prototype.max=function(){var me=this.maxNode(this._root);return me?me.key:null},l.prototype.isEmpty=function(){return this._root===null},d.size.get=function(){return this._size},l.createTree=function(me,xe,ct,Ft,qt){return new l(ct,qt).load(me,xe,Ft)},Object.defineProperties(l.prototype,d);var x=0,T=1,M=2,R=3,D=0,B=1,F=2,q=3;function J(me,xe,ct){xe===null?(me.inOut=!1,me.otherInOut=!0):(me.isSubject===xe.isSubject?(me.inOut=!xe.inOut,me.otherInOut=xe.otherInOut):(me.inOut=!xe.otherInOut,me.otherInOut=xe.isVertical()?!xe.inOut:xe.inOut),xe&&(me.prevInResult=!te(xe,ct)||xe.isVertical()?xe.prevInResult:xe));var Ft=te(me,ct);me.resultTransition=Ft?function(qt,Ht){var ui,Ii=!qt.inOut,hn=!qt.otherInOut;switch(Ht){case D:ui=Ii&&hn;break;case B:ui=Ii||hn;break;case q:ui=Ii^hn;break;case F:ui=qt.isSubject?Ii&&!hn:hn&&!Ii}return ui?1:-1}(me,ct):0}function te(me,xe){switch(me.type){case x:switch(xe){case D:return!me.otherInOut;case B:return me.otherInOut;case F:return me.isSubject&&me.otherInOut||!me.isSubject&&!me.otherInOut;case q:return!0}break;case M:return xe===D||xe===B;case R:return xe===F;case T:return!1}return!1}var he=function(me,xe,ct,Ft,qt){this.left=xe,this.point=me,this.otherEvent=ct,this.isSubject=Ft,this.type=qt||x,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ce={inResult:{configurable:!0}};function X(me,xe){return me[0]===xe[0]&&me[1]===xe[1]}he.prototype.isBelow=function(me){var xe=this.point,ct=this.otherEvent.point;return this.left?(xe[0]-me[0])*(ct[1]-me[1])-(ct[0]-me[0])*(xe[1]-me[1])>0:(ct[0]-me[0])*(xe[1]-me[1])-(xe[0]-me[0])*(ct[1]-me[1])>0},he.prototype.isAbove=function(me){return!this.isBelow(me)},he.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ce.inResult.get=function(){return this.resultTransition!==0},he.prototype.clone=function(){var me=new he(this.point,this.left,this.otherEvent,this.isSubject,this.type);return me.contourId=this.contourId,me.resultTransition=this.resultTransition,me.prevInResult=this.prevInResult,me.isExteriorRing=this.isExteriorRing,me.inOut=this.inOut,me.otherInOut=this.otherInOut,me},Object.defineProperties(he.prototype,ce);var re=11102230246251565e-32,ue=134217729,_e=(3+8*re)*re;function ze(me,xe,ct,Ft,qt){var Ht,ui,Ii,hn,dn=xe[0],Wi=Ft[0],Hn=0,rr=0;Wi>dn==Wi>-dn?(Ht=dn,dn=xe[++Hn]):(Ht=Wi,Wi=Ft[++rr]);var fn=0;if(Hn<me&&rr<ct)for(Wi>dn==Wi>-dn?(Ii=Ht-((ui=dn+Ht)-dn),dn=xe[++Hn]):(Ii=Ht-((ui=Wi+Ht)-Wi),Wi=Ft[++rr]),Ht=ui,Ii!==0&&(qt[fn++]=Ii);Hn<me&&rr<ct;)Wi>dn==Wi>-dn?(Ii=Ht-((ui=Ht+dn)-(hn=ui-Ht))+(dn-hn),dn=xe[++Hn]):(Ii=Ht-((ui=Ht+Wi)-(hn=ui-Ht))+(Wi-hn),Wi=Ft[++rr]),Ht=ui,Ii!==0&&(qt[fn++]=Ii);for(;Hn<me;)Ii=Ht-((ui=Ht+dn)-(hn=ui-Ht))+(dn-hn),dn=xe[++Hn],Ht=ui,Ii!==0&&(qt[fn++]=Ii);for(;rr<ct;)Ii=Ht-((ui=Ht+Wi)-(hn=ui-Ht))+(Wi-hn),Wi=Ft[++rr],Ht=ui,Ii!==0&&(qt[fn++]=Ii);return Ht===0&&fn!==0||(qt[fn++]=Ht),fn}function Ne(me){return new Float64Array(me)}var Ue=33306690738754716e-32,qe=22204460492503146e-32,ot=11093356479670487e-47,St=Ne(4),gt=Ne(8),xt=Ne(12),Rt=Ne(16),nt=Ne(4);function yt(me,xe,ct){var Ft=function(qt,Ht,ui,Ii,hn,dn){var Wi=(Ht-dn)*(ui-hn),Hn=(qt-hn)*(Ii-dn),rr=Wi-Hn;if(Wi===0||Hn===0||Wi>0!=Hn>0)return rr;var fn=Math.abs(Wi+Hn);return Math.abs(rr)>=Ue*fn?rr:-function(Cr,lr,Vn,Or,fr,ar,cr){var Xn,Ji,Wn,Rr,Ri,Tn,pr,Dr,xr,ua,Qn,oa,bs,Ja,Fa,ws,Eh,ha,_a=Cr-fr,eo=Vn-fr,jo=lr-ar,_o=Or-ar;St[0]=(Fa=(Dr=_a-(pr=(Tn=ue*_a)-(Tn-_a)))*(ua=_o-(xr=(Tn=ue*_o)-(Tn-_o)))-((Ja=_a*_o)-pr*xr-Dr*xr-pr*ua))-((Qn=Fa-(Eh=(Dr=jo-(pr=(Tn=ue*jo)-(Tn-jo)))*(ua=eo-(xr=(Tn=ue*eo)-(Tn-eo)))-((ws=jo*eo)-pr*xr-Dr*xr-pr*ua)))+(Ri=Fa-Qn))+(Ri-Eh),St[1]=(bs=Ja-((oa=Ja+Qn)-(Ri=oa-Ja))+(Qn-Ri))-((Qn=bs-ws)+(Ri=bs-Qn))+(Ri-ws),St[2]=oa-((ha=oa+Qn)-(Ri=ha-oa))+(Qn-Ri),St[3]=ha;var qf=function(_F,KT){for(var QT=KT[0],Jx=1;Jx<4;Jx++)QT+=KT[Jx];return QT}(0,St),sy=qe*cr;if(qf>=sy||-qf>=sy||(Xn=Cr-(_a+(Ri=Cr-_a))+(Ri-fr),Wn=Vn-(eo+(Ri=Vn-eo))+(Ri-fr),Ji=lr-(jo+(Ri=lr-jo))+(Ri-ar),Rr=Or-(_o+(Ri=Or-_o))+(Ri-ar),Xn===0&&Ji===0&&Wn===0&&Rr===0)||(sy=ot*cr+_e*Math.abs(qf),(qf+=_a*Rr+_o*Xn-(jo*Wn+eo*Ji))>=sy||-qf>=sy))return qf;nt[0]=(Fa=(Dr=Xn-(pr=(Tn=ue*Xn)-(Tn-Xn)))*(ua=_o-(xr=(Tn=ue*_o)-(Tn-_o)))-((Ja=Xn*_o)-pr*xr-Dr*xr-pr*ua))-((Qn=Fa-(Eh=(Dr=Ji-(pr=(Tn=ue*Ji)-(Tn-Ji)))*(ua=eo-(xr=(Tn=ue*eo)-(Tn-eo)))-((ws=Ji*eo)-pr*xr-Dr*xr-pr*ua)))+(Ri=Fa-Qn))+(Ri-Eh),nt[1]=(bs=Ja-((oa=Ja+Qn)-(Ri=oa-Ja))+(Qn-Ri))-((Qn=bs-ws)+(Ri=bs-Qn))+(Ri-ws),nt[2]=oa-((ha=oa+Qn)-(Ri=ha-oa))+(Qn-Ri),nt[3]=ha;var mI=ze(4,St,4,nt,gt);nt[0]=(Fa=(Dr=_a-(pr=(Tn=ue*_a)-(Tn-_a)))*(ua=Rr-(xr=(Tn=ue*Rr)-(Tn-Rr)))-((Ja=_a*Rr)-pr*xr-Dr*xr-pr*ua))-((Qn=Fa-(Eh=(Dr=jo-(pr=(Tn=ue*jo)-(Tn-jo)))*(ua=Wn-(xr=(Tn=ue*Wn)-(Tn-Wn)))-((ws=jo*Wn)-pr*xr-Dr*xr-pr*ua)))+(Ri=Fa-Qn))+(Ri-Eh),nt[1]=(bs=Ja-((oa=Ja+Qn)-(Ri=oa-Ja))+(Qn-Ri))-((Qn=bs-ws)+(Ri=bs-Qn))+(Ri-ws),nt[2]=oa-((ha=oa+Qn)-(Ri=ha-oa))+(Qn-Ri),nt[3]=ha;var gI=ze(mI,gt,4,nt,xt);nt[0]=(Fa=(Dr=Xn-(pr=(Tn=ue*Xn)-(Tn-Xn)))*(ua=Rr-(xr=(Tn=ue*Rr)-(Tn-Rr)))-((Ja=Xn*Rr)-pr*xr-Dr*xr-pr*ua))-((Qn=Fa-(Eh=(Dr=Ji-(pr=(Tn=ue*Ji)-(Tn-Ji)))*(ua=Wn-(xr=(Tn=ue*Wn)-(Tn-Wn)))-((ws=Ji*Wn)-pr*xr-Dr*xr-pr*ua)))+(Ri=Fa-Qn))+(Ri-Eh),nt[1]=(bs=Ja-((oa=Ja+Qn)-(Ri=oa-Ja))+(Qn-Ri))-((Qn=bs-ws)+(Ri=bs-Qn))+(Ri-ws),nt[2]=oa-((ha=oa+Qn)-(Ri=ha-oa))+(Qn-Ri),nt[3]=ha;var _I=ze(gI,xt,4,nt,Rt);return Rt[_I-1]}(qt,Ht,ui,Ii,hn,dn,fn)}(me[0],me[1],xe[0],xe[1],ct[0],ct[1]);return Ft>0?-1:Ft<0?1:0}function it(me,xe){var ct=me.point,Ft=xe.point;return ct[0]>Ft[0]?1:ct[0]<Ft[0]?-1:ct[1]!==Ft[1]?ct[1]>Ft[1]?1:-1:function(qt,Ht,ui,Ii){return qt.left!==Ht.left?qt.left?1:-1:yt(ui,qt.otherEvent.point,Ht.otherEvent.point)!==0?qt.isBelow(Ht.otherEvent.point)?-1:1:!qt.isSubject&&Ht.isSubject?1:-1}(me,xe,ct)}function rt(me,xe,ct){var Ft=new he(xe,!1,me,me.isSubject),qt=new he(xe,!0,me.otherEvent,me.isSubject);return X(me.point,me.otherEvent.point)&&console.warn("what is that, a collapsed segment?",me),Ft.contourId=qt.contourId=me.contourId,it(qt,me.otherEvent)>0&&(me.otherEvent.left=!0,qt.left=!1),me.otherEvent.otherEvent=qt,me.otherEvent=Ft,ct.push(qt),ct.push(Ft),ct}function Dt(me,xe){return me[0]*xe[1]-me[1]*xe[0]}function Ot(me,xe){return me[0]*xe[0]+me[1]*xe[1]}function hi(me,xe,ct){var Ft=function(hn,dn,Wi,Hn,rr){var fn=[dn[0]-hn[0],dn[1]-hn[1]],Cr=[Hn[0]-Wi[0],Hn[1]-Wi[1]];function lr(Tn,pr,Dr){return[Tn[0]+pr*Dr[0],Tn[1]+pr*Dr[1]]}var Vn=[Wi[0]-hn[0],Wi[1]-hn[1]],Or=Dt(fn,Cr),fr=Or*Or,ar=Ot(fn,fn);if(fr>0){var cr=Dt(Vn,Cr)/Or;if(cr<0||cr>1)return null;var Xn=Dt(Vn,fn)/Or;return Xn<0||Xn>1?null:cr===0||cr===1?[lr(hn,cr,fn)]:Xn===0||Xn===1?[lr(Wi,Xn,Cr)]:[lr(hn,cr,fn)]}if((fr=(Or=Dt(Vn,fn))*Or)>0)return null;var Ji=Ot(fn,Vn)/ar,Wn=Ji+Ot(fn,Cr)/ar,Rr=Math.min(Ji,Wn),Ri=Math.max(Ji,Wn);return Rr<=1&&Ri>=0?Rr===1?[lr(hn,Rr>0?Rr:0,fn)]:Ri===0?[lr(hn,Ri<1?Ri:1,fn)]:[lr(hn,Rr>0?Rr:0,fn),lr(hn,Ri<1?Ri:1,fn)]:null}(me.point,me.otherEvent.point,xe.point,xe.otherEvent.point),qt=Ft?Ft.length:0;if(qt===0||qt===1&&(X(me.point,xe.point)||X(me.otherEvent.point,xe.otherEvent.point))||qt===2&&me.isSubject===xe.isSubject)return 0;if(qt===1)return X(me.point,Ft[0])||X(me.otherEvent.point,Ft[0])||rt(me,Ft[0],ct),X(xe.point,Ft[0])||X(xe.otherEvent.point,Ft[0])||rt(xe,Ft[0],ct),1;var Ht=[],ui=!1,Ii=!1;return X(me.point,xe.point)?ui=!0:it(me,xe)===1?Ht.push(xe,me):Ht.push(me,xe),X(me.otherEvent.point,xe.otherEvent.point)?Ii=!0:it(me.otherEvent,xe.otherEvent)===1?Ht.push(xe.otherEvent,me.otherEvent):Ht.push(me.otherEvent,xe.otherEvent),ui&&Ii||ui?(xe.type=T,me.type=xe.inOut===me.inOut?M:R,ui&&!Ii&&rt(Ht[1].otherEvent,Ht[0].point,ct),2):Ii?(rt(Ht[0],Ht[1].point,ct),3):Ht[0]!==Ht[3].otherEvent?(rt(Ht[0],Ht[1].point,ct),rt(Ht[1],Ht[2].point,ct),3):(rt(Ht[0],Ht[1].point,ct),rt(Ht[3].otherEvent,Ht[2].point,ct),3)}function ti(me,xe){if(me===xe)return 0;if(yt(me.point,me.otherEvent.point,xe.point)!==0||yt(me.point,me.otherEvent.point,xe.otherEvent.point)!==0)return X(me.point,xe.point)?me.isBelow(xe.otherEvent.point)?-1:1:me.point[0]===xe.point[0]?me.point[1]<xe.point[1]?-1:1:it(me,xe)===1?xe.isAbove(me.point)?-1:1:me.isBelow(xe.point)?-1:1;if(me.isSubject!==xe.isSubject)return me.isSubject?-1:1;var ct=me.point,Ft=xe.point;return ct[0]===Ft[0]&&ct[1]===Ft[1]?(ct=me.otherEvent.point)[0]===(Ft=xe.otherEvent.point)[0]&&ct[1]===Ft[1]?0:me.contourId>xe.contourId?1:-1:it(me,xe)===1?1:-1}var Gt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function It(me,xe,ct,Ft){var qt,Ht=me+1,ui=xe[me].point,Ii=xe.length;for(Ht<Ii&&(qt=xe[Ht].point);Ht<Ii&&qt[0]===ui[0]&&qt[1]===ui[1];){if(!ct[Ht])return Ht;++Ht<Ii&&(qt=xe[Ht].point)}for(Ht=me-1;ct[Ht]&&Ht>Ft;)Ht--;return Ht}Gt.prototype.isExterior=function(){return this.holeOf==null};var ji=li,si=li;function li(me,xe){if(!(this instanceof li))return new li(me,xe);if(this.data=me||[],this.length=this.data.length,this.compare=xe||Oi,this.length>0)for(var ct=(this.length>>1)-1;ct>=0;ct--)this._down(ct)}function Oi(me,xe){return me<xe?-1:me>xe?1:0}li.prototype={push:function(me){this.data.push(me),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var me=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),me}},peek:function(){return this.data[0]},_up:function(me){for(var xe=this.data,ct=this.compare,Ft=xe[me];me>0;){var qt=me-1>>1,Ht=xe[qt];if(ct(Ft,Ht)>=0)break;xe[me]=Ht,me=qt}xe[me]=Ft},_down:function(me){for(var xe=this.data,ct=this.compare,Ft=this.length>>1,qt=xe[me];me<Ft;){var Ht=1+(me<<1),ui=Ht+1,Ii=xe[Ht];if(ui<this.length&&ct(xe[ui],Ii)<0&&(Ht=ui,Ii=xe[ui]),ct(Ii,qt)>=0)break;xe[me]=Ii,me=Ht}xe[me]=qt}},ji.default=si;var qi=Math.max,$i=Math.min,en=0;function Qi(me,xe,ct,Ft,qt,Ht){var ui,Ii,hn,dn,Wi,Hn;for(ui=0,Ii=me.length-1;ui<Ii;ui++)if(dn=me[ui+1],Wi=new he(hn=me[ui],!1,void 0,xe),Hn=new he(dn,!1,Wi,xe),Wi.otherEvent=Hn,hn[0]!==dn[0]||hn[1]!==dn[1]){Wi.contourId=Hn.contourId=ct,Ht||(Wi.isExteriorRing=!1,Hn.isExteriorRing=!1),it(Wi,Hn)>0?Hn.left=!0:Wi.left=!0;var rr=hn[0],fn=hn[1];qt[0]=$i(qt[0],rr),qt[1]=$i(qt[1],fn),qt[2]=qi(qt[2],rr),qt[3]=qi(qt[3],fn),Ft.push(Wi),Ft.push(Hn)}}var Xi=[];function Kn(me,xe,ct){typeof me[0][0][0]=="number"&&(me=[me]),typeof xe[0][0][0]=="number"&&(xe=[xe]);var Ft=function(fn,Cr,lr){var Vn=null;return fn.length*Cr.length==0&&(lr===D?Vn=Xi:lr===F?Vn=fn:lr!==B&&lr!==q||(Vn=fn.length===0?Cr:fn)),Vn}(me,xe,ct);if(Ft)return Ft===Xi?null:Ft;var qt=[1/0,1/0,-1/0,-1/0],Ht=[1/0,1/0,-1/0,-1/0],ui=function(fn,Cr,lr,Vn,Or){var fr,ar,cr,Xn,Ji,Wn,Rr=new ji(null,it);for(cr=0,Xn=fn.length;cr<Xn;cr++)for(Ji=0,Wn=(fr=fn[cr]).length;Ji<Wn;Ji++)(ar=Ji===0)&&en++,Qi(fr[Ji],!0,en,Rr,lr,ar);for(cr=0,Xn=Cr.length;cr<Xn;cr++)for(Ji=0,Wn=(fr=Cr[cr]).length;Ji<Wn;Ji++)ar=Ji===0,Or===F&&(ar=!1),ar&&en++,Qi(fr[Ji],!1,en,Rr,Vn,ar);return Rr}(me,xe,qt,Ht,ct);if(Ft=function(fn,Cr,lr,Vn,Or){var fr=null;return(lr[0]>Vn[2]||Vn[0]>lr[2]||lr[1]>Vn[3]||Vn[1]>lr[3])&&(Or===D?fr=Xi:Or===F?fr=fn:Or!==B&&Or!==q||(fr=fn.concat(Cr))),fr}(me,xe,qt,Ht,ct))return Ft===Xi?null:Ft;for(var Ii=function(fn){var Cr,lr,Vn=function(cr){var Xn,Ji,Wn,Rr,Ri=[];for(Ji=0,Wn=cr.length;Ji<Wn;Ji++)((Xn=cr[Ji]).left&&Xn.inResult||!Xn.left&&Xn.otherEvent.inResult)&&Ri.push(Xn);for(var Tn=!1;!Tn;)for(Tn=!0,Ji=0,Wn=Ri.length;Ji<Wn;Ji++)Ji+1<Wn&&it(Ri[Ji],Ri[Ji+1])===1&&(Rr=Ri[Ji],Ri[Ji]=Ri[Ji+1],Ri[Ji+1]=Rr,Tn=!1);for(Ji=0,Wn=Ri.length;Ji<Wn;Ji++)(Xn=Ri[Ji]).otherPos=Ji;for(Ji=0,Wn=Ri.length;Ji<Wn;Ji++)(Xn=Ri[Ji]).left||(Rr=Xn.otherPos,Xn.otherPos=Xn.otherEvent.otherPos,Xn.otherEvent.otherPos=Rr);return Ri}(fn),Or={},fr=[],ar=function(){if(!Or[Cr]){var cr=fr.length,Xn=function(Ri,Tn,pr){var Dr=new Gt;if(Ri.prevInResult!=null){var xr=Ri.prevInResult,ua=xr.outputContourId;if(xr.resultTransition>0){var Qn=Tn[ua];if(Qn.holeOf!=null){var oa=Qn.holeOf;Tn[oa].holeIds.push(pr),Dr.holeOf=oa,Dr.depth=Tn[ua].depth}else Tn[ua].holeIds.push(pr),Dr.holeOf=ua,Dr.depth=Tn[ua].depth+1}else Dr.holeOf=null,Dr.depth=Tn[ua].depth}else Dr.holeOf=null,Dr.depth=0;return Dr}(Vn[Cr],fr,cr),Ji=function(Ri){Or[Ri]=!0,Ri<Vn.length&&Vn[Ri]&&(Vn[Ri].outputContourId=cr)},Wn=Cr,Rr=Cr;for(Xn.points.push(Vn[Cr].point);Ji(Wn),Ji(Wn=Vn[Wn].otherPos),Xn.points.push(Vn[Wn].point),!((Wn=It(Wn,Vn,Or,Rr))==Rr||Wn>=Vn.length)&&Vn[Wn];);fr.push(Xn)}};for(Cr=0,lr=Vn.length;Cr<lr;Cr++)ar();return fr}(function(fn,Cr,lr,Vn,Or,fr){for(var ar,cr,Xn,Ji=new l(ti),Wn=[],Rr=Math.min(Vn[2],Or[2]);fn.length!==0;){var Ri=fn.pop();if(Wn.push(Ri),fr===D&&Ri.point[0]>Rr||fr===F&&Ri.point[0]>Vn[2])break;if(Ri.left){cr=ar=Ji.insert(Ri),ar=ar!==(Xn=Ji.minNode())?Ji.prev(ar):null,cr=Ji.next(cr);var Tn=ar?ar.key:null;if(J(Ri,Tn,fr),cr&&hi(Ri,cr.key,fn)===2&&(J(Ri,Tn,fr),J(cr.key,Ri,fr)),ar&&hi(ar.key,Ri,fn)===2){var pr=ar;J(Tn,(pr=pr!==Xn?Ji.prev(pr):null)?pr.key:null,fr),J(Ri,Tn,fr)}}else cr=ar=Ji.find(Ri=Ri.otherEvent),ar&&cr&&(ar=ar!==Xn?Ji.prev(ar):null,cr=Ji.next(cr),Ji.remove(Ri),cr&&ar&&hi(ar.key,cr.key,fn))}return Wn}(ui,0,0,qt,Ht,ct)),hn=[],dn=0;dn<Ii.length;dn++){var Wi=Ii[dn];if(Wi.isExterior()){for(var Hn=[Wi.points],rr=0;rr<Wi.holeIds.length;rr++)Hn.push(Ii[Wi.holeIds[rr]].points);hn.push(Hn)}}return hn}var sr={UNION:B,DIFFERENCE:F,INTERSECTION:D,XOR:q};i.diff=function(me,xe){return Kn(me,xe,F)},i.intersection=function(me,xe){return Kn(me,xe,D)},i.operations=sr,i.union=function(me,xe){return Kn(me,xe,B)},i.xor=function(me,xe){return Kn(me,xe,q)},Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,T_.exports)),T_.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function ug(n,e,i,o){const l=[],d=o===0?(f,y,x,T,M,R)=>{f.push(new Bt(R,x+(R-y)/(T-y)*(M-x)))}:(f,y,x,T,M,R)=>{f.push(new Bt(y+(R-x)/(M-x)*(T-y),R))};for(const f of n){const y=[];for(const x of f){if(x.length<=2)continue;const T=[];for(let D=0;D<x.length-1;D++){const B=x[D].x,F=x[D].y,q=x[D+1].x,J=x[D+1].y,te=o===0?B:F,he=o===0?q:J;te<e?he>e&&d(T,B,F,q,J,e):te>i?he<i&&d(T,B,F,q,J,i):T.push(x[D]),he<e&&te>=e&&d(T,B,F,q,J,e),he>i&&te<=i&&d(T,B,F,q,J,i)}let M=x[x.length-1];const R=o===0?M.x:M.y;R>=e&&R<=i&&T.push(M),T.length&&(M=T[T.length-1],T[0].x===M.x&&T[0].y===M.y||T.push(T[0]),y.push(T))}y.length&&l.push(y)}return l}function rx(n,e){const i=S_(n),o=S_([e]),l=Jy.intersection(i,o);return l==null?[]:ev(l)}function ax(n,e){let o=S_(n,65536);for(;e.valid();e.next()){const[l,d]=e.get(),f=l.x*65536,y=l.y*65536,x=d.x*65536,T=d.y*65536,M=x-f,R=T-y,D=Math.hypot(M,R),B=Math.trunc(R/D*3),F=-Math.trunc(M/D*3);o=Jy.diff(o,[[[f,y],[x,T],[x+B,T+F],[f+B,y+F],[f,y]]])}return ev(o,1/65536)}function S_(n,e=1){return[n.map(i=>i.map(o=>[o.x*e,o.y*e]))]}function ev(n,e=1){return n.map(i=>i.map((o,l)=>{const d=o.map(f=>new Bt(f[0]*e,f[1]*e).round());return l>0&&d.reverse(),d}))}class E_{constructor(e,i){this.layoutVertexArray=new Vs,this.indexArray=new Pr,this.lineIndexArray=new Pl,this.triangleSegments=new vr,this.lineSegments=new vr,this.programConfigurations=new Tc(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new fu)}update(e,i,o,l,d,f,y){this.programConfigurations.updatePaintArrays(e,i,d,o,l,f,y)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ex.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,p_.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,o,l,d,f){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,o,l,d,f)}}class hg{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new E_(e,!1),this.elevationBufferData=new E_(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(e,i){}populate(e,i,o,l){this.hasPattern=Pf("fill",this.layers,this.pixelRatio,i);const d=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:M}of e){const R=this.layers[0]._featureFilter.needGeometry,D=ai(y,R);if(!this.layers[0]._featureFilter.filter(new Fn(this.zoom),D,o))continue;const B=d?d.evaluate(D,{},o,i.availableImages):void 0,F={id:x,properties:y.properties,type:y.type,sourceLayerIndex:M,index:T,geometry:R?D.geometry:Qt(y,o,l),patterns:{},sortKey:B};f.push(F)}d&&f.sort((y,x)=>y.sortKey-x.sortKey);for(const y of f){const{geometry:x,index:T,sourceLayerIndex:M}=y;if(this.hasPattern){const R=ag("fill",this.layers,y,this.zoom,this.pixelRatio,i);this.patternFeatures.push(R)}else this.addFeature(y,x,T,o,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[T].feature,x,T,M,this.index)}}update(e,i,o,l,d,f,y){this.bufferData.update(e,i,o,l,d,f,y),this.elevationBufferData.update(e,i,o,l,d,f,y)}addFeatures(e,i,o,l,d,f){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,i,o,l,f,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,o,l,d,f=[],y,x){const T=ng(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,T,l,o,x):this.addGeometry(T,this.bufferData),this.bufferData.populatePaintArrays(e,o,d,f,l,y),this.elevationBufferData.populatePaintArrays(e,o,d,f,l,y)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e){this.elevatedStructures&&this.elevatedStructures.construct(e)}addElevatedRoadFeature(e,i,o,l,d){const f=new Array,y=ys.getElevationFeature(e,d);if(y){{const x=this.clipPolygonsToTile(i,1);x.length>0&&f.push({polygons:x,elevationFeature:y,elevationTileID:o})}for(const x of f)if(x.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new vs(x.elevationTileID));const M=x.elevationFeature.isTunnel();let R=0;e.properties.hasOwnProperty(Ky)&&(R=+e.properties[Ky]);for(const D of x.polygons)this.elevatedStructures.addPortalCandidates(x.elevationFeature.id,D,M,x.elevationFeature,R)}x.elevationFeature.constantHeight==null&&(x.polygons=this.prepareElevatedPolygons(x.polygons,x.elevationFeature,x.elevationTileID));const T=new w_(o,x.elevationTileID);this.addElevatedGeometry(x.polygons,T,x.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,l)}}else this.addGeometry(i,this.bufferData)}addElevatedGeometry(e,i,o,l,d){const f={elevation:o,elevationSampler:i,bias:l,index:d},[y,x]=this.addGeometry(e,this.elevationBufferData,f);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:y,max:x}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,y),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,x))}addGeometry(e,i,o){let l=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,f=null;o&&(f=o.elevationSampler.constantElevation(o.elevation,o.bias),f!=null&&(l=f,d=f));const y=(x,T,M)=>{if(o!=null)if(T.push(x),f!=null)i.elevatedLayoutVertexArray.emplaceBack(f),M.push(f);else{const R=o.elevationSampler.pointElevation(x,o.elevation,o.bias);i.elevatedLayoutVertexArray.emplaceBack(R),M.push(R),l=Math.min(l,R),d=Math.max(d,R)}};for(const x of e){let T=0;for(const ce of x)T+=ce.length;const M=i.triangleSegments.prepareSegment(T,i.layoutVertexArray,i.indexArray),R=M.vertexLength,D=[],B=[],F=[],q=[],J=[],te=i.layoutVertexArray.length;for(const ce of x){if(ce.length===0)continue;ce!==x[0]&&B.push(D.length/2);const X=i.lineSegments.prepareSegment(ce.length,i.layoutVertexArray,i.lineIndexArray),re=X.vertexLength;o&&J.push(i.layoutVertexArray.length-te),y(ce[0],F,q),i.layoutVertexArray.emplaceBack(ce[0].x,ce[0].y),i.lineIndexArray.emplaceBack(re+ce.length-1,re),D.push(ce[0].x),D.push(ce[0].y);for(let ue=1;ue<ce.length;ue++)y(ce[ue],F,q),i.layoutVertexArray.emplaceBack(ce[ue].x,ce[ue].y),i.lineIndexArray.emplaceBack(re+ue-1,re+ue),D.push(ce[ue].x),D.push(ce[ue].y);X.vertexLength+=ce.length,X.primitiveLength+=ce.length}const he=Yp(D,B);for(let ce=0;ce<he.length;ce+=3)i.indexArray.emplaceBack(R+he[ce],R+he[ce+1],R+he[ce+2]);if(he.length>0&&o&&this.elevationMode==="hd-road-base"){const ce=o.elevation.isTunnel(),X=o.elevation.safeArea,re=this.elevatedStructures.addVertices(F,q);this.elevatedStructures.addTriangles(he,re,ce);const ue=J.length;if(ue>0){for(let _e=0;_e<ue-1;_e++)this.elevatedStructures.addRenderableRing(o.index,J[_e]+re,J[_e+1]-J[_e],ce,X);this.elevatedStructures.addRenderableRing(o.index,J[ue-1]+re,F.length-J[ue-1],ce,X)}}M.vertexLength+=T,M.primitiveLength+=he.length/3}return[l,d]}prepareElevatedPolygons(e,i,o){const l=1/$e(o),d=[];for(const f of e){const y=ax(f,new b_(i,l));d.push(...y)}return d}clipPolygonsToTile(e,i){const o=-i,l=-i,d=Ut+i,f=Ut+i;let y=0;const x=[],T=[];for(;y<e.length;y++){const D=e[y],B=af(D);(B.min.x>=o&&B.max.x<=d&&B.min.y>=l&&B.max.y<=f?x:T).push(D)}if(x.length===e.length)return e;const M=[new Bt(o,l),new Bt(d,l),new Bt(d,f),new Bt(o,f),new Bt(o,l)],R=x;for(const D of T)R.push(...rx(D,M));return R}}let Fd,Lf,A_,tv;Wt(hg,"FillBucket",{omit:["layers","patternFeatures"]}),Wt(E_,"FillBufferData"),Wt(vs,"ElevatedStructures");class wh{constructor(e,i,o,l){if(this.triangleCount=i.length/3,this.min=new Bt(0,0),this.max=new Bt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[d,f]=[e[0].clone(),e[0].clone()];for(let R=1;R<e.length;++R){const D=e[R];d.x=Math.min(d.x,D.x),d.y=Math.min(d.y,D.y),f.x=Math.max(f.x,D.x),f.y=Math.max(f.y,D.y)}if(l){const R=Math.ceil(Math.max(f.x-d.x,f.y-d.y)/l);o=Math.max(o,R)}if(o===0)return;this.min=d,this.max=f;const y=this.max.sub(this.min);y.x=Math.max(y.x,1),y.y=Math.max(y.y,1);const x=Math.max(y.x,y.y)/o;this.cellsX=Math.max(1,Math.ceil(y.x/x)),this.cellsY=Math.max(1,Math.ceil(y.y/x)),this.xScale=1/x,this.yScale=1/x;const T=[];for(let R=0;R<this.triangleCount;R++){const D=e[i[3*R+0]].sub(this.min),B=e[i[3*R+1]].sub(this.min),F=e[i[3*R+2]].sub(this.min),q=xs(Math.floor(Math.min(D.x,B.x,F.x)),this.xScale,this.cellsX),J=xs(Math.floor(Math.max(D.x,B.x,F.x)),this.xScale,this.cellsX),te=xs(Math.floor(Math.min(D.y,B.y,F.y)),this.yScale,this.cellsY),he=xs(Math.floor(Math.max(D.y,B.y,F.y)),this.yScale,this.cellsY),ce=new Bt(0,0),X=new Bt(0,0),re=new Bt(0,0),ue=new Bt(0,0);for(let _e=te;_e<=he;++_e){ce.y=X.y=_e*x,re.y=ue.y=(_e+1)*x;for(let ze=q;ze<=J;++ze)ce.x=re.x=ze*x,X.x=ue.x=(ze+1)*x,(tr(D,B,F,ce,X,ue)||tr(D,B,F,ce,ue,re))&&T.push({cellIdx:_e*this.cellsX+ze,triIdx:R})}}if(T.length===0)return;T.sort((R,D)=>R.cellIdx-D.cellIdx||R.triIdx-D.triIdx);let M=0;for(;M<T.length;){const R=T[M].cellIdx,D={start:this.payload.length,len:0};for(;M<T.length&&T[M].cellIdx===R;)++D.len,this.payload.push(T[M++].triIdx);this.cells[R]=D}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const o=xs(e.x-this.min.x,this.xScale,this.cellsX),l=xs(e.y-this.min.y,this.yScale,this.cellsY),d=this.cells[l*this.cellsX+o];if(d){this._lazyInitLookup();for(let f=0;f<d.len;f++){const y=this.payload[d.start+f],x=Math.floor(y/8),T=1<<y%8;if(!(this.lookup[x]&T)&&(this.lookup[x]|=T,i.push(y),i.length===this.triangleCount))return}}}query(e,i,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const l=xs(e.x-this.min.x,this.xScale,this.cellsX),d=xs(i.x-this.min.x,this.xScale,this.cellsX),f=xs(e.y-this.min.y,this.yScale,this.cellsY),y=xs(i.y-this.min.y,this.yScale,this.cellsY);for(let x=f;x<=y;x++)for(let T=l;T<=d;T++){const M=this.cells[x*this.cellsX+T];if(M)for(let R=0;R<M.len;R++){const D=this.payload[M.start+R],B=Math.floor(D/8),F=1<<D%8;if(!(this.lookup[B]&F)&&(this.lookup[B]|=F,o.push(D),o.length===this.triangleCount))return}}}}function xs(n,e,i){return Math.max(0,Math.min(i-1,Math.floor(n*e)))}Wt(wh,"TriangleGridIndex");class M_{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(e,i){for(const o of this.footprints)i.push({footprint:o,id:e})}populate(e,i,o,l){const d=[];for(const{feature:f,id:y,index:x,sourceLayerIndex:T}of e){const M=this.layers[0]._featureFilter.needGeometry,R=ai(f,M);if(!this.layers[0]._featureFilter.filter(new Fn(this.zoom),R,o))continue;const D={id:y,properties:f.properties,type:f.type,sourceLayerIndex:T,index:x,geometry:M?R.geometry:Qt(f,o,l),patterns:{}};d.push(D)}for(const f of d){const{geometry:y,index:x,sourceLayerIndex:T}=f;this.addFeature(f,y,x,o,{},i.availableImages,i.brightness),i.featureIndex.insert(e[x].feature,y,x,T,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,o,l,d,f,y){}destroy(){}addFeature(e,i,o,l,d,f=[],y){for(const x of ng(i,2)){const T=[],M=[],R=[],D=new Bt(1/0,1/0),B=new Bt(-1/0,-1/0);for(const J of x)if(J.length!==0){J!==x[0]&&R.push(M.length/2);for(let te=0;te<J.length;te++)M.push(J[te].x),M.push(J[te].y),T.push(J[te]),D.x=Math.min(D.x,J[te].x),D.y=Math.min(D.y,J[te].y),B.x=Math.max(B.x,J[te].x),B.y=Math.max(B.y,J[te].y)}const F=Yp(M,R),q=new wh(T,F,8,256);this.footprints.push({vertices:T,indices:F,grid:q,min:D,max:B})}}}Wt(M_,"ClipBucket",{omit:["layers"]});const dg=bn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),C_=bn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),R_=bn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),fg=bn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),iv=bn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),nv=bn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:ox}=dg,rm=Number.MAX_SAFE_INTEGER;function Of(n,e,i,o){return n.order<e||n.order===rm||!(n.clipMask&i)||function(l,d){return d.length!==0&&d.find(f=>f===l)===void 0}(o,n.clipScope)}function pg(n,e){return n.x-e.x||n.y-e.y}function rv(n,e){return pg(n.min,e.min)===0&&pg(n.max,e.max)===0}function I_(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function kf(n,e){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(n[i].sourceId!==e[i].sourceId||!rv(n[i],e[i])||n[i].order!==e[i].order||n[i].clipMask!==e[i].clipMask||!Go(n[i].clipScope,e[i].clipScope))return!1;return!0}function am(n,e,i){const o=1/Ut,l=1/(1<<i.canonical.z),d=(e.x*o+i.canonical.x)*l+i.wrap,f=(e.y*o+i.canonical.y)*l;return{min:new Bt((n.x*o+i.canonical.x)*l+i.wrap,(n.y*o+i.canonical.y)*l),max:new Bt(d,f)}}function D_(n,e,i){const o=1<<i.canonical.z,l=((e.x-i.wrap)*o-i.canonical.x)*Ut,d=(e.y*o-i.canonical.y)*Ut;return{min:new Bt(((n.x-i.wrap)*o-i.canonical.x)*Ut,(n.y*o-i.canonical.y)*Ut),max:new Bt(l,d)}}function av(n,e,i,o,l,d,f){const y=n.indices,x=n.vertices,T=[];for(let M=o;M<o+l;M+=3){const R=e[i[M+0]+d],D=e[i[M+1]+d],B=e[i[M+2]+d],F=Math.min(R.x,D.x,B.x),q=Math.max(R.x,D.x,B.x),J=Math.min(R.y,D.y,B.y),te=Math.max(R.y,D.y,B.y);T.length=0,n.grid.query(new Bt(F,J),new Bt(q,te),T);for(let he=0;he<T.length;he++){const ce=T[he];if(tr(x[y[3*ce+0]],x[y[3*ce+1]],x[y[3*ce+2]],R,D,B,f))return!0}}return!1}function Nf(n,e,i,o){if(!n||!i)return!1;let l=n.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(i.vertices.length<n.vertices.length)return Nf(i,o,n,e);const d=e.canonical,f=o.canonical,y=Math.pow(2,f.z-d.z);l=n.vertices.map(x=>new Bt((x.x+d.x*Ut)*y-f.x*Ut,(x.y+d.y*Ut)*y-f.y*Ut))}return av(i,l,n.indices,0,n.indices.length,0,0)}function ov(n,e,i,o){const l=Math.pow(2,o.z-i.z);return new Bt((n+i.x*Ut)*l-o.x*Ut,(e+i.y*Ut)*l-o.y*Ut)}function z_(n,e){const i=[];e.grid.queryPoint(n,i);const o=e.indices,l=e.vertices;for(let d=0;d<i.length;d++){const f=i[d];if(wn([l[o[3*f+0]],l[o[3*f+1]],l[o[3*f+2]]],n))return!0}return!1}const mg=[new Bt(0,0),new Bt(Ut,0),new Bt(Ut,Ut),new Bt(0,Ut)];function P_(n,e){const i=[];let o=[];if(!e||n.length<2)return[n];if(n.length===2)return er(n[0],n[1],mg)?[n]:[];for(let l=0;l<n.length+2;l++){const d=n[l%n.length],f=n[(l+1)%n.length],y=er(l===0?n[n.length-1]:n[(l-1)%n.length],d,mg),x=er(d,f,mg),T=y||x;T&&o.push(d),T&&x||o.length>0&&(o.length>1&&i.push(o),o=[])}return o.length>1&&i.push(o),i}const gg=Ec.VectorTileFeature.types,L_=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],sv=["fill-extrusion-flood-light-ground-radius"],_g=Math.pow(2,13),sx=Math.pow(2,15)-1,lv=new Bt(0,1),Ac=2147483648;function jd(n,e,i,o,l,d,f,y){n.emplaceBack((e<<1)+f,(i<<1)+d,(Math.floor(o*_g)<<1)+l,Math.round(y))}function Th(n,e,i){n.emplaceBack(e.x*Ut,e.y*Ut,i?1:0)}function Bf(n,e,i,o,l,d){n.emplaceBack(e.x,e.y,(i.x<<1)+o,(i.y<<1)+l,d)}function Ff(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class yg{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Eu{constructor(){this.centroidXY=new Bt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Bt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Bt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Bt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Au{constructor(){this.acc=new Bt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,o){this.accCount++,this.acc._add(i);let l=!!this.borders;i.x<e.min.x?(e.min.x=i.x,l=!0):i.x>e.max.x&&(e.max.x=i.x,l=!0),i.y<e.min.y?(e.min.y=i.y,l=!0):i.y>e.max.y&&(e.max.y=i.y,l=!0),((i.x===0||i.x===Ut)&&i.x===o.x)!=((i.y===0||i.y===Ut)&&i.y===o.y)&&this.processBorderOverlap(i,o),l&&this.checkBorderIntersection(i,o)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Ti(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Ut!=e.x>Ut&&this.addBorderIntersection(1,Ti(i.y,e.y,(Ut-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Ti(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Ut!=e.y>Ut&&this.addBorderIntersection(3,Ti(i.x,e.x,(Ut-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new Bt(0,0):new Bt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function Mu(n,e){const i=n.add(e)._unit(),o=Me(n.x*i.x+n.y*i.y,-1,1);var l,d,f;return l=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(l)))/4*sx*((d=n).x*(f=e).y-d.y*f.x<0?-1:1)}const om=[n=>n.x<0,n=>n.x>Ut,n=>n.y<0,n=>n.y>Ut];function sm(n,e,i,o){const l=[4];if(o===0)return l;i._mult(o);const d=n.sub(i),f=e.sub(i),y=[n,e,d,f];for(let x=0;x<4;x++)for(const T of y)if(om[x](T)){l.push(x);break}return l}class Cu{constructor(e){this.vertexArray=new Sf,this.indexArray=new Pr,this.programConfigurations=new Tc(e.layers,{zoom:e.zoom,lut:e.lut},i=>sv.includes(i)),this._segments=new vr,this.hiddenByLandmarkVertexArray=new vu,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new vr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,o,l=!1){const d=e.length;if(d>2){let f=Math.max(0,this._segments.get().length-1);const y=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[f].length);let x;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{const T=e[0],M=e[1];x=Mu(T.sub(e[d-1])._perp()._unit(),M.sub(T)._perp()._unit())}for(let T=0;T<d;T++){const M=T===d-1?0:T+1,R=e[T],D=e[M],B=e[M===d-1?0:M+1],F=D.sub(R)._perp()._unit(),q=Mu(F,B.sub(D)._perp()._unit()),J=x,te=q;if(xg(R,D,i)||l&&cm(R,i)&&cm(D,i)){x=q;continue}const he=y.vertexLength;Bf(this.vertexArray,R,D,1,1,J),Bf(this.vertexArray,R,D,1,0,J),Bf(this.vertexArray,R,D,0,1,te),Bf(this.vertexArray,R,D,0,0,te),y.vertexLength+=4;const ce=sm(R,D,F,o);for(const X of ce)this._segmentToGroundQuads[f].push({id:he,region:X}),this._segmentToRegionTriCounts[f][X]+=2,y.primitiveLength+=2;x=q}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort((l,d)=>l.region-d.region);for(let o=0;o<i;o++){const l=this._segmentToGroundQuads[o],d=e[o],f=this._segmentToRegionTriCounts[o];f.reduce((x,T)=>x+T,0);let y=0;for(let x=0;x<=4;x++){const T=f[x];if(T!==0){let M=this.regionSegments[x];M||(M=this.regionSegments[x]=new vr);const R={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+y,vertexLength:d.vertexLength,primitiveLength:T};M.get().push(R)}y+=T}for(let x=0;x<l.length;x++){const T=l[x].id;this.indexArray.emplaceBack(T,T+1,T+3),this.indexArray.emplaceBack(T,T+3,T+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,o,l,d,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,o,l,d,f)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,C_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,o,l,d,f,y){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,o,l,d,f,y)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const o=e.flags&Ac?1:0;for(let l=e.groundVertexArrayOffset;l<i;++l)this.hiddenByLandmarkVertexArray.emplace(l,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,iv.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class vg{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Pr,this.footprintVertices=new Vs,this.footprintSegments=[],this.layoutVertexArray=new gc,this.centroidVertexArray=new jp,this.wallVertexArray=new Vp,this.indexArray=new Pr,this.programConfigurations=new Tc(e.layers,{zoom:e.zoom,lut:e.lut},i=>L_.includes(i)),this.segments=new vr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new Cu(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,o,l){this.features=[],this.hasPattern=Pf("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=$e(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:d,id:f,index:y,sourceLayerIndex:x}of e){const T=this.layers[0]._featureFilter.needGeometry,M=ai(d,T);if(!this.layers[0]._featureFilter.filter(new Fn(this.zoom),M,o))continue;const R={id:f,sourceLayerIndex:x,index:y,geometry:T?M.geometry:Qt(d,o,l),properties:d.properties,type:d.type,patterns:{}},D=this.layoutVertexArray.length,B=gg[R.type]==="Polygon";if(this.hasPattern)this.features.push(ag("fill-extrusion",this.layers,R,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const F of R.geometry)for(const q of P_(F,B))this.addFeature(R,[q],y,o,{},i.availableImages,l,i.brightness);else this.addFeature(R,R.geometry,y,o,{},i.availableImages,l,i.brightness);i.featureIndex.insert(d,R.geometry,y,x,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,o,l,d,f){for(const y of this.features){const x=gg[y.type]==="Polygon",{geometry:T}=y;if(this.wallMode)for(const M of T)for(const R of P_(M,x))this.addFeature(y,[R],y.index,i,o,l,d,f);else this.addFeature(y,T,y.index,i,o,l,d,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,o,l,d,f,y){this.programConfigurations.updatePaintArrays(e,i,d,o,l,f,y),this.groundEffect.update(e,i,d,o,l,f,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ox),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,fg.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,nv.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,R_.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,l,d,f,y,x){const T=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,M=[new Bt(0,0),new Bt(Ut,Ut)],R=y.projection,D=R.name==="globe",B=this.wallMode||gg[e.type]==="Polygon",F=new Au;F.centroidDataIndex=this.centroidData.length;const q=new Eu,J=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},l)<=0,te=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},l);let he;if(q.height=te,q.vertexArrayOffset=this.layoutVertexArray.length,q.groundVertexArrayOffset=this.groundEffect.vertexArray.length,D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Gs),this.wallMode){if(D)return void Ui("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;he=function(Ue){const qe=Ue[0].x===Ue[Ue.length-1].x&&Ue[0].y===Ue[Ue.length-1].y;(function(Gt){let It=0;const ji=Gt.length;for(let si=0;si<ji;si++)It+=(Gt[(si+1)%ji].x-Gt[si].x)*(Gt[(si+1)%ji].y+Gt[si].y);return It>=0})(Ue)||(Ue=Ue.reverse());const St={geometry:[],joinNormals:[],indices:[]},gt=[],xt=[],Rt=[];let nt=Ue.length;for(;nt>=2&&Ue[nt-1].equals(Ue[nt-2]);)nt--;if(nt<(qe?3:2))return St;let yt,it,rt,Dt,Ot,hi=0;for(;hi<nt-1&&Ue[hi].equals(Ue[hi+1]);)hi++;qe&&(yt=Ue[nt-2],Ot=Ue[hi].sub(yt)._unit()._perp());for(let Gt=hi;Gt<nt;Gt++){if(rt=Gt===nt-1?qe?Ue[hi+1]:void 0:Ue[Gt+1],rt&&Ue[Gt].equals(rt))continue;Ot&&(Dt=Ot),yt&&(it=yt),yt=Ue[Gt],Ot=rt?rt.sub(yt)._unit()._perp():Dt,Dt=Dt||Ot;let It=Dt.add(Ot);It.x===0&&It.y===0||It._unit();const ji=It.x*Ot.x+It.y*Ot.y,si=ji!==0?1/ji:1/0,li=Dt.x*Ot.y-Dt.y*Ot.x>0;let Oi="miter";const qi=2;Oi==="miter"&&si>qi&&(Oi="bevel"),Oi==="bevel"&&(si>100&&(Oi="flipbevel"),si<qi&&(Oi="miter"));const $i=(en,Qi,Xi,Kn)=>{const sr=new Bt(en.x,en.y),me=new Bt(en.x,en.y);sr.x+=Qi.x*Kn,sr.y+=Qi.y*Kn,me.x-=Qi.x*Math.max(Xi,1),me.y-=Qi.y*Math.max(Xi,1),Rt.push(Qi),gt.push(sr),xt.push(me)};if(Oi==="miter")It._mult(si),$i(yt,It,0,0);else if(Oi==="flipbevel")It=Ot.mult(-1),$i(yt,It,0,0),$i(yt,It.mult(-1),0,0);else{const en=-Math.sqrt(si*si-1),Qi=li?en:0,Xi=li?0:en;it&&$i(yt,Dt,Qi,Xi),rt&&$i(yt,Ot,Qi,Xi)}}St.geometry=[...gt,...xt.reverse(),gt[0]],St.joinNormals=[...Rt,...Rt.reverse(),Rt[Rt.length-1]];const ti=St.geometry.length-1;for(let Gt=0;Gt<ti/2;Gt++)if(Gt+1<ti/2){let It=Gt,ji=Gt+1,si=ti-1-Gt,li=ti-2-Gt;It=It===0?ti-1:It-1,ji=ji===0?ti-1:ji-1,si=si===0?ti-1:si-1,li=li===0?ti-1:li-1,St.indices.push(si),St.indices.push(ji),St.indices.push(It),St.indices.push(si),St.indices.push(li),St.indices.push(ji)}return St}(i[0]),i=[he.geometry]}const ce=(Ue,qe)=>Ue<(qe.length-1)/2||Ue===qe.length-1,X=this.wallMode?[i]:ng(i,500);for(let Ue=X.length-1;Ue>=0;Ue--){const qe=X[Ue];(qe.length===0||(re=qe[0]).every(ot=>ot.x<=0)||re.every(ot=>ot.x>=Ut)||re.every(ot=>ot.y<=0)||re.every(ot=>ot.y>=Ut))&&X.splice(Ue,1)}var re;let ue;if(D)ue=hm(X,M,l);else{ue=[];for(const Ue of X)ue.push({polygon:Ue,bounds:M})}const _e=B?this.edgeRadius:0,ze=_e>0&&this.zoom<17,Ne=(Ue,qe)=>{if(Ue.length===0)return!1;const ot=Ue[Ue.length-1];return qe.x===ot.x&&qe.y===ot.y};for(const{polygon:Ue,bounds:qe}of ue){let ot=0,St=0;for(const nt of Ue)B&&!nt[0].equals(nt[nt.length-1])&&nt.push(nt[0]),St+=B?nt.length-1:nt.length;const gt=this.segments.prepareSegment((B?5:4)*St,this.layoutVertexArray,this.indexArray);q.footprintSegIdx<0&&(q.footprintSegIdx=this.footprintSegments.length),q.polygonSegIdx<0&&(q.polygonSegIdx=this.polygonSegments.length);const xt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Rt=new yg;if(Rt.vertexOffset=this.footprintVertices.length,Rt.indexOffset=3*this.footprintIndices.length,Rt.ringIndices=[],B){const nt=[],yt=[];ot=gt.vertexLength;for(let rt=0;rt<Ue.length;rt++){const Dt=Ue[rt];Dt.length&&rt!==0&&yt.push(nt.length/2);const Ot=[];let hi,ti;hi=Dt[1].sub(Dt[0])._perp()._unit(),Rt.ringIndices.push(Dt.length-1);for(let Gt=1;Gt<Dt.length;Gt++){const It=Dt[Gt],ji=Dt[Gt===Dt.length-1?1:Gt+1],si=It.clone();if(_e){ti=ji.sub(It)._perp()._unit();const li=hi.add(ti)._unit(),Oi=_e*Math.min(4,1/(hi.x*li.x+hi.y*li.y));si.x+=Oi*li.x,si.y+=Oi*li.y,si.x=Math.round(si.x),si.y=Math.round(si.y),hi=ti}if(!J||_e!==0&&!ze||Ne(Ot,si)||Ot.push(si),jd(this.layoutVertexArray,si.x,si.y,0,0,1,1,0),this.wallMode){const li=ce(Gt,Dt);Th(this.wallVertexArray,he.joinNormals[Gt],!li)}gt.vertexLength++,this.footprintVertices.emplaceBack(It.x,It.y),nt.push(It.x,It.y),D&&Ff(this.layoutVertexExtArray,R.projectTilePoint(si.x,si.y,l),R.upVector(l,si.x,si.y))}J&&(_e===0||ze)&&(Ot.length!==0&&Ne(Ot,Ot[0])&&Ot.pop(),this.groundEffect.addData(Ot,qe,T))}const it=this.wallMode?he.indices:Yp(nt,yt);for(let rt=0;rt<it.length;rt+=3)this.footprintIndices.emplaceBack(Rt.vertexOffset+it[rt+0],Rt.vertexOffset+it[rt+1],Rt.vertexOffset+it[rt+2]),this.indexArray.emplaceBack(ot+it[rt],ot+it[rt+2],ot+it[rt+1]),gt.primitiveLength++;Rt.indexCount+=it.length,Rt.vertexCount+=this.footprintVertices.length-Rt.vertexOffset}for(let nt=0;nt<Ue.length;nt++){const yt=Ue[nt];F.startRing(q,yt[0]);let it=yt.length>4&&k_(yt[yt.length-2],yt[0],yt[1]),rt=_e?lm(yt[yt.length-2],yt[0],yt[1],_e):0;const Dt=[];let Ot,hi,ti;hi=yt[1].sub(yt[0])._perp()._unit();let Gt=!0;for(let It=1,ji=0;It<yt.length;It++){let si=yt[It-1],li=yt[It];const Oi=yt[It===yt.length-1?1:It+1];if(F.appendEdge(q,li,si),xg(li,si,qe)){_e&&(hi=Oi.sub(li)._perp()._unit(),Gt=!Gt);continue}const qi=li.sub(si)._perp(),$i=qi.x/(Math.abs(qi.x)+Math.abs(qi.y)),en=qi.y>0?1:0,Qi=si.dist(li);if(ji+Qi>32768&&(ji=0),_e){ti=Oi.sub(li)._perp()._unit();let me=cv(si,li,Oi,O_(hi,ti),_e);isNaN(me)&&(me=0);const xe=li.sub(si)._unit();si=si.add(xe.mult(rt))._round(),li=li.add(xe.mult(-me))._round(),rt=me,hi=ti,J&&this.zoom>=17&&(Ne(Dt,si)||Dt.push(si),Ne(Dt,li)||Dt.push(li))}const Xi=gt.vertexLength,Kn=yt.length>4&&k_(si,li,Oi);let sr=uv(ji,it,Gt);if(jd(this.layoutVertexArray,si.x,si.y,$i,en,0,0,sr),jd(this.layoutVertexArray,si.x,si.y,$i,en,0,1,sr),this.wallMode){const me=ce(It-1,yt),xe=he.joinNormals[It-1];Th(this.wallVertexArray,xe,me),Th(this.wallVertexArray,xe,me)}if(ji+=Qi,sr=uv(ji,Kn,!Gt),it=Kn,jd(this.layoutVertexArray,li.x,li.y,$i,en,0,0,sr),jd(this.layoutVertexArray,li.x,li.y,$i,en,0,1,sr),this.wallMode){const me=ce(It,yt),xe=he.joinNormals[It];Th(this.wallVertexArray,xe,me),Th(this.wallVertexArray,xe,me)}if(gt.vertexLength+=4,this.indexArray.emplaceBack(Xi+0,Xi+1,Xi+2),this.indexArray.emplaceBack(Xi+1,Xi+3,Xi+2),gt.primitiveLength+=2,_e){const me=ot+(It===1?yt.length-2:It-2),xe=It===1?ot:me+1;if(this.indexArray.emplaceBack(Xi+1,me,Xi+3),this.indexArray.emplaceBack(me,xe,Xi+3),gt.primitiveLength+=2,Ot===void 0&&(Ot=Xi),!xg(Oi,yt[It],qe)){const ct=It===yt.length-1?Ot:gt.vertexLength;this.indexArray.emplaceBack(Xi+2,Xi+3,ct),this.indexArray.emplaceBack(Xi+3,ct+1,ct),this.indexArray.emplaceBack(Xi+3,xe,ct+1),gt.primitiveLength+=3}Gt=!Gt}if(D){const me=this.layoutVertexExtArray,xe=R.projectTilePoint(si.x,si.y,l),ct=R.projectTilePoint(li.x,li.y,l),Ft=R.upVector(l,si.x,si.y),qt=R.upVector(l,li.x,li.y);Ff(me,xe,Ft),Ff(me,xe,Ft),Ff(me,ct,qt),Ff(me,ct,qt)}}B&&(ot+=yt.length-1),J&&_e&&this.zoom>=17&&(Dt.length!==0&&Ne(Dt,Dt[0])&&Dt.pop(),this.groundEffect.addData(Dt,qe,T,_e>0))}this.footprintSegments.push(Rt),xt.triangleCount=this.indexArray.length-xt.triangleArrayOffset,this.polygonSegments.push(xt),++q.footprintSegLen,++q.polygonSegLen}if(q.vertexCount=this.layoutVertexArray.length-q.vertexArrayOffset,q.groundVertexCount=this.groundEffect.vertexArray.length-q.groundVertexArrayOffset,q.vertexCount!==0){if(q.centroidXY=F.borders?lv:this.encodeCentroid(F,q),this.centroidData.push(q),F.borders){this.featuresOnBorder.push(F);const Ue=this.featuresOnBorder.length-1;for(let qe=0;qe<F.borders.length;qe++)F.borders[qe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[qe].push(Ue)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,f,l,x),this.groundEffect.addPaintPropertiesData(e,o,d,f,l,x),this.maxHeight=Math.max(this.maxHeight,te)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){const e=[];for(let y=0;y<this.centroidData.length;y++){const x=this.centroidData[y],T=+(x.min.y+x.max.y>Ut),M=2*T+(+(x.min.x+x.max.x>Ut)^T);for(let R=0;R<x.polygonSegLen;R++){const D=x.polygonSegIdx+R;e.push({centroidIdx:y,subtile:M,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}const i=new Pr;e.sort((y,x)=>y.triangleSegmentIdx===x.triangleSegmentIdx?y.subtile-x.subtile:y.triangleSegmentIdx-x.triangleSegmentIdx);let o=0,l=0,d=0;for(const y of e){if(y.triangleSegmentIdx!==o)break;d++}const f=e.length;for(;l!==e.length;){o=e[l].triangleSegmentIdx;let y=0,x=l,T=l;for(let M=x;M<d&&e[M].subtile===y;M++)T++;for(;x!==d;){const M=e[x];y=M.subtile;const R=this.centroidData[M.centroidIdx].min.clone(),D=this.centroidData[M.centroidIdx].max.clone(),B={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let F=x;F<T;F++){const q=e[F],J=this.polygonSegments[q.polygonSegmentIdx],te=this.centroidData[q.centroidIdx].min,he=this.centroidData[q.centroidIdx].max,ce=this.indexArray.uint16;for(let X=J.triangleArrayOffset;X<J.triangleArrayOffset+J.triangleCount;X++)i.emplaceBack(ce[3*X],ce[3*X+1],ce[3*X+2]);B.primitiveLength+=J.triangleCount,R.x=Math.min(R.x,te.x),R.y=Math.min(R.y,te.y),D.x=Math.max(D.x,he.x),D.y=Math.max(D.y,he.y)}B.primitiveLength>0&&this.triangleSubSegments.push({segment:B,min:R,max:D}),x=T;for(let F=x;F<d&&e[F].subtile===e[x].subtile;F++)T++}l=d;for(let M=l;M<f&&e[M].triangleSegmentIdx===e[l].triangleSegmentIdx;M++)d++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,o){const l=new vr;if(this.wallMode){for(const q of this.triangleSubSegments)l.segments.push(q.segment);return l}let d=0,f=0;const y=1<<e.canonical.z;if(i){const q=i.getMinMaxForTile(e);q&&(d=q.min,f=q.max)}f+=this.maxHeight;const x=e.toUnwrapped();let T;const M=[x.canonical.x/y+x.wrap,x.canonical.y/y],R=[(x.canonical.x+1)/y+x.wrap,(x.canonical.y+1)/y],D=(q,J,te)=>[q[0]*(1-te[0])+J[0]*te[0],q[1]*(1-te[1])+J[1]*te[1]],B=[],F=[];for(const q of this.triangleSubSegments){B[0]=q.min.x/Ut,B[1]=q.min.y/Ut,F[0]=q.max.x/Ut,F[1]=q.max.y/Ut;const J=D(M,R,B),te=D(M,R,F);if(new Un([J[0],J[1],d],[te[0],te[1],f]).intersectsPrecise(o)===0){T&&(l.segments.push(T),T=void 0);continue}const he=q.segment;T&&T.vertexOffset!==he.vertexOffset&&(l.segments.push(T),T=void 0),T?(T.vertexLength+=he.vertexLength,T.primitiveLength+=he.primitiveLength):T={vertexOffset:he.vertexOffset,primitiveLength:he.primitiveLength,vertexLength:he.vertexLength,primitiveOffset:he.primitiveOffset,sortKey:void 0,vaos:{}}}return T&&l.segments.push(T),l}encodeCentroid(e,i){const o=e.centroid(),l=i.span(),d=Math.min(7,Math.round(l.x*this.tileToMeter/10)),f=Math.min(7,Math.round(l.y*this.tileToMeter/10));return new Bt(Me(o.x,1,Ut-1)<<3|d,Me(o.y,1,Ut-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new Bt(0,0);const i=e.borders,o=Number.MAX_VALUE;if(i[0][0]!==o||i[1][0]!==o){const l=i[0][0]!==o?0:1;return new Bt(6|(i[0][0]!==o?0:65528),(i[l][0]+i[l][1])/2<<3|6)}{const l=i[2][0]!==o?2:3;return new Bt((i[l][0]+i[l][1])/2<<3|6,6|(i[2][0]!==o?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=Ac,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,l=e.flags&Ac?lv:e.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==l.y||d!==l.x){for(let f=i;f<o;++f)this.centroidVertexArray.emplace(f,l.x,l.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,o){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped());if(kf(this.activeReplacements,l))return;if(this.activeReplacements=l,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const d=[];for(const f of this.activeReplacements){if(f.order<o)continue;const y=Math.max(1,Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z));for(const x of this.centroidData)if(!(x.flags&Ac||f.min.x>x.max.x||x.min.x>f.max.x||f.min.y>x.max.y||x.min.y>f.max.y))for(let T=0;T<x.footprintSegLen;T++){const M=this.footprintSegments[x.footprintSegIdx+T];if(d.length=0,hv(this.footprintVertices,M.vertexOffset,M.vertexCount,f.footprintTileId.canonical,e.canonical,d),av(f.footprint,d,this.footprintIndices.uint16,M.indexOffset,M.indexCount,-M.vertexOffset,-y)){x.flags|=Ac;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,o){let l=!1;for(let d=0;d<o.footprintSegLen;d++){const f=this.footprintSegments[o.footprintSegIdx+d];let y=0;for(const x of f.ringIndices){for(let T=y,M=x+y-1;T<x+y;M=T++){const R=this.footprintVertices.int16[2*(T+f.vertexOffset)+0],D=this.footprintVertices.int16[2*(T+f.vertexOffset)+1],B=this.footprintVertices.int16[2*(M+f.vertexOffset)+1];D>i!=B>i&&e<(this.footprintVertices.int16[2*(M+f.vertexOffset)+0]-R)*(i-D)/(B-D)+R&&(l=!l)}y=x}}return l}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,l=!0;const d=4*(e+Ut)*Ut+(i+Ut);if(this.partLookup.hasOwnProperty(d)){const f=this.partLookup[d];return f?{height:f.height,hidden:!!(f.flags&Ac)}:void 0}for(const f of this.centroidData)e>f.max.x||f.min.x>e||i>f.max.y||f.min.y>i||this.footprintContainsPoint(e,i,f)&&f&&f.height>o&&(o=f.height,this.partLookup[d]=f,l=!!(f.flags&Ac));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:l};this.partLookup[d]=void 0}}function O_(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function lm(n,e,i,o){const l=e.sub(n)._perp()._unit(),d=i.sub(e)._perp()._unit();return cv(n,e,i,O_(l,d),o)}function cv(n,e,i,o,l){const d=Math.sqrt(1-o*o);return Math.min(n.dist(e)/3,e.dist(i)/3,l*d/o)}function xg(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function cm(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function k_(n,e,i){if(n.x<0||n.x>=Ut||e.x<0||e.x>=Ut||i.x<0||i.x>=Ut)return!1;const o=i.sub(e),l=o.perp(),d=n.sub(e);return(o.x*d.x+o.y*d.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(d.x*d.x+d.y*d.y))>-.866&&l.x*d.x+l.y*d.y<0}function uv(n,e,i){const o=e?2|n:-3&n;return i?1|o:-2&o}function um(){const n=Math.PI/32,e=Math.tan(n),i=Y;return i*Math.sqrt(1+2*e*e)-i}function hm(n,e,i){const o=1<<i.z,l=Ce(i.x/o),d=Ce((i.x+1)/o),f=Le(i.y/o),y=Le((i.y+1)/o);return function(x,T,M,R,D=0,B){const F=[];if(!x.length||!M||!R)return F;const q=(ue,_e)=>{for(const ze of ue)F.push({polygon:ze,bounds:_e})},J=Math.ceil(Math.log2(M)),te=Math.ceil(Math.log2(R)),he=J-te,ce=[];for(let ue=0;ue<Math.abs(he);ue++)ce.push(he>0?0:1);for(let ue=0;ue<Math.min(J,te);ue++)ce.push(0),ce.push(1);let X=x;if(X=ug(X,T[0].y-D,T[1].y+D,1),X=ug(X,T[0].x-D,T[1].x+D,0),!X.length)return F;const re=[];for(ce.length?re.push({polygons:X,bounds:T,depth:0}):q(X,T);re.length;){const ue=re.pop(),_e=ue.depth,ze=ce[_e],Ne=ue.bounds[0],Ue=ue.bounds[1],qe=ze===0?Ne.x:Ne.y,ot=ze===0?Ue.x:Ue.y,St=B?B(ze,qe,ot):.5*(qe+ot),gt=ug(ue.polygons,qe-D,St+D,ze),xt=ug(ue.polygons,St-D,ot+D,ze);if(gt.length){const Rt=[Ne,new Bt(ze===0?St:Ue.x,ze===1?St:Ue.y)];ce.length>_e+1?re.push({polygons:gt,bounds:Rt,depth:_e+1}):q(gt,Rt)}if(xt.length){const Rt=[new Bt(ze===0?St:Ne.x,ze===1?St:Ne.y),Ue];ce.length>_e+1?re.push({polygons:xt,bounds:Rt,depth:_e+1}):q(xt,Rt)}}return F}(n,e,Math.ceil((d-l)/11.25),Math.ceil((f-y)/11.25),1,(x,T,M)=>{if(x===0)return .5*(T+M);{const R=Le((i.y+T/Ut)/o);return(Te(.5*(Le((i.y+M/Ut)/o)+R))*o-i.y)*Ut}})}function hv(n,e,i,o,l,d){const f=Math.pow(2,o.z-l.z);for(let y=0;y<i;y++){let x=n.int16[2*(y+e)+0],T=n.int16[2*(y+e)+1];x=(x+l.x*Ut)*f-o.x*Ut,T=(T+l.y*Ut)*f-o.y*Ut,d.push(new Bt(x,T))}}let jf,bg;Wt(vg,"FillExtrusionBucket",{omit:["layers","features"]}),Wt(Eu,"PartData"),Wt(yg,"FootprintSegment"),Wt(Au,"BorderCentroidData"),Wt(Cu,"GroundEffect");class Mc extends Bt{constructor(e,i,o){super(e,i),this.z=o}}class N_ extends Mc{constructor(e,i,o,l){super(e,i,o),this.w=l}}function dv(n,e,i,o){const l=i==="x"?"y":"x",d=(o-n[i])/(e[i]-n[i]);n[l]=Math.round(n[l]+(e[l]-n[l])*d),n[i]=o,n.hasOwnProperty("z")&&(n.z=Ti(n.z,e.z,d)),n.hasOwnProperty("w")&&(n.w=Ti(n.w,e.w,d))}function dm(n,e,i,o){const l=i,d=o;for(const f of["x","y"]){let y=n,x=e;y[f]>=x[f]&&(y=e,x=n),y[f]<l&&x[f]>l&&dv(y,x,f,l),y[f]<d&&x[f]>d&&dv(x,y,f,d)}}function s(n,e,i,o,l,d){const f=[];for(let y=0;y<n.length;y++){const x=n[y];let T;const M=f.length;let R=0;for(let D=0;D<x.length-1;D++){let B=x[D],F=x[D+1],q=0;const J=R;let te,he;d&&(q=Math.hypot(F.x-B.x,F.y-B.y),R+=q,te=B,he=F),B.x<e&&F.x<e||(B.x<e?B=new Bt(e,B.y+(e-B.x)/(F.x-B.x)*(F.y-B.y))._round():F.x<e&&(F=new Bt(e,B.y+(e-B.x)/(F.x-B.x)*(F.y-B.y))._round()),B.y<i&&F.y<i||(B.y<i?B=new Bt(B.x+(i-B.y)/(F.y-B.y)*(F.x-B.x),i)._round():F.y<i&&(F=new Bt(B.x+(i-B.y)/(F.y-B.y)*(F.x-B.x),i)._round()),B.x>=o&&F.x>=o||(B.x>=o?B=new Bt(o,B.y+(o-B.x)/(F.x-B.x)*(F.y-B.y))._round():F.x>=o&&(F=new Bt(o,B.y+(o-B.x)/(F.x-B.x)*(F.y-B.y))._round()),B.y>=l&&F.y>=l||(B.y>=l?B=new Bt(B.x+(l-B.y)/(F.y-B.y)*(F.x-B.x),l)._round():F.y>=l&&(F=new Bt(B.x+(l-B.y)/(F.y-B.y)*(F.x-B.x),l)._round()),T&&B.equals(T[T.length-1])||(T=[B],f.push(T),d&&d.push({progress:{min:J+_(te,he,B)*q,max:1},parentIndex:y,prevPoint:te,nextPoint:he})),T.push(F),d&&(d[d.length-1].progress.max=J+_(te,he,F)*q,d[d.length-1].nextPoint=he)))))}if(d&&R>0)for(let D=M;D<f.length;D++)d[D].progress.min/=R,d[D].progress.max/=R}return f}function h(n,e,i,o,l){if(n.length<2)return void o.push(n);const d=[];for(;e.valid();){const[T,M]=e.get();for(let R=0;R<n.length-1;R++){const D=n[R],B=n[R+1],F=zn(D,B,T,M);if(F){const[q]=F,J=new Bt(Ti(D.x,B.x,q),Ti(D.y,B.y,q));d.push({t:R+q,distance:0,point:J})}}e.next()}if(d.length===0)return void o.push(n);d.sort((T,M)=>T.t-M.t);let f=0,y=0,x=[];for(o.push(x);f!==n.length;){if(y===d.length){for(;f!==n.length;)x.length!==0&&x[x.length-1].equals(n[f])||x.push(n[f]),f++;break}d[y].t<=f?(x.length!==0&&x[x.length-1].equals(d[y].point)||x.push(d[y].point),Math.trunc(d[y].t),y++):(x.length!==0&&x[x.length-1].equals(n[f])||x.push(n[f]),f++)}}function _(n,e,i){return n.x!==e.x?(i.x-n.x)/(e.x-n.x):n.y!==e.y?(i.y-n.y)/(e.y-n.y):0}function S(n,e){return n.x*e.x+n.y*e.y}function P(n,e){if(n.length===1){let i=0;const o=e[i++];let l;for(;!l||o.equals(l);)if(l=e[i++],!l)return 1/0;for(;i<e.length;i++){const d=e[i],f=n[0],y=l.sub(o),x=d.sub(o),T=f.sub(o),M=S(y,y),R=S(y,x),D=S(x,x),B=S(T,y),F=S(T,x),q=M*D-R*R,J=(D*B-R*F)/q,te=(M*F-R*B)/q,he=o.z*(1-J-te)+l.z*J+d.z*te;if(isFinite(he))return he}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}function U(n,e,i,o,l,d,f,y){const x=f*l.getElevationAt(n,e,!0,!0),T=d[0]!==0,M=T?d[1]===0?f*(d[0]/7-450):f*function(R,D,B){const F=Math.floor(D[0]/8),q=Math.floor(D[1]/8),J=10*(D[0]-8*F),te=10*(D[1]-8*q),he=R.getElevationAt(F,q,!0,!0),ce=R.getMeterToDEM(B),X=Math.floor(.5*(J*ce-1)),re=Math.floor(.5*(te*ce-1)),ue=R.tileCoordToPixel(F,q),_e=2*X+1,ze=2*re+1,Ne=function(xt,Rt,nt,yt,it){return[xt.getElevationAtPixel(Rt,nt,!0),xt.getElevationAtPixel(Rt+it,nt,!0),xt.getElevationAtPixel(Rt,nt+it,!0),xt.getElevationAtPixel(Rt+yt,nt+it,!0)]}(R,ue.x-X,ue.y-re,_e,ze),Ue=Math.abs(Ne[0]-Ne[1]),qe=Math.abs(Ne[2]-Ne[3]),ot=Math.abs(Ne[0]-Ne[2])+Math.abs(Ne[1]-Ne[3]),St=Math.min(.25,.5*ce*(Ue+qe)/_e),gt=Math.min(.25,.5*ce*ot/ze);return he+Math.max(St*J,gt*te)}(l,d,y):x;return{base:x+(i===0?-1:i),top:T?Math.max(M+o,x+i+2):x+o}}const le=bn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Ee=bn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Ke}=le,Mt=bn([{name:"a_packed",components:3,type:"Float32"}]),{members:Zt}=Mt,oi=bn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Lt}=oi;class kt{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new bu({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const o=this.getKey(e,i);return this.positions[o]}trim(){const e=this.width,i=this.height=Vt(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){const l=[];let d=e.length%2==1?-e[e.length-1]*o:0,f=e[0]*o,y=!0;l.push({left:d,right:f,isDash:y,zeroLength:e[0]===0});let x=e[0];for(let T=1;T<e.length;T++){y=!y;const M=e[T];d=x*o,x+=M,f=x*o,l.push({left:d,right:f,isDash:y,zeroLength:M===0})}return l}addRoundDash(e,i,o){const l=i/2;for(let d=-o;d<=o;d++){const f=this.width*(this.nextRow+o+d);let y=0,x=e[y];for(let T=0;T<this.width;T++){T/x.right>1&&(x=e[++y]);const M=Math.abs(T-x.left),R=Math.abs(T-x.right),D=Math.min(M,R);let B;const F=d/o*(l+1);if(x.isDash){const q=l-Math.abs(F);B=Math.sqrt(D*D+q*q)}else B=l-Math.sqrt(D*D+F*F);this.image.data[f+T]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(e,i){for(let x=e.length-1;x>=0;--x){const T=e[x],M=e[x+1];T.zeroLength?e.splice(x,1):M&&M.isDash===T.isDash&&(M.left=T.left,e.splice(x,1))}const o=e[0],l=e[e.length-1];o.isDash===l.isDash&&(o.left=l.left-this.width,l.right=o.right+this.width);const d=this.width*this.nextRow;let f=0,y=e[f];for(let x=0;x<this.width;x++){x/y.right>1&&(y=e[++f]);const T=Math.abs(x-y.left),M=Math.abs(x-y.right),R=Math.min(T,M);this.image.data[d+x]=Math.max(0,Math.min(255,(y.isDash?R:-R)+i+128))}}addDash(e,i){const o=this.getKey(e,i);if(this.positions[o])return this.positions[o];const l=i==="round",d=l?7:0,f=2*d+1;if(this.nextRow+f>this.height)return Ui("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let M=0;M<e.length;M++)e[M]<0&&(Ui("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),y+=e[M];if(y!==0){const M=this.width/y,R=this.getDashRanges(e,this.width,M);l?this.addRoundDash(R,M,d):this.addRegularDash(R,i==="square"?.5*M:0)}const x=this.nextRow+d;this.nextRow+=f;const T={tl:[x,d],br:[y,0]};return this.positions[o]=T,T}}Wt(kt,"LineAtlas");const Ln=Ec.VectorTileFeature.types,An=Math.cos(Math.PI/180*37.5),Zr=Math.cos(Math.PI/180*5);class mt{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Pp,this.layoutVertexArray2=new mo,this.patternVertexArray=new mo,this.indexArray=new Pr,this.programConfigurations=new Tc(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new vr,this.maxLineLength=0,this.zOffsetVertexArray=new mo,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Ut/64}updateFootprints(e,i){}populate(e,i,o,l){this.hasPattern=Pf("line",this.layers,this.pixelRatio,i);const d=this.layers[0].layout.get("line-sort-key");this.tileToMeter=$e(o);const f=this.layers[0].layout.get("line-elevation-reference");if(f==="hd-road-markup")this.elevationType="road";else{const D=this.layers[0].layout.get("line-z-offset"),B=D.isConstant()&&!D.constantOr(0);this.elevationType=f!=="sea"&&f!=="ground"&&B?"none":"offset",this.elevationType==="offset"&&f==="none"&&Ui(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const y=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&y!==void 0;const x=[];for(const{feature:D,id:B,index:F,sourceLayerIndex:q}of e){const J=this.layers[0]._featureFilter.needGeometry,te=ai(D,J);if(!this.layers[0]._featureFilter.filter(new Fn(this.zoom),te,o))continue;const he=d?d.evaluate(te,{},o):void 0,ce={id:B,properties:D.properties,type:D.type,sourceLayerIndex:q,index:F,geometry:J?te.geometry:Qt(D,o,l),patterns:{},sortKey:he};x.push(ce)}d&&x.sort((D,B)=>D.sortKey-B.sortKey);const{lineAtlas:T,featureIndex:M}=i,R=this.addConstantDashes(T);for(const D of x){const{geometry:B,index:F,sourceLayerIndex:q}=D;if(R&&this.addFeatureDashes(D,T),this.hasPattern){const J=ag("line",this.layers,D,this.zoom,this.pixelRatio,i);this.patternFeatures.push(J)}else this.addFeature(D,B,F,o,T.positions,i.availableImages,i.brightness,i.elevationFeatures);M.insert(e[F].feature,B,F,q,this.index)}}addConstantDashes(e){let i=!1;for(const o of this.layers){const l=o.paint.get("line-dasharray").value,d=o.layout.get("line-cap").value;if(l.kind!=="constant"||d.kind!=="constant")i=!0;else{const f=d.value,y=l.value;if(!y)continue;e.addDash(y,f)}}return i}addFeatureDashes(e,i){const o=this.zoom;for(const l of this.layers){const d=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(d.kind==="constant"&&f.kind==="constant")continue;let y,x;if(d.kind==="constant"){if(y=d.value,!y)continue}else y=d.evaluate({zoom:o},e);x=f.kind==="constant"?f.value:f.evaluate({zoom:o},e),i.addDash(y,x),e.patterns[l.id]=[i.getKey(y,x)]}}update(e,i,o,l,d,f,y){this.programConfigurations.updatePaintArrays(e,i,d,o,l,f,y)}addFeatures(e,i,o,l,d,f){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,i,o,l,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Zt)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Lt)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Ee.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ke),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,l,d,f,y,x){const T=this.layers[0].layout,M=T.get("line-join").evaluate(e,{}),R=T.get("line-cap").evaluate(e,{}),D=T.get("line-miter-limit"),B=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=T.get("line-z-offset").value;const F=this.layers[0].paint.get("line-width").value;if(F.kind!=="constant"&&F.isLineProgressConstant===!1&&(this.variableWidthValue=F),this.elevationType==="road"){const q=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,l,x,M,R,D,B)){const[J,te]=this.clipRuntimeLinesToTile(i,1);for(let he=0;he<J.length;he++){const ce=J[he],X=te[he],re={progress:{min:X.progress.min,max:X.progress.max},nextDir:this.computeSegNextDir(X,ce),prevDir:this.computeSegPrevDir(X,ce)};this.addLine(ce,e,l,M,R,D,B,re)}this.fillNonElevatedRoadSegment(q)}}else for(const q of i)this.addLine(q,e,l,M,R,D,B);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,f,l,y)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return s(e,-i,-i,Ut+i,Ut+i)}clipRuntimeLinesToTile(e,i){const o=[];return[s(e,-i,-i,Ut+i,Ut+i,o),o]}addElevatedRoadFeature(e,i,o,l,d,f,y,x){const T=[],M=ys.getElevationFeature(e,l);if(M){const R=this.clipLinesToTile(i,1),D=this.prepareElevatedLines(R,M,o);for(const B of D)T.push({geometry:B,elevation:M,elevationTileID:o,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(T.length===0)return!1;for(const R of T){const D=this.layoutVertexArray.length;this.addLine(R.geometry,e,o,d,f,y,x);const B=new w_(o,R.elevationTileID);if(R.elevation)for(let F=D;F<this.layoutVertexArray.length;F++){const q=new Bt(this.layoutVertexArray.int16[6*F]>>1,this.layoutVertexArray.int16[6*F+1]>>1),J=B.pointElevation(q,R.elevation,.05);this.updateHeightRange(J),this.zOffsetVertexArray.emplaceBack(J,0,0)}else this.fillNonElevatedRoadSegment(D)}return!0}prepareElevatedLines(e,i,o){if(i.constantHeight!=null)return e;const l=[],d=1/$e(o);for(const f of e)h(f,new b_(i,d),0,l);return l}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,o,l,d,f,y,x){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const T=l==="none";this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const M=x&&x.progress.min>0,R=x&&x.progress.max<1;if(this.lineClips){let ze={min:this.lineClips.start,max:this.lineClips.end},Ne=1;if(x){const ot=this.lineClips.end-this.lineClips.start;ze=function(St,gt,xt){return{min:Bn(St.min,gt,xt),max:Bn(St.max,gt,xt)}}(x.progress,{min:0,max:1},ze),ot>0&&(Ne=(ze.max-ze.min)/ot)}const Ue=+i.properties.mapbox_clip_feature_len,qe=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Ue)||Number.isNaN(qe)){for(let St=0;St<e.length-1;St++)this.totalDistance+=e[St].dist(e[St+1]);const ot=this.totalDistance/(ze.max-ze.min);this.totalFeatureLength=Number.isFinite(ot)?ot:0,this.lineClips.start=ze.min,this.lineClips.end=ze.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ue,this.distance=qe*Ne,this.lineClips.start=ze.min,this.lineClips.end=ze.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const D=Ln[i.type]==="Polygon";let B=e.length;for(;B>=2&&e[B-1].equals(e[B-2]);)B--;let F=0;for(;F<B-1&&e[F].equals(e[F+1]);)F++;if(B<(D?3:2))return;l==="bevel"&&(f=1.05);const q=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray);let J,te,he,ce,X,re,ue,_e;x&&x.prevDir&&(re=x.prevDir.perp()),x&&x.nextDir&&(ue=x.nextDir.perp()),this.e1=this.e2=-1,D&&(J=e[B-2],X=e[F].sub(J)._unit()._perp());for(let ze=F;ze<B;ze++){if(he=ze===B-1?D?e[F+1]:void 0:e[ze+1],he&&e[ze].equals(he))continue;X&&(ce=X),J&&(te=J),J=e[ze],_e=this.evaluateLineProgressFeatures(te?te.dist(J):0),X=he?he.sub(J)._unit()._perp():ce,ce=ce||X;const Ne=te&&he;let Ue=Ne?l:D||T?"butt":d;const qe=ce.x*X.x+ce.y*X.y;if(T){const it=function(rt){if(rt.patternJoinNone){const Dt=rt.segmentPoints.length/2,Ot=rt.lineSoFar-rt.segmentStart;for(let hi=0;hi<Dt;++hi){const ti=rt.segmentPoints[2*hi+1],Gt=Math.round(rt.segmentPoints[2*hi])+.5+.25*ti;rt.patternVertexArray.emplaceBack(Gt,Ot,rt.segmentStart),rt.patternVertexArray.emplaceBack(Gt,Ot,rt.segmentStart)}rt.segmentPoints.length=0}rt.e1=rt.e2=-1};if(Ne&&qe<Zr){this.updateDistance(te,J),this.addCurrentVertex(J,ce,1,1,q,_e),it(this),this.addCurrentVertex(J,X,-1,-1,q,_e);continue}if(te){if(!he){this.updateDistance(te,J),this.addCurrentVertex(J,ce,1,1,q,_e),it(this);continue}Ue="miter"}}let ot=ce.add(X);ot.x===0&&ot.y===0||ot._unit();const St=ot.x*X.x+ot.y*X.y,gt=St!==0?1/St:1/0,xt=2*Math.sqrt(2-2*St),Rt=St<An&&te&&he,nt=ce.x*X.y-ce.y*X.x>0,yt=this.overscaling<=16?15*Ut/(512*this.overscaling):0;if(Ne&&Ue==="round"){if(gt<y)Ue="miter";else if(gt<=2){const it=st(J,-10,Ut+10);Ue=this.elevationType==="offset"&&(it||this.hasCrossSlope)?"miter":"fakeround"}}if(Ue==="miter"&&gt>f&&(Ue="bevel"),Ue==="bevel"&&(gt>2&&(Ue="flipbevel"),gt<f&&(Ue="miter")),te&&!(Ue==="miter"&&Rt)&&this.updateDistance(te,J),Ue==="miter")if(Rt){const it=J.dist(te);if(it>2*yt){const Dt=J.sub(J.sub(te)._mult(yt/it)._round());this.updateDistance(te,Dt),this.addCurrentVertex(Dt,ce,0,0,q,_e),te=Dt}this.updateDistance(te,J),ot._mult(gt),this.addCurrentVertex(J,ot,0,0,q,_e);const rt=J.dist(he);if(rt>2*yt){const Dt=J.add(he.sub(J)._mult(yt/rt)._round());this.updateDistance(J,Dt),this.addCurrentVertex(Dt,X,0,0,q,_e),J=Dt}}else ot._mult(gt),this.addCurrentVertex(J,ot,0,0,q,_e);else if(Ue==="flipbevel"){if(gt>100)ot=X.mult(-1);else{const it=gt*ce.add(X).mag()/ce.sub(X).mag();ot._perp()._mult(it*(nt?-1:1))}this.addCurrentVertex(J,ot,0,0,q,_e),this.addCurrentVertex(J,ot.mult(-1),0,0,q,_e)}else if(Ue==="bevel"||Ue==="fakeround"){_e!=null&&te&&this.addCurrentVertex(J,ue||ce,-1,-1,q,_e);const it=J.dist(te)<=2*yt&&Ue!=="bevel",rt=ot.mult(nt?1:-1);rt._mult(gt);const Dt=X.mult(nt?-1:1),Ot=ce.mult(nt?-1:1),hi=this.evaluateLineProgressFeatures(this.distance);if(_e==null&&(this.addHalfVertex(J,rt.x,rt.y,!1,!nt,0,q,hi),it||this.addHalfVertex(J,rt.x+2*Ot.x,rt.y+2*Ot.y,!1,nt,0,q,hi)),Ue==="fakeround"){const ti=Math.round(180*xt/Math.PI/20);this.addHalfVertex(J,Ot.x,Ot.y,!1,nt,0,q,hi);for(let Gt=0;Gt<ti;Gt++){let It=Gt/ti;if(It!==.5){const si=It-.5;It+=It*si*(It-1)*((1.0904+qe*(qe*(3.55645-1.43519*qe)-3.2452))*si*si+(.848013+qe*(.215638*qe-1.06021)))}const ji=Dt.sub(Ot)._mult(It)._add(Ot)._unit();this.addHalfVertex(J,ji.x,ji.y,!1,nt,0,q,hi)}this.addHalfVertex(J,Dt.x,Dt.y,!1,nt,0,q,hi)}it||_e!=null||this.addHalfVertex(J,rt.x+2*Dt.x,rt.y+2*Dt.y,!1,nt,0,q,hi),_e!=null&&he&&this.addCurrentVertex(J,re||X,1,1,q,_e)}else if(Ue==="butt")this.addCurrentVertex(J,ot,0,0,q,_e);else if(Ue==="square"){if(!te){const it=M?0:-1;this.addCurrentVertex(J,ot,it,it,q,_e)}if(this.addCurrentVertex(J,ot,0,0,q,_e),te){const it=R?0:1;this.addCurrentVertex(J,ot,it,it,q,_e)}}else if(Ue==="round"){if(te){const it=!Ne&&ue?ue:ce;this.addCurrentVertex(J,it,0,0,q,_e),!Ne&&R||this.addCurrentVertex(J,it,1,1,q,_e,!0)}if(he){const it=!Ne&&re?re:X;!Ne&&M||this.addCurrentVertex(J,it,-1,-1,q,_e,!0),this.addCurrentVertex(J,it,0,0,q,_e)}}}}addVerticesTo(e,i,o,l,d,f,y,x,T,M){const R=(i.w-e.w)/this.tessellationStep|0;let D=0;const B=this.scaledDistance;if(R>1){this.lineSoFar=e.w;const q=(i.x-e.x)/R,J=(i.y-e.y)/R,te=(i.z-e.z)/R,he=(i.w-e.w)/R;for(let ce=1;ce<R;++ce){e.x+=q,e.y+=J,e.z+=te,this.lineSoFar+=he,D+=he;const X=this.evaluateLineProgressFeatures(this.prevDistance+D);this.scaledDistance=(this.prevDistance+D)/this.totalDistance,this.addHalfVertex(e,o,l,M,!1,y,T,X),this.addHalfVertex(e,d,f,M,!0,-x,T,X)}}this.lineSoFar=i.w,this.scaledDistance=B;const F=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,o,l,M,!1,y,T,F),this.addHalfVertex(i,d,f,M,!0,-x,T,F)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Ui(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,o,l,d,f,y=!1){const x=i.x+i.y*o,T=i.y-i.x*o,M=i.y*l-i.x,R=-i.y-i.x*l;if(f!=null){const D=this.elevationType==="offset",B=-10,F=Ut+10,q=f.zOffset,J=new N_(e.x,e.y,q,this.lineSoFar),te=!!D&&st(e,B,F),he=this.lineSoFar,ce=this.distance;if(this.currentVertex)if(te){const X=this.currentVertexIsOutside,re=this.currentVertex,ue=new N_(e.x,e.y,q,this.lineSoFar);if(dm(re,ue,B,F),!st(ue,B,F)){if(X){this.e1=this.e2=-1,this.distance-=re.dist(J),this.lineSoFar=re.w;const _e=this.evaluateLineProgressFeatures(re.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(re,x,T,y,!1,o,d,_e),this.addHalfVertex(re,M,R,y,!0,-l,d,_e),this.prevDistance=this.distance}this.distance=this.prevDistance+re.dist(ue),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(re,ue,x,T,M,R,o,l,d,y),this.distance=ce,this.scaledDistance=this.distance/this.totalDistance}}else{const X=this.currentVertex;if(this.currentVertexIsOutside){dm(X,J,B,F),this.e1=this.e2=-1,this.distance-=X.dist(J),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=X.w;const re=this.evaluateLineProgressFeatures(X.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(X,x,T,y,!1,o,d,re),this.addHalfVertex(X,M,R,y,!0,-l,d,re),this.prevDistance=this.distance,this.distance=ce,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(X,J,x,T,M,R,o,l,d,y)}else te||(this.addHalfVertex(e,x,T,y,!1,o,d,f),this.addHalfVertex(e,M,R,y,!0,-l,d,f));this.currentVertex=J,this.currentVertexIsOutside=te,this.lineSoFar=he}else this.addHalfVertex(e,x,T,y,!1,o,d,f),this.addHalfVertex(e,M,R,y,!0,-l,d,f)}addHalfVertex({x:e,y:i},o,l,d,f,y,x,T){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),f||this.segmentPoints.push(this.lineSoFar-this.segmentStart,y)),this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(i<<1)+(f?1:0),Math.round(63*o)+128,Math.round(63*l)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const R=Ti(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,R)}const M=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),x.primitiveLength++),f?this.e2=M:this.e1=M,T!=null&&this.zOffsetVertexArray.emplaceBack(T.zOffset,T.variableWidth,T.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function st(n,e,i){return n.x<e||n.x>i||n.y<e||n.y>i}let Et,Kt;function Ki(n,e,i){return e*(Ut/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}Wt(mt,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const nr=(n,e,i)=>(1-i)*n+i*e;function un(n,e){return 1/Ki(n,1,e.tileZoom)}function Mn(n,e,i,o){return n.translatePosMatrix(o||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Ba=n=>{const e=[];Mr(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=n.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),n.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const o=n.layout.get("line-join").constantOr("miter")==="none",l=!!n.paint.get("line-pattern").constantOr(1);return o&&l&&e.push("LINE_JOIN_NONE"),e};function Mr(n){const e=n.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let Cc;const fv=()=>Cc||(Cc={layout:Et||(Et=new wr({"line-cap":new Xt(We.layout_line["line-cap"]),"line-join":new Xt(We.layout_line["line-join"]),"line-miter-limit":new Nt(We.layout_line["line-miter-limit"]),"line-round-limit":new Nt(We.layout_line["line-round-limit"]),"line-sort-key":new Xt(We.layout_line["line-sort-key"]),"line-z-offset":new Xt(We.layout_line["line-z-offset"]),"line-elevation-reference":new Nt(We.layout_line["line-elevation-reference"]),"line-cross-slope":new Nt(We.layout_line["line-cross-slope"]),visibility:new Nt(We.layout_line.visibility),"line-width-unit":new Nt(We.layout_line["line-width-unit"])})),paint:Kt||(Kt=new wr({"line-opacity":new Xt(We.paint_line["line-opacity"]),"line-color":new Xt(We.paint_line["line-color"]),"line-translate":new Nt(We.paint_line["line-translate"]),"line-translate-anchor":new Nt(We.paint_line["line-translate-anchor"]),"line-width":new Xt(We.paint_line["line-width"]),"line-gap-width":new Xt(We.paint_line["line-gap-width"]),"line-offset":new Xt(We.paint_line["line-offset"]),"line-blur":new Xt(We.paint_line["line-blur"]),"line-dasharray":new Xt(We.paint_line["line-dasharray"]),"line-pattern":new Xt(We.paint_line["line-pattern"]),"line-pattern-cross-fade":new Nt(We.paint_line["line-pattern-cross-fade"]),"line-gradient":new ps(We.paint_line["line-gradient"]),"line-trim-offset":new Nt(We.paint_line["line-trim-offset"]),"line-trim-fade-range":new Nt(We.paint_line["line-trim-fade-range"]),"line-trim-color":new Nt(We.paint_line["line-trim-color"]),"line-emissive-strength":new Nt(We.paint_line["line-emissive-strength"]),"line-border-width":new Xt(We.paint_line["line-border-width"]),"line-border-color":new Xt(We.paint_line["line-border-color"]),"line-occlusion-opacity":new Nt(We.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},Cc);class sC extends Xt{possiblyEvaluate(e,i){return i=new Fn(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,l){return i=Ve({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,l)}}let B_;function F1(n,e){return e>0?e+2*n:n}const lC=bn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),cC=bn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),uC=bn([{name:"a_projected_pos",components:4,type:"Float32"}],4);bn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const hC=bn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),dC=bn([{name:"a_texb",components:2,type:"Uint16"}]),fC=bn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),pC=bn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);bn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const j1=bn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),mC=bn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);bn([{name:"triangle",components:3,type:"Uint16"}]),bn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),bn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),bn([{type:"Float32",name:"offsetX"}]),bn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ia=24;function gC(n,e,i){return n.sections.forEach(o=>{o.text=function(l,d,f){const y=d.layout.get("text-transform").evaluate(f,{});return y==="uppercase"?l=l.toLocaleUpperCase():y==="lowercase"&&(l=l.toLocaleLowerCase()),fs.applyArabicShaping&&(l=fs.applyArabicShaping(l)),l}(o.text,e,i)}),n}const F_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function _C(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}function yC(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}var U1,lx,V1,cx={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function vC(){return U1||(U1=1,cx.read=function(n,e,i,o,l){var d,f,y=8*l-o-1,x=(1<<y)-1,T=x>>1,M=-7,R=i?l-1:0,D=i?-1:1,B=n[e+R];for(R+=D,d=B&(1<<-M)-1,B>>=-M,M+=y;M>0;d=256*d+n[e+R],R+=D,M-=8);for(f=d&(1<<-M)-1,d>>=-M,M+=o;M>0;f=256*f+n[e+R],R+=D,M-=8);if(d===0)d=1-T;else{if(d===x)return f?NaN:1/0*(B?-1:1);f+=Math.pow(2,o),d-=T}return(B?-1:1)*f*Math.pow(2,d-o)},cx.write=function(n,e,i,o,l,d){var f,y,x,T=8*d-l-1,M=(1<<T)-1,R=M>>1,D=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=o?0:d-1,F=o?1:-1,q=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,f=M):(f=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-f))<1&&(f--,x*=2),(e+=f+R>=1?D/x:D*Math.pow(2,1-R))*x>=2&&(f++,x/=2),f+R>=M?(y=0,f=M):f+R>=1?(y=(e*x-1)*Math.pow(2,l),f+=R):(y=e*Math.pow(2,R-1)*Math.pow(2,l),f=0));l>=8;n[i+B]=255&y,B+=F,y/=256,l-=8);for(f=f<<l|y,T+=l;T>0;n[i+B]=255&f,B+=F,f/=256,T-=8);n[i+B-F]|=128*q}),cx}function G1(){if(V1)return lx;V1=1,lx=e;var n=vC();function e(X){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(X)?X:new Uint8Array(X||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,o=1/i,l=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function d(X){return X.type===e.Bytes?X.readVarint()+X.pos:X.pos+1}function f(X,re,ue){return ue?4294967296*re+(X>>>0):4294967296*(re>>>0)+(X>>>0)}function y(X,re,ue){var _e=re<=16383?1:re<=2097151?2:re<=268435455?3:Math.floor(Math.log(re)/(7*Math.LN2));ue.realloc(_e);for(var ze=ue.pos-1;ze>=X;ze--)ue.buf[ze+_e]=ue.buf[ze]}function x(X,re){for(var ue=0;ue<X.length;ue++)re.writeVarint(X[ue])}function T(X,re){for(var ue=0;ue<X.length;ue++)re.writeSVarint(X[ue])}function M(X,re){for(var ue=0;ue<X.length;ue++)re.writeFloat(X[ue])}function R(X,re){for(var ue=0;ue<X.length;ue++)re.writeDouble(X[ue])}function D(X,re){for(var ue=0;ue<X.length;ue++)re.writeBoolean(X[ue])}function B(X,re){for(var ue=0;ue<X.length;ue++)re.writeFixed32(X[ue])}function F(X,re){for(var ue=0;ue<X.length;ue++)re.writeSFixed32(X[ue])}function q(X,re){for(var ue=0;ue<X.length;ue++)re.writeFixed64(X[ue])}function J(X,re){for(var ue=0;ue<X.length;ue++)re.writeSFixed64(X[ue])}function te(X,re){return(X[re]|X[re+1]<<8|X[re+2]<<16)+16777216*X[re+3]}function he(X,re,ue){X[ue]=re,X[ue+1]=re>>>8,X[ue+2]=re>>>16,X[ue+3]=re>>>24}function ce(X,re){return(X[re]|X[re+1]<<8|X[re+2]<<16)+(X[re+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(X,re,ue){for(ue=ue||this.length;this.pos<ue;){var _e=this.readVarint(),ze=_e>>3,Ne=this.pos;this.type=7&_e,X(ze,re,this),this.pos===Ne&&this.skip(_e)}return re},readMessage:function(X,re){return this.readFields(X,re,this.readVarint()+this.pos)},readFixed32:function(){var X=te(this.buf,this.pos);return this.pos+=4,X},readSFixed32:function(){var X=ce(this.buf,this.pos);return this.pos+=4,X},readFixed64:function(){var X=te(this.buf,this.pos)+te(this.buf,this.pos+4)*i;return this.pos+=8,X},readSFixed64:function(){var X=te(this.buf,this.pos)+ce(this.buf,this.pos+4)*i;return this.pos+=8,X},readFloat:function(){var X=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,X},readDouble:function(){var X=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,X},readVarint:function(X){var re,ue,_e=this.buf;return re=127&(ue=_e[this.pos++]),ue<128?re:(re|=(127&(ue=_e[this.pos++]))<<7,ue<128?re:(re|=(127&(ue=_e[this.pos++]))<<14,ue<128?re:(re|=(127&(ue=_e[this.pos++]))<<21,ue<128?re:function(ze,Ne,Ue){var qe,ot,St=Ue.buf;if(qe=(112&(ot=St[Ue.pos++]))>>4,ot<128||(qe|=(127&(ot=St[Ue.pos++]))<<3,ot<128)||(qe|=(127&(ot=St[Ue.pos++]))<<10,ot<128)||(qe|=(127&(ot=St[Ue.pos++]))<<17,ot<128)||(qe|=(127&(ot=St[Ue.pos++]))<<24,ot<128)||(qe|=(1&(ot=St[Ue.pos++]))<<31,ot<128))return f(ze,qe,Ne);throw new Error("Expected varint not more than 10 bytes")}(re|=(15&(ue=_e[this.pos]))<<28,X,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var X=this.readVarint();return X%2==1?(X+1)/-2:X/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var X=this.readVarint()+this.pos,re=this.pos;return this.pos=X,X-re>=12&&l?function(ue,_e,ze){return l.decode(ue.subarray(_e,ze))}(this.buf,re,X):function(ue,_e,ze){for(var Ne="",Ue=_e;Ue<ze;){var qe,ot,St,gt=ue[Ue],xt=null,Rt=gt>239?4:gt>223?3:gt>191?2:1;if(Ue+Rt>ze)break;Rt===1?gt<128&&(xt=gt):Rt===2?(192&(qe=ue[Ue+1]))==128&&(xt=(31&gt)<<6|63&qe)<=127&&(xt=null):Rt===3?(ot=ue[Ue+2],(192&(qe=ue[Ue+1]))==128&&(192&ot)==128&&((xt=(15&gt)<<12|(63&qe)<<6|63&ot)<=2047||xt>=55296&&xt<=57343)&&(xt=null)):Rt===4&&(ot=ue[Ue+2],St=ue[Ue+3],(192&(qe=ue[Ue+1]))==128&&(192&ot)==128&&(192&St)==128&&((xt=(15&gt)<<18|(63&qe)<<12|(63&ot)<<6|63&St)<=65535||xt>=1114112)&&(xt=null)),xt===null?(xt=65533,Rt=1):xt>65535&&(xt-=65536,Ne+=String.fromCharCode(xt>>>10&1023|55296),xt=56320|1023&xt),Ne+=String.fromCharCode(xt),Ue+=Rt}return Ne}(this.buf,re,X)},readBytes:function(){var X=this.readVarint()+this.pos,re=this.buf.subarray(this.pos,X);return this.pos=X,re},readPackedVarint:function(X,re){if(this.type!==e.Bytes)return X.push(this.readVarint(re));var ue=d(this);for(X=X||[];this.pos<ue;)X.push(this.readVarint(re));return X},readPackedSVarint:function(X){if(this.type!==e.Bytes)return X.push(this.readSVarint());var re=d(this);for(X=X||[];this.pos<re;)X.push(this.readSVarint());return X},readPackedBoolean:function(X){if(this.type!==e.Bytes)return X.push(this.readBoolean());var re=d(this);for(X=X||[];this.pos<re;)X.push(this.readBoolean());return X},readPackedFloat:function(X){if(this.type!==e.Bytes)return X.push(this.readFloat());var re=d(this);for(X=X||[];this.pos<re;)X.push(this.readFloat());return X},readPackedDouble:function(X){if(this.type!==e.Bytes)return X.push(this.readDouble());var re=d(this);for(X=X||[];this.pos<re;)X.push(this.readDouble());return X},readPackedFixed32:function(X){if(this.type!==e.Bytes)return X.push(this.readFixed32());var re=d(this);for(X=X||[];this.pos<re;)X.push(this.readFixed32());return X},readPackedSFixed32:function(X){if(this.type!==e.Bytes)return X.push(this.readSFixed32());var re=d(this);for(X=X||[];this.pos<re;)X.push(this.readSFixed32());return X},readPackedFixed64:function(X){if(this.type!==e.Bytes)return X.push(this.readFixed64());var re=d(this);for(X=X||[];this.pos<re;)X.push(this.readFixed64());return X},readPackedSFixed64:function(X){if(this.type!==e.Bytes)return X.push(this.readSFixed64());var re=d(this);for(X=X||[];this.pos<re;)X.push(this.readSFixed64());return X},skip:function(X){var re=7&X;if(re===e.Varint)for(;this.buf[this.pos++]>127;);else if(re===e.Bytes)this.pos=this.readVarint()+this.pos;else if(re===e.Fixed32)this.pos+=4;else{if(re!==e.Fixed64)throw new Error("Unimplemented type: "+re);this.pos+=8}},writeTag:function(X,re){this.writeVarint(X<<3|re)},realloc:function(X){for(var re=this.length||16;re<this.pos+X;)re*=2;if(re!==this.length){var ue=new Uint8Array(re);ue.set(this.buf),this.buf=ue,this.length=re}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(X){this.realloc(4),he(this.buf,X,this.pos),this.pos+=4},writeSFixed32:function(X){this.realloc(4),he(this.buf,X,this.pos),this.pos+=4},writeFixed64:function(X){this.realloc(8),he(this.buf,-1&X,this.pos),he(this.buf,Math.floor(X*o),this.pos+4),this.pos+=8},writeSFixed64:function(X){this.realloc(8),he(this.buf,-1&X,this.pos),he(this.buf,Math.floor(X*o),this.pos+4),this.pos+=8},writeVarint:function(X){(X=+X||0)>268435455||X<0?function(re,ue){var _e,ze;if(re>=0?(_e=re%4294967296|0,ze=re/4294967296|0):(ze=~(-re/4294967296),4294967295^(_e=~(-re%4294967296))?_e=_e+1|0:(_e=0,ze=ze+1|0)),re>=18446744073709552e3||re<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ue.realloc(10),function(Ne,Ue,qe){qe.buf[qe.pos++]=127&Ne|128,Ne>>>=7,qe.buf[qe.pos++]=127&Ne|128,Ne>>>=7,qe.buf[qe.pos++]=127&Ne|128,Ne>>>=7,qe.buf[qe.pos++]=127&Ne|128,qe.buf[qe.pos]=127&(Ne>>>=7)}(_e,0,ue),function(Ne,Ue){var qe=(7&Ne)<<4;Ue.buf[Ue.pos++]|=qe|((Ne>>>=3)?128:0),Ne&&(Ue.buf[Ue.pos++]=127&Ne|((Ne>>>=7)?128:0),Ne&&(Ue.buf[Ue.pos++]=127&Ne|((Ne>>>=7)?128:0),Ne&&(Ue.buf[Ue.pos++]=127&Ne|((Ne>>>=7)?128:0),Ne&&(Ue.buf[Ue.pos++]=127&Ne|((Ne>>>=7)?128:0),Ne&&(Ue.buf[Ue.pos++]=127&Ne)))))}(ze,ue)}(X,this):(this.realloc(4),this.buf[this.pos++]=127&X|(X>127?128:0),X<=127||(this.buf[this.pos++]=127&(X>>>=7)|(X>127?128:0),X<=127||(this.buf[this.pos++]=127&(X>>>=7)|(X>127?128:0),X<=127||(this.buf[this.pos++]=X>>>7&127))))},writeSVarint:function(X){this.writeVarint(X<0?2*-X-1:2*X)},writeBoolean:function(X){this.writeVarint(!!X)},writeString:function(X){X=String(X),this.realloc(4*X.length),this.pos++;var re=this.pos;this.pos=function(_e,ze,Ne){for(var Ue,qe,ot=0;ot<ze.length;ot++){if((Ue=ze.charCodeAt(ot))>55295&&Ue<57344){if(!qe){Ue>56319||ot+1===ze.length?(_e[Ne++]=239,_e[Ne++]=191,_e[Ne++]=189):qe=Ue;continue}if(Ue<56320){_e[Ne++]=239,_e[Ne++]=191,_e[Ne++]=189,qe=Ue;continue}Ue=qe-55296<<10|Ue-56320|65536,qe=null}else qe&&(_e[Ne++]=239,_e[Ne++]=191,_e[Ne++]=189,qe=null);Ue<128?_e[Ne++]=Ue:(Ue<2048?_e[Ne++]=Ue>>6|192:(Ue<65536?_e[Ne++]=Ue>>12|224:(_e[Ne++]=Ue>>18|240,_e[Ne++]=Ue>>12&63|128),_e[Ne++]=Ue>>6&63|128),_e[Ne++]=63&Ue|128)}return Ne}(this.buf,X,this.pos);var ue=this.pos-re;ue>=128&&y(re,ue,this),this.pos=re-1,this.writeVarint(ue),this.pos+=ue},writeFloat:function(X){this.realloc(4),n.write(this.buf,X,this.pos,!0,23,4),this.pos+=4},writeDouble:function(X){this.realloc(8),n.write(this.buf,X,this.pos,!0,52,8),this.pos+=8},writeBytes:function(X){var re=X.length;this.writeVarint(re),this.realloc(re);for(var ue=0;ue<re;ue++)this.buf[this.pos++]=X[ue]},writeRawMessage:function(X,re){this.pos++;var ue=this.pos;X(re,this);var _e=this.pos-ue;_e>=128&&y(ue,_e,this),this.pos=ue-1,this.writeVarint(_e),this.pos+=_e},writeMessage:function(X,re,ue){this.writeTag(X,e.Bytes),this.writeRawMessage(re,ue)},writePackedVarint:function(X,re){re.length&&this.writeMessage(X,x,re)},writePackedSVarint:function(X,re){re.length&&this.writeMessage(X,T,re)},writePackedBoolean:function(X,re){re.length&&this.writeMessage(X,D,re)},writePackedFloat:function(X,re){re.length&&this.writeMessage(X,M,re)},writePackedDouble:function(X,re){re.length&&this.writeMessage(X,R,re)},writePackedFixed32:function(X,re){re.length&&this.writeMessage(X,B,re)},writePackedSFixed32:function(X,re){re.length&&this.writeMessage(X,F,re)},writePackedFixed64:function(X,re){re.length&&this.writeMessage(X,q,re)},writePackedSFixed64:function(X,re){re.length&&this.writeMessage(X,J,re)},writeBytesField:function(X,re){this.writeTag(X,e.Bytes),this.writeBytes(re)},writeFixed32Field:function(X,re){this.writeTag(X,e.Fixed32),this.writeFixed32(re)},writeSFixed32Field:function(X,re){this.writeTag(X,e.Fixed32),this.writeSFixed32(re)},writeFixed64Field:function(X,re){this.writeTag(X,e.Fixed64),this.writeFixed64(re)},writeSFixed64Field:function(X,re){this.writeTag(X,e.Fixed64),this.writeSFixed64(re)},writeVarintField:function(X,re){this.writeTag(X,e.Varint),this.writeVarint(re)},writeSVarintField:function(X,re){this.writeTag(X,e.Varint),this.writeSVarint(re)},writeStringField:function(X,re){this.writeTag(X,e.Bytes),this.writeString(re)},writeFloatField:function(X,re){this.writeTag(X,e.Fixed32),this.writeFloat(re)},writeDoubleField:function(X,re){this.writeTag(X,e.Fixed64),this.writeDouble(re)},writeBooleanField:function(X,re){this.writeVarintField(X,!!re)}},lx}var pv=ro(G1());const ux=3;function xC(n,e,i){e.glyphs=[],n===1&&i.readMessage(bC,e)}function bC(n,e,i){if(n===3){const{id:o,bitmap:l,width:d,height:f,left:y,top:x,advance:T}=i.readMessage(wC,{});e.glyphs.push({id:o,bitmap:new bu({width:d+2*ux,height:f+2*ux},l),metrics:{width:d,height:f,left:y,top:x,advance:T}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function wC(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}const TC=ux,Xs={horizontal:1,vertical:2,horizontalOnly:3};class j_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const o=new j_;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new j_;return i.image=e,i}}class wg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,o){const l=new wg;for(let d=0;d<e.sections.length;d++){const f=e.sections[d];f.image?l.addImageSection(f,o):l.addTextSection(f,i)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,o){let l="";for(let d=0;d<i.length;d++){const f=i.charCodeAt(d+1)||null,y=i.charCodeAt(d-1)||null;l+=!o&&(f&&_f(f)&&!F_[i[d+1]]||y&&_f(y)&&!F_[i[d-1]])||!F_[i[d]]?i[d]:F_[i[d]]}return l}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&mv[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&mv[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new wg;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(j_.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(o)}addImageSection(e,i){const o=e.image?e.image.getPrimary():null;if(!o)return void Ui("Can't add FormattedSection with an empty image.");o.scaleSelf(i);const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCodePoint(l),this.sections.push(j_.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Ui("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hx(n,e,i,o,l,d,f,y,x,T,M,R,D,B,F,q=1){const J=wg.fromFeature(n,l,q);R===Xs.vertical&&J.verticalizePunctuation(D);let te=[];const he=function(_e,ze,Ne,Ue,qe,ot){if(!_e)return[];const St=[],gt=function(yt,it,rt,Dt,Ot,hi){let ti=0;for(let Gt=0;Gt<yt.length();Gt++){const It=yt.getSection(Gt);ti+=H1(yt.getCodePoint(Gt),It,Dt,Ot,it,hi)}return ti/Math.max(1,Math.ceil(ti/rt))}(_e,ze,Ne,Ue,qe,ot),xt=_e.text.indexOf("")>=0;let Rt=0;for(let yt=0;yt<_e.length();yt++){const it=_e.getSection(yt),rt=_e.getCodePoint(yt);if(mv[rt]||(Rt+=H1(rt,it,Ue,qe,ze,ot)),yt<_e.length()-1){const Dt=!((nt=rt)<11904||!(Si["Bopomofo Extended"](nt)||Si.Bopomofo(nt)||Si["CJK Compatibility Forms"](nt)||Si["CJK Compatibility Ideographs"](nt)||Si["CJK Compatibility"](nt)||Si["CJK Radicals Supplement"](nt)||Si["CJK Strokes"](nt)||Si["CJK Symbols and Punctuation"](nt)||Si["CJK Unified Ideographs Extension A"](nt)||Si["CJK Unified Ideographs"](nt)||Si["Enclosed CJK Letters and Months"](nt)||Si["Halfwidth and Fullwidth Forms"](nt)||Si.Hiragana(nt)||Si["Ideographic Description Characters"](nt)||Si["Kangxi Radicals"](nt)||Si["Katakana Phonetic Extensions"](nt)||Si.Katakana(nt)||Si["Vertical Forms"](nt)||Si["Yi Radicals"](nt)||Si["Yi Syllables"](nt)));(SC[rt]||Dt||it.image)&&St.push($1(yt+1,Rt,gt,St,EC(rt,_e.getCodePoint(yt+1),Dt&&xt),!1))}}var nt;return Z1($1(_e.length(),Rt,gt,St,0,!0))}(J,T,d,e,o,B),{processBidirectionalText:ce,processStyledBidirectionalText:X}=fs;if(ce&&J.sections.length===1){const _e=ce(J.toString(),he);for(const ze of _e){const Ne=new wg;Ne.text=ze,Ne.sections=J.sections;for(let Ue=0;Ue<ze.length;Ue++)Ne.sectionIndex.push(0);te.push(Ne)}}else if(X){const _e=X(J.text,J.sectionIndex,he);for(const ze of _e){const Ne=new wg;Ne.text=ze[0],Ne.sectionIndex=ze[1],Ne.sections=J.sections,te.push(Ne)}}else te=function(_e,ze){const Ne=[],Ue=_e.text;let qe=0;for(const ot of ze)Ne.push(_e.substring(qe,ot)),qe=ot;return qe<Ue.length&&Ne.push(_e.substring(qe,Ue.length)),Ne}(J,he);const re=[],ue={positionedLines:re,text:J.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:R,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(_e,ze,Ne,Ue,qe,ot,St,gt,xt,Rt,nt,yt){let it=0,rt=0,Dt=0;const Ot=gt==="right"?1:gt==="left"?0:.5;let hi=!1;for(const li of qe){const Oi=li.getSections();for(const qi of Oi){if(qi.image)continue;const $i=ze[qi.fontStack];if($i&&(hi=$i.ascender!==void 0&&$i.descender!==void 0,!hi))break}if(!hi)break}let ti=0;for(const li of qe){li.trim();const Oi=li.getMaxScale(),qi=(Oi-1)*Ia,$i={positionedGlyphs:[],lineOffset:0};_e.positionedLines[ti]=$i;const en=$i.positionedGlyphs;let Qi=0;if(!li.length()){rt+=ot,++ti;continue}let Xi=0,Kn=0;for(let me=0;me<li.length();me++){const xe=li.getSection(me),ct=li.getSectionIndex(me),Ft=li.getCodePoint(me);let qt=xe.scale,Ht=null,ui=null,Ii=null,hn=Ia,dn=0;xt===Xs.vertical&&((Gt=Ft)===12312||Gt===12313||Gt===12316||Gt===12540||Gt===12448)&&(xt=Xs.horizontal);const Wi=!(xt===Xs.horizontal||!nt&&!na(Ft)||nt&&(mv[Ft]||dd(Ft)));if(xe.image){const Hn=Ue.get(xe.image.toString());if(!Hn)continue;Ii=xe.image,_e.iconsInText=_e.iconsInText||!0,ui=Hn.paddedRect;const rr=Hn.displaySize;qt=qt*Ia/yt,Ht={width:rr[0],height:rr[1],left:0,top:-3,advance:Wi?rr[1]:rr[0],localGlyph:!1},dn=hi?-Ht.height*qt:Oi*Ia-17-rr[1]*qt,hn=Ht.advance;const fn=(Wi?rr[0]:rr[1])*qt-Ia*Oi;fn>0&&fn>Qi&&(Qi=fn)}else{const Hn=Ne[xe.fontStack];if(!Hn)continue;Hn[Ft]&&(ui=Hn[Ft]);const rr=ze[xe.fontStack];if(!rr)continue;const fn=rr.glyphs[Ft];if(!fn)continue;if(Ht=fn.metrics,hn=Ft!==8203?Ia:0,hi){const Cr=rr.ascender!==void 0?Math.abs(rr.ascender):0,lr=rr.descender!==void 0?Math.abs(rr.descender):0,Vn=(Cr+lr)*qt;Xi<Vn&&(Xi=Vn,Kn=(Cr-lr)/2*qt),dn=-Cr*qt}else dn=(Oi-qt)*Ia-17}Wi?(_e.verticalizable=!0,en.push({glyph:Ft,image:Ii,x:it,y:rt+dn,vertical:Wi,scale:qt,localGlyph:Ht.localGlyph,fontStack:xe.fontStack,sectionIndex:ct,metrics:Ht,rect:ui}),it+=hn*qt+Rt):(en.push({glyph:Ft,image:Ii,x:it,y:rt+dn,vertical:Wi,scale:qt,localGlyph:Ht.localGlyph,fontStack:xe.fontStack,sectionIndex:ct,metrics:Ht,rect:ui}),it+=Ht.advance*qt+Rt)}en.length!==0&&(Dt=Math.max(it-Rt,Dt),hi?X1(en,Ot,Qi,Kn,ot*Oi/2):X1(en,Ot,Qi,0,ot/2)),it=0;const sr=ot*Oi+Qi;$i.lineOffset=Math.max(Qi,qi),rt+=sr,++ti}var Gt;const It=rt,{horizontalAlign:ji,verticalAlign:si}=dx(St);(function(li,Oi,qi,$i,en,Qi){const Xi=(Oi-qi)*en,Kn=-Qi*$i;for(const sr of li)for(const me of sr.positionedGlyphs)me.x+=Xi,me.y+=Kn})(_e.positionedLines,Ot,ji,si,Dt,It),_e.top+=-si*It,_e.bottom=_e.top+It,_e.left+=-ji*Dt,_e.right=_e.left+Dt,_e.hasBaseline=hi}(ue,e,i,o,te,f,y,x,R,T,D,F),!function(_e){for(const ze of _e)if(ze.positionedGlyphs.length!==0)return!1;return!0}(re))return ue}const mv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},SC={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function H1(n,e,i,o,l,d){if(e.image){const f=o.get(e.image.toString());return f?f.displaySize[0]*e.scale*Ia/d+l:0}{const f=i[e.fontStack],y=f&&f.glyphs[n];return y?y.metrics.advance*e.scale+l:0}}function q1(n,e,i,o){const l=Math.pow(n-e,2);return o?n<e?l/2:2*l:l+Math.abs(i)*i}function EC(n,e,i){let o=0;return n===10&&(o-=1e4),i&&(o+=150),n!==40&&n!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function $1(n,e,i,o,l,d){let f=null,y=q1(e,i,l,d);for(const x of o){const T=q1(e-x.x,i,l,d)+x.badness;T<=y&&(f=x,y=T)}return{index:n,x:e,priorBreak:f,badness:y}}function Z1(n){return n?Z1(n.priorBreak).concat(n.index):[]}function dx(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function X1(n,e,i,o,l){if(!(e||i||o||l))return;const d=n.length-1,f=n[d],y=(f.x+f.metrics.advance*f.scale)*e;for(let x=0;x<=d;x++)n[x].x-=y,n[x].y+=i+o+l}function W1(n){return n.imagePrimary!==void 0&&n.top!==void 0&&n.bottom!==void 0&&n.left!==void 0&&n.right!==void 0}function AC(n,e,i,o){const{horizontalAlign:l,verticalAlign:d}=dx(o),f=i[0]-n.displaySize[0]*l,y=i[1]-n.displaySize[1]*d;return{imagePrimary:n,imageSecondary:e,top:y,bottom:y+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function Y1(n,e,i,o,l,d){const f=n.imagePrimary;let y;if(f.content){const J=f.content,te=f.pixelRatio||1;y=[J[0]/te,J[1]/te,f.displaySize[0]-J[2]/te,f.displaySize[1]-J[3]/te]}const x=e.left*d,T=e.right*d;let M,R,D,B;i==="width"||i==="both"?(B=l[0]+x-o[3],R=l[0]+T+o[1]):(B=l[0]+(x+T-f.displaySize[0])/2,R=B+f.displaySize[0]);const F=e.top*d,q=e.bottom*d;return i==="height"||i==="both"?(M=l[1]+F-o[0],D=l[1]+q+o[2]):(M=l[1]+(F+q-f.displaySize[1])/2,D=M+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:M,right:R,bottom:D,left:B,collisionPadding:y}}function K1(n){return!n.imagePrimary.stretchX}function Q1(n){return!n.imagePrimary.stretchY}function J1(n){return{width:n.right-n.left,height:n.bottom-n.top}}const Sh=128;function ew(n,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Fn(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:l}=i;let d=0;for(;d<o.length&&o[d]<=n;)d++;d=Math.max(0,d-1);let f=d;for(;f<o.length&&o[f]<n+1;)f++;f=Math.min(o.length-1,f);const y=o[d],x=o[f];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:l}:{kind:"camera",minZoom:y,maxZoom:x,minSize:i.evaluate(new Fn(y)),maxSize:i.evaluate(new Fn(x)),interpolationType:l}}}function fx(n,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:l}){return n.kind==="source"?o/Sh:n.kind==="composite"?Ti(o/Sh,l/Sh,i):e}function U_(n,e,i=1){let o=0,l=0;if(n.kind==="constant")l=n.layoutSize*i;else if(n.kind!=="source"){const{interpolationType:d,minZoom:f,maxZoom:y}=n,x=d?Me(co.interpolationFactor(d,e,f,y),0,1):0;n.kind==="camera"?l=Ti(n.minSize,n.maxSize,x)*i:o=x*i}return{uSizeT:o,uSize:l}}class Ud extends Bt{constructor(e,i,o,l,d){super(e,i),this.angle=l,this.z=o,d!==void 0&&(this.segment=d)}clone(){return new Ud(this.x,this.y,this.z,this.angle,this.segment)}}function tw(n,e,i,o,l){if(e.segment===void 0)return!0;let d=e,f=e.segment+1,y=0;for(;y>-i/2;){if(f--,f<0)return!1;y-=n[f].dist(d),d=n[f]}y+=n[f].dist(n[f+1]),f++;const x=[];let T=0;for(;y<i/2;){const M=n[f],R=n[f+1];if(!R)return!1;let D=n[f-1].angleTo(M)-M.angleTo(R);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:D}),T+=D;y-x[0].distance>o;)T-=x.shift().angleDelta;if(T>l)return!1;f++,y+=M.dist(R)}return!0}function iw(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function nw(n,e,i){return n?.6*e*i:0}function rw(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function MC(n,e,i,o,l,d){const f=nw(i,l,d),y=rw(i,o)*d;let x=0;const T=iw(n)/2;for(let M=0;M<n.length-1;M++){const R=n[M],D=n[M+1],B=R.dist(D);if(x+B>T){const F=(T-x)/B,q=Ti(R.x,D.x,F),J=Ti(R.y,D.y,F),te=new Ud(q,J,0,D.angleTo(R),M);return!f||tw(n,te,y,f,e)?te:void 0}x+=B}}function CC(n,e,i,o,l,d,f,y,x){const T=nw(o,d,f),M=rw(o,l),R=M*f,D=n[0].x===0||n[0].x===x||n[0].y===0||n[0].y===x;return e-R<e/4&&(e=R+e/4),aw(n,D?e/2*y%e:(M/2+2*d)*f*y%e,e,T,i,R,D,!1,x)}function aw(n,e,i,o,l,d,f,y,x){const T=d/2,M=iw(n);let R=0,D=e-i,B=[];for(let F=0;F<n.length-1;F++){const q=n[F],J=n[F+1],te=q.dist(J),he=J.angleTo(q);for(;D+i<R+te;){D+=i;const ce=(D-R)/te,X=Ti(q.x,J.x,ce),re=Ti(q.y,J.y,ce);if(X>=0&&X<x&&re>=0&&re<x&&D-T>=0&&D+T<=M){const ue=new Ud(X,re,0,he,F);o&&!tw(n,ue,d,o,l)||B.push(ue)}}R+=te}return y||B.length||f||(B=aw(n,R/2,i,o,l,d,f,!0,x)),B}function ow(n){let e=0,i=0;for(const f of n)e+=f.w*f.h,i=Math.max(i,f.w);n.sort((f,y)=>y.h-f.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let l=0,d=0;for(const f of n)for(let y=o.length-1;y>=0;y--){const x=o[y];if(!(f.w>x.w||f.h>x.h)){if(f.x=x.x,f.y=x.y,d=Math.max(d,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===x.w&&f.h===x.h){const T=o.pop();y<o.length&&(o[y]=T)}else f.h===x.h?(x.x+=f.w,x.w-=f.w):f.w===x.w?(x.y+=f.h,x.h-=f.h):(o.push({x:x.x+f.w,y:x.y,w:x.w-f.w,h:f.h}),x.y+=f.h,x.h-=f.h);break}}return{w:l,h:d,fill:e/(l*d)||0}}Wt(Ud,"Anchor");const fm=1;class V_{static getImagePositionScale(e,i,o){if(i&&e&&e.options&&e.options.transform){const l=e.options.transform;return{x:l.a,y:l.d}}return{x:o,y:o}}constructor(e,i,o,l){this.paddedRect=e;const{pixelRatio:d,version:f,stretchX:y,stretchY:x,content:T,sdf:M,usvg:R}=i;this.pixelRatio=d,this.stretchX=y,this.stretchY=x,this.content=T,this.version=f,this.padding=o,this.sdf=M,this.scale=V_.getImagePositionScale(l,R,d)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function px(n,e,i){const o=ls.parse(n),l=function(d,f,y=[1,1]){return{x:0,y:0,w:(d.data?d.data.width:d.width*y[0])+2*f,h:(d.data?d.data.height:d.height*y[1])+2*f}}(e,i,[o.options.transform.a,o.options.transform.d]);return{bin:l,imagePosition:new V_(l,e,i,o),imageVariant:o}}class sw{constructor(e,i,o){const l=new Map,d=new Map;this.haveRenderCallbacks=[];const f=[];this.addImages(e,l,fm,f),this.addImages(i,d,2,f);const{w:y,h:x}=ow(f),T=new xa({width:y||1,height:x||1});for(const[M,R]of e.entries()){const D=l.get(M).paddedRect;xa.copy(R.data,T,{x:0,y:0},{x:D.x+fm,y:D.y+fm},R.data,o,R.sdf)}for(const[M,R]of i.entries()){const D=d.get(M),B=D.paddedRect;let F=D.padding;const q=B.x+F,J=B.y+F,te=R.data.width,he=R.data.height;F=F>1?F-1:F,xa.copy(R.data,T,{x:0,y:0},{x:q,y:J},R.data,o),xa.copy(R.data,T,{x:0,y:he-F},{x:q,y:J-F},{width:te,height:F},o),xa.copy(R.data,T,{x:0,y:0},{x:q,y:J+he},{width:te,height:F},o),xa.copy(R.data,T,{x:te-F,y:0},{x:q-F,y:J},{width:F,height:he},o),xa.copy(R.data,T,{x:0,y:0},{x:q+te,y:J},{width:F,height:he},o),xa.copy(R.data,T,{x:te-F,y:he-F},{x:q-F,y:J-F},{width:F,height:F},o),xa.copy(R.data,T,{x:0,y:he-F},{x:q+te,y:J-F},{width:F,height:F},o),xa.copy(R.data,T,{x:0,y:0},{x:q+te,y:J+he},{width:F,height:F},o),xa.copy(R.data,T,{x:te-F,y:0},{x:q-F,y:J+he},{width:F,height:F},o)}this.lut=o,this.image=T,this.iconPositions=l,this.patternPositions=d}addImages(e,i,o,l){for(const[d,f]of e.entries()){const{bin:y,imagePosition:x,imageVariant:T}=px(d,f,o);i.set(d,x),l.push(y),f.hasRenderCallback&&this.haveRenderCallbacks.push(T.id)}}patchUpdatedImages(e,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>e.hasImage(l,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(const l of e.getUpdatedImages(o)){for(const d of this.iconPositions.keys()){const f=ls.parse(d);if(Co.isEqual(f.id,l)){const y=e.getImage(l,o);this.patchUpdatedImage(this.iconPositions.get(d),y,i)}}for(const d of this.patternPositions.keys()){const f=ls.parse(d);if(Co.isEqual(f.id,l)){const y=e.getImage(l,o);this.patchUpdatedImage(this.patternPositions.get(d),y,i)}}}}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[l,d]=e.tl,f=e.sdf;if(this.lut||f){const y={width:i.data.width,height:i.data.height},x=new xa(y);xa.copy(i.data,x,{x:0,y:0},{x:0,y:0},y,this.lut,f),o.update(x,{position:{x:l,y:d}})}else o.update(i.data,{position:{x:l,y:d}})}}Wt(V_,"ImagePosition"),Wt(sw,"ImageAtlas");const gv=1e20;function lw(n,e,i,o,l,d,f,y,x){for(let T=e;T<e+o;T++)cw(n,i*d+T,d,l,f,y,x);for(let T=i;T<i+l;T++)cw(n,T*d+e,1,o,f,y,x)}function cw(n,e,i,o,l,d,f){d[0]=0,f[0]=-1e20,f[1]=gv,l[0]=n[e];for(let y=1,x=0,T=0;y<o;y++){l[y]=n[e+y*i];const M=y*y;do{const R=d[x];T=(l[y]-l[R]+M-R*R)/(y-R)/2}while(T<=f[x]&&--x>-1);x++,d[x]=y,f[x]=T,f[x+1]=gv}for(let y=0,x=0;y<o;y++){for(;f[x+1]<y;)x++;const T=d[x],M=y-T;n[e+y*i]=l[T]+M*M}}const Ru=2,mx={none:0,ideographs:1,all:2};class Tg{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,o){const l=[],d=this.urls[i]||Wr.GLYPHS_URL;for(const f in e)for(const y of e[f])l.push({stack:f,id:y});Ye(l,({stack:f,id:y},x)=>{let T=this.entries[f];T||(T=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let M=T.glyphs[y];if(M!==void 0)return void x(null,{stack:f,id:y,glyph:M});if(M=this._tinySDF(T,f,y),M)return T.glyphs[y]=M,void x(null,{stack:f,id:y,glyph:M});const R=Math.floor(y/256);if(256*R>65535)return Ui("glyphs > 65535 not supported"),void x(null,{stack:f,id:y,glyph:M});if(T.ranges[R])return void x(null,{stack:f,id:y,glyph:M});let D=T.requests[R];D||(D=T.requests[R]=[],Tg.loadGlyphRange(f,R,d,this.requestManager,(B,F)=>{if(F){T.ascender=F.ascender,T.descender=F.descender;for(const q in F.glyphs)this._doesCharSupportLocalGlyph(+q)||(T.glyphs[+q]=F.glyphs[+q]);T.ranges[R]=!0}for(const q of D)q(B,F);delete T.requests[R]})),D.push((B,F)=>{B?x(B):F&&x(null,{stack:f,id:y,glyph:F.glyphs[y]||null})})},(f,y)=>{if(f)o(f);else if(y){const x={};for(const{stack:T,id:M,glyph:R}of y)x[T]===void 0&&(x[T]={}),x[T].glyphs===void 0&&(x[T].glyphs={}),x[T].glyphs[M]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics},x[T].ascender=this.entries[T].ascender,x[T].descender=this.entries[T].descender;o(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==mx.none&&(this.localGlyphMode===mx.all?!!this.localFontFamily:!!this.localFontFamily&&(Si["CJK Unified Ideographs"](e)||Si["Hangul Syllables"](e)||Si.Hiragana(e)||Si.Katakana(e)||Si["CJK Symbols and Punctuation"](e)||Si["CJK Unified Ideographs Extension A"](e)||Si["CJK Unified Ideographs Extension B"](e)||Si.Osage(e)))}_tinySDF(e,i,o){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(o))return;let d=e.tinySDF;if(!d){let q="400";/bold/i.test(i)?q="900":/medium/i.test(i)?q="500":/light/i.test(i)&&(q="200"),d=e.tinySDF=new Tg.TinySDF({fontFamily:l,fontWeight:q,fontSize:24*Ru,buffer:3*Ru,radius:8*Ru}),d.fontWeight=q}if(this.localGlyphs[d.fontWeight][o])return this.localGlyphs[d.fontWeight][o];const f=String.fromCodePoint(o),{data:y,width:x,height:T,glyphWidth:M,glyphHeight:R,glyphLeft:D,glyphTop:B,glyphAdvance:F}=d.draw(f);return this.localGlyphs[d.fontWeight][o]={id:o,bitmap:new bu({width:x,height:T},y),metrics:{width:M/Ru,height:R/Ru,left:D/Ru,top:B/Ru-27,advance:F/Ru,localGlyph:!0}}}}Tg.loadGlyphRange=function(n,e,i,o,l){const d=256*e,f=d+255,y=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${d}-${f}`),Gu.Glyphs);Xl(y,(x,T)=>{if(x)l(x);else if(T){const M={},R=function(D){return new pv(D).readFields(xC,{})}(T);for(const D of R.glyphs)M[D.id]=D;l(null,{glyphs:M,ascender:R.ascender,descender:R.descender})}})},Tg.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:l="sans-serif",fontWeight:d="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=i;const y=this.size=n+4*e,x=this._createCanvas(y),T=this.ctx=x.getContext("2d",{willReadFrequently:!0});T.font=`${f} ${d} ${n}px ${l}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:l,actualBoundingBoxRight:d}=this.ctx.measureText(n),f=Math.ceil(i),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-l))),x=Math.min(this.size-this.buffer,f+Math.ceil(o)),T=y+2*this.buffer,M=x+2*this.buffer,R=Math.max(T*M,0),D=new Uint8ClampedArray(R),B={data:D,width:T,height:M,glyphWidth:y,glyphHeight:x,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(y===0||x===0)return B;const{ctx:F,buffer:q,gridInner:J,gridOuter:te}=this;F.clearRect(q,q,y,x),F.fillText(n,q,q+f);const he=F.getImageData(q,q,y,x);te.fill(gv,0,R),J.fill(0,0,R);for(let ce=0;ce<x;ce++)for(let X=0;X<y;X++){const re=he.data[4*(ce*y+X)+3]/255;if(re===0)continue;const ue=(ce+q)*T+X+q;if(re===1)te[ue]=0,J[ue]=gv;else{const _e=.5-re;te[ue]=_e>0?_e*_e:0,J[ue]=_e<0?_e*_e:0}}lw(te,0,0,T,M,T,this.f,this.v,this.z),lw(J,q,q,y,x,T,this.f,this.v,this.z);for(let ce=0;ce<R;ce++){const X=Math.sqrt(te[ce])-Math.sqrt(J[ce]);D[ce]=Math.round(255-255*(X/this.radius+this.cutoff))}return B}};const pm=fm;function uw(n,e){return n+e[1]-e[0]}function hw(n,e,i,o,l=1){const d=[],f=n.imagePrimary,y=f.pixelRatio,x=f.paddedRect.w-2*pm,T=f.paddedRect.h-2*pm,M=(n.right-n.left)*l,R=(n.bottom-n.top)*l,D=f.stretchX||[[0,x]],B=f.stretchY||[[0,T]],F=D.reduce(uw,0),q=B.reduce(uw,0),J=x-F,te=T-q;let he=0,ce=F,X=0,re=q,ue=0,_e=J,ze=0,Ne=te;if(f.content&&o){const qe=f.content;he=_v(D,0,qe[0]),X=_v(B,0,qe[1]),ce=_v(D,qe[0],qe[2]),re=_v(B,qe[1],qe[3]),ue=qe[0]-he,ze=qe[1]-X,_e=qe[2]-qe[0]-ce,Ne=qe[3]-qe[1]-re}const Ue=(qe,ot,St,gt)=>{const xt=yv(qe.stretch-he,ce,M,n.left*l),Rt=vv(qe.fixed-ue,_e,qe.stretch,F),nt=yv(ot.stretch-X,re,R,n.top*l),yt=vv(ot.fixed-ze,Ne,ot.stretch,q),it=yv(St.stretch-he,ce,M,n.left*l),rt=vv(St.fixed-ue,_e,St.stretch,F),Dt=yv(gt.stretch-X,re,R,n.top*l),Ot=vv(gt.fixed-ze,Ne,gt.stretch,q),hi=new Bt(xt,nt),ti=new Bt(it,nt),Gt=new Bt(it,Dt),It=new Bt(xt,Dt),ji=new Bt(Rt/y,yt/y),si=new Bt(rt/y,Ot/y),li=e*Math.PI/180;if(li){const Xi=Math.sin(li),Kn=Math.cos(li),sr=[Kn,-Xi,Xi,Kn];hi._matMult(sr),ti._matMult(sr),It._matMult(sr),Gt._matMult(sr)}const Oi=qe.stretch+qe.fixed,qi=St.stretch+St.fixed,$i=ot.stretch+ot.fixed,en=gt.stretch+gt.fixed,Qi=n.imageSecondary;return{tl:hi,tr:ti,bl:It,br:Gt,texPrimary:{x:f.paddedRect.x+pm+Oi,y:f.paddedRect.y+pm+$i,w:qi-Oi,h:en-$i},texSecondary:Qi?{x:Qi.paddedRect.x+pm+Oi,y:Qi.paddedRect.y+pm+$i,w:qi-Oi,h:en-$i}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ji,pixelOffsetBR:si,minFontScaleX:_e/y/M,minFontScaleY:Ne/y/R,isSDF:i}};if(o&&(f.stretchX||f.stretchY)){const qe=dw(D,J,F),ot=dw(B,te,q);for(let St=0;St<qe.length-1;St++){const gt=qe[St],xt=qe[St+1];for(let Rt=0;Rt<ot.length-1;Rt++)d.push(Ue(gt,ot[Rt],xt,ot[Rt+1]))}}else d.push(Ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:T+1}));return d}function _v(n,e,i){let o=0;for(const l of n)o+=Math.max(e,Math.min(i,l[1]))-Math.max(e,Math.min(i,l[0]));return o}function dw(n,e,i){const o=[{fixed:-1,stretch:0}];for(const[l,d]of n){const f=o[o.length-1];o.push({fixed:l-f.stretch,stretch:f.stretch}),o.push({fixed:l-f.stretch,stretch:f.stretch+(d-l)})}return o.push({fixed:e+pm,stretch:i}),o}function yv(n,e,i,o){return n/e*i+o}function vv(n,e,i,o){return n-e*i/o}function RC(n,e,i,o){const l=e+n.positionedLines[o].lineOffset;return o===0?i+l/2:i+(l+(e+n.positionedLines[o-1].lineOffset))/2}function IC(n,e=1,i=!1){let o=1/0,l=1/0,d=-1/0,f=-1/0;const y=n[0];for(let B=0;B<y.length;B++){const F=y[B];(!B||F.x<o)&&(o=F.x),(!B||F.y<l)&&(l=F.y),(!B||F.x>d)&&(d=F.x),(!B||F.y>f)&&(f=F.y)}const x=Math.min(d-o,f-l);let T=x/2;const M=new Yh([],DC);if(x===0)return new Bt(o,l);for(let B=o;B<d;B+=x)for(let F=l;F<f;F+=x)M.push(new Sg(B+T,F+T,T,n));let R=function(B){let F=0,q=0,J=0;const te=B[0];for(let he=0,ce=te.length,X=ce-1;he<ce;X=he++){const re=te[he],ue=te[X],_e=re.x*ue.y-ue.x*re.y;q+=(re.x+ue.x)*_e,J+=(re.y+ue.y)*_e,F+=3*_e}return new Sg(q/F,J/F,0,B)}(n),D=M.length;for(;M.length;){const B=M.pop();(B.d>R.d||!R.d)&&(R=B,i&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,D)),B.max-R.d<=e||(T=B.h/2,M.push(new Sg(B.p.x-T,B.p.y-T,T,n)),M.push(new Sg(B.p.x+T,B.p.y-T,T,n)),M.push(new Sg(B.p.x-T,B.p.y+T,T,n)),M.push(new Sg(B.p.x+T,B.p.y+T,T,n)),D+=4)}return i&&(console.log(`num probes: ${D}`),console.log(`best distance: ${R.d}`)),R.p}function DC(n,e){return e.max-n.max}class Sg{constructor(e,i,o,l){this.p=new Bt(e,i),this.h=o,this.d=function(d,f){let y=!1,x=1/0;for(let T=0;T<f.length;T++){const M=f[T];for(let R=0,D=M.length,B=D-1;R<D;B=R++){const F=M[R],q=M[B];F.y>d.y!=q.y>d.y&&d.x<(q.x-F.x)*(d.y-F.y)/(q.y-F.y)+F.x&&(y=!y),x=Math.min(x,on(d,F,q))}}return(y?1:-1)*Math.sqrt(x)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}}const zC=Object.keys,gx=Number.POSITIVE_INFINITY,PC=Math.sqrt(2);function fw(n,[e,i]){let o=0,l=0;if(i===gx){e<0&&(e=0);const d=e/PC;switch(n){case"top-right":case"top-left":l=d-7;break;case"bottom-right":case"bottom-left":l=7-d;break;case"bottom":l=7-e;break;case"top":l=e-7}switch(n){case"top-right":case"bottom-right":o=-d;break;case"top-left":case"bottom-left":o=d;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":l=i-7;break;case"bottom-right":case"bottom-left":case"bottom":l=7-i}switch(n){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,l]}function xv(n,e,i,o,l,d,f,y,x){if(!e||!e.usvg)return;const T=J1(o),M=J1(l),R=d!=="both"&&d!=="width"||!K1(o)?1:Math.max(1,M.width/T.width),D=d!=="both"&&d!=="height"||!Q1(o)?1:Math.max(1,M.height/T.height);i.scaleSelf(R,D);const B=i.toString();f.set(B,i),y.set(B,e);const{imagePosition:F}=px(B,e,fm);x.set(B,F)}function pw(n,e,i,o,l,d,f,y){if(!n)return;const x=function(T,M,R,D,B){if(T.kind==="camera")return T.maxSize;if(T.kind==="composite"){const F=M.possiblyEvaluate(new Fn(T.maxZoom),R).evaluate(B,{},R),q=M.possiblyEvaluate(new Fn(T.minZoom),R).evaluate(B,{},R);return Math.max(F,q)}return M.possiblyEvaluate(new Fn(D)).evaluate(B,{},R)}(e,i,o,l,d);return n.scaleSelf(x*y*f)}function mw(n,e,i,o,l,d,f,y){return{iconPrimary:pw(n.getPrimary(),e,i,o,l,d,f,y),iconSecondary:pw(n.getSecondary(),e,i,o,l,d,f,y)}}function gw(n,e,i,o){if(!n)return;const l=e.get(i.toString());if(n.imagePrimary=l,o){const d=e.get(o.toString());n.imageSecondary=d}}function LC(n,e){for(const i in n.horizontal)_w(n.horizontal[i],e);_w(n.vertical,e)}function _w(n,e){if(n){for(const i of n.positionedLines)for(const o of i.positionedGlyphs)if(o.image!==null){const l=o.image.toString();o.rect=e.get(l).paddedRect}}}function _x(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function OC(n,e,i,o,l,d,f,y,x){const T=yx(d.horizontal)||d.vertical,M=i.get("icon-text-fit-padding").evaluate(o,{},l);let R,D=e;return e&&x!=="none"&&(n.allowVerticalPlacement&&d.vertical&&(R=Y1(e,d.vertical,x,M,y,f)),T&&(D=Y1(e,T,x,M,y,f))),{defaultShapedIcon:D,verticallyShapedIcon:R}}function kC(n,e,i,o,l,d,f,y,x,T,M,R,D,B,F,q,J,te,he,ce){let X=f.textMaxSize.evaluate(e,{},D);X===void 0?X=y*f.textScaleFactor:X*=f.textScaleFactor;const re=n.layers[0].layout,ue=yx(i.horizontal)||i.vertical,_e=B.name==="globe",ze=Ia,Ne=n.tilePixelRatio*X/ze,Ue=(Rt=n.overscaling,n.zoom>18&&Rt>2&&(Rt>>=1),Math.max(Ut/(512*Rt),1)*re.get("symbol-spacing")),qe=re.get("text-padding")*n.tilePixelRatio,ot=re.get("icon-padding")*n.tilePixelRatio,St=V(re.get("text-max-angle")),gt=re.get("icon-rotation-alignment")==="map"&&ce!=="point",xt=Ue/2;var Rt;n.hasAnyIconTextFit===!1&&J!=="none"&&(n.hasAnyIconTextFit=!0);const nt=e.properties?+e.properties[kd]:null,yt=nt&&n.elevationFeatureIdToIndex?n.elevationFeatureIdToIndex.get(nt):65535,it=(rt,Dt,Ot)=>{if(Dt.x<0||Dt.x>=Ut||Dt.y<0||Dt.y>=Ut)return;let hi=null;if(_e){const{x:ti,y:Gt,z:It}=B.projectTilePoint(Dt.x,Dt.y,Ot);hi={anchor:new Ud(ti,Gt,It,0,void 0),up:B.upVector(Ot,Dt.x,Dt.y)}}(function(ti,Gt,It,ji,si,li,Oi,qi,$i,en,Qi,Xi,Kn,sr,me,xe,ct,Ft,qt,Ht,ui,Ii,hn,dn,Wi,Hn,rr,fn,Cr){const lr=ti.addToLineVertexArray(Gt,ji);let Vn,Or,fr,ar,cr,Xn,Ji,Wn=0,Rr=0,Ri=0,Tn=0,pr=-1,Dr=-1;const xr={};let ua=Mo("");const Qn=It?It.anchor:Gt,oa=fn!=="none";let bs=0,Ja=0;if($i._unevaluatedLayout.getValue("text-radial-offset")===void 0){const ha=$i.layout.get("text-offset").evaluate(ui,{},Wi);bs=ha[0]*Ia,Ja=ha[1]*Ia}else bs=$i.layout.get("text-radial-offset").evaluate(ui,{},Wi)*Ia,Ja=gx;if(ti.allowVerticalPlacement&&si.vertical){const ha=si.vertical;if(me)Xn=vx(ha),qi&&(Ji=vx(qi));else{const _a=$i.layout.get("text-rotate").evaluate(ui,{},Wi)+90;fr=bv(en,Qn,Gt,Qi,Xi,Kn,ha,sr,_a,xe),qi&&(ar=bv(en,Qn,Gt,Qi,Xi,Kn,qi,Ft,_a))}}if(li){const ha=ti.iconSizeData,_a=$i.layout.get("icon-rotate").evaluate(ui,{},Wi),eo=hw(li,_a,hn,oa,Ii.iconScaleFactor),jo=qi?hw(qi,_a,hn,oa,Ii.iconScaleFactor):void 0;Or=bv(en,Qn,Gt,Qi,Xi,Kn,li,Ft,_a,null),Wn=4*eo.length;let _o=null;ha.kind==="source"?(_o=[Sh*$i.layout.get("icon-size").evaluate(ui,{},Wi)*Ii.iconScaleFactor],_o[0]>Uf&&Ui(`${ti.layerIds[0]}: Value for "icon-size" is >= ${G_}. Reduce your "icon-size".`)):ha.kind==="composite"&&(_o=[Sh*Ii.compositeIconSizes[0].evaluate(ui,{},Wi)*Ii.iconScaleFactor,Sh*Ii.compositeIconSizes[1].evaluate(ui,{},Wi)*Ii.iconScaleFactor],(_o[0]>Uf||_o[1]>Uf)&&Ui(`${ti.layerIds[0]}: Value for "icon-size" is >= ${G_}. Reduce your "icon-size".`)),ti.addSymbols(ti.icon,eo,_o,Ht,qt,ui,void 0,It,Gt,lr.lineStartIndex,lr.lineLength,-1,dn,Wi,Hn,rr),pr=ti.icon.placedSymbolArray.length-1,jo&&(Rr=4*jo.length,ti.addSymbols(ti.icon,jo,_o,Ht,qt,ui,Xs.vertical,It,Gt,lr.lineStartIndex,lr.lineLength,-1,dn,Wi,Hn,rr),Dr=ti.icon.placedSymbolArray.length-1)}for(const ha in si.horizontal){const _a=ha,eo=si.horizontal[_a];Vn||(ua=Mo(eo.text),me?cr=vx(eo):Vn=bv(en,Qn,Gt,Qi,Xi,Kn,eo,sr,$i.layout.get("text-rotate").evaluate(ui,{},Wi),xe));const jo=eo.positionedLines.length===1;if(Ri+=yw(ti,It,Gt,eo,Oi,$i,me,ui,xe,lr,si.vertical?Xs.horizontal:Xs.horizontalOnly,jo?zC(si.horizontal):[_a],xr,pr,Ii,dn,Wi,Hn),jo)break}si.vertical&&(Tn+=yw(ti,It,Gt,si.vertical,Oi,$i,me,ui,xe,lr,Xs.vertical,["vertical"],xr,Dr,Ii,dn,Wi,Hn));let Fa=-1;const ws=(ha,_a)=>ha?Math.max(ha,_a):_a;Fa=ws(cr,Fa),Fa=ws(Xn,Fa),Fa=ws(Ji,Fa);const Eh=Fa>-1?1:0;ti.glyphOffsetArray.length>=65535&&Ui("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ui.sortKey!==void 0&&ti.addToSortKeyRanges(ti.symbolInstances.length,ui.sortKey),ti.symbolInstances.emplaceBack(Gt.x,Gt.y,Qn.x,Qn.y,Qn.z,xr.right>=0?xr.right:-1,xr.center>=0?xr.center:-1,xr.left>=0?xr.left:-1,xr.vertical>=0?xr.vertical:-1,pr,Dr,ua,Vn!==void 0?Vn:ti.collisionBoxArray.length,Vn!==void 0?Vn+1:ti.collisionBoxArray.length,fr!==void 0?fr:ti.collisionBoxArray.length,fr!==void 0?fr+1:ti.collisionBoxArray.length,Or!==void 0?Or:ti.collisionBoxArray.length,Or!==void 0?Or+1:ti.collisionBoxArray.length,ar||ti.collisionBoxArray.length,ar?ar+1:ti.collisionBoxArray.length,Qi,Ri,Tn,Wn,Rr,Eh,0,bs,Ja,Fa,0,oa?1:0,Cr)})(n,Dt,hi,rt,i,o,d,l,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,qe,he,T,0,ot,gt,te,e,f,M,R,D,F,q,J,yt)};if(ce==="line")for(const rt of s(e.geometry,0,0,Ut,Ut)){const Dt=CC(rt,Ue,St,i.vertical||ue,o,ze,Ne,n.overscaling,Ut);for(const Ot of Dt)ue&&NC(n,ue.text,xt,Ot)||it(rt,Ot,D)}else if(ce==="line-center"){for(const rt of e.geometry)if(rt.length>1){const Dt=MC(rt,St,i.vertical||ue,o,ze,Ne);Dt&&it(rt,Dt,D)}}else if(e.type==="Polygon")for(const rt of ng(e.geometry,0)){const Dt=IC(rt,16);it(rt[0],new Ud(Dt.x,Dt.y,0,0,void 0),D)}else if(e.type==="LineString")for(const rt of e.geometry)it(rt,new Ud(rt[0].x,rt[0].y,0,0,void 0),D);else if(e.type==="Point")for(const rt of e.geometry)for(const Dt of rt)it([Dt],new Ud(Dt.x,Dt.y,0,0,void 0),D)}const G_=255,Uf=G_*Sh;function yw(n,e,i,o,l,d,f,y,x,T,M,R,D,B,F,q,J,te){const he=function(re,ue,_e,ze,Ne,Ue,qe,ot){const St=[];if(ue.positionedLines.length===0)return St;const gt=ze.layout.get("text-rotate").evaluate(Ue,{})*Math.PI/180,xt=function(rt){const Dt=rt[0],Ot=rt[1],hi=Dt*Ot;return hi>0?[Dt,-Ot]:hi<0?[-Dt,Ot]:Dt===0?[Ot,Dt]:[Ot,-Dt]}(_e);let Rt=Math.abs(ue.top-ue.bottom);for(const rt of ue.positionedLines)Rt-=rt.lineOffset;const nt=ue.positionedLines.length,yt=Rt/nt;let it=ue.top-_e[1];for(let rt=0;rt<nt;++rt){const Dt=ue.positionedLines[rt];it=RC(ue,yt,it,rt);for(const Ot of Dt.positionedGlyphs){if(!Ot.rect)continue;const hi=Ot.rect||{};let ti=TC+1,Gt=!0,It=1,ji=0;if(Ot.image){const ui=qe.get(Ot.image.toString());if(!ui)continue;if(ui.sdf){Ui("SDF images are not supported in formatted text and will be ignored.");continue}Gt=!1,It=ui.pixelRatio,ti=fm/It}const si=(Ne||ot)&&Ot.vertical,li=Ot.metrics.advance*Ot.scale/2,Oi=Ot.metrics,qi=Ot.rect;if(qi===null)continue;ot&&ue.verticalizable&&(ji=Ot.image?li-Ot.metrics.width*Ot.scale/2:0);const $i=Ne?[Ot.x+li,Ot.y]:[0,0];let en=[0,0],Qi=[0,0],Xi=!1;Ne||(si?(Qi=[Ot.x+li+xt[0],Ot.y+xt[1]-ji],Xi=!0):en=[Ot.x+li+_e[0],Ot.y+_e[1]-ji]);const Kn=qi.w*Ot.scale/(It*(Ot.localGlyph?Ru:1)),sr=qi.h*Ot.scale/(It*(Ot.localGlyph?Ru:1));let me,xe,ct,Ft;if(si){const ui=Ot.y-it,Ii=new Bt(-li,li-ui),hn=-Math.PI/2,dn=new Bt(...Qi);me=new Bt(-li+en[0],en[1]),me._rotateAround(hn,Ii)._add(dn),me.x+=-ui+li,me.y-=(Oi.left-ti)*Ot.scale;const Wi=Ot.image?Oi.advance*Ot.scale:Ia*Ot.scale,Hn=String.fromCodePoint(Ot.glyph);_C(Hn)?me.x+=(1-ti)*Ot.scale:yC(Hn)?me.x+=Wi-Oi.height*Ot.scale+(-ti-1)*Ot.scale:me.x+=Ot.image||Oi.width+2*ti===qi.w&&Oi.height+2*ti===qi.h?(Wi-sr)/2:(Wi-(Oi.height+2*ti)*Ot.scale)/2,xe=new Bt(me.x,me.y-Kn),ct=new Bt(me.x+sr,me.y),Ft=new Bt(me.x+sr,me.y-Kn)}else{const ui=(Oi.left-ti)*Ot.scale-li+en[0],Ii=(-Oi.top-ti)*Ot.scale+en[1],hn=ui+Kn,dn=Ii+sr;me=new Bt(ui,Ii),xe=new Bt(hn,Ii),ct=new Bt(ui,dn),Ft=new Bt(hn,dn)}if(gt){let ui;ui=Ne?new Bt(0,0):Xi?new Bt(xt[0],xt[1]):new Bt(_e[0],_e[1]),me._rotateAround(gt,ui),xe._rotateAround(gt,ui),ct._rotateAround(gt,ui),Ft._rotateAround(gt,ui)}const qt=new Bt(0,0),Ht=new Bt(0,0);St.push({tl:me,tr:xe,bl:ct,br:Ft,texPrimary:hi,texSecondary:void 0,writingMode:ue.writingMode,glyphOffset:$i,sectionIndex:Ot.sectionIndex,isSDF:Gt,pixelOffsetTL:qt,pixelOffsetBR:Ht,minFontScaleX:0,minFontScaleY:0})}}return St}(0,o,x,d,f,y,l,n.allowVerticalPlacement),ce=n.textSizeData;let X=null;ce.kind==="source"?(X=[Sh*d.layout.get("text-size").evaluate(y,{},J)*F.textScaleFactor],X[0]>Uf&&Ui(`${n.layerIds[0]}: Value for "text-size" is >= ${G_}. Reduce your "text-size".`)):ce.kind==="composite"&&(X=[Sh*F.compositeTextSizes[0].evaluate(y,{},J)*F.textScaleFactor,Sh*F.compositeTextSizes[1].evaluate(y,{},J)*F.textScaleFactor],(X[0]>Uf||X[1]>Uf)&&Ui(`${n.layerIds[0]}: Value for "text-size" is >= ${G_}. Reduce your "text-size".`)),n.addSymbols(n.text,he,X,x,f,y,M,e,i,T.lineStartIndex,T.lineLength,B,q,J,te,!1);for(const re of R)D[re]=n.text.placedSymbolArray.length-1;return 4*he.length}function yx(n){for(const e in n)return n[e];return null}function bv(n,e,i,o,l,d,f,y,x,T){let M=f.top,R=f.bottom,D=f.left,B=f.right;if(W1(f)&&f.collisionPadding){const F=f.collisionPadding;D-=F[0],M-=F[1],B+=F[2],R+=F[3]}if(x){const F=new Bt(D,M),q=new Bt(B,M),J=new Bt(D,R),te=new Bt(B,R),he=V(x);let ce=new Bt(0,0);T&&(ce=new Bt(T[0],T[1])),F._rotateAround(he,ce),q._rotateAround(he,ce),J._rotateAround(he,ce),te._rotateAround(he,ce),D=Math.min(F.x,q.x,J.x,te.x),B=Math.max(F.x,q.x,J.x,te.x),M=Math.min(F.y,q.y,J.y,te.y),R=Math.max(F.y,q.y,J.y,te.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,D,M,B,R,y,o,l,d),n.length-1}function vx(n){W1(n)&&n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function NC(n,e,i,o){const l=n.compareText;if(e in l){const d=l[e];for(let f=d.length-1;f>=0;f--)if(o.dist(d[f])<i)return!0}else l[e]=[];return l[e].push(o),!1}function vw(n,e){const i=n.fovAboveCenter,o=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,l=(n._camera.position[2]*n.worldSize-o)/Math.cos(n._pitch),d=Math.sin(i)*l/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01));let f=Math.sin(n._pitch)*d+l;const y=l*(1/n._horizonShift);if(!n.elevation||n.elevation.exaggeration()===0){let x=Math.max(n.zoom-17,0);n.isOrthographic&&(x/=10),f*=1+x}return Math.min(1.01*f,y)}function H_(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),o=n.x*i,l=(n.x+1)*i,d=n.y*i,f=(n.y+1)*i,y=Ce(o),x=Ce(l),T=Le(d),M=Le(f),R=e.project(y,T),D=e.project(x,T),B=e.project(x,M),F=e.project(y,M);let q=Math.min(R.x,D.x,B.x,F.x),J=Math.min(R.y,D.y,B.y,F.y),te=Math.max(R.x,D.x,B.x,F.x),he=Math.max(R.y,D.y,B.y,F.y);const ce=i/16;function X(ue,_e,ze,Ne,Ue,qe){const ot=(ze+Ue)/2,St=(Ne+qe)/2,gt=e.project(Ce(ot),Le(St)),xt=Math.max(0,q-gt.x,J-gt.y,gt.x-te,gt.y-he);q=Math.min(q,gt.x),te=Math.max(te,gt.x),J=Math.min(J,gt.y),he=Math.max(he,gt.y),xt>ce&&(X(ue,gt,ze,Ne,ot,St),X(gt,_e,ot,St,Ue,qe))}X(R,D,o,d,l,d),X(D,B,l,d,l,f),X(B,F,l,f,o,f),X(F,R,o,f,o,d),q-=ce,J-=ce,te+=ce,he+=ce;const re=1/Math.max(te-q,he-J);return{scale:re,x:q*re,y:J*re,x2:te*re,y2:he*re,projection:e}}function xw(n,{x:e,y:i},o=0){return new Bt(((e-o)*n.scale-n.x)*Ut,(i*n.scale-n.y)*Ut)}const BC=be(new Float32Array(16));class Vf{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new K(0,0)}projectTilePoint(e,i,o){return{x:e,y:i,z:0}}locationPoint(e,i,o,l=!0){return e._coordinatePoint(e.locationCoordinate(i,o),l)}pixelsPerMeter(e,i){return ge(1,e)*i}pixelSpaceConversion(e,i,o){return 1}farthestPixelDistance(e){return vw(e,e.pixelsPerMeter)}pointCoordinate(e,i,o,l){const d=e.horizonLineFromTop(!1),f=new Bt(i,Math.max(d,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,l))}pointCoordinate3D(e,i,o){const l=new Bt(i,o);if(e.elevation)return e.elevation.pointCoordinate(l);{const d=this.pointCoordinate(e,l.x,l.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const o=e.horizonLineFromTop();return i.y<o}createInversionMatrix(e,i){return BC}createTileMatrix(e,i,o){let l,d,f;const y=o.canonical,x=be(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=H_(y,this);l=1,d=T.x+o.wrap*T.scale,f=T.y,je(x,x,[l/T.scale,l/T.scale,e.pixelsPerMeter/i])}else l=i/e.zoomScale(y.z),d=(y.x+Math.pow(2,y.z)*o.wrap)*l,f=y.y*l;return Be(x,x,[d,f,0]),je(x,x,[l/Ut,l/Ut,1]),x}upVector(e,i,o){return[0,0,1]}upVectorScale(e,i,o){return{metersToTile:1}}}class FC extends Vf{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,o]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(V(i));this.n=(l+Math.sin(V(o)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:o,c:l,r0:d}=this,f=V(e-this.center[0]),y=V(i),x=Math.sqrt(l-2*o*Math.sin(y))/o;return{x:x*Math.sin(f*o),y:x*Math.cos(f*o)-d,z:0}}unproject(e,i){const{n:o,c:l,r0:d}=this,f=d+i;let y=Math.atan2(e,Math.abs(f))*Math.sign(f);f*o<0&&(y-=Math.PI*Math.sign(e)*Math.sign(f));const x=V(this.center[0])*o;y=He(y,-Math.PI-x,Math.PI-x);const T=Me(W(y/o)+this.center[0],-180,180),M=Math.asin(Me((l-(e*e+f*f)*o*o)/(2*o),-1,1)),R=Me(W(M),-85.051129,Ze);return new K(T,R)}}const q_=1.340264,$_=-.081106,Z_=893e-6,X_=.003796,wv=Math.sqrt(3)/2;class jC extends Vf{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(wv*Math.sin(i)),l=o*o,d=l*l*l;return{x:.5*(e*Math.cos(o)/(wv*(q_+3*$_*l+d*(7*Z_+9*X_*l)))/Math.PI+.5),y:1-.5*(o*(q_+$_*l+d*(Z_+X_*l))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,l=o*o,d=l*l*l;for(let M,R,D,B=0;B<12&&(R=o*(q_+$_*l+d*(Z_+X_*l))-i,D=q_+3*$_*l+d*(7*Z_+9*X_*l),M=R/D,o=Me(o-M,-Math.PI/3,Math.PI/3),l=o*o,d=l*l*l,!(Math.abs(M)<1e-12));++B);const f=wv*e*(q_+3*$_*l+d*(7*Z_+9*X_*l))/Math.cos(o),y=Math.asin(Math.sin(o)/wv),x=Me(180*f/Math.PI,-180,180),T=Me(180*y/Math.PI,-85.051129,Ze);return new K(x,T)}}class UC extends Vf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const o=360*(e-.5),l=Me(360*(.5-i),-85.051129,Ze);return new K(o,l)}}const Eg=Math.PI/2;function Tv(n){return Math.tan((Eg+n)/2)}class VC extends Vf{constructor(e){super(e),this.center=e.center||[0,30];const[i,o]=this.parallels=e.parallels||[30,30];let l=V(i),d=V(o);this.southernCenter=l+d<0,this.southernCenter&&(l=-l,d=-d);const f=Math.cos(l),y=Tv(l);this.n=l===d?Math.sin(l):Math.log(f/Math.cos(d))/Math.log(Tv(d)/y),this.f=f*Math.pow(Tv(l),this.n)/this.n}project(e,i){i=V(i),this.southernCenter&&(i=-i),e=V(e-this.center[0]);const o=1e-6,{n:l,f:d}=this;d>0?i<-Eg+o&&(i=-Eg+o):i>Eg-o&&(i=Eg-o);const f=d/Math.pow(Tv(i),l);let y=f*Math.sin(l*e),x=d-f*Math.cos(l*e);return y=.5*(y/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:y,y:this.southernCenter?x:1-x,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:o,f:l}=this,d=l-i,f=Math.sign(d),y=Math.sign(o)*Math.sqrt(e*e+d*d);let x=Math.atan2(e,Math.abs(d))*f;d*o<0&&(x-=Math.PI*Math.sign(e)*f);const T=Me(W(x/o)+this.center[0],-180,180),M=Me(W(2*Math.atan(Math.pow(l/y,1/o))-Eg),-85.051129,Ze);return new K(T,this.southernCenter?-M:M)}}class bw extends Vf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Se(e),y:Te(i),z:0}}unproject(e,i){const o=Ce(e),l=Le(i);return new K(o,l)}}const ww=V(Ze);class GC extends Vf{project(e,i){const o=(i=V(i))*i,l=o*o;return{x:.5*((e=V(e))*(.8707-.131979*o+l*(l*(.003971*o-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+l*(.028874*o-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,l=25,d=0,f=o*o;do{f=o*o;const T=f*f;d=(o*(1.007226+f*(.015085+T*(.028874*f-.044475-.005916*T)))-i)/(1.007226+f*(.045255+T*(.259866*f-.311325-.005916*11*T))),o=Me(o-d,-ww,ww)}while(Math.abs(d)>1e-6&&--l>0);f=o*o;const y=Me(W(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),x=W(o);return new K(y,x)}}const Tw=V(Ze);class HC extends Vf{project(e,i){i=V(i),e=V(e);const o=Math.cos(i),l=2/Math.PI,d=Math.acos(o*Math.cos(e/2)),f=Math.sin(d)/d,y=.5*(e*l+2*o*Math.sin(e/2)/f)||0,x=.5*(i+Math.sin(i)/f)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,i){let o=e=(2*e-.5)*Math.PI,l=i=(2*(1-i)-1)*Math.PI,d=25;const f=1e-6;let y=0,x=0;do{const T=Math.cos(l),M=Math.sin(l),R=2*M*T,D=M*M,B=T*T,F=Math.cos(o/2),q=Math.sin(o/2),J=2*F*q,te=q*q,he=1-B*F*F,ce=he?1/he:0,X=he?Math.acos(T*F)*Math.sqrt(1/he):0,re=.5*(2*X*T*q+2*o/Math.PI)-e,ue=.5*(X*M+l)-i,_e=.5*ce*(B*te+X*T*F*D)+1/Math.PI,ze=ce*(J*R/4-X*M*q),Ne=.125*ce*(R*q-X*M*B*J),Ue=.5*ce*(D*F+X*te*T)+.5,qe=ze*Ne-Ue*_e;y=(ue*ze-re*Ue)/qe,x=(re*Ne-ue*_e)/qe,o=Me(o-y,-Math.PI,Math.PI),l=Me(l-x,-Tw,Tw)}while((Math.abs(y)>f||Math.abs(x)>f)&&--d>0);return new K(W(o),W(l))}}class Sw extends Vf{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(V(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:o,cosPhi:l}=this;return{x:V(e)*l*o+.5,y:-Math.sin(V(i))/l*o+.5,z:0}}unproject(e,i){const{scale:o,cosPhi:l}=this,d=-(i-.5)/o,f=Me(W((e-.5)/o)/l,-180,180),y=Math.asin(Me(d*l,-1,1)),x=Me(W(y),-85.051129,Ze);return new K(f,x)}}class qC extends bw{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,o){const l=Cf(e,i,o);return Vi(l,l,zd(Nl(o))),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,i,o){const l=Q(i.lat,i.lng),d=Ci([],l),f=o?e._centerAltitude+o:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;zt(l,l,d,ge(1,0)*Ut*f);const y=be(new Float64Array(16));return Oe(y,e.pixelMatrix,e.globeMatrix),Vi(l,l,y),new Bt(l[0],l[1])}pixelsPerMeter(e,i){return ge(1,0)*i}pixelSpaceConversion(e,i,o){const l=ge(1,e)*i,d=Ti(ge(1,45)*i,l,o);return this.pixelsPerMeter(e,i)/d}createTileMatrix(e,i,o){const l=Zm(Nl(o.canonical));return Oe(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,i){const{center:o}=e,l=zd(Nl(i));return ut(l,l,V(o.lng)),at(l,l,V(o.lat)),je(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,i,o,l){return Id(e,i,o,!0)||new et(0,0)}pointCoordinate3D(e,i,o){const l=this.pointCoordinate(e,i,o,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,i){return!Id(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(l,d){const f=l.cameraToCenterDistance,y=l._centerAltitude*d,x=l._camera,T=l._camera.forward(),M=yi([],Fe([],T,-f),[0,0,y]),R=l.worldSize/(2*Math.PI),D=[0,0,-R],B=l.width/l.height,F=Math.tan(l.fovAboveCenter),q=Fe([],x.up(),F),J=Fe([],x.right(),F*B),te=Ci([],yi([],yi([],T,q),J)),he=[];let ce;if(new Jo(M,te).closestPointOnSphere(D,R,he)){const X=yi([],he,D),re=Rn([],X,M);ce=Math.cos(l.fovAboveCenter)*Ei(re)}else{const X=Rn([],M,D),re=Rn([],D,M);Ci(re,re);const ue=Ei(X)-R;ce=Math.sqrt(ue*(ue+2*R));const _e=Math.acos(ce/(R+ue))-Math.acos(pi(T,re));ce*=Math.cos(_e)}return 1.01*ce}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=xu(e.zoom);if(o>0){const l=vw(e,ge(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ti(i,l+d*(1-Math.cos(f)),Math.pow(o,10))}return i}upVector(e,i,o){return Cf(i,o,e,1)}upVectorScale(e){return{metersToTile:kl(Xp(Nl(e)))}}}function Ew(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new bw(n);case"equirectangular":return new UC(n);case"naturalEarth":return new GC(n);case"equalEarth":return new jC(n);case"winkelTripel":return new HC(n);case"albers":return i?new Sw(n):new FC(n);case"lambertConformalConic":return i?new Sw(n):new VC(n);case"globe":return new qC(n)}throw new Error(`Invalid projection name: ${n.name}`)}const $C=Ec.VectorTileFeature.types,ZC=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Sv(n,e,i,o,l,d,f,y,x,T,M,R,D){const B=y?Math.min(Uf,Math.round(y[0])):0,F=y?Math.min(Uf,Math.round(y[1])):0;n.emplaceBack(e,i,Math.round(32*o),Math.round(32*l),d,f,(B<<1)+(x?1:0),F,16*T,16*M,256*R,256*D)}function Ev(n,e,i){n.emplaceBack(e,i)}function Av(n,e,i,o,l,d,f){n.emplaceBack(e,i,o,l,d,f)}function Mv(n,e,i,o,l){n.emplaceBack(e,i,o,l),n.emplaceBack(e,i,o,l),n.emplaceBack(e,i,o,l),n.emplaceBack(e,i,o,l)}function XC(n){for(const e of n.sections)if(Rl(e.text))return!0;return!1}class xx{constructor(e){this.layoutVertexArray=new zl,this.indexArray=new Pr,this.programConfigurations=e,this.segments=new vr,this.dynamicLayoutVertexArray=new Hs,this.opacityVertexArray=new _c,this.placedSymbolArray=new kp,this.iconTransitioningVertexArray=new Pl,this.globeExtVertexArray=new Xa,this.zOffsetVertexArray=new fu}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,o,l,d){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,uC.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ZC,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,dC.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,cC.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,hC.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Wt(xx,"SymbolBuffers");class bx{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new vr,this.collisionVertexArray=new Ef,this.collisionVertexArrayExt=new Hs}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,fC.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,pC.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Wt(bx,"CollisionBuffers");class Cv{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=be([]),this.placementViewportMatrix=be([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ew(this.zoom,i["text-size"]),this.iconSizeData=ew(this.zoom,i["icon-size"]);const o=this.layers[0].layout,l=o.get("symbol-sort-key"),d=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(f=>Xs[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new xx(new Tc(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new xx(new Tc(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new ga,this.lineVertexArray=new Ma,this.symbolInstances=new Np}calculateGlyphDependencies(e,i,o,l,d){for(const f of e){const y=f.codePointAt(0);if(y===void 0)break;if(i[y]=!0,l&&d&&y<=65535){const x=F_[f];x&&(i[x.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!kf(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}populate(e,i,o,l){const d=this.layers[0],f=d.layout,y=this.projection.name==="globe",x=f.get("text-font"),T=f.get("text-field"),M=f.get("icon-image"),[R,D]=f.get("icon-size-scale-range"),B=Me(i.scaleFactor||1,R,D),F=(T.value.kind!=="constant"||T.value.value instanceof La&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),q=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,J=f.get("symbol-sort-key");if(this.features=[],!F&&!q)return;const te=i.iconDependencies,he=i.glyphDependencies,ce=i.availableImages,X=new Fn(this.zoom);for(const{feature:re,id:ue,index:_e,sourceLayerIndex:ze}of e){const Ne=d._featureFilter.needGeometry,Ue=ai(re,Ne);if(!d._featureFilter.filter(X,Ue,o))continue;if(Ne||(Ue.geometry=Qt(re,o,l)),y&&re.type!==1&&o.z<=5){const xt=Ue.geometry,Rt=.98078528056,nt=(yt,it)=>pi(Cf(yt.x,yt.y,o,1),Cf(it.x,it.y,o,1))<Rt;for(let yt=0;yt<xt.length;yt++)xt[yt]=bt(xt[yt],nt)}let qe,ot;if(F){const xt=d.getValueAndResolveTokens("text-field",Ue,o,ce),Rt=La.factory(xt);XC(Rt)&&(this.hasRTLText=!0),(!this.hasRTLText||dc()==="unavailable"||this.hasRTLText&&fs.isParsed())&&(qe=gC(Rt,d,Ue))}if(q){const xt=d.getValueAndResolveTokens("icon-image",Ue,o,ce);ot=typeof xt=="string"?qa.build(xt):xt}if(!qe&&!ot)continue;const St=this.sortFeaturesByKey?J.evaluate(Ue,{},o):void 0,gt={id:ue,text:qe,icon:ot,index:_e,sourceLayerIndex:ze,geometry:Ue.geometry,properties:re.properties,type:$C[re.type],sortKey:St};if(this.features.push(gt),ot){const xt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Rt,iconSecondary:nt}=mw(ot,this.iconSizeData,xt["icon-size"],o,this.zoom,gt,this.pixelRatio,B),yt=Rt.id.toString();if(te.has(yt)?te.get(yt).push(Rt):te.set(yt,[Rt]),nt){const it=nt.id.toString();te.has(it)?te.get(it).push(nt):te.set(it,[nt])}}if(qe){const xt=x.evaluate(Ue,{},o).join(","),Rt=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Xs.vertical)>=0;for(const nt of qe.sections)if(nt.image){const yt=nt.image.getPrimary().scaleSelf(this.pixelRatio),it=yt.id.toString(),rt=te.get(it)||[];rt.push(yt),te.set(it,rt)}else{const yt=hd(qe.toString()),it=nt.fontStack||xt,rt=he[it]=he[it]||{};this.calculateGlyphDependencies(nt.text,rt,Rt,this.allowVerticalPlacement,yt)}}}if(f.get("symbol-placement")==="line"&&(this.features=function(re){const ue={},_e={},ze=[];let Ne=0;function Ue(gt){ze.push(re[gt]),Ne++}function qe(gt,xt,Rt){const nt=_e[gt];return delete _e[gt],_e[xt]=nt,ze[nt].geometry[0].pop(),ze[nt].geometry[0]=ze[nt].geometry[0].concat(Rt[0]),nt}function ot(gt,xt,Rt){const nt=ue[xt];return delete ue[xt],ue[gt]=nt,ze[nt].geometry[0].shift(),ze[nt].geometry[0]=Rt[0].concat(ze[nt].geometry[0]),nt}function St(gt,xt,Rt){const nt=Rt?xt[0][xt[0].length-1]:xt[0][0];return`${gt}:${nt.x}:${nt.y}`}for(let gt=0;gt<re.length;gt++){const xt=re[gt],Rt=xt.geometry,nt=xt.text?xt.text.toString():null;if(!nt){Ue(gt);continue}const yt=St(nt,Rt),it=St(nt,Rt,!0);if(yt in _e&&it in ue&&_e[yt]!==ue[it]){const rt=ot(yt,it,Rt),Dt=qe(yt,it,ze[rt].geometry);delete ue[yt],delete _e[it],_e[St(nt,ze[Dt].geometry,!0)]=Dt,ze[rt].geometry=null}else yt in _e?qe(yt,it,Rt):it in ue?ot(yt,it,Rt):(Ue(gt),ue[yt]=Ne-1,_e[it]=Ne-1)}return ze.filter(gt=>gt.geometry)}(this.features)),f.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const re of i.elevationFeatures)this.elevationFeatureIdToIndex.set(re.id,this.elevationFeatures.length),this.elevationFeatures.push(re)}}else f.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((re,ue)=>re.sortKey-ue.sortKey)}update(e,i,o,l,d,f,y){this.text.programConfigurations.updatePaintArrays(e,i,d,o,l,f,y),this.icon.programConfigurations.updatePaintArrays(e,i,d,o,l,f,y)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let e=!1;for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);if(o.elevationFeatureIndex===65535)continue;const l=this.elevationFeatures[o.elevationFeatureIndex];if(l){const d=.05+l.pointElevation(new Bt(o.tileAnchorX,o.tileAnchorY));o.zOffset!==d&&(e=!0,o.zOffset=d)}}e&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(d,f,y)=>{o+=f,o>d.length&&d.resize(o);for(let x=-f;x<0;x++)d.emplace(x+o,y)},i=(d,f,y)=>{l+=f,l>d.length&&d.resize(l);for(let x=-f;x<0;x++)d.emplace(x+l,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,l=0;for(let d=0;d<this.symbolInstances.length;d++){const f=this.symbolInstances.get(d),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:x,numIconVertices:T}=f,M=f.zOffset,R=T>0;if((y>0||x>0)&&(e(this.text.zOffsetVertexArray,y,M),e(this.text.zOffsetVertexArray,x,M)),R){const{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:B}=f;D>=0&&i(this.icon.zOffsetVertexArray,T,M),B>=0&&i(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Ew(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:l,y:d}of i)this.lineVertexArray.emplaceBack(l,d);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,l,d,f,y,x,T,M,R,D,B,F,q,J){const te=e.indexArray,he=e.layoutVertexArray,ce=e.globeExtVertexArray,X=e.segments.prepareSegment(4*i.length,he,te,this.canOverlap?f.sortKey:void 0),re=this.glyphOffsetArray.length,ue=X.vertexLength,_e=this.allowVerticalPlacement&&y===Xs.vertical?Math.PI/2:0,ze=f.text&&f.text.sections;for(let Ue=0;Ue<i.length;Ue++){const{tl:qe,tr:ot,bl:St,br:gt,texPrimary:xt,texSecondary:Rt,pixelOffsetTL:nt,pixelOffsetBR:yt,minFontScaleX:it,minFontScaleY:rt,glyphOffset:Dt,isSDF:Ot,sectionIndex:hi}=i[Ue],ti=X.vertexLength,Gt=Dt[1];if(Sv(he,T.x,T.y,qe.x,Gt+qe.y,xt.x,xt.y,o,Ot,nt.x,nt.y,it,rt),Sv(he,T.x,T.y,ot.x,Gt+ot.y,xt.x+xt.w,xt.y,o,Ot,yt.x,nt.y,it,rt),Sv(he,T.x,T.y,St.x,Gt+St.y,xt.x,xt.y+xt.h,o,Ot,nt.x,yt.y,it,rt),Sv(he,T.x,T.y,gt.x,Gt+gt.y,xt.x+xt.w,xt.y+xt.h,o,Ot,yt.x,yt.y,it,rt),x){const{x:It,y:ji,z:si}=x.anchor,[li,Oi,qi]=x.up;Av(ce,It,ji,si,li,Oi,qi),Av(ce,It,ji,si,li,Oi,qi),Av(ce,It,ji,si,li,Oi,qi),Av(ce,It,ji,si,li,Oi,qi),Mv(e.dynamicLayoutVertexArray,It,ji,si,_e)}else Mv(e.dynamicLayoutVertexArray,T.x,T.y,T.z,_e);if(J){const It=Rt||xt;Ev(e.iconTransitioningVertexArray,It.x,It.y),Ev(e.iconTransitioningVertexArray,It.x+It.w,It.y),Ev(e.iconTransitioningVertexArray,It.x,It.y+It.h),Ev(e.iconTransitioningVertexArray,It.x+It.w,It.y+It.h)}te.emplaceBack(ti,ti+1,ti+2),te.emplaceBack(ti+1,ti+2,ti+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Dt[0]),Ue!==i.length-1&&hi===i[Ue+1].sectionIndex||e.programConfigurations.populatePaintArrays(he.length,f,f.index,{},B,F,q,ze&&ze[hi])}const Ne=x?x.anchor:T;e.placedSymbolArray.emplaceBack(Ne.x,Ne.y,Ne.z,T.x,T.y,re,this.glyphOffsetArray.length-re,ue,M,R,T.segment,o?o[0]:0,o?o[1]:0,l[0],l[1],y,0,0,0,D,0)}_commitLayoutVertex(e,i,o,l,d,f,y){e.emplaceBack(i,o,l,d,f,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,i,o,l,d,f,y){const x=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),T=x.vertexLength,M=y.tileAnchorX,R=y.tileAnchorY;for(let B=0;B<4;B++)o.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,e.padding,y.zOffset),this._commitLayoutVertex(o.layoutVertexArray,l,d,f,M,R,new Bt(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,l,d,f,M,R,new Bt(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,l,d,f,M,R,new Bt(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,l,d,f,M,R,new Bt(e.x1,e.y2)),x.vertexLength+=4;const D=o.indexArray;D.emplaceBack(T,T+1),D.emplaceBack(T+1,T+2),D.emplaceBack(T+2,T+3),D.emplaceBack(T+3,T),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,l,d,f){for(let y=l;y<d;y++){const x=o.get(y),T=this.getSymbolInstanceTextSize(e,f,i,y);this._addCollisionDebugVertices(x,T,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,i,o,l,d,f){for(let y=l;y<d;y++){const x=o.get(y),T=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._addCollisionDebugVertices(x,T,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,i,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new bx(Yo,j1.members,Pl),this.iconCollisionBox=new bx(Yo,j1.members,Pl);const l=U_(this.iconSizeData,e),d=U_(this.textSizeData,e,o);for(let f=0;f<this.symbolInstances.length;f++){const y=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(d,e,i,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(d,e,i,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(l,e,i,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(l,e,i,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,i,o,l){const d=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:l),f=fx(this.textSizeData,e,d)/Ia;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,i,o){const l=this.icon.placedSymbolArray.get(o),d=fx(this.iconSizeData,e,l);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,i,o,l){e.emplaceBack(i,-o,-o,l),e.emplaceBack(i,o,-o,l),e.emplaceBack(i,o,o,l),e.emplaceBack(i,-o,o,l)}_updateTextDebugCollisionBoxes(e,i,o,l,d,f,y){for(let x=l;x<d;x++){const T=o.get(x),M=this.getSymbolInstanceTextSize(e,f,i,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,T.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,i,o,l,d,f,y){for(let x=l;x<d;x++){const T=o.get(x),M=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,T.padding,f.zOffset)}}updateCollisionDebugBuffers(e,i,o,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=U_(this.iconSizeData,e,l),f=U_(this.textSizeData,e,o);for(let y=0;y<this.symbolInstances.length;y++){const x=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(f,e,i,x.textBoxStartIndex,x.textBoxEndIndex,x,o),this._updateTextDebugCollisionBoxes(f,e,i,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x,o),this._updateIconDebugCollisionBoxes(d,e,i,x.iconBoxStartIndex,x.iconBoxEndIndex,x,l),this._updateIconDebugCollisionBoxes(d,e,i,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x,l)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,l,d,f,y,x,T){const M={};if(i<o){const{x1:R,y1:D,x2:B,y2:F,padding:q,projectedAnchorX:J,projectedAnchorY:te,projectedAnchorZ:he,tileAnchorX:ce,tileAnchorY:X,featureIndex:re}=e.get(i);M.textBox={x1:R,y1:D,x2:B,y2:F,padding:q,projectedAnchorX:J,projectedAnchorY:te,projectedAnchorZ:he,tileAnchorX:ce,tileAnchorY:X},M.textFeatureIndex=re}if(l<d){const{x1:R,y1:D,x2:B,y2:F,padding:q,projectedAnchorX:J,projectedAnchorY:te,projectedAnchorZ:he,tileAnchorX:ce,tileAnchorY:X,featureIndex:re}=e.get(l);M.verticalTextBox={x1:R,y1:D,x2:B,y2:F,padding:q,projectedAnchorX:J,projectedAnchorY:te,projectedAnchorZ:he,tileAnchorX:ce,tileAnchorY:X},M.verticalTextFeatureIndex=re}if(f<y){const{x1:R,y1:D,x2:B,y2:F,padding:q,projectedAnchorX:J,projectedAnchorY:te,projectedAnchorZ:he,tileAnchorX:ce,tileAnchorY:X,featureIndex:re}=e.get(f);M.iconBox={x1:R,y1:D,x2:B,y2:F,padding:q,projectedAnchorX:J,projectedAnchorY:te,projectedAnchorZ:he,tileAnchorX:ce,tileAnchorY:X},M.iconFeatureIndex=re}if(x<T){const{x1:R,y1:D,x2:B,y2:F,padding:q,projectedAnchorX:J,projectedAnchorY:te,projectedAnchorZ:he,tileAnchorX:ce,tileAnchorY:X,featureIndex:re}=e.get(x);M.verticalIconBox={x1:R,y1:D,x2:B,y2:F,padding:q,projectedAnchorX:J,projectedAnchorY:te,projectedAnchorZ:he,tileAnchorX:ce,tileAnchorY:X},M.verticalIconFeatureIndex=re}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),l=o.vertexStartIndex+4*o.numGlyphs;for(let d=o.vertexStartIndex;d<l;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),l=[],d=[],f=[];for(let y=0;y<this.symbolInstances.length;++y){f.push(y);const x=this.symbolInstances.get(y);l.push(0|Math.round(i*x.tileAnchorX+o*x.tileAnchorY)),d.push(x.featureIndex)}return f.sort((y,x)=>l[y]-l[x]||d[x]-d[y]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);const{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:T}=o;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),d>=0&&d!==l&&this.addIndicesForPlacedSymbol(this.text,d),f>=0&&f!==d&&f!==l&&this.addIndicesForPlacedSymbol(this.text,f),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Aw,Mw,wx;Wt(Cv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Cv.addDynamicAttributes=Mv;class Cw{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Kl,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Wt(Cw,"FormatSectionOverride",{omit:["defaultValue"]});const Tx=()=>wx||(wx={layout:Aw||(Aw=new wr({"symbol-placement":new Nt(We.layout_symbol["symbol-placement"]),"symbol-spacing":new Nt(We.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Nt(We.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Xt(We.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Nt(We.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Nt(We.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Nt(We.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Nt(We.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Nt(We.layout_symbol["icon-ignore-placement"]),"icon-optional":new Nt(We.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Nt(We.layout_symbol["icon-rotation-alignment"]),"icon-size":new Xt(We.layout_symbol["icon-size"]),"icon-size-scale-range":new Nt(We.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Xt(We.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xt(We.layout_symbol["icon-text-fit-padding"]),"icon-image":new Xt(We.layout_symbol["icon-image"]),"icon-rotate":new Xt(We.layout_symbol["icon-rotate"]),"icon-padding":new Nt(We.layout_symbol["icon-padding"]),"icon-keep-upright":new Nt(We.layout_symbol["icon-keep-upright"]),"icon-offset":new Xt(We.layout_symbol["icon-offset"]),"icon-anchor":new Xt(We.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Nt(We.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Nt(We.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Nt(We.layout_symbol["text-rotation-alignment"]),"text-field":new Xt(We.layout_symbol["text-field"]),"text-font":new Xt(We.layout_symbol["text-font"]),"text-size":new Xt(We.layout_symbol["text-size"]),"text-size-scale-range":new Nt(We.layout_symbol["text-size-scale-range"]),"text-max-width":new Xt(We.layout_symbol["text-max-width"]),"text-line-height":new Xt(We.layout_symbol["text-line-height"]),"text-letter-spacing":new Xt(We.layout_symbol["text-letter-spacing"]),"text-justify":new Xt(We.layout_symbol["text-justify"]),"text-radial-offset":new Xt(We.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Nt(We.layout_symbol["text-variable-anchor"]),"text-anchor":new Xt(We.layout_symbol["text-anchor"]),"text-max-angle":new Nt(We.layout_symbol["text-max-angle"]),"text-writing-mode":new Nt(We.layout_symbol["text-writing-mode"]),"text-rotate":new Xt(We.layout_symbol["text-rotate"]),"text-padding":new Nt(We.layout_symbol["text-padding"]),"text-keep-upright":new Nt(We.layout_symbol["text-keep-upright"]),"text-transform":new Xt(We.layout_symbol["text-transform"]),"text-offset":new Xt(We.layout_symbol["text-offset"]),"text-allow-overlap":new Nt(We.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Nt(We.layout_symbol["text-ignore-placement"]),"text-optional":new Nt(We.layout_symbol["text-optional"]),visibility:new Nt(We.layout_symbol.visibility)})),paint:Mw||(Mw=new wr({"icon-opacity":new Xt(We.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Xt(We.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Xt(We.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Xt(We.paint_symbol["text-emissive-strength"]),"icon-color":new Xt(We.paint_symbol["icon-color"]),"icon-halo-color":new Xt(We.paint_symbol["icon-halo-color"]),"icon-halo-width":new Xt(We.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Xt(We.paint_symbol["icon-halo-blur"]),"icon-translate":new Nt(We.paint_symbol["icon-translate"]),"icon-translate-anchor":new Nt(We.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Nt(We.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Xt(We.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Xt(We.paint_symbol["text-occlusion-opacity"]),"text-color":new Xt(We.paint_symbol["text-color"],{runtimeType:ao,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Xt(We.paint_symbol["text-halo-color"]),"text-halo-width":new Xt(We.paint_symbol["text-halo-width"]),"text-halo-blur":new Xt(We.paint_symbol["text-halo-blur"]),"text-translate":new Nt(We.paint_symbol["text-translate"]),"text-translate-anchor":new Nt(We.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Nt(We.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Nt(We.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Nt(We.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Nt(We.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Xt(We.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},wx);class Rv extends ka{constructor(e,i,o,l){super(e,Tx(),i,o,l),this._colorAdjustmentMatrix=be([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const l=[];for(const d of o)l.indexOf(d)<0&&l.push(d);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,o,l){return this._saturation===e&&this._contrast===i&&this._brightnessMin===o&&this._brightnessMax===l||(this._colorAdjustmentMatrix=function(d,f,y,x){d=aa(d),f=Nr(f);const T=Ie(),M=d/3,R=1-2*M,D=[R,M,M,0,M,R,M,0,M,M,R,0,0,0,0,1],B=.5-.5*f,F=x-y;return Oe(T,[F,0,0,0,0,F,0,0,0,0,F,0,y,y,y,1],[f,0,0,0,0,f,0,0,0,0,f,0,B,B,B,1]),Oe(T,T,D),T}(e,i,o,l),this._saturation=e,this._contrast=i,this._brightnessMin=o,this._brightnessMax=l),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,o,l){const d=this.layout.get(e).evaluate(i,{},o,l),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Us(f.value)||!d?d:function(y,x){return x.replace(/{([^{}]+)}/g,(T,M)=>M in y?String(y[M]):"")}(i.properties,d)}createBucket(e){return new Cv(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Tx().paint.overridableProperties){if(!Rv.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new Cw(i),l=new ud(o,i.property.specification,this.scope,this.options);let d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new yr("source",l):new Yr("composite",l,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new lu(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&Rv.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),l=Tx().paint.properties[i];let d=!1;const f=y=>{for(const x of y)if(l.overrides&&l.overrides.hasOverride(x))return void(d=!0)};if(o.value.kind==="constant"&&o.value.value instanceof La)f(o.value.value.sections);else if(o.value.kind==="source"){const y=T=>{d||(T instanceof Zi&&Br(T.value)===Gh?f(T.value.sections):T instanceof Ds?f(T.sections):T.eachChild(y))},x=o.value;x._styleExpression&&y(x._styleExpression.expression)}return d}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,o){return{config:new Ol(this,{zoom:i,lut:o}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Rw,Iw,Dw,zw;var Sx=bn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Ex(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Ax(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Mx{constructor(e,i,o,l){this.context=e,this.format=o,this.useMipmap=l&&l.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:l&&l.premultiply})}update(e,i){const o=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,l=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:d}=this,{gl:f}=d,{x:y,y:x}=i&&i.position?i.position:{x:0,y:0},T=y+o,M=x+l;!this.size||this.size[0]===T&&this.size[1]===M||(f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(this.texture),this.texture=f.createTexture(),this.size=null),f.bindTexture(f.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA8&&(!i||i.premultiply!==!1));const R=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&T>0&&M>0){const D=this.useMipmap?Math.floor(Math.log2(Math.max(T,M)))+1:1;f.texStorage2D(f.TEXTURE_2D,D,this.format,T,M),this.size=[T,M]}if(this.size)if(R)f.texSubImage2D(f.TEXTURE_2D,0,y,x,Ex(this.format),Ax(this.format),e);else{const D=e.data;D&&f.texSubImage2D(f.TEXTURE_2D,0,y,x,o,l,Ex(this.format),Ax(this.format),D)}this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,i,o=!1){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,o,l){const{context:d}=this,{gl:f}=d;f.bindTexture(f.TEXTURE_2D,this.texture),i!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),this.wrapS=o),l!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,l),this.wrapT=l)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Iv{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:o}=this,{gl:l}=o;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,i),this.wrapS=i)}}function Dv(n,e,i,o,l,d,f,y){const x=[n,e,1,i,o,1,l,d,1],T=[f,y,1],M=fe([],x),[R,D,B]=rn(T,T,M);return Re(x,x,[R,0,0,0,D,0,0,0,B])}function Pw(n,e,i,o,l,d,f,y){const x=function(T,M,R,D,B,F,q,J){const te=Dv(0,0,1,0,1,1,0,1),he=Dv(T,M,R,D,B,F,q,J);return Re(he,he,fe([],te))}(n,e,i,o,l,d,f,y);return[x[2]/x[8]/Ut,x[5]/x[8]/Ut]}function zv(n){return[n[0],Math.min(Math.max(n[1],-85.051129),Ze)]}class Lw extends Yl{constructor(e,i,o,l){super(),this.id=e,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(l),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new tl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Oc(this.map._requestManager.transformRequest(this.url,Gu.Image),(o,l)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new jh(o)):l&&(this.image=l instanceof HTMLImageElement?Ho.getImageData(l):l,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Iv(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new tl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Iv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],o=e[0][1];for(const d of e)d[1]>o&&(o=d[1]),d[1]<i&&(i=d[1]);const l=(o+i)/2;if(l>Ze?this.onNorthPole=!0:l<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const d=e.map(et.fromLngLat);this.tileID=function(f){let y=1/0,x=1/0,T=-1/0,M=-1/0;for(const q of f)y=Math.min(y,q.x),x=Math.min(x,q.y),T=Math.max(T,q.x),M=Math.max(M,q.y);const R=Math.max(T-y,M-x),D=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),B=Math.pow(2,D);let F=Math.floor((y+T)/2*B);return F>1&&(F-=1),new Zn(D,F,Math.floor((x+M)/2*B))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new tl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const te in this.tiles){const he=this.tiles[te];he.state!=="loaded"&&(he.state="loaded",he.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=H_(new Zn(0,0,0),this.map.transform.projection),o=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(te){const he=te[1].x-te[0].x,ce=te[1].y-te[0].y,X=te[2].x-te[1].x,re=te[2].y-te[1].y,ue=te[3].x-te[2].x,_e=te[3].y-te[2].y,ze=te[0].x-te[3].x,Ne=te[0].y-te[3].y,Ue=he*re-X*ce,qe=X*_e-ue*re,ot=ue*Ne-ze*_e,St=ze*ce-he*Ne;return Ue>0&&qe>0&&ot>0&&St>0||Ue<0&&qe<0&&ot<0&&St<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const l=H_(this.tileID,this.map.transform.projection),[d,f,y,x]=this.coordinates.map(te=>{const he=l.projection.project(te[0],te[1]);return xw(l,he)._round()});this.perspectiveTransform=Pw(d.x,d.y,f.x,f.y,y.x,y.y,x.x,x.y);const T=this._boundsArray=new gc;T.emplaceBack(d.x,d.y,0,0),T.emplaceBack(f.x,f.y,Ut,0),T.emplaceBack(x.x,x.y,0,Ut),T.emplaceBack(y.x,y.y,Ut,Ut),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(T,Sx.members),this.boundsSegments=vr.simpleSegment(0,0,4,2);const M=[],R=[zv((D=this.coordinates)[0]),zv(D[1]),zv(D[2]),zv(D[3])];var D;const[B,F,q,J]=function(te){let he=te[0][0],ce=he,X=te[0][1],re=X;for(let ue=1;ue<te.length;ue++)te[ue][0]<he?he=te[ue][0]:te[ue][0]>ce&&(ce=te[ue][0]),te[ue][1]<X?X=te[ue][1]:te[ue][1]>re&&(re=te[ue][1]);return[he,X,ce-he,re-X]}(R);{const te=new gc,[he,ce,X,re]=function(nt){let yt=nt[0].x,it=yt,rt=nt[0].y,Dt=rt;for(let Ot=1;Ot<nt.length;Ot++)nt[Ot].x<yt?yt=nt[Ot].x:nt[Ot].x>it&&(it=nt[Ot].x),nt[Ot].y<rt?rt=nt[Ot].y:nt[Ot].y>Dt&&(Dt=nt[Ot].y);return[yt,rt,it-yt,Dt-rt]}(o),ue=nt=>[(nt.x-he)/X,(nt.y-ce)/re],[_e,ze,Ne,Ue]=o.map(ue),qe=function(nt,yt,it,rt,Dt,Ot,hi,ti){const Gt=Dv(0,0,1,0,1,1,0,1);return Re(Gt,Gt,fe([],Dv(nt,yt,it,rt,Dt,Ot,hi,ti)))}(_e[0],_e[1],ze[0],ze[1],Ne[0],Ne[1],Ue[0],Ue[1]);this.elevatedGlobePerspectiveTransform=Pw(_e[0],_e[1],ze[0],ze[1],Ne[0],Ne[1],Ue[0],Ue[1]);const ot=(nt,yt)=>{M.push(nt.lng);const it=Math.round((nt.lng-B)/q*Ut),rt=Math.round((nt.lat-F)/J*Ut),Dt=ue(yt),Ot=rn([],[Dt[0],Dt[1],1],qe),hi=Math.round(Ot[0]/Ot[2]*Ut),ti=Math.round(Ot[1]/Ot[2]*Ut);te.emplaceBack(it,rt,hi,ti)},St=o[3].x-o[0].x,gt=o[3].y-o[0].y,xt=o[2].x-o[1].x,Rt=o[2].y-o[1].y;for(let nt=0;nt<65;nt++){const yt=nt/64,it=[o[0].x+yt*St,o[0].y+yt*gt],rt=[o[1].x+yt*xt,o[1].y+yt*Rt],Dt=rt[0]-it[0],Ot=rt[1]-it[1];for(let hi=0;hi<65;hi++){const ti=hi/64,Gt={x:it[0]+Dt*ti,y:it[1]+Ot*ti};ot(i.projection.unproject(Gt.x,Gt.y),Gt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(te,Sx.members)}{this.maxLongitudeTriangleSize=0;let te=[],he=new Pr;const ce=(X,re,ue)=>{he.emplaceBack(X,re,ue);const _e=M[X],ze=M[re],Ne=M[ue],Ue=Math.min(Math.min(_e,ze),Ne),qe=Math.max(Math.max(_e,ze),Ne)-Ue;qe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=qe),te.push(Ue+qe/2)};for(let X=0;X<64;X++)for(let re=0;re<64;re++){const ue=65*X+re,_e=ue+1,ze=ue+65,Ne=ze+1;ce(ue,ze,_e),ce(_e,ze,Ne)}[te,he]=function(X,re){const ue=Array.from({length:X.length},(Ne,Ue)=>Ue);ue.sort((Ne,Ue)=>X[Ne]-X[Ue]);const _e=[],ze=new Pr;for(let Ne=0;Ne<ue.length;Ne++){const Ue=ue[Ne];_e.push(X[Ue]);const qe=3*Ue,ot=qe+1;ze.emplaceBack(re.uint16[qe],re.uint16[ot],re.uint16[ot+1])}return[_e,ze]}(te,he),this.elevatedGlobeTrianglesCenterLongitudes=te,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(he)}this.elevatedGlobeSegments=vr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,q/Ut,0,J/Ut,0,0,F,B,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof Iv||(this.texture?this.texture.update(this.image):(this.texture=new Mx(i,this.image,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const o=this.elevatedGlobeTrianglesCenterLongitudes;let l=(d=e+180)+360*Math.round((o[0]-d)/360);var d;const f=new vr,y=(R,D)=>{f.segments.push({vertexOffset:0,primitiveOffset:R,vertexLength:i.segments[0].vertexLength,primitiveLength:D,sortKey:void 0,vaos:{}})},x=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-l)<=x){const R=ya(o,0,o.length,l+x);return R===o.length||y(R,gr(o,R+1,o.length,l+360-x)-R),f}l<o[0]&&(l+=360);const T=gr(o,0,o.length,l-x);if(T===o.length)return y(0,o.length),f;y(0,T-0);const M=ya(o,T+1,o.length,l+x);return M!==o.length&&y(M,o.length-M),f}}const WC=(Math.pow(256,2)-1)/16907520;class Ow extends ka{constructor(e,i,o,l){super(e,{layout:Dw||(Dw=new wr({visibility:new Nt(We.layout_raster.visibility)})),paint:zw||(zw=new wr({"raster-opacity":new Nt(We.paint_raster["raster-opacity"]),"raster-color":new ps(We.paint_raster["raster-color"]),"raster-color-mix":new Nt(We.paint_raster["raster-color-mix"]),"raster-color-range":new Nt(We.paint_raster["raster-color-range"]),"raster-hue-rotate":new Nt(We.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Nt(We.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Nt(We.paint_raster["raster-brightness-max"]),"raster-saturation":new Nt(We.paint_raster["raster-saturation"]),"raster-contrast":new Nt(We.paint_raster["raster-contrast"]),"raster-resampling":new Nt(We.paint_raster["raster-resampling"]),"raster-fade-duration":new Nt(We.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Nt(We.paint_raster["raster-emissive-strength"]),"raster-array-band":new Nt(We.paint_raster["raster-array-band"]),"raster-elevation":new Nt(We.paint_raster["raster-elevation"]),"raster-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},i,o,l),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Lw&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[o,l]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(l)||o===this._curRampRange[0]&&l===this._curRampRange[1]||(this.colorRamp=Df({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:l}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,l])}}let kw,Nw,Bw,Fw,jw;class Uw extends ka{constructor(e,i,o,l){super(e,{layout:kw||(kw=new wr({visibility:new Nt(We["layout_raster-particle"].visibility)})),paint:Nw||(Nw=new wr({"raster-particle-array-band":new Nt(We["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Nt(We["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ps(We["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Nt(We["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Nt(We["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Nt(We["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Nt(We["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Nt(We["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},i,o,l),this._updateColorRamp(),this.lastInvalidatedAt=Ho.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Df({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ho.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class YC extends ka{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Cx(n,e,i){const o=[0,0,1],l=Uo([]);return xo(l,l,i?-V(n)+Math.PI:V(n)),Da(l,l,-V(e)),xn(o,o,l),Ci(o,o)}function Vw(n,e){const i=Pv(n.projection,n.zoom,n.width,n.height),o=function(d,f,y,x,T){const M=new K(y.lng-180*Gf,y.lat),R=new K(y.lng+180*Gf,y.lat),D=d.project(M.lng,M.lat),B=d.project(R.lng,R.lat),F=-Math.atan2(B.y-D.y,B.x-D.x),q=et.fromLngLat(y);q.y=Me(q.y,-1+Gf,1-Gf);const J=q.toLngLat(),te=d.project(J.lng,J.lat),he=et.fromLngLat(J);he.x+=Gf;const ce=he.toLngLat(),X=d.project(ce.lng,ce.lat),re=Hw(X.x-te.x,X.y-te.y,F),ue=et.fromLngLat(J);ue.y+=Gf;const _e=ue.toLngLat(),ze=d.project(_e.lng,_e.lat),Ne=Hw(ze.x-te.x,ze.y-te.y,F),Ue=Math.abs(re.x)/Math.abs(Ne.y),qe=be([]);Xe(qe,qe,-F*(1-(T?0:x)));const ot=be([]);return je(ot,ot,[1,1-(1-Ue)*x,1]),ot[4]=-Ne.x/Ne.y*x,Xe(ot,ot,F),Oe(ot,qe,ot),ot}(n.projection,0,n.center,i,e),l=Gw(n);return je(o,o,[l,l,1]),o}function Gw(n){const e=n.projection,i=Pv(n.projection,n.zoom,n.width,n.height),o=Rx(e,n.center),l=Rx(e,K.convert(e.center));return Math.pow(2,o*i+(1-i)*l)}function Pv(n,e,i,o,l=1/0){const d=n.range;if(!d)return 0;const f=Math.min(l,Math.max(i,o)),y=Math.log(f/1024)/Math.LN2;return Pe(d[0]+y,d[1]+y,e)}const Gf=1/4e4;function Rx(n,e){const i=Me(e.lat,-85.051129,Ze),o=new K(e.lng-180*Gf,i),l=new K(e.lng+180*Gf,i),d=n.project(o.lng,i),f=n.project(l.lng,i),y=et.fromLngLat(o),x=et.fromLngLat(l),T=f.x-d.x,M=f.y-d.y,R=x.x-y.x,D=x.y-y.y,B=Math.sqrt((R*R+D*D)/(T*T+M*M));return Math.log(B)/Math.LN2}function Hw(n,e,i){const o=Math.cos(i),l=Math.sin(i);return{x:n*o-e*l,y:n*l+e*o}}function qw(n,e,i){be(n),Xe(n,n,V(e[2])),at(n,n,V(e[0])),ut(n,n,V(e[1])),je(n,n,i),Oe(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Lv(n,e,i,o,l,d,f,y){const x=[i[0]-e[0],i[1]-e[1],0],T=[o[0]-e[0],o[1]-e[1],0];if(Ei(x)<1e-12||Ei(T)<1e-12)return Uo(n);const M=ri([],x,T);Ci(M,M),Je(T,o,e),x[2]=(d-l)*y,T[2]=(f-l)*y;const R=x;return ri(R,x,T),Ci(R,R),Es(n,M,R)}function Ix(n,e,i=!1){const o=xu(e.zoom),l=function(d,f,y){const x=f.worldSize,T=[d[12],d[13],d[14]],M=Le(T[1]/x),R=Ce(T[0]/x),D=be([]),B=ge(1,M)*x,F=ge(1,0)*x*lt(M,f.zoom),q=1/Xm(x);let J=F*q;if(y){const X=Pv(f.projection,f.zoom,f.width,f.height,1024);J=q*f.projection.pixelSpaceConversion(f.center.lat,x,X)}const te=Q(M,R);yi(te,te,Fe([],Ci([],te),B*J*T[2]));const he=function(X){const re=[X[0],X[1],X[2]];let ue=[0,1,0];const _e=ri([],ue,re);return ri(ue,re,_e),Jt(ue)===0&&(ue=[0,1,0],ri(_e,re,ue)),Ci(_e,_e),Ci(ue,ue),Ci(re,re),[_e[0],_e[1],_e[2],0,ue[0],ue[1],ue[2],0,re[0],re[1],re[2],0,X[0],X[1],X[2],1]}(te);je(D,D,[J,J,J*B]),Be(D,D,[-T[0],-T[1],-T[2]]);const ce=Oe([],f.globeMatrix,he);return Oe(ce,ce,D),Oe(ce,ce,d),ce}(n,e,i);if(o>0){const d=function(f,y){const x=y.worldSize,T=ge(1,0)*x*lt(y.center.lat,y.zoom)/Xm(x),M=ge(1,y.center.lat)*x,R=be([]);return ut(R,R,V(y.center.lng)),at(R,R,V(y.center.lat)),Be(R,R,[0,0,g]),je(R,R,[T,T,T*M]),Be(R,R,[y.point.x-.5*x,y.point.y-.5*x,0]),Oe(R,R,f),Oe(R,y.globeMatrix,R)}(n,e);return function(f,y,x){const T=(F,q,J)=>{const te=Ei(F),he=Ei(q),ce=Bl(F,q,J);return Fe(ce,ce,1/Ei(ce)*Ti(te,he,J))},M=T([f[0],f[1],f[2]],[y[0],y[1],y[2]],x),R=T([f[4],f[5],f[6]],[y[4],y[5],y[6]],x),D=T([f[8],f[9],f[10]],[y[8],y[9],y[10]],x),B=Bl([f[12],f[13],f[14]],[y[12],y[13],y[14]],x);return[M[0],M[1],M[2],0,R[0],R[1],R[2],0,D[0],D[1],D[2],0,B[0],B[1],B[2],1]}(l,d,o)}return l}function $w(n,e,i,o){const l=Un.projectAabbCorners(o,i);let d=Number.MAX_VALUE,f=-1;for(let T=0;T<l.length;++T){const M=l[T];M[0]=(.5*M[0]+.5)*e.width,M[1]=(.5-.5*M[1])*e.height,M[2]<d&&(f=T,d=M[2])}const y=T=>new Bt(l[T][0],l[T][1]);let x;switch(f){case 0:case 6:x=[y(1),y(5),y(4),y(7),y(3),y(2),y(1)];break;case 1:case 7:x=[y(0),y(4),y(5),y(6),y(2),y(3),y(0)];break;case 3:case 5:x=[y(1),y(0),y(4),y(7),y(6),y(2),y(1)];break;default:x=[y(1),y(5),y(6),y(7),y(3),y(0),y(1)]}if(Mi(n,x))return d}const KC=bn([{name:"a_pos_3f",components:3,type:"Float32"}]),QC=bn([{name:"a_color_3f",components:3,type:"Float32"}]),JC=bn([{name:"a_color_4f",components:4,type:"Float32"}]),eR=bn([{name:"a_uv_2f",components:2,type:"Float32"}]),tR=bn([{name:"a_normal_3f",components:3,type:"Float32"}]),iR=bn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),nR=bn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),Zw={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class Ov{constructor(e,i,o,l){this.message=(e?`${e}: `:"")+o,l&&(this.identifier=l),i!=null&&i.__line__&&(this.line=i.__line__)}}function Dx(n,e){const i=n.indexOf("://")===-1;try{return new URL(n,i&&e?"http://example.com":void 0),!0}catch{return!1}}class Xw{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Ww{constructor(){this.instancedDataArray=new yu,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class zx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,o,l){this.tileToMeter=$e(o);const d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:f,id:y,index:x,sourceLayerIndex:T}of e){const M=y??(f.properties&&f.properties.hasOwnProperty("id")?f.properties.id:void 0),R=ai(f,d);if(!this.layers[0]._featureFilter.filter(new Fn(this.zoom),R,o))continue;const D={id:M,sourceLayerIndex:T,index:x,geometry:d?R.geometry:Qt(f,o,l),properties:f.properties,type:f.type,patterns:{}},B=this.addFeature(D,D.geometry,R);B&&i.featureIndex.insert(f,D.geometry,x,T,this.index,this.instancesPerModel[B].instancedDataArray.length,Ut/32)}this.lookup=null}update(e,i,o,l){for(const d in this.instancesPerModel){const f=this.instancesPerModel[d];for(const y in e)f.idToFeaturesIndex.hasOwnProperty(y)&&(this.evaluate(f.features[f.idToFeaturesIndex[y]],e[y],f,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];for(const l of o.features){const d=this.layers[0],f=l.feature,y=this.canonical,x=d.paint.get("model-rotation").evaluate(f,{},y),T=d.paint.get("model-scale").evaluate(f,{},y),M=d.paint.get("model-translation").evaluate(f,{},y);_n(l.rotation,x)&&_n(l.scale,T)&&_n(l.translation,M)||(this.evaluate(l,l.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,i,o,l){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const d=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(kf(this.activeReplacements,d))return!1;this.activeReplacements=d;let f=!1;for(const y in this.instancesPerModel){const x=this.instancesPerModel[y],T=x.instancedDataArray;for(const M of x.features){const R=M.instancedDataOffset,D=M.instancedDataCount;for(let B=0;B<D;B++){const F=16*(B+R);let q=T.float32[F+0];const J=q>Ut;q=J?q-Ut:q;const te=Math.floor(q),he=T.float32[F+1];let ce=!1;for(const X of this.activeReplacements)if(!Of(X,o,Zw.Model,l)&&!(X.min.x>te||te>X.max.x||X.min.y>he||he>X.max.y)&&(ce=z_(ov(te,he,e.canonical,X.footprintTileId.canonical),X.footprint),ce))break;T.float32[F]=ce?q+Ut:q,f=f||ce!==J}}}return f}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,iR.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,o){const l=this.layers[0],d=l.layout.get("model-id").evaluate(o,{},this.canonical);if(!d)return Ui(`modelId is not evaluated for layer ${l.id} and it is not going to get rendered.`),d;(Dx(d,!1)||this.styleDefinedModelURLs[d]!==void 0)&&(this.modelUris.includes(d)||this.modelUris.push(d)),this.instancesPerModel[d]||(this.instancesPerModel[d]=new Ww);const f=this.instancesPerModel[d],y=f.instancedDataArray,x=new Xw(o,y.length);for(const T of i)for(const M of T){if(M.x<0||M.x>=Ut||M.y<0||M.y>=Ut)continue;const R=(this.lookupDim-1)/Ut,D=this.lookupDim*(M.y*R|0)+M.x*R|0;if(this.lookup){if(this.lookup[D]!==0)continue;this.lookup[D]=1}this.instanceCount++;const B=y.length;y.resize(B+1),f.instancesEvaluatedElevation.push(0),y.float32[16*B]=M.x,y.float32[16*B+1]=M.y}return x.instancedDataCount=f.instancedDataArray.length-x.instancedDataOffset,x.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(x),this.evaluate(x,{},f,!1)),d}getModelUris(){return this.modelUris}evaluate(e,i,o,l){const d=this.layers[0],f=e.feature,y=this.canonical,x=e.rotation=d.paint.get("model-rotation").evaluate(f,i,y),T=e.scale=d.paint.get("model-scale").evaluate(f,i,y),M=e.translation=d.paint.get("model-translation").evaluate(f,i,y),R=d.paint.get("model-color").evaluate(f,i,y);R.a=d.paint.get("model-color-mix-intensity").evaluate(f,i,y);const D=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]),this.maxScale=Math.max(Math.max(this.maxScale,T[0]),Math.max(T[1],T[2])),qw(D,x,T);const B=Math.round(100*R.a)+R.b/1.05;for(let F=0;F<e.instancedDataCount;++F){const q=e.instancedDataOffset+F,J=16*q,te=o.instancedDataArray.float32;let he=0;l&&(he=te[J+6]-o.instancesEvaluatedElevation[q]);const ce=0|te[J+1];te[J]=(0|te[J])+R.r/1.05,te[J+1]=ce+R.g/1.05,te[J+2]=B,te[J+3]=1/(y.z>10?this.tileToMeter:$e(y,ce)),te[J+4]=M[0],te[J+5]=M[1],te[J+6]=M[2]+he,te[J+7]=D[0],te[J+8]=D[1],te[J+9]=D[2],te[J+10]=D[4],te[J+11]=D[5],te[J+12]=D[6],te[J+13]=D[8],te[J+14]=D[9],te[J+15]=D[10],o.instancesEvaluatedElevation[q]=M[2]}}}let Yw,Kw;Wt(zx,"ModelBucket",{omit:["layers"]}),Wt(Ww,"PerModelAttributes"),Wt(Xw,"ModelFeature");const mm=64,Ag={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Qw(n,e,i,o,l,d,f,y,x,T=!1){const M=i.zoom,R=i.project(o),D=lt(o.lat,M),B=1/D;be(n),Be(n,n,[R.x+f[0]*B,R.y+f[1]*B,f[2]]);let F=1,q=1;const J=i.worldSize;if(T){if(i.projection.name==="mercator"){let X=0;i.elevation&&(X=i.elevation.getAtPointOrZero(new et(R.x/J,R.y/J),0));const re=la([],[R.x,R.y,X,1],i.projMatrix)[3]/i.cameraToCenterDistance;F=re,q=re*lt(i.center.lat,M)}else if(i.projection.name==="globe"){const X=Ix(n,i),re=[0,0,0,1];la(re,re,Oe([],i.projMatrix,X));const ue=re[3]/i.cameraToCenterDistance,_e=xu(M),ze=i.projection.pixelsPerMeter(o.lat,J)*lt(o.lat,M),Ne=i.projection.pixelsPerMeter(i.center.lat,J)*lt(i.center.lat,M);F=ue/Ti(ze,ht(i.center.lat),_e),q=ue*D/ze,F*=Ne,q*=Ne}}else F=B;je(n,n,[F,F,q]);const te=[...n],he=e.orientation,ce=[];if(qw(ce,[he[0]+l[0],he[1]+l[1],he[2]+l[2]],d),Oe(n,te,ce),y&&i.elevation){let X=0;const re=[];if(x&&i.elevation){X=function(_e,ze,Ne,Ue,qe){const ot=ze.elevation;if(!ot)return 0;const St=Un.projectAabbCorners(Ne,Ue),gt=ge(1,qe.lat)*ze.worldSize,xt=function(It,ji){const si=[0,0,1],li=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Oi of li){const qi=It[Oi.corners[0]],$i=It[Oi.corners[1]],en=It[Oi.corners[2]],Qi=[$i[0]-qi[0],$i[1]-qi[1],ji*($i[2]-qi[2])],Xi=ri(Qi,Qi,[en[0]-qi[0],en[1]-qi[1],ji*(en[2]-qi[2])]);Ci(Xi,Xi),Oi.dotProductWithUp=pi(Xi,si)}return li.sort((Oi,qi)=>Oi.dotProductWithUp-qi.dotProductWithUp),li[0].corners}(St,gt),Rt=St[xt[0]],nt=St[xt[1]],yt=St[xt[2]],it=St[xt[3]],rt=ot.getAtPointOrZero(new et(Rt[0]/ze.worldSize,Rt[1]/ze.worldSize),0),Dt=ot.getAtPointOrZero(new et(nt[0]/ze.worldSize,nt[1]/ze.worldSize),0),Ot=ot.getAtPointOrZero(new et(yt[0]/ze.worldSize,yt[1]/ze.worldSize),0),hi=ot.getAtPointOrZero(new et(it[0]/ze.worldSize,it[1]/ze.worldSize),0),ti=(rt+hi)/2,Gt=(Dt+Ot)/2;return ti>Gt?Dt<Ot?Lv(_e,nt,it,Rt,Dt,hi,rt,gt):Lv(_e,yt,Rt,it,Ot,rt,hi,gt):rt<hi?Lv(_e,Rt,nt,yt,rt,Dt,Ot,gt):Lv(_e,it,yt,nt,hi,Ot,Dt,gt),Math.max(ti,Gt)}(re,i,e.aabb,n,o);const ue=Oe([],ni([],re),ce);Oe(n,te,ue)}else X=i.elevation.getAtPointOrZero(new et(R.x/J,R.y/J),0);X!==0&&(n[14]+=X)}}function W_(n,e,i=!1){n.uploaded||(n.gfxTexture=new Mx(e,n.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function rR(n,e,i){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,KC.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,tR.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,eR.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(n.colorArray.bytesPerElement===12?QC:JC).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,nR.members,!0)),n.segments=vr.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const o=n.material;o.pbrMetallicRoughness.baseColorTexture&&W_(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&W_(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&W_(o.normalTexture,e),o.occlusionTexture&&W_(o.occlusionTexture,e,i),o.emissionTexture&&W_(o.emissionTexture,e)}function Px(n,e,i){if(n.meshes)for(const o of n.meshes)rR(o,e,i);if(n.children)for(const o of n.children)Px(o,e,i)}function kv(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)kv(e)}function Lx(n){if(n.meshes)for(const i of n.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(n.children)for(const i of n.children)Lx(i)}class Mg{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){const l=o||e.findDEMTileFor(i);if(!l||!l.dem)return;const d=l.dem,f=l.tileID,y=1<<i.canonical.z-f.canonical.z;return new Mg(l,d.dim/Ut/y,[(i.canonical.x/y-f.canonical.x)*d.dim,(i.canonical.y/y-f.canonical.y)*d.dim])}tileCoordToPixel(e,i){const o=i*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(o);return new Bt(l,d)}getElevationAt(e,i,o,l){const d=e*this._scale+this._offset[0],f=i*this._scale+this._offset[1],y=Math.floor(d),x=Math.floor(f),T=this._dem;return l=!!l,o?Ti(Ti(T.get(y,x,l),T.get(y,x+1,l),f-x),Ti(T.get(y+1,x,l),T.get(y+1,x+1,l),f-x),d-y):T.get(y,x,l)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ge(1,e)*this._dem.stride}}const Ox=new Float32Array(262144),gm=new Uint8Array(262144);function Jw(n){let e=0;if(n.meshes)for(const i of n.meshes)e=Math.max(e,i.aabb.max[2]);if(n.children)for(const i of n.children)e=Math.max(e,Jw(i));return e}function eT(n,e,i){if(n.meshes)for(const o of n.meshes){if(o.aabb.min[0]===1/0)continue;const l=Un.applyTransform(o.aabb,n.matrix);i.insert(e,l.min[0],l.min[1],l.max[0],l.max[1])}if(n.children)for(const o of n.children)eT(o,e,i)}const tT=["","wall","door","roof","window","lamp","logo"];class iT{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Jw(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Un([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Un([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=Un.applyTransformFast(o.aabb,this.node.matrix),i.encapsulate(o.transformedAabb)),e++;this.aabb=i}return this.aabb}}class Nv{constructor(e,i,o,l,d,f,y){this.id=o,this.layers=e,this.layerIds=this.layers.map(x=>x.fqid),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.modelTraits|=Ag.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,l&&(this.modelTraits|=Ag.HasMapboxMeshFeatures),d&&(this.modelTraits|=Ag.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=f,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const x of i)this.nodesInfo.push(new iT(x)),eT(x,y.featureIndexArray.length,y.grid),y.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,y.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const o of this.getNodesInfo()){const l=o.node;l.footprint&&i.push({footprint:l.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const o=i?this.stateDependentLayers:this.layers;if(!Go(e,this.states))for(const l of o)this.evaluate(l,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const o of i){const l=o.node;this.uploaded?this.updatePbrBuffer(l):Px(l,e,!0)}for(const o of i)kv(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(e,i,o){const l=e.transform.projectionOptions,d=e.style.getBrightness(),f=this.brightness!==d;if(!this.uploaded||this.dirty||l.name!==this.projection.name||Y_(o.paint.get("model-color").value,f)||Y_(o.paint.get("model-color-mix-intensity").value,f)||Y_(o.paint.get("model-roughness").value,f)||Y_(o.paint.get("model-emissive-strength").value,f)||Y_(o.paint.get("model-height-based-emissive-strength-multiplier").value,f)){this.projection=l,this.brightness=d;const y=this.getNodesInfo();for(const x of y)x.state=null;return!0}return!1}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const o=this.getNodesInfo(),l=this.id.canonical;for(const d of o){const f=d.feature;d.evaluatedScale=i.paint.get("model-scale").evaluate(f,{},l)}}evaluate(e,i){const o=this.getNodesInfo();for(const l of o){if(!l.node.meshes)continue;const d=l.feature,f=i&&i[d.id];if(Go(f,l.state))continue;l.state=structuredClone(f);const y=l.node.meshes&&l.node.meshes[0].featureData,x=l.evaluatedColor[2],T=l.evaluatedRMEA[2],M=this.id.canonical;if(l.hasTranslucentParts=!1,y){for(let R=0;R<tT.length;R++){const D=tT[R];D.length&&(d.properties.part=D);const B=e.paint.get("model-color").evaluate(d,f,M).toRenderColor(null),F=e.paint.get("model-color-mix-intensity").evaluate(d,f,M);l.evaluatedColor[R]=[B.r,B.g,B.b,F],l.evaluatedRMEA[R][0]=e.paint.get("model-roughness").evaluate(d,f,M),l.evaluatedRMEA[R][2]=e.paint.get("model-emissive-strength").evaluate(d,f,M),l.evaluatedRMEA[R][3]=B.a,l.emissionHeightBasedParams[R]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(d,f,M),!l.hasTranslucentParts&&B.a<1&&(l.hasTranslucentParts=!0)}delete d.properties.part,oR(l,x!==l.evaluatedColor[2]||T!==l.evaluatedRMEA[2],this.modelTraits)}else l.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(d,f,M);l.evaluatedScale=e.paint.get("model-scale").evaluate(d,f,M),this.updatePbrBuffer(l.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,o,l){const d=e.findDEMTileFor(o);if(d&&(d.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;const f=Mg.create(e,o,d);if(!f)return;this.modelTraits&Ag.HasMapboxMeshFeatures&&this.updateDEM(e,f,o,l);for(const y of this.getNodesInfo()){const x=y.node;if(!x.footprint||!x.footprint.vertices||!x.footprint.vertices.length)continue;const T=x.footprint.vertices;let M=f.getElevationAt(T[0].x,T[0].y,!0,!0);for(let R=1;R<T.length;R++)M=Math.min(M,f.getElevationAt(T[R].x,T[R].y,!0,!0));x.elevation=M}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,o,l){let d=i._dem._modifiedForSources[l];if(d===void 0&&(i._dem._modifiedForSources[l]=[],d=i._dem._modifiedForSources[l]),d.includes(o.canonical))return;const f=i._dem.dim;d.push(o.canonical);let y=!1;for(const x of this.getNodesInfo()){const T=x.node;if(!T.footprint||!T.footprint.grid)continue;const M=T.footprint.grid,R=i.tileCoordToPixel(M.min.x,M.min.y),D=i.tileCoordToPixel(M.max.x,M.max.y),B=Math.min(Math.min(f-D.y,R.x),Math.min(R.y,f-D.x));if(B<0)continue;const F=Me(B,2,5);let q=Math.max(0,R.x-F),J=Math.max(0,R.y-F),te=Math.min(D.x+F,f-1),he=Math.min(D.y+F,f-1);for(let ue=J;ue<=he;++ue)for(let _e=q;_e<=te;++_e)gm[ue*f+_e]=255;let ce=0,X=0;for(let ue=0;ue<M.cellsY;++ue)for(let _e=0;_e<M.cellsX;++_e){if(!M.cells[ue*M.cellsX+_e])continue;const ze=i.tileCoordToPixel(M.min.x+_e/M.xScale,M.min.y+ue/M.yScale),Ne=i.tileCoordToPixel(M.min.x+(_e+1)/M.xScale,M.min.y+(ue+1)/M.yScale);for(let Ue=ze.y;Ue<=Math.min(Ne.y+1,f-1);++Ue)for(let qe=ze.x;qe<=Math.min(Ne.x+1,f-1);++qe)gm[Ue*f+qe]===255&&(gm[Ue*f+qe]=0,ce+=i.getElevationAtPixel(qe,Ue),X++)}const re=ce/X;q=Math.max(1,R.x-F),J=Math.max(1,R.y-F),te=Math.min(D.x+F,f-2),he=Math.min(D.y+F,f-2),y=!0;for(let ue=J;ue<=he;++ue)for(let _e=q;_e<=te;++_e)gm[ue*f+_e]===0&&(Ox[ue*f+_e]=i._dem.set(_e,ue,re));for(let ue=1;ue<F;++ue){q=Math.max(1,R.x-ue),J=Math.max(1,R.y-ue),te=Math.min(D.x+ue,f-2),he=Math.min(D.y+ue,f-2);for(let _e=J;_e<=he;++_e)for(let ze=q;ze<=te;++ze){const Ne=_e*f+ze;if(gm[Ne]===255){let Ue=0,qe=0,ot=-1,St=-1;for(let gt=-1;gt<=1;++gt)for(let xt=-1;xt<=1;++xt){const Rt=(_e+gt)*f+ze+xt;if(gm[Rt]>=ue)continue;const nt=Ox[Rt],yt=Math.abs(nt);yt>qe&&(Ue=nt,qe=yt,ot=xt,St=gt)}if(qe>.1){const gt=1-(ue+.5*Math.abs(ot*St))/F;let xt=i._dem.get(ze,_e)+Ue*gt;const Rt=i._dem.get(ze+ot,_e+St),nt=i._dem.get(ze-ot,_e-St,!0);(xt-Rt)*(xt-nt)>0&&(xt=(Rt+nt)/2),Ox[Ne]=i._dem.set(ze,_e,xt),gm[Ne]=ue}}}}}y&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Ho.now())}setFilter(e){this.filter=e?xf(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Fn(this.id.overscaledZ),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)kv(i.node),Lx(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped()),l=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){const f=l[d].node;l[d].hiddenByReplacement=!!f.footprint&&!o.find(y=>y.footprint===f.footprint)}}getHeightAtTileCoord(e,i){const o=this.getNodesInfo(),l=[],d=[0,0,0],f=be([]);for(let y=0;y<this.nodesInfo.length;y++){const x=o[y],T=x.node.meshes[0],M=T.transformedAabb;if(e<M.min[0]||i<M.min[1]||e>M.max[0]||i>M.max[1])continue;if(x.node.hidden===!0)return{height:1/0,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};ke(f,x.node.matrix),d[0]=e,d[1]=i,Vi(d,d,f);const R=(d[0]-T.aabb.min[0])/(T.aabb.max[0]-T.aabb.min[0])*mm|0,D=Math.min(63,(d[1]-T.aabb.min[1])/(T.aabb.max[1]-T.aabb.min[1])*mm|0)*mm+Math.min(63,R),B=T.heightmap[D];if(!(B<0&&x.node.footprint))return x.hiddenByReplacement?void 0:{height:B,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};if(x.node.footprint.grid.query(new Bt(e,i),new Bt(e,i),l),l.length>0)return{height:void 0,maxHeight:x.feature.properties.height,hidden:x.hiddenByReplacement,verticalScale:x.evaluatedScale[2]}}}}function Y_(n,e){return n instanceof yr&&!n.isLightConstant&&e}function aR(n,e,i,o,l,d,f,y){let x=(61440&e|(61440&e)>>4)>>8,T=(3840&e|(3840&e)>>4)>>4,M=240&e|(240&e)>>4;i[3]>0&&(x=Ti(x,255*i[0],i[3]),T=Ti(T,255*i[1],i[3]),M=Ti(M,255*i[2],i[3]));const R=x<<8|T,D=M<<8|Math.floor(255*o[3]),B=function(ue){const _e=Me(ue,0,2);return Math.min(Math.round(.5*_e*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],F=Me(l[0],0,1),q=Me(l[1],0,1),J=Me(l[2],0,1),te=Me(l[3],0,1);let he,ce,X,re;if(F!==q&&f!==d&&q!==F){const ue=f-d;ce=1/(ue*(q-F)),X=-(d+ue*F)/(ue*(q-F));const _e=Me(l[4],-1,1);re=Math.pow(10,_e),he=255*J<<8|255*te}else he=65535,ce=0,X=1,re=1;if(n.emplaceBack(R,D,B,he,ce,X,re),y){const ue=y.length;y.clear();for(let _e=0;_e<ue;_e++)y.emplaceBack(R,D,B,he,ce,X,re)}}function oR(n,e,i){const o=n.node;let l=0;const d=i&Ag.HasMeshoptCompression;for(const f of o.meshes){if(o.lights&&o.lightMeshIndex===l||!f.featureData)continue;f.featureArray=new ph,f.featureArray.reserve(f.featureData.length);let y=e;for(const x of f.featureData){const T=d?65535&x:x>>16&65535,M=d?x>>16&65535:65535&x,R=(15&M)<8?15&M:0,D=n.evaluatedRMEA[R],B=n.evaluatedColor[R],F=n.emissionHeightBasedParams[R];let q;if(y&&R===2&&o.lights&&(q=new ph,q.resize(10*o.lights.length)),aR(f.featureArray,T,B,D,F,f.aabb.min[2],f.aabb.max[2],q),q&&y){y=!1;const J=o.meshes[o.lightMeshIndex];J.featureArray=q,J.featureArray._trim()}}f.featureArray._trim(),l++}}function nT(n,e,i,o){const l=1<<n.z;e.lat=Le((o/Ut+n.y)/l),e.lng=Ce((i/Ut+n.x)/l)}Wt(Nv,"Tiled3dModelBucket",{omit:["layers"]}),Wt(iT,"Tiled3dModelFeature");const sR={circle:class extends ka{constructor(n,e,i,o){super(n,{layout:En||(En=new wr({"circle-sort-key":new Xt(We.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Nt(We.layout_circle["circle-elevation-reference"]),visibility:new Nt(We.layout_circle.visibility)})),paint:ir||(ir=new wr({"circle-radius":new Xt(We.paint_circle["circle-radius"]),"circle-color":new Xt(We.paint_circle["circle-color"]),"circle-blur":new Xt(We.paint_circle["circle-blur"]),"circle-opacity":new Xt(We.paint_circle["circle-opacity"]),"circle-translate":new Nt(We.paint_circle["circle-translate"]),"circle-translate-anchor":new Nt(We.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Nt(We.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Nt(We.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Xt(We.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Xt(We.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Xt(We.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Nt(We.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}createBucket(n){return new ii(n)}queryRadius(n){const e=n;return ki("circle-radius",this,e)+ki("circle-stroke-width",this,e)+$n(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,o,l,d,f,y){const x=Sn(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return h_(n,o,d,f,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,T)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e,i){const o=Uy(this);return{config:new Ol(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends ka{createBucket(n){return new Pd(n)}constructor(n,e,i,o){super(n,{layout:Ym||(Ym=new wr({visibility:new Nt(We.layout_heatmap.visibility)})),paint:Wp||(Wp=new wr({"heatmap-radius":new Xt(We.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Xt(We.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Nt(We.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ps(We.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Nt(We.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Df({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return ki("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,o,l,d,f,y){const x=this.paint.get("heatmap-radius").evaluate(e,i);return h_(n,o,d,f,y,!0,!0,new Bt(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e,i){return n==="heatmap"?{config:new Ol(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends ka{constructor(n,e,i,o){super(n,{layout:Km||(Km=new wr({visibility:new Nt(We.layout_hillshade.visibility)})),paint:xh||(xh=new wr({"hillshade-illumination-direction":new Nt(We.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Nt(We.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Nt(We.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Nt(We.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Nt(We.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Nt(We.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Nt(We.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}},fill:class extends ka{constructor(n,e,i,o){super(n,{layout:Fd||(Fd=new wr({"fill-sort-key":new Xt(We.layout_fill["fill-sort-key"]),visibility:new Nt(We.layout_fill.visibility),"fill-elevation-reference":new Nt(We.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Xt(We.layout_fill["fill-construct-bridge-guard-rail"])})),paint:Lf||(Lf=new wr({"fill-antialias":new Nt(We.paint_fill["fill-antialias"]),"fill-opacity":new Xt(We.paint_fill["fill-opacity"]),"fill-color":new Xt(We.paint_fill["fill-color"]),"fill-outline-color":new Xt(We.paint_fill["fill-outline-color"]),"fill-translate":new Nt(We.paint_fill["fill-translate"]),"fill-translate-anchor":new Nt(We.paint_fill["fill-translate-anchor"]),"fill-pattern":new Xt(We.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Nt(We.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Nt(We.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Xt(We.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Xt(We.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Xt(We.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(n,e,i){return{config:new Ol(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new hg(n)}queryRadius(){return $n(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,o,l,d){return!n.queryGeometry.isAboveHorizon&&Ai(mn(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),o)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(n){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return n!=null?e&&!n:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends ka{constructor(n,e,i,o){super(n,{layout:jf||(jf=new wr({visibility:new Nt(We["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Nt(We["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:bg||(bg=new wr({"fill-extrusion-opacity":new Nt(We["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Xt(We["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Nt(We["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Nt(We["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Xt(We["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Nt(We["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Xt(We["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Xt(We["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Nt(We["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Nt(We["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Nt(We["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Nt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Nt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Nt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Nt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Nt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Nt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Nt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Xt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Xt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Nt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Nt(We["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Nt(We["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Nt(We["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Xt(We["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Xt(We["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Nt(We["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new vg(n)}queryRadius(){return $n(this.paint.get("fill-extrusion-translate"))}is3D(n){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,i,o,l,d,f,y,x){const T=Sn(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,i),R=this.paint.get("fill-extrusion-base").evaluate(e,i),D=[0,0],B=y&&d.elevation,F=d.elevation?d.elevation.exaggeration():1,q=n.tile.getBucket(this);if(B&&q instanceof vg){const X=q.centroidVertexArray,re=x+1;re<X.length&&(D[0]=X.geta_centroid_pos0(re),D[1]=X.geta_centroid_pos1(re))}if(D[0]===0&&D[1]===1)return!1;d.projection.name==="globe"&&(o=hm([o],[new Bt(0,0),new Bt(Ut,Ut)],n.tileID.canonical).map(X=>X.polygon).flat());const J=B?y:null,[te,he]=function(X,re,ue,_e,ze,Ne,Ue,qe,ot,St,gt){return X.projection.name==="globe"?function(xt,Rt,nt,yt,it,rt,Dt,Ot,hi,ti,Gt){const It=[],ji=[],si=xt.projection.upVectorScale(Gt,xt.center.lat,xt.worldSize).metersToTile,li=[0,0,0,1],Oi=[0,0,0,1],qi=(en,Qi,Xi,Kn)=>{en[0]=Qi,en[1]=Xi,en[2]=Kn,en[3]=1},$i=um();nt>0&&(nt+=$i),yt+=$i;for(const en of Rt){const Qi=[],Xi=[];for(const Kn of en){const sr=Kn.x+it.x,me=Kn.y+it.y,xe=xt.projection.projectTilePoint(sr,me,Gt),ct=xt.projection.upVector(Gt,Kn.x,Kn.y);let Ft=nt,qt=yt;if(Dt){const Ht=U(sr,me,nt,yt,Dt,Ot,hi,ti);Ft+=Ht.base,qt+=Ht.top}nt!==0?qi(li,xe.x+ct[0]*si*Ft,xe.y+ct[1]*si*Ft,xe.z+ct[2]*si*Ft):qi(li,xe.x,xe.y,xe.z),qi(Oi,xe.x+ct[0]*si*qt,xe.y+ct[1]*si*qt,xe.z+ct[2]*si*qt),Vi(li,li,rt),Vi(Oi,Oi,rt),Qi.push(new Mc(li[0],li[1],li[2])),Xi.push(new Mc(Oi[0],Oi[1],Oi[2]))}It.push(Qi),ji.push(Xi)}return[It,ji]}(X,re,ue,_e,ze,Ne,Ue,qe,ot,St,gt):Ue?function(xt,Rt,nt,yt,it,rt,Dt,Ot,hi){const ti=[],Gt=[],It=[0,0,0,1];for(const ji of xt){const si=[],li=[];for(const Oi of ji){const qi=Oi.x+yt.x,$i=Oi.y+yt.y,en=U(qi,$i,Rt,nt,rt,Dt,Ot,hi);It[0]=qi,It[1]=$i,It[2]=en.base,It[3]=1,la(It,It,it),It[3]=Math.max(It[3],1e-5);const Qi=new Mc(It[0]/It[3],It[1]/It[3],It[2]/It[3]);It[0]=qi,It[1]=$i,It[2]=en.top,It[3]=1,la(It,It,it),It[3]=Math.max(It[3],1e-5);const Xi=new Mc(It[0]/It[3],It[1]/It[3],It[2]/It[3]);si.push(Qi),li.push(Xi)}ti.push(si),Gt.push(li)}return[ti,Gt]}(re,ue,_e,ze,Ne,Ue,qe,ot,St):function(xt,Rt,nt,yt,it){const rt=[],Dt=[],Ot=it[8]*Rt,hi=it[9]*Rt,ti=it[10]*Rt,Gt=it[11]*Rt,It=it[8]*nt,ji=it[9]*nt,si=it[10]*nt,li=it[11]*nt;for(const Oi of xt){const qi=[],$i=[];for(const en of Oi){const Qi=en.x+yt.x,Xi=en.y+yt.y,Kn=it[0]*Qi+it[4]*Xi+it[12],sr=it[1]*Qi+it[5]*Xi+it[13],me=it[2]*Qi+it[6]*Xi+it[14],xe=it[3]*Qi+it[7]*Xi+it[15],ct=Kn+Ot,Ft=sr+hi,qt=me+ti,Ht=Math.max(xe+Gt,1e-5),ui=Kn+It,Ii=sr+ji,hn=me+si,dn=Math.max(xe+li,1e-5);qi.push(new Mc(ct/Ht,Ft/Ht,qt/Ht)),$i.push(new Mc(ui/dn,Ii/dn,hn/dn))}rt.push(qi),Dt.push($i)}return[rt,Dt]}(re,ue,_e,ze,Ne)}(d,o,R,M,T,f,J,D,F,d.center.lat,n.tileID.canonical),ce=n.queryGeometry;return function(X,re,ue){let _e=1/0;Ai(ue,re)&&(_e=P(ue,re[0]));for(let ze=0;ze<re.length;ze++){const Ne=re[ze],Ue=X[ze];for(let qe=0;qe<Ne.length-1;qe++){const ot=Ne[qe],St=[ot,Ne[qe+1],Ue[qe+1],Ue[qe],ot];Mi(ue,St)&&(_e=Math.min(_e,P(ue,St)))}}return _e!==1/0&&_e}(te,he,ce.isPointQuery()?ce.screenBounds:ce.screenGeometry)}},line:class extends ka{constructor(n,e,i,o){const l=fv();super(n,l,e,i,o),l.layout&&(this.layout=new fc(l.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ku,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=(()=>{if(B_)return B_;const i=fv();return B_=new sC(i.paint.properties["line-width"].specification),B_.useIntegerZoom=!0,B_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new mt(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e,i){const o=Ba(this);return{config:new Ol(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}queryRadius(n){const e=n,i=F1(ki("line-width",this,e),ki("line-gap-width",this,e)),o=ki("line-offset",this,e);return i/2+Math.abs(o)+$n(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,o,l,d){if(n.queryGeometry.isAboveHorizon)return!1;const f=mn(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),y=n.pixelToTileUnitsFactor/2*F1(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),x=this.paint.get("line-offset").evaluate(e,i);return x&&(o=function(T,M){const R=[],D=new Bt(0,0);for(let B=0;B<T.length;B++){const F=T[B],q=[];for(let J=0;J<F.length;J++){const te=F[J],he=F[J+1],ce=J===0?D:te.sub(F[J-1])._unit()._perp(),X=J===F.length-1?D:he.sub(te)._unit()._perp(),re=ce._add(X)._unit();re._mult(1/(re.x*X.x+re.y*X.y)),q.push(re._mult(M)._add(te))}R.push(q)}return R}(o,x*n.pixelToTileUnitsFactor)),function(T,M,R){for(let D=0;D<M.length;D++){const B=M[D];if(T.length>=3){for(let F=0;F<B.length;F++)if(wn(T,B[F]))return!0}if(Hi(T,B,R))return!0}return!1}(f,o,y)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(n){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:Rv,background:class extends ka{constructor(n,e,i,o){super(n,{layout:Rw||(Rw=new wr({visibility:new Nt(We.layout_background.visibility)})),paint:Iw||(Iw=new wr({"background-pitch-alignment":new Nt(We.paint_background["background-pitch-alignment"]),"background-color":new Nt(We.paint_background["background-color"]),"background-pattern":new Nt(We.paint_background["background-pattern"]),"background-opacity":new Nt(We.paint_background["background-opacity"]),"background-emissive-strength":new Nt(We.paint_background["background-emissive-strength"]),"background-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}is3D(n){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:Ow,"raster-particle":Uw,sky:class extends ka{constructor(n,e,i,o){super(n,{layout:Bw||(Bw=new wr({visibility:new Nt(We.layout_sky.visibility)})),paint:Fw||(Fw=new wr({"sky-type":new Nt(We.paint_sky["sky-type"]),"sky-atmosphere-sun":new Nt(We.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Nt(We.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Nt(We.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Nt(We.paint_sky["sky-gradient-radius"]),"sky-gradient":new ps(We.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Nt(We.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Nt(We.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Nt(We.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Df({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),l=!o,d=n.style.light,f=d.properties.get("position");return l&&d.properties.get("anchor")==="viewport"&&Ui("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?Cx(f.azimuthal,90-f.polar,e):Cx(o[0],90-o[1],e)}const i=this.paint.get("sky-gradient-center");return Cx(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}},slot:class extends ka{constructor(n,e,i,o){super(n,{paint:jw||(jw=new wr({}))},e,null)}},model:class extends ka{constructor(n,e,i,o){super(n,{layout:Yw||(Yw=new wr({visibility:new Nt(We.layout_model.visibility),"model-id":new Xt(We.layout_model["model-id"])})),paint:Kw||(Kw=new wr({"model-opacity":new Xt(We.paint_model["model-opacity"]),"model-rotation":new Xt(We.paint_model["model-rotation"]),"model-scale":new Xt(We.paint_model["model-scale"]),"model-translation":new Xt(We.paint_model["model-translation"]),"model-color":new Xt(We.paint_model["model-color"]),"model-color-mix-intensity":new Xt(We.paint_model["model-color-mix-intensity"]),"model-type":new Nt(We.paint_model["model-type"]),"model-cast-shadows":new Nt(We.paint_model["model-cast-shadows"]),"model-receive-shadows":new Nt(We.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Nt(We.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Xt(We.paint_model["model-emissive-strength"]),"model-roughness":new Xt(We.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Xt(We.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Nt(We.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Nt(We.paint_model["model-front-cutoff"]),"model-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new zx(n)}getProgramIds(){return["model"]}is3D(n){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof Nv?Ut-1:0}queryIntersectsFeature(n,e,i,o,l,d){if(!this.modelManager)return!1;const f=this.modelManager,y=n.tile.getBucket(this);if(!(y&&y instanceof zx))return!1;for(const x in y.instancesPerModel){const T=y.instancesPerModel[x],M=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(T.idToFeaturesIndex.hasOwnProperty(M)){const R=T.features[T.idToFeaturesIndex[M]],D=f.getModel(x,this.scope);if(!D)return!1;let B=Ie();const F=new K(0,0),q=y.canonical;let J=Number.MAX_VALUE;for(let te=0;te<R.instancedDataCount;++te){const he=16*(R.instancedDataOffset+te),ce=T.instancedDataArray.float32,X=[ce[he+4],ce[he+5],ce[he+6]];nT(q,F,ce[he],0|ce[he+1]),Qw(B,D,d,F,R.rotation,R.scale,X,!1,!1,!1),d.projection.name==="globe"&&(B=Ix(B,d));const re=Oe([],d.projMatrix,B),ue=n.queryGeometry,_e=$w(ue.isPointQuery()?ue.screenBounds:ue.screenGeometry,d,re,D.aabb);_e!=null&&(J=Math.min(_e,J))}return J!==Number.MAX_VALUE&&J}}return!1}_handleOverridablePaintPropertyUpdate(n,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||n!=="model-color"&&n!=="model-color-mix-intensity"&&n!=="model-rotation"&&n!=="model-scale"&&n!=="model-translation"&&n!=="model-emissive-strength")}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Yr}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends ka{constructor(n,e,i,o){super(n,{layout:A_||(A_=new wr({"clip-layer-types":new Nt(We.layout_clip["clip-layer-types"]),"clip-layer-scope":new Nt(We.layout_clip["clip-layer-scope"])})),paint:tv||(tv=new wr({}))},e,i,o)}recalculate(n,e){super.recalculate(n,e)}createBucket(n){return new M_(n)}is3D(n){return!0}}};class lR{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class cR{constructor(){this.tasks={},this.taskQueue=[],vi(["process"],this),this.invoker=new lR(this.process),this.nextId=0}add(e,i){const o=this.nextId++,l=function({type:d,isSymbolTile:f,zoom:y}){return y=y||0,d==="message"?0:d!=="maybePrepare"||f?d!=="parseTile"||f?d==="parseTile"&&f?300-y:d==="maybePrepare"&&f?400-y:500:200-y:100-y}(i);if(l===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:i,priority:l,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let l=0;l<this.taskQueue.length;l++){const d=this.tasks[this.taskQueue[l]];d.priority<i&&(i=d.priority,e=l)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class rT{constructor(e,i,o){this.target=e,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},vi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new cR}send(e,i,o,l,d=!1,f){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=f,this.callbacks[y]=o);const x=new Set;return this.target.postMessage({id:y,type:e,hasCallback:!!o,targetMapId:l,mustQueue:d,sourceMapId:this.mapId,data:Cl(i,x)},x),{cancel:()=>{o&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const l=this.cancelCallbacks[o];delete this.cancelCallbacks[o],l&&l.cancel()}else if(i.mustQueue||Gn(self)){const l=this.callbacks[o],d=this.scheduler.add(()=>this.processTask(o,i),l&&l.metadata||{type:"message"});d&&(this.cancelCallbacks[o]=d)}else this.processTask(o,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const o=this.callbacks[e];delete this.callbacks[e],o&&(i.error?o(uc(i.error)):o(null,uc(i.data)))}else{const o=new Set,l=i.hasCallback?(f,y)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?Cl(f):null,data:Cl(y,o)},o)}:()=>{},d=uc(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,d,l);else if(this.parent.getWorkerSource){const f=i.type.split("."),{source:y,scope:x}=d;this.parent.getWorkerSource(i.sourceMapId,f[0],y,x)[f[1]](d,l)}else l(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var K_={workerUrl:"",workerClass:null,workerParams:void 0};const kx="mapboxgl_preloaded_worker_pool";class _m{constructor(){this.active={}}acquire(e,i=_m.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(K_.workerClass!=null?new K_.workerClass:new self.Worker(K_.workerUrl,K_.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[kx]}numActive(){return Object.keys(this.active).length}}_m.workerCount=2;class Cg{constructor(e,i,o="Worker",l=_m.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Pt();const d=this.workerPool.acquire(this.id,l);for(let f=0;f<d.length;f++){const y=new Cg.Actor(d[f],i,this.id);y.name=`${o} ${f}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,o){Ye(this.actors,(l,d)=>{l.send(e,i,d)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Q_,Nx;function Bv(){return Q_||(Q_=new _m),Q_}Cg.Actor=rT;const Bx=new Cn(0,0,0),Fx={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},jx={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Fv={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},uR={PAINT_ORDER_FILL_AND_STROKE:1},J_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},aT={MASK_TYPE_LUMINANCE:1};function hR(n,e,i){n===1&&e.icons.push(function(o,l){return function(d){if(d.usvg_tree.height||(d.usvg_tree.height=d.usvg_tree.width),!d.metadata)return d;const{metadata:f}=d;if(f.content_area){const{content_area:y}=f;y.top==null&&(y.top=y.left),y.width==null&&(y.width=d.usvg_tree.width),y.height==null&&(y.height=y.width)}return f.stretch_x&&f.stretch_x.length&&oT(f,"x"),f.stretch_y&&f.stretch_y.length&&oT(f,"y"),d}(o.readFields(dR,{name:void 0},l))}(i,i.readVarint()+i.pos))}function oT(n,e){const i=[],o=n[`stretch_${e}`];let l=null;for(let d=0;d<o.length;d++)l===null?l=i.length===0?o[0]:i[i.length-1][1]+o[d]:(i.push([l,l+o[d]]),l=null);n[`stretch_${e}_areas`]=i}function dR(n,e,i){n===1?e.name=i.readString():n===2?e.metadata=function(o,l){return o.readFields(fR,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},l)}(i,i.readVarint()+i.pos):n===3&&(e.usvg_tree=function(o,l){return o.readFields(gR,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},l)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function fR(n,e,i){n===1?e.stretch_x=i.readPackedVarint():n===2?e.stretch_y=i.readPackedVarint():n===3?e.content_area=function(o,l){return o.readFields(pR,{left:0},l)}(i,i.readVarint()+i.pos):n===4&&e.variables.push(function(o,l){return o.readFields(mR,{name:void 0},l)}(i,i.readVarint()+i.pos))}function pR(n,e,i){n===1?e.left=i.readVarint():n===2?e.width=i.readVarint():n===3?e.top=i.readVarint():n===4&&(e.height=i.readVarint())}function mR(n,e,i){n===1?e.name=i.readString():n===2&&(e.rgb_color=Vv(i.readVarint()),e.value="rgb_color")}function gR(n,e,i){n===1?e.width=e.height=i.readVarint():n===2?e.height=i.readVarint():n===3?e.children.push(jv(i,i.readVarint()+i.pos)):n===4?e.linear_gradients.push(function(o,l){return o.readFields(TR,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},l)}(i,i.readVarint()+i.pos)):n===5?e.radial_gradients.push(function(o,l){return o.readFields(ER,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},l)}(i,i.readVarint()+i.pos)):n===7?e.clip_paths.push(function(o,l){return o.readFields(AR,{children:[]},l)}(i,i.readVarint()+i.pos)):n===8&&e.masks.push(function(o,l){const d=o.readFields(MR,{left:0,width:20,mask_type:aT.MASK_TYPE_LUMINANCE,children:[]},l);return d.height==null&&(d.height=d.width),d.top==null&&(d.top=d.left),d}(i,i.readVarint()+i.pos))}function jv(n,e){return n.readFields(_R,{},e)}function _R(n,e,i){n===1?(e.group=function(o,l){return o.readFields(yR,{opacity:255,children:[]},l)}(i,i.readVarint()+i.pos),e.node="group"):n===2&&(e.path=function(o,l){return o.readFields(xR,{paint_order:1,commands:[],step:1,diffs:[],rule:Fx.PATH_RULE_NON_ZERO},l)}(i,i.readVarint()+i.pos),e.node="path")}function yR(n,e,i){n===1?e.transform=Uv(i,i.readVarint()+i.pos):n===2?e.opacity=i.readVarint():n===5?e.clip_path_idx=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(jv(i,i.readVarint()+i.pos))}function Uv(n,e){return n.readFields(vR,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function vR(n,e,i){n===1?e.sx=i.readFloat():n===2?e.ky=i.readFloat():n===3?e.kx=i.readFloat():n===4?e.sy=i.readFloat():n===5?e.tx=i.readFloat():n===6&&(e.ty=i.readFloat())}function xR(n,e,i){n===1?e.fill=function(o,l){return o.readFields(bR,{rgb_color:Bx,paint:"rgb_color",opacity:255},l)}(i,i.readVarint()+i.pos):n===2?e.stroke=function(o,l){return o.readFields(wR,{rgb_color:Bx,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},l)}(i,i.readVarint()+i.pos):n===3?e.paint_order=i.readVarint():n===5?i.readPackedVarint(e.commands):n===6?e.step=i.readFloat():n===7?i.readPackedSVarint(e.diffs):n===8&&(e.rule=i.readVarint())}function bR(n,e,i){n===1?(e.rgb_color=Vv(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5&&(e.opacity=i.readVarint())}function Vv(n){return new Cn((n>>16&255)/255,(n>>8&255)/255,(255&n)/255,1)}function wR(n,e,i){n===1?(e.rgb_color=Vv(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5?i.readPackedFloat(e.dasharray):n===6?e.dashoffset=i.readFloat():n===7?e.miterlimit=i.readFloat():n===8?e.opacity=i.readVarint():n===9?e.width=i.readFloat():n===10?e.linecap=i.readVarint():n===11&&(e.linejoin=i.readVarint())}function TR(n,e,i){n===1?e.transform=Uv(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(sT(i,i.readVarint()+i.pos)):n===4?e.x1=i.readFloat():n===5?e.y1=i.readFloat():n===6?e.x2=i.readFloat():n===7&&(e.y2=i.readFloat())}function sT(n,e){return n.readFields(SR,{offset:0,opacity:255,rgb_color:Bx},e)}function SR(n,e,i){n===1?e.offset=i.readFloat():n===2?e.opacity=i.readVarint():n===3&&(e.rgb_color=Vv(i.readVarint()))}function ER(n,e,i){n===1?e.transform=Uv(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(sT(i,i.readVarint()+i.pos)):n===4?e.cx=i.readFloat():n===5?e.cy=i.readFloat():n===6?e.r=i.readFloat():n===7?e.fx=i.readFloat():n===8?e.fy=i.readFloat():n===9&&(e.fr=i.readFloat())}function AR(n,e,i){n===1?e.transform=Uv(i,i.readVarint()+i.pos):n===2?e.clip_path_idx=i.readVarint():n===3&&e.children.push(jv(i,i.readVarint()+i.pos))}function MR(n,e,i){n===1?e.left=e.top=i.readFloat():n===2?e.width=e.height=i.readFloat():n===3?e.top=i.readFloat():n===4?e.height=i.readFloat():n===5?e.mask_type=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(jv(i,i.readVarint()+i.pos))}class CR{static calculate(e={},i=[]){const o=new Map,l=new Map;if(Object.keys(e).length===0)return o;i.forEach(d=>{l.set(d.name,d.rgb_color||new Cn(0,0,0))});for(const[d,f]of Object.entries(e))l.has(d)?o.set(l.get(d).toStringPremultipliedAlpha(),f):console.warn(`Ignoring unknown image variable "${d}"`);return o}}function Rg(n,e=255,i){const o=e/255,l=n.toStringPremultipliedAlpha(),d=i.has(l)?i.get(l).clone():n.clone();return d.a*=o,d.toString()}function ey(n,e){if(!So()){const i=document.createElement("canvas");return i.width=n,i.height=e,i}return new OffscreenCanvas(n,e)}function RR(n,e){const i=CR.calculate(e.params,n.metadata?n.metadata.variables:[]),o=n.usvg_tree,l=o.width,d=o.height,f=e.transform?e.transform:new DOMMatrix,y=Math.max(1,Math.round(l*f.a)),x=Math.max(1,Math.round(d*f.d)),T=new DOMMatrix([y/l,0,0,x/d,0,0]),M=ey(y,x).getContext("2d");return Ux(M,T,o,o,i),M.getImageData(0,0,y,x)}function Ux(n,e,i,o,l){for(const d of o.children)lT(n,e,i,d,l)}function lT(n,e,i,o,l){o.group?(n.save(),function(d,f,y,x,T){const M=x.mask_idx!=null?y.masks[x.mask_idx]:null,R=x.clip_path_idx!=null?y.clip_paths[x.clip_path_idx]:null;if(x.transform&&(f=Gv(x.transform).preMultiplySelf(f)),!function(F,q,J){return F.opacity!==255||q||J}(x,R!=null,M!=null))return void Ux(d,f,y,x,T);const D=ey(d.canvas.width,d.canvas.height),B=D.getContext("2d");Ux(B,f,y,x,T),R&&mT(B,f,y,R),M&&gT(B,f,y,M,T),d.globalAlpha=x.opacity/255,d.drawImage(D,0,0)}(n,e,i,o.group,l),n.restore()):o.path&&(n.save(),function(d,f,y,x,T){const M=_T(x);d.setTransform(f),x.paint_order===uR.PAINT_ORDER_FILL_AND_STROKE?(cT(d,y,x,M,T),hT(d,y,x,M,T)):(hT(d,y,x,M,T),cT(d,y,x,M,T))}(n,e,i,o.path,l),n.restore())}function cT(n,e,i,o,l){const d=i.fill;if(!d)return;const f=d.opacity/255;switch(d.paint){case"rgb_color":n.fillStyle=Rg(d.rgb_color,d.opacity,l);break;case"linear_gradient_idx":n.fillStyle=dT(n,e.linear_gradients[d.linear_gradient_idx],f,l);break;case"radial_gradient_idx":n.fillStyle=fT(n,e.radial_gradients[d.radial_gradient_idx],f,l)}n.fill(o,uT(i))}function uT(n){return n.rule===Fx.PATH_RULE_NON_ZERO?"nonzero":n.rule===Fx.PATH_RULE_EVEN_ODD?"evenodd":void 0}function hT(n,e,i,o,l){const d=i.stroke;if(!d)return;n.lineWidth=d.width,n.miterLimit=d.miterlimit,n.setLineDash(d.dasharray),n.lineDashOffset=d.dashoffset;const f=d.opacity/255;switch(d.paint){case"rgb_color":n.strokeStyle=Rg(d.rgb_color,d.opacity,l);break;case"linear_gradient_idx":n.strokeStyle=dT(n,e.linear_gradients[d.linear_gradient_idx],f,l);break;case"radial_gradient_idx":n.strokeStyle=fT(n,e.radial_gradients[d.radial_gradient_idx],f,l)}switch(d.linejoin){case Fv.LINE_JOIN_MITER_CLIP:case Fv.LINE_JOIN_MITER:n.lineJoin="miter";break;case Fv.LINE_JOIN_ROUND:n.lineJoin="round";break;case Fv.LINE_JOIN_BEVEL:n.lineJoin="bevel"}switch(d.linecap){case jx.LINE_CAP_BUTT:n.lineCap="butt";break;case jx.LINE_CAP_ROUND:n.lineCap="round";break;case jx.LINE_CAP_SQUARE:n.lineCap="square"}n.stroke(o)}function dT(n,e,i,o){if(e.stops.length===1){const D=e.stops[0];return Rg(D.rgb_color,D.opacity*i,o)}const l=Gv(e.transform),{x1:d,y1:f,x2:y,y2:x}=e,T=l.transformPoint(new DOMPoint(d,f)),M=l.transformPoint(new DOMPoint(y,x)),R=n.createLinearGradient(T.x,T.y,M.x,M.y);for(const D of e.stops)R.addColorStop(D.offset,Rg(D.rgb_color,D.opacity*i,o));return R}function fT(n,e,i,o){if(e.stops.length===1){const D=e.stops[0];return Rg(D.rgb_color,D.opacity*i,o)}const l=Gv(e.transform),{fx:d,fy:f,cx:y,cy:x}=e,T=l.transformPoint(new DOMPoint(d,f)),M=l.transformPoint(new DOMPoint(y,x)),R=n.createRadialGradient(T.x,T.y,0,M.x,M.y,e.r*((l.a+l.d)/2));for(const D of e.stops)R.addColorStop(D.offset,Rg(D.rgb_color,D.opacity*i,o));return R}function pT(n,e,i,o){const l=o.transform?Gv(o.transform).preMultiplySelf(e):e,d=ey(n.canvas.width,n.canvas.height),f=d.getContext("2d");for(const x of o.children)if(x.group)pT(f,l,i,x.group);else if(x.path){const T=x.path,M=new Path2D;M.addPath(_T(T),l),f.fill(M,uT(T))}const y=o.clip_path_idx!=null?i.clip_paths[o.clip_path_idx]:null;y&&mT(f,l,i,y),n.globalCompositeOperation="source-over",n.drawImage(d,0,0)}function mT(n,e,i,o){const l=ey(n.canvas.width,n.canvas.height);pT(l.getContext("2d"),e,i,o),n.globalCompositeOperation="destination-in",n.drawImage(l,0,0)}function gT(n,e,i,o,l){if(o.children.length===0)return;const d=o.mask_idx!=null?i.masks[o.mask_idx]:null;d&&gT(n,e,i,d,l);const f=n.canvas.width,y=n.canvas.height,x=ey(f,y),T=x.getContext("2d"),M=o.width,R=o.height,D=o.left,B=o.top,F=new Path2D,q=new Path2D;q.rect(D,B,M,R),F.addPath(q,e),T.clip(F);for(const he of o.children)lT(T,e,i,he,l);const J=T.getImageData(0,0,f,y),te=J.data;if(o.mask_type===aT.MASK_TYPE_LUMINANCE)for(let he=0;he<te.length;he+=4)te[he+3]=te[he+3]/255*(.2126*te[he]+.7152*te[he+1]+.0722*te[he+2]);T.putImageData(J,0,0),n.globalCompositeOperation="destination-in",n.drawImage(x,0,0)}function Gv(n){return n?new DOMMatrix([n.sx,n.ky,n.kx,n.sy,n.tx,n.ty]):new DOMMatrix}function _T(n){const e=new Path2D,i=n.step;let o=n.diffs[0]*i,l=n.diffs[1]*i;e.moveTo(o,l);for(let d=0,f=2;d<n.commands.length;d++)switch(n.commands[d]){case J_.PATH_COMMAND_MOVE:o+=n.diffs[f++]*i,l+=n.diffs[f++]*i,e.moveTo(o,l);break;case J_.PATH_COMMAND_LINE:o+=n.diffs[f++]*i,l+=n.diffs[f++]*i,e.lineTo(o,l);break;case J_.PATH_COMMAND_QUAD:{const y=o+n.diffs[f++]*i,x=l+n.diffs[f++]*i;o=y+n.diffs[f++]*i,l=x+n.diffs[f++]*i,e.quadraticCurveTo(y,x,o,l);break}case J_.PATH_COMMAND_CUBIC:{const y=o+n.diffs[f++]*i,x=l+n.diffs[f++]*i,T=y+n.diffs[f++]*i,M=x+n.diffs[f++]*i;o=T+n.diffs[f++]*i,l=M+n.diffs[f++]*i,e.bezierCurveTo(y,x,T,M,o,l);break}case J_.PATH_COMMAND_CLOSE:e.closePath()}return e}class Hv{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}Wt(Hv,"LRUCache");class Vx{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new xa(e,e.data)}getFromCache(e,i,o){return this.cacheMap.has(o)||this.cacheMap.set(o,new Hv(150)),this.cacheMap.get(o).get(mc(e.toString(),i))}setInCache(e,i,o,l){this.cacheDependenciesMap.has(l)||this.cacheDependenciesMap.set(l,new Map),this.cacheMap.has(l)||this.cacheMap.set(l,new Hv(150));const d=this.cacheDependenciesMap.get(l),f=mc(e.id.toString(),o);d.get(f)||d.set(f,new Set);const y=this.cacheMap.get(l),x=e.toString();d.get(f).add(x),y.put(mc(e.toString(),o),i)}removeImagesFromCacheByIds(e,i,o=0){if(!this.cacheMap.has(o)||!this.cacheDependenciesMap.has(o))return;const l=this.cacheMap.get(o),d=this.cacheDependenciesMap.get(o);for(const f of e){const y=mc(f.toString(),i);if(d.has(y)){for(const x of d.get(y))l.delete(x);d.delete(y)}}}rasterize(e,i,o,l,d=RR){const f=this.getFromCache(e,o,l);if(f)return f.clone();const y=d(i.icon,e.options),x=Vx._getImage(y);return this.setInCache(e,x,o,l),x.clone()}}class yT{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function vT(n,e,i,o){let l=0,d=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(o[f])<1e-15){if(i[f]<n[f]||i[f]>e[f])return null}else{const y=1/o[f];let x=(n[f]-i[f])*y,T=(e[f]-i[f])*y;if(x>T){const M=x;x=T,T=M}if(x>l&&(l=x),T<d&&(d=T),l>d)return null}return l}function xT(n,e,i,o,l,d,f,y,x,T,M){const R=o-n,D=l-e,B=d-i,F=f-n,q=y-e,J=x-i,te=M[1]*J-M[2]*q,he=M[2]*F-M[0]*J,ce=M[0]*q-M[1]*F,X=R*te+D*he+B*ce;if(Math.abs(X)<1e-15)return null;const re=1/X,ue=T[0]-n,_e=T[1]-e,ze=T[2]-i,Ne=(ue*te+_e*he+ze*ce)*re;if(Ne<0||Ne>1)return null;const Ue=_e*B-ze*D,qe=ze*R-ue*B,ot=ue*D-_e*R,St=(M[0]*Ue+M[1]*qe+M[2]*ot)*re;return St<0||Ne+St>1?null:(F*Ue+q*qe+J*ot)*re}function bT(n,e,i){return(n-e)/(i-e)}function wT(n,e,i,o,l,d,f,y,x){const T=1<<i,M=d-o,R=f-l,D=(n+1)/T*M+o,B=(e+0)/T*R+l,F=(e+1)/T*R+l;y[0]=(n+0)/T*M+o,y[1]=B,x[0]=D,x[1]=F}class TT{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(d){const f=Math.ceil(Math.log2(d.dim/8)),y=[];let x=Math.ceil(Math.pow(2,f));const T=1/x,M=(B,F,q,J,te)=>{const he=J?1:0,ce=(B+1)*q-he,X=F*q,re=(F+1)*q-he;te[0]=B*q,te[1]=X,te[2]=ce,te[3]=re};let R=new yT(x);const D=[];for(let B=0;B<x*x;B++){M(B%x,Math.floor(B/x),T,!1,D);const F=Hf(D[0],D[1],d),q=Hf(D[2],D[1],d),J=Hf(D[2],D[3],d),te=Hf(D[0],D[3],d);R.minimums.push(Math.min(F,q,J,te)),R.maximums.push(Math.max(F,q,J,te)),R.leaves.push(1)}for(y.push(R),x/=2;x>=1;x/=2){const B=y[y.length-1];R=new yT(x);for(let F=0;F<x*x;F++){M(F%x,Math.floor(F/x),2,!0,D);const q=B.getElevation(D[0],D[1]),J=B.getElevation(D[2],D[1]),te=B.getElevation(D[2],D[3]),he=B.getElevation(D[0],D[3]),ce=B.isLeaf(D[0],D[1]),X=B.isLeaf(D[2],D[1]),re=B.isLeaf(D[2],D[3]),ue=B.isLeaf(D[0],D[3]),_e=Math.min(q.min,J.min,te.min,he.min),ze=Math.max(q.max,J.max,te.max,he.max),Ne=ce&&X&&re&&ue;R.maximums.push(ze),R.minimums.push(_e),R.leaves.push(ze-_e<=5&&Ne?1:0)}y.push(R)}return y}(this.dem),o=i.length-1,l=i[o];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,l,d,f,y=1){return vT([e,i,-100],[o,l,this.maximums[0]*y],d,f)}raycast(e,i,o,l,d,f,y=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,i,o,l,d,f,y);if(x==null)return null;const T=[],M=[],R=[],D=[],B=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:F,t:q,nodex:J,nodey:te,depth:he}=B.pop();if(this.leaves[F]){wT(J,te,he,e,i,o,l,R,D);const X=1<<he,re=(J+0)/X,ue=(J+1)/X,_e=(te+0)/X,ze=(te+1)/X,Ne=Hf(re,_e,this.dem)*y,Ue=Hf(ue,_e,this.dem)*y,qe=Hf(ue,ze,this.dem)*y,ot=Hf(re,ze,this.dem)*y,St=xT(R[0],R[1],Ne,D[0],R[1],Ue,D[0],D[1],qe,d,f),gt=xT(D[0],D[1],qe,R[0],D[1],ot,R[0],R[1],Ne,d,f),xt=Math.min(St!==null?St:Number.MAX_VALUE,gt!==null?gt:Number.MAX_VALUE);if(xt!==Number.MAX_VALUE)return xt;{const Rt=zt([],d,f,q);if(ST(Ne,Ue,ot,qe,bT(Rt[0],R[0],D[0]),bT(Rt[1],R[1],D[1]))>=Rt[2])return q}continue}let ce=0;for(let X=0;X<this._siblingOffset.length;X++){wT((J<<1)+this._siblingOffset[X][0],(te<<1)+this._siblingOffset[X][1],he+1,e,i,o,l,R,D),R[2]=-100,D[2]=this.maximums[this.childOffsets[F]+X]*y;const re=vT(R,D,d,f);if(re!=null){const ue=re;T[X]=ue;let _e=!1;for(let ze=0;ze<ce&&!_e;ze++)ue>=T[M[ze]]&&(M.splice(ze,0,X),_e=!0);_e||(M[ce]=X),ce++}}for(let X=0;X<ce;X++){const re=M[X];B.push({idx:this.childOffsets[F]+re,t:T[re],nodex:(J<<1)+this._siblingOffset[re][0],nodey:(te<<1)+this._siblingOffset[re][1],depth:he+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,l,d){if(e[l].isLeaf(i,o)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const f=l-1,y=e[f];let x=0,T=0;for(let M=0;M<this._siblingOffset.length;M++){const R=2*i+this._siblingOffset[M][0],D=2*o+this._siblingOffset[M][1],B=y.getElevation(R,D),F=y.isLeaf(R,D),q=this._addNode(B.min,B.max,F);F&&(x|=1<<M),T||(T=q)}for(let M=0;M<this._siblingOffset.length;M++)x&1<<M||this._construct(e,2*i+this._siblingOffset[M][0],2*o+this._siblingOffset[M][1],f,T+M)}}function ST(n,e,i,o,l,d){return Ti(Ti(n,i,d),Ti(e,o,d),l)}function Hf(n,e,i){const o=i.dim,l=Me(n*o-.5,0,o-1),d=Me(e*o-.5,0,o-1),f=Math.floor(l),y=Math.floor(d),x=Math.min(f+1,o-1),T=Math.min(y+1,o-1);return ST(i.get(f,y),i.get(x,y),i.get(f,T),i.get(x,T),l-f,d-y)}const IR={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function DR(n,e,i){return(256*n*256+256*e+i)/10-1e4}function zR(n,e,i){return 256*n+e+i/256-32768}class qv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,l=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void Ui(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const d=this.dim=i.height-2,f=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=l,this._modifiedForSources={},!l){for(let x=0;x<d;x++)f[this._idx(-1,x)]=f[this._idx(0,x)],f[this._idx(d,x)]=f[this._idx(d-1,x)],f[this._idx(x,-1)]=f[this._idx(x,0)],f[this._idx(x,d)]=f[this._idx(x,d-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(d,-1)]=f[this._idx(d-1,0)],f[this._idx(-1,d)]=f[this._idx(0,d-1)],f[this._idx(d,d)]=f[this._idx(d-1,d-1)]}const y=o==="terrarium"?zR:DR;for(let x=0;x<f.length;++x){const T=4*x;this.floatView[x]=y(this.pixels[T],this.pixels[T+1],this.pixels[T+2])}this._timestamp=Ho.now()}_buildQuadTree(){this._tree=new TT(this)}get(e,i,o=!1){o&&(e=Me(e,-1,this.dim),i=Me(i,-1,this.dim));const l=this._idx(e,i);return this.floatView[l]}set(e,i,o){const l=this._idx(e,i),d=this.floatView[l];return this.floatView[l]=o,o-d}static getUnpackVector(e){return IR[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const o=[0,0,0,0],l=qv.getUnpackVector(i);let d=Math.floor((e+l[3])/l[2]);return o[2]=d%256,d=Math.floor(d/256),o[1]=d%256,d=Math.floor(d/256),o[0]=d,o}getPixels(){return new f_({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=i*this.dim,d=i*this.dim+this.dim,f=o*this.dim,y=o*this.dim+this.dim;switch(i){case-1:l=d-1;break;case 1:d=l+1}switch(o){case-1:f=y-1;break;case 1:y=f+1}const x=-i*this.dim,T=-o*this.dim;for(let M=f;M<y;M++)for(let R=l;R<d;R++){const D=4*this._idx(R,M),B=4*this._idx(R+x,M+T);this.pixels[D+0]=e.pixels[B+0],this.pixels[D+1]=e.pixels[B+1],this.pixels[D+2]=e.pixels[B+2],this.pixels[D+3]=e.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function PR(n,e,i){n===1?e.headerLength=i.readFixed32():n===2?e.x=i.readVarint():n===3?e.y=i.readVarint():n===4?e.z=i.readVarint():n===5&&e.layers.push(function(o,l){return o.readFields(BR,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},l)}(i,i.readVarint()+i.pos))}function LR(n,e,i){n===1?(e.delta_filter=function(o,l){return o.readFields(OR,{blockSize:0},l)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):n===2?(i.readVarint(),e.filter="zigzag_filter"):n===3?(i.readVarint(),e.filter="bitshuffle_filter"):n===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function OR(n,e,i){n===1&&(e.blockSize=i.readVarint())}function kR(n,e,i){n===1?(i.readVarint(),e.codec="gzip_data"):n===2?(i.readVarint(),e.codec="jpeg_image"):n===3?(i.readVarint(),e.codec="webp_image"):n===4&&(i.readVarint(),e.codec="png_image")}function NR(n,e,i){let o=0,l=0;n===1?e.firstByte=i.readFixed64():n===2?e.lastByte=i.readFixed64():n===3?e.filters.push(function(d,f){return d.readFields(LR,{},f)}(i,i.readVarint()+i.pos)):n===4?e.codec=function(d,f){return d.readFields(kR,{},f)}(i,i.readVarint()+i.pos):n===5?l=i.readFloat():n===6?o=i.readFloat():n===7?e.bands.push(i.readString()):n===8?e.offset=i.readDouble():n===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=l),e.scale===0&&(e.scale=o)}function BR(n,e,i){n===1?e.version=i.readVarint():n===2?e.name=i.readString():n===3?e.units=i.readString():n===4?e.tileSize=i.readVarint():n===5?e.buffer=i.readVarint():n===6?e.pixelFormat=i.readVarint():n===7&&e.dataIndex.push(function(o,l){return o.readFields(NR,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},l)}(i,i.readVarint()+i.pos))}function FR(n,e,i){if(n===2)(function(o,l,d){o.readFields(jR,d,l)})(i,i.readVarint()+i.pos,e);else if(n===3)throw new Error("Not implemented")}function jR(n,e,i){if(n===1){let o=0;const l=i.readVarint()+i.pos;for(;i.pos<l;)e[o++]=i.readVarint()}}function UR(n,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let o=2;o>=1;o--){const l=o===1?1:0,d=o===2?1:0;for(let f=0;f<e[0];f++){const y=e[1]*f;for(let x=l;x<e[1];x++){const T=e[2]*(x+y);for(let M=d;M<e[2];M++){const R=e[3]*(M+T);for(let D=0;D<e[3];D++){const B=R+D;n[B]+=n[B-i]}}}}i*=e[o]}return n}function VR(n){for(let e=0,i=n.length;e<i;e++)n[e]=n[e]>>>1^-(1&n[e]);return n}function GR(n,e){switch(e){case"uint32":return n;case"uint16":for(let i=0;i<n.length;i+=2){const o=n[i],l=n[i+1];n[i]=(240&o)>>4|(61440&o)>>8|(240&l)<<4|61440&l,n[i+1]=15&o|(3840&o)>>4|(15&l)<<8|(3840&l)<<4}return n;case"uint8":for(let i=0;i<n.length;i+=4){const o=n[i],l=n[i+1],d=n[i+2],f=n[i+3];n[i+0]=(192&o)>>6|(192&l)>>4|(192&d)>>2|192&f,n[i+1]=(48&o)>>4|(48&l)>>2|48&d|(48&f)<<2,n[i+2]=(12&o)>>2|12&l|(12&d)<<2|(12&f)<<4,n[i+3]=3&o|(3&l)<<2|(3&d)<<4|(3&f)<<6}return n;default:throw new Error(`Invalid pixel format, "${e}"`)}}Wt(qv,"DEMData"),Wt(TT,"DemMinMaxQuadTree",{omit:["dem"]});var Ul=Uint8Array,ty=Uint16Array,HR=Int32Array,ET=new Ul([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),AT=new Ul([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),qR=new Ul([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),MT=function(n,e){for(var i=new ty(31),o=0;o<31;++o)i[o]=e+=1<<n[o-1];var l=new HR(i[30]);for(o=1;o<30;++o)for(var d=i[o];d<i[o+1];++d)l[d]=d-i[o]<<5|o;return{b:i,r:l}},CT=MT(ET,2),RT=CT.b,$R=CT.r;RT[28]=258,$R[258]=28;for(var ZR=MT(AT,0).b,IT=new ty(32768),pa=0;pa<32768;++pa){var Ig=(43690&pa)>>1|(21845&pa)<<1;IT[pa]=((65280&(Ig=(61680&(Ig=(52428&Ig)>>2|(13107&Ig)<<2))>>4|(3855&Ig)<<4))>>8|(255&Ig)<<8)>>1}var iy=function(n,e,i){for(var o=n.length,l=0,d=new ty(e);l<o;++l)n[l]&&++d[n[l]-1];var f,y=new ty(e);for(l=1;l<e;++l)y[l]=y[l-1]+d[l-1]<<1;f=new ty(1<<e);var x=15-e;for(l=0;l<o;++l)if(n[l])for(var T=l<<4|n[l],M=e-n[l],R=y[n[l]-1]++<<M,D=R|(1<<M)-1;R<=D;++R)f[IT[R]>>x]=T;return f},ny=new Ul(288);for(pa=0;pa<144;++pa)ny[pa]=8;for(pa=144;pa<256;++pa)ny[pa]=9;for(pa=256;pa<280;++pa)ny[pa]=7;for(pa=280;pa<288;++pa)ny[pa]=8;var DT=new Ul(32);for(pa=0;pa<32;++pa)DT[pa]=5;var XR=iy(ny,9),WR=iy(DT,5),Gx=function(n){for(var e=n[0],i=1;i<n.length;++i)n[i]>e&&(e=n[i]);return e},Iu=function(n,e,i){var o=e/8|0;return(n[o]|n[o+1]<<8)>>(7&e)&i},Hx=function(n,e){var i=e/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(7&e)},YR=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Du=function(n,e,i){var o=new Error(e||YR[n]);if(o.code=n,Error.captureStackTrace&&Error.captureStackTrace(o,Du),!i)throw o;return o},KR=new Ul(0),QR=typeof TextDecoder<"u"&&new TextDecoder;try{QR.decode(KR,{stream:!0})}catch{}const JR={gzip_data:"gzip"};class Rc extends Error{constructor(e){super(e),this.name="MRTError"}}const eI={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},zT={uint32:1,uint16:2,uint8:4},tI={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let qx;class $v{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new Rc(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),o=new DataView(e);if(i[0]!==13)throw new Rc("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),o=this.getHeaderLength(e);if(i.length<o)throw new Rc(`Expected header with length >= ${o} but got buffer of length ${i.length}`);const l=function(d,f){return d.readFields(PR,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new qx(i.subarray(0,o)));if(!isNaN(this.x)&&(this.x!==l.x||this.y!==l.y||this.z!==l.z))throw new Rc(`Invalid attempt to parse header ${l.z}/${l.x}/${l.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=l.x,this.y=l.y,this.z=l.z;for(const d of l.layers)this.layers[d.name]=new PT(d,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],o=this.getLayer(e.layerName);for(let l of e.blockIndices){const d=o.dataIndex[l],f=d.firstByte-e.firstByte,y=d.lastByte-e.firstByte;if(o._blocksInProgress.has(l))continue;const x={layerName:o.name,firstByte:f,lastByte:y,pixelFormat:o.pixelFormat,blockIndex:l,blockShape:[d.bands.length].concat(o.bandShape),buffer:o.buffer,codec:d.codec.codec,filters:d.filters.map(T=>T.filter)};o._blocksInProgress.add(l),i.push(x)}return new LT(i,()=>{i.forEach(l=>o._blocksInProgress.delete(l.blockIndex))},(l,d)=>{if(i.forEach(f=>o._blocksInProgress.delete(f.blockIndex)),l)throw l;d.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class PT{constructor({version:e,name:i,units:o,tileSize:l,pixelFormat:d,buffer:f,dataIndex:y},x){if(this.version=e,this.version!==1)throw new Rc(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=o,this.tileSize=l,this.buffer=f,this.pixelFormat=eI[d],this.dataIndex=y,this.bandShape=[l+2*f,l+2*f,zT[this.pixelFormat]],this._decodedBlocks=new Hv(x?x.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return zT[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[o,l]of this.dataIndex.entries()){for(const[d,f]of l.bands.entries())if(f===e)return{bandIndex:i+d,blockIndex:o,blockBandIndex:d};i+=l.bands.length}break;case"number":for(const[o,l]of this.dataIndex.entries()){if(e>=i&&e<i+l.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-i};i+=l.bands.length}break;default:throw new Rc(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,o=-1/0;const l=[],d=new Set;for(const f of e){const{blockIndex:y}=this.getBlockForBand(f);if(y<0)throw new Rc(`Invalid band: ${JSON.stringify(f)}`);const x=this.dataIndex[y];l.includes(y)||l.push(y),d.add(y),i=Math.min(i,x.firstByte),o=Math.max(o,x.lastByte)}if(d.size>this.cacheSize)throw new Rc(`Number of blocks to decode (${d.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:o,blockIndices:l}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:o}=this.getBlockForBand(e);if(i<0)throw new Rc(`Band not found: ${JSON.stringify(e)}`);const l=this._decodedBlocks.get(i.toString());if(!l)throw new Rc(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const d=this.dataIndex[i],f=this.bandShape.reduce((T,M)=>T*M,1),y=o*f,x=l.subarray(y,y+f);return{data:x,bytes:new Uint8Array(x.buffer).subarray(x.byteOffset,x.byteOffset+x.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:d.offset,scale:d.scale}}}$v.setPbf=function(n){qx=n};class LT{constructor(e,i,o){this.tasks=e,this._onCancel=i,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}$v.performDecoding=function(n,e){const i=new Uint8Array(n);return Promise.all(e.tasks.map(o=>{const{layerName:l,firstByte:d,lastByte:f,pixelFormat:y,blockShape:x,blockIndex:T,filters:M,codec:R}=o,D=i.subarray(d,f+1),B=new Uint32Array(x[0]*x[1]*x[2]);let F;if(R!=="gzip_data")throw new Rc(`Unhandled codec: ${R}`);return F=function(q,J){if(!globalThis.DecompressionStream&&J==="gzip_data")return Promise.resolve(((X=function(_e){_e[0]==31&&_e[1]==139&&_e[2]==8||Du(6,"invalid gzip data");var ze=_e[3],Ne=10;4&ze&&(Ne+=2+(_e[10]|_e[11]<<8));for(var Ue=(ze>>3&1)+(ze>>4&1);Ue>0;Ue-=!_e[Ne++]);return Ne+(2&ze)}(ce=q))+8>ce.length&&Du(6,"invalid gzip data"),function(_e,ze,Ne,Ue){var qe=_e.length;if(!qe||ze.f&&!ze.l)return Ne||new Ul(0);var ot=!Ne,St=ot||ze.i!=2,gt=ze.i;ot&&(Ne=new Ul(3*qe));var xt,Rt,nt=function(Or){var fr=Ne.length;if(Or>fr){var ar=new Ul(Math.max(2*fr,Or));ar.set(Ne),Ne=ar}},yt=ze.f||0,it=ze.p||0,rt=ze.b||0,Dt=ze.l,Ot=ze.d,hi=ze.m,ti=ze.n,Gt=8*qe;do{if(!Dt){yt=Iu(_e,it,1);var It=Iu(_e,it+1,3);if(it+=3,!It){var ji=_e[(me=4+((it+7)/8|0))-4]|_e[me-3]<<8,si=me+ji;if(si>qe){gt&&Du(0);break}St&&nt(rt+ji),Ne.set(_e.subarray(me,si),rt),ze.b=rt+=ji,ze.p=it=8*si,ze.f=yt;continue}if(It==1)Dt=XR,Ot=WR,hi=9,ti=5;else if(It==2){var li=Iu(_e,it,31)+257,Oi=Iu(_e,it+10,15)+4,qi=li+Iu(_e,it+5,31)+1;it+=14;for(var $i=new Ul(qi),en=new Ul(19),Qi=0;Qi<Oi;++Qi)en[qR[Qi]]=Iu(_e,it+3*Qi,7);it+=3*Oi;var Xi=Gx(en),Kn=(1<<Xi)-1,sr=iy(en,Xi);for(Qi=0;Qi<qi;){var me,xe=sr[Iu(_e,it,Kn)];if(it+=15&xe,(me=xe>>4)<16)$i[Qi++]=me;else{var ct=0,Ft=0;for(me==16?(Ft=3+Iu(_e,it,3),it+=2,ct=$i[Qi-1]):me==17?(Ft=3+Iu(_e,it,7),it+=3):me==18&&(Ft=11+Iu(_e,it,127),it+=7);Ft--;)$i[Qi++]=ct}}var qt=$i.subarray(0,li),Ht=$i.subarray(li);hi=Gx(qt),ti=Gx(Ht),Dt=iy(qt,hi),Ot=iy(Ht,ti)}else Du(1);if(it>Gt){gt&&Du(0);break}}St&&nt(rt+131072);for(var ui=(1<<hi)-1,Ii=(1<<ti)-1,hn=it;;hn=it){var dn=(ct=Dt[Hx(_e,it)&ui])>>4;if((it+=15&ct)>Gt){gt&&Du(0);break}if(ct||Du(2),dn<256)Ne[rt++]=dn;else{if(dn==256){hn=it,Dt=null;break}var Wi=dn-254;dn>264&&(Wi=Iu(_e,it,(1<<(fn=ET[Qi=dn-257]))-1)+RT[Qi],it+=fn);var Hn=Ot[Hx(_e,it)&Ii],rr=Hn>>4;if(Hn||Du(3),it+=15&Hn,Ht=ZR[rr],rr>3){var fn=AT[rr];Ht+=Hx(_e,it)&(1<<fn)-1,it+=fn}if(it>Gt){gt&&Du(0);break}St&&nt(rt+131072);var Cr=rt+Wi;if(rt<Ht){var lr=0-Ht,Vn=Math.min(Ht,Cr);for(lr+rt<0&&Du(3);rt<Vn;++rt)Ne[rt]=(void 0)[lr+rt]}for(;rt<Cr;++rt)Ne[rt]=Ne[rt-Ht]}}ze.l=Dt,ze.p=hn,ze.b=rt,ze.f=yt,Dt&&(yt=1,ze.m=hi,ze.d=Ot,ze.n=ti)}while(!yt);return rt!=Ne.length&&ot?(xt=Ne,((Rt=rt)==null||Rt>xt.length)&&(Rt=xt.length),new Ul(xt.subarray(0,Rt))):Ne.subarray(0,rt)}(ce.subarray(X,-8),{i:2},new Ul(((te=ce)[(he=te.length)-4]|te[he-3]<<8|te[he-2]<<16|te[he-1]<<24)>>>0))));var te,he,ce,X;const re=JR[J];if(!re)throw new Error(`Unhandled codec: ${J}`);const ue=new globalThis.DecompressionStream(re);return new Response(new Blob([q]).stream().pipeThrough(ue)).arrayBuffer().then(_e=>new Uint8Array(_e))}(D,R).then(q=>(function(J,te){J.readFields(FR,te)}(new qx(q),B),new tI[y](B.buffer))),F.then(q=>{for(let J=M.length-1;J>=0;J--)switch(M[J]){case"delta_filter":UR(q,x);break;case"zigzag_filter":VR(q);break;case"bitshuffle_filter":GR(q,y);break;default:throw new Rc(`Unhandled filter "${M[J]}"`)}return{layerName:l,blockIndex:T,data:q}}).catch(q=>{throw q})}))},Wt(LT,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Wt($v,"MapboxRasterTile"),Wt(PT,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let ry,$x,zu,Dg,Zx,zg=null;function OT(){return Gn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:$x||Wr.DRACO_URL}function kT(){if(Gn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Dg)return Dg;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Dg=WebAssembly.validate(n)?Wr.MESHOPT_SIMD_URL:Wr.MESHOPT_URL,Dg}const Zv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},iI={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},ay={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function NT(n,e,i){const o=i.json.bufferViews.length,l=i.buffers.length;e.bufferView=o,i.json.bufferViews[o]={buffer:l,byteLength:n.byteLength},i.buffers[l]=n}const Xx="KHR_draco_mesh_compression";function nI(n,e){const i=n.extensions&&n.extensions[Xx];if(!i)return;const o=new zu.Decoder,l=UT(e,i.bufferView),d=new zu.Mesh;if(!o.DecodeArrayToMesh(l,l.byteLength,d))throw new Error("Failed to decode Draco mesh");const f=e.json.accessors[n.indices],y=Zv[f.componentType],x=f.count*y.BYTES_PER_ELEMENT,T=zu._malloc(x);y===Uint16Array?o.GetTrianglesUInt16Array(d,x,T):o.GetTrianglesUInt32Array(d,x,T),NT(zu.memory.buffer.slice(T,T+x),f,e),zu._free(T);for(const M of Object.keys(i.attributes)){const R=o.GetAttributeByUniqueId(d,i.attributes[M]),D=e.json.accessors[n.attributes[M]],B=iI[D.componentType],F=D.count*ay[D.type]*Zv[D.componentType].BYTES_PER_ELEMENT,q=zu._malloc(F);o.GetAttributeDataArrayForAllPoints(d,R,zu[B],F,q),NT(zu.memory.buffer.slice(q,q+F),D,e),zu._free(q)}o.destroy(),d.destroy(),delete n.extensions[Xx]}const Xv="EXT_meshopt_compression";function rI(n,e){if(!n.extensions||!n.extensions[Xv])return;const i=n.extensions[Xv],o=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),l=new Uint8Array(i.count*i.byteStride);Zx.decodeGltfBuffer(l,i.count,i.byteStride,o,i.mode,i.filter),n.buffer=e.buffers.length,n.byteOffset=0,e.buffers[n.buffer]=l.buffer,delete n.extensions[Xv]}const BT=1179937895,FT=new TextDecoder("utf8");function jT(n,e){return new URL(n,e).href}function aI(n,e,i,o){return fetch(jT(n.uri,o)).then(l=>l.arrayBuffer()).then(l=>{e.buffers[i]=l})}function UT(n,e){const i=n.json.bufferViews[e];return new Uint8Array(n.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function oI(n,e,i,o){if(n.uri){const l=jT(n.uri,o);return fetch(l).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{e.images[i]=d})}if(n.bufferView!==void 0){const l=UT(e,n.bufferView),d=new Blob([l],{type:n.mimeType});return createImageBitmap(d).then(f=>{e.images[i]=f})}}function VT(n,e=0,i){const o={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===BT){const M=new Uint32Array(n,e);let R=2;const D=(M[R++]>>2)-3,B=M[R++]>>2;if(R++,o.json=JSON.parse(FT.decode(M.subarray(R,R+B))),R+=B,R<D){const F=M[R++];R++;const q=e+(R<<2);o.buffers[0]=n.slice(q,q+F)}}else o.json=JSON.parse(FT.decode(new Uint8Array(n,e)));const{buffers:l,images:d,meshes:f,extensionsUsed:y,bufferViews:x}=o.json;let T=Promise.resolve();if(l){const M=[];for(let R=0;R<l.length;R++){const D=l[R];D.uri?M.push(aI(D,o,R,i)):o.buffers[R]||(o.buffers[R]=null)}T=Promise.all(M)}return T.then(()=>{const M=[],R=y&&y.includes(Xx),D=y&&y.includes(Xv);if(R&&M.push(function(){if(!zu)return ry??(ry=function(B){let F,q=null;function J(){F=new Uint8Array(q.buffer)}function te(){throw new Error("Unexpected Draco error.")}const he={a:{a:te,d:function(ce,X,re){return F.copyWithin(ce,X,X+re)},c:function(ce){const X=F.length,re=Math.max(ce>>>0,Math.ceil(1.2*X)),ue=Math.ceil((re-X)/65536);try{return q.grow(ue),J(),!0}catch{return!1}},b:te}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(B,he):B.then(ce=>ce.arrayBuffer()).then(ce=>WebAssembly.instantiate(ce,he))).then(ce=>{const{Rb:X,Qb:re,P:ue,T:_e,X:ze,Ja:Ne,La:Ue,Qa:qe,Va:ot,Wa:St,eb:gt,jb:xt,f:Rt,e:nt,yb:yt,zb:it,Ab:rt,Bb:Dt,Db:Ot,Gb:hi}=ce.instance.exports;q=nt;const ti=(()=>{let Gt=0,It=0,ji=0,si=0;return li=>{ji&&(X(si),X(Gt),It+=ji,ji=Gt=0),Gt||(It+=128,Gt=re(It));const Oi=li.length+7&-8;let qi=Gt;Oi>=It&&(ji=Oi,qi=si=re(Oi));for(let $i=0;$i<li.length;$i++)F[qi+$i]=li[$i];return qi}})();return J(),Rt(),{memory:nt,_free:X,_malloc:re,Mesh:class{constructor(){this.ptr=ue()}destroy(){_e(this.ptr)}},Decoder:class{constructor(){this.ptr=Ne()}destroy(){xt(this.ptr)}DecodeArrayToMesh(Gt,It,ji){const si=ti(Gt),li=Ue(this.ptr,si,It,ji.ptr);return!!ze(li)}GetAttributeByUniqueId(Gt,It){return{ptr:qe(this.ptr,Gt.ptr,It)}}GetTrianglesUInt16Array(Gt,It,ji){ot(this.ptr,Gt.ptr,It,ji)}GetTrianglesUInt32Array(Gt,It,ji){St(this.ptr,Gt.ptr,It,ji)}GetAttributeDataArrayForAllPoints(Gt,It,ji,si,li){gt(this.ptr,Gt.ptr,It.ptr,ji,si,li)}},DT_INT8:yt(),DT_UINT8:it(),DT_INT16:rt(),DT_UINT16:Dt(),DT_UINT32:Ot(),DT_FLOAT32:hi()}})}(fetch(OT())),ry.then(B=>{zu=B,ry=void 0}))}()),D&&M.push(function(){if(Zx)return;const B=function(F){let q;const J=WebAssembly.instantiateStreaming(F,{}).then(ce=>{q=ce.instance,q.exports.__wasm_call_ctors()}),te={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},he={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:J,supported:!0,decodeGltfBuffer(ce,X,re,ue,_e,ze){(function(Ne,Ue,qe,ot,St,gt,xt){const Rt=Ne.exports.sbrk,nt=ot+3&-4,yt=Rt(nt*St),it=Rt(gt.length),rt=new Uint8Array(Ne.exports.memory.buffer);rt.set(gt,it);const Dt=Ue(yt,ot,St,it,gt.length);if(Dt===0&&xt&&xt(yt,nt,St),qe.set(rt.subarray(yt,yt+ot*St)),Rt(yt-Rt(0)),Dt!==0)throw new Error(`Malformed buffer data: ${Dt}`)})(q,q.exports[he[_e]],ce,X,re,ue,q.exports[te[ze]])}}}(fetch(kT()));return B.ready.then(()=>{Zx=B})}()),d)for(let B=0;B<d.length;B++)M.push(oI(d[B],o,B,i));return(M.length?Promise.all(M):Promise.resolve()).then(()=>{if(R&&f)for(const{primitives:B}of f)for(const F of B)nI(F,o);if(D&&f&&x)for(const B of x)rI(B,o);return o})})}function ym(n,e){const i=n.json.bufferViews[e.bufferView],o=Zv[e.componentType];return new o(n.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==ay[e.type]*o.BYTES_PER_ELEMENT?i.byteStride/o.BYTES_PER_ELEMENT:ay[e.type]))}function Wx(n,e,i,o){const l=Zv[e.componentType],d=function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(l),f=n.json.bufferViews[e.bufferView],y=f.byteStride?f.byteStride/l.BYTES_PER_ELEMENT:ay[e.type],x=i.float32,T=x.length/i.capacity;for(let M=0,R=0;M<e.count*y;M+=y,R+=T)for(let D=0;D<T;D++)x[R+D]=o[M+D]*d;i._trim()}function sI(n,e,i){const o=n.indices,l=n.attributes,d={};d.indexArray=new Pr;const f=e.json.accessors[o],y=f.count/3;d.indexArray.reserve(y);const x=ym(e,f);for(let D=0;D<y;D++)d.indexArray.emplaceBack(x[3*D],x[3*D+1],x[3*D+2]);d.indexArray._trim(),d.vertexArray=new mo;const T=e.json.accessors[l.POSITION];d.vertexArray.reserve(T.count);const M=ym(e,T);for(let D=0;D<T.count;D++)d.vertexArray.emplaceBack(M[3*D],M[3*D+1],M[3*D+2]);if(d.vertexArray._trim(),d.aabb=new Un(T.min,T.max),d.centroid=function(D,B){const F=[0,0,0],q=D.length;if(q>0){for(let J=0;J<q;J++){const te=3*D[J];F[0]+=B[te],F[1]+=B[te+1],F[2]+=B[te+2]}F[0]/=q,F[1]/=q,F[2]/=q}return F}(x,M),l.COLOR_0!==void 0){const D=e.json.accessors[l.COLOR_0],B=ay[D.type],F=ym(e,D);d.colorArray=B===3?new mo:new Hs,d.colorArray.resize(D.count),Wx(e,D,d.colorArray,F)}if(l.NORMAL!==void 0){d.normalArray=new mo;const D=e.json.accessors[l.NORMAL];d.normalArray.resize(D.count);const B=ym(e,D);Wx(e,D,d.normalArray,B)}if(l.TEXCOORD_0!==void 0&&i.length>0){d.texcoordArray=new yc;const D=e.json.accessors[l.TEXCOORD_0];d.texcoordArray.resize(D.count);const B=ym(e,D);Wx(e,D,d.texcoordArray,B)}if(l._FEATURE_ID_RGBA4444!==void 0){const D=e.json.accessors[l._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=ym(e,D))}l._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(ym(e,e.json.accessors[l._FEATURE_RGBA4444]).buffer));const R=n.material;return d.material=function(D,B){const{emissiveFactor:F=[0,0,0],alphaMode:q="OPAQUE",alphaCutoff:J=.5,normalTexture:te,occlusionTexture:he,emissiveTexture:ce,doubleSided:X}=D,{baseColorFactor:re=[1,1,1,1],metallicFactor:ue=1,roughnessFactor:_e=1,baseColorTexture:ze,metallicRoughnessTexture:Ne}=D.pbrMetallicRoughness||{},Ue=he?B[he.index]:void 0;if(he&&he.extensions&&he.extensions.KHR_texture_transform&&Ue){const qe=he.extensions.KHR_texture_transform;Ue.offsetScale=[qe.offset[0],qe.offset[1],qe.scale[0],qe.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Cn(...re),metallicFactor:ue,roughnessFactor:_e,baseColorTexture:ze?B[ze.index]:void 0,metallicRoughnessTexture:Ne?B[Ne.index]:void 0},doubleSided:X,emissiveFactor:F,alphaMode:q,alphaCutoff:J,normalTexture:te?B[te.index]:void 0,occlusionTexture:Ue,emissionTexture:ce?B[ce.index]:void 0,defined:D.defined===void 0}}(R!==void 0?e.json.materials[R]:{defined:!1},i),d}function GT(n,e,i){const{matrix:o,rotation:l,translation:d,scale:f,mesh:y,extras:x,children:T}=n,M={};if(M.matrix=o||function(R,D,B,F){var q=D[0],J=D[1],te=D[2],he=D[3],ce=q+q,X=J+J,re=te+te,ue=q*ce,_e=q*X,ze=q*re,Ne=J*X,Ue=J*re,qe=te*re,ot=he*ce,St=he*X,gt=he*re,xt=F[0],Rt=F[1],nt=F[2];return R[0]=(1-(Ne+qe))*xt,R[1]=(_e+gt)*xt,R[2]=(ze-St)*xt,R[3]=0,R[4]=(_e-gt)*Rt,R[5]=(1-(ue+qe))*Rt,R[6]=(Ue+ot)*Rt,R[7]=0,R[8]=(ze+St)*nt,R[9]=(Ue-ot)*nt,R[10]=(1-(ue+Ne))*nt,R[11]=0,R[12]=B[0],R[13]=B[1],R[14]=B[2],R[15]=1,R}([],l||[0,0,0,1],d||[0,0,0],f||[1,1,1]),y!==void 0){M.meshes=i[y];const R=M.anchor=[0,0];for(const D of M.meshes){const{min:B,max:F}=D.aabb;R[0]+=B[0]+F[0],R[1]+=B[1]+F[1]}R[0]=Math.floor(R[0]/M.meshes.length/2),R[1]=Math.floor(R[1]/M.meshes.length/2)}if(x&&(x.id&&(M.id=x.id),x.lights&&(M.lights=function(R){if(!R.length)return[];const D=function(te){const he=atob(te),ce=new Uint8Array(he.length);for(let X=0;X<he.length;X++)ce[X]=he.codePointAt(X);return ce}(R),B=[],F=D.length/24,q=new Uint16Array(D.buffer),J=new Float32Array(D.buffer);for(let te=0;te<F;te++){const he=q[2*te*6]/30,ce=q[2*te*6+1]/30,X=q[2*te*6+10]/100,re=J[6*te+1],ue=J[6*te+2],_e=J[6*te+3],ze=J[6*te+4],Ne=_e-re,Ue=ze-ue,qe=Math.hypot(Ne,Ue);B.push({pos:[re+.5*Ne,ue+.5*Ue,ce],normal:[Ue/qe,-Ne/qe,0],width:qe,height:he,depth:X,points:[re,ue,_e,ze]})}return B}(x.lights))),T){const R=[];for(const D of T)R.push(GT(e.json.nodes[D],e,i));M.children=R}return M}function lI(n){if(n.vertices.length===0||n.indices.length===0)return null;const e=new wh(n.vertices,n.indices,8,256),[i,o]=[e.min.clone(),e.max.clone()];return{vertices:n.vertices,indices:n.indices,grid:e,min:i,max:o}}function cI(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const o=[];for(const f of i){if(!Array.isArray(f)||f.length!==2)continue;const y=f[0],x=f[1];typeof y=="number"&&typeof x=="number"&&o.push(new Bt(y,x))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let l=0;for(let f=0;f<o.length;f++){const y=o[f],x=o[(f+1)%o.length],T=o[(f+2)%o.length];l+=(y.x-x.x)*(T.y-x.y)-(T.x-x.x)*(y.y-x.y)}l>0&&o.reverse();const d=Yp(o.flatMap(f=>[f.x,f.y]),[]);return d.length===0?null:{vertices:o,indices:d}}function uI(n,e){const i=[],o=[];let l=0;const d=[];for(const f of n){l=i.length;const y=f.vertexArray.float32,x=f.indexArray.uint16;for(let T=0;T<f.vertexArray.length;T++)d[0]=y[3*T+0],d[1]=y[3*T+1],d[2]=y[3*T+2],Vi(d,d,e),i.push(new Bt(d[0],d[1]));for(let T=0;T<3*f.indexArray.length;T++)o.push(x[T]+l)}if(o.length%3!=0)return null;for(let f=0;f<o.length;f+=3){const y=i[o[f+0]],x=i[o[f+1]],T=i[o[f+2]];(y.x-x.x)*(T.y-x.y)-(T.x-x.x)*(y.y-x.y)>0&&([o[f+1],o[f+2]]=[o[f+2],o[f+1]])}return{vertices:i,indices:o}}function HT(n){const e=function(x,T){const M=[],R=WebGL2RenderingContext;if(x.json.textures)for(const D of x.json.textures){const B={magFilter:R.LINEAR,minFilter:R.NEAREST,wrapS:R.REPEAT,wrapT:R.REPEAT};D.sampler!==void 0&&Object.assign(B,x.json.samplers[D.sampler]),M.push({image:T[D.source],sampler:B,uploaded:!1})}return M}(n,n.images),i=function(x,T){const M=[];for(const R of x.json.meshes){const D=[];for(const B of R.primitives)D.push(sI(B,x,T));M.push(D)}return M}(n,e),{scenes:o,scene:l,nodes:d}=n.json,f=o?o[l||0].nodes:d,y=[];for(const x of f)y.push(GT(d[x],n,i));return function(x,T,M){const R={},D=new Set;for(let B=0;B<x.length;B++){const F=M[T[B]];if(!F.extras)continue;const q=F.extras["mapbox:footprint:version"],J=F.extras["mapbox:footprint:id"];(q||J)&&D.add(B),q==="1.0.0"&&J&&(R[J]=B)}for(let B=0;B<x.length;B++){if(D.has(B))continue;const F=x[B],q=M[T[B]];if(!q.extras)continue;let J=null;F.id in R&&(J=uI(x[R[F.id]].meshes,F.matrix)),J||(J=cI(q)),J&&(F.footprint=lI(J))}if(D.size>0){const B=Array.from(D.values()).sort((F,q)=>F-q);for(let F=B.length-1;F>=0;F--)x.splice(B[F],1)}}(y,f,n.json.nodes),y}function hI(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,i=n.aabb.min[0]-1,o=n.aabb.min[1]-1,l=mm/(n.aabb.max[0]-i+2),d=mm/(n.aabb.max[1]-o+2);for(let f=0;f<e.length;f+=3){const y=e[f+2],x=(e[f+0]-i)*l|0,T=(e[f+1]-o)*d|0;y>n.heightmap[T*mm+x]&&(n.heightmap[T*mm+x]=y)}}function dI(n,e){const i={};i.indexArray=new Pr,i.indexArray.reserve(4*n.length),i.vertexArray=new mo,i.vertexArray.reserve(10*n.length),i.colorArray=new Hs,i.vertexArray.reserve(10*n.length);let o=0;for(const f of n){const y=Math.min(10,Math.max(4,1.3*f.height))*e,x=[-f.normal[1],f.normal[0],0],T=Math.min(.29,.1*f.width/f.depth),M=f.width-2*f.depth*e*(T+.01),R=zt([],f.pos,x,M/2),D=zt([],f.pos,x,-M/2),B=[R[0],R[1],R[2]+f.height],F=[D[0],D[1],D[2]+f.height],q=zt([],f.normal,x,T);Fe(q,q,y);const J=zt([],f.normal,x,-T);Fe(J,J,y),yi(q,R,q),yi(J,D,J),R[2]+=.1,D[2]+=.1,i.vertexArray.emplaceBack(q[0],q[1],q[2]),i.vertexArray.emplaceBack(J[0],J[1],J[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(D[0],D[1],D[2]),i.vertexArray.emplaceBack(B[0],B[1],B[2]),i.vertexArray.emplaceBack(F[0],F[1],F[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(D[0],D[1],D[2]),i.vertexArray.emplaceBack(q[0],q[1],q[2]),i.vertexArray.emplaceBack(J[0],J[1],J[2]);const te=M/y/2;i.colorArray.emplaceBack(-te-T,-1,te,.8),i.colorArray.emplaceBack(te+T,-1,te,.8),i.colorArray.emplaceBack(-te,0,te,1.3),i.colorArray.emplaceBack(te,0,te,1.3),i.colorArray.emplaceBack(te+T,-.8,te,.7),i.colorArray.emplaceBack(te+T,-.8,te,.7),i.colorArray.emplaceBack(0,0,te,1.3),i.colorArray.emplaceBack(0,0,te,1.3),i.colorArray.emplaceBack(te+T,-1.2,te,.8),i.colorArray.emplaceBack(te+T,-1.2,te,.8),i.indexArray.emplaceBack(6+o,4+o,8+o),i.indexArray.emplaceBack(7+o,9+o,5+o),i.indexArray.emplaceBack(0+o,1+o,2+o),i.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}const l={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=Cn.white,l.pbrMetallicRoughness=d,i.material=l,i.aabb=new Un([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class qT{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const fI=["id","tile","layer","source","sourceLayer","state"];class Pg{constructor(e,i,o,l,d){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=o,this._y=l,this.properties=e.properties,this.id=d}clone(){const e=new Pg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of fI)this[i]!==void 0&&(e[i]=this[i]);return e}}class $T{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new hh(Ut,16,0),this.featureIndexArray=new Fp,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,o,l,d,f=0,y=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,l,d,f);const T=this.grid;for(let M=0;M<i.length;M++){const R=i[M],D=[1/0,1/0,-1/0,-1/0];for(let B=0;B<R.length;B++){const F=R[B];D[0]=Math.min(D[0],F.x),D[1]=Math.min(D[1],F.y),D[2]=Math.max(D[2],F.x),D[3]=Math.max(D[3],F.y)}y!==0&&(D[0]-=y,D[1]-=y,D[2]+=y,D[3]+=y),D[0]<Ut&&D[1]<Ut&&D[2]>=0&&D[3]>=0&&T.insert(x,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ec.VectorTile(new pv(this.rawTileData)).layers,this.sourceLayerCoder=new qT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:o,transform:l,tileTransform:d,pixelPosMatrix:f,availableImages:y}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const x=o.bufferedTilespaceBounds,T=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(B,F,q,J)=>Pn(o.bufferedTilespaceGeometry,B,F,q,J));T.sort(pI);let M=null;l.elevation&&T.length>0&&(M=Mg.create(l.elevation,this.tileID));const R={};let D;for(let B=0;B<T.length;B++){const F=T[B];if(F===D)continue;D=F;const q=this.featureIndexArray.get(F);let J=null;this.is3DTile?this.loadMatchingModelFeature(R,q,e,o,l):this.loadMatchingFeature(R,q,e,y,(te,he,ce,X=0)=>(J||(J=Qt(te,this.tileID.canonical,d)),he.queryIntersectsFeature(o,te,ce,J,this.z,l,f,M,X)))}return R}loadMatchingFeature(e,i,o,l,d){const{featureIndex:f,bucketIndex:y,sourceLayerIndex:x,layoutVertexArrayOffset:T}=i,M=this.bucketLayerIDs[y],R=o.layers,D=Object.keys(R);if(D.length&&!function(te,he){for(let ce=0;ce<te.length;ce++)if(he.indexOf(te[ce])>=0)return!0;return!1}(D,M))return;const B=o.sourceCache,F=this.sourceLayerCoder.decode(x),q=this.vtLayers[F].feature(f),J=this.getId(q,F);for(let te=0;te<M.length;te++){const he=M[te];if(!R[he])continue;const{styleLayer:ce,targets:X}=R[he];let re={};J!==void 0&&(re=B.getFeatureState(ce.sourceLayer,J));const ue=!d||d(q,ce,re,T);if(!ue)continue;const _e=new Pg(q,this.z,this.x,this.y,J);_e.tile=this.tileID.canonical,_e.state=re;let ze=this.serializedLayersCache.get(he);ze||(ze=ce.serialize(),ze.id=he,this.serializedLayersCache.set(he,ze)),_e.source=ze.source,_e.sourceLayer=ze["source-layer"],_e.layer=Ve({},ze),_e.layer.paint=ZT(ze.paint,ce.paint,q,re,l),_e.layer.layout=ZT(ze.layout,ce.layout,q,re,l);let Ne=!1;for(const Ue of X){this.updateFeatureProperties(_e,Ue);const{filter:qe}=Ue;if(qe){if(q.properties=_e.properties,qe.needGeometry){const ot=ai(q,!0);if(!qe.filter(new Fn(this.tileID.overscaledZ),ot,this.tileID.canonical))continue}else if(!qe.filter(new Fn(this.tileID.overscaledZ),q))continue}Ne=!0,Ue.targetId&&this.addFeatureVariant(_e,Ue)}Ne&&this.appendToResult(e,he,f,_e,ue)}}loadMatchingModelFeature(e,i,o,l,d){const f=this.bucketLayerIDs[0][0],y=o.layers;if(!y[f])return;const{styleLayer:x,targets:T}=y[f];if(x.type!=="model")return;const M=l.tile,R=i.featureIndex,D=M.getBucket(x);if(!(D&&D instanceof Nv))return;const B=function(ze,Ne,Ue,qe){const ot=ze.getNodesInfo()[Ne];if(ot.hiddenByReplacement||!ot.node.meshes)return;let St=Number.MAX_VALUE;const gt=ot.node,xt=Ue.tile,Rt=qe.calculatePosMatrix(xt.tileID.toUnwrapped(),qe.worldSize),nt=ot.evaluatedScale;let yt=0;qe.elevation&&gt.elevation&&(yt=gt.elevation*qe.elevation.exaggeration()),Be(Rt,Rt,[(gt.anchor?gt.anchor[0]:0)*(nt[0]-1),(gt.anchor?gt.anchor[1]:0)*(nt[1]-1),yt]),je(Rt,Rt,nt);const it=Ue.queryGeometry,rt=it.isPointQuery()?it.screenBounds:it.screenGeometry,Dt=function(hi){const ti=Oe([],Rt,hi.matrix);Oe(ti,qe.expandedFarZProjMatrix,ti);for(let Gt=0;Gt<hi.meshes.length;++Gt){const It=hi.meshes[Gt];if(Gt===hi.lightMeshIndex)continue;const ji=$w(rt,qe,ti,It.aabb);ji!=null&&(St=Math.min(ji,St))}if(hi.children)for(const Gt of hi.children)Dt(Gt)};if(Dt(gt),St===Number.MAX_VALUE)return;const Ot=new K(0,0);return nT(xt.tileID.canonical,Ot,ot.node.anchor[0],ot.node.anchor[1]),{intersectionZ:St,position:Ot,feature:ot.feature}}(D,R,l,d);if(!B)return;const{z:F,x:q,y:J}=M.tileID.canonical,{feature:te,intersectionZ:he,position:ce}=B;let X={};te.id!==void 0&&(X=o.sourceCache.getFeatureState(x.sourceLayer,te.id));const re=new Pg({},F,q,J,te.id);re.tile=this.tileID.canonical,re.state=X,re.properties=te.properties,re.geometry={type:"Point",coordinates:[ce.lng,ce.lat]};let ue=this.serializedLayersCache.get(f);ue||(ue=x.serialize(),ue.id=f,this.serializedLayersCache.set(f,ue)),re.source=ue.source,re.sourceLayer=ue["source-layer"],re.layer=Ve({},ue);let _e=!1;for(const ze of T){this.updateFeatureProperties(re,ze);const{filter:Ne}=ze;if(Ne){if(te.properties=re.properties,Ne.needGeometry){if(!Ne.filter(new Fn(this.tileID.overscaledZ),te,this.tileID.canonical))continue}else if(!Ne.filter(new Fn(this.tileID.overscaledZ),te))continue}_e=!0,ze.targetId&&this.addFeatureVariant(re,ze)}_e&&this.appendToResult(e,f,R,re,he)}updateFeatureProperties(e,i,o){if(i.properties){const l={};for(const d in i.properties){const f=i.properties[d].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,o);f!=null&&(l[d]=f)}e.properties=l}}addFeatureVariant(e,i,o){const l={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(l.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(l)}appendToResult(e,i,o,l,d){let f=e[i];f===void 0&&(f=e[i]=[]),f.push({featureIndex:o,feature:l,intersectionZ:d})}lookupSymbolFeatures(e,i,o,l,d){const f={};this.loadVTLayers();for(const y of e)this.loadMatchingFeature(f,{bucketIndex:i,sourceLayerIndex:o,featureIndex:y,layoutVertexArrayOffset:0},l,d);return f}loadFeature(e){const{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(o),d=this.vtFeatures[l];if(d[i])return d[i];const f=this.vtLayers[l].feature(i);return d[i]=f,f}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;if(this.promoteId){const l=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(l!=null)if(Array.isArray(l)){if(!this.promoteIdExpression){const d=Nn(l);if(d.result!=="success"){const f=d.value.map(y=>`${y.key}: ${y.message}`).join(", ");return void Ui(`Failed to create expression for promoteId: ${f}`)}this.promoteIdExpression=d.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new $u),o=this.promoteIdExpression.evaluate({zoom:0},e)}else o=e.properties[l];typeof o=="boolean"&&(o=Number(o))}return o}}function ZT(n,e,i,o,l){return mi(n,(d,f)=>{const y=e instanceof fc?e.get(f):null;return y&&y.evaluate?y.evaluate(i,o,void 0,l):y})}function pI(n,e){return e-n}Wt($T,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const XT=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Yx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=o>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const d=XT[15&o];if(!d)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Yx(y,f,d,e)}constructor(e,i=64,o=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=XT.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${o}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+y+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Kx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:f,nodeSize:y}=this,x=[0,d.length-1,0],T=[];for(;x.length;){const M=x.pop()||0,R=x.pop()||0,D=x.pop()||0;if(R-D<=y){for(let J=D;J<=R;J++){const te=f[2*J],he=f[2*J+1];te>=e&&te<=o&&he>=i&&he<=l&&T.push(d[J])}continue}const B=D+R>>1,F=f[2*B],q=f[2*B+1];F>=e&&F<=o&&q>=i&&q<=l&&T.push(d[B]),(M===0?e<=F:i<=q)&&(x.push(D),x.push(B-1),x.push(1-M)),(M===0?o>=F:l>=q)&&(x.push(B+1),x.push(R),x.push(1-M))}return T}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:d,nodeSize:f}=this,y=[0,l.length-1,0],x=[],T=o*o;for(;y.length;){const M=y.pop()||0,R=y.pop()||0,D=y.pop()||0;if(R-D<=f){for(let J=D;J<=R;J++)YT(d[2*J],d[2*J+1],e,i)<=T&&x.push(l[J]);continue}const B=D+R>>1,F=d[2*B],q=d[2*B+1];YT(F,q,e,i)<=T&&x.push(l[B]),(M===0?e-o<=F:i-o<=q)&&(y.push(D),y.push(B-1),y.push(1-M)),(M===0?e+o>=F:i+o>=q)&&(y.push(B+1),y.push(R),y.push(1-M))}return x}}function Kx(n,e,i,o,l,d){if(l-o<=i)return;const f=o+l>>1;WT(n,e,f,o,l,d),Kx(n,e,i,o,f-1,1-d),Kx(n,e,i,f+1,l,1-d)}function WT(n,e,i,o,l,d){for(;l>o;){if(l-o>600){const T=l-o+1,M=i-o+1,R=Math.log(T),D=.5*Math.exp(2*R/3),B=.5*Math.sqrt(R*D*(T-D)/T)*(M-T/2<0?-1:1);WT(n,e,i,Math.max(o,Math.floor(i-M*D/T+B)),Math.min(l,Math.floor(i+(T-M)*D/T+B)),d)}const f=e[2*i+d];let y=o,x=l;for(oy(n,e,o,i),e[2*l+d]>f&&oy(n,e,o,l);y<x;){for(oy(n,e,y,x),y++,x--;e[2*y+d]<f;)y++;for(;e[2*x+d]>f;)x--}e[2*o+d]===f?oy(n,e,o,x):(x++,oy(n,e,x,l)),x<=i&&(o=x+1),i<=x&&(l=x-1)}}function oy(n,e,i,o){Qx(n,i,o),Qx(e,2*i,2*o),Qx(e,2*i+1,2*o+1)}function Qx(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function YT(n,e,i,o){const l=n-i,d=e-o;return l*l+d*d}r.$=va,r.A=tl,r.B=ls,r.C=mc,r.D=Cg,r.E=Yl,r.F=2,r.G=V_,r.H=ow,r.I=Co,r.J=class extends Ov{},r.K=Li,r.L=Vh,r.M=Oo,r.N=lh,r.O=js,r.P=Bt,r.Q=ld,r.R=Gu,r.S=Us,r.T=Mx,r.U=pc,r.V=Ov,r.W=oc,r.X=Nn,r.Y=Yu,r.Z=Fr,r._=eu,r.a=function(n){return Wr.API_CDN_URL_REGEX.test(n)},r.a$=Pt,r.a0=jc,r.a1=yd,r.a2=rc,r.a3=sh,r.a4=function(n){const e=n.value;let i=[];if(!e)return i;const o=Li(e);return o!=="string"?(i=i.concat([new Ov(n.key,e,`string expected, "${o}" found`)]),i):(Dx(e,!0)||(i=i.concat([new Ov(n.key,e,`invalid url "${e}"`)])),i)},r.a5=We,r.a6=vf,r.a7=wr,r.a8=Nt,r.a9=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return Dn(n.expression.evaluate(e))}interpolate(n,e,i){return{x:Ti(n.x,e.x,i),y:Ti(n.y,e.y,i),z:Ti(n.z,e.z,i),azimuthal:Ti(n.azimuthal,e.azimuthal,i),polar:Ti(n.polar,e.polar,i)}}},r.aA=la,r.aB=wn,r.aC=pt,r.aD=Me,r.aE=g,r.aF=function(n,e){const i={};for(let o=0;o<e.length;o++){const l=e[o];l in n&&(i[l]=n[l])}return i},r.aG=se,r.aH=Te,r.aI=class{constructor(n){this.entries={},this.scheduler=n}request(n,e,i,o){const l=this.entries[n]=this.entries[n]||{callbacks:[]};if(l.result){const[d,f]=l.result;return this.scheduler?this.scheduler.add(()=>{o(d,f)},e):o(d,f),()=>{}}return l.callbacks.push(o),l.cancel||(l.cancel=i((d,f)=>{l.result=[d,f];for(const y of l.callbacks)this.scheduler?this.scheduler.add(()=>{y(d,f)},e):y(d,f);setTimeout(()=>delete this.entries[n],3e3)})),()=>{l.result||(l.callbacks=l.callbacks.filter(d=>d!==o),l.callbacks.length||(l.cancel(),delete this.entries[n]))}}},r.aJ=function(n,e,i){const o=JSON.stringify(n.request);return n.data&&(this.deduped.entries[o]={result:[null,n.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},l=>{const d=Xl(n.request,(f,y,x,T)=>{f?l(f):y&&l(null,{vectorTile:i?void 0:new Ec.VectorTile(new pv(y)),rawData:y,cacheControl:x,expires:T})});return()=>{d.cancel(),l()}},e)},r.aK=function(n){kh++,kh>ns&&(n.getActor().send("enforceCacheSizeLimit",el),kh=0)},r.aL=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},r.aM=jn,r.aN=Ow,r.aO=Uw,r.aP=Lw,r.aQ=function(n,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<n.length;o++){const l=document.createElement("source");Bh(n[o])||(i.crossOrigin="Anonymous"),l.src=n[o],i.appendChild(l)}return{cancel:()=>{}}},r.aR=Iv,r.aS=function(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>VT(e,0,n))},r.aT=HT,r.aU=class{constructor(n,e,i,o){this.id=n,this.position=e!=null?new K(e[0],e[1]):new K(0,0),this.orientation=i??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new Un([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(n,e){if(Oe(n.matrix,e,n.matrix),n.meshes)for(const i of n.meshes){const o=Un.applyTransformFast(i.aabb,n.matrix);this.aabb.encapsulate(o)}if(n.children)for(const i of n.children)this._applyTransformations(i,n.matrix)}computeBoundsAndApplyParent(){const n=be([]);for(const e of this.nodes)this._applyTransformations(e,n)}computeModelMatrix(n,e,i,o,l,d,f=!1){Qw(this.matrix,this,n.transform,this.position,e,i,o,l,d,f)}upload(n){if(!this.uploaded){for(const e of this.nodes)Px(e,n);for(const e of this.nodes)kv(e);this.uploaded=!0}}destroy(){for(const n of this.nodes)Lx(n)}},r.aV=vi,r.aW=H_,r.aX=Ce,r.aY=Le,r.aZ=gc,r.a_=Pr,r.aa=Fn,r.ab=Yr,r.ac=et,r.ad=Vi,r.ae=Ei,r.af=Pe,r.ag=fc,r.ah=xu,r.ai=Ti,r.aj=Ut,r.ak=Lm,r.al=V,r.am=Cn,r.an=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return function([i,o]){const l=Dn([1,i,o]);return{x:l.x,y:l.y,z:l.z}}(n.expression.evaluate(e))}interpolate(n,e,i){return{x:Ti(n.x,e.x,i),y:Ti(n.y,e.y,i),z:Ti(n.z,e.z,i)}}},r.ao=function(n,e,i=0,o=!0){const l=new Bt(i,i),d=n.sub(l),f=e.add(l),y=[d,new Bt(f.x,d.y),f,new Bt(d.x,f.y)];return o&&y.push(d.clone()),y},r.ap=function(n,e){const i=[];for(let o=0;o<n.length;o++){const l=He(o-1,-1,n.length-1),d=He(o+1,-1,n.length-1),f=n[o],y=n[d],x=n[l].sub(f).unit(),T=y.sub(f).unit(),M=T.angleWithSep(x.x,x.y),R=x.add(T).unit().mult(-1*e/Math.sin(M/2));i.push(f.add(R))}return i},r.aq=xw,r.ar=Pn,r.as=function(n,e,i=0){return fi(((e.x-i)*n.scale-n.x)*Ut,(e.y*n.scale-n.y)*Ut,Qe(e.z,e.y))},r.at=Rn,r.au=Ci,r.av=Jo,r.aw=Ki,r.ax=function(n){let e=1/0,i=1/0,o=-1/0,l=-1/0;for(const d of n)e=Math.min(e,d.x),i=Math.min(i,d.y),o=Math.max(o,d.x),l=Math.max(l,d.y);return{min:new Bt(e,i),max:new Bt(o,l)}},r.ay=Se,r.az=Oe,r.b=function(n){return Wr.API_FONTS_REGEX.test(n)},r.b$=Fe,r.b0=mh,r.b1=Cv,r.b2=function(){fs.isLoading()||fs.isLoaded()||dc()!=="deferred"||Ep()},r.b3=xf,r.b4=ai,r.b5=Pg,r.b6=Yn,r.b7=mt,r.b8=hg,r.b9=Qt,r.bA=function(n,e){const{x:i,y:o}=n.point,l=s_(i,o,n.worldSize/n._pixelsPerMercatorPixel,0,0);return Oe(l,l,Zm(Nl(e)))},r.bB=ie,r.bC=function(n){return n[0]=0,n[1]=0,n[2]=0,n},r.bD=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},r.bE=pi,r.bF=zt,r.bG=ri,r.bH=U_,r.bI=Xs,r.bJ=fx,r.bK=function(n,e,i,o,l){const d=5*e+2;n.float32[d+0]=i,n.float32[d+1]=o,n.float32[d+2]=l},r.bL=Mv,r.bM=s,r.bN=Mi,r.bO=Ia,r.bP=Of,r.bQ=Zw,r.bR=ov,r.bS=z_,r.bT=_x,r.bU=fw,r.bV=dx,r.bW=Yx,r.bX=He,r.bY=Uo,r.bZ=function(n,e,i){i*=.5;var o=e[0],l=e[1],d=e[2],f=e[3],y=Math.sin(i),x=Math.cos(i);return n[0]=o*x+l*y,n[1]=l*x-o*y,n[2]=d*x+f*y,n[3]=f*x-d*y,n},r.b_=Da,r.ba=Vs,r.bb=vc,r.bc=Zs,r.bd=vr,r.be=Yp,r.bf=Sx,r.bg=function(n,e){const i=xu(e.zoom);if(i===0)return Nl(n);const o=$m(n),l=a_(o),d=Se(o.getWest())*e.worldSize,f=Se(o.getEast())*e.worldSize,y=Te(o.getNorth())*e.worldSize,x=Te(o.getSouth())*e.worldSize,T=[d,y,0],M=[f,y,0],R=[d,x,0],D=[f,x,0],B=ke([],e.globeMatrix);return Vi(T,T,B),Vi(M,M,B),Vi(R,R,B),Vi(D,D,B),l[0]=Bl(l[0],R,i),l[1]=Bl(l[1],D,i),l[2]=Bl(l[2],M,i),l[3]=Bl(l[3],T,i),Un.fromPoints(l)},r.bh=zd,r.bi=ke,r.bj=Cf,r.bk=Bl,r.bl=du,r.bm=Bo,r.bn=Tt,r.bo=Be,r.bp=$v,r.bq=pv,r.br=Xl,r.bs=function(n,e){const i=[];for(const o in n)o in e||i.push(o);return i},r.bt=Ye,r.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.bv=Go,r.bw=function(n){var e=new $(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},r.bx=be,r.by=Xe,r.bz=Ie,r.c=ma,r.c$=function(n){return n({pluginStatus:po,pluginURL:Il}),_d.on("pluginStateChange",n),n},r.c0=io,r.c1=sn,r.c2=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},r.c3=ni,r.c4=function(n,e,i,o,l){var d,f=1/Math.tan(e/2);return n[0]=f/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,l!=null&&l!==1/0?(n[10]=(l+o)*(d=1/(o-l)),n[14]=2*l*o*d):(n[10]=-1,n[14]=-2*o),n},r.c5=function(n,e,i,o,l,d,f){var y=1/(e-i),x=1/(o-l),T=1/(d-f);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*T,n[11]=0,n[12]=(e+i)*y,n[13]=(l+o)*x,n[14]=(f+d)*T,n[15]=1,n},r.c6=ge,r.c7=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},r.c8=Qo,r.c9=_s,r.cA=Pv,r.cB=Pi,r.cC=Vw,r.cD=function(n){const e=Vw(n,!0);return ie([],[e[0],e[1],e[4],e[5]])},r.cE=je,r.cF=Ra,r.cG=at,r.cH=function(n){const{x:e,y:i}=n.point,{lng:o,lat:l}=n._center;return s_(e,i,n.worldSize,o,l)},r.cI=jt,r.cJ=W,r.cK=qr,r.cL=v,r.cM=function(n,e,i){let o=0;for(let l=0;l<2;++l)n[l]>0&&(o+=(n[l]-0)*(n[l]-0)),e[l]<0&&(o+=(0-e[l])*(0-e[l]));return o},r.cN=45,r.cO=tf,r.cP=Ae,r.cQ=_h,r.cR=function(n,e,i){const o=Math.sqrt(n*n+e*e+i*i),l=o>0?Math.acos(i/o)*de:0;let d=n!==0||e!==0?Math.atan2(-e,-n)*de+90:0;return d<0&&(d+=360),[o,d,l]},r.cS=fi,r.cT=$e,r.cU=yi,r.cV=Un,r.cW=Dn,r.cX=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},r.cY=Je,r.cZ=Dx,r.c_=function(n,e){return n.readFields(hR,{icons:[]},e)},r.ca=Ko,r.cb=Lr,r.cc=Sd,r.cd=K,r.ce=Ew,r.cf=function(){var n=new $(4);return $!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},r.cg=function(n,e,i){var o=e[0],l=e[1],d=e[2],f=e[3],y=Math.sin(i),x=Math.cos(i);return n[0]=o*x+d*y,n[1]=l*x+f*y,n[2]=o*-y+d*x,n[3]=l*-y+f*x,n},r.ch=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},r.ci=_n,r.cj=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},r.ck=Hr,r.cl=xn,r.cm=Ur,r.cn=Cd,r.co=Gw,r.cp=Zn,r.cq=Fy,r.cr=function(n,e,i,o,l,d,f,y,x){if(x.name==="globe")return Fy(n,e,new Zn(i,o,l),!1);const T=H_({z:i,x:o,y:l},x);return new Un([(d+T.x/T.scale)*e,e*(T.y/T.scale),f],[(d+T.x2/T.scale)*e,e*(T.y2/T.scale),y])},r.cs=function(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n[3]=Math.min(e[3],i[3]),n},r.ct=function(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n[3]=Math.max(e[3],i[3]),n},r.cu=function(n){const e=Math.round((n+45+360)%360/90)%4;return ae[e]},r.cv=Ze,r.cw=kr,r.cx=w,r.cy=function(n){const e=be(new Float64Array(16));Oe(e,n.pixelMatrix,n.globeMatrix);const i=[0,k,0],o=[0,O,0];return Vi(i,i,e),Vi(o,o,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!Rf(n,new K(n.center.lat,90)),o[0]>0&&o[0]<=n.width&&o[1]>0&&o[1]<=n.height&&!Rf(n,new K(n.center.lat,-90))]},r.cz=function(n,e){const{scale:i}=n.tileTransform,o=i*Ut/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return function(l,d,f){var y=d[1],x=d[2],T=d[3],M=f[0],R=f[1];return l[0]=d[0]*M,l[1]=y*M,l[2]=x*R,l[3]=T*R,l}(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},r.d=function(n){return Wr.API_TILEJSON_REGEX.test(n)},r.d$=Af,r.d0=Bv,r.d1=Tg,r.d2=mx,r.d3=gn,r.d4=hc,r.d5=Va,r.d6=Mo,r.d7=Gi,r.d8=function(n){const e=n.indexOf(uu);return e>=0?n.slice(0,e):n},r.d9=function(n){return n.indexOf(uu)>=0},r.dA=o_,r.dB=aa,r.dC=Nr,r.dD=256,r.dE=function(n,e){const i=[0,0,0];return Vi(i,i,zd(Nl(e.canonical))),Vi(i,i,n),i},r.dF=n=>({u_camera_to_center_distance:new Lr(n),u_extrude_scale:new Wa(n),u_device_pixel_ratio:new Lr(n),u_matrix:new Qo(n),u_inv_rot_matrix:new Qo(n),u_merc_center:new _s(n),u_tile_id:new Ko(n),u_zoom_transition:new Lr(n),u_up_dir:new Ko(n),u_emissive_strength:new Lr(n)}),r.dG=n=>({u_matrix:new Qo(n),u_pixels_to_tile_units:new Wa(n),u_device_pixel_ratio:new Lr(n),u_width_scale:new Lr(n),u_floor_width_scale:new Lr(n),u_units_to_pixels:new _s(n),u_dash_image:new Sd(n),u_gradient_image:new Sd(n),u_image_height:new Lr(n),u_texsize:new _s(n),u_tile_units_to_pixels:new Lr(n),u_alpha_discard_threshold:new Lr(n),u_trim_offset:new _s(n),u_trim_fade_range:new _s(n),u_trim_color:new _h(n),u_emissive_strength:new Lr(n),u_zbias_factor:new Lr(n),u_tile_to_meter:new Lr(n),u_ground_shadow_factor:new Ko(n)}),r.dH=n=>({u_matrix:new Qo(n),u_texsize:new _s(n),u_pixels_to_tile_units:new Wa(n),u_device_pixel_ratio:new Lr(n),u_width_scale:new Lr(n),u_floor_width_scale:new Lr(n),u_image:new Sd(n),u_units_to_pixels:new _s(n),u_tile_units_to_pixels:new Lr(n),u_alpha_discard_threshold:new Lr(n),u_trim_offset:new _s(n),u_trim_fade_range:new _s(n),u_trim_color:new _h(n),u_emissive_strength:new Lr(n),u_zbias_factor:new Lr(n),u_tile_to_meter:new Lr(n),u_ground_shadow_factor:new Ko(n),u_pattern_transition:new Lr(n)}),r.dI=ms,r.dJ=mC,r.dK=Uy,r.dL=(n,e,i,o,l,d)=>{const f=n.transform,y=f.projection.name==="globe";let x;if(d.paint.get("circle-pitch-alignment")==="map")if(y){const M=o_(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;x=Float32Array.from([M,0,0,M])}else x=f.calculatePixelsToTileUnitsMatrix(i);else x=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const T={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(f.projection),u_matrix:n.translatePosMatrix(e.projMatrix,i,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ho.devicePixelRatio,u_extrude_scale:x,u_inv_rot_matrix:u_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(y){T.u_inv_rot_matrix=o,T.u_merc_center=l,T.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],T.u_zoom_transition=xu(f.zoom);const M=l[0]*Ut,R=l[1]*Ut;T.u_up_dir=f.projection.upVector(new Zn(0,0,0),M,R)}return T},r.dM=Ba,r.dN=qa,r.dO=(n,e,i,o,l,d,f,y,x,T)=>{const M=n.transform,R=M.pitch<15?nr(.07,.7,Me((14-M.zoom)/5,0,1)):.07,D=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Mn(n,e,i,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:l,u_width_scale:d,u_floor_width_scale:f,u_image:0,u_tile_units_to_pixels:un(e,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:y,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(D?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:R,u_tile_to_meter:$e(e.tileID.canonical,0),u_ground_shadow_factor:x,u_pattern_transition:T}},r.dP=(n,e,i,o,l,d,f,y,x,T)=>{const M=n.transform,R=M.calculatePixelsToTileUnitsMatrix(e),D=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",B=M.pitch<15?nr(.07,.7,Me((14-M.zoom)/5,0,1)):.07;return{u_matrix:Mn(n,e,i,o),u_pixels_to_tile_units:R,u_device_pixel_ratio:d,u_width_scale:f,u_floor_width_scale:y,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:l,u_texsize:Mr(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:un(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(D?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:B,u_tile_to_meter:$e(e.tileID.canonical,0),u_ground_shadow_factor:T}},r.dQ=Vt,r.dR=Df,r.dS=Qe,r.dT=um,r.dU=Ya,r.dV=vg,r.dW=Ac,r.dX=450,r.dY=7,r.dZ=WC,r.d_=bn,r.da=function(n){const e=n.lastIndexOf(uu);return e>=0?n.slice(e+1):""},r.db=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.dc=function(n,e,i,o){return n.type==="custom"?new YC(n,e):new sR[n.type](n,e,i,o)},r.dd=gi,r.de=function(n){const e=n.indexOf(uu);return e>=0?n.slice(e+1):""},r.df=class extends Pg{constructor(n,e){super(n._vectorTileFeature,n._z,n._x,n._y,n.id),n.state&&(this.state=Object.assign({},n.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=n.source,this.sourceLayer=n.sourceLayer,this.layer=n.layer)}toJSON(){const n=super.toJSON();return n.target=this.target,n.namespace=this.namespace,n}},r.dg=_d,r.dh=Ao,r.di=Vm,r.dj=class extends gs{constructor(n){super(n),this.current=Zp}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let o=0;o<9;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.dk=ye,r.dl=function(n,e,i){const o=xu(i.zoom),l=n.style.map._antialias,d=n.terrain&&n.terrain.exaggeration()>0;return o===0&&!l&&!d},r.dm=function(n){const e=n.pixelsPerMeter,i=e/ge(1,n.center.lat),o=be(new Float64Array(16));return Be(o,o,[n.point.x,n.point.y,0]),je(o,o,[i,i,e]),Float32Array.from(o)},r.dn=$m,r.dp=function(n){const e=Ze-5;n=Me(n,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(V(n))),3);return Math.round(i*(z.length-1))},r.dq=function(n,e,i,o){const l=e.getNorth(),d=e.getSouth(),f=e.getWest(),y=e.getEast(),x=1<<n.z,T=y-f,M=l-d,R=T/I,D=-M/z[i],B=[0,R,0,D,0,0,l,f,0];if(n.z>0){const F=180/o;Re(B,B,[F/T+1,0,0,0,F/M+1,0,-.5*F/R,.5*F/D,1])}return B[2]=x,B[5]=n.x,B[8]=n.y,B},r.dr=Nl,r.ds=function(n,e,i){const o=be(new Float64Array(16)),l=(e/(1<<n)-.5)*Math.PI*2;return ut(o,i.globeMatrix,l),Float32Array.from(o)},r.dt=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,o=1<<i,l=Math.floor(n.x),d=Math.floor((n.x-l)*o),f=Math.floor(n.y*o),y=this.findDEMTileFor(new jn(i,l,i,d,f));return!(!y||!y.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||n.y<0||n.y>1)return e;const l=o.getSource().maxzoom,d=1<<l,f=Math.floor(n.x),y=n.x-f,x=new jn(l,f,l,Math.floor(y*d),Math.floor(n.y*d)),T=this.findDEMTileFor(x);if(!T||!T.dem)return e;const M=T.dem,R=1<<T.tileID.canonical.z,D=(y*R-T.tileID.canonical.x)*M.dim,B=(n.y*R-T.tileID.canonical.y)*M.dim,F=Math.floor(D),q=Math.floor(B);return(i?this.exaggeration():1)*Ti(Ti(M.get(F,q),M.get(F,q+1),B-q),Ti(M.get(F+1,q),M.get(F+1,q+1),B-q),D-F)}getAtTileOffset(n,e,i){const o=1<<n.canonical.z;return this.getAtPointOrZero(new et(n.wrap+(n.canonical.x+e/Ut)/o,(n.canonical.y+i/Ut)/o))}getAtTileOffsetFunc(n,e,i,o){return l=>{const d=this.getAtTileOffset(n,l.x,l.y),f=o.upVector(n.canonical,l.x,l.y);return Fe(f,f,d*o.upVectorScale(n.canonical,e,i).metersToTile),f}}getForTilePoints(n,e,i,o){if(this.isUsingMockSource())return!1;const l=Mg.create(this,n,o);return!!l&&(e.forEach(d=>{d[2]=this.exaggeration()*l.getElevationAt(d[0],d[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,o=e.tileID,l=1<<n.canonical.z-o.canonical.z;let d=n.canonical.x/l-o.canonical.x,f=n.canonical.y/l-o.canonical.y,y=0;for(let x=0;x<n.canonical.z-o.canonical.z&&!i.leaves[y];x++){d*=2,f*=2;const T=2*Math.floor(f)+Math.floor(d);y=i.childOffsets[y]+T,d%=1,f%=1}return{min:this.exaggeration()*i.minimums[y],max:this.exaggeration()*i.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(n.length===0)return null;let e=!1,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const l of n){const d=this.getMinMaxForTile(l.tileID);d&&(i=Math.min(i,d.min),o=Math.max(o,d.max),e=!0)}return e?{min:i,max:o}:null}},r.du=f_,r.dv=kl,r.dw=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},r.dx=oe,r.dy=function(n,e){var i=Math.sin(e),o=Math.cos(e);return n[0]=o,n[1]=i,n[2]=0,n[3]=-i,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},r.dz=rn,r.e=Wr,r.e$=qT,r.e0=256,r.e1=Zm,r.e2=mo,r.e3=ut,r.e4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},r.e5=$s,r.e6=_u,r.e7=function(n,e,i,o,l){return Me((n-e)/(i-e)*(l-o)+o,o,l)},r.e8=xo,r.e9=function(n,e){var i=e[0],o=e[1],l=e[2],d=e[3],f=e[4],y=e[5],x=e[6],T=e[7],M=e[8],R=M*f-y*T,D=-M*d+y*x,B=T*d-f*x,F=i*R+o*D+l*B;return F?(n[0]=R*(F=1/F),n[1]=(-M*o+l*T)*F,n[2]=(y*o-l*f)*F,n[3]=D*F,n[4]=(M*i-l*x)*F,n[5]=(-y*i+l*d)*F,n[6]=B*F,n[7]=(-T*i+o*x)*F,n[8]=(f*i-o*d)*F,n):null},r.eA=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},r.eB=Jr,r.eC=Q,r.eD=Jt,r.eE=function(n,e,i,o){return n[0]=e,n[1]=i,n[2]=o,n},r.eF=function([n,e,i]){const o=Math.hypot(n,e,i),l=Math.atan2(n,i),d=.5*Math.PI-Math.acos(-e/o);return new K(W(l),W(d))},r.eG=is,r.eH=Rx,r.eI=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!function(i){if(Er==null){const o=i.navigator?i.navigator.userAgent:null;Er=!!i.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Er}(n)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},r.eJ=function(n,e){el=n,ns=e},r.eK=Rf,r.eL=l_,r.eM=function(n){const e=[0,0,0],i=be(new Float64Array(16));return Oe(i,n.pixelMatrix,n.globeMatrix),Vi(e,e,i),new Bt(e[0],e[1])},r.eN=function(n,e,i=!1){if(po===dh||po===pd||po===md)throw new Error("setRTLTextPlugin cannot be called multiple times.");Il=Ho.resolveURL(n),po=dh,yf=e,gd(),i||Ep()},r.eO=dc,r.eP=function(){Bv().acquire(kx)},r.eQ=function(){const n=Q_;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(kx),Q_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.eR=_m,r.eS=function(n){const e=Jd();if(!e)return;const i=e.delete(Ga);n&&i.then(()=>n()).catch(n)},r.eT=K_,r.eU=OT,r.eV=function(n){$x=Ho.resolveURL(n),zg||(zg=new Cg(Bv(),new Yl)),zg.broadcast("setDracoUrl",$x)},r.eW=kT,r.eX=function(n){Dg=Ho.resolveURL(n),zg||(zg=new Cg(Bv(),new Yl)),zg.broadcast("setMeshoptUrl",Dg)},r.eY=Wt,r.eZ=bu,r.e_=Ru,r.ea=xp,r.eb=bi,r.ec=lt,r.ed=class{constructor(n,e,i,o){this.context=n,this.format=o,this.size=i,this.texture=n.gl.createTexture();const[l,d,f]=this.size,{gl:y}=n;y.bindTexture(y.TEXTURE_3D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),y.texImage3D(y.TEXTURE_3D,0,this.format,l,d,f,0,Ex(this.format),Ax(this.format),e.data)}bind(n,e){const{context:i}=this,{gl:o}=i;o.bindTexture(o.TEXTURE_3D,this.texture),n!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,n),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,n),this.minFilter=n),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}},r.ee=function(n,e){if(n===e){var i=e[1],o=e[2],l=e[3],d=e[6],f=e[7],y=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=i,n[6]=e[9],n[7]=e[13],n[8]=o,n[9]=d,n[11]=e[14],n[12]=l,n[13]=f,n[14]=y}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n},r.ef=Ix,r.eg=xi,r.eh=[1,1,1],r.ei=function(n,e,i,o){var l=new $(4);return l[0]=n,l[1]=e,l[2]=i,l[3]=o,l},r.ej=ea,r.ek=function(n,e,i,o){var l=e[0],d=e[1],f=e[2],y=e[3];return n[0]=l+o*(i[0]-l),n[1]=d+o*(i[1]-d),n[2]=f+o*(i[2]-f),n[3]=y+o*(i[3]-y),n},r.el=Mg,r.em=Ag,r.en=Pl,r.eo=yc,r.ep=function(n,e,i,o,l,d,f,y,x,T,M,R,D,B,F,q){var J=new $(16);return J[0]=n,J[1]=e,J[2]=i,J[3]=o,J[4]=l,J[5]=d,J[6]=f,J[7]=y,J[8]=x,J[9]=T,J[10]=M,J[11]=R,J[12]=D,J[13]=B,J[14]=F,J[15]=q,J},r.eq=Y,r.er=Td,r.es=wd,r.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Bt(1/0,1/0),max:new Bt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n,e=!1){const i=am(new Bt(0,0),new Bt(Ut,Ut),n),o=[];if(e&&!I_(i,this._globalClipBounds))return o;for(const l of this._activeRegions){if(l.hiddenByOverlap||!I_(i,l))continue;const d=D_(l.min,l.max,n);o.push({min:d.min,max:d.max,sourceId:this._sourceIds[l.priority],footprint:l.footprint,footprintTileId:l.tileId,order:l.order,clipMask:l.clipMask,clipScope:l.clipScope})}return o}setSources(n){this._setSources(n.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const o of e.cache.getVisibleCoordinates()){const l=e.cache.getTile(o).buckets[e.layer];l&&l.updateFootprints(o.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(n){const e=n.getFootprints();if(e.length===0)return;const i=n.getOrder(),o=n.getClipMask(),l=n.getClipScope();for(const d of e){if(!d.footprint)continue;const f=am(d.footprint.min,d.footprint.max,d.id);this._activeRegions.push({min:f.min,max:f.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:d.id,footprint:d.footprint,order:i,clipMask:o,clipScope:l})}this._sourceIds.push(n.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||pg(e.min,i.min)||pg(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(o,l){const d=(f,y)=>f+y;return o.length-l.length||o.reduce(d,"").localeCompare(l.reduce(d,""))}(e.clipScope,i.clipScope));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0;for(;!n&&e!==this._activeRegions.length;){const i=this._activeRegions[e],o=this._prevRegions[e];n=i.priority!==o.priority||!rv(i,o)||i.order!==o.order||i.clipMask!==o.clipMask||!Go(i.clipScope,o.clipScope),++e}}if(n){++this._updateTime;for(const i of this._activeRegions)i.order!==rm&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const o=this._activeRegions;if(i>=o.length)return i;const l=o[i].priority;for(;i<o.length&&o[i].priority===l;)++i;return i};if(this._sourceIds.length>1){let i=0,o=e(i);for(;i!==o;){let l=i;const d=i;for(;l!==o;){const f=this._activeRegions[l];f.hiddenByOverlap=!1;for(let y=0;y<d;y++){const x=this._activeRegions[y];if(!x.hiddenByOverlap&&f.order===rm&&I_(f,x)&&(f.hiddenByOverlap=Nf(f.footprint,f.tileId,x.footprint,x.tileId),f.hiddenByOverlap))break}++l}i=o,o=e(i)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},r.eu=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const i=new Vs,o=new Pr,l=[],d=n+1+2,f=e[0]+1,y=e[0]+1+(1+e.length),x=(T,M,R)=>{let D=T===d-1?T-2:T===0?T:T-1;return D+=R?24575:0,[D,M]};for(let T=0;T<d;++T)i.emplaceBack(...x(T,0,!0));for(let T=0;T<f;++T)for(let M=0;M<d;++M)i.emplaceBack(...x(M,T,(M===0||M===d-1)&&!0));for(let T=0;T<e.length;++T){const M=e[T];for(let R=0;R<d;++R)i.emplaceBack(...x(R,M,!0))}for(let T=0;T<e.length;++T){const M=o.length,R=e[T]+1+2,D=new Pr;for(let q=0;q<R-1;q++){const J=q===R-2,te=J?d*(y-e.length+T-q):d;for(let he=0;he<d-1;he++){const ce=q*d+he;q===0||J||he===0||he===d-2?(D.emplaceBack(ce+1,ce,ce+te),D.emplaceBack(ce+te,ce+te+1,ce+1)):(o.emplaceBack(ce+1,ce,ce+te),o.emplaceBack(ce+te,ce+te+1,ce+1))}}const B=vr.simpleSegment(0,M,i.length,o.length-M);for(let q=0;q<D.uint16.length;q+=3)o.emplaceBack(D.uint16[q],D.uint16[q+1],D.uint16[q+2]);const F=vr.simpleSegment(0,M,i.length,o.length-M);l.push({withoutSkirts:B,withSkirts:F})}return{vertices:i,indices:o,segments:l}}_createGrid(n){const e=this._fillGridMeshWithLods(I,z);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,Zs.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new Pr;for(let f=0;f<=I;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new $s,o=new $s,l=new $s,d=new $s;this._poleSegments=[];for(let f=0,y=0;f<v;f++){const x=360/(1<<f);i.emplaceBack(0,-g,0,.5,0),o.emplaceBack(0,-g,0,.5,1),l.emplaceBack(0,-g,0,.5,.5),d.emplaceBack(0,-g,0,.5,.5);for(let T=0;T<=I;T++){let M=T/I,R=0;const D=Ti(0,x,M),[B,F,q]=j(jy,Qr,D,g);i.emplaceBack(B,F,q,M,R),o.emplaceBack(B,F,q,M,1-R);const J=V(D);M=.5+.5*Math.sin(J),R=.5+.5*Math.cos(J),l.emplaceBack(B,F,q,M,R),d.emplaceBack(B,F,q,M,1-R)}this._poleSegments.push(vr.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,Ka,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(o,Ka,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(l,Ka,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(d,Ka,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},r.ev=rm,r.ew=we,r.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.ey=De,r.ez=Ct,r.f=function(n){return n.indexOf("mapbox:")===0},r.f0=$T,r.f1=kt,r.f2=kd,r.f3="hd_road_elevation",r.f4=ys,r.f5=mi,r.f6=es,r.f7=px,r.f8=fm,r.f9=function(n,e,i,o,l,d,f,y=1,x,T){n.createArrays(),n.tilePixelRatio=Ut/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const M=n.layers[0].layout,R=n.layers[0]._unevaluatedLayout._values,D={};D.scaleFactor=y,D.textSizeScaleRange=M.get("text-size-scale-range"),D.iconSizeScaleRange=M.get("icon-size-scale-range");const[B,F]=D.textSizeScaleRange,[q,J]=D.iconSizeScaleRange;D.textScaleFactor=Me(D.scaleFactor,B,F),D.iconScaleFactor=Me(D.scaleFactor,q,J);const te=R["text-size"],he=R["icon-size"];if(n.textSizeData.kind==="composite"){const{minZoom:ze,maxZoom:Ne}=n.textSizeData;D.compositeTextSizes=[te.possiblyEvaluate(new Fn(ze),d),te.possiblyEvaluate(new Fn(Ne),d)]}if(n.iconSizeData.kind==="composite"){const{minZoom:ze,maxZoom:Ne}=n.iconSizeData;D.compositeIconSizes=[he.possiblyEvaluate(new Fn(ze),d),he.possiblyEvaluate(new Fn(Ne),d)]}D.layoutTextSize=te.possiblyEvaluate(new Fn(f+1),d),D.layoutIconSize=he.possiblyEvaluate(new Fn(f+1),d),D.textMaxSize=te.possiblyEvaluate(new Fn(18),d);const ce=M.get("symbol-placement"),X=M.get("text-rotation-alignment")==="map"&&ce!=="point",re=M.get("text-size");let ue=!1;const _e=[];for(const ze of n.features){const Ne=M.get("text-font").evaluate(ze,{},d).join(","),Ue=re.evaluate(ze,{},d)*D.textScaleFactor,qe=D.layoutTextSize.evaluate(ze,{},d)*D.textScaleFactor,ot=D.layoutIconSize.evaluate(ze,{},d)*D.iconScaleFactor,St={horizontal:{},vertical:void 0},gt=ze.text;let xt,Rt=[0,0];if(gt){const li=gt.toString(),Oi=M.get("text-letter-spacing").evaluate(ze,{},d)*Ia,qi=M.get("text-line-height").evaluate(ze,{},d)*Ia,$i=Tp(li)?Oi:0,en=M.get("text-anchor").evaluate(ze,{},d),Qi=M.get("text-variable-anchor");if(!Qi){const xe=M.get("text-radial-offset").evaluate(ze,{},d);if(xe)Rt=fw(en,[xe*Ia,gx]);else{const ct=M.get("text-offset").evaluate(ze,{},d);Rt=[ct[0]*Ia,ct[1]*Ia]}}let Xi=X?"center":M.get("text-justify").evaluate(ze,{},d);const Kn=ce==="point",sr=Kn?M.get("text-max-width").evaluate(ze,{},d)*Ia:1/0,me=xe=>{n.allowVerticalPlacement&&hd(li)&&(St.vertical=hx(gt,e,i,l,Ne,sr,qi,en,xe,$i,Rt,Xs.vertical,!0,qe,Ue,x))};if(!X&&Qi){const xe=Xi==="auto"?Qi.map(Ft=>_x(Ft)):[Xi];let ct=!1;for(let Ft=0;Ft<xe.length;Ft++){const qt=xe[Ft];if(!St.horizontal[qt])if(ct)St.horizontal[qt]=St.horizontal[0];else{const Ht=hx(gt,e,i,l,Ne,sr,qi,"center",qt,$i,Rt,Xs.horizontal,!1,qe,Ue,x);Ht&&(St.horizontal[qt]=Ht,ct=Ht.positionedLines.length===1)}}me("left")}else{if(Xi==="auto"&&(Xi=_x(en)),Kn||M.get("text-writing-mode").indexOf("horizontal")>=0||!hd(li)){const xe=hx(gt,e,i,l,Ne,sr,qi,en,Xi,$i,Rt,Xs.horizontal,!1,qe,Ue,x);xe&&(St.horizontal[Xi]=xe)}me(Kn?"left":Xi)}}let nt,yt,it,rt,Dt,Ot,hi,ti=!1;if(ze.icon&&ze.icon.hasPrimary()){const li=mw(ze.icon,n.iconSizeData,R["icon-size"],d,n.zoom,ze,x,D.iconScaleFactor);nt=li.iconPrimary,it=li.iconSecondary;const Oi=nt.toString();if(yt=o.get(Oi),yt&&(Dt=M.get("icon-offset").evaluate(ze,{},d),Ot=M.get("icon-anchor").evaluate(ze,{},d),hi=M.get("icon-text-fit").evaluate(ze,{},d),xt=AC(l.get(Oi),it?l.get(it.toString()):void 0,Dt,Ot),ti=yt.sdf,n.sdfIcons===void 0?n.sdfIcons=yt.sdf:n.sdfIcons!==yt.sdf&&Ui("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(yt.pixelRatio!==n.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0)),it){const qi=it.toString();rt=o.get(qi)}}ue=ue||!(!ze.icon||!ze.icon.hasSecondary());const Gt=yx(St.horizontal)||St.vertical;n.iconsInText||(n.iconsInText=!!Gt&&Gt.iconsInText);const It=qe*D.textScaleFactor/Ia,{defaultShapedIcon:ji,verticallyShapedIcon:si}=OC(n,xt,M,ze,d,St,It,Dt,hi);hi!=="none"&&xt&&(K1(xt)||Q1(xt))&&(xv(0,yt,nt,xt,ji,hi,T,o,l),xv(0,rt,it,xt,ji,hi,T,o,l),si&&(xv(0,yt,nt,xt,si,hi,T,o,l),xv(0,rt,it,xt,si,hi,T,o,l))),xt=ji,_e.push({feature:ze,shapedTextOrientations:St,shapedText:Gt,shapedIcon:xt,iconPrimary:nt,iconSecondary:it,iconOffset:Dt,iconAnchor:Ot,verticallyShapedIcon:si,layoutTextSize:qe,layoutIconSize:ot,textOffset:Rt,isSDFIcon:ti,iconTextFit:hi})}return{featureData:_e,sizes:D,hasAnySecondaryIcon:ue,textAlongLine:X,symbolPlacement:ce}},r.fa=sw,r.fb=function(n,e,i,o,l,d,f,y,x,T){const{featureData:M,hasAnySecondaryIcon:R,sizes:D,textAlongLine:B,symbolPlacement:F}=e;for(const q of M){const{shapedIcon:J,verticallyShapedIcon:te,feature:he,shapedTextOrientations:ce,shapedText:X,layoutTextSize:re,textOffset:ue,isSDFIcon:_e,iconPrimary:ze,iconSecondary:Ne,iconTextFit:Ue,iconOffset:qe}=q;gw(J,T.iconPositions,ze,Ne),gw(te,T.iconPositions,ze,Ne),LC(ce,T.iconPositions),(X||J)&&kC(n,he,ce,J,te,x,D,re,0,ue,_e,o,l,f,y,R,Ue,qe,B,F)}i&&n.generateCollisionDebugBuffers(d,n.collisionBoxArray,D.textScaleFactor)},r.fc=Ec,r.fd=qv,r.fe=Ms,r.ff=y_,r.fg=G1,r.fh=ro,r.fi=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==BT){const i=new Uint32Array(n,0,7),[,,o,l,d,f]=i;e=i.byteLength+l+d+f+d,(o!==n.byteLength||e>=n.byteLength)&&Ui("Invalid b3dm header information.")}return VT(n,e)},r.fj=function(n,e){const i=HT(n);for(const o of i){for(const l of o.meshes)hI(l);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(dI(o.lights,e)))}return i},r.fk=Nv,r.fl=Gn,r.fm=rT,r.fn=fs,r.fo=function(n){Cs(),rs!=null&&rs.then(e=>{e.keys().then(i=>{for(let o=0;o<i.length-n;o++)e.delete(i[o]).catch(l=>Ui(l.message))}).catch(i=>Ui(i.message))}).catch(e=>Ui(e.message))},r.g=function(n,e){return Ao(Ve(n,{method:"GET"}),e)},r.h=To,r.i=function(n){return Wr.API_STYLE_REGEX.test(n)&&!ma(n)},r.j=function(n){return decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.k=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},r.l=Ve,r.m=ap,r.n=function(n,e){return Ao(Ve(n,{type:"json"}),e)},r.o=Oc,r.p=function(n,e){return Ao(Ve(n,{method:"POST"}),e)},r.q=Ho,r.r=xa,r.s=function(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=So,r.u=function(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()},r.v=function(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)},r.w=Ui,r.x=function(){return Nx||(Nx=new _m),Nx},r.y=Vx,r.z=jh}),N(["./shared"],function(r){function Z(de){const V=de?de.url.toString():void 0;return V?performance.getEntriesByName(V):[]}function $(de){if(typeof de=="number"||typeof de=="boolean"||typeof de=="string"||de==null)return JSON.stringify(de);if(Array.isArray(de)){let W="[";for(const ae of de)W+=`${$(ae)},`;return`${W}]`}let V="{";for(const W of Object.keys(de).sort())V+=`${W}:${$(de[W])},`;return`${V}}`}function ie(de){let V="";for(const W of r.bu)(de.type!=="model"||W!=="minzoom"&&W!=="maxzoom")&&(V+=`/${$(de[W])}`);return V}class oe{constructor(V){this.keyCache={},this._layers={},this._layerConfigs={},V&&this.replace(V)}replace(V,W){this._layerConfigs={},this._layers={},this.update(V,[],W)}update(V,W,ae){this._options=ae;for(const we of V)this._layerConfigs[we.id]=we,(this._layers[we.id]=r.dc(we,this.scope,null,this._options)).compileFilter(ae),this.keyCache[we.id]&&delete this.keyCache[we.id];for(const we of W)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const ye=function(we,De){const Me={};for(let He=0;He<we.length;He++){const Ye=we[He];let Ve=De&&De[Ye.id];Ve||(Ye.type==="symbol"?Ve=Ye.id:(Ve=ie(Ye),Ye.type==="line"&&Ye.paint&&function Pt(Vt){return typeof Vt=="string"&&Vt==="line-progress"||(Array.isArray(Vt)?Vt.some(Pt):!(!Vt||typeof Vt!="object")&&Object.values(Vt).some(Pt))}(Ye.paint["line-width"])&&(Ve+=`/${$(Ye.paint["line-width"])}`))),De&&(De[Ye.id]=Ve);let ft=Me[Ve];ft||(ft=Me[Ve]=[]),ft.push(Ye)}const Pe=[];for(const He in Me)Pe.push(Me[He]);return Pe}(Object.values(this._layerConfigs),this.keyCache);for(const we of ye){const De=we.map(ft=>this._layers[ft.id]),Me=De[0];if(Me.visibility==="none")continue;const Pe=Me.source||"";let He=this.familiesBySource[Pe];He||(He=this.familiesBySource[Pe]={});const Ye=Me.sourceLayer||"_geojsonTileLayer";let Ve=He[Ye];Ve||(Ve=He[Ye]=[]),Ve.push(De)}}}const fe=1*r.e_;class Re{constructor(V){const W={},ae=[];for(const Me in V){const Pe=V[Me],He=W[Me]={};for(const Ye in Pe.glyphs){const Ve=Pe.glyphs[+Ye];if(!Ve||Ve.bitmap.width===0||Ve.bitmap.height===0)continue;const ft=Ve.metrics.localGlyph?fe:1,Pt={x:0,y:0,w:Ve.bitmap.width+2*ft,h:Ve.bitmap.height+2*ft};ae.push(Pt),He[Ye]=Pt}}const{w:ye,h:we}=r.H(ae),De=new r.eZ({width:ye||1,height:we||1});for(const Me in V){const Pe=V[Me];for(const He in Pe.glyphs){const Ye=Pe.glyphs[+He];if(!Ye||Ye.bitmap.width===0||Ye.bitmap.height===0)continue;const Ve=W[Me][He],ft=Ye.metrics.localGlyph?fe:1;r.eZ.copy(Ye.bitmap,De,{x:0,y:0},{x:Ve.x+ft,y:Ve.y+ft},Ye.bitmap)}}this.image=De,this.positions=W}}r.eY(Re,"GlyphAtlas");class Ie{constructor(V){this.tileID=new r.aM(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.tileZoom=V.tileZoom,this.uid=V.uid,this.zoom=V.zoom,this.lut=V.lut,this.canonical=V.tileID.canonical,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.scope=V.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.request&&V.request.collectResourceTiming,this.promoteId=V.promoteId,this.isSymbolTile=V.isSymbolTile,this.tileTransform=r.aW(V.tileID.canonical,V.projection),this.projection=V.projection,this.worldview=V.worldview,this.localizableLayerIds=V.localizableLayerIds,this.brightness=V.brightness,this.extraShadowCaster=!!V.extraShadowCaster,this.tessellationStep=V.tessellationStep,this.scaleFactor=V.scaleFactor}parse(V,W,ae,ye,we,De){this.status="parsing",this.data=V,this.collisionBoxArray=new r.b0;const Me=new r.e$(Object.keys(V.layers).sort()),Pe=new r.f0(this.tileID,this.promoteId);Pe.bucketLayerIDs=[];const He={},Ye=new r.f1(256,256),Ve={featureIndex:Pe,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Ye,availableImages:ae,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},ft=W.familiesBySource[this.source];for(const ln in ft){const Dn=V.layers[ln];if(!Dn)continue;let Gn=!1,Yn=!1,Er=!1;for(const Nr of ft[ln])Nr[0].type==="symbol"?Gn=!0:Yn=!0,Nr[0].is3D()&&Nr[0].type!=="model"&&(Er=!0);if(this.extraShadowCaster&&!Er||this.isSymbolTile===!0&&!Gn||this.isSymbolTile===!1&&!Yn)continue;Dn.version===1&&r.w(`Vector tile source "${this.source}" layer "${ln}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const sn=Me.encode(ln),gr=[];let ya=!1;for(let Nr=0,aa=0;Nr<Dn.length;Nr++){const Bn=Dn.feature(Nr),Wr=Pe.getId(Bn,ln);if(this.localizableLayerIds&&this.localizableLayerIds.has(ln)){const To=Bn.properties?Bn.properties.worldview:null;if(this.worldview&&typeof To=="string")if(To==="all")Bn.properties.$localized=!0;else{if(!To.split(",").includes(this.worldview))continue;Bn.properties.$localized=!0,Bn.properties.worldview=this.worldview}}!ya&&Bn.properties&&Bn.properties.hasOwnProperty(r.f2)&&(ya=!0),gr.push({feature:Bn,id:Wr,index:aa,sourceLayerIndex:sn}),aa++}ya&&!Ve.elevationFeatures&&V.layers.hasOwnProperty(r.f3)&&(Ve.elevationFeatures=r.f4.parseFrom(V.layers[r.f3],this.canonical));for(const Nr of ft[ln]){const aa=Nr[0];(!this.extraShadowCaster||aa.is3D()&&aa.type!=="model")&&(this.isSymbolTile!==void 0&&aa.type==="symbol"!==this.isSymbolTile||aa.minzoom&&this.zoom<Math.floor(aa.minzoom)||aa.maxzoom&&this.zoom>=aa.maxzoom||aa.visibility!=="none"&&(be(Nr,this.zoom,Ve.brightness,ae),(He[aa.id]=aa.createBucket({index:Pe.bucketLayerIDs.length,layers:Nr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:sn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:ye})).populate(gr,Ve,this.tileID.canonical,this.tileTransform),Pe.bucketLayerIDs.push(Nr.map(Bn=>r.C(Bn.id,Bn.scope)))))}}let Pt,Vt,vi,mi,gi,Gi;Ye.trim();const In={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ui=()=>{if(Pt)return this.status="done",De(Pt);if(this.extraShadowCaster)this.status="done",De(null,{buckets:Object.values(He).filter(ln=>!ln.isEmpty()),featureIndex:Pe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ve.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Vt&&vi&&mi){const ln=new Re(Vt),Dn=new Map;for(const[Er,sn]of vi.entries()){const{imagePosition:gr}=r.f7(Er,sn,r.f8);Dn.set(Er,gr)}const Gn={};for(const Er in He){const sn=He[Er];sn instanceof r.b1&&(be(sn.layers,this.zoom,Ve.brightness,ae),Gn[Er]=r.f9(sn,Vt,ln.positions,vi,Dn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,gi))}const Yn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(we,vi,gi,()=>{Yn.iconsPending=!1,yn(Gn,ln,Yn)}),this.rasterizeIfNeeded(we,mi,Gi,()=>{Yn.patternsPending=!1,yn(Gn,ln,Yn)})}},yn=(ln,Dn,Gn,Yn)=>{if(Gn.iconsPending||Gn.patternsPending)return;const Er=new r.fa(vi,mi,this.lut);for(const sn in He){const gr=He[sn];if(sn in ln)r.fb(gr,ln[sn],this.showCollisionBoxes,ae,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,vi,Er);else if(gr.hasPattern&&(gr instanceof r.b7||gr instanceof r.b8||gr instanceof r.dV)){be(gr.layers,this.zoom,Ve.brightness,ae);const ya=Object.fromEntries(Er.patternPositions);gr.addFeatures(Ve,this.tileID.canonical,ya,ae,this.tileTransform,this.brightness)}}this.status="done",De(null,{buckets:Object.values(He).filter(sn=>!sn.isEmpty()),featureIndex:Pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Dn.image,lineAtlas:Ye,imageAtlas:Er,brightness:Ve.brightness})};if(!this.extraShadowCaster){const ln=r.f5(Ve.glyphDependencies,Yn=>Object.keys(Yn).map(Number));Object.keys(ln).length?we.send("getGlyphs",{uid:this.uid,stacks:ln,scope:this.scope},(Yn,Er)=>{Pt||(Pt=Yn,Vt=Er,Ui())},void 0,!1,In):Vt={};const Dn=Array.from(Ve.iconDependencies.keys()).map(Yn=>r.I.parse(Yn));Dn.length?we.send("getImages",{images:Dn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Yn,Er)=>{Pt||(Pt=Yn,vi=new Map,gi=this.updateImageMapAndGetImageTaskQueue(vi,Er,Ve.iconDependencies),Ui())},void 0,!1,In):(vi=new Map,gi=new Map);const Gn=Array.from(Ve.patternDependencies.keys()).map(Yn=>r.I.parse(Yn));Gn.length?we.send("getImages",{images:Gn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Yn,Er)=>{Pt||(Pt=Yn,mi=new Map,Gi=this.updateImageMapAndGetImageTaskQueue(mi,Er,Ve.patternDependencies),Ui())},void 0,!1,In):(mi=new Map,Gi=new Map)}if(Ve.elevationFeatures&&Ve.elevationFeatures.length>0){const ln=[];for(const Gn of Object.values(He))if(Gn instanceof r.b8){const Yn=Gn.getUnevaluatedPortalGraph();Yn&&ln.push(Yn)}const Dn=r.f6.evaluate(ln);for(const Gn of Object.values(He))Gn instanceof r.b8&&Gn.setEvaluatedPortalGraph(Dn)}Ui()}rasterizeIfNeeded(V,W,ae,ye){Array.from(W.values()).some(we=>we.usvg)?this.rasterize(V,W,ae,ye):ye()}updateImageMapAndGetImageTaskQueue(V,W,ae){const ye=new Map;for(const we of W.keys()){const De=ae.get(we)||[];for(const Me of De){const Pe=Me.toString(),He=W.get(Me.id.toString());He.usvg?ye.has(Pe)||(ye.set(Pe,Me),V.set(Pe,Object.assign({},He))):V.set(Pe,He)}}return ye}rasterize(V,W,ae,ye){this.rasterizeTask=V.send("rasterizeImages",{scope:this.scope,tasks:ae},(we,De)=>{if(!we)for(const[Me,Pe]of De.entries()){const He=Object.assign(W.get(Me),{data:Pe});W.set(Me,He)}ye()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function be(de,V,W,ae){const ye=new r.aa(V,{brightness:W});for(const we of de)we.recalculate(ye,ae)}class ke extends r.E{constructor(V,W,ae,ye,we,De,Me){super(),this.actor=V,this.layerIndex=W,this.availableImages=ae,this.availableModels=ye,this.loadVectorData=De||r.aJ,this.loading={},this.loaded={},this.deduped=new r.aI(V.scheduler),this.isSpriteLoaded=we,this.scheduler=V.scheduler,this.brightness=Me}loadTile(V,W){const ae=V.uid,ye=V&&V.request,we=ye&&ye.collectResourceTiming,De=this.loading[ae]=new Ie(V);De.abort=this.loadVectorData(V,(Me,Pe)=>{const He=!this.loading[ae];if(delete this.loading[ae],De.cancelRasterize(),He||Me||!Pe)return De.status="done",He||(this.loaded[ae]=De),W(Me);const Ye=Pe.rawData,Ve={};Pe.expires&&(Ve.expires=Pe.expires),Pe.cacheControl&&(Ve.cacheControl=Pe.cacheControl),De.vectorTile=Pe.vectorTile||new r.fc.VectorTile(new r.bq(Ye));const ft=()=>{De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Pt,Vt)=>{if(Pt||!Vt)return W(Pt);const vi={};if(we){const mi=Z(ye);mi.length>0&&(vi.resourceTiming=JSON.parse(JSON.stringify(mi)))}W(null,r.l({rawTileData:Ye.slice(0)},Vt,Ve,vi))})};this.isSpriteLoaded?ft():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ft,{type:"parseTile",isSymbolTile:V.isSymbolTile,zoom:V.tileZoom}):ft()}),this.loaded=this.loaded||{},this.loaded[ae]=De})}reloadTile(V,W){const ae=this.loaded,ye=V.uid;if(ae&&ae[ye]){const we=ae[ye];we.scaleFactor=V.scaleFactor,we.showCollisionBoxes=V.showCollisionBoxes,we.projection=V.projection,we.brightness=V.brightness,we.tileTransform=r.aW(V.tileID.canonical,V.projection),we.extraShadowCaster=V.extraShadowCaster,we.lut=V.lut;const De=(Me,Pe)=>{const He=we.reloadCallback;He&&(delete we.reloadCallback,we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,He)),W(Me,Pe)};we.status==="parsing"?we.reloadCallback=De:we.status==="done"&&(we.vectorTile?we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,De):De())}else W(null,void 0)}abortTile(V,W){const ae=V.uid,ye=this.loading[ae];ye&&(ye.abort&&ye.abort(),delete this.loading[ae]),W()}removeTile(V,W){const ae=this.loaded,ye=V.uid;ae&&ae[ye]&&delete ae[ye],W()}}class Oe{loadTile(V,W){const{uid:ae,encoding:ye,rawImageData:we,padding:De}=V,Me=ImageBitmap&&we instanceof ImageBitmap?this.getImageData(we,De):we;W(null,new r.fd(ae,Me,ye,De<1))}reloadTile(V,W){W(null,null)}abortTile(V,W){W()}removeTile(V,W){W()}getImageData(V,W){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const ae=this.offscreenCanvasContext.getImageData(-W,-W,V.width+2*W,V.height+2*W);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ae}}r.bp.setPbf(r.bq);class Be{constructor(V){this._mrt=new r.bp(V.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=V.uid,this.tileID=V.tileID,this.source=V.source}parse(V,W){const ae=this._mrt;this.status="parsing",this._entireBuffer=V;try{ae.parseHeader(V),this._isHeaderLoaded=!0;const ye=[];for(const we in ae.layers){const De=ae.getLayer(we),Me=De.getDataRange(De.getBandList()),Pe=ae.createDecodingTask(Me),He=V.slice(Me.firstByte,Me.lastByte+1),Ye=r.bp.performDecoding(He,Pe).then(Ve=>Pe.complete(null,Ve)).catch(Ve=>Pe.complete(Ve,null));ye.push(Ye)}Promise.allSettled(ye).then(()=>W(null,ae)).catch(we=>W(we))}catch(ye){W(ye)}}}class je{constructor(V){this.actor=V,this.loading={},this.loaded={}}loadTile(V,W){const ae=V.uid,ye=V.request,we=this.loading[ae]=new Be(V),{cancel:De}=r.br(ye,(Me,Pe,He,Ye)=>{const Ve=!this.loading[ae];if(delete this.loading[ae],Ve||Me||!Pe)return we.status="done",Ve||(this.loaded[ae]=we),W(Me);we.parse(Pe,(ft,Pt)=>{if(ft||!Pt)return W(ft);W(null,Pt,He,Ye)}),this.loaded[ae]=we});we.abort=De}reloadTile(V,W){W(null,void 0)}abortTile(V,W){const ae=V.uid,ye=this.loading[ae];ye&&(ye.abort&&ye.abort(),delete this.loading[ae]),W()}removeTile(V,W){const ae=V.uid;this.loaded[ae]&&delete this.loaded[ae],W()}decodeRasterArray(V,W){r.bp.performDecoding(V.buffer,V.task).then(ae=>W(null,ae)).catch(ae=>W(ae))}}const at=r.fc.VectorTileFeature.prototype.toGeoJSON;class ut{constructor(V){this._feature=V,this.extent=r.aj,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))}loadGeometry(){if(this._feature.type===1){const V=[];for(const W of this._feature.geometry)V.push([new r.P(W[0],W[1])]);return V}{const V=[];for(const W of this._feature.geometry){const ae=[];for(const ye of W)ae.push(new r.P(ye[0],ye[1]));V.push(ae)}return V}}toGeoJSON(V,W,ae){return at.call(this,V,W,ae)}}class Xe{constructor(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.aj,this.length=V.length,this._features=V}feature(V){return new ut(this._features[V])}}const Tt=64/4096,vt=128;class ni{constructor(){this.features=new Map}clear(){this.features.clear()}load(V=[],W){for(const ae of V){const ye=ae.id;if(ye==null)continue;let we=this.features.get(ye);we&&this.updateCache(we,W),ae.geometry?(we=xi(ae),this.updateCache(we,W),this.features.set(ye,we)):this.features.delete(ye),this.updateCache(we,W)}}updateCache(V,W){for(const{canonical:ae,uid:ye}of Object.values(W)){const{z:we,x:De,y:Me}=ae;Pi(V,Math.pow(2,we),De,Me)&&delete W[ye]}}getTile(V,W,ae){const ye=Math.pow(2,V),we=[];for(const De of this.features.values())Pi(De,ye,W,ae)&&we.push(yi(De,ye,W,ae));return{features:we}}getFeatures(){return[...this.features.values()]}}function Pi({minX:de,minY:V,maxX:W,maxY:ae},ye,we,De){return de<(we+1+Tt)/ye&&V<(De+1+Tt)/ye&&W>(we-Tt)/ye&&ae>(De-Tt)/ye}function xi(de){const{id:V,geometry:W,properties:ae}=de;if(!W)return;if(W.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ye,coordinates:we}=W,De={id:V,type:1,geometry:[],tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Me=De.geometry;if(ye==="Point")Fi(we,Me,De);else if(ye==="MultiPoint")for(const Pe of we)Fi(Pe,Me,De);else if(ye==="LineString")De.type=2,Ei(we,Me,De);else if(ye==="MultiLineString")De.type=2,fi(we,Me,De);else if(ye==="Polygon")De.type=3,fi(we,Me,De,!0);else{if(ye!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");De.type=3;for(const Pe of we)fi(Pe,Me,De,!0)}return De}function Fi([de,V],W,ae){const ye=r.ay(de);let we=r.aH(V);we=we<0?0:we>1?1:we,W.push(ye,we),ae.minX=Math.min(ae.minX,ye),ae.minY=Math.min(ae.minY,we),ae.maxX=Math.max(ae.maxX,ye),ae.maxY=Math.max(ae.maxY,we)}function Ei(de,V,W,ae=!1,ye=!1){const we=[];for(const De of de)Fi(De,we,W);V.push(we),ae&&function(De,Me){let Pe=0;for(let He=0,Ye=De.length,Ve=Ye-2;He<Ye;Ve=He,He+=2)Pe+=(De[He]-De[Ve])*(De[He+1]+De[Ve+1]);if(Pe>0===Me)for(let He=0,Ye=De.length;He<Ye/2;He+=2){const Ve=De[He],ft=De[He+1];De[He]=De[Ye-2-He],De[He+1]=De[Ye-1-He],De[Ye-2-He]=Ve,De[Ye-1-He]=ft}}(we,ye)}function fi(de,V,W,ae=!1){for(let ye=0;ye<de.length;ye++)Ei(de[ye],V,W,ae,ye===0)}function yi(de,V,W,ae){const{id:ye,type:we,geometry:De,tags:Me}=de,Pe=[];if(we===1)(function(He,Ye,Ve,ft,Pt){for(let Vt=0;Vt<He.length;Vt+=2){const vi=Math.round(r.aj*(He[Vt+0]*Ye-Ve)),mi=Math.round(r.aj*(He[Vt+1]*Ye-ft));Pt.push([vi,mi])}})(De,V,W,ae,Pe);else for(const He of De)Je(He,V,W,ae,Pe);return{id:ye,type:we,geometry:Pe,tags:Me}}function Je(de,V,W,ae,ye){const De=r.aj+vt;let Me;for(let Pe=0;Pe<de.length-2;Pe+=2){let He=Math.round(r.aj*(de[Pe+0]*V-W)),Ye=Math.round(r.aj*(de[Pe+1]*V-ae)),Ve=Math.round(r.aj*(de[Pe+2]*V-W)),ft=Math.round(r.aj*(de[Pe+3]*V-ae));const Pt=Ve-He,Vt=ft-Ye;He<-128&&Ve<-128||(He<-128?(Ye+=Math.round(Vt*((-128-He)/Pt)),He=-128):Ve<-128&&(ft=Ye+Math.round(Vt*((-128-He)/Pt)),Ve=-128),Ye<-128&&ft<-128||(Ye<-128?(He+=Math.round(Pt*((-128-Ye)/Vt)),Ye=-128):ft<-128&&(Ve=He+Math.round(Pt*((-128-Ye)/Vt)),ft=-128),He>=De&&Ve>=De||(He>=De?(Ye+=Math.round(Vt*((De-He)/Pt)),He=De):Ve>=De&&(ft=Ye+Math.round(Vt*((De-He)/Pt)),Ve=De),Ye>=De&&ft>=De||(Ye>=De?(He+=Math.round(Pt*((De-Ye)/Vt)),Ye=De):ft>=De&&(Ve=He+Math.round(Pt*((De-Ye)/Vt)),ft=De),Me&&He===Me[Me.length-1][0]&&Ye===Me[Me.length-1][1]||(Me=[[He,Ye]],ye.push(Me)),Me.push([Ve,ft])))))}}var jt,_t,$t,Fe={exports:{}},zt=function(){if($t)return Fe.exports;$t=1;var de=r.fg(),V=function(){if(_t)return jt;_t=1;var Ye=r.fe(),Ve=r.ff().VectorTileFeature;function ft(Vt,vi){this.options=vi||{},this.features=Vt,this.length=Vt.length}function Pt(Vt,vi){this.id=typeof Vt.id=="number"?Vt.id:void 0,this.type=Vt.type,this.rawGeometry=Vt.type===1?[Vt.geometry]:Vt.geometry,this.properties=Vt.tags,this.extent=vi||4096}return jt=ft,ft.prototype.feature=function(Vt){return new Pt(this.features[Vt],this.options.extent)},Pt.prototype.loadGeometry=function(){var Vt=this.rawGeometry;this.geometry=[];for(var vi=0;vi<Vt.length;vi++){for(var mi=Vt[vi],gi=[],Gi=0;Gi<mi.length;Gi++)gi.push(new Ye(mi[Gi][0],mi[Gi][1]));this.geometry.push(gi)}return this.geometry},Pt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Vt=this.geometry,vi=1/0,mi=-1/0,gi=1/0,Gi=-1/0,In=0;In<Vt.length;In++)for(var Ui=Vt[In],yn=0;yn<Ui.length;yn++){var ln=Ui[yn];vi=Math.min(vi,ln.x),mi=Math.max(mi,ln.x),gi=Math.min(gi,ln.y),Gi=Math.max(Gi,ln.y)}return[vi,gi,mi,Gi]},Pt.prototype.toGeoJSON=Ve.prototype.toGeoJSON,jt}();function W(Ye){var Ve=new de;return function(ft,Pt){for(var Vt in ft.layers)Pt.writeMessage(3,ae,ft.layers[Vt])}(Ye,Ve),Ve.finish()}function ae(Ye,Ve){var ft;Ve.writeVarintField(15,Ye.version||1),Ve.writeStringField(1,Ye.name||""),Ve.writeVarintField(5,Ye.extent||4096);var Pt={keys:[],values:[],keycache:{},valuecache:{}};for(ft=0;ft<Ye.length;ft++)Pt.feature=Ye.feature(ft),Ve.writeMessage(2,ye,Pt);var Vt=Pt.keys;for(ft=0;ft<Vt.length;ft++)Ve.writeStringField(3,Vt[ft]);var vi=Pt.values;for(ft=0;ft<vi.length;ft++)Ve.writeMessage(4,He,vi[ft])}function ye(Ye,Ve){var ft=Ye.feature;ft.id!==void 0&&Ve.writeVarintField(1,ft.id),Ve.writeMessage(2,we,Ye),Ve.writeVarintField(3,ft.type),Ve.writeMessage(4,Pe,ft)}function we(Ye,Ve){var ft=Ye.feature,Pt=Ye.keys,Vt=Ye.values,vi=Ye.keycache,mi=Ye.valuecache;for(var gi in ft.properties){var Gi=ft.properties[gi],In=vi[gi];if(Gi!==null){In===void 0&&(Pt.push(gi),vi[gi]=In=Pt.length-1),Ve.writeVarint(In);var Ui=typeof Gi;Ui!=="string"&&Ui!=="boolean"&&Ui!=="number"&&(Gi=JSON.stringify(Gi));var yn=Ui+":"+Gi,ln=mi[yn];ln===void 0&&(Vt.push(Gi),mi[yn]=ln=Vt.length-1),Ve.writeVarint(ln)}}}function De(Ye,Ve){return(Ve<<3)+(7&Ye)}function Me(Ye){return Ye<<1^Ye>>31}function Pe(Ye,Ve){for(var ft=Ye.loadGeometry(),Pt=Ye.type,Vt=0,vi=0,mi=ft.length,gi=0;gi<mi;gi++){var Gi=ft[gi],In=1;Pt===1&&(In=Gi.length),Ve.writeVarint(De(1,In));for(var Ui=Pt===3?Gi.length-1:Gi.length,yn=0;yn<Ui;yn++){yn===1&&Pt!==1&&Ve.writeVarint(De(2,Ui-1));var ln=Gi[yn].x-Vt,Dn=Gi[yn].y-vi;Ve.writeVarint(Me(ln)),Ve.writeVarint(Me(Dn)),Vt+=ln,vi+=Dn}Pt===3&&Ve.writeVarint(De(7,1))}}function He(Ye,Ve){var ft=typeof Ye;ft==="string"?Ve.writeStringField(1,Ye):ft==="boolean"?Ve.writeBooleanField(7,Ye):ft==="number"&&(Ye%1!=0?Ve.writeDoubleField(3,Ye):Ye<0?Ve.writeSVarintField(6,Ye):Ve.writeVarintField(5,Ye))}return Fe.exports=W,Fe.exports.fromVectorTileJs=W,Fe.exports.fromGeojsonVt=function(Ye,Ve){Ve=Ve||{};var ft={};for(var Pt in Ye)ft[Pt]=new V(Ye[Pt].features,Ve),ft[Pt].name=Pt,ft[Pt].version=Ve.version,ft[Pt].extent=Ve.extent;return W({layers:ft})},Fe.exports.GeoJSONWrapper=V,Fe.exports}(),_i=r.fh(zt);const Jt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:de=>de},bi=Math.fround||(Ci=new Float32Array(1),de=>(Ci[0]=+de,Ci[0]));var Ci;const pi=3,ri=5,Yi=6;class Vi{constructor(V){this.options=Object.assign(Object.create(Jt),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:W,minZoom:ae,maxZoom:ye}=this.options;W&&console.time("total time");const we=`prepare ${V.length} points`;W&&console.time(we),this.points=V;const De=[];for(let Pe=0;Pe<V.length;Pe++){const He=V[Pe];if(!He.geometry)continue;const[Ye,Ve]=He.geometry.coordinates,ft=bi(_n(Ye)),Pt=bi(Rn(Ve));De.push(ft,Pt,1/0,Pe,-1,1),this.options.reduce&&De.push(0)}let Me=this.trees[ye+1]=this._createTree(De);W&&console.timeEnd(we);for(let Pe=ye;Pe>=ae;Pe--){const He=+Date.now();Me=this.trees[Pe]=this._createTree(this._cluster(Me,Pe)),W&&console.log("z%d: %d clusters in %dms",Pe,Me.numItems,+Date.now()-He)}return W&&console.timeEnd("total time"),this}getClusters(V,W){let ae=((V[0]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,V[1]));let we=V[2]===180?180:((V[2]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)ae=-180,we=180;else if(ae>we){const Ve=this.getClusters([ae,ye,180,De],W),ft=this.getClusters([-180,ye,we,De],W);return Ve.concat(ft)}const Me=this.trees[this._limitZoom(W)],Pe=Me.range(_n(ae),Rn(De),_n(we),Rn(ye)),He=Me.data,Ye=[];for(const Ve of Pe){const ft=this.stride*Ve;Ye.push(He[ft+ri]>1?rn(He,ft,this.clusterProps):this.points[He[ft+pi]])}return Ye}getChildren(V){const W=this._getOriginId(V),ae=this._getOriginZoom(V),ye="No cluster with the specified id.",we=this.trees[ae];if(!we)throw new Error(ye);const De=we.data;if(W*this.stride>=De.length)throw new Error(ye);const Me=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),Pe=we.within(De[W*this.stride],De[W*this.stride+1],Me),He=[];for(const Ye of Pe){const Ve=Ye*this.stride;De[Ve+4]===V&&He.push(De[Ve+ri]>1?rn(De,Ve,this.clusterProps):this.points[De[Ve+pi]])}if(He.length===0)throw new Error(ye);return He}getLeaves(V,W,ae){const ye=[];return this._appendLeaves(ye,V,W=W||10,ae=ae||0,0),ye}getTile(V,W,ae){const ye=this.trees[this._limitZoom(V)],we=Math.pow(2,V),{extent:De,radius:Me}=this.options,Pe=Me/De,He=(ae-Pe)/we,Ye=(ae+1+Pe)/we,Ve={features:[]};return this._addTileFeatures(ye.range((W-Pe)/we,He,(W+1+Pe)/we,Ye),ye.data,W,ae,we,Ve),W===0&&this._addTileFeatures(ye.range(1-Pe/we,He,1,Ye),ye.data,we,ae,we,Ve),W===we-1&&this._addTileFeatures(ye.range(0,He,Pe/we,Ye),ye.data,-1,ae,we,Ve),Ve.features.length?Ve:null}getClusterExpansionZoom(V){let W=this._getOriginZoom(V)-1;for(;W<=this.options.maxZoom;){const ae=this.getChildren(V);if(W++,ae.length!==1)break;V=ae[0].properties.cluster_id}return W}_appendLeaves(V,W,ae,ye,we){const De=this.getChildren(W);for(const Me of De){const Pe=Me.properties;if(Pe&&Pe.cluster?we+Pe.point_count<=ye?we+=Pe.point_count:we=this._appendLeaves(V,Pe.cluster_id,ae,ye,we):we<ye?we++:V.push(Me),V.length===ae)break}return we}_createTree(V){const W=new r.bW(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ae=0;ae<V.length;ae+=this.stride)W.add(V[ae],V[ae+1]);return W.finish(),W.data=V,W}_addTileFeatures(V,W,ae,ye,we,De){for(const Me of V){const Pe=Me*this.stride,He=W[Pe+ri]>1;let Ye,Ve,ft;if(He)Ye=xn(W,Pe,this.clusterProps),Ve=W[Pe],ft=W[Pe+1];else{const vi=this.points[W[Pe+pi]];Ye=vi.properties;const[mi,gi]=vi.geometry.coordinates;Ve=_n(mi),ft=Rn(gi)}const Pt={type:1,geometry:[[Math.round(this.options.extent*(Ve*we-ae)),Math.round(this.options.extent*(ft*we-ye))]],tags:Ye};let Vt;Vt=He||this.options.generateId?W[Pe+pi]:this.points[W[Pe+pi]].id,Vt!==void 0&&(Pt.id=Vt),De.features.push(Pt)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,W){const{radius:ae,extent:ye,reduce:we,minPoints:De}=this.options,Me=ae/(ye*Math.pow(2,W)),Pe=V.data,He=[],Ye=this.stride;for(let Ve=0;Ve<Pe.length;Ve+=Ye){if(Pe[Ve+2]<=W)continue;Pe[Ve+2]=W;const ft=Pe[Ve],Pt=Pe[Ve+1],Vt=V.within(Pe[Ve],Pe[Ve+1],Me),vi=Pe[Ve+ri];let mi=vi;for(const gi of Vt){const Gi=gi*Ye;Pe[Gi+2]>W&&(mi+=Pe[Gi+ri])}if(mi>vi&&mi>=De){let gi,Gi=ft*vi,In=Pt*vi,Ui=-1;const yn=(Ve/Ye<<5)+(W+1)+this.points.length;for(const ln of Vt){const Dn=ln*Ye;if(Pe[Dn+2]<=W)continue;Pe[Dn+2]=W;const Gn=Pe[Dn+ri];Gi+=Pe[Dn]*Gn,In+=Pe[Dn+1]*Gn,Pe[Dn+4]=yn,we&&(gi||(gi=this._map(Pe,Ve,!0),Ui=this.clusterProps.length,this.clusterProps.push(gi)),we(gi,this._map(Pe,Dn)))}Pe[Ve+4]=yn,He.push(Gi/mi,In/mi,1/0,yn,-1,mi),we&&He.push(Ui)}else{for(let gi=0;gi<Ye;gi++)He.push(Pe[Ve+gi]);if(mi>1)for(const gi of Vt){const Gi=gi*Ye;if(!(Pe[Gi+2]<=W)){Pe[Gi+2]=W;for(let In=0;In<Ye;In++)He.push(Pe[Gi+In])}}}}return He}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,W,ae){if(V[W+ri]>1){const De=this.clusterProps[V[W+Yi]];return ae?Object.assign({},De):De}const ye=this.points[V[W+pi]].properties,we=this.options.map(ye);return ae&&we===ye?Object.assign({},we):we}}function rn(de,V,W){return{type:"Feature",id:de[V+pi],properties:xn(de,V,W),geometry:{type:"Point",coordinates:[(ae=de[V],360*(ae-.5)),Jr(de[V+1])]}};var ae}function xn(de,V,W){const ae=de[V+ri],ye=ae>=1e4?`${Math.round(ae/1e3)}k`:ae>=1e3?Math.round(ae/100)/10+"k":ae,we=de[V+Yi],De=we===-1?{}:Object.assign({},W[we]);return Object.assign(De,{cluster:!0,cluster_id:de[V+pi],point_count:ae,point_count_abbreviated:ye})}function _n(de){return de/360+.5}function Rn(de){const V=Math.sin(de*Math.PI/180),W=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return W<0?0:W>1?1:W}function Jr(de){const V=(180-360*de)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function io(de,V,W,ae){let ye=ae;const we=V+(W-V>>1);let De,Me=W-V;const Pe=de[V],He=de[V+1],Ye=de[W],Ve=de[W+1];for(let ft=V+3;ft<W;ft+=3){const Pt=ea(de[ft],de[ft+1],Pe,He,Ye,Ve);if(Pt>ye)De=ft,ye=Pt;else if(Pt===ye){const Vt=Math.abs(ft-we);Vt<Me&&(De=ft,Me=Vt)}}ye>ae&&(De-V>3&&io(de,V,De,ae),de[De+2]=ye,W-De>3&&io(de,De,W,ae))}function ea(de,V,W,ae,ye,we){let De=ye-W,Me=we-ae;if(De!==0||Me!==0){const Pe=((de-W)*De+(V-ae)*Me)/(De*De+Me*Me);Pe>1?(W=ye,ae=we):Pe>0&&(W+=De*Pe,ae+=Me*Pe)}return De=de-W,Me=V-ae,De*De+Me*Me}function kr(de,V,W,ae){const ye={id:de??null,type:V,geometry:W,tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(V==="Point"||V==="MultiPoint"||V==="LineString")is(ye,W);else if(V==="Polygon")is(ye,W[0]);else if(V==="MultiLineString")for(const we of W)is(ye,we);else if(V==="MultiPolygon")for(const we of W)is(ye,we[0]);return ye}function is(de,V){for(let W=0;W<V.length;W+=3)de.minX=Math.min(de.minX,V[W]),de.minY=Math.min(de.minY,V[W+1]),de.maxX=Math.max(de.maxX,V[W]),de.maxY=Math.max(de.maxY,V[W+1])}function la(de,V,W,ae){if(!V.geometry)return;const ye=V.geometry.coordinates;if(ye&&ye.length===0)return;const we=V.geometry.type,De=Math.pow(W.tolerance/((1<<W.maxZoom)*W.extent),2);let Me=[],Pe=V.id;if(W.promoteId?Pe=V.properties[W.promoteId]:W.generateId&&(Pe=ae||0),we==="Point")vo(ye,Me);else if(we==="MultiPoint")for(const He of ye)vo(He,Me);else if(we==="LineString")Uo(ye,Me,De,!1);else if(we==="MultiLineString"){if(W.lineMetrics){for(const He of ye)Me=[],Uo(He,Me,De,!1),de.push(kr(Pe,"LineString",Me,V.properties));return}Da(ye,Me,De,!1)}else if(we==="Polygon")Da(ye,Me,De,!0);else{if(we!=="MultiPolygon"){if(we==="GeometryCollection"){for(const He of V.geometry.geometries)la(de,{id:Pe,geometry:He,properties:V.properties},W,ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const He of ye){const Ye=[];Da(He,Ye,De,!0),Me.push(Ye)}}de.push(kr(Pe,we,Me,V.properties))}function vo(de,V){V.push(xo(de[0]),wa(de[1]),0)}function Uo(de,V,W,ae){let ye,we,De=0;for(let Pe=0;Pe<de.length;Pe++){const He=xo(de[Pe][0]),Ye=wa(de[Pe][1]);V.push(He,Ye,0),Pe>0&&(De+=ae?(ye*Ye-He*we)/2:Math.sqrt(Math.pow(He-ye,2)+Math.pow(Ye-we,2))),ye=He,we=Ye}const Me=V.length-3;V[2]=1,io(V,0,Me,W),V[Me+2]=1,V.size=Math.abs(De),V.start=0,V.end=V.size}function Da(de,V,W,ae){for(let ye=0;ye<de.length;ye++){const we=[];Uo(de[ye],we,W,ae),V.push(we)}}function xo(de){return de/360+.5}function wa(de){const V=Math.sin(de*Math.PI/180),W=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return W<0?0:W>1?1:W}function za(de,V,W,ae,ye,we,De,Me){if(ae/=V,we>=(W/=V)&&De<ae)return de;if(De<W||we>=ae)return null;const Pe=[];for(const He of de){const Ye=He.geometry;let Ve=He.type;const ft=ye===0?He.minX:He.minY,Pt=ye===0?He.maxX:He.maxY;if(ft>=W&&Pt<ae){Pe.push(He);continue}if(Pt<W||ft>=ae)continue;let Vt=[];if(Ve==="Point"||Ve==="MultiPoint")Ta(Ye,Vt,W,ae,ye);else if(Ve==="LineString")Ir(Ye,Vt,W,ae,ye,!1,Me.lineMetrics);else if(Ve==="MultiLineString")Hr(Ye,Vt,W,ae,ye,!1);else if(Ve==="Polygon")Hr(Ye,Vt,W,ae,ye,!0);else if(Ve==="MultiPolygon")for(const vi of Ye){const mi=[];Hr(vi,mi,W,ae,ye,!0),mi.length&&Vt.push(mi)}if(Vt.length){if(Me.lineMetrics&&Ve==="LineString"){for(const vi of Vt)Pe.push(kr(He.id,Ve,vi,He.tags));continue}Ve!=="LineString"&&Ve!=="MultiLineString"||(Vt.length===1?(Ve="LineString",Vt=Vt[0]):Ve="MultiLineString"),Ve!=="Point"&&Ve!=="MultiPoint"||(Ve=Vt.length===3?"Point":"MultiPoint"),Pe.push(kr(He.id,Ve,Vt,He.tags))}}return Pe.length?Pe:null}function Ta(de,V,W,ae,ye){for(let we=0;we<de.length;we+=3){const De=de[we+ye];De>=W&&De<=ae&&Es(V,de[we],de[we+1],de[we+2])}}function Ir(de,V,W,ae,ye,we,De){let Me=ja(de);const Pe=ye===0?ta:Qs;let He,Ye,Ve=de.start;for(let mi=0;mi<de.length-3;mi+=3){const gi=de[mi],Gi=de[mi+1],In=de[mi+2],Ui=de[mi+3],yn=de[mi+4],ln=ye===0?gi:Gi,Dn=ye===0?Ui:yn;let Gn=!1;De&&(He=Math.sqrt(Math.pow(gi-Ui,2)+Math.pow(Gi-yn,2))),ln<W?Dn>W&&(Ye=Pe(Me,gi,Gi,Ui,yn,W),De&&(Me.start=Ve+He*Ye)):ln>ae?Dn<ae&&(Ye=Pe(Me,gi,Gi,Ui,yn,ae),De&&(Me.start=Ve+He*Ye)):Es(Me,gi,Gi,In),Dn<W&&ln>=W&&(Ye=Pe(Me,gi,Gi,Ui,yn,W),Gn=!0),Dn>ae&&ln<=ae&&(Ye=Pe(Me,gi,Gi,Ui,yn,ae),Gn=!0),!we&&Gn&&(De&&(Me.end=Ve+He*Ye),V.push(Me),Me=ja(de)),De&&(Ve+=He)}let ft=de.length-3;const Pt=de[ft],Vt=de[ft+1],vi=ye===0?Pt:Vt;vi>=W&&vi<=ae&&Es(Me,Pt,Vt,de[ft+2]),ft=Me.length-3,we&&ft>=3&&(Me[ft]!==Me[0]||Me[ft+1]!==Me[1])&&Es(Me,Me[0],Me[1],Me[2]),Me.length&&V.push(Me)}function ja(de){const V=[];return V.size=de.size,V.start=de.start,V.end=de.end,V}function Hr(de,V,W,ae,ye,we){for(const De of de)Ir(De,V,W,ae,ye,we,!1)}function Es(de,V,W,ae){de.push(V,W,ae)}function ta(de,V,W,ae,ye,we){const De=(we-V)/(ae-V);return Es(de,we,W+(ye-W)*De,1),De}function Qs(de,V,W,ae,ye,we){const De=(we-W)/(ye-W);return Es(de,V+(ae-V)*De,we,1),De}function bo(de,V){const W=[];for(let ae=0;ae<de.length;ae++){const ye=de[ae],we=ye.type;let De;if(we==="Point"||we==="MultiPoint"||we==="LineString")De=Ua(ye.geometry,V);else if(we==="MultiLineString"||we==="Polygon"){De=[];for(const Me of ye.geometry)De.push(Ua(Me,V))}else if(we==="MultiPolygon"){De=[];for(const Me of ye.geometry){const Pe=[];for(const He of Me)Pe.push(Ua(He,V));De.push(Pe)}}W.push(kr(ye.id,we,De,ye.tags))}return W}function Ua(de,V){const W=[];W.size=de.size,de.start!==void 0&&(W.start=de.start,W.end=de.end);for(let ae=0;ae<de.length;ae+=3)W.push(de[ae]+V,de[ae+1],de[ae+2]);return W}function no(de,V){if(de.transformed)return de;const W=1<<de.z,ae=de.x,ye=de.y;for(const we of de.features){const De=we.geometry,Me=we.type;if(we.geometry=[],Me===1)for(let Pe=0;Pe<De.length;Pe+=2)we.geometry.push(Vo(De[Pe],De[Pe+1],V,W,ae,ye));else for(let Pe=0;Pe<De.length;Pe++){const He=[];for(let Ye=0;Ye<De[Pe].length;Ye+=2)He.push(Vo(De[Pe][Ye],De[Pe][Ye+1],V,W,ae,ye));we.geometry.push(He)}}return de.transformed=!0,de}function Vo(de,V,W,ae,ye,we){return[Math.round(W*(de*ae-ye)),Math.round(W*(V*ae-we))]}function wo(de,V,W,ae,ye){const we=V===ye.maxZoom?0:ye.tolerance/((1<<V)*ye.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:de.length,source:null,x:W,y:ae,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Me of de)Jn(De,Me,we,ye);return De}function Jn(de,V,W,ae){const ye=V.geometry,we=V.type,De=[];if(de.minX=Math.min(de.minX,V.minX),de.minY=Math.min(de.minY,V.minY),de.maxX=Math.max(de.maxX,V.maxX),de.maxY=Math.max(de.maxY,V.maxY),we==="Point"||we==="MultiPoint")for(let Me=0;Me<ye.length;Me+=3)De.push(ye[Me],ye[Me+1]),de.numPoints++,de.numSimplified++;else if(we==="LineString")ro(De,ye,de,W,!1,!1);else if(we==="MultiLineString"||we==="Polygon")for(let Me=0;Me<ye.length;Me++)ro(De,ye[Me],de,W,we==="Polygon",Me===0);else if(we==="MultiPolygon")for(let Me=0;Me<ye.length;Me++){const Pe=ye[Me];for(let He=0;He<Pe.length;He++)ro(De,Pe[He],de,W,!0,He===0)}if(De.length){let Me=V.tags||null;if(we==="LineString"&&ae.lineMetrics){Me={};for(const He in V.tags)Me[He]=V.tags[He];Me.mapbox_clip_start=ye.start/ye.size,Me.mapbox_clip_end=ye.end/ye.size}const Pe={geometry:De,type:we==="Polygon"||we==="MultiPolygon"?3:we==="LineString"||we==="MultiLineString"?2:1,tags:Me};V.id!==null&&(Pe.id=V.id),de.features.push(Pe)}}function ro(de,V,W,ae,ye,we){const De=ae*ae;if(ae>0&&V.size<(ye?De:ae))return void(W.numPoints+=V.length/3);const Me=[];for(let Pe=0;Pe<V.length;Pe+=3)(ae===0||V[Pe+2]>De)&&(W.numSimplified++,Me.push(V[Pe],V[Pe+1])),W.numPoints++;ye&&function(Pe,He){let Ye=0;for(let Ve=0,ft=Pe.length,Pt=ft-2;Ve<ft;Pt=Ve,Ve+=2)Ye+=(Pe[Ve]-Pe[Pt])*(Pe[Ve+1]+Pe[Pt+1]);if(Ye>0===He)for(let Ve=0,ft=Pe.length;Ve<ft/2;Ve+=2){const Pt=Pe[Ve],Vt=Pe[Ve+1];Pe[Ve]=Pe[ft-2-Ve],Pe[Ve+1]=Pe[ft-1-Ve],Pe[ft-2-Ve]=Pt,Pe[ft-1-Ve]=Vt}}(Me,we),de.push(Me)}const fl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Pa{constructor(V,W){const ae=(W=this.options=function(we,De){for(const Me in De)we[Me]=De[Me];return we}(Object.create(fl),W)).debug;if(ae&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");let ye=function(we,De){const Me=[];if(we.type==="FeatureCollection")for(let Pe=0;Pe<we.features.length;Pe++)la(Me,we.features[Pe],De,Pe);else la(Me,we.type==="Feature"?we:{geometry:we},De);return Me}(V,W);this.tiles={},this.tileCoords=[],ae&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ye=function(we,De){const Me=De.buffer/De.extent;let Pe=we;const He=za(we,1,-1-Me,Me,0,-1,2,De),Ye=za(we,1,1-Me,2+Me,0,-1,2,De);return(He||Ye)&&(Pe=za(we,1,-Me,1+Me,0,-1,2,De)||[],He&&(Pe=bo(He,1).concat(Pe)),Ye&&(Pe=Pe.concat(bo(Ye,-1)))),Pe}(ye,W),ye.length&&this.splitTile(ye,0,0,0),ae&&(ye.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(V,W,ae,ye,we,De,Me){const Pe=[V,W,ae,ye],He=this.options,Ye=He.debug;for(;Pe.length;){ye=Pe.pop(),ae=Pe.pop(),W=Pe.pop(),V=Pe.pop();const Ve=1<<W,ft=As(W,ae,ye);let Pt=this.tiles[ft];if(!Pt&&(Ye>1&&console.time("creation"),Pt=this.tiles[ft]=wo(V,W,ae,ye,He),this.tileCoords.push({z:W,x:ae,y:ye}),Ye)){Ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,ae,ye,Pt.numFeatures,Pt.numPoints,Pt.numSimplified),console.timeEnd("creation"));const Gn=`z${W}`;this.stats[Gn]=(this.stats[Gn]||0)+1,this.total++}if(Pt.source=V,we==null){if(W===He.indexMaxZoom||Pt.numPoints<=He.indexMaxPoints)continue}else{if(W===He.maxZoom||W===we)continue;if(we!=null){const Gn=we-W;if(ae!==De>>Gn||ye!==Me>>Gn)continue}}if(Pt.source=null,V.length===0)continue;Ye>1&&console.time("clipping");const Vt=.5*He.buffer/He.extent,vi=.5-Vt,mi=.5+Vt,gi=1+Vt;let Gi=null,In=null,Ui=null,yn=null,ln=za(V,Ve,ae-Vt,ae+mi,0,Pt.minX,Pt.maxX,He),Dn=za(V,Ve,ae+vi,ae+gi,0,Pt.minX,Pt.maxX,He);V=null,ln&&(Gi=za(ln,Ve,ye-Vt,ye+mi,1,Pt.minY,Pt.maxY,He),In=za(ln,Ve,ye+vi,ye+gi,1,Pt.minY,Pt.maxY,He),ln=null),Dn&&(Ui=za(Dn,Ve,ye-Vt,ye+mi,1,Pt.minY,Pt.maxY,He),yn=za(Dn,Ve,ye+vi,ye+gi,1,Pt.minY,Pt.maxY,He),Dn=null),Ye>1&&console.timeEnd("clipping"),Pe.push(Gi||[],W+1,2*ae,2*ye),Pe.push(In||[],W+1,2*ae,2*ye+1),Pe.push(Ui||[],W+1,2*ae+1,2*ye),Pe.push(yn||[],W+1,2*ae+1,2*ye+1)}}getTile(V,W,ae){V=+V,W=+W,ae=+ae;const ye=this.options,{extent:we,debug:De}=ye;if(V<0||V>24)return null;const Me=1<<V,Pe=As(V,W=W+Me&Me-1,ae);if(this.tiles[Pe])return no(this.tiles[Pe],we);De>1&&console.log("drilling down to z%d-%d-%d",V,W,ae);let He,Ye=V,Ve=W,ft=ae;for(;!He&&Ye>0;)Ye--,Ve>>=1,ft>>=1,He=this.tiles[As(Ye,Ve,ft)];return He&&He.source?(De>1&&(console.log("found parent tile z%d-%d-%d",Ye,Ve,ft),console.time("drilling down")),this.splitTile(He.source,Ye,Ve,ft,V,W,ae),De>1&&console.timeEnd("drilling down"),this.tiles[Pe]?no(this.tiles[Pe],we):null):null}}function As(de,V,W){return 32*((1<<de)*W+V)+de}function Pc(de,V){const W=de.tileID.canonical;if(!this._geoJSONIndex)return void V(null,null);const ae=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!ae)return void V(null,null);const ye=new Xe(ae.features);let we=_i(ye);we.byteOffset===0&&we.byteLength===we.buffer.byteLength||(we=new Uint8Array(we)),V(null,{vectorTile:ye,rawData:we.buffer})}class Ms extends ke{constructor(V,W,ae,ye,we,De,Me){super(V,W,ae,ye,we,Pc,Me),De&&(this.loadGeoJSON=De),this._dynamicIndex=new ni}loadData(V,W){const ae=V&&V.request,ye=ae&&ae.collectResourceTiming;this.loadGeoJSON(V,(we,De)=>{if(we||!De)return W(we);if(typeof De!="object")return W(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{try{if(V.filter){const Pe=r.X(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Pe.result==="error")throw new Error(Pe.value.map(He=>`${He.key}: ${He.message}`).join(", "));De.features=De.features.filter(He=>Pe.value.evaluate({zoom:0},He))}V.dynamic?(De.type==="Feature"&&(De={type:"FeatureCollection",features:[De]}),V.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(De.features,this.loaded),V.cluster&&(De.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=V.cluster?new Vi(function({superclusterOptions:Pe,clusterProperties:He}){if(!He||!Pe)return Pe;const Ye={},Ve={},ft={accumulated:null,zoom:0},Pt={properties:null},Vt=Object.keys(He);for(const vi of Vt){const[mi,gi]=He[vi],Gi=r.X(gi),In=r.X(typeof mi=="string"?[mi,["accumulated"],["get",vi]]:mi);Ye[vi]=Gi.value,Ve[vi]=In.value}return Pe.map=vi=>{Pt.properties=vi;const mi={};for(const gi of Vt)mi[gi]=Ye[gi].evaluate(ft,Pt);return mi},Pe.reduce=(vi,mi)=>{Pt.properties=mi;for(const gi of Vt)ft.accumulated=vi[gi],vi[gi]=Ve[gi].evaluate(ft,Pt)},Pe}(V)).load(De.features):V.dynamic?this._dynamicIndex:function(Pe,He){return new Pa(Pe,He)}(De,V.geojsonVtOptions)}catch(Pe){return W(Pe)}const Me={};if(ye){const Pe=Z(ae);Pe&&(Me.resourceTiming={},Me.resourceTiming[V.source]=JSON.parse(JSON.stringify(Pe)))}W(null,Me)}})}reloadTile(V,W){const ae=this.loaded;return ae&&ae[V.uid]?V.partial?W(null,void 0):super.reloadTile(V,W):this.loadTile(V,W)}loadGeoJSON(V,W){if(V.request)r.n(V.request,W);else{if(typeof V.data!="string")return W(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));try{return W(null,JSON.parse(V.data))}catch{return W(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(V,W){try{W(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(ae){W(ae)}}getClusterChildren(V,W){try{W(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(ae){W(ae)}}getClusterLeaves(V,W){try{W(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(ae){W(ae)}}}class Bt{constructor(V,W){this.tileID=new r.aM(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.tileZoom=V.tileZoom,this.uid=V.uid,this.zoom=V.zoom,this.canonical=V.tileID.canonical,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=V.projection,this.brightness=W}parse(V,W,ae,ye){this.status="parsing";const we=new r.aM(ae.tileID.overscaledZ,ae.tileID.wrap,ae.tileID.canonical.z,ae.tileID.canonical.x,ae.tileID.canonical.y),De=[],Me=W.familiesBySource[ae.source],Pe=new r.f0(we,ae.promoteId);Pe.bucketLayerIDs=[],Pe.is3DTile=!0,r.fi(V).then(He=>{if(!He)return ye(new Error("Could not parse tile"));const Ye=r.fj(He,1/r.cT(ae.tileID.canonical)),Ve=He.json.extensionsUsed&&He.json.extensionsUsed.includes("MAPBOX_mesh_features")||He.json.asset.extras&&He.json.asset.extras.MAPBOX_mesh_features,ft=He.json.extensionsUsed&&He.json.extensionsUsed.includes("EXT_meshopt_compression"),Pt=new r.aa(this.zoom,{brightness:this.brightness});for(const Vt in Me)for(const vi of Me[Vt]){const mi=vi[0];Pe.bucketLayerIDs.push(vi.map(Gi=>r.C(Gi.id,Gi.scope))),mi.recalculate(Pt,[]);const gi=new r.fk(vi,Ye,we,Ve,ft,this.brightness,Pe);Ve||(gi.needsUpload=!0),De.push(gi),gi.evaluate(mi)}this.status="done",ye(null,{buckets:De,featureIndex:Pe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(He=>ye(new Error(He.message)))}}class Go{constructor(V,W,ae,ye,we,De,Me){this.actor=V,this.layerIndex=W,this.availableImages=ae,this.availableModels=ye,this.brightness=Me,this.loading={},this.loaded={}}loadTile(V,W){const ae=V.uid,ye=this.loading[ae]=new Bt(V,this.brightness);r.br(V.request,(we,De)=>{const Me=!this.loading[ae];return delete this.loading[ae],Me||we?(ye.status="done",Me||(this.loaded[ae]=ye),W(we)):De&&De.byteLength!==0?void ye.parse(De,this.layerIndex,V,(Pe,He)=>{ye.status="done",this.loaded=this.loaded||{},this.loaded[ae]=ye,Pe||!He?W(Pe):W(null,He)}):(ye.status="done",this.loaded[ae]=ye,W())})}reloadTile(V,W){const ae=this.loaded,ye=V.uid;if(ae&&ae[ye]){const we=ae[ye];we.projection=V.projection,we.brightness=V.brightness;const De=(Me,Pe)=>{we.reloadCallback&&(delete we.reloadCallback,this.loadTile(V,W)),W(Me,Pe)};we.status==="parsing"?we.reloadCallback=De:we.status==="done"&&this.loadTile(V,W)}}abortTile(V,W){const ae=V.uid;this.loading[ae]&&delete this.loading[ae],W()}removeTile(V,W){const ae=this.loaded,ye=V.uid;ae&&ae[ye]&&delete ae[ye],W()}}class $l{constructor(V){this.self=V,this.actor=new r.fm(V,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new r.y,this.projections={},this.defaultProjection=r.ce({name:"mercator"}),this.workerSourceTypes={vector:ke,geojson:Ms,"raster-dem":Oe,"raster-array":je,"batched-model":Go},this.workerSources={},this.self.registerWorkerSource=(W,ae)=>{if(this.workerSourceTypes[W])throw new Error(`Worker source with name "${W}" already registered.`);this.workerSourceTypes[W]=ae},this.self.registerRTLTextPlugin=W=>{if(r.fn.isParsed())throw new Error("RTL text plugin already registered.");r.fn.applyArabicShaping=W.applyArabicShaping,r.fn.processBidirectionalText=W.processBidirectionalText,r.fn.processStyledBidirectionalText=W.processStyledBidirectionalText}}clearCaches(V,W,ae){delete this.layerIndexes[V],delete this.availableImages[V],delete this.availableModels[V],delete this.workerSources[V],ae()}checkIfReady(V,W,ae){ae()}setReferrer(V,W){this.referrer=W}spriteLoaded(V,W){this.isSpriteLoaded[V]||(this.isSpriteLoaded[V]={});const{scope:ae,isLoaded:ye}=W;if(this.isSpriteLoaded[V][ae]=ye,this.workerSources[V]&&this.workerSources[V][ae])for(const we in this.workerSources[V][ae]){const De=this.workerSources[V][ae][we];for(const Me in De){const Pe=De[Me];Pe instanceof ke&&(Pe.isSpriteLoaded=ye,Pe.fire(new r.A("isSpriteLoaded")))}}}setImages(V,W,ae){this.availableImages[V]||(this.availableImages[V]={});const{scope:ye,images:we}=W;if(this.availableImages[V][ye]=we,this.workerSources[V]&&this.workerSources[V][ye]){for(const De in this.workerSources[V][ye]){const Me=this.workerSources[V][ye][De];for(const Pe in Me)Me[Pe].availableImages=we}ae()}else ae()}setModels(V,{scope:W,models:ae},ye){if(this.availableModels[V]||(this.availableModels[V]={}),this.availableModels[V][W]=ae,this.workerSources[V]&&this.workerSources[V][W]){for(const we in this.workerSources[V][W]){const De=this.workerSources[V][W][we];for(const Me in De)De[Me].availableModels=ae}ye()}else ye()}setProjection(V,W){this.projections[V]=r.ce(W)}setBrightness(V,W,ae){this.brightness=W,ae()}setLayers(V,W,ae){this.getLayerIndex(V,W.scope).replace(W.layers,W.options),ae()}updateLayers(V,W,ae){this.getLayerIndex(V,W.scope).update(W.layers,W.removedIds,W.options),ae()}loadTile(V,W,ae){W.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,W.type,W.source,W.scope).loadTile(W,ae)}decodeRasterArray(V,W,ae){this.getWorkerSource(V,W.type,W.source,W.scope).decodeRasterArray(W,ae)}reloadTile(V,W,ae){W.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,W.type,W.source,W.scope).reloadTile(W,ae)}abortTile(V,W,ae){this.getWorkerSource(V,W.type,W.source,W.scope).abortTile(W,ae)}removeTile(V,W,ae){this.getWorkerSource(V,W.type,W.source,W.scope).removeTile(W,ae)}removeSource(V,W,ae){if(!(this.workerSources[V]&&this.workerSources[V][W.scope]&&this.workerSources[V][W.scope][W.type]&&this.workerSources[V][W.scope][W.type][W.source]))return;const ye=this.workerSources[V][W.scope][W.type][W.source];delete this.workerSources[V][W.scope][W.type][W.source],ye.removeSource!==void 0?ye.removeSource(W,ae):ae()}loadWorkerSource(V,W,ae){try{this.self.importScripts(W.url),ae()}catch(ye){ae(ye.toString())}}syncRTLPluginState(V,W,ae){try{r.fn.setState(W);const ye=r.fn.getPluginURL();if(r.fn.isLoaded()&&!r.fn.isParsed()&&ye!=null){this.self.importScripts(ye);const we=r.fn.isParsed();ae(we?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ye}`),we)}}catch(ye){ae(ye.toString())}}setDracoUrl(V,W){this.dracoUrl=W}getAvailableImages(V,W){this.availableImages[V]||(this.availableImages[V]={});let ae=this.availableImages[V][W];return ae||(ae=[]),ae}getAvailableModels(V,W){this.availableModels[V]||(this.availableModels[V]={});let ae=this.availableModels[V][W];return ae||(ae={}),ae}getLayerIndex(V,W){this.layerIndexes[V]||(this.layerIndexes[V]={});let ae=this.layerIndexes[V][W];return ae||(ae=this.layerIndexes[V][W]=new oe,ae.scope=W),ae}getWorkerSource(V,W,ae,ye){const we=this.workerSources;return we[V]||(we[V]={}),we[V][ye]||(we[V][ye]={}),we[V][ye][W]||(we[V][ye][W]={}),this.isSpriteLoaded[V]||(this.isSpriteLoaded[V]={}),we[V][ye][W][ae]||(we[V][ye][W][ae]=new this.workerSourceTypes[W]({send:(De,Me,Pe,He,Ye,Ve)=>this.actor.send(De,Me,Pe,V,Ye,Ve),scheduler:this.actor.scheduler},this.getLayerIndex(V,ye),this.getAvailableImages(V,ye),this.getAvailableModels(V,ye),this.isSpriteLoaded[V][ye],void 0,this.brightness)),we[V][ye][W][ae]}rasterizeImagesWorker(V,W,ae){const ye=new Map;for(const[we,{image:De,imageVariant:Me}]of W.tasks.entries()){const Pe=this.imageRasterizer.rasterize(Me,De,W.scope,V);ye.set(we,Pe)}ae(void 0,ye)}removeRasterizedImages(V,W,ae){this.imageRasterizer.removeImagesFromCacheByIds(W.imageIds,W.scope,V),ae()}enforceCacheSizeLimit(V,W){r.fo(W)}getWorkerPerformanceMetrics(V,W,ae){ae(void 0,void 0)}}return r.fl(self)&&(self.worker=new $l(self)),$l}),N(["./shared"],function(r){var Z="3.12.0";const $={create:"create",load:"load",fullLoad:"fullLoad"},ie={mark(c){performance.mark(c)},measure(c,t,a){performance.measure(c,t,a)}};function oe(c){const t=c.name.split("?")[0];return r.a(t)&&t.includes("mapbox-gl.js")?"javascript":r.a(t)&&t.includes("mapbox-gl.css")?"css":r.b(t)?"fontRange":r.c(t)?"sprite":r.i(t)?"style":r.d(t)?"tilejson":"other"}var fe,Re={},Ie=function(){if(fe)return Re;function c(u){return!t(u)}function t(u){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,w=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(w);try{v=new Worker(A),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(A),g}()?function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var w=v.getImageData(0,0,1,1);return w&&w.width===g.width}()?(a[p=u&&u.failIfMajorPerformanceCaveat]===void 0&&(a[p]=function(g){var v,w=function(A){var I=document.createElement("canvas"),z=Object.create(c.webGLContextAttributes);return z.failIfMajorPerformanceCaveat=A,I.getContext("webgl2",z)}(g);if(!w)return!1;try{v=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!v||w.isContextLost())&&(w.shaderSource(v,"void main() {}"),w.compileShader(v),w.getShaderParameter(v,w.COMPILE_STATUS)===!0)}(p)),a[p]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var p}fe=1,Re.supported=c,Re.notSupportedReason=t;var a={};return c.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Re}();function be(c,t,a){const u=document.createElement(c);return t!=null&&(u.className=t),a&&a.appendChild(u),u}function ke(c,t,a){const u=document.createElementNS("http://www.w3.org/2000/svg",c);for(const p of Object.keys(t))u.setAttributeNS(null,p,String(t[p]));return a&&a.appendChild(u),u}const Oe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Be=Oe&&Oe.userSelect!==void 0?"userSelect":"WebkitUserSelect";let je;function at(){Oe&&Be&&(je=Oe[Be],Oe[Be]="none")}function ut(){Oe&&Be&&(Oe[Be]=je)}function Xe(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",Xe,!0)}function Tt(){window.addEventListener("click",Xe,!0),window.setTimeout(()=>{window.removeEventListener("click",Xe,!0)},0)}function vt(c,t){const a=c.getBoundingClientRect();return xi(c,a,t)}function ni(c,t){const a=c.getBoundingClientRect(),u=[];for(let p=0;p<t.length;p++)u.push(xi(c,a,t[p]));return u}function Pi(c){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&c.button===2&&c.ctrlKey?0:c.button}function xi(c,t,a){const u=c.offsetWidth===t.width?1:c.offsetWidth/t.width;return new r.P((a.clientX-t.left)*u,(a.clientY-t.top)*u)}const Fi="01",Ei="NO_ACCESS_TOKEN";class fi{constructor(t,a,u){this._transformRequestFn=t,this._customAccessToken=a,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const t=function(){let a="";for(let u=0;u<10;u++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Fi,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}normalizeStyleURL(t,a){if(!r.f(t))return t;const u=Je(t);return u.params.push(`sdk=js-${Z}`),u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||a)}normalizeGlyphsURL(t,a){if(!r.f(t))return t;const u=Je(t);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||a)}normalizeModelURL(t,a){if(!r.f(t))return t;const u=Je(t);return u.path=`/models/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||a)}normalizeSourceURL(t,a,u,p){if(!r.f(t))return t;const g=Je(t);return g.path=`/v4/${g.authority}.json`,g.params.push("secure"),u&&g.params.push(`language=${u}`),p&&g.params.push(`worldview=${p}`),this._makeAPIURL(g,this._customAccessToken||a)}normalizeIconsetURL(t,a){const u=Je(t);return r.f(t)?(u.path=`/styles/v1${u.path}/iconset.pbf`,this._makeAPIURL(u,this._customAccessToken||a)):jt(u)}normalizeSpriteURL(t,a,u,p){const g=Je(t);return r.f(t)?(g.path=`/styles/v1${g.path}/sprite${a}${u}`,this._makeAPIURL(g,this._customAccessToken||p)):(g.path+=`${a}${u}`,jt(g))}normalizeTileURL(t,a,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!r.f(t))return t;const p=Je(t);p.path=p.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||u&&p.authority!=="raster"&&u===512?"@2x":""}${r.m.supported?".webp":"$1"}`),p.authority==="raster"?p.path=`/${r.e.RASTER_URL_PREFIX}${p.path}`:p.authority==="rasterarrays"?p.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${p.path}`:p.authority==="3dtiles"?p.path=`/${r.e.TILES3D_URL_PREFIX}${p.path}`:(p.path=p.path.replace(/^.+\/v4\//,"/"),p.path=`/${r.e.TILE_URL_VERSION}${p.path}`);const g=this._customAccessToken||function(v){for(const w of v){const A=w.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(p.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&g&&this._skuToken&&p.params.push(`sku=${this._skuToken}`),this._makeAPIURL(p,g)}canonicalizeTileURL(t,a){const u=Je(t);if(!u.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!u.path.match(/\.[\w]+$/))return t;let p="mapbox://";u.path.match(/^\/raster\/v1\//)?p+=`raster/${u.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:u.path.match(/^\/rasterarrays\/v1\//)?p+=`rasterarrays/${u.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:p+=`tiles/${u.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let g=u.params;return a&&(g=g.filter(v=>!v.match(/^access_token=/))),g.length&&(p+=`?${g.join("&")}`),p}canonicalizeTileset(t,a){const u=!!a&&r.f(a),p=[];for(const g of t.tiles||[])r.h(g)?p.push(this.canonicalizeTileURL(g,u)):p.push(g);return p}_makeAPIURL(t,a){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",p=Je(r.e.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){const g=t.params.indexOf("secure");g>=0&&t.params.splice(g,1)}if(p.path!=="/"&&(t.path=`${p.path}${t.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return jt(t);if(a=a||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return t.params=t.params.filter(g=>g.indexOf("access_token")===-1),t.params.push(`access_token=${a||""}`),jt(t)}}const yi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Je(c){const t=c.match(yi);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function jt(c){const t=c.params.length?`?${c.params.join("&")}`:"";return`${c.protocol}://${c.authority}${c.path}${t}`}const _t="mapbox.eventData";function $t(c){if(!c)return null;const t=c.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(r.j(t[1]))}catch{return null}}class Fe{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const a=$t(r.e.ACCESS_TOKEN);let u="";return u=a&&a.u?r.k(a.u):r.e.ACCESS_TOKEN||"",t?`${_t}.${t}:${u}`:`${_t}:${u}`}fetchEventData(){const t=r.s("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{const p=localStorage.getItem(a);p&&(this.eventData=JSON.parse(p));const g=localStorage.getItem(u);g&&(this.anonId=g)}catch{r.w("Unable to read from LocalStorage")}}saveEventData(){const t=r.s("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid"),p=this.anonId;if(t&&p)try{localStorage.setItem(u,p),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData))}catch{r.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,a,u,p){if(!r.e.EVENTS_URL)return;const g=Je(r.e.EVENTS_URL);g.params.push(`access_token=${p||r.e.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(t).toISOString()},w=a?r.l(v,a):v,A={url:jt(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};this.pendingRequest=r.p(A,I=>{this.pendingRequest=null,u(I),this.saveEventData(),this.processRequests(p)})}queueRequest(t,a){this.queue.push(t),this.processRequests(a)}}const zt=new class extends Fe{constructor(c){super("appUserTurnstile"),this._customAccessToken=c}postTurnstileEvent(c,t){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(c)&&c.some(a=>r.f(a)||r.h(a))&&this.queueRequest(Date.now(),t)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=$t(r.e.ACCESS_TOKEN),a=t?t.u:r.e.ACCESS_TOKEN;let u=a!==this.eventData.tokenU;r.v(this.anonId)||(this.anonId=r.u(),u=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),v=new Date(p),w=(p-this.eventData.lastSuccess)/864e5;u=u||w>=1||w<-1||g.getDate()!==v.getDate()}else u=!0;u?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Z,skuId:Fi,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=p,this.eventData.tokenU=a)},c):this.processRequests()}},_i=zt.postTurnstileEvent.bind(zt),Jt=new class extends Fe{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(c,t,a,u){this.skuToken=t,this.errorCb=u,r.e.EVENTS_URL&&(a||r.e.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},a):this.errorCb(new Error(Ei)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),r.v(this.anonId)||(this.anonId=r.u()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Z,skuId:Fi,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},c))}remove(){this.errorCb=null}},bi=Jt.postMapLoadEvent.bind(Jt),Ci=new class extends Fe{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(c){let t=this.mapInstanceIdMap.get(c);return t||(t=r.u(),this.mapInstanceIdMap.set(c,t)),t}getEventId(c){const t=this.eventIdPerMapInstanceMap.get(c)||0;return this.eventIdPerMapInstanceMap.set(c,t+1),t}postStyleLoadEvent(c,t){const{map:a,style:u,importedStyles:p}=t;if(!r.e.EVENTS_URL||!c&&!r.e.ACCESS_TOKEN)return;const g=this.getMapInstanceId(a),v={mapInstanceId:g,eventId:this.getEventId(g),style:u};p.length&&(v.importedStyles=p),this.queueRequest({timestamp:Date.now(),payload:v},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:a}=this.queue.shift();this.postEvent(t,a,()=>{},c)}},pi=Ci.postStyleLoadEvent.bind(Ci),ri=new class extends Fe{constructor(){super("gljs.performance")}postPerformanceEvent(c,t){r.e.EVENTS_URL&&(c||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:a}=this.queue.shift(),u=function(p){const g=performance.getEntriesByType("resource"),v=performance.getEntriesByType("mark"),w=function(j){const Q={};if(j){for(const Y in j)if(Y!=="other")for(const ee of j[Y]){const K=`${Y}ResolveRangeMin`,se=`${Y}ResolveRangeMax`,pe=`${Y}RequestCount`,ve=`${Y}RequestCachedCount`;Q[K]=Math.min(Q[K]||1/0,ee.startTime),Q[se]=Math.max(Q[se]||-1/0,ee.responseEnd);const Ae=Se=>{Q[Se]===void 0&&(Q[Se]=0),++Q[Se]};ee.transferSize!==void 0&&ee.transferSize===0&&Ae(ve),Ae(pe)}}return Q}(function(j,Q){const Y={};if(j)for(const ee of j){const K=Q(ee);Y[K]===void 0&&(Y[K]=[]),Y[K].push(ee)}return Y}(g,oe)),A=window.devicePixelRatio,I=navigator.connection||navigator.mozConnection||navigator.webkitConnection,z=I?I.effectiveType:void 0,k={counters:[],metadata:[],attributes:[]},O=(j,Q,Y)=>{Y!=null&&j.push({name:Q,value:Y.toString()})};for(const j in w)O(k.counters,j,w[j]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(O(k.counters,"interactionRangeMin",p.interactionRange[0]),O(k.counters,"interactionRangeMax",p.interactionRange[1])),v)for(const j of Object.keys($)){const Q=$[j],Y=v.find(ee=>ee.name===Q);Y&&O(k.counters,Q,Y.startTime)}return O(k.counters,"visibilityHidden",p.visibilityHidden),O(k.attributes,"style",function(j){if(j)for(const Q of j){const Y=Q.name.split("?")[0];if(r.i(Y)){const ee=Y.split("/").slice(-2);if(ee.length===2)return`mapbox://styles/${ee[0]}/${ee[1]}`}}}(g)),O(k.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),O(k.attributes,"fogEnabled",p.fogEnabled?"true":"false"),O(k.attributes,"projection",p.projection),O(k.attributes,"zoom",p.zoom),O(k.metadata,"devicePixelRatio",A),O(k.metadata,"connectionEffectiveType",z),O(k.metadata,"navigatorUserAgent",navigator.userAgent),O(k.metadata,"screenWidth",window.screen.width),O(k.metadata,"screenHeight",window.screen.height),O(k.metadata,"windowWidth",window.innerWidth),O(k.metadata,"windowHeight",window.innerHeight),O(k.metadata,"mapWidth",p.width/A),O(k.metadata,"mapHeight",p.height/A),O(k.metadata,"webglRenderer",p.renderer),O(k.metadata,"webglVendor",p.vendor),O(k.metadata,"sdkVersion",Z),O(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(a);for(const p of u.metadata);for(const p of u.counters);for(const p of u.attributes);this.postEvent(t,u,()=>{},c)}},Yi=ri.postPerformanceEvent.bind(ri),Vi=new class extends Fe{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(c,t,a,u){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const p=Je(r.e.API_URL+r.e.SESSION_PATH);p.params.push(`sku=${t||""}`),p.params.push(`access_token=${u||r.e.ACCESS_TOKEN||""}`);const g={url:jt(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(g,v=>{this.pendingRequest=null,a(v),this.saveEventData(),this.processRequests(u)})}getSessionAPI(c,t,a,u){this.skuToken=t,this.errorCb=u,r.e.SESSION_PATH&&r.e.API_URL&&(a||r.e.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},a):this.errorCb(new Error(Ei)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||this.getSession(a,this.skuToken,u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},c)}remove(){this.errorCb=null}},rn=Vi.getSessionAPI.bind(Vi),xn=new Set;function _n(c,t){t?xn.add(c):xn.delete(c)}class Rn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,a){this._updatedSourceCaches[t]=a,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const a=t.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(t.id),this.setDirty()}removeLayer(t){const a=t.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][t.id]=t,this._updatedLayers[a].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const a in this._updatedLayers)t[a]=t[a]||{},t[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)t[a]=t[a]||{},t[a].removedIds=Object.keys(this._removedLayers[a]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,a){this._updatedImages[a]=this._updatedImages[a]||new Set,this._updatedImages[a].add(r.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Jr(c){const{userImage:t}=c;return!!(t&&t.render&&t.render())&&(c.data.replace(new Uint8Array(t.data.buffer)),!0)}class io extends r.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&r.t()&&(this.imageRasterizerDispatcher=new r.D(r.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new r.r({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const a=this.atlasTexture.get(t);a&&(a.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,a){this.imageProviders.has(a)||this.imageProviders.set(a,new Map),this.imageProviders.get(a).set(t.id,t)}removeImageProvider(t,a){this.imageProviders.has(a)&&this.imageProviders.get(a).delete(t)}getPendingImageProviders(){const t=[];for(const a of this.imageProviders.values())for(const u of a.values())u.hasPendingRequests()&&t.push(u);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.y),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,a){if(this.loaded.get(a)!==t&&(this.loaded.set(a,t),t)){for(const{ids:u,callback:p}of this.requestors)this._notify(u,a,p);this.requestors=[]}}hasImage(t,a){return!!this.getImage(t,a)}getImage(t,a){return this.images.get(a).get(t.toString())}addImage(t,a,u){this._validate(t,u)&&this.images.get(a).set(t.toString(),u)}_validate(t,a){let u=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new r.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),u=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new r.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),u=!1),this._validateContent(a.content,a)||(this.fire(new r.z(new Error(`Image "${t.name}" has invalid "content" value`))),u=!1),u}_validateStretch(t,a){if(!t)return!0;let u=0;for(const p of t){if(p[0]<u||p[1]<p[0]||a<p[1])return!1;u=p[1]}return!0}_validateContent(t,a){return t?t.length!==4||!a.usvg&&(t[0]<0||a.data.width<t[0]||t[1]<0||a.data.height<t[1]||t[2]<0||a.data.width<t[2]||t[3]<0||a.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,a,u){const p=this.images.get(a).get(t.toString());u.version=p.version+1,this.images.get(a).set(t.toString(),u),this.updatedImages.get(a).add(t),this.removeFromImageRasterizerCache(t,a)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,a){this.spriteFormat!=="raster"&&(r.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:a}):this.imageRasterizer.removeImagesFromCacheByIds([t],a))}removeImage(t,a){const u=this.images.get(a),p=u.get(t.toString());u.delete(t.toString()),this.patterns.get(a).delete(t.toString()),this.removeFromImageRasterizerCache(t,a),p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(a=>r.I.from(a))}getImages(t,a,u){const p=[],g=[],v=this.imageProviders.get(a);for(const z of t){if(!z.iconsetId){p.push(z);continue}const k=v.get(z.iconsetId);k&&(this.getImage(z,a)?g.push(z):k.addPendingRequest(z))}if(p.length===0)return void this._notify(g,a,u);let w=!0;const A=!!this.loaded.get(a),I=this.images.get(a);if(!A)for(const z of p)I.has(z.toString())||(w=!1);A||w?this._notify(p,a,u):this.requestors.push({ids:p,scope:a,callback:u})}rasterizeImages(t,a){const u=new Map,{tasks:p,scope:g}=t;for(const[v,w]of p.entries()){const A=this.getImage(w.id,g);A&&u.set(v,{image:A,imageVariant:w})}this._rasterizeImages(g,u,a)}_rasterizeImages(t,a,u){if(r.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:a,scope:t},u);else{const p=new Map;for(const[g,{image:v,imageVariant:w}]of a.entries())p.set(g,this.imageRasterizer.rasterize(w,v,t,0));u(void 0,p)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,a,u){const p=this.images.get(a),g=new Map;for(const v of t){if(!p.get(v.toString())){if(v.iconsetId)continue;this.fire(new r.A("styleimagemissing",{id:v.name}))}const w=p.get(v.toString());if(!w){r.w(`Image "${v.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const A={data:w.usvg?null:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,usvg:w.usvg,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)};w.usvg&&Object.assign(A,{width:w.icon.usvg_tree.width,height:w.icon.usvg_tree.height}),g.set(r.I.toString(v),A)}u(null,g)}getPixelSize(t){const{width:a,height:u}=this.atlasImage.get(t);return{width:a,height:u}}getPattern(t,a,u){const p=t.toString(),g=this.patterns.get(a),v=g.get(p),w=this.getImage(t,a);if(!w)return null;if(v){if(v.position.version===w.version)return v.position;v.position.version=w.version}else{if(w.usvg&&!w.data){const A=this.getPatternInFlightId(p,a);if(this.patternsInFlight.has(A))return null;this.patternsInFlight.add(A);const I=new r.B(t).scaleSelf(r.q.devicePixelRatio),z=new Map([[I.toString(),{image:w,imageVariant:I}]]);return this._rasterizeImages(a,z,(k,O)=>this.storePatternImage(I,a,w,u,O)),null}this.storePattern(t,a,w)}return this._updatePatternAtlas(a,u),g.get(p).position}getPatternInFlightId(t,a){return r.C(t,a)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,a,u,p,g){const v=t.toString(),w=g?g.get(v):void 0;w&&(u.data=w,this.storePattern(t.id,a,u),this._updatePatternAtlas(a,p),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),a)))}storePattern(t,a,u){const p={w:u.data.width+2*r.F,h:u.data.height+2*r.F,x:0,y:0},g=new r.G(p,u,r.F);this.patterns.get(a).set(t.toString(),{bin:p,position:g})}bind(t,a){const u=t.gl;let p=this.atlasTexture.get(a);p?this.dirty&&(p.update(this.atlasImage.get(a)),this.dirty=!1):(p=new r.T(t,this.atlasImage.get(a),u.RGBA8),this.atlasTexture.set(a,p)),p.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(t,a){const u=this.patterns.get(t),p=Array.from(u.values()).map(({bin:I})=>I),{w:g,h:v}=r.H(p),w=this.atlasImage.get(t);w.resize({width:g||1,height:v||1});const A=this.images.get(t);for(const[I,{bin:z,position:k}]of u.entries()){let O=k.padding;const j=z.x+O,Q=z.y+O,Y=A.get(I).data,ee=Y.width,K=Y.height;O=O>1?O-1:O,r.r.copy(Y,w,{x:0,y:0},{x:j,y:Q},{width:ee,height:K},a),r.r.copy(Y,w,{x:0,y:K-O},{x:j,y:Q-O},{width:ee,height:O},a),r.r.copy(Y,w,{x:0,y:0},{x:j,y:Q+K},{width:ee,height:O},a),r.r.copy(Y,w,{x:ee-O,y:0},{x:j-O,y:Q},{width:O,height:K},a),r.r.copy(Y,w,{x:0,y:0},{x:j+ee,y:Q},{width:O,height:K},a),r.r.copy(Y,w,{x:ee-O,y:K-O},{x:j-O,y:Q-O},{width:O,height:O},a),r.r.copy(Y,w,{x:0,y:K-O},{x:j+ee,y:Q-O},{width:O,height:O},a),r.r.copy(Y,w,{x:0,y:0},{x:j+ee,y:Q+K},{width:O,height:O},a),r.r.copy(Y,w,{x:ee-O,y:0},{x:j-O,y:Q+K},{width:O,height:O},a)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,a){const u=this.images.get(a);for(const p of t){if(this.callbackDispatchedThisFrame.get(a).has(p.toString()))continue;this.callbackDispatchedThisFrame.get(a).add(p.toString());const g=u.get(p.toString());Jr(g)&&this.updateImage(p,a,g)}}}function ea(c){const t=c.key,a=c.value,u=c.valueSpec||{},p=c.objectElementValidators||{},g=c.style,v=c.styleSpec;let w=[];const A=r.K(a);if(A!=="object")return[new r.V(t,a,`object expected, ${A} found`)];for(const I in a){const z=I.split(".")[0];let k;p[z]?k=p[z]:u[z]?k=Jn:p["*"]?k=p["*"]:u["*"]&&(k=Jn),k?w=w.concat(k({key:(t&&`${t}.`)+I,value:a[I],valueSpec:u[z]||u["*"],style:g,styleSpec:v,object:a,objectKey:I},a)):w.push(new r.J(t,a[I],`unknown property "${I}"`))}for(const I in u)p[I]||u[I].required&&u[I].default===void 0&&a[I]===void 0&&w.push(new r.V(t,a,`missing required property "${I}"`));return w}function kr(c){const t=c.value,a=c.valueSpec,u=c.style,p=c.styleSpec,g=c.key,v=c.arrayElementValidator||Jn;if(r.K(t)!=="array")return[new r.V(g,t,`array expected, ${r.K(t)} found`)];if(a.length&&t.length!==a.length)return[new r.V(g,t,`array length ${a.length} expected, length ${t.length} found`)];if(a["min-length"]&&t.length<a["min-length"])return[new r.V(g,t,`array length at least ${a["min-length"]} expected, length ${t.length} found`)];let w={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};p.$version<7&&(w.function=a.function),r.K(a.value)==="object"&&(w=a.value);let A=[];for(let I=0;I<t.length;I++)A=A.concat(v({array:t,arrayIndex:I,value:t[I],valueSpec:w,style:u,styleSpec:p,key:`${g}[${I}]`},!0));return A}function is(c){const t=c.key,a=c.value,u=c.valueSpec;let p=r.K(a);if(p==="number"&&a!=a&&(p="NaN"),p!=="number")return[new r.V(t,a,`number expected, ${p} found`)];if("minimum"in u){let g=u.minimum;if(r.K(u.minimum)==="array"&&(g=u.minimum[c.arrayIndex]),a<g)return[new r.V(t,a,`${a} is less than the minimum value ${g}`)]}if("maximum"in u){let g=u.maximum;if(r.K(u.maximum)==="array"&&(g=u.maximum[c.arrayIndex]),a>g)return[new r.V(t,a,`${a} is greater than the maximum value ${g}`)]}return[]}function la(c){const t=c.valueSpec,a=r.M(c.value.type);let u,p,g,v={};const w=a!=="categorical"&&c.value.property===void 0,A=!w,I=r.K(c.value.stops)==="array"&&r.K(c.value.stops[0])==="array"&&r.K(c.value.stops[0][0])==="object",z=ea({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(j){if(a==="identity")return[new r.V(j.key,j.value,'identity function may not have a "stops" property')];let Q=[];const Y=j.value;return Q=Q.concat(kr({key:j.key,value:Y,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:k})),r.K(Y)==="array"&&Y.length===0&&Q.push(new r.V(j.key,Y,"array must have at least one stop")),Q},default:function(j){return Jn({key:j.key,value:j.value,valueSpec:t,style:j.style,styleSpec:j.styleSpec})}}});return a==="identity"&&w&&z.push(new r.V(c.key,c.value,'missing required property "property"')),a==="identity"||c.value.stops||z.push(new r.V(c.key,c.value,'missing required property "stops"')),a==="exponential"&&c.valueSpec.expression&&!r.N(c.valueSpec)&&z.push(new r.V(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(A&&!r.O(c.valueSpec)?z.push(new r.V(c.key,c.value,"property functions not supported")):w&&!r.Q(c.valueSpec)&&z.push(new r.V(c.key,c.value,"zoom functions not supported"))),a!=="categorical"&&!I||c.value.property!==void 0||z.push(new r.V(c.key,c.value,'"property" property is required')),z;function k(j){let Q=[];const Y=j.value,ee=j.key;if(r.K(Y)!=="array")return[new r.V(ee,Y,`array expected, ${r.K(Y)} found`)];if(Y.length!==2)return[new r.V(ee,Y,`array length 2 expected, length ${Y.length} found`)];if(I){if(r.K(Y[0])!=="object")return[new r.V(ee,Y,`object expected, ${r.K(Y[0])} found`)];if(Y[0].zoom===void 0)return[new r.V(ee,Y,"object stop key must have zoom")];if(Y[0].value===void 0)return[new r.V(ee,Y,"object stop key must have value")];const K=r.M(Y[0].zoom);if(typeof K!="number")return[new r.V(ee,Y[0].zoom,"stop zoom values must be numbers")];if(g&&g>K)return[new r.V(ee,Y[0].zoom,"stop zoom values must appear in ascending order")];K!==g&&(g=K,p=void 0,v={}),Q=Q.concat(ea({key:`${ee}[0]`,value:Y[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:is,value:O}}))}else Q=Q.concat(O({key:`${ee}[0]`,value:Y[0],style:j.style,styleSpec:j.styleSpec},Y));return r.S(r.U(Y[1]))?Q.concat([new r.V(`${ee}[1]`,Y[1],"expressions are not allowed in function stops.")]):Q.concat(Jn({key:`${ee}[1]`,value:Y[1],valueSpec:t,style:j.style,styleSpec:j.styleSpec}))}function O(j,Q){const Y=r.K(j.value),ee=r.M(j.value),K=j.value!==null?j.value:Q;if(u){if(Y!==u)return[new r.V(j.key,K,`${Y} stop domain type must match previous stop domain type ${u}`)]}else u=Y;if(Y!=="number"&&Y!=="string"&&Y!=="boolean"&&typeof ee!="number"&&typeof ee!="string"&&typeof ee!="boolean")return[new r.V(j.key,K,"stop domain value must be a number, string, or boolean")];if(Y!=="number"&&a!=="categorical"){let se=`number expected, ${Y} found`;return r.O(t)&&a===void 0&&(se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(j.key,K,se)]}return a!=="categorical"||Y!=="number"||typeof ee=="number"&&isFinite(ee)&&Math.floor(ee)===ee?a!=="categorical"&&Y==="number"&&typeof ee=="number"&&typeof p=="number"&&p!==void 0&&ee<p?[new r.V(j.key,K,"stop domain values must appear in ascending order")]:(p=ee,a==="categorical"&&ee in v?[new r.V(j.key,K,"stop domain values must be unique")]:(v[ee]=!0,[])):[new r.V(j.key,K,`integer expected, found ${String(ee)}`)]}}function vo(c){const t=(c.expressionContext==="property"?r.W:r.X)(r.U(c.value),c.valueSpec);if(t.result==="error")return t.value.map(u=>new r.V(`${c.key}${u.key}`,c.value,u.message));const a=t.value.expression||t.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!a.outputDefined())return[new r.V(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!r.Y(a))return[new r.V(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return Uo(a,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!r.Z(a,["zoom","feature-state"]))return[new r.V(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!r._(a))return[new r.V(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Uo(c,t){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const p of t.valueSpec.expression.parameters)a.delete(p);if(a.size===0)return[];const u=[];return c instanceof r.$&&a.has(c.name)?[new r.V(t.key,t.value,`["${c.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(c.eachChild(p=>{u.push(...Uo(p,t))}),u)}function Da(c){const t=c.key,a=c.value,u=c.valueSpec,p=[];return Array.isArray(u.values)?u.values.indexOf(r.M(a))===-1&&p.push(new r.V(t,a,`expected one of [${u.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(u.values).indexOf(r.M(a))===-1&&p.push(new r.V(t,a,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(a)} found`)),p}function xo(c){return r.a1(r.U(c.value))?vo(r.L({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):wa(c)}function wa(c){const t=c.value,a=c.key;if(r.K(t)!=="array")return[new r.V(a,t,`array expected, ${r.K(t)} found`)];const u=c.styleSpec;let p,g=[];if(t.length<1)return[new r.V(a,t,"filter array must have at least 1 element")];switch(g=g.concat(Da({key:`${a}[0]`,value:t[0],valueSpec:u.filter_operator,style:c.style,styleSpec:c.styleSpec})),r.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&r.M(t[1])==="$type"&&g.push(new r.V(a,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new r.V(a,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=r.K(t[1]),p!=="string"&&g.push(new r.V(`${a}[1]`,t[1],`string expected, ${p} found`)));for(let v=2;v<t.length;v++)p=r.K(t[v]),r.M(t[1])==="$type"?g=g.concat(Da({key:`${a}[${v}]`,value:t[v],valueSpec:u.geometry_type,style:c.style,styleSpec:c.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&g.push(new r.V(`${a}[${v}]`,t[v],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)g=g.concat(wa({key:`${a}[${v}]`,value:t[v],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":p=r.K(t[1]),t.length!==2?g.push(new r.V(a,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&g.push(new r.V(`${a}[1]`,t[1],`string expected, ${p} found`))}return g}function za(c,t){const a=c.key,u=c.style,p=c.layer,g=c.styleSpec,v=c.value,w=c.objectKey,A=g[`${t}_${c.layerType}`];if(!A)return[];const I=w.match(/^(.*)-use-theme$/);if(t==="paint"&&I&&A[I[1]])return r.S(v)?[].concat(Jn({key:c.key,value:v,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:u,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:w})):Jn({key:a,value:v,valueSpec:{type:"string"},style:u,styleSpec:g});const z=w.match(/^(.*)-transition$/);if(t==="paint"&&z&&A[z[1]]&&A[z[1]].transition)return Jn({key:a,value:v,valueSpec:g.transition,style:u,styleSpec:g});const k=c.valueSpec||A[w];if(!k)return[new r.J(a,v,`unknown property "${w}"`)];let O;if(r.K(v)==="string"&&r.O(k)&&!k.tokens&&(O=/^{([^}]+)}$/.exec(v))){const Q=`\`{ "type": "identity", "property": ${O?JSON.stringify(O[1]):'"_"'} }\``;return[new r.V(a,v,`"${w}" does not support interpolation syntax
Use an identity property function instead: ${Q}.`)]}const j=[];if(c.layerType==="symbol")w!=="text-field"||!u||u.glyphs||u.imports||j.push(new r.V(a,v,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&r.a2(r.U(v))&&r.M(v.type)==="identity"&&j.push(new r.V(a,v,'"text-font" does not support identity functions'));else if(c.layerType==="model"&&t==="paint"&&p&&p.layout&&p.layout.hasOwnProperty("model-id")&&r.O(k)&&(r.a3(k)||r.Q(k))){const Q=r.W(r.U(v),k),Y=Q.value.expression||Q.value._styleExpression.expression;Y&&!r.Z(Y,["measure-light"])&&(w==="model-emissive-strength"&&r._(Y)&&r.Y(Y)||j.push(new r.V(a,v,`${w} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return j.concat(Jn({key:c.key,value:v,valueSpec:k,style:u,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:w}))}function Ta(c){return za(c,"paint")}function Ir(c){return za(c,"layout")}function ja(c){let t=[];const a=c.value,u=c.key,p=c.style,g=c.styleSpec;a.type||a.ref||t.push(new r.V(u,a,'either "type" or "ref" is required'));let v=r.M(a.type);const w=r.M(a.ref);if(a.id){const A=r.M(a.id);for(let I=0;I<c.arrayIndex;I++){const z=p.layers[I];r.M(z.id)===A&&t.push(new r.V(u,a.id,`duplicate layer id "${a.id}", previously used at line ${z.id.__line__}`))}}if("ref"in a){let A;["type","source","source-layer","filter","layout"].forEach(I=>{I in a&&t.push(new r.V(u,a[I],`"${I}" is prohibited for ref layers`))}),p.layers.forEach(I=>{r.M(I.id)===w&&(A=I)}),A?A.ref?t.push(new r.V(u,a.ref,"ref cannot reference another ref layer")):v=r.M(A.type):typeof w=="string"&&t.push(new r.V(u,a.ref,`ref layer "${w}" not found`))}else if(v!=="background"&&v!=="sky"&&v!=="slot")if(a.source){const A=p.sources&&p.sources[a.source],I=A&&r.M(A.type);A?I==="vector"&&v==="raster"?t.push(new r.V(u,a.source,`layer "${a.id}" requires a raster source`)):I==="raster"&&v!=="raster"?t.push(new r.V(u,a.source,`layer "${a.id}" requires a vector source`)):I!=="vector"||a["source-layer"]?I==="raster-dem"&&v!=="hillshade"?t.push(new r.V(u,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):I!=="raster-array"||["raster","raster-particle"].includes(v)?v==="line"&&a.paint&&(a.paint["line-gradient"]||a.paint["line-trim-offset"])&&I==="geojson"&&!A.lineMetrics?t.push(new r.V(u,a,`layer "${a.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):v==="raster-particle"&&I!=="raster-array"&&t.push(new r.V(u,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):t.push(new r.V(u,a.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new r.V(u,a,`layer "${a.id}" must specify a "source-layer"`)):t.push(new r.V(u,a.source,`source "${a.source}" not found`))}else t.push(new r.V(u,a,'missing required property "source"'));return t=t.concat(ea({key:u,value:a,valueSpec:g.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Jn({key:`${u}.type`,value:a.type,valueSpec:g.layer.type,style:c.style,styleSpec:c.styleSpec,object:a,objectKey:"type"}),filter:A=>xo(r.L({layerType:v},A)),layout:A=>ea({layer:a,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":I=>Ir(r.L({layerType:v},I))}}),paint:A=>ea({layer:a,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":I=>Ta(r.L({layerType:v,layer:a},I))}})}})),t}function Hr(c){const t=c.value,a=c.key,u=r.K(t);return u!=="string"?[new r.V(a,t,`string expected, ${u} found`)]:[]}const Es={promoteId:function c({key:t,value:a}){if(r.K(a)==="string")return Hr({key:t,value:a});if(Array.isArray(a)){const u=[],p=r.U(a),g=r.X(p);return g.result==="error"&&g.value.forEach(v=>{u.push(new r.V(`${t}${v.key}`,null,`${v.message}`))}),r.Z(g.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||u.push(new r.V(`${t}`,null,"promoteId expression should be only feature dependent")),u}{const u=[];for(const p in a)u.push(...c({key:`${t}.${p}`,value:a[p]}));return u}}};function ta(c){const t=c.value,a=c.key,u=c.styleSpec,p=c.style;if(!t.type)return[new r.V(a,t,'"type" is required')];const g=r.M(t.type);let v=[];switch(["vector","raster","raster-dem","raster-array"].includes(g)&&(t.url||t.tiles||v.push(new r.J(a,t,'Either "url" or "tiles" is required.'))),g){case"vector":case"raster":case"raster-dem":case"raster-array":return v=v.concat(ea({key:a,value:t,valueSpec:u[`source_${g.replace("-","_")}`],style:c.style,styleSpec:u,objectElementValidators:Es})),v;case"geojson":if(v=ea({key:a,value:t,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:Es}),t.cluster)for(const w in t.clusterProperties){const[A,I]=t.clusterProperties[w],z=typeof A=="string"?[A,["accumulated"],["get",w]]:A;v.push(...vo({key:`${a}.${w}.map`,value:I,expressionContext:"cluster-map"})),v.push(...vo({key:`${a}.${w}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return v;case"video":return ea({key:a,value:t,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return ea({key:a,value:t,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new r.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Da({key:`${a}.type`,value:t.type,valueSpec:{values:Qs(u)}})}}function Qs(c){return c.source.reduce((t,a)=>{const u=c[a];return u.type.type==="enum"&&(t=t.concat(Object.keys(u.type.values))),t},[])}function bo(c){const t=c.value,a=c.styleSpec,u=a.light,p=c.style;let g=[];const v=r.K(t);if(t===void 0)return g;if(v!=="object")return g=g.concat([new r.V("light",t,`object expected, ${v} found`)]),g;for(const w in t){const A=w.match(/^(.*)-transition$/),I=w.match(/^(.*)-use-theme$/);g=g.concat(I&&u[I[1]]?Jn({key:w,value:t[w],valueSpec:{type:"string"},style:p,styleSpec:a}):A&&u[A[1]]&&u[A[1]].transition?Jn({key:w,value:t[w],valueSpec:a.transition,style:p,styleSpec:a}):u[w]?Jn({key:w,value:t[w],valueSpec:u[w],style:p,styleSpec:a}):[new r.V(w,t[w],`unknown property "${w}"`)])}return g}function Ua(c){const t=c.value;let a=[];if(!t)return a;const u=r.K(t);if(u!=="object")return a=a.concat([new r.V("light-3d",t,`object expected, ${u} found`)]),a;const p=c.styleSpec,g=p["light-3d"],v=c.key,w=c.style,A=c.style.lights;for(const k of["type","id"])if(!(k in t))return a=a.concat([new r.V("light-3d",t,`missing property ${k} on light`)]),a;if(t.type&&A)for(let k=0;k<c.arrayIndex;k++){const O=r.M(t.type),j=A[k];r.M(j.type)===O&&a.push(new r.V(v,t.id,`duplicate light type "${t.type}", previously defined at line ${j.id.__line__}`))}const I=`properties_light_${t.type}`;if(!(I in p))return a=a.concat([new r.V("light-3d",t,`Invalid light type ${t.type}`)]),a;const z=p[I];for(const k in t)if(k==="properties"){const O=t[k],j=r.K(O);if(j!=="object")return a=a.concat([new r.V("properties",O,`object expected, ${j} found`)]),a;for(const Q in O)a=a.concat(z[Q]?Jn({key:Q,value:O[Q],valueSpec:z[Q],style:w,styleSpec:p}):[new r.J(c.key,O[Q],`unknown property "${Q}"`)])}else{const O=k.match(/^(.*)-transition$/),j=k.match(/^(.*)-use-theme$/);a=a.concat(j&&g[j[1]]?Jn({key:k,value:t[k],valueSpec:{type:"string"},style:w,styleSpec:p}):O&&g[O[1]]&&g[O[1]].transition?Jn({key:k,value:t[k],valueSpec:p.transition,style:w,styleSpec:p}):g[k]?Jn({key:k,value:t[k],valueSpec:g[k],style:w,styleSpec:p}):[new r.J(k,t[k],`unknown property "${k}"`)])}return a}function no(c){const t=c.value,a=c.key,u=c.style,p=c.styleSpec,g=p.terrain;let v=[];const w=r.K(t);if(t===void 0||w==="null")return v;if(w!=="object")return v=v.concat([new r.V("terrain",t,`object expected, ${w} found`)]),v;for(const A in t){const I=A.match(/^(.*)-transition$/),z=A.match(/^(.*)-use-theme$/);v=v.concat(z&&g[z[1]]?Jn({key:A,value:t[A],valueSpec:{type:"string"},style:u,styleSpec:p}):I&&g[I[1]]&&g[I[1]].transition?Jn({key:A,value:t[A],valueSpec:p.transition,style:u,styleSpec:p}):g[A]?Jn({key:A,value:t[A],valueSpec:g[A],style:u,styleSpec:p}):[new r.J(A,t[A],`unknown property "${A}"`)])}if(t.source){const A=u.sources&&u.sources[t.source],I=A&&r.M(A.type);A?I!=="raster-dem"&&v.push(new r.V(a,t.source,`terrain cannot be used with a source of type ${String(I)}, it only be used with a "raster-dem" source type`)):v.push(new r.V(a,t.source,`source "${t.source}" not found`))}else v.push(new r.V(a,t,'terrain is missing required property "source"'));return v}function Vo(c){const t=c.value,a=c.style,u=c.styleSpec,p=u.fog;let g=[];const v=r.K(t);if(t===void 0)return g;if(v!=="object")return g=g.concat([new r.V("fog",t,`object expected, ${v} found`)]),g;for(const w in t){const A=w.match(/^(.*)-transition$/),I=w.match(/^(.*)-use-theme$/);g=g.concat(I&&p[I[1]]?Jn({key:w,value:t[w],valueSpec:{type:"string"},style:a,styleSpec:u}):A&&p[A[1]]&&p[A[1]].transition?Jn({key:w,value:t[w],valueSpec:u.transition,style:a,styleSpec:u}):p[w]?Jn({key:w,value:t[w],valueSpec:p[w],style:a,styleSpec:u}):[new r.J(w,t[w],`unknown property "${w}"`)])}return g}const wo={"*":()=>[],array:kr,boolean:function(c){const t=c.value,a=c.key,u=r.K(t);return u!=="boolean"?[new r.V(a,t,`boolean expected, ${u} found`)]:[]},number:is,color:function(c){const t=c.key,a=c.value,u=r.K(a);return u!=="string"?[new r.V(t,a,`color expected, ${u} found`)]:r.a0.parseCSSColor(a)===null?[new r.V(t,a,`color expected, "${a}" found`)]:[]},enum:Da,filter:xo,function:la,layer:ja,object:ea,source:ta,model:r.a4,light:bo,"light-3d":Ua,terrain:no,fog:Vo,string:Hr,formatted:function(c){return Hr(c).length===0?[]:vo(c)},resolvedImage:function(c){return Hr(c).length===0?[]:vo(c)},projection:function(c){const t=c.value,a=c.styleSpec,u=a.projection,p=c.style;let g=[];const v=r.K(t);if(v==="object")for(const w in t)g=g.concat(Jn({key:w,value:t[w],valueSpec:u[w],style:p,styleSpec:a}));else v!=="string"&&(g=g.concat([new r.V("projection",t,`object or string expected, ${v} found`)]));return g},import:function(c){const{value:t,styleSpec:a}=c,{data:u,...p}=t;Object.defineProperty(p,"__line__",{value:t.__line__,enumerable:!1});let g=ea(r.L({},c,{value:p,valueSpec:a.import}));return r.M(p.id)===""&&g.push(new r.V(`${c.key}.id`,p,"import id can't be an empty string")),u&&(g=g.concat(fl(u,a,{key:`${c.key}.data`}))),g},iconset:function(c){const t=c.value,a=c.key,u=c.styleSpec,p=c.style;if(!t.type)return[new r.V(a,t,'"type" is required')];const g=r.M(t.type);let v=[];if(v=v.concat(ea({key:a,value:t,valueSpec:u[`iconset_${g}`],style:p,styleSpec:u})),g==="source"&&t.source){const w=p.sources&&p.sources[t.source],A=w&&r.M(w.type);w?A!=="raster-array"&&v.push(new r.V(a,t.source,`iconset cannot be used with a source of type ${String(A)}, it only be used with a "raster-array" source type`)):v.push(new r.V(a,t.source,`source "${t.source}" not found`))}return v}};function Jn(c,t=!1){const a=c.value,u=c.valueSpec,p=c.styleSpec;if(u.expression&&r.a2(r.M(a)))return la(c);if(u.expression&&r.S(r.U(a)))return vo(c);if(u.type&&wo[u.type]){const g=wo[u.type](c);return t===!0&&g.length>0&&r.K(c.value)==="array"?vo(c):g}return ea(r.L({},c,{valueSpec:u.type?p[u.type]:u}))}function ro(c){const t=c.value,a=c.key,u=Hr(c);return u.length||(t.indexOf("{fontstack}")===-1&&u.push(new r.V(a,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&u.push(new r.V(a,t,'"glyphs" url must include a "{range}" token'))),u}function fl(c,t=r.a5,a={}){return Jn({key:a.key||"",value:c,valueSpec:t.$root,styleSpec:t,style:c,objectElementValidators:{glyphs:ro,"*":()=>[]}})}function Pa(c,t=r.a5){return De(fl(c,t))}const As=c=>De(ta(c)),Pc=c=>De(bo(c)),Ms=c=>De(Ua(c)),Bt=c=>De(no(c)),Go=c=>De(Vo(c)),$l=c=>De(function(t){const a=t.value,u=t.style,p=t.styleSpec,g=p.snow;let v=[];const w=r.K(a);if(a===void 0)return v;if(w!=="object")return v=v.concat([new r.V("snow",a,`object expected, ${w} found`)]),v;for(const A in a){const I=A.match(/^(.*)-transition$/);v=v.concat(I&&g[I[1]]&&g[I[1]].transition?Jn({key:A,value:a[A],valueSpec:p.transition,style:u,styleSpec:p}):g[A]?Jn({key:A,value:a[A],valueSpec:g[A],style:u,styleSpec:p}):[new r.J(A,a[A],`unknown property "${A}"`)])}return v}(c)),de=c=>De(function(t){const a=t.value,u=t.style,p=t.styleSpec,g=p.rain;let v=[];const w=r.K(a);if(a===void 0)return v;if(w!=="object")return v=v.concat([new r.V("rain",a,`object expected, ${w} found`)]),v;for(const A in a){const I=A.match(/^(.*)-transition$/);v=v.concat(I&&g[I[1]]&&g[I[1]].transition?Jn({key:A,value:a[A],valueSpec:p.transition,style:u,styleSpec:p}):g[A]?Jn({key:A,value:a[A],valueSpec:g[A],style:u,styleSpec:p}):[new r.J(A,a[A],`unknown property "${A}"`)])}return v}(c)),V=c=>De(ja(c)),W=c=>De(xo(c)),ae=c=>De(Ta(c)),ye=c=>De(Ir(c)),we=c=>De(r.a4(c));function De(c){return c.slice().sort((t,a)=>t.line&&a.line?t.line-a.line:0)}function Me(c,t){let a=!1;if(t&&t.length)for(const u of t)u instanceof r.J?r.w(u.message):(c.fire(new r.z(new Error(u.message))),a=!0);return a}let Pe;class He extends r.E{constructor(t,a="flat"){super(),this._transitionable=new r.a6(Pe||(Pe=new r.a7({anchor:new r.a8(r.a5.light.anchor),position:new r.a9(r.a5.light.position),color:new r.a8(r.a5.light.color),intensity:new r.a8(r.a5.light.intensity)}))),this.setLight(t,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a,u={}){this._validate(Pc,t,u)||(this._transitionable.setTransitionOrValue(t),this.id=a)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,u){return(!u||u.validate!==!1)&&Me(this,t.call(Pa,r.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}}let Ye=class extends r.E{constructor(c,t,a,u){super(),this.scope=a,this._transitionable=new r.a6(new r.a7({source:new r.a8(r.a5.terrain.source),exaggeration:new r.a8(r.a5.terrain.exaggeration)}),a,u),this._transitionable.setTransitionOrValue(c,u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(c,t){this._transitionable.setTransitionOrValue(c,t)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}getExaggeration(c){return this._transitioning.possiblyEvaluate(new r.aa(c)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const c=this._transitionable._values.exaggeration;if(!c)return null;const t=c.value.expression;if(!t)return null;let a=-1,u=-1,p=1;for(const g of t.zoomStops)p=t.evaluate(new r.aa(g)),p>.01?(a=g,u=-1):u=g;return p<.01&&a>0&&u>a?[a,u]:null}isZoomDependent(){const c=this._transitionable._values.exaggeration;return c!=null&&c.value!=null&&c.value.expression!=null&&c.value.expression instanceof r.ab}};const Ve=45,ft=65,Pt=.05;function Vt(c,t,a,u){const p=r.af(Ve,ft,a),[g,v]=vi(c,u);let w=1-Math.min(1,Math.exp((t-g)/(v-g)*-6));return w*=w*w,w=Math.min(1,1.00747*w),w*p*c.alpha}function vi(c,t){const a=.5/Math.tan(.5*t);return[c.range[0]+a,c.range[1]+a]}function mi(c,t,a,u,p){const g=r.ad([],[t,a,u],p.mercatorFogMatrix);return Vt(c,r.ae(g),p.pitch,p._fov)}function gi(c,t,a,u,p,g,v){const w=[[a,u,0],[p,u,0],[p,g,0],[a,g,0]];let A=Number.MAX_VALUE,I=-Number.MAX_VALUE;for(const z of w){const k=r.ad([],z,t),O=r.ae(k);A=Math.min(A,O),I=Math.max(I,O)}return[Vt(c,A,v.pitch,v._fov),Vt(c,I,v.pitch,v._fov)]}class Gi extends r.E{constructor(t,a,u,p){super();const g=new r.a7({range:new r.a8(r.a5.fog.range),color:new r.a8(r.a5.fog.color),"color-use-theme":new r.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.a8(r.a5.fog["high-color"]),"high-color-use-theme":new r.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.a8(r.a5.fog["space-color"]),"space-color-use-theme":new r.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.a8(r.a5.fog["horizon-blend"]),"star-intensity":new r.a8(r.a5.fog["star-intensity"]),"vertical-range":new r.a8(r.a5.fog["vertical-range"])});this._transitionable=new r.a6(g,u,new Map(p)),this.set(t,p),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new r.ag(g),this.scope=u}get state(){const t=this._transform,a=t.projection.name==="globe",u=r.ah(t.zoom),p=this.properties.get("range"),g=[.5,3];return{range:a?[r.ai(g[0],p[0],u),r.ai(g[1],p[1],u)]:p,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,a,u={}){if(this._validate(Go,t,u))return;const p=r.l({},t);for(const g of Object.keys(r.a5.fog))p[g]===void 0&&(p[g]=r.a5.fog[g].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.af(Ve,ft,t))*a.a}getOpacityAtLatLng(t,a){return this._transform.projection.supportsFog?function(u,p,g){const v=r.ac.fromLngLat(p),w=g.elevation?g.elevation.getAtPointOrZero(v):0;return mi(u,v.x,v.y,w,g)}(this.state,t,a):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(t.toUnwrapped());return gi(this.state,a,0,0,r.aj,r.aj,this._transform)}getOpacityForBounds(t,a,u,p,g){return this._transform.projection.supportsFog?gi(this.state,t,a,u,p,g,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?vi(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const u of a){const p=t.points[u];let g;if(p[2]>=0)g=p;else{const v=t.points[u-4];g=r.ak(v,p,v[2]/(v[2]-p[2]))}if(mi(this.state,g[0],g[1],0,this._transform)>=Pt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,u){return(!u||u.validate!==!1)&&Me(this,t.call(Pa,r.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}}let In,Ui,yn,ln,Dn=class extends r.E{constructor(c,t,a,u){super();const p=In||(In=new r.a7({density:new r.a8(r.a5.snow.density),intensity:new r.a8(r.a5.snow.intensity),color:new r.a8(r.a5.snow.color),opacity:new r.a8(r.a5.snow.opacity),vignette:new r.a8(r.a5.snow.vignette),"vignette-color":new r.a8(r.a5.snow["vignette-color"]),"center-thinning":new r.a8(r.a5.snow["center-thinning"]),direction:new r.a8(r.a5.snow.direction),"flake-size":new r.a8(r.a5.snow["flake-size"])}));this._transitionable=new r.a6(p,a,new Map(u)),this.set(c,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ag(p),this.scope=a}get state(){const c=this.properties.get("opacity"),t=this.properties.get("color"),a=this.properties.get("direction"),u=r.al(a[0]),p=-Math.max(r.al(a[1]),.01),g=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],v=this.properties.get("vignette"),w=this.properties.get("vignette-color");return w.a=v,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.am(t.r,t.g,t.b,t.a*c),direction:g,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(c,t,a={}){if(this._validate($l,c,a))return;const u=r.l({},c);for(const p of Object.keys(r.a5.snow))u[p]===void 0&&(u[p]=r.a5.snow[p].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,t,a){return(!a||a.validate!==!1)&&Me(this,c.call(Pa,r.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}},Gn=class extends r.E{constructor(c,t,a,u){super();const p=Ui||(Ui=new r.a7({density:new r.a8(r.a5.rain.density),intensity:new r.a8(r.a5.rain.intensity),color:new r.a8(r.a5.rain.color),opacity:new r.a8(r.a5.rain.opacity),vignette:new r.a8(r.a5.rain.vignette),"vignette-color":new r.a8(r.a5.rain["vignette-color"]),"center-thinning":new r.a8(r.a5.rain["center-thinning"]),direction:new r.a8(r.a5.rain.direction),"droplet-size":new r.a8(r.a5.rain["droplet-size"]),"distortion-strength":new r.a8(r.a5.rain["distortion-strength"])}));this._transitionable=new r.a6(p,a,new Map(u)),this.set(c,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ag(p),this.scope=a}get state(){const c=this.properties.get("opacity"),t=this.properties.get("color"),a=this.properties.get("direction"),u=r.al(a[0]),p=-Math.max(r.al(a[1]),.01),g=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],v=this.properties.get("vignette-color");return v.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.am(t.r,t.g,t.b,t.a*c),direction:g,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:v}}get(){return this._transitionable.serialize()}set(c,t,a={}){if(this._validate(de,c,a))return;const u=r.l({},c);for(const p of Object.keys(r.a5.rain))u[p]===void 0&&(u[p]=r.a5.rain[p].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,t,a){return(!a||a.validate!==!1)&&Me(this,c.call(Pa,r.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}};class Yn extends r.E{constructor(t,a,u,p){super(),this.scope=u,this._options=t,this.properties=new r.ag(a),this._transitionable=new r.a6(a,u,new Map(p)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,a){this._options=t,this._transitionable.setTransitionOrValue(t.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Er{constructor(t,a,u,p){this.screenBounds=t,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(t,a){let u,p;if(t instanceof r.P||typeof t[0]=="number"){const g=r.P.convert(t);u=[g],p=a.isPointAboveHorizon(g)}else{const g=r.P.convert(t[0]),v=r.P.convert(t[1]),w=g.add(v)._div(2);u=[g,v],p=r.ao(g,v).every(A=>a.isPointAboveHorizon(A))&&a.isPointAboveHorizon(w)}return new Er(u,a.getCameraPoint(),p,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return r.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const a=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],p=r.ao(a,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<u.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?p[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(p[3]=this.cameraPoint)),r.ap(p,t)}bufferedCameraGeometryGlobe(t){const a=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],p=r.ao(a,u,t),g=this.cameraPoint.clone();switch(3*((g.y>a.y)+(g.y>u.y))+((g.x>a.x)+(g.x>u.x))){case 0:p[0]=g,p[4]=g.clone();break;case 1:p.splice(1,0,g);break;case 2:p[1]=g;break;case 3:p.splice(4,0,g);break;case 5:p.splice(2,0,g);break;case 6:p[3]=g;break;case 7:p.splice(3,0,g);break;case 8:p[2]=g}return p}containsTile(t,a,u,p=0){const g=t.queryPadding/a._pixelsPerMercatorPixel+1,v=u?this._bufferedCameraMercator(g,a):this._bufferedScreenMercator(g,a);let w=t.tileID.wrap+(v.unwrapped?p:0);const A=v.polygon.map(ee=>r.aq(t.tileTransform,ee,w));if(!r.ar(A,0,0,r.aj,r.aj))return;w=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?p:0);const I=this.screenGeometryMercator.polygon.map(ee=>r.as(t.tileTransform,ee,w)),z=I.map(ee=>new r.P(ee[0],ee[1])),k=a.getFreeCameraOptions().position||new r.ac(0,0,0),O=r.as(t.tileTransform,k,w),j=I.map(ee=>{const K=r.at(ee,ee,O);return r.au(K,K),new r.av(O,K)}),Q=r.aw(t,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:j,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(Y=r.ax(A),Y.min.x=r.aD(Y.min.x,0,r.aj),Y.min.y=r.aD(Y.min.y,0,r.aj),Y.max.x=r.aD(Y.max.x,0,r.aj),Y.max.y=r.aD(Y.max.y,0,r.aj),Y),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:Q};var Y}_bufferedScreenMercator(t,a){const u=ya(t);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let p;return p=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),a):{polygon:this.bufferedScreenGeometry(t).map(g=>a.pointCoordinate3D(g)),unwrapped:!0},this._screenRaycastCache[u]=p,p}}_bufferedCameraMercator(t,a){const u=ya(t);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let p;return p=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),a):{polygon:this.bufferedCameraGeometry(t).map(g=>a.pointCoordinate3D(g)),unwrapped:!0},this._cameraRaycastCache[u]=p,p}}_projectAndResample(t,a){const u=function(g,v){const w=r.az([],v.pixelMatrix,v.globeMatrix),A=[0,-r.aE,0,1],I=[0,r.aE,0,1],z=[0,0,0,1];r.aA(A,A,w),r.aA(I,I,w),r.aA(z,z,w);const k=new r.P(A[0]/A[3],A[1]/A[3]),O=new r.P(I[0]/I[3],I[1]/I[3]),j=r.aB(g,k)&&A[3]<z[3],Q=r.aB(g,O)&&I[3]<z[3];if(!j&&!Q)return null;const Y=function(Te,ge,Ce){for(let Le=1;Le<Te.length;Le++){const Qe=gr(ge.pointCoordinate3D(Te[Le-1]).x),Ze=gr(ge.pointCoordinate3D(Te[Le]).x);if(Ce<0){if(Qe<Ze)return{idx:Le,t:-Qe/(Ze-1-Qe)}}else if(Ze<Qe)return{idx:Le,t:(1-Qe)/(Ze+1-Qe)}}return null}(g,v,j?-1:1);if(!Y)return null;const{idx:ee,t:K}=Y;let se=ee>1?sn(g.slice(0,ee),v):[],pe=ee<g.length?sn(g.slice(ee),v):[];se=se.map(Te=>new r.P(gr(Te.x),Te.y)),pe=pe.map(Te=>new r.P(gr(Te.x),Te.y));const ve=[...se];ve.length===0&&ve.push(pe[pe.length-1]);const Ae=r.ai(ve[ve.length-1].y,(pe.length===0?se[0]:pe[0]).y,K);let Se;return Se=j?[new r.P(0,Ae),new r.P(0,0),new r.P(1,0),new r.P(1,Ae)]:[new r.P(1,Ae),new r.P(1,1),new r.P(0,1),new r.P(0,Ae)],ve.push(...Se),pe.length===0?ve.push(se[0]):ve.push(...pe),{polygon:ve.map(Te=>new r.ac(Te.x,Te.y)),unwrapped:!1}}(t,a);if(u)return u;const p=function(g,v){let w=!1,A=-1/0,I=0;for(let k=0;k<g.length-1;k++)g[k].x>A&&(A=g[k].x,I=k);for(let k=0;k<g.length-1;k++){const O=(I+k)%(g.length-1),j=g[O],Q=g[O+1];Math.abs(j.x-Q.x)>.5&&(j.x<Q.x?(j.x+=1,O===0&&(g[g.length-1].x+=1)):(Q.x+=1,O+1===g.length-1&&(g[0].x+=1)),w=!0)}const z=r.ay(v.center.lng);return w&&z<Math.abs(z-1)&&g.forEach(k=>{k.x-=1}),{polygon:g,unwrapped:w}}(sn(t,a).map(g=>new r.P(gr(g.x),g.y)),a);return{polygon:p.polygon.map(g=>new r.ac(g.x,g.y)),unwrapped:p.unwrapped}}}function sn(c,t){return r.aC(c,a=>{const u=t.pointCoordinate3D(a);a.x=u.x,a.y=u.y},1/256)}function gr(c){return c<0?1+c%1:c%1}function ya(c){return 100*c|0}function Nr(c,t,a,u,p){const g=function(w,A){if(w)return p(w);if(A){if(c.url&&A.tiles&&c.tiles&&delete c.tiles,A.variants){if(!Array.isArray(A.variants))return p(new Error("variants must be an array"));for(const z of A.variants){if(z==null||typeof z!="object"||z.constructor!==Object)return p(new Error("variant must be an object"));if(!Array.isArray(z.capabilities))return p(new Error("capabilities must be an array"));if(z.capabilities.length===1&&z.capabilities[0]==="meshopt"){A=r.l(A,z);break}}}const I=r.aF(r.l({},A,c),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);I.tiles=t.canonicalizeTileset(I,c.url),p(null,I)}},v=function(w,A,I){if(!w)return null;if(!A&&!I)return w;I=I||w.worldview_default;const z=Object.values(w.language||{});if(z.length===0)return null;const k=Object.values(w.worldview||{});if(k.length===0)return null;const O=z.every(Q=>Q===A),j=k.every(Q=>Q===I);return O&&j?w:A in(w.language_options||{})||I in(w.worldview_options||{})?null:w.language_options&&w.worldview_options?w:null}(c.data,a,u);return v?r.q.frame(()=>g(null,v)):c.url?r.n(t.transformRequest(t.normalizeSourceURL(c.url,null,a,u),r.R.Source),g):r.q.frame(()=>{const{data:w,...A}=c;g(null,A)})}function aa(c,t){const a=Math.pow(2,t.z),u=Math.floor(r.ay(c.getWest())*a),p=Math.floor(r.aH(c.getNorth())*a),g=Math.ceil(r.ay(c.getEast())*a),v=Math.ceil(r.aH(c.getSouth())*a);return t.x>=u&&t.x<g&&t.y>=p&&t.y<v}class Bn{constructor(t,a,u){this.bounds=t?r.aG.convert(this.validateBounds(t)):null,this.minzoom=a||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const a of t)this.extraBounds.push(r.aG.convert(this.validateBounds(a)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!aa(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const a of this.extraBounds)if(aa(a,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const a=new Bn(t.bounds,t.minzoom,t.maxzoom);return a.addExtraBounds(t.extra_bounds),a}}class Wr extends r.E{constructor(t,a,u,p){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.l(this,r.aF(a,["url","scheme","tileSize","promoteId"])),this._options=r.l({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new r.aI}load(t){this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=Nr(this._options,this.map._requestManager,a,u,(p,g)=>{if(this._tileJSONRequest=null,this._loaded=!0,p)a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),u&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new r.z(p));else if(g){if(r.l(this,g),this.hasWorldviews=!!g.worldview_options,g.worldview_default&&(this.worldviewDefault=g.worldview_default),g.vector_layers){this.vectorLayers=g.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const v of g.vector_layers)this.vectorLayerIds.push(v.id),g.worldview&&g.worldview[v.source]&&this.localizableLayerIds.add(v.id)}this.tileBounds=Bn.fromTileJSON(g),_i(g.tiles,this.map._requestManager._customAccessToken),this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(p)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}loadTile(t,a){const u=t.tileID.canonical.url(this.tiles,this.scheme),p=this.map._requestManager.normalizeTileURL(u),g=this.map._requestManager.transformRequest(p,r.R.Tile),v=this.map.style?this.map.style.getLut(this.scope):null,w=v?{image:v.image.clone()}:null,A={request:g,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:w,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&r.f(u)&&(A.worldview=this.map.getWorldview()||this.worldviewDefault,A.localizableLayerIds=this.localizableLayerIds),A.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=a:t.request=t.actor.send("reloadTile",A,I.bind(this));else if(t.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",A,I.bind(this),void 0,!0);else{const z=r.aJ.call({deduped:this._deduped},A,(k,O)=>{k||!O?I.call(this,k):(A.data={cacheControl:O.cacheControl,expires:O.expires,rawData:O.rawData.slice(0)},t.actor&&t.actor.send("loadTile",A,I.bind(this),void 0,!0))},!0);t.request={cancel:z}}function I(z,k){return delete t.request,t.aborted?a(null):z&&z.status!==404?a(z):(k&&k.resourceTiming&&(t.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&t.setExpiryData(k),t.loadVectorData(k,this.map.painter),r.aK(this.dispatcher),a(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,a){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class To extends r.E{constructor(t,a,u,p){super(),this.id=t,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.l({type:"raster"},a),r.l(this,r.aF(a,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"})),this._tileJSONRequest=Nr(this._options,this.map._requestManager,null,null,(a,u)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new r.z(a)):u&&(r.l(this,u),u.raster_layers&&(this.rasterLayers=u.raster_layers,this.rasterLayerIds=this.rasterLayers.map(p=>p.id)),this.tileBounds=Bn.fromTileJSON(u),_i(u.tiles),this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(a)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){const u=r.q.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);t.request=r.o(this.map._requestManager.transformRequest(p,r.R.Tile),(g,v,w,A)=>(delete t.request,t.aborted?(t.state="unloaded",a(null)):g?(t.state="errored",a(g)):v?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:w,expires:A}),t.setTexture(v,this.map.painter),t.state="loaded",r.aK(this.dispatcher),void a(null)):a(null)))}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a&&a()}unloadTile(t,a){t.texture&&t.texture instanceof r.T?(t.destroy(!0),t.texture&&t.texture instanceof r.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ma extends To{constructor(t,a,u,p){super(t,a,u,p),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=r.l({type:"raster-array"},a)}triggerRepaint(t){const a=this.map.painter._terrain,u=this.map.style.getSourceCache(this.id);a&&a.enabled&&u&&a._clearRenderCacheForTile(u.id,t.tileID),this.map.triggerRepaint()}loadTile(t,a){const u=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),p=this.map._requestManager.transformRequest(u,r.R.Tile),g={request:p,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=p,t.actor||(t.actor=this.dispatcher.getActor());const v=(w,A,I,z)=>{if(delete t.request,t.aborted)return t.state="unloaded",a(null);if(w)return w.name==="AbortError"?void 0:(t.state="errored",a(w));if(this.map._refreshExpiredTiles&&A&&t.setExpiryData({cacheControl:I,expires:z}),this.partial)t.state="empty";else{if(!A)return a(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=A}a(null)};t.request=this.partial?t.fetchHeader(void 0,v.bind(this)):t.actor.send("loadTile",g,v.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,a){const u=t.texture;u&&u instanceof r.T?(t.destroy(!0),this.map.painter.saveTileTexture(u)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,a,u){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(a,u,(p,g)=>{if(p)return t.state="errored",this.fire(new r.z(p)),void this.triggerRepaint(t);g&&(t._isHeaderLoaded=!0,t.setTexture(g,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find(({id:g})=>g===t),u=a&&a.fields,p=u&&u.bands&&u.bands;return p?p[0]:0}getTextureDescriptor(t,a,u){if(!t)return;const p=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!p)return;let g=null;a instanceof r.aN?g=a.paint.get("raster-array-band"):a instanceof r.aO&&(g=a.paint.get("raster-particle-array-band"));const v=g||this.getInitialBand(p);if(v!=null)if(t.textureDescriptor){if(!t.updateNeeded(p,v)||u)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,p,v)}getImages(t,a){const u=new Map;for(const p of t)for(const g of a){const[v,w]=g.split("/"),A=p.getLayer(v);if(!A||!A.hasBand(w)||!A.hasDataForBand(w))continue;const{bytes:I,tileSize:z,buffer:k}=A.getBandView(w),O=z+2*k,j={data:new r.r({width:O,height:O},I),pixelRatio:2,sdf:!1,usvg:!1,version:0};u.set(g,j)}return u}}const Bu={vector:Wr,raster:To,"raster-dem":class extends To{constructor(c,t,a,u){super(c,t,a,u),this.type="raster-dem",this.maxzoom=22,this._options=r.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(c,t){const a=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(p,g){p&&(c.state="errored",t(p)),g&&(c.dem=g,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",t(null))}c.request=r.o(this.map._requestManager.transformRequest(a,r.R.Tile),(function(p,g,v,w){if(delete c.request,c.aborted)c.state="unloaded",t(null);else if(p)c.state="errored",t(p);else if(g){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:v,expires:w});const A=ImageBitmap&&g instanceof ImageBitmap&&r.t(),I=1-(g.width-r.aL(g.width))/2;I<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const z=A?g:r.q.getImageData(g,I),k={uid:c.uid,tileID:c.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:z,encoding:this.encoding,padding:I};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadTile",k,u.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(c){const t=c.canonical,a=Math.pow(2,t.z),u=(t.x-1+a)%a,p=t.x===0?c.wrap-1:c.wrap,g=(t.x+1+a)%a,v=t.x+1===a?c.wrap+1:c.wrap,w={};return w[new r.aM(c.overscaledZ,p,t.z,u,t.y).key]={backfilled:!1},w[new r.aM(c.overscaledZ,v,t.z,g,t.y).key]={backfilled:!1},t.y>0&&(w[new r.aM(c.overscaledZ,p,t.z,u,t.y-1).key]={backfilled:!1},w[new r.aM(c.overscaledZ,c.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},w[new r.aM(c.overscaledZ,v,t.z,g,t.y-1).key]={backfilled:!1}),t.y+1<a&&(w[new r.aM(c.overscaledZ,p,t.z,u,t.y+1).key]={backfilled:!1},w[new r.aM(c.overscaledZ,c.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},w[new r.aM(c.overscaledZ,v,t.z,g,t.y+1).key]={backfilled:!1}),w}},"raster-array":ma,geojson:class extends r.E{constructor(c,t,a,u){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(u),this._data=t.data,this._options=r.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const p=r.aj/this.tileSize;this.workerOptions=r.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*p,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*p,extent:r.aj,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:r.aj,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*p,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}updateData(c){if(!this._options.dynamic)return this.fire(new r.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof c!="string"&&(c.type==="Feature"&&(c={type:"FeatureCollection",features:[c]}),c.type!=="FeatureCollection"))return this.fire(new r.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof c!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const a of this._data.features)t.set(a.id,a);for(const a of c.features)t.set(a.id,a);this._data.features=[...t.values()]}else this._data=c;return this._updateWorkerData(!0),this}getClusterExpansionZoom(c,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id,scope:this.scope},t),this}getClusterChildren(c,t){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id,scope:this.scope},t),this}getClusterLeaves(c,t,a,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:c,limit:t,offset:a},u),this}_updateWorkerData(c=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=r.l({append:c},this.workerOptions);t.scope=this.scope;const a=this._data;typeof a=="string"?(t.request=this.map._requestManager.transformRequest(r.q.resolveURL(a),r.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(u,p)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new r.z(u));else{const g={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(g.resourceTiming=p.resourceTiming[this.id]),c&&(this._partialReload=!0),this.fire(new r.A("data",g)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(c),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const c=r.C(this.id,this.scope);this.map.style.clearSource(c),this._updateWorkerData()}loadTile(c,t){const a=c.actor?"reloadTile":"loadTile";c.actor=this.actor;const u=this.map.style?this.map.style.getLut(this.scope):null,p=u?{image:u.image.clone()}:null,g=this._partialReload,v={type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:p,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:c.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:g};c.request=this.actor.send(a,v,(w,A)=>g&&!A?(c.state="loaded",t(null)):(delete c.request,c.destroy(),c.aborted?t(null):w?t(w):(c.loadVectorData(A,this.map.painter,a==="reloadTile"),t(null))),void 0,a==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c,t){this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}onRemove(c){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aP{constructor(c,t,a,u){super(c,t,a,u),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const t of c.urls)this.urls.push(this.map._requestManager.transformRequest(t,r.R.Source).url);r.aQ(this.urls,(t,a)=>{this._loaded=!0,t?this.fire(new r.z(t)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const t=this.video.seekable;c<t.start(0)||c>t.end(0)?this.fire(new r.z(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,t=c.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(c,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aP,model:class extends r.E{constructor(c,t,a,u){super(),this.id=c,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const c=[];for(const t in this._options.models){const a=this._options.models[t],u=r.aS(this.map._requestManager.transformRequest(a.uri,r.R.Model).url).then(p=>{if(!p)return;const g=r.aT(p),v=new r.aU(t,a.position,a.orientation,g);v.computeBoundsAndApplyParent(),this.models.push(v)}).catch(p=>{this.fire(new r.z(new Error(`Could not load model ${t} from ${a.uri}: ${p.message}`)))});c.push(u)}Promise.allSettled(c).then(()=>{this._loaded=!0,this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new r.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(c){this.map=c,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(c,t){}serialize(){return this._options}},"batched-model":class extends r.E{constructor(c,t,a,u){super(),this.type="batched-model",this.id=c,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(u)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();const c=r.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(c){this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map.getWorldview();this._tileJSONRequest=Nr(this._options,this.map._requestManager,t,a,(u,p)=>{this._tileJSONRequest=null,this._loaded=!0,u?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new r.z(u))):p&&(r.l(this,p),p.bounds&&(this.tileBounds=new Bn(p.bounds,this.minzoom,this.maxzoom)),_i(p.tiles,this.map._requestManager._customAccessToken),this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))),c&&c(u)})}hasTransition(){return!1}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loaded(){return this._loaded}loadTile(c,t){const a=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(a,r.R.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:r.q.devicePixelRatio,promoteId:this.promoteId};if(c.actor&&c.state!=="expired")if(c.state==="loading")c.reloadCallback=t;else{if(c.buckets){const g=Object.values(c.buckets);for(const v of g)v.dirty=!0;return void(c.state="loaded")}c.request=c.actor.send("reloadTile",u,p.bind(this))}else c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",u,p.bind(this),void 0,!0);function p(g,v){return c.aborted?t(null):g&&g.status!==404?t(g):(this.map._refreshExpiredTiles&&v&&c.setExpiryData(v),c.loadModelData(v,this.map.painter),c.state="loaded",void t(null))}}serialize(){return r.l({},this._options)}},canvas:class extends r.aP{constructor(c,t,a,u){super(c,t,a,u),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(g=>typeof g!="number"))||this.fire(new r.z(new r.V(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.z(new r.V(`sources.${c}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new r.z(new r.V(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new r.z(new r.V(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.z(new r.V(`sources.${c}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(c){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!c&&!this._playing||this.texture instanceof r.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends r.E{constructor(c,t,a,u){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=t,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Bn(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),r.l(this,r.aF(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this.map=c,this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:t,y:a,z:u}=c.canonical;return this._implementation.hasTile({x:t,y:a,z:u})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,t){const{x:a,y:u,z:p}=c.tileID.canonical,g=new AbortController;c.request=Promise.resolve(this._implementation.loadTile({x:a,y:u,z:p},{signal:g.signal})).then((function(v){return delete c.request,c.aborted?(c.state="unloaded",t(null)):v===void 0?(c.state="errored",t(null)):v===null?(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",t(null)):function(w){return w instanceof ImageData||w instanceof HTMLCanvasElement||w instanceof ImageBitmap||w instanceof HTMLImageElement}(v)?(this.loadTileData(c,v),c.state="loaded",void t(null)):(c.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(v=>{v.name!=="AbortError"&&(c.state="errored",t(v))}),c.request.cancel=()=>g.abort()}loadTileData(c,t){c.setTexture(t,this.map.painter)}unloadTile(c,t){if(c.texture&&c.texture instanceof r.T?(c.destroy(!0),c.texture&&c.texture instanceof r.T&&this.map.painter.saveTileTexture(c.texture)):c.destroy(),this._implementation.unloadTile){const{x:a,y:u,z:p}=c.tileID.canonical;this._implementation.unloadTile({x:a,y:u,z:p})}t&&t()}abortTile(c,t){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_clearTiles(){const c=r.C(this.id,this.scope);this.map.style.clearSource(c)}_update(){this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))}}},Fu=function(c,t,a,u){const p=new Bu[t.type](c,t,a,u);if(p.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${p.id}`);return r.aV(["load","abort","unload","serialize","prepare"],p),p};function Lc(c,t,a=""){return`${a}:${t.id||""}:${t.layer.id}:${function(u){if("layerId"in u)return`layer:${u.layerId}`;{const{featuresetId:p,importId:g}=u;return`featureset:${p}${g?`:import:${g}`:""}`}}(c.target)}`}function ju(c,t,a,u=""){if(c.uniqueFeatureID){const p=Lc(c,t,u);if(a.has(p))return!0;a.add(p)}return!1}function Js(c,t,a,u,p=!1){const g=t.sourceCache.transform,v=t.sourceCache.tilesIn(c,t.has3DLayers,p);v.sort(Ho);const w=[];for(const A of v){const I=A.tile.queryRenderedFeatures(t,A,a,u,g,p);Object.keys(I).length&&w.push({wrappedTileID:A.tile.tileID.wrapped().key,queryResults:I})}return w.length===0?{}:function(A){const I={},z={};for(const k of A){const O=k.queryResults,j=k.wrappedTileID,Q=z[j]=z[j]||{};for(const Y in O){const ee=O[Y],K=Q[Y]=Q[Y]||{},se=I[Y]=I[Y]||[];for(const pe of ee)K[pe.featureIndex]||(K[pe.featureIndex]=!0,se.push(pe))}}return I}(w)}function Oh(c,t,a,u,p){const g={},v=u.queryRenderedSymbols(c),w=[];for(const A of Object.keys(v).map(Number))w.push(p[A]);w.sort(Ho);for(const A of w){const I=A.featureIndex.lookupSymbolFeatures(v[A.bucketInstanceId],A.bucketIndex,A.sourceLayerIndex,t,a);for(const z in I){const k=g[z]=g[z]||[],O=I[z];O.sort((j,Q)=>{const Y=A.featureSortOrder;if(Y){const ee=Y.indexOf(j.featureIndex);return Y.indexOf(Q.featureIndex)-ee}return Q.featureIndex-j.featureIndex});for(const j of O)k.push(j)}}return g}function So(c,t){const a=c.getRenderableIds().map(g=>c.getTileByID(g)),u=[],p={};for(let g=0;g<a.length;g++){const v=a[g],w=v.tileID.canonical.key;p[w]||(p[w]=!0,v.querySourceFeatures(u,t))}return u}function Ho(c,t){const a=c.tileID,u=t.tileID;return a.overscaledZ-u.overscaledZ||a.canonical.y-u.canonical.y||a.wrap-u.wrap||a.canonical.x-u.canonical.x}function Qd(c,t){const a={};if(!t)return a;for(const u of c){const p=u.layerIds.map(g=>t.getLayer(g)).filter(Boolean);if(p.length!==0){u.layers=p,u.stateDependentLayerIds&&(u.stateDependentLayers=u.stateDependentLayerIds.map(g=>p.filter(v=>v.id===g)[0]));for(const g of p)a[g.fqid]=u}}return a}const Va=32,Ga=33,el=new Uint16Array(8184);for(let c=0;c<2046;c++){let t=c+2,a=0,u=0,p=0,g=0,v=0,w=0;for(1&t?p=g=v=Va:a=u=w=Va;(t>>=1)>1;){const I=a+p>>1,z=u+g>>1;1&t?(p=a,g=u,a=v,u=w):(a=p,u=g,p=v,g=w),v=I,w=z}const A=4*c;el[A+0]=a,el[A+1]=u,el[A+2]=p,el[A+3]=g}const ns=new Uint16Array(2178),Eo=new Uint8Array(1089),rs=new Uint16Array(1089);function Uu(c){return c===0?-.03125:c===32?.03125:0}const Jd={type:2,extent:r.aj,loadGeometry:()=>[[new r.P(0,0),new r.P(r.aj+1,0),new r.P(r.aj+1,r.aj+1),new r.P(0,r.aj+1),new r.P(0,0)]]};class Cs{constructor(t,a,u,p,g){this.tileID=t,this.uid=r.a$(),this.uses=0,this.tileSize=a,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,p&&p.style&&(this._lastUpdatedBrightness=p.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(t){const a=t+this.timeAdded;a<r.q.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,a,u){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Qd(t.buckets,a.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof r.b1){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof r.b1&&g.hasRTLText){this.hasRTLText=!0,r.b2();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p],v=a.style.getOwnLayer(p);if(!v)continue;const w=v.queryRadius(g);this.queryPadding=Math.max(this.queryPadding,w)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new r.b0}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,a,u){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Qd(t.buckets,a.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const p in this.buckets){const g=this.buckets[p];g.uploadPending()&&g.upload(t)}const a=t.gl,u=this.imageAtlas;u&&!u.uploaded&&(this.imageAtlasTexture=new r.T(t,u.image,a.RGBA8,{useMipmap:!!u.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(t,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(t,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(t,a,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,u),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const p=a.style.getBrightness();(this._lastUpdatedBrightness||p)&&(this._lastUpdatedBrightness&&p&&Math.abs(this._lastUpdatedBrightness-p)<.001||(this.updateBuckets(a,this._lastUpdatedBrightness!==p),this._lastUpdatedBrightness=p))}queryRenderedFeatures(t,a,u,p,g,v){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const w=function(A,I){const z=r.bn([],[.5*A.width,.5*-A.height,1]);return r.bo(z,z,[1,-1,0]),r.az(z,z,A.calculateProjMatrix(I.toUnwrapped())),Float32Array.from(z)}(g,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:a,pixelPosMatrix:w,transform:p,availableImages:u,tileTransform:this.tileTransform})}querySourceFeatures(t,a){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),g=a?a.sourceLayer:"",v=p._geojsonTileLayer||p[g];if(!v)return;const w=r.b3(a&&a.filter),{z:A,x:I,y:z}=this.tileID.canonical,k={z:A,x:I,y:z};for(let O=0;O<v.length;O++){const j=v.feature(O);if(w.needGeometry){const ee=r.b4(j,!0);if(!w.filter(new r.aa(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!w.filter(new r.aa(this.tileID.overscaledZ),j))continue;const Q=u.getId(j,g),Y=new r.b5(j,A,I,z,Q);Y.tile=k,t.push(Y)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const u=r.b6(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(a)if(this.expirationTime<a)p=!0;else{const g=this.expirationTime-a;g?this.expirationTime=u+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,a){if(!this.latestFeatureIndex||!t.style)return;const u=this.latestFeatureIndex.loadVTLayers(),p=t.style.listImages(),g=t.style.getBrightness();for(const v in this.buckets){if(!t.style.hasLayer(v))continue;const w=this.buckets[v],A=w.layers[0],I=A.sourceLayer||"_geojsonTileLayer",z=u[I],k=t.style.getLayerSourceCache(A);let O={};k&&(O=k._state.getState(I,void 0));const j=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Q=Object.keys(O).length>0&&!a;Q&&!w.stateDependentLayers.length&&!a||w.update(O,z,p,j,Q?w.stateDependentLayers:w.layers,a,g),(w instanceof r.b7||w instanceof r.b8)&&t._terrain&&t._terrain.enabled&&k&&w.uploadPending()&&t._terrain._clearRenderCacheForTile(k.id,this.tileID);const Y=t&&t.style&&t.style.getOwnLayer(v);Y&&(this.queryPadding=Math.max(this.queryPadding,Y.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=r.q.now()+t}setTexture(t,a){const u=a.context,p=u.gl;this.texture=this.texture||a.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t):(this.texture=new r.T(u,t,p.RGBA8,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(t,a){const u={};for(const p of a)u[p]=!0;this.dependencies[t]=u}hasDependency(t,a){for(const u of t){const p=this.dependencies[u];if(p){for(const g of a)if(p[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const u=r.b9(Jd,this.tileID.canonical,this.tileTransform)[0],p=new r.ba,g=new r.bb;for(let v=0;v<u.length;v++){const{x:w,y:A}=u[v];p.emplaceBack(w,A),g.emplaceBack(v)}g.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(g),this._tileDebugBuffer=t.createVertexBuffer(p,r.bc.members),this._tileDebugSegments=r.bd.simpleSegment(0,0,p.length,g.length)}_makeTileBoundsBuffers(t,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const u=r.b9(Jd,this.tileID.canonical,this.tileTransform)[0];let p,g;if(this.isRaster){const v=function(w,A){const I=r.aW(w,A),z=Math.pow(2,w.z);for(let ee=0;ee<Ga;ee++)for(let K=0;K<Ga;K++){const se=r.aX((w.x+(K+Uu(K))/Va)/z),pe=r.aY((w.y+(ee+Uu(ee))/Va)/z),ve=A.project(se,pe),Ae=ee*Ga+K;ns[2*Ae+0]=Math.round((ve.x*I.scale-I.x)*r.aj),ns[2*Ae+1]=Math.round((ve.y*I.scale-I.y)*r.aj)}Eo.fill(0),rs.fill(0);for(let ee=2045;ee>=0;ee--){const K=4*ee,se=el[K+0],pe=el[K+1],ve=el[K+2],Ae=el[K+3],Se=se+ve>>1,Te=pe+Ae>>1,ge=Se+Te-pe,Ce=Te+se-Se,Le=pe*Ga+se,Qe=Ae*Ga+ve,Ze=Te*Ga+Se,ht=Math.hypot((ns[2*Le+0]+ns[2*Qe+0])/2-ns[2*Ze+0],(ns[2*Le+1]+ns[2*Qe+1])/2-ns[2*Ze+1])>=16;Eo[Ze]=Eo[Ze]||(ht?1:0),ee<1022&&(Eo[Ze]=Eo[Ze]||Eo[(pe+Ce>>1)*Ga+(se+ge>>1)]||Eo[(Ae+Ce>>1)*Ga+(ve+ge>>1)])}const k=new r.aZ,O=new r.a_;let j=0;function Q(ee,K){const se=K*Ga+ee;return rs[se]===0&&(k.emplaceBack(ns[2*se+0],ns[2*se+1],ee*r.aj/Va,K*r.aj/Va),rs[se]=++j),rs[se]-1}function Y(ee,K,se,pe,ve,Ae){const Se=ee+se>>1,Te=K+pe>>1;if(Math.abs(ee-ve)+Math.abs(K-Ae)>1&&Eo[Te*Ga+Se])Y(ve,Ae,ee,K,Se,Te),Y(se,pe,ve,Ae,Se,Te);else{const ge=Q(ee,K),Ce=Q(se,pe),Le=Q(ve,Ae);O.emplaceBack(ge,Ce,Le)}}return Y(0,0,Va,Va,Va,0),Y(Va,Va,0,0,0,Va),{vertices:k,indices:O}}(this.tileID.canonical,a);p=v.vertices,g=v.indices}else{p=new r.aZ,g=new r.a_;for(const{x:w,y:A}of u)p.emplaceBack(w,A,0,0);const v=r.be(p.int16.subarray(0,4*p.length),void 0,4);for(let w=0;w<v.length;w+=3)g.emplaceBack(v[w],v[w+1],v[w+2])}this._tileBoundsBuffer=t.createVertexBuffer(p,r.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(g),this._tileBoundsSegments=r.bd.simpleSegment(0,0,p.length,g.length)}_makeGlobeTileDebugBuffers(t,a){const u=a.projection;if(!u||u.name!=="globe"||a.freezeTileCoverage)return;const p=this.tileID.canonical,g=r.bg(p,a),v=r.bh(g),w=r.ah(a.zoom);let A;w>0&&(A=r.bi(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,p,a,v,A,w),this._makeGlobeTileDebugTextBuffer(t,p,a,v,A,w)}_globePoint(t,a,u,p,g,v,w){let A=r.bj(t,a,u);if(v){const I=1<<u.z,z=r.ay(p.center.lng),k=r.aH(p.center.lat),O=(u.x+.5)/I-z;let j=0;O>.5?j=-1:O<-.5&&(j=1);let Q=(t/r.aj+u.x)/I+j,Y=(a/r.aj+u.y)/I;Q=(Q-z)*p._pixelsPerMercatorPixel+z,Y=(Y-k)*p._pixelsPerMercatorPixel+k;const ee=[Q*p.worldSize,Y*p.worldSize,0];r.ad(ee,ee,v),A=r.bk(A,ee,w)}return r.ad(A,A,g)}_makeGlobeTileDebugBorderBuffer(t,a,u,p,g,v){const w=new r.ba,A=new r.bb,I=new r.bl,z=(O,j,Q,Y,ee)=>{const K=(Q-O)/(ee-1),se=(Y-j)/(ee-1),pe=w.length;for(let ve=0;ve<ee;ve++){const Ae=O+ve*K,Se=j+ve*se;w.emplaceBack(Ae,Se);const Te=this._globePoint(Ae,Se,a,u,p,g,v);I.emplaceBack(Te[0],Te[1],Te[2]),A.emplaceBack(pe+ve)}},k=r.aj;z(0,0,k,0,16),z(k,0,k,k,16),z(k,k,0,k,16),z(0,k,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(A),this._tileDebugBuffer=t.createVertexBuffer(w,r.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(I,r.bm.members),this._tileDebugSegments=r.bd.simpleSegment(0,0,w.length,A.length)}_makeGlobeTileDebugTextBuffer(t,a,u,p,g,v){const w=r.aj/4,A=new r.ba,I=new r.a_,z=new r.bl,k=25;I.reserve(32),A.reserve(k),z.reserve(k);const O=(j,Q)=>k*j+Q;for(let j=0;j<k;j++){const Q=j*w;for(let Y=0;Y<k;Y++){const ee=Y*w;A.emplaceBack(ee,Q);const K=this._globePoint(ee,Q,a,u,p,g,v);z.emplaceBack(K[0],K[1],K[2])}}for(let j=0;j<4;j++)for(let Q=0;Q<4;Q++){const Y=O(j,Q),ee=O(j,Q+1),K=O(j+1,Q),se=O(j+1,Q+1);I.emplaceBack(Y,ee,K),I.emplaceBack(K,ee,se)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(I),this._tileDebugTextBuffer=t.createVertexBuffer(A,r.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(z,r.bm.members),this._tileDebugTextSegments=r.bd.simpleSegment(0,0,k,32)}destroy(t=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bp.setPbf(r.bq);class kh extends Cs{constructor(t,a,u,p,g){super(t,a,u,p,g),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,a){const u=a.context,p=u.gl;this.texture=this.texture||a.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t,{premultiply:!1}):this.texture=new r.T(u,t,p.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,a){const u=this._mrt=new r.bp(30),p=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=r.br(p,(g,v,w,A)=>{if(g)a(g);else try{const I=u.getHeaderLength(v);if(I>t)return void(this.request=this.fetchHeader(I,a));u.parseHeader(v),this._isHeaderLoaded=!0;let z=0;for(const k of Object.values(u.layers))z=Math.max(z,k.dataIndex[k.dataIndex.length-1].lastByte);v.byteLength>=z&&(this.entireBuffer=v),a(null,this.entireBuffer||v,w,A)}catch(I){a(I)}}),this.request}fetchBand(t,a,u){const p=this._mrt;if(!this._isHeaderLoaded||!p)return void u(new Error("Tile header is not ready"));const g=this.actor;if(!g)return void u(new Error("Can't fetch tile band without an actor"));let v;const w=(k,O)=>{v.complete(k,O),k?u(k):(this.updateTextureDescriptor(t,a),u(null,this.textureDescriptor&&this.textureDescriptor.img))},A=(k,O)=>{if(k)return u(k);const j=g.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:O,task:v},w,void 0,!0);this._workQueue.push(()=>{j&&j.cancel(),v.cancel()})},I=p.getLayer(t);if(!I)return void u(new Error(`Unknown sourceLayer "${t}"`));if(I.hasDataForBand(a))return this.updateTextureDescriptor(t,a),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);const z=I.getDataRange([a]);if(v=p.createDecodingTask(z),!v||v.tasks.length)if(this.flushQueues(),this.entireBuffer)A(null,this.entireBuffer.slice(z.firstByte,z.lastByte+1));else{const k=Object.assign({},this.requestParams,{headers:{Range:`bytes=${z.firstByte}-${z.lastByte}`}}),O=r.br(k,A);this._fetchQueue.push(()=>{O.cancel(),v.cancel()})}else u(null)}updateNeeded(t,a){return(!this.textureDescriptor||this.textureDescriptor.band!==a||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,a){if(!this._mrt)return;const u=this._mrt.getLayer(t);if(!u||!u.hasBand(a)||!u.hasDataForBand(a))return;const{bytes:p,tileSize:g,buffer:v,offset:w,scale:A}=u.getBandView(a),I=g+2*v,z=new r.r({width:I,height:I},p),k=this.texture;k&&k instanceof r.T&&k.update(z,{premultiply:!1}),this.textureDescriptor={layer:t,band:a,img:z,buffer:v,offset:w,tileSize:g,format:u.pixelFormat,mix:[A,256*A,65536*A,16777216*A]}}}class ap{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(const t in this.data)for(const a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,u){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const g={value:a,timeout:void 0};if(u!==void 0&&(g.timeout=setTimeout(()=>{this.remove(t,g)},u)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){const a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;const u=t.wrapped().key,p=a===void 0?0:this.data[u].indexOf(a),g=this.data[u][p];return this.data[u].splice(p,1),g.timeout&&clearTimeout(g.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(g.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){const a=[];for(const u in this.data)for(const p of this.data[u])t(p.value)||a.push(p);for(const u of a)this.remove(u.value.tileID,u)}}class Zl{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,u){const p=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},r.l(this.stateChanges[t][p],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==p&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const g in this.state[t][p])u[g]||(this.deletedStates[t][p][g]=null)}else for(const g in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][g]===null&&delete this.deletedStates[t][p][g]}removeFeatureState(t,a,u){if(this.deletedStates[t]===null)return;const p=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&a!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,a){const u=this.state[t]||{},p=this.stateChanges[t]||{},g=this.deletedStates[t];if(g===null)return{};if(a!==void 0){const w=String(a),A=r.l({},u[w],p[w]);if(g){const I=g[a];if(I===null)return{};for(const z in I)delete A[z]}return A}const v=r.l({},u,p);if(g)for(const w in g)delete v[w];return v}initializeTileState(t,a){t.refreshFeatureState(a)}coalesceChanges(t,a){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const v in this.stateChanges[p])this.state[p][v]||(this.state[p][v]={}),r.l(this.state[p][v],this.stateChanges[p][v]),g[v]=this.state[p][v];u[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(this.deletedStates[p]===null)for(const v in this.state[p])g[v]={},this.state[p][v]={};else for(const v in this.deletedStates[p]){if(this.deletedStates[p][v]===null)this.state[p][v]={};else if(this.state[p][v])for(const w of Object.keys(this.deletedStates[p][v]))delete this.state[p][v][w];g[v]=this.state[p][v]}u[p]=u[p]||{},r.l(u[p],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const p in t)t[p].refreshFeatureState(a)}}class Sa extends r.E{constructor(t,a,u){super(),this.id=t,this._onlySymbols=u,a.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new ap(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Zl,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,a){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,a)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const u=this._tiles[a];u.upload(t),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Vu).map(t=>t.key)}getRenderableIds(t,a){const u=[];for(const p in this._tiles)this._isIdRenderable(+p,t,a)&&u.push(this._tiles[p]);return t?u.sort((p,g)=>{const v=p.tileID,w=g.tileID,A=new r.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),I=new r.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-w.overscaledZ||I.y-A.y||I.x-A.x}).map(p=>p.tileID.key):u.map(p=>p.tileID).sort(Vu).map(p=>p.key)}hasRenderableParent(t){const a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a,u){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())&&(u||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,a){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=a),this._loadTile(u,this._tileLoaded.bind(this,u,t,a)))}_tileLoaded(t,a,u,p){if(p)if(t.state="errored",p.status!==404)this._source.fire(new r.z(p,{tile:t}));else{if(this._source.fire(new r.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=r.q.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new r.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const a=this.getRenderableIds();for(let p=0;p<a.length;p++){const g=a[p];if(t.neighboringTiles&&t.neighboringTiles[g]){const v=this.getTileByID(g);u(t,v),u(v,t)}}function u(p,g){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let v=g.tileID.canonical.x-p.tileID.canonical.x;const w=g.tileID.canonical.y-p.tileID.canonical.y,A=Math.pow(2,p.tileID.canonical.z),I=g.tileID.key;v===0&&w===0||Math.abs(w)>1||(Math.abs(v)>1&&(Math.abs(v+A)===1?v+=A:Math.abs(v-A)===1&&(v-=A)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,v,w),p.neighboringTiles&&p.neighboringTiles[I]&&(p.neighboringTiles[I].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,u,p){for(const g in this._tiles){let v=this._tiles[g];if(p[g]||!v.hasData()||v.tileID.overscaledZ<=a||v.tileID.overscaledZ>u)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>a+1;){const I=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[I.key],v&&v.hasData()&&(w=I)}let A=w;for(;A.overscaledZ>a;)if(A=A.scaledTo(A.overscaledZ-1),t[A.key]){p[w.key]=w;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=a?u:null}for(let u=t.overscaledZ-1;u>=a;u--){const p=t.scaledTo(u),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(t){const a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,a){a=a||this._source.tileSize;const u=Math.ceil(t.width/a)+1,p=Math.ceil(t.height/a)+1,g=Math.floor(u*p*5),v=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(w)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,a){const u={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+a),u[g.tileID.key]=g}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(t,a,u,p,g){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(t,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const v=this._source.type==="batched-model";let w,A=this._source.maxzoom;const I=this.map&&this.map.painter?this.map.painter._terrain:null;if(I&&I.sourceCache===this&&I.attenuationRange()){const O=I.attenuationRange()[0],j=Math.floor(O)-Math.log2(I.getDemUpscale());A>j&&(A=j)}if(this.used||this.usedForTerrain){if(this._source.tileID)w=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new r.aM(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y));else if(this.tileCoverLift!==0){const O=t.clone();O.tileCoverLift=this.tileCoverLift,w=O.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.minzoom<=1&&t.projection.name==="globe"&&(w.push(new r.aM(1,0,1,0,0)),w.push(new r.aM(1,0,1,1,0)),w.push(new r.aM(1,0,1,0,1)),w.push(new r.aM(1,0,1,1,1)))}else if(w=t.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.hasTile){const O=this._source.hasTile.bind(this._source);w=w.filter(j=>O(j))}}else w=[];if(w.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!pl(this._source.type)){const O=t.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),j=Math.min(O,this._source.maxzoom);if(v){const Q=t.extendTileCover(w,j);for(const Y of Q)w.push(Y)}else if(g){const Q=t.extendTileCover(w,j,this.transform._camera.forward());for(const Y of Q)w.push(Y)}else if(this.castsShadows&&p){const Q=t.extendTileCover(w,j,p);for(const Y of Q)this._shadowCasterTiles[Y.key]=!0,w.push(Y)}}const z=this._updateRetainedTiles(w);if(pl(this._source.type)&&w.length!==0){const O={},j={},Q=Object.keys(z);for(const ee of Q){const K=z[ee],se=this._tiles[ee];if(!se||se.fadeEndTime&&se.fadeEndTime<=r.q.now())continue;const pe=this.findLoadedParent(K,Math.max(K.overscaledZ-Sa.maxOverzooming,this._source.minzoom));pe&&(this._addTile(pe.tileID),O[pe.tileID.key]=pe.tileID),j[ee]=K}const Y=w[w.length-1].overscaledZ;for(const ee in this._tiles){const K=this._tiles[ee];if(z[ee]||!K.hasData())continue;let se=K.tileID;for(;se.overscaledZ>Y;){se=se.scaledTo(se.overscaledZ-1);const pe=this._tiles[se.key];if(pe&&pe.hasData()&&j[se.key]){z[ee]=K.tileID;break}}}for(const ee in O)z[ee]||(this._coveredTiles[ee]=!0,z[ee]=O[ee])}for(const O in z)this._tiles[O].clearFadeHold();const k=r.bs(this._tiles,z);for(const O of k){const j=this._tiles[O];j.hasSymbolBuckets&&!j.holdingForFade()?j.setHoldDuration(this.map._fadeDuration):j.hasSymbolBuckets&&!j.symbolFadeFinished()||this._removeTile(+O)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const a={};if(t.length===0)return a;const u={},p=t.reduce((I,z)=>Math.min(I,z.overscaledZ),1/0),g=t[0].overscaledZ,v=Math.max(g-Sa.maxOverzooming,this._source.minzoom),w=Math.max(g+Sa.maxUnderzooming,this._source.minzoom),A={};for(const I of t){const z=this._addTile(I);a[I.key]=I,z.hasData()||p<this._source.maxzoom&&(A[I.key]=I)}this._retainLoadedChildren(A,p,w,a);for(const I of t){let z=this._tiles[I.key];if(z.hasData())continue;if(I.canonical.z>=this._source.maxzoom){const O=I.children(this._source.maxzoom)[0],j=this.getTile(O);if(j&&j.hasData()){a[O.key]=O;continue}}else{const O=I.children(this._source.maxzoom);if(a[O[0].key]&&a[O[1].key]&&a[O[2].key]&&a[O[3].key])continue}let k=z.wasRequested();for(let O=I.overscaledZ-1;O>=v;--O){const j=I.scaledTo(O);if(u[j.key]||(u[j.key]=!0,z=this.getTile(j),!z&&k&&(z=this._addTile(j)),z&&(a[j.key]=j,k=z.wasRequested(),z.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const a=[];let u,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}a.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(g),u)break;p=g}for(const g of a)this._loadedParentTiles[g]=u}}_addTile(t){let a=this._tiles[t.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));const u=!!a;if(!u){const p=this.map?this.map.painter:null,g=this._source.tileSize*t.overscaleFactor();a=this._source.type==="raster-array"?new kh(t,g,this.transform.tileZoom,p,this._isRaster):new Cs(t,g,this.transform.tileZoom,p,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,t.key,a.state))}return a.uses++,this._tiles[t.key]=a,u||this._source.fire(new r.A("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=a.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,a,u){const p=[],g=this.transform;if(!g)return p;const v=g.projection.name==="globe",w=r.ay(g.center.lng);for(const A in this._tiles){const I=this._tiles[A];if(u&&I.clearQueryDebugViz(),I.holdingForFade())continue;let z;if(v){const k=I.tileID.canonical;if(k.z===0){const O=[Math.abs(r.aD(w,...Rs(k,-1))-w),Math.abs(r.aD(w,...Rs(k,1))-w)];z=[0,2*O.indexOf(Math.min(...O))-1]}else{const O=[Math.abs(r.aD(w,...Rs(k,-1))-w),Math.abs(r.aD(w,...Rs(k,0))-w),Math.abs(r.aD(w,...Rs(k,1))-w)];z=[O.indexOf(Math.min(...O))-1]}}else z=[0];for(const k of z){const O=t.containsTile(I,g,a,k);O&&p.push(O)}}return p}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,a){const u=this.getRenderableIds(t,a).map(g=>this._tiles[g].tileID),p=this.transform.projection.name==="globe";for(const g of u)g.projMatrix=this.transform.calculateProjMatrix(g.toUnwrapped()),g.expandedProjMatrix=p?this.transform.calculateProjMatrix(g.toUnwrapped(),!1,!0):g.projMatrix;return u}sortCoordinatesByDistance(t){const a=t.slice(),u=this.transform._camera.position,p=this.transform._camera.forward(),g={};for(const v of a){const w=1/(1<<v.canonical.z);g[v.key]=((v.canonical.x+.5)*w+v.wrap-u[0])*p[0]+((v.canonical.y+.5)*w-u[1])*p[1]-u[2]*p[2]}return a.sort((v,w)=>g[v.key]-g[w.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(pl(this._source.type))for(const t in this._tiles){const a=this._tiles[t];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=r.q.now())return!0}return!1}setFeatureState(t,a,u){this._state.updateState(t=t||"_geojsonTileLayer",a,u)}removeFeatureState(t,a,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,u)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,u){const p=this._tiles[t];p&&p.setDependencies(a,u)}reloadTilesForDependencies(t,a){for(const u in this._tiles)this._tiles[u].hasDependency(t,a)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(t,a))}_preloadTiles(t,a){if(!this._sourceLoaded){const A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(t,a))};return void this._source.on("data",A)}const u=new Map,p=Array.isArray(t)?t:[t],g=this.map.painter.terrain,v=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const A of p){const I=A.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const z of I)u.set(z.key,z);this.usedForTerrain&&A.updateElevation(!1)}const w=Array.from(u.values());r.bt(w,(A,I)=>{const z=new Cs(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(z,k=>{this._source.type==="raster-dem"&&z.dem&&this._backfillDEM(z),I(k,z)})},a)}}function Vu(c,t){const a=Math.abs(2*c.wrap)-+(c.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return c.overscaledZ-t.overscaledZ||u-a||t.canonical.y-c.canonical.y||t.canonical.x-c.canonical.x}function pl(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function Rs(c,t){const a=1<<c.z;return[c.x/a+t,(c.x+1)/a+t]}Sa.maxOverzooming=10,Sa.maxUnderzooming=3;class op{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,a=!1;for(const u in this.style._mergedLayers){const p=this.style._mergedLayers[u];if(p.type==="fill-extrusion")this.layers.push({layer:p,visible:t,visibilityChanged:a});else if(p.type==="model"){const g=this.style.getLayerSource(p);g&&g.type==="batched-model"&&this.layers.push({layer:p,visible:t,visibilityChanged:a})}}}onNewFrame(t){this.layersGotHidden=!1;for(const a of this.layers){const u=a.layer;let p=!1;u.type==="fill-extrusion"?p=!u.isHidden(t)&&u.paint.get("fill-extrusion-opacity")>0:u.type==="model"&&(p=!u.isHidden(t)&&u.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!p&&a.visible,a.visible=p}}updateZOffset(t,a){this.currentBuildingBuckets=[];for(const p of this.layers){const g=p.layer,v=this.style.getLayerSourceCache(g);let w=1;g.type==="fill-extrusion"&&(w=p.visible?g.paint.get("fill-extrusion-vertical-scale"):0);let A=v?v.getTile(a):null;if(!A&&v&&a.canonical.z>v.getSource().minzoom){let I=a.scaledTo(Math.min(v.getSource().maxzoom,a.overscaledZ-1));for(;I.overscaledZ>=v.getSource().minzoom&&(A=v.getTile(I),!A&&I.overscaledZ!==0);)I=I.scaledTo(I.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:A?A.getBucket(g):null,tileID:A?A.tileID:a,verticalScale:w})}t.hasAnyZOffset=!1;let u=!1;for(let p=0;p<t.symbolInstances.length;p++){const g=t.symbolInstances.get(p),v=g.zOffset,w=this._getHeightAtTileOffset(a,g.tileAnchorX,g.tileAnchorY);g.zOffset=w!==Number.NEGATIVE_INFINITY?w:v,u||v===g.zOffset||(u=!0),t.hasAnyZOffset||g.zOffset===0||(t.hasAnyZOffset=!0)}u&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,a,u,p){let g=a,v=u;if(t.canonical.z!==p.canonical.z){const w=p.canonical,A=1/(1<<t.canonical.z-w.z);g=(a+t.canonical.x*r.aj)*A-w.x*r.aj|0,v=(u+t.canonical.y*r.aj)*A-w.y*r.aj|0}return{tileX:g,tileY:v}}_getHeightAtTileOffset(t,a,u){let p,g;for(let v=0;v<this.layers.length;++v){if(this.layers[v].layer.type!=="fill-extrusion")continue;const{bucket:w,tileID:A,verticalScale:I}=this.currentBuildingBuckets[v];if(!w)continue;const{tileX:z,tileY:k}=this._mapCoordToOverlappingTile(t,a,u,A),O=w.getHeightAtTileCoord(z,k);O&&O.height!==void 0&&(O.hidden?p=O.height:g=Math.max(O.height*I,g||0))}if(g!==void 0)return g;for(let v=0;v<this.layers.length;++v){const w=this.layers[v];if(w.layer.type!=="model"||!w.visible)continue;const{bucket:A,tileID:I}=this.currentBuildingBuckets[v];if(!A)continue;const{tileX:z,tileY:k}=this._mapCoordToOverlappingTile(t,a,u,I),O=A.getHeightAtTileCoord(z,k);if(O&&!O.hidden)return O.height===void 0&&p!==void 0?Math.min(O.maxHeight,p)*O.verticalScale:O.height?O.height*O.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Gu(c,t){const a={};for(const u in c)u!=="ref"&&(a[u]=c[u]);return r.bu.forEach(u=>{u in t&&(a[u]=t[u])}),a}function Nh(c){c=c.slice();const t=Object.create(null);for(let a=0;a<c.length;a++)t[c[a].id]=c[a];for(let a=0;a<c.length;a++)"ref"in c[a]&&(c[a]=Gu(c[a],t[c[a].ref]));return c}const gn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Ao(c,t,a){a.push({command:gn.addSource,args:[c,t[c]]})}function Xl(c,t,a){t.push({command:gn.removeSource,args:[c]}),a[c]=!0}function Bh(c,t,a,u){Xl(c,a,u),Ao(c,t,a)}function ml(c,t,a){let u;for(u in c[a])if(c[a].hasOwnProperty(u)&&u!=="data"&&!r.bv(c[a][u],t[a][u]))return!1;for(u in t[a])if(t[a].hasOwnProperty(u)&&u!=="data"&&!r.bv(c[a][u],t[a][u]))return!1;return!0}function gl(c,t,a,u,p,g){let v;for(v in t=t||{},c=c||{})c.hasOwnProperty(v)&&(r.bv(c[v],t[v])||a.push({command:g,args:[u,v,t[v],p]}));for(v in t)t.hasOwnProperty(v)&&!c.hasOwnProperty(v)&&(r.bv(c[v],t[v])||a.push({command:g,args:[u,v,t[v],p]}))}function Is(c){return c.id}function Oc(c,t){return c[t.id]=t,c}class Fh{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=r.aD(t,0,1);let a=1,u=this._distances[a];const p=t*this.paddedLength+this.padding;for(;u<p&&a<this._distances.length;)u=this._distances[++a];const g=a-1,v=this._distances[g],w=u-v,A=w>0?(p-v)/w:0;return this.points[g].mult(1-A).add(this.points[a].mult(A))}}class Hu{constructor(t,a,u){const p=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(a/u);for(let v=0;v<this.xCellCount*this.yCellCount;v++)p.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,u,p,g){this._forEachCell(a,u,p,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(g)}insertCircle(t,a,u,p){this._forEachCell(a-p,u-p,a+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(u),this.circles.push(p)}_insertBoxCell(t,a,u,p,g,v){this.boxCells[g].push(v)}_insertCircleCell(t,a,u,p,g,v){this.circleCells[g].push(v)}_query(t,a,u,p,g,v){if(u<0||t>this.width||p<0||a>this.height)return!g&&[];const w=[];if(t<=0&&a<=0&&this.width<=u&&this.height<=p){if(g)return!0;for(let A=0;A<this.boxKeys.length;A++)w.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const I=this.circles[3*A],z=this.circles[3*A+1],k=this.circles[3*A+2];w.push({key:this.circleKeys[A],x1:I-k,y1:z-k,x2:I+k,y2:z+k})}return v?w.filter(v):w}return this._forEachCell(t,a,u,p,this._queryCell,w,{hitTest:g,seenUids:{box:{},circle:{}}},v),g?w.length>0:w}_queryCircle(t,a,u,p,g){const v=t-u,w=t+u,A=a-u,I=a+u;if(w<0||v>this.width||I<0||A>this.height)return!p&&[];const z=[];return this._forEachCell(v,A,w,I,this._queryCellCircle,z,{hitTest:p,circle:{x:t,y:a,radius:u},seenUids:{box:{},circle:{}}},g),p?z.length>0:z}query(t,a,u,p,g){return this._query(t,a,u,p,!1,g)}hitTest(t,a,u,p,g){return this._query(t,a,u,p,!0,g)}hitTestCircle(t,a,u,p){return this._queryCircle(t,a,u,!0,p)}_queryCell(t,a,u,p,g,v,w,A){const I=w.seenUids,z=this.boxCells[g];if(z!==null){const O=this.bboxes;for(const j of z)if(!I.box[j]){I.box[j]=!0;const Q=4*j;if(t<=O[Q+2]&&a<=O[Q+3]&&u>=O[Q+0]&&p>=O[Q+1]&&(!A||A(this.boxKeys[j]))){if(w.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[j],x1:O[Q],y1:O[Q+1],x2:O[Q+2],y2:O[Q+3]})}}}const k=this.circleCells[g];if(k!==null){const O=this.circles;for(const j of k)if(!I.circle[j]){I.circle[j]=!0;const Q=3*j;if(this._circleAndRectCollide(O[Q],O[Q+1],O[Q+2],t,a,u,p)&&(!A||A(this.circleKeys[j]))){if(w.hitTest)return v.push(!0),!0;{const Y=O[Q],ee=O[Q+1],K=O[Q+2];v.push({key:this.circleKeys[j],x1:Y-K,y1:ee-K,x2:Y+K,y2:ee+K})}}}}}_queryCellCircle(t,a,u,p,g,v,w,A){const I=w.circle,z=w.seenUids,k=this.boxCells[g];if(k!==null){const j=this.bboxes;for(const Q of k)if(!z.box[Q]){z.box[Q]=!0;const Y=4*Q;if(this._circleAndRectCollide(I.x,I.y,I.radius,j[Y+0],j[Y+1],j[Y+2],j[Y+3])&&(!A||A(this.boxKeys[Q])))return v.push(!0),!0}}const O=this.circleCells[g];if(O!==null){const j=this.circles;for(const Q of O)if(!z.circle[Q]){z.circle[Q]=!0;const Y=3*Q;if(this._circlesCollide(j[Y],j[Y+1],j[Y+2],I.x,I.y,I.radius)&&(!A||A(this.circleKeys[Q])))return v.push(!0),!0}}}_forEachCell(t,a,u,p,g,v,w,A){const I=this._convertToXCellCoord(t),z=this._convertToYCellCoord(a),k=this._convertToXCellCoord(u),O=this._convertToYCellCoord(p);for(let j=I;j<=k;j++)for(let Q=z;Q<=O;Q++)if(g.call(this,t,a,u,p,this.xCellCount*Q+j,v,w,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,u,p,g,v){const w=p-t,A=g-a,I=u+v;return I*I>w*w+A*A}_circleAndRectCollide(t,a,u,p,g,v,w){const A=(v-p)/2,I=Math.abs(t-(p+A));if(I>A+u)return!1;const z=(w-g)/2,k=Math.abs(a-(g+z));if(k>z+u)return!1;if(I<=A||k<=z)return!0;const O=I-A,j=k-z;return O*O+j*j<=u*u}}const Wl={unknown:0,flipRequired:1,flipNotRequired:2},Ea=Math.tan(85*Math.PI/180);function as(c,t,a,u,p,g,v){const w=r.bz();if(a)if(g.name==="globe"){const A=r.bA(p,t);r.az(w,w,A)}else{const A=r.bB([],v);w[0]=A[0],w[1]=A[1],w[4]=A[2],w[5]=A[3],u||r.by(w,w,p.angle)}else r.az(w,p.labelPlaneMatrix,c);return w}function kc(c,t,a,u,p,g,v){const w=as(c,t,a,u,p,g,v);return g.name==="globe"&&a||(w[2]=w[6]=w[10]=w[14]=0),w}function Nc(c,t,a,u,p,g,v){if(a){if(g.name==="globe"){const w=as(c,t,a,u,p,g,v);return r.bi(w,w),r.az(w,c,w),w}{const w=r.bw(c),A=r.bx([]);return A[0]=v[0],A[1]=v[1],A[4]=v[2],A[5]=v[3],r.az(w,w,A),u||r.by(w,w,-p.angle),w}}return p.glCoordMatrix}function Mo(c,t,a,u){const p=[c,t,a,1];a?r.aA(p,p,u):Pm(p,p,u);const g=p[3];return p[0]/=g,p[1]/=g,p[2]/=g,p}function tl(c,t){return Math.min(.5+c/t*.5,1.5)}function jh(c,t){const a=c[0]/c[3],u=c[1]/c[3];return a>=-t[0]&&a<=t[0]&&u>=-t[1]&&u<=t[1]}function Bc(c,t,a,u,p,g,v,w,A,I){const z=a.transform,k=u?c.textSizeData:c.iconSizeData,O=r.bH(k,a.transform.zoom),j=z.projection.name==="globe",Q=[256/a.width*2+1,256/a.height*2+1],Y=u?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;Y.clear();let ee=null;j&&(ee=u?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const K=c.lineVertexArray,se=u?c.text.placedSymbolArray:c.icon.placedSymbolArray,pe=a.transform.width/a.transform.height;let ve,Ae=!1;for(let Se=0;Se<se.length;Se++){const Te=se.get(Se),{numGlyphs:ge,writingMode:Ce}=Te;if(Ce!==r.bI.vertical||Ae||ve===r.bI.horizontal||(Ae=!0),ve=Ce,(Te.hidden||Ce===r.bI.vertical)&&!Ae){Cn(ge,Y);continue}Ae=!1;const Le=new r.P(Te.tileAnchorX,Te.tileAnchorY);let{x:Qe,y:Ze,z:ht}=z.projection.projectTilePoint(Le.x,Le.y,I.canonical);if(A){const[Qt,ai,Yt]=A(Le);Qe+=Qt,Ze+=ai,ht+=Yt}const lt=[Qe,Ze,ht,1];if(r.aA(lt,lt,t),!jh(lt,Q)){Cn(ge,Y);continue}const Ct=lt[3],$e=tl(a.transform.getCameraToCenterDistance(z.projection),Ct),et=r.bJ(k,O,Te),Ge=v?et/$e:et*$e,pt=Mo(Qe,Ze,ht,p);if(pt[3]<=0){Cn(ge,Y);continue}let tt={};const bt=r.al(c.layers[0].layout.get("text-max-angle")),dt=Math.cos(bt),wt=v?null:A,At=Co(Te,Ge,!1,w,t,p,g,c.glyphOffsetArray,K,Y,ee,pt,Le,tt,pe,wt,z.projection,I,v,dt);Ae=At.useVertical,wt&&At.needsFlipping&&(tt={}),(At.notEnoughRoom||Ae||At.needsFlipping&&Co(Te,Ge,!0,w,t,p,g,c.glyphOffsetArray,K,Y,ee,pt,Le,tt,pe,wt,z.projection,I,v,dt).notEnoughRoom)&&Cn(ge,Y)}u?(c.text.dynamicLayoutVertexBuffer.updateData(Y),ee&&c.text.globeExtVertexBuffer&&c.text.globeExtVertexBuffer.updateData(ee)):(c.icon.dynamicLayoutVertexBuffer.updateData(Y),ee&&c.icon.globeExtVertexBuffer&&c.icon.globeExtVertexBuffer.updateData(ee))}function Fc(c,t,a,u,p,g,v,w,A,I,z,k,O,j,Q,Y,ee){const{lineStartIndex:K,glyphStartIndex:se,segment:pe}=w,ve=se+w.numGlyphs,Ae=K+w.lineLength,Se=t.getoffsetX(se),Te=t.getoffsetX(ve-1),ge=jc(c*Se,a,u,p,g,v,pe,K,Ae,A,I,z,k,O,!0,j,Q,Y,ee);if(!ge)return null;const Ce=jc(c*Te,a,u,p,g,v,pe,K,Ae,A,I,z,k,O,!0,j,Q,Y,ee);return Ce?{first:ge,last:Ce}:null}function Yl(c,t,a,u){return c===r.bI.horizontal&&Math.abs(u)>Math.abs(a)?{useVertical:!0}:c===r.bI.vertical?u>0?{needsFlipping:!0}:null:t!==Wl.unknown&&function(p,g){return p===0||Math.abs(g/p)>Ea}(a,u)?t===Wl.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function Co(c,t,a,u,p,g,v,w,A,I,z,k,O,j,Q,Y,ee,K,se,pe){const ve=t/24,Ae=c.lineOffsetX*ve,Se=c.lineOffsetY*ve,{lineStartIndex:Te,glyphStartIndex:ge,numGlyphs:Ce,segment:Le,writingMode:Qe,flipState:Ze}=c,ht=Te+c.lineLength,lt=Ct=>{if(z){const[pt,tt,bt]=Ct.up,dt=I.length;r.bK(z,dt+0,pt,tt,bt),r.bK(z,dt+1,pt,tt,bt),r.bK(z,dt+2,pt,tt,bt),r.bK(z,dt+3,pt,tt,bt)}const[$e,et,Ge]=Ct.point;r.bL(I,$e,et,Ge,Ct.angle)};if(Ce>1){const Ct=Fc(ve,w,Ae,Se,a,k,O,c,A,g,j,Y,!1,ee,K,se,pe);if(!Ct)return{notEnoughRoom:!0};if(u&&!a){let[$e,et,Ge]=Ct.first.point,[pt,tt,bt]=Ct.last.point;[$e,et]=Mo($e,et,Ge,v),[pt,tt]=Mo(pt,tt,bt,v);const dt=Yl(Qe,Ze,(pt-$e)*Q,tt-et);if(c.flipState=dt&&dt.needsFlipping?Wl.flipRequired:Wl.flipNotRequired,dt)return dt}lt(Ct.first);for(let $e=ge+1;$e<ge+Ce-1;$e++){const et=jc(ve*w.getoffsetX($e),Ae,Se,a,k,O,Le,Te,ht,A,g,j,Y,!1,!1,ee,K,se,pe);if(!et)return I.length-=4*($e-ge),{notEnoughRoom:!0};lt(et)}lt(Ct.last)}else{if(u&&!a){const $e=Mo(O.x,O.y,0,p),et=Te+Le+1,Ge=new r.P(A.getx(et),A.gety(et)),pt=Mo(Ge.x,Ge.y,0,p),tt=pt[3]>0?pt:ef(O,Ge,$e,1,p,void 0,ee,K.canonical),bt=Yl(Qe,Ze,(tt[0]-$e[0])*Q,tt[1]-$e[1]);if(c.flipState=bt&&bt.needsFlipping?Wl.flipRequired:Wl.flipNotRequired,bt)return bt}const Ct=jc(ve*w.getoffsetX(ge),Ae,Se,a,k,O,Le,Te,ht,A,g,j,Y,!1,!1,ee,K,se,pe);if(!Ct)return{notEnoughRoom:!0};lt(Ct)}return{}}function sp(c,t,a,u,p){const{x:g,y:v,z:w}=u.projectTilePoint(c.x,c.y,t);if(!p)return Mo(g,v,w,a);const[A,I,z]=p(c);return Mo(g+A,v+I,w+z,a)}function ef(c,t,a,u,p,g,v,w){const A=sp(c.sub(t)._unit()._add(c),w,p,v,g);return r.at(A,a,A),r.au(A,A),r.bF(A,a,A,u)}function jc(c,t,a,u,p,g,v,w,A,I,z,k,O,j,Q,Y,ee,K,se){const pe=u?c-t:c+t;let ve=pe>0?1:-1,Ae=0;u&&(ve*=-1,Ae=Math.PI),ve<0&&(Ae+=Math.PI);let Se=w+v+(ve>0?0:1)|0,Te=p,ge=p,Ce=0,Le=0;const Qe=Math.abs(pe),Ze=[],ht=[];let lt=g,Ct=lt,$e=r.bC([]);const et=()=>ef(Ct,lt,ge,Qe-Ce+1,z,O,Y,ee.canonical);for(;Ce+Le<=Qe;){if(Se+=ve,Se<w||Se>=A)return null;if(ge=Te,Ct=lt,Ze.push(ge),j&&ht.push(Ct),lt=new r.P(I.getx(Se),I.gety(Se)),Te=k[Se],!Te){const Yt=sp(lt,ee.canonical,z,Y,O);Te=Yt[3]>0?k[Se]=Yt:et()}Ce+=Le;const Qt=r.at([],Te,ge),ai=r.bD(ge,Te);if(a&&ai>0&&Le>0&&r.bE($e,Qt)/(Le*ai)<se)return null;Le=ai,$e=Qt}Q&&O&&(k[Se]&&(Te=et(),Le=r.bD(ge,Te),$e=r.at([],Te,ge)),k[Se]=Te);const Ge=(Qe-Ce)/Le,pt=lt.sub(Ct)._mult(Ge)._add(Ct),tt=r.bF([],ge,$e,Ge);let bt=[0,0,1],dt=$e[0],wt=$e[1];if(K&&(bt=Y.upVector(ee.canonical,pt.x,pt.y),bt[0]!==0||bt[1]!==0||bt[2]!==1)){const Qt=[bt[2],0,-bt[0]],ai=r.bG([],bt,Qt);r.au(Qt,Qt),r.au(ai,ai),dt=r.bE($e,Qt),wt=r.bE($e,ai)}if(a){const Qt=r.bG([],bt,$e);r.au(Qt,Qt),r.bF(tt,tt,Qt,a*ve)}const At=Ae+Math.atan2(wt,dt);return Ze.push(tt),j&&ht.push(pt),{point:tt,angle:At,path:Ze,tilePath:ht,up:bt}}function Cn(c,t){const a=t.length,u=a+4*c;t.resize(u),t.float32.fill(-1/0,4*a,4*u)}function Pm(c,t,a){const u=t[0],p=t[1];return c[0]=a[0]*u+a[4]*p+a[12],c[1]=a[1]*u+a[5]*p+a[13],c[3]=a[3]*u+a[7]*p+a[15],c}const Ti=100;class Lm{constructor(t,a,u=new Hu(t.width+200,t.height+200,25),p=new Hu(t.width+200,t.height+200,25)){this.transform=t,this.grid=u,this.ignoredGrid=p,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Ti,this.screenBottomBoundary=t.height+Ti,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=a}placeCollisionBox(t,a,u,p,g,v,w,A){let I=u.projectedAnchorX,z=u.projectedAnchorY,k=u.projectedAnchorZ;const O=u.elevation,j=u.tileID,Q=t.getProjection();if(O&&j){const[Se,Te,ge]=Q.upVector(j.canonical,u.tileAnchorX,u.tileAnchorY),Ce=Q.upVectorScale(j.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;I+=Se*O*Ce,z+=Te*O*Ce,k+=ge*O*Ce}const Y=this.projectAndGetPerspectiveRatio(w,I,z,k,u.tileID,Q.name==="globe"||!!O||this.transform.pitch>0,Q),ee=v*Y.perspectiveRatio,K=(u.x1*a+p.x-u.padding)*ee+Y.point.x,se=(u.y1*a+p.y-u.padding)*ee+Y.point.y,pe=(u.x2*a+p.x+u.padding)*ee+Y.point.x,ve=(u.y2*a+p.y+u.padding)*ee+Y.point.y,Ae=Y.perspectiveRatio<=.55||Y.occluded;return!this.isInsideGrid(K,se,pe,ve)||!g&&this.grid.hitTest(K,se,pe,ve,A)||Ae?{box:[],offscreen:!1,occluded:Y.occluded}:{box:[K,se,pe,ve],offscreen:this.isOffscreen(K,se,pe,ve),occluded:!1}}placeCollisionCircles(t,a,u,p,g,v,w,A,I,z,k,O,j,Q,Y){const ee=[],K=this.transform.elevation,se=t.getProjection(),pe=K?K.getAtTileOffsetFunc(Y,this.transform.center.lat,this.transform.worldSize,se):null,ve=new r.P(u.tileAnchorX,u.tileAnchorY);let{x:Ae,y:Se,z:Te}=se.projectTilePoint(ve.x,ve.y,Y.canonical);if(pe){const[bt,dt,wt]=pe(ve);Ae+=bt,Se+=dt,Te+=wt}const ge=se.name==="globe",Ce=this.projectAndGetPerspectiveRatio(w,Ae,Se,Te,Y,ge||!!K||this.transform.pitch>0,se),{perspectiveRatio:Le}=Ce,Qe=(k?v/Le:v*Le)/r.bO,Ze=Mo(Ae,Se,Te,A),ht=u.lineOffsetX*Qe,lt=u.lineOffsetY*Qe,Ct=r.al(t.layers[0].layout.get("text-max-angle")),$e=Math.cos(Ct),et=Ce.signedDistanceFromCamera>0?Fc(Qe,g,ht,lt,!1,Ze,ve,u,p,A,{},K&&!k?pe:null,k&&!!K,se,Y,k,$e):null;let Ge=!1,pt=!1,tt=!0;if(et&&!Ce.occluded){const bt=.5*j*Le+Q,dt=new r.P(-100,-100),wt=new r.P(this.screenRightBoundary,this.screenBottomBoundary),At=new Fh,{first:Qt,last:ai}=et,Yt=Qt.path.length;let ci=[];for(let Ni=Yt-1;Ni>=1;Ni--)ci.push(Qt.path[Ni]);for(let Ni=1;Ni<ai.path.length;Ni++)ci.push(ai.path[Ni]);const ii=2.5*bt;I&&(ci=ci.map(([Ni,Ai,Hi],zi)=>(pe&&!ge&&(Hi=pe(zi<Yt-1?Qt.tilePath[Yt-1-zi]:ai.tilePath[zi-Yt+2])[2]),Mo(Ni,Ai,Hi,I))),ci.some(Ni=>Ni[3]<=0)&&(ci=[]));let Mi=[];if(ci.length>0){let Ni=1/0,Ai=-1/0,Hi=1/0,zi=-1/0;for(const wi of ci)Ni=Math.min(Ni,wi[0]),Hi=Math.min(Hi,wi[1]),Ai=Math.max(Ai,wi[0]),zi=Math.max(zi,wi[1]);Ai>=dt.x&&Ni<=wt.x&&zi>=dt.y&&Hi<=wt.y&&(Mi=[ci.map(wi=>new r.P(wi[0],wi[1]))],(Ni<dt.x||Ai>wt.x||Hi<dt.y||zi>wt.y)&&(Mi=r.bM(Mi,dt.x,dt.y,wt.x,wt.y)))}for(const Ni of Mi){At.reset(Ni,.25*bt);let Ai=0;Ai=At.length<=.5*bt?1:Math.ceil(At.paddedLength/ii)+1;for(let Hi=0;Hi<Ai;Hi++){const zi=Hi/Math.max(Ai-1,1),wi=At.lerp(zi),an=wi.x+Ti,zn=wi.y+Ti;ee.push(an,zn,bt,0);const Bi=an-bt,on=zn-bt,vn=an+bt,wn=zn+bt;if(tt=tt&&this.isOffscreen(Bi,on,vn,wn),pt=pt||this.isInsideGrid(Bi,on,vn,wn),!a&&this.grid.hitTestCircle(an,zn,bt,O)&&(Ge=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Ge,occluded:!1}}}}return{circles:!z&&Ge||!pt?[]:ee,offscreen:tt,collisionDetected:Ge,occluded:Ce.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let u=1/0,p=1/0,g=-1/0,v=-1/0;for(const z of t){const k=new r.P(z.x+Ti,z.y+Ti);u=Math.min(u,k.x),p=Math.min(p,k.y),g=Math.max(g,k.x),v=Math.max(v,k.y),a.push(k)}const w=this.grid.query(u,p,g,v).concat(this.ignoredGrid.query(u,p,g,v)),A={},I={};for(const z of w){const k=z.key;if(A[k.bucketInstanceId]===void 0&&(A[k.bucketInstanceId]={}),A[k.bucketInstanceId][k.featureIndex])continue;const O=[new r.P(z.x1,z.y1),new r.P(z.x2,z.y1),new r.P(z.x2,z.y2),new r.P(z.x1,z.y2)];r.bN(a,O)&&(A[k.bucketInstanceId][k.featureIndex]=!0,I[k.bucketInstanceId]===void 0&&(I[k.bucketInstanceId]=[]),I[k.bucketInstanceId].push(k.featureIndex))}return I}insertCollisionBox(t,a,u,p,g){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:g},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,u,p,g){const v=a?this.ignoredGrid:this.grid,w={bucketInstanceId:u,featureIndex:p,collisionGroupID:g};for(let A=0;A<t.length;A+=4)v.insertCircle(w,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,a,u,p,g,v,w){const A=[a,u,p,1];let I=!1;p||this.transform.pitch>0?(r.aA(A,A,t),this.fogState&&g&&w.name!=="globe"&&(I=function(O,j,Q,Y,ee,K){const se=K.calculateFogTileMatrix(ee),pe=[j,Q,Y];return r.ad(pe,pe,se),Vt(O,r.ae(pe),K.pitch,K._fov)}(this.fogState,a,u,p,g.toUnwrapped(),this.transform)>.9)):Pm(A,A,t);const z=A[3];return{point:new r.P((A[0]/z+1)/2*this.transform.width+Ti,(-A[1]/z+1)/2*this.transform.height+Ti),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(w)/z*.5,1.5),signedDistanceFromCamera:z,occluded:v&&A[2]>z||I}}isOffscreen(t,a,u,p){return u<Ti||t>=this.screenRightBoundary||p<Ti||a>this.screenBottomBoundary}isInsideGrid(t,a,u,p){return u>=0&&t<this.gridRightBoundary&&p>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=r.bx([]);return r.bo(t,t,[-100,-100,0]),t}}function tf(c,t,a){const u=t.createTileMatrix(c,c.worldSize,a.toUnwrapped());return r.az(new Float32Array(16),c.projMatrix,u)}function Uh(c,t,a){if(t.projection.name===a.projection.name)return c.projMatrix;const u=a.clone();return u.setProjection(t.projection),tf(u,t.getProjection(),c)}function Vh(c,t,a){return t.name===a.projection.name?c.projMatrix:tf(a,t,c)}class os{constructor(t,a,u,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Uc{constructor(t,a,u,p,g,v=!1){this.text=new os(t?t.text:null,a,u,g),this.icon=new os(t?t.icon:null,a,p,g),this.clipped=v}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Kl{constructor(t,a,u,p=!1){this.text=t,this.icon=a,this.skipFade=u,this.clipped=p}}class di{constructor(){this.invProjMatrix=r.bz(),this.viewportMatrix=r.bz(),this.circles=[]}}class qn{constructor(t,a,u,p,g){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=g}}class kn{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:u=>u.collisionGroupID===a}}return this.collisionGroups[t]}}function ao(c,t,a,u,p){const{horizontalAlign:g,verticalAlign:v}=r.bV(c),w=-(g-.5)*t,A=-(v-.5)*a,I=r.bU(c,u);return new r.P(w+I[0]*p,A+I[1]*p)}function _l(c,t,a,u,p){const g=new r.P(c,t);return a&&g._rotate(u?p:-p),g}class On{constructor(t,a,u,p,g,v){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Lm(this.transform,g),this.buildingIndex=v,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new kn(u),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,a,u,p,g=1){const v=u.getBucket(a),w=u.latestFeatureIndex;if(!v||!w||a.fqid!==v.layerIds[0])return;const A=v.layers[0].layout,I=v.layers[0].paint,z=u.collisionBoxArray,k=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),O=u.tileSize/r.aj,j=u.tileID.toUnwrapped();this.transform.setProjection(v.projection);const Q=(Y=u.tileID,ee=v.getProjection(),K=this.transform,ee.name===this.projection?K.calculateProjMatrix(Y.toUnwrapped()):tf(K,ee,Y));var Y,ee,K;const se=A.get("text-pitch-alignment")==="map",pe=A.get("text-rotation-alignment")==="map";a.compileFilter(a.options);const ve=a.dynamicFilter(),Ae=a.dynamicFilterNeedsFeature(),Se=this.transform.calculatePixelsToTileUnitsMatrix(u),Te=kc(Q,u.tileID.canonical,se,pe,this.transform,v.getProjection(),Se);let ge=null;if(se){const et=Nc(Q,u.tileID.canonical,se,pe,this.transform,v.getProjection(),Se);ge=r.az([],this.transform.labelPlaneMatrix,et)}let Ce=null;ve&&u.latestFeatureIndex&&(Ce={unwrappedTileID:j,dynamicFilter:ve,dynamicFilterNeedsFeature:Ae}),this.retainedQueryData[v.bucketInstanceId]=new qn(v.bucketInstanceId,w,v.sourceLayerIndex,v.index,u.tileID);const[Le,Qe]=v.layers[0].layout.get("text-size-scale-range"),Ze=r.aD(g,Le,Qe),[ht,lt]=A.get("icon-size-scale-range"),Ct=r.aD(g,ht,lt),$e={bucket:v,layout:A,paint:I,posMatrix:Q,textLabelPlaneMatrix:Te,labelToScreenMatrix:ge,clippingData:Ce,scale:k,textPixelRatio:O,holdingForFade:u.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:r.bH(v.textSizeData,this.transform.zoom,Ze),partiallyEvaluatedIconSize:r.bH(v.iconSizeData,this.transform.zoom,Ct),collisionGroup:this.collisionGroups.get(v.sourceID),latestFeatureIndex:u.latestFeatureIndex};if(p)for(const et of v.sortKeyRanges){const{sortKey:Ge,symbolInstanceStart:pt,symbolInstanceEnd:tt}=et;t.push({sortKey:Ge,symbolInstanceStart:pt,symbolInstanceEnd:tt,parameters:$e})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:$e})}attemptAnchorPlacement(t,a,u,p,g,v,w,A,I,z,k,O,j,Q,Y,ee,K,se){const{textOffset0:pe,textOffset1:ve,crossTileID:Ae}=O,Se=[pe,ve],Te=ao(t,u,p,Se,g),ge=this.collisionIndex.placeCollisionBox(Q,g,a,_l(Te.x,Te.y,v,w,this.transform.angle),k,A,I,z.predicate);if(ee){const Ce=Q.getSymbolInstanceIconSize(se,this.transform.zoom,O.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Q,Ce,ee,_l(Te.x,Te.y,v,w,this.transform.angle),k,A,I,z.predicate).box.length===0)return}if(ge.box.length>0){let Ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ae]&&this.prevPlacement.placements[Ae]&&this.prevPlacement.placements[Ae].text&&(Ce=this.prevPlacement.variableOffsets[Ae].anchor),this.variableOffsets[Ae]={textOffset:Se,width:u,height:p,anchor:t,textScale:g,prevAnchor:Ce},this.markUsedJustification(Q,t,O,Y),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,Y,O),this.placedOrientations[Ae]=Y),{shift:Te,placedGlyphBoxes:ge}}}placeLayerBucketPart(t,a,u,p,g=1){const{bucket:v,layout:w,paint:A,posMatrix:I,textLabelPlaneMatrix:z,labelToScreenMatrix:k,clippingData:O,textPixelRatio:j,holdingForFade:Q,collisionBoxArray:Y,partiallyEvaluatedTextSize:ee,partiallyEvaluatedIconSize:K,collisionGroup:se,latestFeatureIndex:pe}=t.parameters,ve=w.get("text-optional"),Ae=w.get("icon-optional"),Se=w.get("text-allow-overlap"),Te=w.get("icon-allow-overlap"),ge=w.get("text-rotation-alignment")==="map",Ce=w.get("text-pitch-alignment")==="map",Le=A.get("symbol-z-offset"),Qe=w.get("symbol-elevation-reference")==="sea",[Ze,ht]=w.get("text-size-scale-range"),[lt,Ct]=w.get("icon-size-scale-range"),$e=r.aD(g,Ze,ht),et=r.aD(g,lt,Ct);this.transform.setProjection(v.projection);let Ge=Se&&(Te||!v.hasIconData()||Ae),pt=Te&&(Se||!v.hasTextData()||ve);const tt=!Le.isConstant();!v.collisionArrays&&Y&&v.deserializeCollisionBoxes(Y),u&&p&&v.updateCollisionDebugBuffers(this.transform.zoom,Y,$e,et);const bt=(dt,wt,At)=>{const{crossTileID:Qt,numVerticalGlyphVertices:ai}=dt;let Yt=null;if(O&&O.dynamicFilterNeedsFeature||tt){const mn=this.retainedQueryData[v.bucketInstanceId];Yt=pe.loadFeature({featureIndex:dt.featureIndex,bucketIndex:mn.bucketIndex,sourceLayerIndex:mn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(O&&!(0,O.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Yt,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new r.P(dt.tileAnchorX,dt.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[Qt]=new Kl(!1,!1,!1,!0),void a.add(Qt);const ci=Le.evaluate(Yt,{});if(a.has(Qt))return;if(Q)return void(this.placements[Qt]=new Kl(!1,!1,!1));let ii=!1,Mi=!1,Ni=!0,Ai=!1,Hi=!1,zi=null,wi={box:null,offscreen:null,occluded:null},an={box:null},zn=null,Bi=null,on=null,vn=0,wn=0,Pn=0;At.textFeatureIndex?vn=At.textFeatureIndex:dt.useRuntimeCollisionCircles&&(vn=dt.featureIndex),At.verticalTextFeatureIndex&&(wn=At.verticalTextFeatureIndex);const er=mn=>{mn.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;const Sn=this.transform.elevation;mn.elevation=Qe?ci:ci+(Sn?Sn.getAtTileOffset(mn.tileID,mn.tileAnchorX,mn.tileAnchorY):0),mn.elevation+=dt.zOffset},Ar=At.textBox;if(Ar){er(Ar);const mn=En=>{let ir=r.bI.horizontal;if(v.allowVerticalPlacement&&!En&&this.prevPlacement){const ra=this.prevPlacement.placedOrientations[Qt];ra&&(this.placedOrientations[Qt]=ra,ir=ra,this.markUsedOrientation(v,ir,dt))}return ir},Sn=(En,ir)=>{if(v.allowVerticalPlacement&&ai>0&&At.verticalTextBox){for(const ra of v.writingModes)if(ra===r.bI.vertical?(wi=ir(),an=wi):wi=En(),wi&&wi.box&&wi.box.length)break}else wi=En()};if(w.get("text-variable-anchor")){let En=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Qt]){const Zn=this.prevPlacement.variableOffsets[Qt];En.indexOf(Zn.anchor)>0&&(En=En.filter(Ur=>Ur!==Zn.anchor),En.unshift(Zn.anchor))}const ir=(Zn,Ur,jn)=>{const qr=v.getSymbolInstanceTextSize(ee,dt,this.transform.zoom,wt),Ya=(Zn.x2-Zn.x1)*qr+2*Zn.padding,No=(Zn.y2-Zn.y1)*qr+2*Zn.padding,Ka=dt.hasIconTextFit&&!Te?Ur:null;Ka&&er(Ka);let Bo={box:[],offscreen:!1,occluded:!1};const Zs=Se?2*En.length:En.length;for(let Fo=0;Fo<Zs;++Fo){const Jo=this.attemptAnchorPlacement(En[Fo%En.length],Zn,Ya,No,qr,ge,Ce,j,I,se,Fo>=En.length,dt,wt,v,jn,Ka,ee,K);if(Jo&&(Bo=Jo.placedGlyphBoxes,Bo&&Bo.box&&Bo.box.length)){ii=!0,zi=Jo.shift;break}}return Bo};Sn(()=>ir(Ar,At.iconBox,r.bI.horizontal),()=>{const Zn=At.verticalTextBox;return Zn&&er(Zn),v.allowVerticalPlacement&&!(wi&&wi.box&&wi.box.length)&&ai>0&&Zn?ir(Zn,At.verticalIconBox,r.bI.vertical):{box:null,offscreen:null,occluded:null}}),wi&&(ii=wi.box,Ni=wi.offscreen,Ai=wi.occluded);const ra=mn(!(!wi||!wi.box));if(!ii&&this.prevPlacement){const Zn=this.prevPlacement.variableOffsets[Qt];Zn&&(this.variableOffsets[Qt]=Zn,this.markUsedJustification(v,Zn.anchor,dt,ra))}}else{const En=(ir,ra)=>{const Zn=v.getSymbolInstanceTextSize(ee,dt,this.transform.zoom,wt,g),Ur=this.collisionIndex.placeCollisionBox(v,Zn,ir,new r.P(0,0),Se,j,I,se.predicate);return Ur&&Ur.box&&Ur.box.length&&(this.markUsedOrientation(v,ra,dt),this.placedOrientations[Qt]=ra),Ur};Sn(()=>En(Ar,r.bI.horizontal),()=>{const ir=At.verticalTextBox;return v.allowVerticalPlacement&&ai>0&&ir?(er(ir),En(ir,r.bI.vertical)):{box:null,offscreen:null,occluded:null}}),mn(!!(wi&&wi.box&&wi.box.length))}}if(zn=wi,ii=zn&&zn.box&&zn.box.length>0,Ni=zn&&zn.offscreen,Ai=zn&&zn.occluded,dt.useRuntimeCollisionCircles){const mn=v.text.placedSymbolArray.get(dt.centerJustifiedTextSymbolIndex>=0?dt.centerJustifiedTextSymbolIndex:dt.verticalPlacedTextSymbolIndex),Sn=r.bJ(v.textSizeData,ee,mn),En=w.get("text-padding");Bi=this.collisionIndex.placeCollisionCircles(v,Se,mn,v.lineVertexArray,v.glyphOffsetArray,Sn,I,z,k,u,Ce,se.predicate,dt.collisionCircleDiameter*Sn/r.bO,En,this.retainedQueryData[v.bucketInstanceId].tileID),ii=Se||Bi.circles.length>0&&!Bi.collisionDetected,Ni=Ni&&Bi.offscreen,Ai=Bi.occluded}if(At.iconFeatureIndex&&(Pn=At.iconFeatureIndex),At.iconBox){const mn=Sn=>{er(Sn);const En=dt.hasIconTextFit&&zi?_l(zi.x,zi.y,ge,Ce,this.transform.angle):new r.P(0,0),ir=v.getSymbolInstanceIconSize(K,this.transform.zoom,dt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,ir,Sn,En,Te,j,I,se.predicate)};an&&an.box&&an.box.length&&At.verticalIconBox?(on=mn(At.verticalIconBox),Mi=on.box.length>0):(on=mn(At.iconBox),Mi=on.box.length>0),Ni=Ni&&on.offscreen,Hi=on.occluded}const tr=ve||dt.numHorizontalGlyphVertices===0&&ai===0,ki=Ae||dt.numIconVertices===0;if(tr||ki?ki?tr||(Mi=Mi&&ii):ii=Mi&&ii:Mi=ii=Mi&&ii,ii&&zn&&zn.box&&this.collisionIndex.insertCollisionBox(zn.box,w.get("text-ignore-placement"),v.bucketInstanceId,an&&an.box&&wn?wn:vn,se.ID),Mi&&on&&this.collisionIndex.insertCollisionBox(on.box,w.get("icon-ignore-placement"),v.bucketInstanceId,Pn,se.ID),Bi&&(ii&&this.collisionIndex.insertCollisionCircles(Bi.circles,w.get("text-ignore-placement"),v.bucketInstanceId,vn,se.ID),u)){const mn=v.bucketInstanceId;let Sn=this.collisionCircleArrays[mn];Sn===void 0&&(Sn=this.collisionCircleArrays[mn]=new di);for(let En=0;En<Bi.circles.length;En+=4)Sn.circles.push(Bi.circles[En+0]),Sn.circles.push(Bi.circles[En+1]),Sn.circles.push(Bi.circles[En+2]),Sn.circles.push(Bi.collisionDetected?1:0)}const $n=v.projection.name!=="globe";Ge=Ge&&($n||!Ai),pt=pt&&($n||!Hi),this.placements[Qt]=new Kl(ii||Ge,Mi||pt,Ni||v.justReloaded),a.add(Qt)};if(v.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(v,this.retainedQueryData[v.bucketInstanceId].tileID),v.elevationType==="road"&&v.updateRoadElevation(),v.updateZOffset(),v.sortFeaturesByY){const dt=v.getSortedSymbolIndexes(this.transform.angle);for(let wt=dt.length-1;wt>=0;--wt){const At=dt[wt];bt(v.symbolInstances.get(At),At,v.collisionArrays[At])}v.hasAnyZOffset&&r.w(`${v.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(v.hasAnyZOffset){const dt=v.getSortedIndexesByZOffset();for(let wt=0;wt<dt.length;++wt){const At=dt[wt];bt(v.symbolInstances.get(At),At,v.collisionArrays[At])}}else for(let dt=t.symbolInstanceStart;dt<t.symbolInstanceEnd;dt++)bt(v.symbolInstances.get(dt),dt,v.collisionArrays[dt]);if(u&&v.bucketInstanceId in this.collisionCircleArrays){const dt=this.collisionCircleArrays[v.bucketInstanceId];r.bi(dt.invProjMatrix,I),dt.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(t,a,u,p){const{leftJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:v,rightJustifiedTextSymbolIndex:w,verticalPlacedTextSymbolIndex:A,crossTileID:I}=u,z=r.bT(a),k=p===r.bI.vertical?A:z==="left"?g:z==="center"?v:z==="right"?w:-1;g>=0&&(t.text.placedSymbolArray.get(g).crossTileID=k>=0&&g!==k?0:I),v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=k>=0&&v!==k?0:I),w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=k>=0&&w!==k?0:I),A>=0&&(t.text.placedSymbolArray.get(A).crossTileID=k>=0&&A!==k?0:I)}markUsedOrientation(t,a,u){const p=a===r.bI.horizontal||a===r.bI.horizontalOnly?a:0,g=a===r.bI.vertical?a:0,{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:I}=u,z=t.text.placedSymbolArray;v>=0&&(z.get(v).placedOrientation=p),w>=0&&(z.get(w).placedOrientation=p),A>=0&&(z.get(A).placedOrientation=p),I>=0&&(z.get(I).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let u=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const p=a?a.symbolFadeChange(t):1,g=a?a.opacities:{},v=a?a.variableOffsets:{},w=a?a.placedOrientations:{};for(const A in this.placements){const I=this.placements[A],z=g[A];z?(this.opacities[A]=new Uc(z,p,I.text,I.icon,null,I.clipped),u=u||I.text!==z.text.placed||I.icon!==z.icon.placed):(this.opacities[A]=new Uc(null,p,I.text,I.icon,I.skipFade,I.clipped),u=u||I.text||I.icon)}for(const A in g){const I=g[A];if(!this.opacities[A]){const z=new Uc(I,p,!1,!1);z.isHidden()||(this.opacities[A]=z,u=u||I.text.placed||I.icon.placed)}}for(const A in v)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=v[A]);for(const A in w)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=w[A]);u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a,u,p){const g=new Set;for(const v of a){const w=v.getBucket(t);w&&v.latestFeatureIndex&&t.fqid===w.layerIds[0]&&(this.updateBucketOpacities(w,g,v,v.collisionBoxArray,u,p,v.tileID,t.scope),w.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(w,v.tileID),w.elevationType==="road"&&w.updateRoadElevation(),w.updateZOffset())}}updateBucketOpacities(t,a,u,p,g,v,w,A){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const I=t.layers[0].layout,z=t.layers[0].paint,k=!!t.layers[0].dynamicFilter(),O=new Uc(null,0,!1,!1,!0),j=I.get("text-allow-overlap"),Q=I.get("icon-allow-overlap"),Y=I.get("text-variable-anchor"),ee=I.get("text-rotation-alignment")==="map",K=I.get("text-pitch-alignment")==="map",se=z.get("symbol-z-offset"),pe=I.get("symbol-elevation-reference")==="sea",ve=!se.isConstant(),Ae=new Uc(null,0,j&&(Q||!t.hasIconData()||I.get("icon-optional")),Q&&(j||!t.hasTextData()||I.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const Se=(ge,Ce,Le)=>{for(let Qe=0;Qe<Ce/4;Qe++)ge.opacityVertexArray.emplaceBack(Le)};let Te=0;v&&t.updateReplacement(w,v);for(let ge=0;ge<t.symbolInstances.length;ge++){const Ce=t.symbolInstances.get(ge),{numHorizontalGlyphVertices:Le,numVerticalGlyphVertices:Qe,crossTileID:Ze,numIconVertices:ht,tileAnchorX:lt,tileAnchorY:Ct}=Ce;let $e=null;const et=this.retainedQueryData[t.bucketInstanceId];ve&&Ce&&et&&($e=u.latestFeatureIndex.loadFeature({featureIndex:Ce.featureIndex,bucketIndex:et.bucketIndex,sourceLayerIndex:et.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ge=se.evaluate($e,{}),pt=a.has(Ze);let tt=this.opacities[Ze];pt?tt=O:tt||(tt=Ae,this.opacities[Ze]=tt),a.add(Ze);const bt=Le>0||Qe>0,dt=ht>0,wt=this.placedOrientations[Ze],At=wt===r.bI.vertical,Qt=wt===r.bI.horizontal||wt===r.bI.horizontalOnly;!bt&&!dt||tt.isHidden()||Te++;let ai=!1;if((bt||dt)&&v)for(const Yt of t.activeReplacements){if(r.bP(Yt,g,r.bQ.Symbol,A)||Yt.min.x>lt||lt>Yt.max.x||Yt.min.y>Ct||Ct>Yt.max.y)continue;const ci=r.bR(lt,Ct,w.canonical,Yt.footprintTileId.canonical);if(ai=r.bS(ci,Yt.footprint),ai)break}if(bt){const Yt=ai?ss:Ql(tt.text);Se(t.text,Le,At?ss:Yt),Se(t.text,Qe,Qt?ss:Yt);const ci=tt.text.isHidden(),{leftJustifiedTextSymbolIndex:ii,centerJustifiedTextSymbolIndex:Mi,rightJustifiedTextSymbolIndex:Ni,verticalPlacedTextSymbolIndex:Ai}=Ce,Hi=t.text.placedSymbolArray,zi=ci||At?1:0;ii>=0&&(Hi.get(ii).hidden=zi),Mi>=0&&(Hi.get(Mi).hidden=zi),Ni>=0&&(Hi.get(Ni).hidden=zi),Ai>=0&&(Hi.get(Ai).hidden=ci||Qt?1:0);const wi=this.variableOffsets[Ze];wi&&this.markUsedJustification(t,wi.anchor,Ce,wt);const an=this.placedOrientations[Ze];an&&(this.markUsedJustification(t,"left",Ce,an),this.markUsedOrientation(t,an,Ce))}if(dt){const Yt=ai?ss:Ql(tt.icon),{placedIconSymbolIndex:ci,verticalPlacedIconSymbolIndex:ii}=Ce,Mi=t.icon.placedSymbolArray,Ni=tt.icon.isHidden()?1:0;ci>=0&&(Se(t.icon,ht,At?ss:Yt),Mi.get(ci).hidden=Ni),ii>=0&&(Se(t.icon,Ce.numVerticalIconVertices,Qt?ss:Yt),Mi.get(ii).hidden=Ni)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Yt=t.collisionArrays[ge];if(Yt){let ci=new r.P(0,0),ii=!0;if(Yt.textBox||Yt.verticalTextBox){if(Y){const Ni=this.variableOffsets[Ze];Ni?(ci=ao(Ni.anchor,Ni.width,Ni.height,Ni.textOffset,Ni.textScale),ee&&ci._rotate(K?this.transform.angle:-this.transform.angle)):ii=!1}k&&(ii=!tt.clipped),Yt.textBox&&Vc(t.textCollisionBox.collisionVertexArray,tt.text.placed,!ii||At,Ge,pe,ci.x,ci.y),Yt.verticalTextBox&&Vc(t.textCollisionBox.collisionVertexArray,tt.text.placed,!ii||Qt,Ge,pe,ci.x,ci.y)}const Mi=ii&&!!(!Qt&&Yt.verticalIconBox);Yt.iconBox&&Vc(t.iconCollisionBox.collisionVertexArray,tt.icon.placed,Mi,Ge,pe,Ce.hasIconTextFit?ci.x:0,Ce.hasIconTextFit?ci.y:0),Yt.verticalIconBox&&Vc(t.iconCollisionBox.collisionVertexArray,tt.icon.placed,!Mi,Ge,pe,Ce.hasIconTextFit?ci.x:0,Ce.hasIconTextFit?ci.y:0)}}}if(t.fullyClipped=Te===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ge=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ge.invProjMatrix,t.placementViewportMatrix=ge.viewportMatrix,t.collisionCircleArray=ge.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const u=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function Vc(c,t,a,u,p,g,v){c.emplaceBack(t?1:0,a?1:0,g||0,v||0,u,p?1:0),c.emplaceBack(t?1:0,a?1:0,g||0,v||0,u,p?1:0),c.emplaceBack(t?1:0,a?1:0,g||0,v||0,u,p?1:0),c.emplaceBack(t?1:0,a?1:0,g||0,v||0,u,p?1:0)}const Gh=Math.pow(2,25),Hh=Math.pow(2,24),Ha=Math.pow(2,17),ia=Math.pow(2,16),i_=Math.pow(2,9),qh=Math.pow(2,8),lp=Math.pow(2,1);function Ql(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const t=c.placed?1:0,a=Math.floor(127*c.opacity);return a*Gh+t*Hh+a*Ha+t*ia+a*i_+t*qh+a*lp+t}const ss=0;class nf{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,a,u,p,g,v){const w=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(w,p,t[this._currentTileIndex],this._sortAcrossTiles,v),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((A,I)=>A.sortKey-I.sortKey));this._currentPartIndex<w.length;){const A=w[this._currentPartIndex];if(a.placeLayerBucketPart(A,this._seenCrossTileIDs,u,A.symbolInstanceStart===0,v),this._currentPartIndex++,g())return!0}return!1}}class La{constructor(t,a,u,p,g,v,w,A,I){this.placement=new On(t,g,v,w,A,I),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,a,u,p,g){const v=r.q.now(),w=()=>{const A=r.q.now()-v;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=a[t[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=I)&&(!A.maxzoom||A.maxzoom>I)){const z=A,k=z.layout.get("symbol-z-elevate"),O=z.layout.get("symbol-sort-key").constantOr(1)!==void 0,j=z.layout.get("symbol-z-order"),Q=j==="viewport-y"||j==="auto"&&!(j!=="viewport-y"&&O),Y=z.layout.get("text-allow-overlap")||z.layout.get("icon-allow-overlap")||z.layout.get("text-ignore-placement")||z.layout.get("icon-ignore-placement"),ee=Q&&Y,K=this._inProgressLayer=this._inProgressLayer||new nf(z),se=r.C(A.source,A.scope);if(K.continuePlacement(k||ee?p[se]:u[se],this.placement,this._showCollisionBoxes,A,w,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ls=512/r.aj/2;class qa{constructor(t,a,u){this.tileID=t,this.bucketInstanceId=u,this.index=new r.bW(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const p=t.canonical.x*r.aj,g=t.canonical.y*r.aj;for(let v=0;v<a.length;v++){const{key:w,crossTileID:A,tileAnchorX:I,tileAnchorY:z}=a.get(v),k=Math.floor((p+I)*ls),O=Math.floor((g+z)*ls);this.index.add(k,O),this.keys.push(w),this.crossTileIDs.push(A)}this.index.finish()}findMatches(t,a,u){const p=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),g=ls/Math.pow(2,a.canonical.z-this.tileID.canonical.z),v=a.canonical.x*r.aj,w=a.canonical.y*r.aj;for(let A=0;A<t.length;A++){const I=t.get(A);if(I.crossTileID)continue;const{key:z,tileAnchorX:k,tileAnchorY:O}=I,j=Math.floor((v+k)*g),Q=Math.floor((w+O)*g),Y=this.index.range(j-p,Q-p,j+p,Q+p).sort((ee,K)=>ee-K);for(const ee of Y){const K=this.crossTileIDs[ee];if(this.keys[ee]===z&&!u.has(K)){u.add(K),I.crossTileID=K;break}}}}}class cp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Gc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const u in this.indexes){const p=this.indexes[u],g={};for(const v in p){const w=p[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+a),g[w.tileID.key]=w}this.indexes[u]=g}this.lng=t}addBucket(t,a,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<a.symbolInstances.length;g++)a.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const p=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const v=this.indexes[g];if(Number(g)>t.overscaledZ)for(const w in v){const A=v[w];A.tileID.isChildOf(t)&&A.findMatches(a.symbolInstances,t,p)}else{const w=v[t.scaledTo(Number(g)).key];w&&w.findMatches(a.symbolInstances,t,p)}}for(let g=0;g<a.symbolInstances.length;g++){const v=a.symbolInstances.get(g);v.crossTileID||(v.crossTileID=u.generate(),p.add(v.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new qa(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const u of a.crossTileIDs)this.usedCrossTileIDs[t].delete(u)}removeStaleBuckets(t){let a=!1;for(const u in this.indexes){const p=this.indexes[u];for(const g in p)t[p[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[g]),delete p[g],a=!0)}return a}}class Br{constructor(){this.layerIndexes={},this.crossTileIDs=new cp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,u,p){let g=this.layerIndexes[t.fqid];g===void 0&&(g=this.layerIndexes[t.fqid]=new Gc);let v=!1;const w={};p.name!=="globe"&&g.handleWrapJump(u);for(const A of a){const I=A.getBucket(t);I&&t.fqid===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(A.tileID,I,this.crossTileIDs)&&(v=!0),w[I.bucketInstanceId]=!0)}return g.removeStaleBuckets(w)&&(v=!0),v}pruneUnusedLayers(t){const a={};t.forEach(u=>{a[u]=!0});for(const u in this.layerIndexes)a[u]||delete this.layerIndexes[u]}}const $a=771;class Zi{constructor(t,a,u,p){this.blendFunction=t,this.blendColor=a,this.mask=u,this.blendEquation=p}}Zi.Replace=[1,0,1,0],Zi.disabled=new Zi(Zi.Replace,r.am.transparent,[!1,!1,!1,!1]),Zi.unblended=new Zi(Zi.Replace,r.am.transparent,[!0,!0,!0,!0]),Zi.alphaBlended=new Zi([1,$a,1,$a],r.am.transparent,[!0,!0,!0,!0]),Zi.alphaBlendedNonPremultiplied=new Zi([770,$a,770,$a],r.am.transparent,[!0,!0,!0,!0]),Zi.multiply=new Zi([774,0,774,0],r.am.transparent,[!0,!0,!0,!0]);class ei{constructor(t,a,u){this.func=t,this.mask=a,this.range=u}}ei.ReadOnly=!1,ei.ReadWrite=!0,ei.disabled=new ei(519,ei.ReadOnly,[0,1]);const qu=7680;class Di{constructor(t,a,u,p,g,v){this.test=t,this.ref=a,this.mask=u,this.fail=p,this.depthFail=g,this.pass=v}}Di.disabled=new Di({func:519,mask:0},0,0,qu,qu,qu);const Ds=1029,il=2305;class Li{constructor(t,a,u){this.enable=t,this.mode=a,this.frontFace=u}}function $h(c,t){const a=r.c1(c,3);r.c3(c,t),r.c7(c,3,a)}function cs(c,t){const a=r.bY([]);return r.bZ(a,a,-t),r.b_(a,a,-c),a}function up(c,t){const a=[c[0],c[1],0],u=[t[0],t[1],0];if(r.ae(a)>=1e-15){const v=r.au([],a);r.b$(u,v,r.bE(u,v)),t[0]=u[0],t[1]=u[1]}const p=r.bG([],t,c);if(r.c0(p)<1e-15)return null;const g=Math.atan2(-p[1],p[0]);return cs(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),g)}Li.disabled=new Li(!1,Ds,il),Li.backCCW=new Li(!0,Ds,il),Li.backCW=new Li(!0,Ds,2304),Li.frontCW=new Li(!0,1028,2304),Li.frontCCW=new Li(!0,1028,il);class $u{constructor(t,a){this.position=t,this.orientation=a}get position(){return this._position}set position(t){if(t){const a=t instanceof r.ac?t:new r.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(a.x=r.bX(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(t,a){if(this.orientation=null,!this.position)return;const u=this.position,p=this._elevation?this._elevation.getAtPointOrZero(r.ac.fromLngLat(t)):0,g=r.ac.fromLngLat(t,p),v=[g.x-u.x,g.y-u.y,g.z-u.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=up(v,a)}setPitchBearing(t,a){this.orientation=cs(r.al(t),r.al(-a))}}class va{constructor(t,a){this._transform=r.bx([]),this.orientation=a,this.position=t}get mercatorPosition(){const t=this.position;return new r.ac(t[0],t[1],t[2])}get position(){const t=r.c1(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var a;t&&r.c7(this._transform,3,[(a=t)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||r.bY([]),t&&$h(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,a){this._orientation=cs(t,a),$h(this._transform,this._orientation)}forward(){const t=r.c1(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=r.c1(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=r.c1(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,a){const u=new Float64Array(16);return r.bi(u,this.getWorldToCamera(t,a)),u}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,a,u){const p=this.position;r.b$(p,p,-t);const g=new Float64Array(16);return r.bn(g,[u,u,u]),r.bo(g,g,p),g[10]*=a,g}getWorldToCamera(t,a){const u=new Float64Array(16),p=new Float64Array(4),g=this.position;return r.c2(p,this._orientation),r.b$(g,g,-t),r.c3(u,p),r.bo(u,u,g),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=a,u[9]*=a,u[10]*=a,u[11]*=a,u}getCameraToClipPerspective(t,a,u,p){const g=new Float64Array(16);return r.c4(g,t,a,u,p),g}getCameraToClipOrthographic(t,a,u,p,g,v){const w=new Float64Array(16);return r.c5(w,t,a,u,p,g,v),w}getDistanceToElevation(t,a=!1){const u=t===0?0:r.c6(t,a?r.aY(this.position[1]):this.position[1]),p=this.forward();return(u-this.position[2])/p[2]}clone(){return new va([...this.position],[...this.orientation])}}const Oa={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Hc{constructor(t=0,a=0,u=0,p=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=u,this.right=p}interpolate(t,a,u){return a.top!=null&&t.top!=null&&(this.top=r.ai(t.top,a.top,u)),a.bottom!=null&&t.bottom!=null&&(this.bottom=r.ai(t.bottom,a.bottom,u)),a.left!=null&&t.left!=null&&(this.left=r.ai(t.left,a.left,u)),a.right!=null&&t.right!=null&&(this.right=r.ai(t.right,a.right,u)),this}getCenter(t,a){const u=r.aD((this.left+t-this.right)/2,0,t),p=r.aD((this.top+a-this.bottom)/2,0,a);return new r.P(u,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Hc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const yl=15;class qc{constructor(t,a,u,p,g,v,w){this.tileSize=512,this._renderWorldCopies=g===void 0||g,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=u??0,this._maxPitch=p??60,this.setProjection(v),this.setMaxBounds(w),this.width=0,this.height=0,this._center=new r.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Hc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new va,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new qc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<yl}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,a=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(t||u)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return r.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=r.ce(this.projectionOptions);const u=this.getProjection(),p=!r.bv(a,u);return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.ce({name:"mercator"});const a=t!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bX(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const a=-t*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=r.cf(),r.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=r.aD(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=r.al(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&u.exaggeration()&&this._centerAltitudeValidForExaggeration!==u.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*u.exaggeration(),this._centerAltitudeValidForExaggeration=u.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=u.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let p=0,g=0;for(let v=0;v<a.length;v++){const w=new r.P(a[v][0]*this.width,u+a[v][1]*(this.height-u)),A=t.pointCoordinate(w);if(!A)continue;const I=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);p+=A[3]*I,g+=I}return g===0?NaN:p/g}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*a,p=this._mercatorZfromZoom(t),g=this._mercatorZfromZoom(this._maxZoom),v=Math.max(p-u,g);this._setZoom(this._zoomFromMercatorZ(v))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let u;u=t.z<this._camera.position[2]?[a.x,a.y,a.z]:[t.x,t.y,t.z];const p=r.ae(r.at([],this._camera.position,u));return r.aD(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let a=!1;if(t.orientation&&!r.ch(t.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(t.orientation)),t.position){const u=[t.position.x,t.position.y,t.position.z];r.ci(u,this._camera.position)||(this._setCameraPosition(u),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,a=new $u;return a.position=new r.ac(t[0],t[1],t[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(t){if(!r.cj(t))return!1;r.ck(t,t);const a=r.cl([],[0,0,-1],t),u=r.cl([],[0,-1,0],t);if(u[2]<0)return!1;const p=up(a,u);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(t){const a=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;t[2]=r.aD(t[2],p/u,p/a),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,u){this._unmodified=!1,this._edgeInsets.interpolate(t,a,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new r.cm(0,t)];if(this.renderWorldCopies){const u=this.pointCoordinate(new r.P(0,0)),p=this.pointCoordinate(new r.P(this.width,0)),g=this.pointCoordinate(new r.P(this.width,this.height)),v=this.pointCoordinate(new r.P(0,this.height)),w=Math.floor(Math.min(u.x,p.x,g.x,v.x)),A=Math.floor(Math.max(u.x,p.x,g.x,v.x)),I=1;for(let z=w-I;z<=A+I;z++)z!==0&&a.push(new r.cm(z,t))}return a}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,a,u){let p=[];const g=u!=null,v=!g;if(v&&this.zoom<a||g&&u[0]===0&&u[1]===0)return p;const w=new Set,A=(z,k,O,j,Q)=>{const Y=r.cK(k,z,O,j,Q);w.has(Y)||(p.push(new r.aM(z,k,O,j,Q)),w.add(Y))};for(let z=0;z<t.length;z++){const k=t[z];if(v&&k.canonical.z!==a)continue;const O=k.canonical,j=k.overscaledZ,Q=k.wrap,Y=1<<O.z,ee=O.x+1<Y,K=O.x>0,se=O.y+1<Y,pe=O.y>0,ve=k.wrap-(K?0:1),Ae=k.wrap+(ee?0:1),Se=K?O.x-1:Y-1,Te=ee?O.x+1:0;if(g)u[0]<0?(A(j,Ae,O.z,Te,O.y),u[1]<0&&se&&(A(j,Q,O.z,O.x,O.y+1),A(j,Ae,O.z,Te,O.y+1)),u[1]>0&&pe&&(A(j,Q,O.z,O.x,O.y-1),A(j,Ae,O.z,Te,O.y-1))):u[0]>0?(A(j,ve,O.z,Se,O.y),u[1]<0&&se&&(A(j,Q,O.z,O.x,O.y+1),A(j,ve,O.z,Se,O.y+1)),u[1]>0&&pe&&(A(j,Q,O.z,O.x,O.y-1),A(j,ve,O.z,Se,O.y-1))):u[1]<0&&se?A(j,Q,O.z,O.x,O.y+1):pe&&A(j,Q,O.z,O.x,O.y-1);else{const ge=k.visibleQuadrants;1&ge&&(A(j,ve,O.z,Se,O.y),pe&&(A(j,Q,O.z,O.x,O.y-1),A(j,ve,O.z,Se,O.y-1))),2&ge&&(A(j,Ae,O.z,Te,O.y),pe&&(A(j,Q,O.z,O.x,O.y-1),A(j,Ae,O.z,Te,O.y-1))),4&ge&&(A(j,ve,O.z,Se,O.y),se&&(A(j,Q,O.z,O.x,O.y+1),A(j,ve,O.z,Se,O.y+1))),8&ge&&(A(j,Ae,O.z,Te,O.y),se&&(A(j,Q,O.z,O.x,O.y+1),A(j,Ae,O.z,Te,O.y+1)))}}const I=[];for(const z of p)p.some(k=>z.isChildOf(k))||I.push(z);if(p=I.filter(z=>!t.some(k=>!!(z.overscaledZ<a&&k.isChildOf(z))||z.equals(k)||z.isChildOf(k))),v){const z=1<<a,k=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),O=[z*k.x,z*k.y],j=4,Q=j*j;p=p.filter(Y=>{const ee=Y.canonical.x+.5-O[0],K=Y.canonical.y+.5-O[1];return ee*ee+K*K<Q})}return p}coveringTiles(t){let a=this.coveringZoomLevel(t);const u=a,p=this.elevation&&this.elevation.exaggeration(),g=p&&!t.isTerrainDEM,v=this.projection.name==="mercator";if(t.minzoom!==void 0&&a<t.minzoom)return[];t.maxzoom!==void 0&&a>t.maxzoom&&(a=t.maxzoom);const w=this.locationCoordinate(this.center),A=this.center.lat,I=1<<a,z=[I*w.x,I*w.y,0],k=this.projection.name==="globe",O=!k,j=r.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,O),Q=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Y=I*r.c6(1,this.center.lat),ee=this._camera.position[2]/r.c6(1,this.center.lat),K=[I*Q.x,I*Q.y,ee*(O?1:Y)],se=k||p,pe=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ve=this.isLODDisabled(!0)?a:0;let Ae;if(this._elevation&&t.isTerrainDEM)Ae=1e4*this._elevation.exaggeration();else if(this._elevation){const Ge=this._elevation.getMinMaxForVisibleTiles();Ae=Ge?Ge.max:this._centerAltitude}else Ae=this._centerAltitude;const Se=t.isTerrainDEM?-Ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,Te=this.projection.isReprojectedInTileSpace?r.co(this):1,ge=Ge=>{const tt=new r.ac(Ge.x+25e-6,Ge.y,Ge.z),bt=new r.ac(Ge.x,Ge.y+25e-6,Ge.z),dt=Ge.toLngLat(),wt=tt.toLngLat(),At=bt.toLngLat(),Qt=this.locationCoordinate(dt),ai=this.locationCoordinate(wt),Yt=this.locationCoordinate(At),ci=Math.hypot(ai.x-Qt.x,ai.y-Qt.y),ii=Math.hypot(Yt.x-Qt.x,Yt.y-Qt.y);return Math.sqrt(ci*ii)*Te/25e-6},Ce=Ge=>{const pt=Ae,tt=Se;return{aabb:r.cr(this,I,0,0,0,Ge,tt,pt,this.projection),zoom:0,x:0,y:0,minZ:tt,maxZ:pt,wrap:Ge,fullyVisible:!1}},Le=[];let Qe=[];const Ze=a,ht=t.reparseOverscaled?u:a,lt=(ee-this._centerAltitude)*Y,Ct=Ge=>{if(!this._elevation||!Ge.tileID||!v)return;const pt=this._elevation.getMinMaxForTile(Ge.tileID),tt=Ge.aabb;pt?(tt.min[2]=pt.min,tt.max[2]=pt.max,tt.center[2]=(tt.min[2]+tt.max[2])/2):(Ge.shouldSplit=et(Ge),Ge.shouldSplit||(tt.min[2]=tt.max[2]=tt.center[2]=this._centerAltitude))},$e=(Ge,pt)=>{if(.707*pt<Ge)return 1;const tt=pt/Ge;return tt/(1.4144271570014144+(Math.pow(1.1,tt-1.4144271570014144+1)-1)/(1.1-1)-1)},et=Ge=>{if(Ge.zoom<ve)return!0;if(Ge.zoom===Ze)return!1;if(Ge.shouldSplit!=null)return Ge.shouldSplit;const pt=Ge.aabb.distanceX(K),tt=Ge.aabb.distanceY(K);let bt=lt,dt=1;if(k){bt=Ge.aabb.distanceZ(K);const ii=Math.pow(2,Ge.zoom),Mi=r.aY((Ge.y+1)/ii),Ni=r.aY(Ge.y/ii),Ai=Math.min(Math.max(A,Mi),Ni),Hi=r.cP(Ai)/r.cP(A);if(dt=Ai===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Hi/this._mercatorScaleRatio),this.zoom<=r.cL&&Ge.zoom===Ze-1&&Hi>=.9)return!0}else if(g&&(bt=Ge.aabb.distanceZ(K)*Y),this.projection.isReprojectedInTileSpace&&u<=5){const ii=Math.pow(2,Ge.zoom),Mi=ge(new r.ac((Ge.x+.5)/ii,(Ge.y+.5)/ii));dt=Mi>.85?1:Mi}if(!v){const ii=Math.sqrt(pt*pt+tt*tt+bt*bt);let Mi=(1<<Ze-Ge.zoom)*pe*dt;return Mi*=$e(Math.max(bt,lt),ii),ii<Mi}let wt=Number.MAX_VALUE,At=0;const Qt=Ge.aabb.getCorners(),ai=[];for(const ii of Qt){r.at(ai,ii,K),k||(g?ai[2]*=Y:ai[2]=lt);const Mi=r.bE(ai,this._camera.forward());Mi<wt&&(wt=Mi,At=Math.abs(ai[2]))}let Yt=(1<<Ze-Ge.zoom)*pe*dt;if(Yt*=$e(Math.max(At,lt),wt),wt<Yt)return!0;const ci=Ge.aabb.closestPoint(z);return ci[0]===z[0]&&ci[1]===z[1]};if(this.renderWorldCopies)for(let Ge=1;Ge<=3;Ge++)Le.push(Ce(-Ge)),Le.push(Ce(Ge));for(Le.push(Ce(0));Le.length>0;){const Ge=Le.pop(),pt=Ge.x,tt=Ge.y;let bt=Ge.fullyVisible;const dt=()=>this.projection.name==="globe"&&(Ge.y===0||Ge.y===(1<<Ge.zoom)-1);if(!bt){let wt=se?Ge.aabb.intersects(j):Ge.aabb.intersectsFlat(j);if(wt===0&&dt()){const At=new r.cp(Ge.zoom,pt,tt);wt=r.cq(this,I,At,!0).intersects(j)}if(wt===0)continue;bt=wt===2}if(Ge.zoom!==Ze&&et(Ge))for(let wt=0;wt<4;wt++){const At=(pt<<1)+wt%2,Qt=(tt<<1)+(wt>>1),ai={aabb:v?Ge.aabb.quadrant(wt):r.cr(this,I,Ge.zoom+1,At,Qt,Ge.wrap,Ge.minZ,Ge.maxZ,this.projection),zoom:Ge.zoom+1,x:At,y:Qt,wrap:Ge.wrap,fullyVisible:bt,tileID:void 0,shouldSplit:void 0,minZ:Ge.minZ,maxZ:Ge.maxZ};g&&!k&&(ai.tileID=new r.aM(Ge.zoom+1===Ze?ht:Ge.zoom+1,Ge.wrap,Ge.zoom+1,At,Qt),Ct(ai)),Le.push(ai)}else{const wt=Ge.zoom===Ze?ht:Ge.zoom;if(t.minzoom&&t.minzoom>wt)continue;let At=0;if(!bt){let ci=se?Ge.aabb.intersectsPrecise(j):Ge.aabb.intersectsPreciseFlat(j);if(ci===0&&dt()){const ii=new r.cp(Ge.zoom,pt,tt);ci=r.cq(this,I,ii,!0).intersectsPrecise(j)}if(ci===0)continue;if(t.calculateQuadrantVisibility)if(j.containsPoint(Ge.aabb.center))At=15;else for(let ii=0;ii<4;ii++)Ge.aabb.quadrant(ii).intersects(j)!==0&&(At|=1<<ii)}const Qt=z[0]-(.5+pt+(Ge.wrap<<Ge.zoom))*(1<<a-Ge.zoom),ai=z[1]-.5-tt,Yt=Ge.tileID?Ge.tileID:new r.aM(wt,Ge.wrap,Ge.zoom,pt,tt);t.calculateQuadrantVisibility&&(Yt.visibleQuadrants=At),Qe.push({tileID:Yt,distanceSq:Qt*Qt+ai*ai})}}if(this.fogCullDistSq){const Ge=this.fogCullDistSq,pt=this.horizonLineFromTop();Qe=Qe.filter(tt=>{const bt=[0,0,0,1],dt=[r.aj,r.aj,0,1],wt=this.calculateFogTileMatrix(tt.tileID.toUnwrapped());r.aA(bt,bt,wt),r.aA(dt,dt,wt);const At=r.cs([],bt,dt),Qt=r.ct([],bt,dt),ai=r.cM(At,Qt);if(ai===0)return!0;let Yt=!1;const ci=this._elevation;if(ci&&ai>Ge&&pt!==0){const ii=this.calculateProjMatrix(tt.tileID.toUnwrapped());let Mi;t.isTerrainDEM||(Mi=ci.getMinMaxForTile(tt.tileID)),Mi||(Mi={min:Se,max:Ae});const Ni=r.cu(this.rotation),Ai=[Ni[0]*r.aj,Ni[1]*r.aj,Mi.max];r.ad(Ai,Ai,ii),Yt=(1-Ai[1])*this.height*.5<pt}return ai<Ge||Yt})}return Qe.sort((Ge,pt)=>Ge.distanceSq-pt.distanceSq).map(Ge=>Ge.tileID)}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const a=r.aD(t.lat,-r.cv,r.cv),u=this.projection.project(t.lng,a);return new r.P(u.x*this.worldSize,u.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,a){let u,p;const g=this.centerPoint;if(this.projection.name==="globe"){const w=this.worldSize;u=(a.x-g.x)/w,p=(a.y-g.y)/w}else{const w=this.pointCoordinate(a),A=this.pointCoordinate(g);u=w.x-A.x,p=w.y-A.y}const v=this.locationCoordinate(t);this.setLocation(new r.ac(v.x-u,v.y-p))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,a){return this.projection.locationPoint(this,t,a)}locationPoint3D(t,a){return this.projection.locationPoint(this,t,a,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,a){return this.coordinateLocation(this.pointCoordinate3D(t,a))}locationCoordinate(t,a){const u=a?r.c6(a,t.lat):void 0,p=this.projection.project(t.lng,t.lat);return new r.ac(p.x,p.y,u)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,a){const u=a??this._centerAltitude,p=[t.x,t.y,0,1],g=[t.x,t.y,1,1];r.aA(p,p,this.pixelMatrixInverse),r.aA(g,g,this.pixelMatrixInverse);const v=g[3];r.cw(p,p,1/p[3]),r.cw(g,g,1/v);const w=p[2],A=g[2];return{p0:p,p1:g,t:w===A?0:(u-w)/(A-w)}}screenPointToMercatorRay(t){const a=[t.x,t.y,0,1],u=[t.x,t.y,1,1];return r.aA(a,a,this.pixelMatrixInverse),r.aA(u,u,this.pixelMatrixInverse),r.cw(a,a,1/a[3]),r.cw(u,u,1/u[3]),a[2]=r.c6(a[2],this._center.lat)*this.worldSize,u[2]=r.c6(u[2],this._center.lat)*this.worldSize,r.cw(a,a,1/this.worldSize),r.cw(u,u,1/this.worldSize),new r.av([a[0],a[1],a[2]],r.au([],r.at([],u,a)))}rayIntersectionCoordinate(t){const{p0:a,p1:u,t:p}=t,g=r.c6(a[2],this._center.lat),v=r.c6(u[2],this._center.lat);return new r.ac(r.ai(a[0],u[0],p)/this.worldSize,r.ai(a[1],u[1],p)/this.worldSize,r.ai(g,v,p))}pointCoordinate(t,a=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,a)}pointCoordinate3D(t,a){if(!this.elevation)return this.pointCoordinate(t,a);let u=this.projection.pointCoordinate3D(this,t.x,t.y);if(u)return new r.ac(u[0],u[1],u[2]);let p=0,g=this.horizonLineFromTop();if(t.y>g)return this.pointCoordinate(t,a);const v=.02*g,w=t.clone();for(let A=0;A<10&&g-p>v;A++){w.y=r.ai(p,g,.66);const I=this.projection.pointCoordinate3D(this,w.x,w.y);I?(g=w.y,u=I):p=w.y}return u?new r.ac(u[0],u[1],u[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=r.cx)return!this.isPointAboveHorizon(t);const a=this.pointCoordinate(t);return a.y>=0&&a.y<=1}_coordinatePoint(t,a){const u=a&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,p=[t.x*this.worldSize,t.y*this.worldSize,u+t.toAltitude(),1];return r.aA(p,p,this.pixelMatrix),p[3]>0?new r.P(p[0]/p[3],p[1]/p[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:a}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,p=this.width-this._edgeInsets.right,g=this.pointLocation3D(new r.P(a,t)),v=this.pointLocation3D(new r.P(p,t)),w=this.pointLocation3D(new r.P(p,u)),A=this.pointLocation3D(new r.P(a,u));let I=Math.min(g.lng,v.lng,w.lng,A.lng),z=Math.max(g.lng,v.lng,w.lng,A.lng),k=Math.min(g.lat,v.lat,w.lat,A.lat),O=Math.max(g.lat,v.lat,w.lat,A.lat);const j=Math.pow(2,-this.zoom)/16*270,Q=this.projection.name==="globe"?1:4,Y=(ee,K,se,pe,ve)=>{const Ae=(ee+se)/2,Se=(K+pe)/2,Te=new r.P(Ae,Se),{lng:ge,lat:Ce}=this.pointLocation3D(Te),Le=Math.max(0,I-ge,k-Ce,ge-z,Ce-O);I=Math.min(I,ge),z=Math.max(z,ge),k=Math.min(k,Ce),O=Math.max(O,Ce),(ve<Q||Le>j)&&(Y(ee,K,Ae,Se,ve+1),Y(Ae,Se,se,pe,ve+1))};if(Y(a,t,p,t,1),Y(p,t,p,u,1),Y(p,u,a,u,1),Y(a,u,a,t,1),this.projection.name==="globe"){const[ee,K]=r.cy(this);ee?(O=90,z=180,I=-180):K&&(k=-90,z=180,I=-180)}return new r.aG(new r.cd(I,k),new r.cd(z,O))}_getBoundsRectangular(t,a){const{top:u,left:p}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,w=new r.P(p,u),A=new r.P(v,u),I=new r.P(v,g),z=new r.P(p,g);let k=this.pointCoordinate(w,t),O=this.pointCoordinate(A,t);const j=this.pointCoordinate(I,a),Q=this.pointCoordinate(z,a),Y=(ee,K)=>(K.y-ee.y)/(K.x-ee.x);return k.y>1&&O.y>=0?k=new r.ac((1-Q.y)/Y(Q,k)+Q.x,1):k.y<0&&O.y<=1&&(k=new r.ac(-Q.y/Y(Q,k)+Q.x,0)),O.y>1&&k.y>=0?O=new r.ac((1-j.y)/Y(j,O)+j.x,1):O.y<0&&k.y<=1&&(O=new r.ac(-j.y/Y(j,O)+j.x,0)),new r.aG().extend(this.coordinateLocation(k)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(j))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=t.visibleDemTiles.reduce((u,p)=>{if(p.dem){const g=p.dem.tree;u.min=Math.min(u.min,g.minimums[0]),u.max=Math.max(u.max,g.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*t.exaggeration(),a.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,u=this.height/2-a*(1-this._horizonShift);return t?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-r.cv,this.maxLat=r.cv,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.ay(this.minLng)*this.tileSize,this.worldMaxX=r.ay(this.maxLng)*this.tileSize,this.worldMinY=r.aH(this.maxLat)*this.tileSize,this.worldMaxY=r.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,a){return this.projection.createTileMatrix(this,a,t)}calculateDistanceTileData(t){const a=t.key,u=this._distanceTileDataCache;if(u[a])return u[a];const p=t.canonical,g=1/this.height,v=this.cameraWorldSize,w=v/this.zoomScale(p.z),A=(p.x+Math.pow(2,p.z)*t.wrap)*w,I=p.y*w,z=this.point;z.x*=v/this.worldSize,z.y*=v/this.worldSize;const k=this.angle,O=Math.sin(-k),j=-Math.cos(-k);return u[a]={bearing:[O,j],center:[(z.x-A)*g,(z.y-I)*g],scale:w/r.aj*g},u[a]}calculateFogTileMatrix(t){const a=t.key,u=this._fogTileMatrixCache;if(u[a])return u[a];const p=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return r.az(p,this.worldToFogMatrix,p),u[a]=new Float32Array(p),u[a]}calculateProjMatrix(t,a=!1,u=!1){const p=t.key;let g;if(g=u?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,g[p])return g[p];const v=this.calculatePosMatrix(t,this.worldSize);let w;return w=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,r.az(v,w,v),g[p]=new Float32Array(v),g[p]}calculatePixelsToTileUnitsMatrix(t){const a=t.tileID.key,u=this._pixelsToTileUnitsCache;if(u[a])return u[a];const p=r.cz(t,this);return u[a]=p,u[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,a=r.bn([],[t,t,t]);return r.az(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const a=r.c6(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(a),p=this._camera.forward(),g=r.c6(1,this._center.lat);u[2]/=g,p[2]/=g,r.au(p,p);const v=t.raycast(u,p,t.exaggeration());if(v){const w=r.bF([],u,p,v),A=new r.ac(w[0],w[1],r.c6(w[2],r.aY(w[1]))),I=(A.z+r.ae([A.x-u[0],A.y-u[1],A.z-u[2]*g]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(I),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const a=this._elevation,u=r.c6(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(u),g=a.getAtPointOrZero(new r.ac(...p)),v=this.pixelsPerMeter/this.worldSize*g,w=this._minimumHeightOverTerrain(),A=p[2]-v;if(A<=w)if(A<0||t){const I=this.locationCoordinate(this._center,this._centerAltitude),z=[p[0],p[1],I.z-p[2]],k=r.ae(z);z[2]-=(w-A)/this._pixelsPerMercatorPixel;const O=r.ae(z);if(O===0)return;r.b$(z,z,k/O*this._pixelsPerMercatorPixel),this._camera.position=[p[0],p[1],I.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const O=this.center;return O.lat=r.aD(O.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(O.lng=r.aD(O.lng,this.minLng,this.maxLng)),this.center=O,void(this._constraining=!1)}const a=this._unmodified,{x:u,y:p}=this.point;let g=0,v=u,w=p;const A=this.width/2,I=this.height/2,z=this.worldMinY*this.scale,k=this.worldMaxY*this.scale;if(p-I<z&&(w=z+I),p+I>k&&(w=k-I),k-z<this.height&&(g=Math.max(g,this.height/(k-z)),w=(k+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const O=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,Q=this.worldSize/2-(O+j)/2;v=(u+Q+this.worldSize)%this.worldSize-Q,v-A<O&&(v=O+A),v+A>j&&(v=j-A),j-O<this.width&&(g=Math.max(g,this.width/(j-O)),v=(j+O)/2)}v===u&&w===p||this._allowWorldUnderZoom||(this.center=this.unproject(new r.P(v,w))),g&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(g)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,a=this.projection.name==="globe",u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.c6(1,this.center.lat)/r.c6(1,r.cN));const p=r.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const g=this.projection.zAxisUnit==="meters"?u:1,v=this._camera.getWorldToCamera(this.worldSize,g);let w;const A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(A[8]=2*-t.x/this.width,A[9]=2*t.y/this.height,this.isOrthographic){let Ce=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Le=Ce*this.aspect,Qe=-Le,Ze=-Ce;Le-=t.x,Qe-=t.x,Ce+=t.y,Ze+=t.y,w=this._camera.getCameraToClipOrthographic(Qe,Le,Ze,Ce,this._nearZ,this._farZ),((ht,lt,Ct,$e)=>{for(let et=0;et<16;et++)ht[et]=r.ai(lt[et],Ct[et],$e)})(w,w,A,r.cO(this.pitch>=yl?1:this.pitch/yl))}else w=A;const I=r.cB([],A,v);let z=r.cB([],w,v);if(this.projection.isReprojectedInTileSpace){const Ce=this.locationCoordinate(this.center),Le=r.bx([]);r.bo(Le,Le,[Ce.x*this.worldSize,Ce.y*this.worldSize,0]),r.az(Le,Le,r.cC(this)),r.bo(Le,Le,[-Ce.x*this.worldSize,-Ce.y*this.worldSize,0]),r.az(z,z,Le),r.az(I,I,Le),this.inverseAdjustmentMatrix=r.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.cE([],z,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=z,this.invProjMatrix=r.bi(new Float64Array(16),this.projMatrix),a){const Ce=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ce[8]=2*-t.x/this.width,Ce[9]=2*t.y/this.height,this.expandedFarZProjMatrix=r.cB([],Ce,v)}else this.expandedFarZProjMatrix=this.projMatrix;const k=r.bi([],w);this.frustumCorners=r.cF.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const O=new Float32Array(16);r.bx(O),r.cE(O,O,[1,-1,1]),r.cG(O,O,this._pitch),r.by(O,O,this.angle);const j=r.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.bw(j);const Q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;j[8]=2*-t.x/this.width,j[9]=2*(t.y+Q)/this.height,this.skyboxMatrix=r.az(O,j,O);const Y=this.point,ee=Y.x,K=Y.y,se=this.width%2/2,pe=this.height%2/2,ve=Math.cos(this.angle),Ae=Math.sin(this.angle),Se=ee-Math.round(ee)+ve*se+Ae*pe,Te=K-Math.round(K)+ve*pe+Ae*se,ge=new Float64Array(z);if(r.bo(ge,ge,[Se>.5?Se-1:Se,Te>.5?Te-1:Te,0]),this.alignedProjMatrix=ge,z=r.bz(),r.cE(z,z,[this.width/2,-this.height/2,1]),r.bo(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=r.bz(),r.cE(z,z,[1,-1,1]),r.bo(z,z,[-1,-1,0]),r.cE(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=r.az(new Float64Array(16),this.labelPlaneMatrix,I),this._calcFogMatrices(),this._distanceTileDataCache={},z=r.bi(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.cH(this);const Ce=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.ad(Ce,Ce,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,u=this._camera.position,p=1/this.height/this._pixelsPerMercatorPixel,g=[t,t,a];r.b$(g,g,p),r.b$(u,u,-1),r.cI(u,u,g);const v=r.bz();r.bo(v,v,u),r.cE(v,v,g),this.mercatorFogMatrix=v,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,a,p)}_computeCameraPosition(t){const a=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),p=this.point,g=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-t/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-u[0]*g,p.y/this.worldSize-u[1]*g,t/this.worldSize*this._centerAltitude-u[2]*g]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],p=t[2];let g=1;this.projection.wrap&&(this.center=this.center.wrap()),p>0&&(g=Math.min((a-u)/p,1)),this._camera.position=r.bF([],this._camera.position,t,g),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,a=this._camera.forward(),{pitch:u,bearing:p}=this._camera.getPitchBearing(),g=r.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,v=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.al(this._maxPitch)),w=Math.max((t[2]-g)/Math.cos(u),v),A=this._zoomFromMercatorZ(w);r.bF(t,t,a,w),this._pitch=r.aD(u,r.al(this.minPitch),r.al(this.maxPitch)),this.angle=r.bX(p,-Math.PI,Math.PI),this._setZoom(r.aD(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let a=0,u=r.cx,p=0,g=1/0;for(;u-a>1e-6&&u>a;){const v=a+.5*(u-a),w=this.tileSize*Math.pow(2,v),A=this.getCameraToCenterDistance(this.projection,v,w),I=this.scaleZoom(A/(t*this.tileSize)),z=Math.abs(v-I);z<g&&(g=z,p=v),v<I?a=v:u=v}return p}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,a){const u=Math.min(t.x,a.x),p=Math.max(t.x,a.x),g=Math.min(t.y,a.y),v=Math.max(t.y,a.y);if(g<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const w=[new r.P(u,g),new r.P(p,v),new r.P(u,v),new r.P(p,g)],A=this.renderWorldCopies?-3:0,I=this.renderWorldCopies?4:1;for(const z of w){const k=this.pointRayIntersection(z);if(k.t<0)return!0;const O=this.rayIntersectionCoordinate(k);if(O.x<A||O.y<0||O.x>I||O.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(t,a){const u=r.ae(r.at([],this._camera.position,t)),p=this._zoomFromMercatorZ(u)+a;return u-this._mercatorZfromZoom(p)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([a,u,p],g){const v=[a,u,p,1];r.aA(v,v,g);const w=v[3]=Math.max(v[3],1e-6);return v[0]/=w,v[1]/=w,v[2]/=w,v}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,t))}}getCameraToCenterDistance(t,a=this.zoom,u=this.worldSize){const p=r.cA(t,a,this.width,this.height,1024),g=t.pixelSpaceConversion(this.center.lat,u,p);let v=.5/Math.tan(.5*this._fov)*this.height*g;return this.isOrthographic&&(v=r.ai(1,v,r.cO(this.pitch>=yl?1:this.pitch/yl))),v}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.az(t,t,this.globeMatrix),t}getFrustum(t){return r.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const $c=(c,t)=>{if(t>0&&c.terrain&&r.w("Cutoff is currently disabled on terrain"),t<=0||c.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=c.transform,u=Math.max(Math.abs(a._zoom-(c.minCutoffZoom-1)),1),p=a.isLODDisabled(!1)?r.af(60,45,a.pitch):r.af(30,15,a.pitch),g=a._farZ-a._nearZ,v=t*a.height,w=((1-(A=p))*a.cameraToCenterDistance+A*(a._farZ+v))*u;var A;return{shouldRenderCutoff:p<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(w-a._nearZ)/g,(w-v-a._nearZ)/g]}}},Za={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Zh{constructor(t,a){this.aabb=t,this.lastCascade=a}}class Xh{add(t,a){const u=this.receivers[t.key];u!==void 0?(u.aabb.min[0]=Math.min(u.aabb.min[0],a.min[0]),u.aabb.min[1]=Math.min(u.aabb.min[1],a.min[1]),u.aabb.min[2]=Math.min(u.aabb.min[2],a.min[2]),u.aabb.max[0]=Math.max(u.aabb.max[0],a.max[0]),u.aabb.max[1]=Math.max(u.aabb.max[1],a.max[1]),u.aabb.max[2]=Math.max(u.aabb.max[2],a.max[2])):this.receivers[t.key]=new Zh(a,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,a,u){const p=r.cV.fromPoints(t.points);let g=0;for(const v in this.receivers){const w=this.receivers[v];if(!w||!p.intersectsAabb(w.aabb))continue;w.aabb.min=p.closestPoint(w.aabb.min),w.aabb.max=p.closestPoint(w.aabb.max);const A=w.aabb.getCorners();for(let I=0;I<u.length;I++){let z=!0;for(const k of A){const O=[k[0]*a,k[1]*a,k[2]];if(r.ad(O,O,u[I].matrix),O[0]<-1||O[0]>1||O[1]<-1||O[1]>1){z=!1;break}}if(w.lastCascade=I,g=Math.max(g,I),z)break}}return g+1}}class qo{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Xh,this._depthMode=new ei(t.context.gl.LEQUAL,ei.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(Za,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Za,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Za,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,a){const u=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const p=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||p<=0||(this._shadowLayerCount=u.style.order.reduce((Q,Y)=>{const ee=u.style._mergedLayers[Y];return Q+(ee.hasShadowPass()&&!ee.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const g=u.context,v=Za.shadowMapResolution,w=Za.shadowMapResolution;if(this._cascades.length===0||Za.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Q=0;Q<Za.cascadeCount;++Q){const Y=u._shadowMapDebug,ee=g.gl,K=g.createFramebuffer(v,w,Y,"texture"),se=new r.T(g,{width:v,height:w,data:null},ee.DEPTH_COMPONENT16);if(K.depthAttachment.set(se.texture),Y){const pe=new r.T(g,{width:v,height:w,data:null},ee.RGBA8);K.colorAttachment.set(pe.texture)}this._cascades.push({framebuffer:K,texture:se,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.cn,scale:0})}}this.shadowDirection=rf(a);let A=0;if(t.elevation){const Q=t.elevation,Y=[1e4,-1e4];Q.visibleDemTiles.filter(ee=>ee.dem).forEach(ee=>{const K=ee.dem.tree;Y[0]=Math.min(Y[0],K.minimums[0]),Y[1]=Math.max(Y[1],K.maximums[0])}),Y[0]!==1e4&&(A=(Y[1]-Y[0])*Q.exaggeration())}const I=1.5*t.cameraToCenterDistance,z=3*I,k=new Float64Array(16);for(let Q=0;Q<this._cascades.length;++Q){const Y=this._cascades[Q];let ee=t.height/50,K=1;Za.cascadeCount===1?K=z:Q===0?K=I:(ee=I,K=z);const[se,pe]=af(t,this.shadowDirection,ee,K,Za.shadowMapResolution,A);Y.scale=t.scale,Y.matrix=se,Y.boundingSphereRadius=pe,r.bi(k,Y.matrix),Y.frustum=r.cn.fromInvProjectionMatrix(k,1,0,!0),Y.far=K}const O=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[O].far,this._cascades[O].far],this._uniformValues.u_shadow_intensity=p,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Za.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Za.shadowMapResolution,this._uniformValues.u_shadowmap_0=Oa.ShadowMap0,this._uniformValues.u_shadowmap_1=Oa.ShadowMap0+1,this._groundShadowTiles=u.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const j=u.transform.elevation;for(const Q of this._groundShadowTiles){let Y={min:0,max:0};if(j){const ee=j.getMinMaxForTile(Q);ee&&(Y=ee)}this.addShadowReceiver(Q.toUnwrapped(),Y.min,Y.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,a){if(!this.enabled)return;const u=this.painter,p=u.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(u.transform.getFrustum(0),u.transform.worldSize,this._cascades),p.viewport.set([0,0,Za.shadowMapResolution,Za.shadowMapResolution]);for(let g=0;g<this._numCascadesToRender;++g){u.currentShadowCascade=g,p.bindFramebuffer.set(this._cascades[g].framebuffer.framebuffer),p.clear({color:r.am.white,depth:1});for(const v of t.order){const w=t._mergedLayers[v];if(!w.hasShadowPass()||w.isHidden(u.transform.zoom))continue;const A=t.getLayerSourceCache(w),I=A?a[A.id]:void 0;(w.type==="model"||I&&I.length)&&u.renderLayer(u,A,w,I)}}u.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,a=t.style,u=t.context,p=a.directionalLight,g=a.ambientLight;if(!p||!g)return;const v=[],w=$c(t,t.longestCutoffRange);w.shouldRenderCutoff&&v.push("RENDER_CUTOFF"),v.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&v.push("NORMAL_OFFSET");const A=zs(a,p,g),I=new ei(u.gl.LEQUAL,ei.ReadOnly,t.depthRangeFor3D);for(const z of this._groundShadowTiles){const k=z.toUnwrapped(),O=t.isTileAffectedByFog(z),j=t.getOrCreateProgram("groundShadow",{defines:v,overrideFog:O});this.setupShadows(k,j),t.uploadCommonUniforms(u,j,k,null,w);const Q={u_matrix:t.transform.calculateProjMatrix(k),u_ground_shadow_factor:A};j.draw(t,u.gl.TRIANGLES,I,Di.disabled,Zi.multiply,Li.disabled,Q,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Zi.unblended:Zi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const a=this.painter.transform,u=a.calculatePosMatrix(t,a.worldSize);return r.az(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}calculateShadowPassMatrixFromMatrix(t){return r.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,a,u,p=0){if(!this.enabled)return;const g=this.painter.transform,v=this.painter.context,w=v.gl,A=this._uniformValues,I=new Float64Array(16),z=g.calculatePosMatrix(t,g.worldSize);for(let k=0;k<this._cascades.length;k++)r.az(I,this._cascades[k].matrix,z),A[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),v.activeTexture.set(w.TEXTURE0+Oa.ShadowMap0+k),this._cascades[k].texture.bind(w.NEAREST,w.CLAMP_TO_EDGE);if(this.useNormalOffset=!!u,this.useNormalOffset){const k=r.cT(t.canonical),O=2/g.tileSize*r.aj/Za.shadowMapResolution,j=O*this._cascades[0].boundingSphereRadius,Q=O*this._cascades[this._cascades.length-1].boundingSphereRadius,Y=(u==="vector-tile"?1:3)/Math.pow(2,p-t.canonical.z-(1-g.zoom+Math.floor(g.zoom)));A.u_shadow_normal_offset=[k,j*Y,Q*Y],A.u_shadow_bias=[6e-5,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(v,A)}setupShadowsFromMatrix(t,a,u=!1){if(!this.enabled)return;const p=this.painter.context,g=p.gl,v=this._uniformValues,w=new Float64Array(16);for(let A=0;A<Za.cascadeCount;A++)r.az(w,this._cascades[A].matrix,t),v[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(w),p.activeTexture.set(g.TEXTURE0+Oa.ShadowMap0+A),this._cascades[A].texture.bind(g.NEAREST,g.CLAMP_TO_EDGE);if(this.useNormalOffset=u,u){const A=Za.normalOffset;v.u_shadow_normal_offset=[1,A,A],v.u_shadow_bias=[6e-5,.0012,.012]}else v.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(p,v)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,a,u,p){if(p[2]>=0)return{};const g=function(A,I,z){const k=z/(1<<A.canonical.z);return new r.cV([A.canonical.x*k+A.wrap*z,A.canonical.y*k+A.wrap*z,0],[(A.canonical.x+1)*k+A.wrap*z,(A.canonical.y+1)*k+A.wrap*z,I])}(t,a,u).getCorners(),v=a/-p[2];p[0]<0?(r.cU(g[0],g[0],[p[0]*v,0,0]),r.cU(g[3],g[3],[p[0]*v,0,0])):p[0]>0&&(r.cU(g[1],g[1],[p[0]*v,0,0]),r.cU(g[2],g[2],[p[0]*v,0,0])),p[1]<0?(r.cU(g[0],g[0],[0,p[1]*v,0]),r.cU(g[1],g[1],[0,p[1]*v,0])):p[1]>0&&(r.cU(g[2],g[2],[0,p[1]*v,0]),r.cU(g[3],g[3],[0,p[1]*v,0]));const w={};return w.vertices=g,w.planes=[$o(g[1],g[0],g[4]),$o(g[2],g[1],g[5]),$o(g[3],g[2],g[6]),$o(g[0],g[3],g[7])],w}addShadowReceiver(t,a,u){this._receivers.add(t,r.cV.fromTileIdAndHeight(t,a,u))}getMaxCascadeForTile(t){const a=this._receivers.get(t);return a&&a.lastCascade?a.lastCascade:0}}function $o(c,t,a){const u=r.at([],a,t),p=r.at([],c,t),g=r.bG([],u,p),v=r.ae(g);return v===0?[0,0,1,0]:(r.b$(g,g,1/v),[g[0],g[1],g[2],-r.bE(g,t)])}function rf(c){const t=c.properties.get("direction"),a=r.cR(t.x,t.y,t.z);a[2]=r.aD(a[2],0,75);const u=r.cW([a[0],a[1],a[2]]);return r.cS(u.x,u.y,u.z)}function zs(c,t,a){const u=t.properties.get("color-use-theme")==="none",p=t.properties.get("color"),g=t.properties.get("intensity"),v=t.properties.get("direction"),w=[v.x,v.y,v.z],A=a.properties.get("color-use-theme")==="none",I=a.properties.get("color"),z=a.properties.get("intensity"),k=Math.max(r.bE([0,0,1],w),0),O=[0,0,0];r.b$(O,I.toRenderColor(A?null:c.getLut(t.scope)).toArray01Linear().slice(0,3),z);const j=[0,0,0];return r.b$(j,p.toRenderColor(u?null:c.getLut(a.scope)).toArray01Linear().slice(0,3),k*g),r.cX([O[0]>0?O[0]/(O[0]+j[0]):0,O[1]>0?O[1]/(O[1]+j[1]):0,O[2]>0?O[2]/(O[2]+j[2]):0])}function af(c,t,a,u,p,g){const v=c.zoom,w=c.scale,A=c.worldSize,I=1/A,z=c.aspect,k=Math.sqrt(1+z*z)*Math.tan(.5*c.fovX),O=k*k,j=u-a,Q=u+a;let Y,ee;O>j/Q?(Y=u,ee=u*k):(Y=.5*Q*(1+O),ee=.5*Math.sqrt(j*j+2*(u*u+a*a)*O+Q*Q*O*O));const K=c.projection.pixelsPerMeter(c.center.lat,A),se=c._camera.getCameraToWorldMercator(),pe=[0,0,-Y*I];r.ad(pe,pe,se);let ve=ee*I;const Ae=c._edgeInsets;if(!(Ae.left===0&&Ae.top===0&&Ae.right===0&&Ae.bottom===0||Ae.left===Ae.right&&Ae.top===Ae.bottom)){const bt=c._camera.getWorldToCamera(c.worldSize,c.projection.zAxisUnit==="meters"?K:1),dt=c._camera.getCameraToClipPerspective(c._fov,c.width/c.height,a,u);dt[8]=2*-c.centerOffset.x/c.width,dt[9]=2*c.centerOffset.y/c.height;const wt=new Float64Array(16);r.cB(wt,dt,bt);const At=new Float64Array(16);r.bi(At,wt);const Qt=r.cn.fromInvProjectionMatrix(At,A,v,!0);for(const ai of Qt.points){const Yt=((Se=ai)[0]/=w,Se[1]/=w,Se[2]=r.c6(Se[2],c._center.lat),Se);ve=Math.max(ve,r.c0(r.cY([],pe,Yt)))}}var Se;ve*=p/(p-1);const Te=Math.acos(t[2]),ge=Math.atan2(-t[0],-t[1]),Ce=new va;Ce.position=pe,Ce.setPitchBearing(Te,ge);const Le=Ce.getWorldToCamera(A,K),Qe=ve*A,Ze=Math.min(c._mercatorZfromZoom(17)*A*-2,-2*Qe),ht=Ce.getCameraToClipOrthographic(-Qe,Qe,-Qe,Qe,Ze,(Qe+g*K)/t[2]),lt=new Float64Array(16);r.az(lt,ht,Le);const Ct=r.cS(Math.floor(1e6*pe[0])/1e6*A,Math.floor(1e6*pe[1])/1e6*A,0),$e=.5*p,et=[0,0,0];r.ad(et,Ct,lt),r.b$(et,et,$e);const Ge=[Math.floor(et[0]),Math.floor(et[1]),Math.floor(et[2])],pt=[0,0,0];r.at(pt,et,Ge),r.b$(pt,pt,-1/$e);const tt=new Float64Array(16);return r.bx(tt),r.bo(tt,tt,pt),r.az(lt,tt,lt),[lt,Qe]}class vl extends r.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,a){return r.aS(this.requestManager.transformRequest(a,r.R.Model).url).then(u=>{if(!u)return;const p=r.aT(u),g=new r.aU(t,void 0,void 0,p);return g.computeBoundsAndApplyParent(),g}).catch(u=>{if(u&&u.status===404)return null;this.fire(new r.z(new Error(`Could not load model ${t} from ${a}: ${u.message}`)))})}load(t,a,u={forceReload:!1}){this.models[a]||(this.models[a]={});const p=Object.keys(t),g=[],v=[];for(const w of p){const A=t[w];this.hasURLBeenRequested(A)&&!u.forceReload||(this.modelByURL[A]={modelId:w,scope:a},g.push(this.loadModel(w,A)),v.push(w)),this.models[a][w]||(this.models[a][w]={model:null,numReferences:1})}this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+v.length,Promise.allSettled(g).then(w=>{for(let A=0;A<w.length;A++){const{status:I}=w[A];if(I==="rejected")continue;const{value:z}=w[A];this.models[a][v[A]]||(this.models[a][v[A]]={model:null,numReferences:1}),this.models[a][v[A]].model=z}this.numModelsLoading[a]-=v.length,this.fire(new r.A("data",{dataType:"style"}))}).catch(w=>{this.fire(new r.z(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,a,u={exactIdMatch:!1}){return!!(u.exactIdMatch?this.getModel(t,a):this.getModelByURL(this.modelUris[a][t]))}getModel(t,a){return this.models[a]||(this.models[a]={}),this.models[a][t]?this.models[a][t].model:void 0}getModelByURL(t){if(!t)return null;const a=this.modelByURL[t];return a?this.models[a.scope][a.modelId].model:null}hasModelBeenAdded(t,a){return this.models[a]&&this.models[a][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,a,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const p=this.requestManager.normalizeModelURL(a);if((this.hasModel(t,u,{exactIdMatch:!0})||this.hasModelBeenAdded(t,u))&&this.modelUris[u][t]===p)this.models[u][t].numReferences++;else if(this.hasURLBeenRequested(p)){const{scope:g,modelId:v}=this.modelByURL[p];this.models[g][v].numReferences++}else this.modelUris[u][t]=p,this.load({[t]:this.modelUris[u][t]},u)}addModelURLs(t,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const u=this.modelUris[a];for(const p in t)u[p]=this.requestManager.normalizeModelURL(t[p])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const u={};for(const p of t)this.hasModel(p,a,{exactIdMatch:!0})||this.hasURLBeenRequested(p)?this.models[a][p].numReferences++:this.modelUris[a][p]&&!this.hasURLBeenRequested(p)?u[p]=this.modelUris[a][p]:!this.hasURLBeenRequested(p)&&r.cZ(p,!1)&&(this.modelUris[a][p]=this.requestManager.normalizeModelURL(p),u[p]=this.modelUris[a][p]);this.load(u,a)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,a,u=!1){if(this.models[a]&&this.models[a][t]&&(this.models[a][t].numReferences--,this.models[a][t].numReferences===0)){const p=this.modelUris[a][t];u||delete this.modelUris[a][t],delete this.modelByURL[p];const g=this.models[a][t].model;if(!g)return;delete this.models[a][t],g.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const a of Object.keys(this.models[t])){const u=this.models[t][a].model;delete this.models[t][a],u&&u.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,a){this.models[a]||(this.models[a]={});for(const u in this.models[a])this.models[a][u].model&&this.models[a][u].model.upload(t.context)}}const hp=new r.a7({data:new r.a8(r.a5.colorTheme.data)}),n_={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Zc(c){return c=c||{},Object.assign(c,n_)}class of extends r.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},r.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new r.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(v,w){const[A,I]=v,{center:z,radius:k}=w,[O,j]=z,Q=Math.abs(A-O);return Math.sqrt((Q>180?360-Q:Q)**2+(I-j)**2)<=k}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new r.A("floorplangone")));const a={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=new r.P(this._map.transform.width/2,this._map.transform.height/2),p=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],g=this._map.queryRenderedFeatures(t?p:u,a);g.length>0&&(this._selectedFloorplan&&g[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=g[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(g){const[[v,w],[A,I]]=g,z=(A-v+360)%360,k=z>180?360-z:z;return{center:[(v+k/2+360)%360,(w+I)/2],radius:Math.sqrt(k**2+(I-w)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const a=this._floorplanStates[this._indoorData.id].selectedBuilding,u=this._floorplanStates[this._indoorData.id].selectedLevel;let p;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const g of this._indoorData.levels)g.id===this._selectedLevel.id&&(p=g.id);if(this.fire(new r.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:p})),a){const g=this._indoorData.buildings.find(v=>v.id===a);this._buildingSelected(g,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(u){const g=this._indoorData.levels.find(v=>v.id===u);this._updateLevels(g,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,a){a&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const u=this._indoorData.levels.filter(p=>t.levels.includes(p.id));this.fire(new r.A("buildingselected",{buildingId:t.id,levels:u}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{const a=this._indoorData.levels.find(u=>u.id===t);this._updateLevels(a,!0)}this.fire(new r.A("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,a){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(a&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function u(I){const z=I.indexOf("/floor/");if(z===-1)return I;const k=z+7,O=I.indexOf("/",k);return O===-1?I.slice(k):I.slice(k,O)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const p=[],g={},v={},w={},A={};for(const I of this._indoorData.levels)if(p.push(I.id),g[I.id]=I.height,v[I.id]=I.base,t){if(this.mergeFloors){const z=u(t.id),k=u(I.id);w[I.id]=k===z?"true":"false"}else w[I.id]=I.id===t.id?"true":"false";A[I.id]=I.base<t.base?"true":"false"}else A[I.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",p]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",g]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",w]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",A]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),a&&t.extent)){const I=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),z=this._map.getZoom(),k=I.zoom?Math.abs(z-I.zoom):0;this._map.fitBounds(t.extent,k>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:z})}}selectFloorplan(t){const a={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],p=this._map.queryRenderedFeatures(u,a);if(p.length>0){for(const g of p)if(JSON.parse(g.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=g,this._floorplanSelected(!0);break}}}selectBuilding(t){const a=this._indoorData.buildings.find(u=>u.id===t);this._buildingSelected(a,!0)}selectLevel(t){this._levelSelected(t)}}function Wh(c){if(!c.metadata||!c.metadata.content_area)return;const t=r.q.devicePixelRatio,{left:a,top:u,width:p,height:g}=c.metadata.content_area,v=a*t,w=u*t;return[v,w,v+p*t,w+g*t]}function Zu(c){if(c)return c.map(([t,a])=>[t*r.q.devicePixelRatio,a*r.q.devicePixelRatio])}class dp{constructor(t,a,u){this.id=t,this.scope=a,this.sourceCache=u,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const a=this.sourceCache.getVisibleCoordinates();if(a.length===0)return t;const u=this.sourceCache.getSource();if(!(u instanceof ma))return t;const p=a.map(v=>this.sourceCache.getTile(v)),g=u.getImages(p,Array.from(this.pendingRequests));for(const[v,w]of g)t.set(r.I.from({name:v,iconsetId:this.id}),w),this.pendingRequests.delete(v);for(const v of this.pendingRequests)this.missingRequests.add(v);return this.pendingRequests.clear(),t}}const Ro=(c,t)=>Me(c,t&&t.filter(a=>a.identifier!=="source.canvas")),Xc=r.aF(gn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),sf=r.aF(gn,["setCenter","setZoom","setBearing","setPitch"]),nl=new Set(["background","sky","slot","custom"]),Ps={version:8,layers:[],sources:{}},lf={duration:300,delay:0};class Zo extends r.E{constructor(t,a={}){super(),this.map=t,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=r.l({},lf),this._buildingIndex=new op(this),this.crossTileSymbolIndex=new Br,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new Rn,this.dispatcher=a.dispatcher?a.dispatcher:new r.D(r.d0(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new io(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new r.d1(t._requestManager,a.localFontFamily?r.d2.all:a.localIdeographFontFamily?r.d2.ideographs:r.d2.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new vl(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:a.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",r.d3());const u=this;this._rtlTextPluginCallback=Zo.registerForPluginStateChange(p=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(g,v)=>{if(r.d4(g),v&&v.every(w=>w))for(const w in u._sourceCaches){const A=u._sourceCaches[w],I=A.getSource().type;I!=="vector"&&I!=="geojson"||A.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const g=this.getOwnSource(p.sourceId);if(g&&g.vectorLayerIds)for(const v in this._layers){const w=this._layers[v];w.source===g.id&&this._validateLayer(w)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(r.f(t))return t;const a=r.d5(t);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${r.d6(JSON.stringify(t))}`}_diffStyle(t,a,u){this.globalId=this._getGlobalId(t);const p=(g,v)=>{try{v(null,this.setState(g,u))}catch(w){v(w,!1)}};if(typeof t=="string"){const g=this.map._requestManager.normalizeStyleURL(t),v=this.map._requestManager.transformRequest(g,r.R.Style);r.n(v,(w,A)=>{w?this.fire(new r.z(w)):A&&p(A,a)})}else typeof t=="object"&&p(t,a)}loadURL(t,a={}){this.fire(new r.A("dataloading",{dataType:"style"}));const u=typeof a.validate=="boolean"?a.validate:!r.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,a.accessToken),this.resolvedImports.add(t);const p=this.importsCache.get(t);if(p)return this._load(p,u);const g=this.map._requestManager.transformRequest(t,r.R.Style);this._request=r.n(g,(v,w)=>{if(this._request=null,v)this.fire(new r.z(v));else if(w)return this.importsCache.set(t,w),this._load(w,u)})}loadJSON(t,a={}){this.fire(new r.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=r.q.frame(()=>{this._request=null,this._load(t,a.validate!==!1)})}loadEmpty(){this.fire(new r.A("dataloading",{dataType:"style"})),this._load(Ps,!1)}_loadImports(t,a,u){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const p=[];for(const g of t){const v=this._createFragmentStyle(g),w=new Promise(z=>{v.once("style.import.load",z),v.once("error",z)}).then(()=>this.mergeAll());if(p.push(w),this.resolvedImports.has(g.url)){v.loadEmpty();continue}const A=g.data||this.importsCache.get(g.url);A?(v.loadJSON(A,{validate:a}),this._isInternalStyle(A)&&(v.globalId=null)):g.url?v.loadURL(g.url,{validate:a}):v.loadEmpty();const I={style:v,id:g.id,config:g.config};if(u){const z=this.fragments.findIndex(({id:k})=>k===u);this.fragments=this.fragments.slice(0,z).concat(I).concat(this.fragments.slice(z))}else this.fragments.push(I)}return Promise.allSettled(p)}getImportGlobalIds(t=this,a=new Set){for(const u of t.fragments)u.style.globalId&&a.add(u.style.globalId),this.getImportGlobalIds(u.style,a);return[...a.values()]}_createFragmentStyle(t){const a=this.scope?r.C(t.id,this.scope):t.id;let u;const p=this._initialConfig&&this._initialConfig[a];(t.config||p)&&(u=r.l({},t.config,p));const g=new Zo(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:u,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return g.setEventedParent(this.map,{style:g}),g}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,a){const u=t.indoor?Zc(t.schema):t.schema;if(this._isInternalStyle(t)){const v=r.l({},Ps,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(v,a)}if(this.updateConfig(this._config,u),a&&Ro(this,Pa(t)))return;this._loaded=!0,this.stylesheet=r.d7(t);const p=()=>{for(const I in t.sources)this.addSource(I,t.sources[I],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const I in t.iconsets)this.addIconset(I,t.iconsets[I]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const v=Nh(this.stylesheet.layers);if(this._order=v.map(I=>I.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const I=this.stylesheet.lights[0];this.light=new He(I.properties,I.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new He(this.stylesheet.light)),this._layers={};for(const I of v){const z=r.dc(I,this.scope,this._styleColorTheme.lut,this.options);z.configDependencies.size!==0&&this._configDependentLayers.add(z.fqid),z.setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z;const k=this.getOwnLayerSourceCache(z),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&z.canCastShadows()&&O&&(k.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const w=this.stylesheet.terrain;w&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(w,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.A("data",{dataType:"style"}));const A=this.isRootStyle();t.imports?this._loadImports(t.imports,a).then(()=>{this._reloadImports(),this.fire(new r.A(A?"style.load":"style.import.load"))}).catch(I=>{this.fire(new r.z(new Error("Failed to load imports",I))),this.fire(new r.A(A?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.A(A?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const g=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(g){const v=this._evaluateColorThemeData(g);this._loadColorTheme(v).then(()=>{p()}).catch(w=>{r.w(`Couldn't load color theme from the stylesheet: ${w}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,a,u,p,g,v,w,A,I,z;const k={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(O=>{if(O.stylesheet){if(O.light!=null&&(t=O.light),O.stylesheet.lights)for(const j of O.stylesheet.lights)j.type==="ambient"&&O.ambientLight!=null&&(a=O.ambientLight),j.type==="directional"&&O.directionalLight!=null&&(u=O.directionalLight);p=this._prioritizeTerrain(p,O.terrain,O.stylesheet.terrain),O.stylesheet.fog&&O.fog!=null&&(g=O.fog),O.stylesheet.snow&&O.snow!=null&&(v=O.snow),O.stylesheet.rain&&O.rain!=null&&(w=O.rain),O.stylesheet.camera!=null&&(z=O.stylesheet.camera),O.stylesheet.projection!=null&&(A=O.stylesheet.projection),O.stylesheet.transition!=null&&(I=O.stylesheet.transition),k[O.scope]=O._styleColorTheme}}),this.light=t,this.ambientLight=a,this.directionalLight=u,this.fog=g,this.snow=v,this.rain=w,this._styleColorThemeForScope=k,p===null?delete this.terrain:this.terrain=p,this.camera=z||{"camera-projection":"perspective"},this.projection=A||{name:"mercator"},this.transition=r.l({},lf,I),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const a=u=>{for(const p of u.fragments)a(p.style);t(u)};a(this)}_prioritizeTerrain(t,a,u){const p=t&&t.drapeRenderMode===0;return u===null?a&&a.drapeRenderMode===0?a:p?t:null:a!=null&&(!t||p||a&&a.drapeRenderMode===1)?a:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{t=this._prioritizeTerrain(t,a.terrain,a.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(t=a.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},a={},u={};this.forEachFragmentStyle(p=>{for(const g in p._sourceCaches){const v=r.C(g,p.scope);t[v]=p._sourceCaches[g]}for(const g in p._otherSourceCaches){const v=r.C(g,p.scope);a[v]=p._otherSourceCaches[g]}for(const g in p._symbolSourceCaches){const v=r.C(g,p.scope);u[v]=p._symbolSourceCaches[g]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=u}mergeLayers(){const t={},a=[],u={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(g=>{for(const v of g._order){const w=g._layers[v];if(w.type==="slot"){const A=r.d8(v);if(t[A])continue;t[A]=[]}w.slot&&t[w.slot]?t[w.slot].push(w):a.push(w)}}),this._mergedOrder=[];const p=(g=[])=>{for(const v of g)if(v.type==="slot"){const w=r.d8(v.id);t[w]&&p(t[w]),this._mergedSlots.push(w)}else{const w=r.C(v.id,v.scope);this._mergedOrder.push(w),u[w]=v,v.is3D(!!this.terrain)&&(this._has3DLayers=!0),v.type==="circle"&&(this._hasCircleLayers=!0),v.type==="symbol"&&(this._hasSymbolLayers=!0),v.type==="clip"&&(this._clipLayerPresent=!0)}};p(a),this._mergedOrder.sort((g,v)=>{const w=u[g],A=u[v];return w.hasInitialOcclusionOpacityProperties?A.is3D(!!this.terrain)?1:0:w.is3D(!!this.terrain)&&A.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=u,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=r.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(a,u,p){const g=r.l({},u);for(const w of Object.keys(r.a5.colorTheme))g[w]===void 0&&(g[w]=r.a5.colorTheme[w].default);const v=new r.a6(hp,a,new Map(p));return v.setTransitionOrValue(g,p),v.untransitioned().possiblyEvaluate(new r.aa(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((u,p)=>{const g="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();let v=t;v.startsWith(g)||(v=g+v);const w=r.I.from("mapbox-reserved-lut"),A=new Image;A.src=v,A.onerror=()=>{this._styleColorTheme.lutLoading=!1,p(new Error("Failed to load image data"))},A.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void u();this._styleColorTheme.lutLoading=!1;const{width:I,height:z,data:k}=r.q.getImageData(A);if(z>32)return void p(new Error("The height of the image must be less than or equal to 32 pixels."));if(I!==z*z)return void p(new Error("The width of the image must be equal to the height squared."));this.getImage(w)&&this.removeImage(w),this.addImage(w,{data:new r.r({width:I,height:z},k),pixelRatio:1,sdf:!1,usvg:!1,version:0});const O=this.imageManager.getImage(w,this.scope);O?(this._styleColorTheme.lut={image:O.data,data:t},u()):p(new Error("Missing LUT image."))}})}getLut(t){const a=this._styleColorThemeForScope[t];return a?a.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(a,u,p){let g,v,w;const A=r.q.devicePixelRatio>1?"@2x":"";let I=r.n(u.transformRequest(u.normalizeSpriteURL(a,A,".json"),r.R.SpriteJSON),(O,j)=>{I=null,w||(w=O,g=j,k())}),z=r.o(u.transformRequest(u.normalizeSpriteURL(a,A,".png"),r.R.SpriteImage),(O,j)=>{z=null,w||(w=O,v=j,k())});function k(){if(w)p(w);else if(g&&v){const O=r.q.getImageData(v),j={};for(const Q in g){const{width:Y,height:ee,x:K,y:se,sdf:pe,pixelRatio:ve,stretchX:Ae,stretchY:Se,content:Te}=g[Q],ge=new r.r({width:Y,height:ee});r.r.copy(O,ge,{x:K,y:se},{x:0,y:0},{width:Y,height:ee},null),j[Q]={data:ge,pixelRatio:ve,sdf:pe,stretchX:Ae,stretchY:Se,content:Te,usvg:!1}}p(null,j)}}return{cancel(){I&&(I.cancel(),I=null),z&&(z.cancel(),z=null)}}}(t,this.map._requestManager,(a,u)=>{if(this._spriteRequest=null,a)this.fire(new r.z(a));else if(u){const p=new Map;for(const g in u)p.set(r.I.from(g),u[g]);this.addImages(p)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.A("data",{dataType:"style"}))})}addIconset(t,a){if(a.type==="sprite")return void this._loadSprite(a.url);const u=this.getOwnSourceCache(a.source);if(!u)return void this.fire(new r.z(new Error(`Source "${a.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const p=u.getSource();if(p.type!=="raster-array")return void this.fire(new r.z(new Error(`Source "${a.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));p.partial=!1;const g=new dp(t,this.scope,u);this.imageManager.addImageProvider(g,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!r.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const a=this.map._spriteFormat==="auto";var u,p;this._spriteRequest=(p=(g,v)=>{if(this._spriteRequest=null,g)a?this._loadSprite(t):this.fire(new r.z(g));else if(v){const w=new Map;for(const A in v)w.set(r.I.from(A),v[A]);this.addImages(w)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.A("data",{dataType:"style"}))},r.br((u=this.map._requestManager).transformRequest(u.normalizeIconsetURL(t),r.R.Iconset),(g,v)=>{if(g)return void p(g);const w={},A=r.c_(new r.bq(v));for(const I of A.icons){const z={version:1,pixelRatio:r.q.devicePixelRatio,content:Wh(I),stretchX:I.metadata?Zu(I.metadata.stretch_x_areas):void 0,stretchY:I.metadata?Zu(I.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:I};w[I.name]=z}p(null,w)}))}_validateLayer(t){const a=this.getOwnSource(t.source);if(!a)return;const u=t.sourceLayer;u&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(u)===-1)&&this.fire(new r.z(new Error(`Source layer "${u}" does not exist on source "${a.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,a)=>{const u=this.fragments[a];return u&&u.style&&(t.data=u.style.serialize()),t})}_serializeSources(){const t={};for(const a in this._sourceCaches){const u=this._sourceCaches[a].getSource();t[u.id]||(t[u.id]=u.serialize())}return t}_serializeLayers(t){const a=[];for(const u of t){const p=this._layers[u];p&&p.type!=="custom"&&a.push(p.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const a=this.getOwnLayer(t);if(a)return a;this.fire(new r.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const a=this.getOwnSource(t);if(a)return a;this.fire(new r.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,a){const u=this.map.painter;if(u)for(let p=t.minzoom||0;p<(t.maxzoom||25.5);p++){const g=t.getProgramIds();if(g)for(const v of g){const w=t.getDefaultProgramParams(v,a.zoom,this._styleColorTheme.lut);w&&(u.style=this,this.fog&&(u._fogVisible=!0,w.overrideFog=!0,u.getOrCreateProgram(v,w)),u._fogVisible=!1,w.overrideFog=!1,u.getOrCreateProgram(v,w),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(w.overrideRtt=!0,u.getOrCreateProgram(v,w)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const a=this.calculateLightsBrightness();t.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a));const u=this._changes.isDirty();let p=!1;if(this._changes.isDirty()){const w=this._changes.getLayerUpdatesByScope();for(const A in w){const{updatedIds:I,removedIds:z}=w[A];(I||z)&&(this._updateWorkerLayers(A,I,z),p=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const g={};for(const w in this._mergedSourceCaches){const A=this._mergedSourceCaches[w];g[w]=A.used,A.used=!1,A.tileCoverLift=0}for(const w of this._mergedOrder){const A=this._mergedLayers[w];if(A.recalculate(t,this._availableImages),!A.isHidden(t.zoom)){const I=this.getLayerSourceCache(A);I&&(I.used=!0,I.tileCoverLift=Math.max(I.tileCoverLift,A.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(A,t)}):this.precompilePrograms(A,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&p&&this.mergeLayers();const v=this.imageManager.getPendingImageProviders();for(const w of v)w.sourceCache.used=!0;for(const w in g){const A=this._mergedSourceCaches[w];g[w]!==A.used&&A.getSource().fire(new r.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),u&&this.fire(new r.A("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const a of t){const u=a.resolvePendingRequests(),p=this.getFragmentStyle(a.scope);p&&p.addImages(u)}}_updateTilesForChangedImages(){const t={};for(const a in this._mergedSourceCaches){const u=this._mergedSourceCaches[a].getSource().scope;t[u]=t[u]||this._changes.getUpdatedImages(u),t[u].length!==0&&this._mergedSourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t[u])}for(const a in t)this._changes.resetUpdatedImages(a)}_updateWorkerLayers(t,a,u){const p=this.getFragmentStyle(t);p&&this.dispatcher.broadcast("updateLayers",{layers:a?p._serializeLayers(a):[],scope:t,removedIds:u||[],options:p.options})}setState(t,a){if(this._checkLoaded(),Ro(this,Pa(t)))return!1;(t=r.d7(t)).layers=Nh(t.layers);const u=function(v,w){if(!v)return[{command:gn.setStyle,args:[w]}];let A=[];try{if(!r.bv(v.version,w.version))return[{command:gn.setStyle,args:[w]}];if(r.bv(v.center,w.center)||A.push({command:gn.setCenter,args:[w.center]}),r.bv(v.zoom,w.zoom)||A.push({command:gn.setZoom,args:[w.zoom]}),r.bv(v.bearing,w.bearing)||A.push({command:gn.setBearing,args:[w.bearing]}),r.bv(v.pitch,w.pitch)||A.push({command:gn.setPitch,args:[w.pitch]}),r.bv(v.sprite,w.sprite)||A.push({command:gn.setSprite,args:[w.sprite]}),r.bv(v.glyphs,w.glyphs)||A.push({command:gn.setGlyphs,args:[w.glyphs]}),r.bv(v.imports,w.imports)||function(j=[],Q=[],Y){Q=Q||[];const ee=(j=j||[]).map(Is),K=Q.map(Is),se=j.reduce(Oc,{}),pe=Q.reduce(Oc,{}),ve=ee.slice();let Ae,Se,Te,ge;for(Ae=0,Se=0;Ae<ee.length;Ae++)Te=ee[Ae],pe.hasOwnProperty(Te)?Se++:(Y.push({command:gn.removeImport,args:[Te]}),ve.splice(ve.indexOf(Te,Se),1));for(Ae=0,Se=0;Ae<K.length;Ae++)Te=K[K.length-1-Ae],ve[ve.length-1-Ae]!==Te&&(se.hasOwnProperty(Te)?(Y.push({command:gn.removeImport,args:[Te]}),ve.splice(ve.lastIndexOf(Te,ve.length-Se),1)):Se++,ge=ve[ve.length-Ae],Y.push({command:gn.addImport,args:[pe[Te],ge]}),ve.splice(ve.length-Ae,0,Te));for(const Ce of Q){const Le=se[Ce.id];Le&&!r.bv(Le,Ce)&&Y.push({command:gn.updateImport,args:[Ce.id,Ce]})}}(v.imports,w.imports,A),r.bv(v.transition,w.transition)||A.push({command:gn.setTransition,args:[w.transition]}),r.bv(v.light,w.light)||A.push({command:gn.setLight,args:[w.light]}),r.bv(v.fog,w.fog)||A.push({command:gn.setFog,args:[w.fog]}),r.bv(v.snow,w.snow)||A.push({command:gn.setSnow,args:[w.snow]}),r.bv(v.rain,w.rain)||A.push({command:gn.setRain,args:[w.rain]}),r.bv(v.projection,w.projection)||A.push({command:gn.setProjection,args:[w.projection]}),r.bv(v.lights,w.lights)||A.push({command:gn.setLights,args:[w.lights]}),r.bv(v.camera,w.camera)||A.push({command:gn.setCamera,args:[w.camera]}),r.bv(v.iconsets,w.iconsets)||function(j,Q,Y){let ee;for(ee in Q=Q||{},j=j||{})j.hasOwnProperty(ee)&&(Q.hasOwnProperty(ee)||Y.push({command:gn.removeIconset,args:[ee]}));for(ee in Q){if(!Q.hasOwnProperty(ee))continue;const K=Q[ee];j.hasOwnProperty(ee)?r.bv(j[ee],K)||(Y.push({command:gn.removeIconset,args:[ee]}),Y.push({command:gn.addIconset,args:[ee,K]})):Y.push({command:gn.addIconset,args:[ee,K]})}}(v.iconsets,w.iconsets,A),!r.bv(v["color-theme"],w["color-theme"]))return[{command:gn.setStyle,args:[w]}];const I={},z=[];(function(j,Q,Y,ee){let K;for(K in Q=Q||{},j=j||{})j.hasOwnProperty(K)&&(Q.hasOwnProperty(K)||Xl(K,Y,ee));for(K in Q){if(!Q.hasOwnProperty(K))continue;const se=Q[K];j.hasOwnProperty(K)?r.bv(j[K],se)||(j[K].type==="geojson"&&se.type==="geojson"&&ml(j,Q,K)?Y.push({command:gn.setGeoJSONSourceData,args:[K,se.data]}):Bh(K,Q,Y,ee)):Ao(K,Q,Y)}})(v.sources,w.sources,z,I);const k=[];v.layers&&v.layers.forEach(j=>{j.source&&I[j.source]?A.push({command:gn.removeLayer,args:[j.id]}):k.push(j)});let O=v.terrain;O&&I[O.source]&&(A.push({command:gn.setTerrain,args:[void 0]}),O=void 0),A=A.concat(z),r.bv(O,w.terrain)||A.push({command:gn.setTerrain,args:[w.terrain]}),function(j,Q,Y){Q=Q||[];const ee=(j=j||[]).map(Is),K=Q.map(Is),se=j.reduce(Oc,{}),pe=Q.reduce(Oc,{}),ve=ee.slice(),Ae=Object.create(null);let Se,Te,ge,Ce,Le,Qe,Ze;for(Se=0,Te=0;Se<ee.length;Se++)ge=ee[Se],pe.hasOwnProperty(ge)?Te++:(Y.push({command:gn.removeLayer,args:[ge]}),ve.splice(ve.indexOf(ge,Te),1));for(Se=0,Te=0;Se<K.length;Se++)ge=K[K.length-1-Se],ve[ve.length-1-Se]!==ge&&(se.hasOwnProperty(ge)?(Y.push({command:gn.removeLayer,args:[ge]}),ve.splice(ve.lastIndexOf(ge,ve.length-Te),1)):Te++,Qe=ve[ve.length-Se],Y.push({command:gn.addLayer,args:[pe[ge],Qe]}),ve.splice(ve.length-Se,0,ge),Ae[ge]=!0);for(Se=0;Se<K.length;Se++)if(ge=K[Se],Ce=se[ge],Le=pe[ge],!Ae[ge]&&!r.bv(Ce,Le))if(r.bv(Ce.source,Le.source)&&r.bv(Ce["source-layer"],Le["source-layer"])&&r.bv(Ce.type,Le.type)){for(Ze in gl(Ce.layout,Le.layout,Y,ge,null,gn.setLayoutProperty),gl(Ce.paint,Le.paint,Y,ge,null,gn.setPaintProperty),r.bv(Ce.slot,Le.slot)||Y.push({command:gn.setSlot,args:[ge,Le.slot]}),r.bv(Ce.filter,Le.filter)||Y.push({command:gn.setFilter,args:[ge,Le.filter]}),r.bv(Ce.minzoom,Le.minzoom)&&r.bv(Ce.maxzoom,Le.maxzoom)||Y.push({command:gn.setLayerZoomRange,args:[ge,Le.minzoom,Le.maxzoom]}),Ce)Ce.hasOwnProperty(Ze)&&Ze!=="layout"&&Ze!=="paint"&&Ze!=="filter"&&Ze!=="metadata"&&Ze!=="minzoom"&&Ze!=="maxzoom"&&Ze!=="slot"&&(Ze.indexOf("paint.")===0?gl(Ce[Ze],Le[Ze],Y,ge,Ze.slice(6),gn.setPaintProperty):r.bv(Ce[Ze],Le[Ze])||Y.push({command:gn.setLayerProperty,args:[ge,Ze,Le[Ze]]}));for(Ze in Le)Le.hasOwnProperty(Ze)&&!Ce.hasOwnProperty(Ze)&&Ze!=="layout"&&Ze!=="paint"&&Ze!=="filter"&&Ze!=="metadata"&&Ze!=="minzoom"&&Ze!=="maxzoom"&&Ze!=="slot"&&(Ze.indexOf("paint.")===0?gl(Ce[Ze],Le[Ze],Y,ge,Ze.slice(6),gn.setPaintProperty):r.bv(Ce[Ze],Le[Ze])||Y.push({command:gn.setLayerProperty,args:[ge,Ze,Le[Ze]]}))}else Y.push({command:gn.removeLayer,args:[ge]}),Qe=ve[ve.lastIndexOf(ge)+1],Y.push({command:gn.addLayer,args:[Le,Qe]})}(k,w.layers,A)}catch(I){console.warn("Unable to compute style diff:",I),A=[{command:gn.setStyle,args:[w]}]}return A}(this.serialize(),t).filter(v=>!(v.command in sf));if(u.length===0)return!1;const p=u.filter(v=>!(v.command in Xc));if(p.length>0)throw new Error(`Unimplemented: ${p.map(v=>v.command).join(", ")}.`);const g=[];return u.forEach(v=>{g.push(this[v.command](...v.args))}),a&&Promise.all(g).then(a).catch(a),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){for(const[a,u]of t.entries()){if(this.getImage(a))return this.fire(new r.z(new Error(`An image with the name "${a.name}" already exists.`)));this.imageManager.addImage(a,this.scope,u),this._changes.updateImage(a,this.scope)}return this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})),this}addImage(t,a){return this.getImage(t)?this.fire(new r.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,a),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})),this)}updateImage(t,a,u=!1){this.imageManager.updateImage(t,this.scope,a),u&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})),this):this.fire(new r.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new r.A("data",{dataType:"style"})),this}addModel(t,a,u={}){return this._checkLoaded(),this._validate(we,`models.${t}`,a,null,u)||(this.modelManager.addModel(t,a,this.scope),this.fire(new r.A("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this.fire(new r.A("data",{dataType:"style"})),this):this.fire(new r.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,a,u={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(As,`sources.${t}`,a,null,u))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const p=Fu(t,a,this.dispatcher,this);p.scope=this.scope,p.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(p.id),source:p.serialize(),sourceId:p.id}));const g=v=>{const w=(v?"symbol:":"other:")+p.id,A=r.C(w,this.scope),I=this._sourceCaches[w]=new Sa(A,p,v);(v?this._symbolSourceCaches:this._otherSourceCaches)[p.id]=I,I.onAdd(this.map)};g(!1),a.type!=="vector"&&a.type!=="geojson"||g(!0),p.onAdd&&p.onAdd(this.map),u.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const a=this.getOwnSource(t);if(!a)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new r.z(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new r.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const p=Object.entries(this.stylesheet.iconsets).find(([g,v])=>v.type==="source"&&v.source===t);if(p)return this.fire(new r.z(new Error(`Source "${t}" cannot be removed while iconset "${p[0]}" is using it.`)))}const u=this.getOwnSourceCaches(t);for(const p of u){const g=r.d8(p.id);delete this._sourceCaches[g],this._changes.discardSourceCacheUpdate(p.id),p.fire(new r.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,a){this._checkLoaded(),this.getOwnSource(t).setData(a),this._changes.setDirty()}getOwnSource(t){const a=this.getOwnSourceCache(t);return a&&a.getSource()}getOwnSources(){const t=[];for(const a in this._otherSourceCaches){const u=this.getOwnSourceCache(a);u&&t.push(u.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const a in t){const u=t[a]._tiles;for(const p in u){const g=u[p];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const p of t){if(this._validate(Ms,"lights",p))return;switch(p.type){case"ambient":if(this.ambientLight){const g=this.ambientLight;g.set(p),g.updateTransitions(a)}else this.ambientLight=new Yn(p,yn||(yn=new r.a7({color:new r.a8(r.a5.properties_light_ambient.color),"color-use-theme":new r.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a8(r.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const g=this.directionalLight;g.set(p),g.updateTransitions(a)}else this.directionalLight=new Yn(p,ln||(ln=new r.a7({direction:new r.an(r.a5.properties_light_directional.direction),color:new r.a8(r.a5.properties_light_directional.color),"color-use-theme":new r.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a8(r.a5.properties_light_directional.intensity),"cast-shadows":new r.a8(r.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new r.a8(r.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.a8(r.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const u=new r.aa(this.z||0,a);this.ambientLight&&this.ambientLight.recalculate(u),this.directionalLight&&this.directionalLight.recalculate(u),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,a=this.ambientLight;if(!t||!a)return;const u=O=>.2126*(O[0]<=.03928?O[0]/12.92:Math.pow((O[0]+.055)/1.055,2.4))+.7152*(O[1]<=.03928?O[1]/12.92:Math.pow((O[1]+.055)/1.055,2.4))+.0722*(O[2]<=.03928?O[2]/12.92:Math.pow((O[2]+.055)/1.055,2.4)),p=t.properties.get("color").toRenderColor(null).toArray01(),g=t.properties.get("intensity"),v=t.properties.get("direction"),w=1-r.cR(v.x,v.y,v.z)[2]/90,A=u(p)*g*w,I=a.properties.get("color").toRenderColor(null).toArray01(),z=a.properties.get("intensity"),k=u(I)*z;return Number(((A+k)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(r.d9(t)){const a=r.da(t),u=this.fragments.find(({id:g})=>g===a);if(!u)return;const p=r.d8(t);return u.style.getFragmentStyle(p)}{const a=this.fragments.find(({id:u})=>u===t);return a?a.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const a={},u=(p,g="")=>`${p}::${g}`;this._featuresetSelectors={};for(const p in t){const g=this._featuresetSelectors[p]=[];for(const v of t[p].selectors){if(v.featureNamespace){const A=this.getOwnLayer(v.layer);if(!A){r.w(`Layer is undefined for selector: ${v.layer}`);continue}const I=u(A.source,A.sourceLayer);if(I in a&&a[I]!==v.featureNamespace){r.w(`"featureNamespace ${v.featureNamespace} of featureset ${p}'s selector is not associated to the same source, skip this selector`);continue}a[I]=v.featureNamespace}let w;if(v.properties)for(const A in v.properties){const I=r.X(v.properties[A]);I.result==="success"&&(w=w||{},w[A]=I.value)}g.push({layerId:v.layer,namespace:v.featureNamespace,properties:w,uniqueFeatureID:v._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const a=this.getFragmentStyle(t);if(!a||!a.stylesheet.featuresets)return[];const u=[];for(const p in a.stylesheet.featuresets)u.push({featuresetId:p,importId:a.scope?a.scope:void 0});return u}getFeaturesetLayers(t,a){const u=this.getFragmentStyle(a),p=u.stylesheet.featuresets;if(!p||!p[t])return this.fire(new r.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const g=[];for(const v of p[t].selectors){const w=u.getOwnLayer(v.layer);w&&g.push(w)}return g}getConfigProperty(t,a){const u=this.getFragmentStyle(t);if(!u)return null;const p=r.C(a,u.scope),g=u.options.get(p),v=g?g.value||g.default:null;return v?v.serialize():null}setConfigProperty(t,a,u){const p=this.getFragmentStyle(t);if(!p)return;const g=p.stylesheet.indoor?Zc(p.stylesheet.schema):p.stylesheet.schema;if(!g||!g[a])return;const v=r.X(u);if(v.result!=="success")return void Ro(this,v.value);const w=v.value.expression,A=r.C(a,p.scope),I=p.options.get(A);if(!I)return;let z;const{minValue:k,maxValue:O,stepValue:j,type:Q,values:Y}=g[a],ee=r.X(g[a].default);ee.result==="success"&&(z=ee.value.expression),z?(this.options.set(A,Object.assign({},I,{value:w,default:z,minValue:k,maxValue:O,stepValue:j,type:Q,values:Y})),this.updateConfigDependencies(a)):this.fire(new r.z(new Error(`No schema defined for the config option "${a}" in the "${t}" fragment.`)))}getConfig(t){const a=this.getFragmentStyle(t);if(!a)return null;const u=a.stylesheet.schema;if(!u)return null;const p={};for(const g in u){const v=r.C(g,a.scope),w=a.options.get(v),A=w?w.value||w.default:null;p[g]=A?A.serialize():null}return p}setConfig(t,a){const u=this.getFragmentStyle(t);u&&(u.updateConfig(a,u.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const a=this.getFragmentStyle(t);return a?a.stylesheet.schema:null}setSchema(t,a){const u=this.getFragmentStyle(t);u&&(u.stylesheet.schema=a,u.updateConfig(u._config,a),this.updateConfigDependencies())}updateConfig(t,a){if(this._config=t,t||a)if(a)for(const u in a){let p,g;const v=r.X(a[u].default);if(v.result==="success"&&(p=v.value.expression),t&&t[u]!==void 0){const O=r.X(t[u]);O.result==="success"&&(g=O.value.expression)}const{minValue:w,maxValue:A,stepValue:I,type:z,values:k}=a[u];if(p){const O=r.C(u,this.scope);this.options.set(O,{default:p,value:g,minValue:w,maxValue:A,stepValue:I,type:z,values:k})}else this.fire(new r.z(new Error(`No schema defined for config option "${u}".`)))}else this.fire(new r.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const a of this._configDependentLayers){const u=this.getLayer(a);if(u){if(t&&!u.configDependencies.has(t))continue;u.possiblyEvaluateVisibility(),this._updateLayer(u)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(a=>{const u=a._styleColorTheme.colorThemeOverride?a._styleColorTheme.colorThemeOverride:a._styleColorTheme.colorTheme;if(u){const p=a._evaluateColorThemeData(u);(!a._styleColorTheme.lut&&p!==""||a._styleColorTheme.lut&&p!==a._styleColorTheme.lut.data)&&a.setColorTheme(u)}}),this._changes.setDirty()}addLayer(t,a,u={}){this._checkLoaded();const p=t.id;if(this._layers[p])return void this.fire(new r.z(new Error(`Layer with id "${p}" already exists on this map`)));let g;if(t.type==="custom"){if(Ro(this,r.db(t)))return;g=r.dc(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(p,t.source),t=r.d7(t),t=r.l(t,{source:p})),this._validate(V,`layers.${p}`,t,{arrayIndex:-1},u))return;g=r.dc(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(g),g.setEventedParent(this,{layer:{id:p}})}g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid);let v=this._order.length;if(a){const z=this._order.indexOf(a);if(z===-1)return void this.fire(new r.z(new Error(`Layer with id "${a}" does not exist on this map.`)));g.slot===this._layers[a].slot?v=z:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,p),this._layerOrderChanged=!0,this._layers[p]=g;const w=this.getOwnLayerSourceCache(g),A=!!this.directionalLight&&this.directionalLight.shadowsEnabled();w&&g.canCastShadows()&&A&&(w.castsShadows=!0);const I=this._changes.getRemovedLayer(g);if(I&&g.source&&w&&g.type!=="custom"){this._changes.discardLayerRemoval(g);const z=r.C(g.source,g.scope);I.type!==g.type?this._changes.updateSourceCache(z,"clear"):(this._changes.updateSourceCache(z,"reload"),w.pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map),g.scope=this.scope,this.mergeLayers()}moveLayer(t,a){this._checkLoaded();const u=this._checkLayer(t);if(!u||t===a)return;const p=this._order.indexOf(t);this._order.splice(p,1);let g=this._order.length;if(a){const v=this._order.indexOf(a);if(v===-1)return void this.fire(new r.z(new Error(`Layer with id "${a}" does not exist on this map.`)));u.slot===this._layers[a].slot?g=v:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(g,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const a=this._checkLayer(t);if(!a)return;a.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const p=this.getOwnLayerSourceCache(a);if(p&&p.castsShadows){let g=!1;for(const v in this._layers)if(this._layers[v].source===a.source&&this._layers[v].canCastShadows()){g=!0;break}p.castsShadows=g}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const a in this._layers)if(this._layers[a].type===t)return!0;return!1}setLayerZoomRange(t,a,u){this._checkLoaded();const p=this._checkLayer(t);p&&(p.minzoom===a&&p.maxzoom===u||(a!=null&&(p.minzoom=a),u!=null&&(p.maxzoom=u),this._updateLayer(p)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,a){this._checkLoaded();const u=this._checkLayer(t);u&&u.slot!==a&&(u.slot=a,this._updateLayer(u))}setFilter(t,a,u={}){this._checkLoaded();const p=this._checkLayer(t);if(p&&!r.bv(p.filter,a))return a==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(W,`layers.${p.id}.filter`,a,{layerType:p.type},u)||(p.filter=r.d7(a),this._updateLayer(p)))}getFilter(t){const a=this._checkLayer(t);if(a)return r.d7(a.filter)}setLayoutProperty(t,a,u,p={}){this._checkLoaded();const g=this._checkLayer(t);if(g&&!r.bv(g.getLayoutProperty(a),u)){if(u!=null&&(!p||p.validate!==!1)&&Ro(g,ye.call(Pa,{key:`layers.${t}.layout.${a}`,layerType:g.type,objectKey:a,value:u,styleSpec:r.a5,style:{glyphs:!0,sprite:!0}})))return;g.setLayoutProperty(a,u),g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),this._updateLayer(g)}}getLayoutProperty(t,a){const u=this._checkLayer(t);if(u)return u.getLayoutProperty(a)}setPaintProperty(t,a,u,p={}){this._checkLoaded();const g=this._checkLayer(t);if(!g||r.bv(g.getPaintProperty(a),u)||u!=null&&(!p||p.validate!==!1)&&Ro(g,ae.call(Pa,{key:`layers.${t}.paint.${a}`,layerType:g.type,objectKey:a,value:u,styleSpec:r.a5})))return;const v=g.setPaintProperty(a,u);g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),v&&this._updateLayer(g),this._changes.updatePaintProperties(g)}getPaintProperty(t,a){const u=this._checkLayer(t);if(u)return u.getPaintProperty(a)}setFeatureState(t,a){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:A,importId:I}=t.target,z=this.getFragmentStyle(I),k=z.getFeaturesetLayers(A);for(const{source:O,sourceLayer:j}of k)z.setFeatureState({id:t.id,source:O,sourceLayer:j},a)}else if("layerId"in t.target){const{layerId:A}=t.target,I=this.getLayer(A);this.setFeatureState({id:t.id,source:I.source,sourceLayer:I.sourceLayer},a)}return}const u=t.source,p=t.sourceLayer,g=this._checkSource(u);if(!g)return;const v=g.type;if(v==="geojson"&&p)return void this.fire(new r.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(v==="vector"&&!p)return void this.fire(new r.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new r.z(new Error("The feature id parameter must be provided.")));const w=this.getOwnSourceCaches(u);for(const A of w)A.setFeatureState(p,t.id,a)}removeFeatureState(t,a){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:A,importId:I}=t.target,z=this.getFragmentStyle(I),k=z.getFeaturesetLayers(A);for(const{source:O,sourceLayer:j}of k)z.removeFeatureState({id:t.id,source:O,sourceLayer:j},a)}else if("layerId"in t.target){const{layerId:A}=t.target,I=this.getLayer(A);this.removeFeatureState({id:t.id,source:I.source,sourceLayer:I.sourceLayer},a)}return}const u=t.source,p=this._checkSource(u);if(!p)return;const g=p.type,v=g==="vector"?t.sourceLayer:void 0;if(g==="vector"&&!v)return void this.fire(new r.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new r.z(new Error("A feature id is required to remove its specific state property.")));const w=this.getOwnSourceCaches(u);for(const A of w)A.removeFeatureState(v,t.id,a)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let g;if("featuresetId"in t.target){const{featuresetId:v,importId:w}=t.target,A=this.getFragmentStyle(w),I=A.getFeaturesetLayers(v);for(const{source:z,sourceLayer:k}of I){const O=A.getFeatureState({id:t.id,source:z,sourceLayer:k});if(O&&!g)g=O;else if(!r.bv(g,O))return void this.fire(new r.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:v}=t.target,w=this.getLayer(v);g=this.getFeatureState({id:t.id,source:w.source,sourceLayer:w.sourceLayer})}return g}const a=t.source,u=t.sourceLayer,p=this._checkSource(a);if(p){if(p.type!=="vector"||u)return t.id===void 0&&this.fire(new r.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(u,t.id);this.fire(new r.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=r.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return r.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),a=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return r.dd({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateFilteredLayers(t){for(const a of Object.values(this._mergedLayers))t(a)&&this._updateLayer(a)}_updateLayer(t){this._changes.updateLayer(t);const a=this.getLayerSourceCache(t),u=r.C(t.source,t.scope),p=this._changes.getUpdatedSourceCaches();t.source&&!p[u]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(u,"reload"),a.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const a=w=>this._mergedLayers[w].is3D(!!this.terrain),u=this.order,p={},g=[];for(let w=u.length-1;w>=0;w--){const A=u[w];if(a(A)){p[A]=w;for(const I of t){const z=I[A];if(z)for(const k of z)g.push(k)}}}g.sort((w,A)=>A.intersectionZ-w.intersectionZ);const v=[];for(let w=u.length-1;w>=0;w--){const A=u[w];if(a(A))for(let I=g.length-1;I>=0;I--){const z=g[I].feature;if(z.layer&&p[z.layer.id]<w)break;v.push(z),g.pop()}else for(const I of t){const z=I[A];if(z)for(const k of z)v.push(k.feature)}}return v}queryRenderedFeatures(t,a,u){let p;a&&!Array.isArray(a)&&a.filter&&(this._validate(W,"queryRenderedFeatures.filter",a.filter,null,a),p=r.b3(a.filter));const g={},v=z=>{if(nl.has(z.type))return;const k=this.getOwnLayerSourceCache(z),O=g[k.id]=g[k.id]||{sourceCache:k,layers:{},has3DLayers:!1};z.is3D(!!this.terrain)&&(O.has3DLayers=!0),O.layers[z.fqid]=O.layers[z.fqid]||{styleLayer:z,targets:[]},O.layers[z.fqid].targets.push({filter:p})};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new r.z(new Error("parameters.layers must be an Array."))),[];for(const z of a.layers){const k=this._layers[z];if(!k)return this.fire(new r.z(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];v(k)}}else for(const z in this._layers)v(this._layers[z]);const w=this._queryRenderedFeatures(t,g,u),A=this._flattenAndSortRenderedFeatures(w),I=[];for(const z of A)r.de(z.layer.id)===this.scope&&I.push(z);return I}queryRenderedFeatureset(t,a,u){let p;a&&!Array.isArray(a)&&a.filter&&(this._validate(W,"queryRenderedFeatures.filter",a.filter,null,a),p=r.b3(a.filter));const g="mock",v=[];if(a&&a.target)v.push(Object.assign({},a,{targetId:g,filter:p}));else{const z=this.getFeaturesetDescriptors();for(const k of z)v.push({targetId:g,filter:p,target:k});for(const{style:k}of this.fragments){const O=k.getFeaturesetDescriptors();for(const j of O)v.push({targetId:g,filter:p,target:j})}}const w=this.queryRenderedTargets(t,v,u),A=[],I=new Set;for(const z of w)for(const k of z.variants[g])ju(k,z,I)||A.push(new r.df(z,k));return A}queryRenderedTargets(t,a,u){const p={},g=(w,A,I,z)=>{const k=p[A.id]=p[A.id]||{sourceCache:A,layers:{},has3DLayers:!1};if(k.layers[w.fqid]=k.layers[w.fqid]||{styleLayer:w,targets:[]},w.is3D(!!this.terrain)&&(k.has3DLayers=!0),!z)return I.uniqueFeatureID=!1,void k.layers[w.fqid].targets.push(I);k.layers[w.fqid].targets.push(Object.assign({},I,{namespace:z.namespace,properties:z.properties,uniqueFeatureID:z.uniqueFeatureID}))};for(const w of a)if("featuresetId"in w.target){const{featuresetId:A,importId:I}=w.target,z=this.getFragmentStyle(I);if(!z||!z._featuresetSelectors)continue;const k=z._featuresetSelectors[A];if(!k){this.fire(new r.z(new Error(`The featureset '${A}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const O of k){const j=z.getOwnLayer(O.layerId);j&&!nl.has(j.type)&&g(j,z.getOwnLayerSourceCache(j),w,O)}}else if("layerId"in w.target){const{layerId:A}=w.target,I=this.getLayer(A);if(!I||nl.has(I.type))continue;g(I,this.getLayerSourceCache(I),w)}const v=this._queryRenderedFeatures(t,p,u);return this._flattenAndSortRenderedFeatures(v)}_queryRenderedFeatures(t,a,u){const p=[],g=!!this.map._showQueryGeometry,v=Er.createFromScreenPoints(t,u);for(const w in a){const A=Js(v,a[w],this._availableImages,u,g);Object.keys(A).length&&p.push(A)}if(this.placement)for(const w in a){if(!a[w].sourceCache._onlySymbols)continue;const A=Oh(v.screenGeometry,a[w],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(A).length&&p.push(A)}return p}querySourceFeatures(t,a){const u=a&&a.filter;u&&this._validate(W,"querySourceFeatures.filter",u,null,a);let p=[];const g=this.getOwnSourceCaches(t);for(const v of g)p=p.concat(So(v,a));return p}addSourceType(t,a,u){return Zo.getSourceType(t)?u(new Error(`A source type called "${t}" already exists.`)):(Zo.setSourceType(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},u):u(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,a,u={}){this._checkLoaded();const p=this.light.getLight();let g=!1;for(const w in t)if(!r.bv(t[w],p[w])){g=!0;break}if(!g)return;const v=this._getTransitionParameters();this.light.setLight(t,a,u),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,a=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let u=t;const p=t.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof u.source=="object"){const w="terrain-dem-src";this.addSource(w,u.source),u=r.d7(u),u=r.l(u,{source:w})}const g=r.l({},u),v={};if(this.terrain&&p){g.source=this.terrain.get().source;const w=this.terrain?this.getFragmentStyle(this.terrain.scope):null;w&&(v.style=w.serialize())}if(this._validate(Bt,"terrain",g,v))return}if(!this.terrain||this.terrain.scope!==this.scope&&!p||this.terrain&&a!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,a),this.fire(new r.A("data",{dataType:"style"}))}else{const g=this.terrain,v=g.get();for(const w of Object.keys(r.a5.terrain))!u.hasOwnProperty(w)&&r.a5.terrain[w].default&&(u[w]=r.a5.terrain[w].default);for(const w in t)if(!r.bv(t[w],v[w])){g.set(t,this.options),this.stylesheet.terrain=t;const A=this._getTransitionParameters({duration:0});g.updateTransitions(A),this.fire(new r.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const a=this.fog=new Gi(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const u=this._getTransitionParameters({duration:0});a.updateTransitions(u)}_createSnow(t){const a=this.snow=new Dn(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=a.get();const u=this._getTransitionParameters({duration:0});a.updateTransitions(u)}_createRain(t){const a=this.rain=new Gn(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=a.get();const u=this._getTransitionParameters({duration:0});a.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!r.bv(a.get(),t)){a.set(t,this.options),this.stylesheet.fog=a.get();const u=this._getTransitionParameters({duration:0});a.updateTransitions(u)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const a=this.snow;if(!r.bv(a.get(),t)){a.set(t,this.options),this.stylesheet.snow=a.get();const u=this._getTransitionParameters({duration:0});a.updateTransitions(u)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const a=this.rain;if(!r.bv(a.get(),t)){a.set(t,this.options),this.stylesheet.rain=a.get();const u=this._getTransitionParameters({duration:0});a.updateTransitions(u)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const p in this._layers)this._layers[p].lut=this._styleColorTheme.lut;for(const p in this._sourceCaches)this._sourceCaches[p].clearTiles()},a=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!a)return this._styleColorTheme.lut=null,void t();const u=this._evaluateColorThemeData(a);this._loadColorTheme(u).then(()=>{this.fire(new r.A("colorthemeset")),t()}).catch(p=>{r.w(`Couldn't set color theme: ${p}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,a){const u=this.getFragmentStyle(t);u&&(u._styleColorTheme.colorThemeOverride=a,u._reloadColorTheme())}_getTransitionParameters(t){return{now:r.q.now(),transition:r.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],a=[];for(const u of this._mergedOrder)this.isLayerDraped(this._mergedLayers[u])?t.push(u):a.push(u);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...a)}_createTerrain(t,a){const u=this.terrain=new Ye(t,a,this.scope,this.options);a===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}_force3DLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="symbol"&&this._updateLayer(a)}}_validate(t,a,u,p,g={}){if(g&&g.validate===!1)return!1;const v=r.l({},this.serialize());return Ro(this,t.call(Pa,r.l({key:a,style:v,value:u,styleSpec:r.a5},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.dg.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const a=this.getSourceCaches(t);for(const u of a)u.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const a=this.getSourceCaches(t);for(const u of a)u.resume(),u.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let a;this.directionalLight&&(a=rf(this.directionalLight));const u=new Set;for(const p in this._mergedLayers){const g=this._mergedLayers[p];g.hasElevation()&&!u.has(g.source)&&u.add(g.source)}for(const p in this._mergedSourceCaches){const g=this._mergedSourceCaches[p],v=u.has(g._source.id);g.update(t,void 0,void 0,a,v)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const a=this._sourceCaches[t];a.resume(),a.reload()}}_updatePlacement(t,a,u,p,g,v,w=!1){let A=!1,I=!1;const z={},k={};for(const O of this._mergedOrder){const j=this._mergedLayers[O];if(j.type!=="symbol")continue;const Q=r.C(j.source,j.scope);let Y=z[Q];if(!Y){const K=this.getLayerSourceCache(j);if(!K)continue;const se=K.getRenderableIds(!0).map(pe=>K.getTileByID(pe));k[Q]=se.slice(),Y=z[Q]=se.sort((pe,ve)=>ve.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(ve.tileID)?-1:1))}const ee=this.crossTileSymbolIndex.addLayer(j,Y,a.center.lng,a.projection);A=A||ee}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),w=w||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new r.A("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.q.now(),a.zoom))&&(this.pauseablePlacement=new La(a,this._mergedOrder,w,u,p,g,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,z,k,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.q.now()),I=!0),A&&this.pauseablePlacement.placement.setStale()),I||A){this._buildingIndex.onNewFrame(a.zoom);for(let O=0;O<this._mergedOrder.length;O++){const j=this._mergedLayers[this._mergedOrder[O]];if(j.type!=="symbol")continue;const Q=this.isLayerClipped(j);this.placement.updateLayerOpacities(j,z[r.C(j.source,j.scope)],O,Q?v:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,a){this._checkLoaded();const u=this.stylesheet.imports=this.stylesheet.imports||[];if(u.findIndex(({id:g})=>g===t.id)!==-1)return void this.fire(new r.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!a)return u.push(t),this._loadImports([t],!0);const p=u.findIndex(({id:g})=>g===a);return p===-1&&this.fire(new r.z(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=u.slice(0,p).concat(t).concat(u.slice(p)),this._loadImports([t],!0,a)}updateImport(t,a){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);return p===-1?this:typeof a=="string"?(this.setImportUrl(t,a),this):(a.url&&a.url!==u[p].url&&this.setImportUrl(t,a.url),r.bv(a.config,u[p].config)||this.setImportConfig(t,a.config,a.data.schema),r.bv(a.data,u[p].data)||this.setImportData(t,a.data),this)}moveImport(t,a){this._checkLoaded();let u=this.stylesheet.imports||[];const p=this.getImportIndex(t);if(p===-1)return this;const g=this.getImportIndex(a);if(g===-1)return this;const v=u[p],w=this.fragments[p];return u=u.filter(({id:A})=>A!==t),this.fragments=this.fragments.filter(({id:A})=>A!==t),this.stylesheet.imports=u.slice(0,g).concat(v).concat(u.slice(g)),this.fragments=this.fragments.slice(0,g).concat(w).concat(this.fragments.slice(g)),this.mergeLayers(),this}setImportUrl(t,a){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);if(p===-1)return this;u[p].url=a;const g=this.fragments[p];return g.style=this._createFragmentStyle(u[p]),g.style.on("style.import.load",()=>this.mergeAll()),g.style.loadURL(a),this}setImportData(t,a){this._checkLoaded();const u=this.getImportIndex(t),p=this.stylesheet.imports||[];return u===-1?this:a?(this.fragments[u].style.setState(a),this._reloadImports(),this):(delete p[u].data,this.setImportUrl(t,p[u].url))}setImportConfig(t,a,u){this._checkLoaded();const p=this.getImportIndex(t),g=this.stylesheet.imports||[];if(p===-1)return this;a?g[p].config=a:delete g[p].config;const v=this.fragments[p];u&&v.style.stylesheet&&(v.style.stylesheet.schema=u);const w=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=a,v.style.updateConfig(a,w),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const a=this.stylesheet.imports||[],u=this.getImportIndex(t);u!==-1&&(a.splice(u,1),this.fragments[u].style._remove(),this.fragments.splice(u,1),this._reloadImports())}getImportIndex(t){const a=(this.stylesheet.imports||[]).findIndex(u=>u.id===t);return a===-1&&this.fire(new r.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),a}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const a in this._mergedOtherSourceCaches){const u=this._mergedOtherSourceCaches[a];u&&t.push(u.getSource())}return t}getSource(t,a){const u=this.getSourceCache(t,a);return u&&u.getSource()}getLayerSource(t){const a=this.getLayerSourceCache(t);return a&&a.getSource()}getSourceCache(t,a){const u=r.C(t,a);return this._mergedOtherSourceCaches[u]}getLayerSourceCache(t){const a=r.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const a=[];return this._mergedOtherSourceCaches[t]&&a.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&a.push(this._mergedSymbolSourceCaches[t]),a}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const a in t){const u=t[a];u==="reload"?this.reloadSource(a):u==="clear"&&this.clearSource(a)}}updateLayers(t){const a=this._changes.getUpdatedPaintProperties();for(const u of a){const p=this.getLayer(u);p&&p.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,a,u){this.imageManager.getImages(a.images,a.scope,u),this._updateTilesForChangedImages();const p=v=>{if(v){const w=a.images.map(A=>r.I.toString(A));v.setDependencies(a.tileID.key,a.type,w)}},g=r.C(a.source,a.scope);p(this._mergedOtherSourceCaches[g]),p(this._mergedSymbolSourceCaches[g])}rasterizeImages(t,a,u){this.imageManager.rasterizeImages(a,u)}getGlyphs(t,a,u){this.glyphManager.getGlyphs(a.stacks,a.scope,u)}getResource(t,a,u){return r.dh(a,u)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const a=[];return this._otherSourceCaches[t]&&a.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&a.push(this._symbolSourceCaches[t]),a}_isSourceCacheLoaded(t){const a=this.getOwnSourceCaches(t);return a.length===0?(this.fire(new r.z(new Error(`There is no source with ID '${t}'`))),!1):a.every(u=>u.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,a){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const u=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D(!!this.terrain)){if(u||a&&a.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Zo.getSourceType=function(c){return Bu[c]},Zo.setSourceType=function(c,t){Bu[c]=t},Zo.registerForPluginStateChange=r.c$;var Wc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Xu=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,fp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,cf="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Io=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Yh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ut=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Xo=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Kh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,oo=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Do=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const us=[];Kc(Wc,us),Kc(fp,us),Kc(Xu,us);const zo={"_prelude_fog.vertex.glsl":Yh,"_prelude_terrain.vertex.glsl":Io,"_prelude_shadow.vertex.glsl":oo,"_prelude_fog.fragment.glsl":Ut,"_prelude_shadow.fragment.glsl":Do,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Xo,"_prelude_raster_particle.glsl":Kh},xl={};cn("",Io),cn(Ut,Yh),cn(Do,oo),cn(Xo,""),cn(Kh,"");const Ls=cn(Xu,fp),Yc=Wc;var hs={background:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);color*=u_opacity;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=vec4(linearTosRGB(color.rgb),color.a);
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:cn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:cn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:cn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:cn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:cn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:cn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:cn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:cn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:cn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:cn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:cn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:cn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:cn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:cn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:cn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:cn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:cn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(abs(v_z_offset) > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:cn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:cn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,cf),skyboxGradient:cn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,cf),skyboxCapture:cn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:cn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:cn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:cn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:cn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:cn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:cn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:cn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:cn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Kc(c,t){const a=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of a)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const p=u.split(" ");for(const g of p)t.includes(g)||t.push(g)}}function cn(c,t){const a=/#include\s+"([^"]+)"/g,u=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let p=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);p&&(p=p.map(I=>{const z=I.split(" ");return z[z.length-1]}),p=[...new Set(p)]);const g={},v=[],w=[];if(c=c.replace(a,(I,z)=>(w.push(z),"")),(t=t.replace(a,(I,z)=>(v.push(z),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let A=[...us];Kc(c,A),Kc(t,A);for(const I of[...v,...w])zo[I]||console.error(`Undefined include: ${I}`),xl[I]||(xl[I]=[],Kc(zo[I],xl[I])),A=[...A,...xl[I]];return{fragmentSource:c=c.replace(u,(I,z,k,O,j)=>(g[j]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${j}
in ${k} ${O} ${j};
#else
uniform ${k} ${O} u_${j};
#endif
`:z==="initialize"?`
#ifdef HAS_UNIFORM_u_${j}
    ${k} ${O} ${j} = u_${j};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${k} ${O} ${j};
#endif
`:z==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(u,(I,z,k,O,j)=>{const Q=O==="float"?"vec2":O,Y=j.match(/color/)?"color":Q;return z==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${j}
in ${k} ${O} a_${j};
#endif
`:g[j]?z==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${k} ${Q} a_${j};
out ${k} ${O} ${j};
#else
uniform ${k} ${O} u_${j};
#endif
`:z==="initialize"?Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${k} ${O} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${Y}(a_${j}, u_${j}_t);
#else
    ${k} ${O} ${j} = u_${j};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${k} ${O} a_${j};
    out ${k} ${O} ${j};
#endif
`:z==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${j} = a_${j};
#endif
`:void 0:z==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${k} ${Q} a_${j};
#else
uniform ${k} ${O} u_${j};
#endif
`:z==="define-instanced"?Y==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${j}0;
in vec4 a_${j}1;
in vec4 a_${j}2;
in vec4 a_${j}3;
#else
uniform ${k} ${O} u_${j};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${k} ${Q} a_${j};
#else
uniform ${k} ${O} u_${j};
#endif
`:z==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${k} ${O} ${j} = a_${j};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${k} ${O} ${j} = a_${j};
#else
    ${k} ${O} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${k} ${O} ${j} = unpack_mix_${Y}(a_${j}, u_${j}_t);
#else
    ${k} ${O} ${j} = u_${j};
#endif
`}),staticAttributes:p,usedDefines:A,vertexIncludes:v,fragmentIncludes:w}}class Jl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,a,u,p,g,v,w,A){this.context=t;let I=this.boundPaintVertexBuffers.length!==p.length;for(let k=0;!I&&k<p.length;k++)this.boundPaintVertexBuffers[k]!==p[k]&&(I=!0);let z=this.boundDynamicVertexBuffers.length!==w.length;for(let k=0;!z&&k<w.length;k++)this.boundDynamicVertexBuffers[k]!==w[k]&&(z=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==u||I||z||this.boundIndexBuffer!==g||this.boundVertexOffset!==v)this.freshBind(a,u,p,g,v,w,A);else{t.bindVertexArrayOES.set(this.vao);for(const k of w)k&&(k.bind(),A&&k.instanceCount&&k.setVertexAttribDivisor(t.gl,a,A));g&&g.dynamicDraw&&g.bind()}}freshBind(t,a,u,p,g,v,w){const A=t.numAttributes,I=this.context,z=I.gl;this.vao&&this.destroy(),this.vao=I.gl.createVertexArray(),I.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=g,this.boundDynamicVertexBuffers=v,a.enableAttributes(z,t),a.bind(),a.setVertexAttribPointers(z,t,g);for(const k of u)k.enableAttributes(z,t),k.bind(),k.setVertexAttribPointers(z,t,g);for(const k of v)k&&(k.enableAttributes(z,t),k.bind(),k.setVertexAttribPointers(z,t,g),w&&k.instanceCount&&k.setVertexAttribDivisor(z,t,w));p&&p.bind(),I.currentNumAttributes=A}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function r_(c,t){const a=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new r.ac(0,u/a).toLngLat().lat,new r.ac(0,(u+1)/a).toLngLat().lat]}function Po(c,t,a,u,p,g,v){const w=c.context,A=w.gl,I=a.hillshadeFBO;if(!I)return;c.prepareDrawTile();const z=c.isTileAffectedByFog(t),k=c.getOrCreateProgram("hillshade",{overrideFog:z});w.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,I.colorAttachment.get());const O=((ee,K,se,pe)=>{const ve=se.paint.get("hillshade-shadow-color"),Ae=se.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Se=se.paint.get("hillshade-highlight-color"),Te=se.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ge=se.paint.get("hillshade-accent-color"),Ce=se.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Le=se.paint.get("hillshade-emissive-strength");let Qe=r.al(se.paint.get("hillshade-illumination-direction"));if(se.paint.get("hillshade-illumination-anchor")==="viewport")Qe-=ee.transform.angle;else if(ee.style&&ee.style.enable3dLights()&&ee.style.directionalLight){const ht=ee.style.directionalLight.properties.get("direction"),lt=r.cR(ht.x,ht.y,ht.z);Qe=r.al(lt[1])}const Ze=!ee.options.moving;return{u_matrix:pe||ee.transform.calculateProjMatrix(K.tileID.toUnwrapped(),Ze),u_image:0,u_latrange:r_(0,K.tileID),u_light:[se.paint.get("hillshade-exaggeration"),Qe],u_shadow:ve.toRenderColor(Ae?null:se.lut),u_highlight:Se.toRenderColor(Te?null:se.lut),u_emissive_strength:Le,u_accent:ge.toRenderColor(Ce?null:se.lut)}})(c,a,u,c.terrain?t.projMatrix:null);c.uploadCommonUniforms(w,k,t.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:Q,tileBoundsSegments:Y}=c.getTileBoundsBuffers(a);k.draw(c,A.TRIANGLES,p,g,v,Li.disabled,O,u.id,j,Q,Y)}function Qh(c,t,a){if(!t.needsDEMTextureUpload)return;const u=c.context,p=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||c.getTileTexture(a.stride);const g=a.getPixels();t.demTexture?t.demTexture.update(g,{premultiply:!1}):t.demTexture=new r.T(u,g,p.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Os(c,t,a){const u=c.context,p=u.gl;if(!t.dem)return;const g=t.dem;if(u.activeTexture.set(p.TEXTURE1),Qh(c,t,g),!t.demTexture)return;t.demTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE);const v=g.dim;u.activeTexture.set(p.TEXTURE0);let w=t.hillshadeFBO;if(!w){const O=new r.T(u,{width:v,height:v,data:null},p.RGBA8);O.bind(p.LINEAR,p.CLAMP_TO_EDGE),w=t.hillshadeFBO=u.createFramebuffer(v,v,!0,"renderbuffer"),w.colorAttachment.set(O.texture)}u.bindFramebuffer.set(w.framebuffer),u.viewport.set([0,0,v,v]);const{tileBoundsBuffer:A,tileBoundsIndexBuffer:I,tileBoundsSegments:z}=c.getMercatorTileBoundsBuffers(),k=[];c.linearFloatFilteringSupported()&&k.push("TERRAIN_DEM_FLOAT_FORMAT"),c.getOrCreateProgram("hillshadePrepare",{defines:k}).draw(c,p.TRIANGLES,ei.disabled,Di.disabled,Zi.unblended,Li.disabled,((O,j)=>{const Q=j.stride,Y=r.bz();return r.c5(Y,0,r.aj,-r.aj,0,0,1),r.bo(Y,Y,[0,-r.aj,0]),{u_matrix:Y,u_image:1,u_dimension:[Q,Q],u_zoom:O.overscaledZ}})(t.tileID,g),a.id,A,I,z),t.needsHillshadePrepare=!1}class br{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class uf extends br{getDefault(){return r.am.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Qc extends br{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class pp extends br{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class hf extends br{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Wu extends br{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class bl extends br{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class df extends br{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Jh extends br{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Lo extends br{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class so extends br{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class wl extends br{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class lo extends br{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ks extends br{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class ec extends br{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Jc extends br{getDefault(){return r.am.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class eu extends br{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Yu extends br{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class Aa extends br{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Fr extends br{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let _r=class extends br{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}};class Tl extends br{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Ns extends br{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ed extends br{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class rl extends br{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ku extends br{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class mp extends br{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Qu extends br{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ju extends br{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class tu extends br{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class eh extends br{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class gp extends br{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Sl extends br{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class El extends Sl{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Bs extends Sl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Fs extends Sl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class td extends Bs{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const id=(c,t,a)=>({u_matrix:c,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:a}),iu=(c,t,a,u,p,g,v,w,A,I,z,k,O,j,Q,Y)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:a,u_zoom_transition:p,u_merc_center:g,u_image0:0,u_frustum_tl:v,u_frustum_tr:w,u_frustum_br:A,u_frustum_bl:I,u_globe_pos:z,u_globe_radius:k,u_viewport:O,u_grid_matrix:Y?Float32Array.from(Y):new Float32Array(9),u_skirt_height:j,u_far_z_cutoff:Q});function th(c,t){return c!=null&&t!=null&&!(!c.hasData()||!t.hasData())&&c.demTexture!=null&&t.demTexture!=null&&c.tileID.key!==t.tileID.key}const ds=new class{constructor(){this.operations={}}newMorphing(c,t,a,u,p){if(c in this.operations){const g=this.operations[c];g.to.tileID.key!==a.tileID.key&&(g.queued=a)}else this.operations[c]={startTime:u,phase:0,duration:p,from:t,to:a,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const t=this.operations[c];return{from:t.from,to:t.to,phase:t.phase}}update(c){for(const t in this.operations){const a=this.operations[t];for(a.phase=(c-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,c)){delete this.operations[t];break}}}_nextOp(c,t){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=t,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},da={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Al(c,t,a){if(t===0)return 0;const u=t<1&&a===514?.25/t:1;return 6*Math.pow(1.5,22-c)*Math.max(t,1)*u}function _p(c,t){const a=1<<c.z;return!t&&(c.x===0||c.x===a-1)||c.y===0||c.y===a-1}const co=c=>({u_matrix:c});function nd(c,t,a,u,p){if(p>0){const g=r.q.now(),v=(g-c.timeAdded)/p,w=t?(g-t.timeAdded)/p:-1,A=a.getSource(),I=u.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),z=!t||Math.abs(t.tileID.overscaledZ-I)>Math.abs(c.tileID.overscaledZ-I),k=z&&c.refreshedUponExpiration?1:r.aD(z?v:1-w,0,1);return c.refreshedUponExpiration&&v>=1&&(c.refreshedUponExpiration=!1),t?{opacity:1,mix:1-k}:{opacity:k,mix:0}}return{opacity:1,mix:0}}class ff extends Sa{constructor(t){const a={type:"raster-dem",maxzoom:t.transform.maxZoom},u=new r.D(r.d0(),null),p=Fu("mock-dem",a,u,t.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,a){t.state="loaded",a(null)}}class ca extends Sa{constructor(t){const a=Fu("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new r.D(r.d0(),null),t.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,a,u){if(t.freezeTileCoverage)return;this.transform=t;const p=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((g,v)=>{if(g[v.key]="",!this._tiles[v.key]){const w=new Cs(v,this._source.tileSize*v.overscaleFactor(),t.tileZoom);w.state="loaded",this._tiles[v.key]=w}return g},{});for(const g in this._tiles)g in p||(this.freeFBO(g),this._tiles[g].unloadVectorData(),delete this._tiles[g])}freeFBO(t){const a=this.proxyCachedFBO[t];if(a!==void 0){const u=Object.values(a);this.renderCachePool.push(...u),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ih extends r.aM{constructor(t,a,u){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=a,this.projMatrix=u}}class tc extends r.dt{constructor(t,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,p,g]=function(A){const I=new r.ba,z=new r.a_,k=131;I.reserve(17161),z.reserve(33800);const O=r.aj/128,j=r.aj+O/2,Q=j+O;for(let ee=-O;ee<Q;ee+=O)for(let K=-O;K<Q;K+=O){const se=K<0||K>j||ee<0||ee>j?24575:0,pe=r.aD(Math.round(K),0,r.aj),ve=r.aD(Math.round(ee),0,r.aj);I.emplaceBack(pe+se,ve)}const Y=(ee,K)=>{const se=K*k+ee;z.emplaceBack(se+1,se,se+k),z.emplaceBack(se+k,se+k+1,se+1)};for(let ee=1;ee<129;ee++)for(let K=1;K<129;K++)Y(K,ee);return[0,129].forEach(ee=>{for(let K=0;K<130;K++)Y(K,ee),Y(ee,K)}),[I,z,32768]}(),v=t.context;this.gridBuffer=v.createVertexBuffer(u,r.bc.members),this.gridIndexBuffer=v.createIndexBuffer(p),this.gridSegments=r.bd.simpleSegment(0,0,u.length,p.length),this.gridNoSkirtSegments=r.bd.simpleSegment(0,0,u.length,g),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ca(a.map),this.orthoMatrix=r.bz(),r.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.aj,0,r.aj,0,1);const w=v.gl;this._overlapStencilMode=new Di({func:w.GEQUAL,mask:255},0,255,w.KEEP,w.KEEP,w.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ff(a.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,a,u){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const p=t.terrain.properties,g=t.terrain.drapeRenderMode===0,v=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.q.now();const w=t.terrain&&t.terrain.scope,A=p.get("source"),I=g?this._mockSourceCache:t.getSourceCache(A,w);if(!I)return void r.w(`Couldn't find terrain source "${A}".`);if(this.sourceCache=I,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=v?this.calculateExaggeration(a):p.get("exaggeration"),!a.projection.requiresDraping&&v&&this._exaggeration===0)return void this._disable();this.enabled=!0;const z=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const k=this.getScaledDemTileSize();this.sourceCache.update(a,k,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,z(),this._initializing=!0),z(),a.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const a=this._previousCameraAltitude,u=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=u;const p=a!=null?u-a:Number.MAX_VALUE;if(Math.abs(p)<2)return this._exaggeration;const g=t.zoom,v=this._style.terrain;if(!this._previousUpdateTimestamp)return v.getExaggeration(g);let w=g-this._previousZoom;const A=this._previousUpdateTimestamp;let I=g;this._evaluationZoom!=null&&(I=this._evaluationZoom,Math.abs(g-I)>.5&&(w=.5*(g-I+w)),w*p<0&&(I+=w)),this._evaluationZoom=I;const z=v.getExaggeration(I),k=z===v.getExaggeration(Math.max(0,I-.1));if(k&&Math.abs(z-this._exaggeration)<.01)return z;let O=Math.min(.1,.00375*(this._updateTimestamp-A));return(k||z<.1||Math.abs(w)<1e-4)&&(O=Math.min(.2,4*O)),r.ai(this._exaggeration,z,O)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(r.ac.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.proxyCoords=a.getIds().map(A=>{const I=a.getTileByID(A).tileID;return I.projMatrix=u.calculateProjMatrix(I.toUnwrapped()),I});(function(A,I){const z=I.transform.pointCoordinate(I.transform.getCameraPoint()),k=new r.P(z.x,z.y);A.sort((O,j)=>{if(j.overscaledZ-O.overscaledZ)return j.overscaledZ-O.overscaledZ;const Q=new r.P(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),Y=new r.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),ee=k.mult(1<<O.canonical.z);return ee.x-=.5,ee.y-=.5,ee.distSqr(Q)-ee.distSqr(Y)})})(p,this.painter);const g=this.proxyToSource||{};this.proxyToSource={},p.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const v=this._style._mergedSourceCaches;for(const A in v){const I=v[A];if(!I.used||(I!==this.sourceCache&&this.resetTileLookupCache(I.id),this._setupProxiedCoordsForOrtho(I,t[A],g),I.usedForTerrain))continue;const z=t[A];I.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[a.id]=p.map(A=>new ih(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(g),this.renderingToTexture=!1;const w={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const I=this.terrainTileForTile[A.key];if(!I)continue;const z=I.tileID.key;z in w||(this._visibleDemTiles.push(I),w[z]=z)}}_assignTerrainTiles(t){this._initializing||t.forEach(a=>{if(this.terrainTileForTile[a.key])return;const u=this._findTileCoveringTileID(a,this.sourceCache);u&&(this.terrainTileForTile[a.key]=u)})}_prepareDEMTextures(){const t=this.painter.context,a=t.gl;for(const u in this.terrainTileForTile){const p=this.terrainTileForTile[u],g=p.dem;!g||p.demTexture&&!p.needsDEMTextureUpload||(t.activeTexture.set(a.TEXTURE1),Qh(this.painter,p,g))}}_prepareDemTileUniforms(t,a,u,p){if(!a||a.demTexture==null)return!1;const g=t.tileID.canonical,v=Math.pow(2,a.tileID.canonical.z-g.z),w=p||"";return u[`u_dem_tl${w}`]=[g.x*v%1,g.y*v%1],u[`u_dem_scale${w}`]=v,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const a=this._visibleDemTiles.reduce((u,p)=>{if(!p.dem)return u;const g=p.dem.tree.minimums[0];return g>0&&t++,u+g},0);return t?a/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,a=t.gl;t.activeTexture.set(a.TEXTURE2);const u=this._getLoadedAreaMinimum(),p=new r.du({width:1,height:1},new Float32Array([u]));this._emptyDEMTextureDirty=!1;let g=this._emptyDEMTexture;return g?g.update(p,{premultiply:!1}):g=this._emptyDEMTexture=new r.T(t,p,a.R32F,{premultiply:!1}),g}setupElevationDraw(t,a,u){const p=this.painter.context,g=p.gl,v={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};v.u_exaggeration=this.exaggeration();let w=null,A=null,I=1;if(u&&u.morphing&&this._useVertexMorphing){const j=u.morphing.srcDemTile,Q=u.morphing.dstDemTile;I=u.morphing.phase,j&&Q&&(this._prepareDemTileUniforms(t,j,v,"_prev")&&(A=j),this._prepareDemTileUniforms(t,Q,v)&&(w=Q))}const z=j=>j&&j.demTexture&&this.painter.linearFloatFilteringSupported()?g.LINEAR:g.NEAREST;let k=null;var O;if(this.enabled?A&&w?(k=w.demTexture,p.activeTexture.set(g.TEXTURE4),A.demTexture.bind(z(A),g.CLAMP_TO_EDGE),v.u_dem_lerp=I):(w=this.terrainTileForTile[t.tileID.key],k=this._prepareDemTileUniforms(t,w,v)?w.demTexture:this.emptyDEMTexture):k=this.emptyDEMTexture,p.activeTexture.set(g.TEXTURE2),k&&(v.u_dem_size=(O=k).size[0]===1?1:O.size[0]-2,k.bind(z(w),g.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(u&&u.useDepthForOcclusion,a,v),u&&u.useMeterToDem&&w){const j=(1<<w.tileID.canonical.z)*r.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;v.u_meter_to_dem=j}if(u&&u.labelPlaneMatrixInv&&(v.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),a.setTerrainUniformValues(p,v),this.painter.transform.projection.name==="globe"){const j=this.globeUniformValues(this.painter.transform,t.tileID.canonical,u&&u.useDenormalizedUpVectorScale);a.setGlobeUniformValues(p,j)}}globeUniformValues(t,a,u){const p=t.projection;return{u_tile_tl_up:p.upVector(a,0,0),u_tile_tr_up:p.upVector(a,r.aj,0),u_tile_br_up:p.upVector(a,r.aj,r.aj),u_tile_bl_up:p.upVector(a,0,r.aj),u_tile_up_scale:u?r.dv(1):p.upVectorScale(a,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const a=this.painter,u=this.painter.context;t.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(p,g,v,w,A){if(p.transform.projection.name==="globe")(function(I,z,k,O,j){const Q=I.context,Y=Q.gl;let ee,K;const se=I.transform,pe=r.dl(I,Q,se),ve=(ht,lt)=>{if(K===lt)return;const Ct=[da[lt],"PROJECTION_GLOBE_VIEW"];pe&&Ct.push("CUSTOM_ANTIALIASING");const $e=I.isTileAffectedByFog(ht);ee=I.getOrCreateProgram("globeRaster",{defines:Ct,overrideFog:$e}),K=lt},Ae=I.colorModeForRenderPass(),Se=new ei(Y.LEQUAL,ei.ReadWrite,I.depthRangeFor3D);ds.update(j);const Te=r.dm(se),ge=[r.ay(se.center.lng),r.aH(se.center.lat)],Ce=I.globeSharedBuffers,Le=[se.width*r.q.devicePixelRatio,se.height*r.q.devicePixelRatio],Qe=Float32Array.from(se.globeMatrix),Ze={useDenormalizedUpVectorScale:!0};{const ht=I.transform,lt=Al(ht.zoom,z.exaggeration(),z.sourceCache._source.tileSize);K=-1;const Ct=Y.TRIANGLES;for(const $e of O){const et=k.getTile($e),Ge=Di.disabled,pt=z.prevTerrainTileForTile[$e.key],tt=z.terrainTileForTile[$e.key];th(pt,tt)&&ds.newMorphing($e.key,pt,tt,j,250),Q.activeTexture.set(Y.TEXTURE0),et.texture&&et.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const bt=ds.getMorphValuesForProxy($e.key),dt=bt?1:0;bt&&r.L(Ze,{morphing:{srcDemTile:bt.from,dstDemTile:bt.to,phase:r.dk(bt.phase)}});const wt=r.dn($e.canonical),At=r.dp(wt.getCenter().lat),Qt=r.dq($e.canonical,wt,At,ht.worldSize/ht._pixelsPerMercatorPixel),ai=r.bh(r.dr($e.canonical)),Yt=iu(ht.expandedFarZProjMatrix,Qe,Te,ai,r.ah(ht.zoom),ge,ht.frustumCorners.TL,ht.frustumCorners.TR,ht.frustumCorners.BR,ht.frustumCorners.BL,ht.globeCenterInViewSpace,ht.globeRadius,Le,lt,ht._farZ,Qt);if(ve($e,dt),ee&&(z.setupElevationDraw(et,ee,Ze),I.uploadCommonUniforms(Q,ee,$e.toUnwrapped()),Ce)){const[ci,ii,Mi]=Ce.getGridBuffers(At,lt!==0);ee.draw(I,Ct,Se,Ge,Ae,Li.backCCW,Yt,"globe_raster",ci,ii,Mi)}}}if(Ce&&(I.renderDefaultNorthPole||I.renderDefaultSouthPole)){const ht=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pe&&ht.push("CUSTOM_ANTIALIASING"),ee=I.getOrCreateProgram("globeRaster",{defines:ht});for(const lt of O){const{x:Ct,y:$e,z:et}=lt.canonical,Ge=$e===0,pt=$e===(1<<et)-1,[tt,bt,dt,wt]=Ce.getPoleBuffers(et,!1);if(wt&&(Ge||pt)){const At=k.getTile(lt);Q.activeTexture.set(Y.TEXTURE0),At.texture&&At.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let Qt=r.ds(et,Ct,se);const ai=r.bh(r.dr(lt.canonical)),Yt=(ci,ii)=>ci.draw(I,Y.TRIANGLES,Se,Di.disabled,Ae,Li.disabled,iu(se.expandedFarZProjMatrix,Qt,Qt,ai,0,ge,se.frustumCorners.TL,se.frustumCorners.TR,se.frustumCorners.BR,se.frustumCorners.BL,se.globeCenterInViewSpace,se.globeRadius,Le,0,se._farZ),"globe_pole_raster",ii,dt,wt);z.setupElevationDraw(At,ee,Ze),I.uploadCommonUniforms(Q,ee,lt.toUnwrapped()),Ge&&I.renderDefaultNorthPole&&Yt(ee,tt),pt&&I.renderDefaultSouthPole&&(Qt=r.cE(r.bz(),Qt,[1,-1,1]),Yt(ee,bt))}}}})(p,g,v,w,A);else{const I=p.context,z=I.gl;let k,O;const j=p.shadowRenderer,Q=$c(p,p.longestCutoffRange),Y=Ae=>{if(O===Ae)return;const Se=[];Se.push(da[Ae]),Q.shouldRenderCutoff&&Se.push("RENDER_CUTOFF"),j&&(Se.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&Se.push("NORMAL_OFFSET")),k=p.getOrCreateProgram("terrainRaster",{defines:Se}),O=Ae},ee=p.colorModeForRenderPass(),K=new ei(z.LEQUAL,ei.ReadWrite,p.depthRangeFor3D);ds.update(A);const se=p.transform,pe=Al(se.zoom,g.exaggeration(),g.sourceCache._source.tileSize);let ve=[0,0,0];if(j){const Ae=p.style.directionalLight,Se=p.style.ambientLight;Ae&&Se&&(ve=zs(p.style,Ae,Se))}{O=-1;const Ae=z.TRIANGLES,[Se,Te]=[g.gridIndexBuffer,g.gridSegments];for(const ge of w){const Ce=v.getTile(ge),Le=Di.disabled,Qe=g.prevTerrainTileForTile[ge.key],Ze=g.terrainTileForTile[ge.key];th(Qe,Ze)&&ds.newMorphing(ge.key,Qe,Ze,A,250),I.activeTexture.set(z.TEXTURE0),Ce.texture&&Ce.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const ht=ds.getMorphValuesForProxy(ge.key),lt=ht?1:0;let Ct;ht&&(Ct={morphing:{srcDemTile:ht.from,dstDemTile:ht.to,phase:r.dk(ht.phase)}});const $e=id(ge.projMatrix,_p(ge.canonical,se.renderWorldCopies)?pe/10:pe,ve);if(Y(lt),!k)continue;g.setupElevationDraw(Ce,k,Ct);const et=ge.toUnwrapped();j&&j.setupShadows(et,k),p.uploadCommonUniforms(I,k,et,null,Q),k.draw(p,Ae,K,Le,ee,Li.backCCW,$e,"terrain_raster",g.gridBuffer,Se,Te)}}}}(a,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const a=this.painter,u=this.painter.context,p=this.proxySourceCache,g=this.proxiedCoords[p.id],v=this._drapedRenderBatches.shift(),w=a.style.order,A=[];let I=0;for(const z of g){const k=p.getTileByID(z.proxyTileKey),O=p.proxyCachedFBO[z.key]?p.proxyCachedFBO[z.key][t]:void 0,j=O!==void 0?p.renderCache[O]:this.pool[I++],Q=O!==void 0;if(k.texture=j.tex,Q&&!j.dirty){A.push(k.tileID);continue}let Y;u.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(u.clear({color:r.am.transparent,stencil:0}),j.dirty=!1);for(let ee=v.start;ee<=v.end;++ee){const K=a.style._mergedLayers[w[ee]];if(K.isHidden(a.transform.zoom))continue;const se=a.style.getLayerSourceCache(K),pe=se?this.proxyToSource[z.key][se.id]:[z];if(!pe)continue;const ve=pe;u.viewport.set([0,0,j.fb.width,j.fb.height]),Y!==(se?se.id:null)&&(this._setupStencil(j,pe,K,se),Y=se?se.id:null),a.renderLayer(a,se,K,ve)}if(this._drapedRenderBatches.length===0)for(const ee of this._pendingGroundEffectLayers){const K=a.style._mergedLayers[w[ee]];if(K.isHidden(a.transform.zoom))continue;const se=a.style.getLayerSourceCache(K),pe=se?this.proxyToSource[z.key][se.id]:[z];if(!pe)continue;const ve=pe;u.viewport.set([0,0,j.fb.width,j.fb.height]),Y!==(se?se.id:null)&&(this._setupStencil(j,pe,K,se),Y=se?se.id:null),a.renderLayer(a,se,K,ve)}this.renderedToTile?(j.dirty=!0,A.push(k.tileID)):Q||--I,I===5&&(I=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,a.width,a.height]),v.end+1}postRender(){}isLayerOrderingCorrect(t){const a=t.order.length;let u=-1,p=a;for(let g=0;g<a;++g)this._style.isLayerDraped(t._mergedLayers[t.order[g]])?u=Math.max(u,g):p=Math.min(p,g);return p>u}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{t=Math.min(t,a.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,a,u){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter(g=>g.dem).map(g=>{const v=g.tileID,w=1<<v.overscaledZ,{x:A,y:I}=v.canonical,z=A/w,k=(A+1)/w,O=I/w,j=(I+1)/w;return{minx:z,miny:O,maxx:k,maxy:j,t:g.dem.tree.raycastRoot(z,O,k,j,t,a,u),tile:g}});p.sort((g,v)=>(g.t!==null?g.t:Number.MAX_VALUE)-(v.t!==null?v.t:Number.MAX_VALUE));for(const g of p){if(g.t==null)return null;const v=g.tile.dem.tree.raycast(g.minx,g.miny,g.maxx,g.maxy,t,a,u);if(v!=null)return v}return null}_createFBO(){const t=this.painter.context,a=t.gl,u=this.drapeBufferSize;t.activeTexture.set(a.TEXTURE0);const p=new r.T(t,{width:u[0],height:u[1],data:null},a.RGBA8);p.bind(a.LINEAR,a.CLAMP_TO_EDGE);const g=t.createFramebuffer(u[0],u[1],!0,null);return g.colorAttachment.set(p.texture),g.depthAttachment=new td(t,g.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,g.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):g.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:g,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const a=this._style._mergedLayers[t],u=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!u&&a.shouldRedrape():!u&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const u of this._style.getSources())if(u instanceof Wr){t=!0;break}if(!t)return;const a={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],g=this._style.getLayerSourceCache(p);if(g&&!a[g.id]&&!p.isHidden(this.painter.transform.zoom)&&p.type==="line"&&p.widthExpression()instanceof r.ab){a[g.id]=!0;for(const v of this.proxyCoords){const w=this.proxyToSource[v.key][g.id];if(w)for(const A of w)this._clearRenderCacheForTile(g.id,A)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u]._source instanceof To){t=!0;break}if(!t)return;const a={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],g=this._style.getLayerSourceCache(p);if(!g||a[g.id]||p.isHidden(this.painter.transform.zoom)||p.type!=="raster")continue;const v=p.paint.get("raster-fade-duration");for(const w of this.proxyCoords){const A=this.proxyToSource[w.key][g.id];if(A)for(const I of A){const z=nd(g.getTile(I),g.findLoadedParent(I,0),g,this.painter.transform,v);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(g.id,I)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,a=t.length;if(a===0)return;const u=[];this._pendingGroundEffectLayers=[];let p,g=0,v=this._style._mergedLayers[t[g]];for(;!this._style.isLayerDraped(v)&&v.isHidden(this.painter.transform.zoom)&&++g<a;)v=this._style._mergedLayers[t[g]];for(;g<a;++g){const w=this._style._mergedLayers[t[g]];w.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(w)?p===void 0&&(p=g):(w.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(g),p!==void 0&&(u.push({start:p,end:g-1}),p=void 0)))}if(p!==void 0&&u.push({start:p,end:g-1}),u.length!==0){const w=u[u.length-1];this._pendingGroundEffectLayers.every(A=>A>w.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=u}_setupRenderCache(t){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const v=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let w=0;w<v.length;++w){const A=Object.values(v[w]);a.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,p=this._tilesDirty;for(let v=u.length-1;v>=0;v--){const w=u[v];if(a.getTileByID(w.key),a.proxyCachedFBO[w.key]!==void 0){const A=t[w.key],I=this.proxyToSource[w.key];let z=0;for(const k in I){const O=I[k],j=A[k];if(!j||j.length!==O.length||O.some((Q,Y)=>Q!==j[Y]||p[k]&&p[k].hasOwnProperty(Q.key))){z=-1;break}++z}for(const k in a.proxyCachedFBO[w.key])a.renderCache[a.proxyCachedFBO[w.key][k]].dirty=z<0||z!==Object.values(A).length}}const g=[...this._drapedRenderBatches];g.sort((v,w)=>w.end-w.start-(v.end-v.start));for(const v of g)for(const w of u){if(a.proxyCachedFBO[w.key])continue;let A=a.renderCachePool.pop();A===void 0&&a.renderCache.length<50&&(A=a.renderCache.length,a.renderCache.push(this._createFBO())),A!==void 0&&(a.proxyCachedFBO[w.key]={},a.proxyCachedFBO[w.key][v.start]=A,a.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(t,a,u,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const g=this.painter.context,v=g.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let w;if(u.isTileClipped())w=a.length,this._overlapStencilMode.test={func:v.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);w=1,this._overlapStencilMode.test={func:v.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+w>255&&(g.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=w,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Di.disabled}_renderTileClippingMasks(t,a){const u=this.painter,p=this.painter.context,g=p.gl;u._tileClippingMaskIDs={},p.setColorMode(Zi.disabled),p.setDepthMode(ei.disabled);const v=u.getOrCreateProgram("clippingMask");for(const w of t){const A=u._tileClippingMaskIDs[w.key]=--a;v.draw(u,g.TRIANGLES,ei.disabled,new Di({func:g.ALWAYS,mask:0},A,255,g.KEEP,g.KEEP,g.REPLACE),Zi.disabled,Li.disabled,co(w.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(t){const a=this.painter.transform;if(t.x<0||t.x>a.width||t.y<0||t.y>a.height)return null;const u=[t.x,t.y,1,1];r.aA(u,u,a.pixelMatrixInverse),r.cw(u,u,1/u[3]),u[0]/=a.worldSize,u[1]/=a.worldSize;const p=a._camera.position,g=r.c6(1,a.center.lat),v=[p[0],p[1],p[2]/g,0],w=r.cY([],u.slice(0,3),v);r.au(w,w);const A=this.raycast(v,w,this._exaggeration);return A!==null&&A?(r.bF(v,v,w,A),v[3]=v[2],v[2]*=g,v):null}_setupProxiedCoordsForOrtho(t,a,u){if(t.getSource()instanceof r.aP)return this._setupProxiedCoordsForImageSource(t,a,u);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const p=this.proxiedCoords[t.id]=[],g=this.proxyCoords;for(let A=0;A<g.length;A++){const I=g[A],z=this._findTileCoveringTileID(I,t);if(z){const k=this._createProxiedId(I,z,u[I.key]&&u[I.key][t.id]);p.push(k),this.proxyToSource[I.key][t.id]=[k]}}let v=!1;const w=new Set;for(let A=0;A<a.length;A++){const I=t.getTile(a[A]);if(!I||!I.hasData())continue;const z=this._findTileCoveringTileID(I.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==I.tileID.canonical.z){const k=this.proxyToSource[z.tileID.key][t.id],O=this._createProxiedId(z.tileID,I,u[z.tileID.key]&&u[z.tileID.key][t.id]);k?k.splice(k.length-1,0,O):this.proxyToSource[z.tileID.key][t.id]=[O];const j=this.proxyToSource[z.tileID.key][t.id];w.has(j)||w.add(j),p.push(O),v=!0}}if(this._sourceTilesOverlap[t.id]=v,v&&this._debugParams.sortTilesHiZFirst)for(const A of w)A.sort((I,z)=>z.overscaledZ-I.overscaledZ)}_setupProxiedCoordsForImageSource(t,a,u){if(!t.getSource().loaded())return;const p=this.proxiedCoords[t.id]=[],g=this.proxyCoords,v=t.getSource(),w=v.tileID;if(!w)return;const A=new r.P(w.x,w.y)._div(1<<w.z),I=v.coordinates.map(r.ac.fromLngLat).reduce((k,O)=>(k.min.x=Math.min(k.min.x,O.x-A.x),k.min.y=Math.min(k.min.y,O.y-A.y),k.max.x=Math.max(k.max.x,O.x-A.x),k.max.y=Math.max(k.max.y,O.y-A.y),k),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(k,O)=>{const j=k.wrap+k.canonical.x/(1<<k.canonical.z),Q=k.canonical.y/(1<<k.canonical.z),Y=r.aj/(1<<k.canonical.z),ee=O.wrap+O.canonical.x/(1<<O.canonical.z),K=O.canonical.y/(1<<O.canonical.z);return j+Y<ee+I.min.x||j>ee+I.max.x||Q+Y<K+I.min.y||Q>K+I.max.y};for(let k=0;k<g.length;k++){const O=g[k];for(let j=0;j<a.length;j++){const Q=t.getTile(a[j]);if(!Q||!Q.hasData()||z(O,Q.tileID))continue;const Y=this._createProxiedId(O,Q,u[O.key]&&u[O.key][t.id]),ee=this.proxyToSource[O.key][t.id];ee?ee.push(Y):this.proxyToSource[O.key][t.id]=[Y],p.push(Y)}}}_createProxiedId(t,a,u){let p=this.orthoMatrix;if(u){const g=u.find(v=>v.key===a.tileID.key);if(g)return g}if(a.tileID.key!==t.key){const g=t.canonical.z-a.tileID.canonical.z;let v,w,A;p=r.bz();const I=a.tileID.wrap-t.wrap<<t.overscaledZ;g>0?(v=r.aj>>g,w=v*((a.tileID.canonical.x<<g)-t.canonical.x+I),A=v*((a.tileID.canonical.y<<g)-t.canonical.y)):(v=r.aj<<-g,w=r.aj*(a.tileID.canonical.x-(t.canonical.x+I<<-g)),A=r.aj*(a.tileID.canonical.y-(t.canonical.y<<-g))),r.c5(p,0,v,0,v,0,1),r.bo(p,p,[w,A,0])}return new ih(a.tileID,t.key,p)}_findTileCoveringTileID(t,a){let u=a.getTile(t);if(u&&u.hasData())return u;const p=this._findCoveringTileCache[a.id],g=p[t.key];if(u=g?a.getTileByID(g):null,u&&u.hasData()||g===null)return u;let v=u?u.tileID:t,w=v.overscaledZ;const A=a.getSource().minzoom,I=[];if(!g){const k=a.getSource().maxzoom;if(t.canonical.z>=k){const O=t.canonical.z-k;a.getSource().reparseOverscaled?(w=Math.max(t.canonical.z+2,a.transform.tileZoom),v=new r.aM(w,t.wrap,k,t.canonical.x>>O,t.canonical.y>>O)):O!==0&&(w=k,v=new r.aM(w,t.wrap,k,t.canonical.x>>O,t.canonical.y>>O))}v.key!==t.key&&(I.push(v.key),u=a.getTile(v))}const z=k=>{I.forEach(O=>{p[O]=k}),I.length=0};for(w-=1;w>=A&&(!u||!u.hasData());w--){u&&z(u.tileID.key);const k=v.calculateScaledKey(w);if(u=a.getTileByID(k),u&&u.hasData())break;const O=p[k];if(O===null)break;O===void 0?I.push(k):u=a.getTileByID(O)}return z(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,a){let u=this._tilesDirty[t];u||(u=this._tilesDirty[t]={}),u[a.key]=!0}}function nu(c,t,a){const u=function(w,A,I){const z=r.bE(A,w),k=r.bE(I,[.2126,.7152,.0722]),O=(Q,Y,ee)=>(1-ee)*Q+ee*Y,j=O(1-.3*Math.min(k,1),1,Math.min(z+1,1));return O(.92,1,Math.asin(r.aD(A[2],-1,1))/Math.PI+.5)*j}(c,[0,0,1],t),p=[0,0,0];r.b$(p,a.slice(0,3),u);const g=[0,0,0];r.b$(g,t.slice(0,3),c[2]);const v=[0,0,0];return r.cU(v,p,g),r.cX(v)}const nh=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],ic=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Ml{static cacheKey(t,a,u,p){let g=`${a}${p?p.cacheKey:""}`;for(const v of u)t.usedDefines.includes(v)&&(g+=`/${v}`);return g}constructor(t,a,u,p,g,v){const w=t.gl;this.program=w.createProgram(),this.configuration=p,this.name=a,this.fixedDefines=[...v];const A=p?p.getBinderAttributes():[],I=(u.staticAttributes||[]).concat(A);let z=p?p.defines():[];z=z.concat(v.map(ee=>`#define ${ee}`));const k=`#version 300 es
`;let O=k+z.concat("precision mediump float;",Yc,Ls.fragmentSource).join(`
`);for(const ee of u.fragmentIncludes)O+=`
${zo[ee]}`;O+=`
${u.fragmentSource}`;let j=k+z.concat("precision highp float;",Yc,Ls.vertexSource).join(`
`);for(const ee of u.vertexIncludes)j+=`
${zo[ee]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&u.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(j+=`
uniform int u_instanceID;
`),j+=`
${u.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(j=j.replaceAll("gl_InstanceID","u_instanceID"));const Q=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);w.shaderSource(Q,O),w.compileShader(Q),w.attachShader(this.program,Q);const Y=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())this.failedToCreate=!0;else{w.shaderSource(Y,j),w.compileShader(Y),w.attachShader(this.program,Y),this.attributes={},this.numAttributes=I.length;for(let ee=0;ee<this.numAttributes;ee++)if(I[ee]){const K=I[ee].startsWith("a_")?I[ee]:`a_${I[ee]}`;w.bindAttribLocation(this.program,ee,K),this.attributes[K]=ee}w.linkProgram(this.program),w.deleteShader(Y),w.deleteShader(Q),this.fixedUniforms=g(t),this.binderUniforms=p?p.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ee=>({u_instanceID:new r.cc(ee)}))(t)),(v.includes("TERRAIN")||a.indexOf("symbol")!==-1||a.indexOf("circle")!==-1)&&(this.terrainUniforms=(ee=>({u_dem:new r.cc(ee),u_dem_prev:new r.cc(ee),u_dem_tl:new r.c9(ee),u_dem_scale:new r.cb(ee),u_dem_tl_prev:new r.c9(ee),u_dem_scale_prev:new r.cb(ee),u_dem_size:new r.cb(ee),u_dem_lerp:new r.cb(ee),u_exaggeration:new r.cb(ee),u_depth:new r.cc(ee),u_depth_size_inv:new r.c9(ee),u_depth_range_unpack:new r.c9(ee),u_occluder_half_size:new r.cb(ee),u_occlusion_depth_offset:new r.cb(ee),u_meter_to_dem:new r.cb(ee),u_label_plane_matrix_inv:new r.c8(ee)}))(t)),v.includes("GLOBE")&&(this.globeUniforms=(ee=>({u_tile_tl_up:new r.ca(ee),u_tile_tr_up:new r.ca(ee),u_tile_br_up:new r.ca(ee),u_tile_bl_up:new r.ca(ee),u_tile_up_scale:new r.cb(ee)}))(t)),v.includes("FOG")&&(this.fogUniforms=(ee=>({u_fog_matrix:new r.c8(ee),u_fog_range:new r.c9(ee),u_fog_color:new r.cQ(ee),u_fog_horizon_blend:new r.cb(ee),u_fog_vertical_limit:new r.c9(ee),u_fog_temporal_offset:new r.cb(ee),u_frustum_tl:new r.ca(ee),u_frustum_tr:new r.ca(ee),u_frustum_br:new r.ca(ee),u_frustum_bl:new r.ca(ee),u_globe_pos:new r.ca(ee),u_globe_radius:new r.cb(ee),u_globe_transition:new r.cb(ee),u_is_globe:new r.cc(ee),u_viewport:new r.c9(ee)}))(t)),v.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ee=>({u_cutoff_params:new r.cQ(ee)}))(t)),v.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ee=>({u_lighting_ambient_color:new r.ca(ee),u_lighting_directional_dir:new r.ca(ee),u_lighting_directional_color:new r.ca(ee),u_ground_radiance:new r.ca(ee)}))(t)),v.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ee=>({u_light_matrix_0:new r.c8(ee),u_light_matrix_1:new r.c8(ee),u_fade_range:new r.c9(ee),u_shadow_normal_offset:new r.ca(ee),u_shadow_intensity:new r.cb(ee),u_shadow_texel_size:new r.cb(ee),u_shadow_map_resolution:new r.cb(ee),u_shadow_direction:new r.ca(ee),u_shadow_bias:new r.ca(ee),u_shadowmap_0:new r.cc(ee),u_shadowmap_1:new r.cc(ee)}))(t))}}setTerrainUniformValues(t,a){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in a)u[p]&&u[p].set(this.program,p,a[p])}}setGlobeUniformValues(t,a){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in a)u[p]&&u[p].set(this.program,p,a[p])}}setFogUniformValues(t,a){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in a)u[p].set(this.program,p,a[p])}}setCutoffUniformValues(t,a){if(!this.cutoffUniforms)return;const u=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in a)u[p].set(this.program,p,a[p])}}setLightsUniformValues(t,a){if(!this.lightsUniforms)return;const u=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in a)u[p].set(this.program,p,a[p])}}setShadowUniformValues(t,a){if(this.failedToCreate||!this.shadowUniforms)return;const u=this.shadowUniforms;t.program.set(this.program);for(const p in a)u[p].set(this.program,p,a[p])}_drawDebugWireframe(t,a,u,p,g,v,w,A,I,z){const k=t.options.wireframe;if(k.terrain===!1&&k.layers2D===!1&&k.layers3D===!1)return;const O=t.context;if(!(!(!k.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!k.layers2D||t._terrain&&t._terrain.renderingToTexture||!nh.includes(this.name))||!(!k.layers3D||!ic.includes(this.name))))return;const j=O.gl,Q=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,g,O);if(!Q)return;const Y=[...this.fixedDefines];Y.push("DEBUG_WIREFRAME");const ee=t.getOrCreateProgram(this.name,{config:this.configuration,defines:Y});O.program.set(ee.program);const K=(ve,Ae,Se)=>{if(Ae[ve]&&Se[ve])for(const Te in Ae[ve])Se[ve][Te]&&Se[ve][Te].set(Se.program,Te,Ae[ve][Te].current)};I&&I.setUniforms(ee.program,O,ee.binderUniforms,w,{zoom:A}),K("fixedUniforms",this,ee),K("terrainUniforms",this,ee),K("globeUniforms",this,ee),K("fogUniforms",this,ee),K("lightsUniforms",this,ee),K("shadowUniforms",this,ee),Q.bind(),O.setColorMode(new Zi([j.ONE,j.ONE_MINUS_SRC_ALPHA,j.ZERO,j.ONE],r.am.transparent,[!0,!0,!0,!1])),O.setDepthMode(new ei(a.func===j.LESS?j.LEQUAL:a.func,ei.ReadOnly,a.range)),O.setStencilMode(Di.disabled);const se=3*v.primitiveLength*2,pe=3*v.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ve=z||1;for(let Ae=0;Ae<ve;++Ae)ee.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ae),j.drawElements(j.LINES,se,j.UNSIGNED_SHORT,pe)}else z&&z>1?j.drawElementsInstanced(j.LINES,se,j.UNSIGNED_SHORT,pe,z):j.drawElements(j.LINES,se,j.UNSIGNED_SHORT,pe);g.bind(),O.program.set(this.program),O.setDepthMode(a),O.setStencilMode(u),O.setColorMode(p)}checkUniforms(t,a,u){if(this.fixedDefines.includes(a)){for(const p of Object.keys(u))if(!u[p].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${p} not set but required by ${a} being defined`)}}draw(t,a,u,p,g,v,w,A,I,z,k,O,j,Q,Y,ee){const K=t.context,se=K.gl;if(this.failedToCreate)return;K.program.set(this.program),K.setDepthMode(u),K.setStencilMode(p),K.setColorMode(g),K.setCullFace(v);for(const Ae of Object.keys(this.fixedUniforms))this.fixedUniforms[Ae].set(this.program,Ae,w[Ae]);Q&&Q.setUniforms(this.program,K,this.binderUniforms,O,{zoom:j});const pe={[se.POINTS]:1,[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[a];this.checkUniforms(A,"RENDER_SHADOWS",this.shadowUniforms);const ve=ee&&ee>0?1:void 0;for(const Ae of k.get()){const Se=Ae.vaos||(Ae.vaos={});if((Se[A]||(Se[A]=new Jl)).bind(K,this,I,Q?Q.getPaintVertexBuffers():[],z,Ae.vertexOffset,Y||[],ve),this.forceManualRenderingForInstanceIDShaders){const Te=ee||1;for(let ge=0;ge<Te;++ge)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ge),z?se.drawElements(a,Ae.primitiveLength*pe,se.UNSIGNED_SHORT,Ae.primitiveOffset*pe*2):se.drawArrays(a,Ae.vertexOffset,Ae.vertexLength)}else ee&&ee>1?se.drawElementsInstanced(a,Ae.primitiveLength*pe,se.UNSIGNED_SHORT,Ae.primitiveOffset*pe*2,ee):z?se.drawElements(a,Ae.primitiveLength*pe,se.UNSIGNED_SHORT,Ae.primitiveOffset*pe*2):se.drawArrays(a,Ae.vertexOffset,Ae.vertexLength);a===se.TRIANGLES&&z&&this._drawDebugWireframe(t,u,p,g,z,Ae,O,j,Q,ee)}}}function rd(c,t,a=0){const u=Math.pow(2,t.tileID.overscaledZ),p=t.tileSize*Math.pow(2,c.transform.tileZoom)/u,g=p*(t.tileID.canonical.x+t.tileID.wrap*u),v=p*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.aw(t,1,c.transform.tileZoom),u_pixel_coord_upper:[g>>16,v>>16],u_pixel_coord_lower:[65535&g,65535&v],u_pattern_transition:a}}const rh={terrain:0,flat:1},Om=r.bz(),nc=(c,t,a,u,p,g,v,w,A,I,z,k,O,j,Q,Y,ee,K)=>{const se=t.style.light,pe=se.properties.get("position"),ve=[pe.x,pe.y,pe.z],Ae=r.dx();se.properties.get("anchor")==="viewport"&&(r.dy(Ae,-t.transform.angle),r.dz(ve,ve,Ae));const Se=se.properties.get("color"),Te=t.transform,ge={u_matrix:c,u_lightpos:ve,u_lightintensity:se.properties.get("intensity"),u_lightcolor:[Se.r,Se.g,Se.b],u_vertical_gradient:+a,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Om,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:rh[I],u_base_type:rh[z],u_ao:p,u_edge_radius:g,u_width_scale:v,u_flood_light_color:Q,u_vertical_scale:Y,u_flood_light_intensity:ee,u_ground_shadow_factor:K};return Te.projection.name==="globe"&&(ge.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],ge.u_zoom_transition=k,ge.u_inv_rot_matrix=j,ge.u_merc_center=O,ge.u_up_dir=Te.projection.upVector(new r.cp(0,0,0),O[0]*r.aj,O[1]*r.aj),ge.u_height_lift=A),ge},ru=(c,t,a,u,p,g)=>({u_matrix:c,u_edge_radius:t,u_width_scale:a,u_vertical_scale:u,u_height_type:rh[p],u_base_type:rh[g]}),yp=(c,t,a,u,p,g,v,w,A,I,z,k,O,j,Q,Y,ee,K)=>{const se=nc(c,t,a,u,p,g,v,w,I,z,k,O,j,Q,Y,ee,1,[0,0,0]),pe={u_height_factor:-Math.pow(2,w.overscaledZ)/A.tileSize/8};return r.l(se,rd(t,A,K),pe)},ad=(c,t,a)=>({u_matrix:c,u_emissive_strength:t,u_ground_shadow_factor:a}),vp=(c,t,a,u,p,g=0)=>r.l(ad(c,t,p),rd(a,u,g)),od=(c,t,a,u)=>({u_matrix:c,u_world:a,u_emissive_strength:t,u_ground_shadow_factor:u}),km=(c,t,a,u,p,g,v=0)=>r.l(vp(c,t,a,u,g,v),{u_world:p}),ah=(c,t)=>({u_matrix:c,u_ground_shadow_factor:t}),au=(c,t,a,u,p)=>({u_matrix:c,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:a,u_height_scale:u,u_reset_depth:p}),xp=(c,t,a,u)=>{const p=r.aj/a.tileSize;return{u_matrix:c,u_camera_to_center_distance:t.getCameraToCenterDistance(u),u_extrude_scale:[t.pixelsToGLUnits[0]/p,t.pixelsToGLUnits[1]/p]}},al=(c,t,a=1)=>({u_matrix:c,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:a}),bp=r.bz(),oh=(c,t,a,u,p,g,v)=>{const w=c.transform,A=w.projection.name==="globe",I=A?r.dA(w.zoom,t.canonical)*w._pixelsPerMercatorPixel:r.aw(a,1,g),z={u_matrix:t.projMatrix,u_extrude_scale:I,u_intensity:v,u_inv_rot_matrix:bp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){z.u_inv_rot_matrix=u,z.u_merc_center=p,z.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],z.u_zoom_transition=r.ah(w.zoom);const k=p[0]*r.aj,O=p[1]*r.aj;z.u_up_dir=w.projection.upVector(new r.cp(0,0,0),k,O)}return z};function pf(c,[t,a,u,p],[g,v]){if(g===v)return[0,0,0,0];const w=255*(c-1)/(c*(v-g));return[t*w,a*w,u*w,p*w]}function sd(c,t,[a,u]){return a===u?0:.5/c+(t-a)*(c-1)/(c*(u-a))}const uo=(c,t,a,u,p,g,v,w,A,I,z,k,O,j,Q,Y,ee,K,se,pe,ve)=>({u_matrix:c,u_normalize_matrix:t,u_globe_matrix:a,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:g,u_scale_parent:I,u_fade_t:z.mix,u_opacity:z.opacity*k.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:k.paint.get("raster-brightness-min"),u_brightness_high:k.paint.get("raster-brightness-max"),u_saturation_factor:r.dB(k.paint.get("raster-saturation")),u_contrast_factor:r.dC(k.paint.get("raster-contrast")),u_spin_weights:mf(k.paint.get("raster-hue-rotate")),u_perspective_transform:O,u_raster_elevation:j,u_zoom_transition:v,u_merc_center:w,u_cutoff_params:A,u_colorization_mix:pf(r.dD,Y,K),u_colorization_offset:sd(r.dD,ee,K),u_color_ramp:Q,u_texture_offset:[pe/(se+2*pe),se/(se+2*pe)],u_texture_res:[se+2*pe,se+2*pe],u_emissive_strength:ve});function mf(c){c*=Math.PI/180;const t=Math.sin(c),a=Math.cos(c);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const ho=.05,ol=(c,t,a,u,p,g,v,w,A,I,z,k)=>({u_matrix:c,u_normalize_matrix:t,u_globe_matrix:a,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:g,u_scale_parent:I,u_fade_t:z.mix,u_opacity:z.opacity,u_image0:0,u_image1:1,u_raster_elevation:k,u_zoom_transition:v,u_merc_center:w,u_cutoff_params:A}),js=(c,t,a,u,p,g,v,w,A,I)=>({u_particle_texture:c,u_particle_texture_side_len:t,u_tile_offset:a,u_velocity:u,u_color_ramp:g,u_velocity_res:p,u_max_speed:v,u_uv_offset:w,u_data_scale:[255*A[0],255*A[1]],u_data_offset:I,u_particle_pos_scale:1.1,u_particle_pos_offset:[ho,ho]}),sh=(c,t,a,u,p,g,v,w,A,I)=>({u_particle_texture:c,u_particle_texture_side_len:t,u_velocity:a,u_velocity_res:u,u_max_speed:p,u_speed_factor:g,u_reset_rate:v,u_rand_seed:Math.random(),u_uv_offset:w,u_data_scale:[255*A[0],255*A[1]],u_data_offset:I,u_particle_pos_scale:1.1,u_particle_pos_offset:[ho,ho]}),ld=r.bz(),lh=(c,t,a,u,p,g,v,w,A,I,z,k,O,j,Q,Y,ee,K,se,pe,ve,Ae,Se)=>{const Te=p.transform,ge={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Te.getCameraToCenterDistance(se),u_rotate_symbol:+a,u_aspect_ratio:Te.width/Te.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:v,u_coord_matrix:w,u_is_text:+I,u_elevation_from_sea:A?1:0,u_pitch_with_map:+u,u_texsize:z,u_texsize_icon:k,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ld,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ld,u_up_vector:[0,-1,0],u_color_adj_mat:ve,u_icon_transition:Ae||0,u_gamma_scale:u?p.transform.getCameraToCenterDistance(se)*Math.cos(p.terrain?0:p.transform._pitch):1,u_device_pixel_ratio:r.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Se||1,u_ground_shadow_factor:pe,u_inv_matrix:r.bi(r.bz(),v)};return se.name==="globe"&&(ge.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],ge.u_zoom_transition=Q,ge.u_inv_rot_matrix=ee,ge.u_merc_center=Y,ge.u_camera_forward=Te._camera.forward(),ge.u_ecef_origin=r.dE(Te.globeMatrix,j.toUnwrapped()),ge.u_tile_matrix=Float32Array.from(Te.globeMatrix),ge.u_up_vector=K),ge},rc=(c,t,a,u)=>({u_matrix:c,u_emissive_strength:t,u_opacity:a,u_color:u}),ch=(c,t,a,u,p,g,v,w,A)=>r.l(function(I,z,k,O,j,Q){const{width:Y,height:ee}=O.imageManager.getPixelSize(z),K=Math.pow(2,Q.tileID.overscaledZ),se=Q.tileSize*Math.pow(2,O.transform.tileZoom)/K,pe=se*(Q.tileID.canonical.x+Q.tileID.wrap*K),ve=se*Q.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[Y,ee],u_pattern_size:k.displaySize,u_pattern_units_to_pixels:j?[O.transform.width,-1*O.transform.height]:[1/r.aw(Q,1,O.transform.tileZoom),1/r.aw(Q,1,O.transform.tileZoom)],u_pixel_coord_upper:[pe>>16,ve>>16],u_pixel_coord_lower:[65535&pe,65535&ve]}}(0,g,v,u,w,A),{u_matrix:c,u_emissive_strength:t,u_opacity:a}),cd=new Float32Array(r.bx([])),ac=(c,t,a,u,p,g,v,w,A,I,z,k,O,j=[0,0,0],Q)=>{const Y=p.style.light,ee=Y.properties.get("position"),K=[-ee.x,-ee.y,ee.z],se=r.dx();Y.properties.get("anchor")==="viewport"&&(r.dy(se,-p.transform.angle),r.dz(K,K,se));const pe=z.alphaMode==="MASK",ve=Y.properties.get("color").toRenderColor(null),Ae=O.paint.get("model-ambient-occlusion-intensity"),Se=O.paint.get("model-color").constantOr(r.am.white).toRenderColor(null),Te=O.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:c,u_lighting_matrix:t,u_normal_matrix:a,u_node_matrix:u||cd,u_lightpos:K,u_lightintensity:Y.properties.get("intensity"),u_lightcolor:[ve.r,ve.g,ve.b],u_camera_pos:j,u_opacity:g,u_baseTextureIsAlpha:0,u_alphaMask:+pe,u_alphaCutoff:z.alphaCutoff,u_baseColorFactor:[v.r,v.g,v.b,v.a],u_emissiveFactor:[w[0],w[1],w[2],1],u_metallicFactor:A,u_roughnessFactor:I,u_baseColorTexture:Oa.BaseColor,u_metallicRoughnessTexture:Oa.MetallicRoughness,u_normalTexture:Oa.Normal,u_occlusionTexture:Oa.Occlusion,u_emissionTexture:Oa.Emission,u_lutTexture:Oa.LUT,u_color_mix:[Se.r,Se.g,Se.b,Te],u_aoIntensity:Ae,u_emissive_strength:k,u_occlusionTextureTransform:Q||[0,0,0,0]}},ou=(c,t=cd,a=cd)=>({u_matrix:c,u_instance:t,u_node_matrix:a}),gf={fillExtrusion:c=>({u_matrix:new r.c8(c),u_lightpos:new r.ca(c),u_lightintensity:new r.cb(c),u_lightcolor:new r.ca(c),u_vertical_gradient:new r.cb(c),u_opacity:new r.cb(c),u_edge_radius:new r.cb(c),u_width_scale:new r.cb(c),u_ao:new r.c9(c),u_height_type:new r.cc(c),u_base_type:new r.cc(c),u_tile_id:new r.ca(c),u_zoom_transition:new r.cb(c),u_inv_rot_matrix:new r.c8(c),u_merc_center:new r.c9(c),u_up_dir:new r.ca(c),u_height_lift:new r.cb(c),u_flood_light_color:new r.ca(c),u_vertical_scale:new r.cb(c),u_flood_light_intensity:new r.cb(c),u_ground_shadow_factor:new r.ca(c)}),fillExtrusionDepth:c=>({u_matrix:new r.c8(c),u_edge_radius:new r.cb(c),u_width_scale:new r.cb(c),u_vertical_scale:new r.cb(c),u_height_type:new r.cc(c),u_base_type:new r.cc(c)}),fillExtrusionPattern:c=>({u_matrix:new r.c8(c),u_lightpos:new r.ca(c),u_lightintensity:new r.cb(c),u_lightcolor:new r.ca(c),u_vertical_gradient:new r.cb(c),u_height_factor:new r.cb(c),u_edge_radius:new r.cb(c),u_width_scale:new r.cb(c),u_ao:new r.c9(c),u_height_type:new r.cc(c),u_base_type:new r.cc(c),u_tile_id:new r.ca(c),u_zoom_transition:new r.cb(c),u_inv_rot_matrix:new r.c8(c),u_merc_center:new r.c9(c),u_up_dir:new r.ca(c),u_height_lift:new r.cb(c),u_image:new r.cc(c),u_texsize:new r.c9(c),u_pixel_coord_upper:new r.c9(c),u_pixel_coord_lower:new r.c9(c),u_tile_units_to_pixels:new r.cb(c),u_opacity:new r.cb(c),u_pattern_transition:new r.cb(c)}),fillExtrusionGroundEffect:c=>({u_matrix:new r.c8(c),u_opacity:new r.cb(c),u_ao_pass:new r.cb(c),u_meter_to_tile:new r.cb(c),u_ao:new r.c9(c),u_flood_light_intensity:new r.cb(c),u_flood_light_color:new r.ca(c),u_attenuation:new r.cb(c),u_edge_radius:new r.cb(c),u_fb:new r.cc(c),u_fb_size:new r.cb(c),u_dynamic_offset:new r.cb(c)}),fill:c=>({u_matrix:new r.c8(c),u_emissive_strength:new r.cb(c),u_ground_shadow_factor:new r.ca(c)}),fillPattern:c=>({u_matrix:new r.c8(c),u_emissive_strength:new r.cb(c),u_image:new r.cc(c),u_texsize:new r.c9(c),u_pixel_coord_upper:new r.c9(c),u_pixel_coord_lower:new r.c9(c),u_tile_units_to_pixels:new r.cb(c),u_ground_shadow_factor:new r.ca(c),u_pattern_transition:new r.cb(c)}),fillOutline:c=>({u_matrix:new r.c8(c),u_emissive_strength:new r.cb(c),u_world:new r.c9(c),u_ground_shadow_factor:new r.ca(c)}),fillOutlinePattern:c=>({u_matrix:new r.c8(c),u_emissive_strength:new r.cb(c),u_world:new r.c9(c),u_image:new r.cc(c),u_texsize:new r.c9(c),u_pixel_coord_upper:new r.c9(c),u_pixel_coord_lower:new r.c9(c),u_tile_units_to_pixels:new r.cb(c),u_ground_shadow_factor:new r.ca(c),u_pattern_transition:new r.cb(c)}),building:c=>({u_matrix:new r.c8(c),u_normal_matrix:new r.c8(c),u_opacity:new r.cb(c)}),buildingDepth:c=>({u_matrix:new r.c8(c)}),elevatedStructuresDepth:c=>({u_matrix:new r.c8(c),u_depth_bias:new r.cb(c)}),elevatedStructures:c=>({u_matrix:new r.c8(c),u_ground_shadow_factor:new r.ca(c)}),elevatedStructuresDepthReconstruct:c=>({u_matrix:new r.c8(c),u_camera_pos:new r.ca(c),u_depth_bias:new r.cb(c),u_height_scale:new r.cb(c),u_reset_depth:new r.cb(c)}),circle:r.dF,collisionBox:c=>({u_matrix:new r.c8(c),u_camera_to_center_distance:new r.cb(c),u_extrude_scale:new r.c9(c)}),collisionCircle:c=>({u_matrix:new r.c8(c),u_inv_matrix:new r.c8(c),u_camera_to_center_distance:new r.cb(c),u_viewport_size:new r.c9(c)}),debug:c=>({u_color:new r.di(c),u_matrix:new r.c8(c),u_overlay:new r.cc(c),u_overlay_scale:new r.cb(c)}),clippingMask:c=>({u_matrix:new r.c8(c)}),heatmap:c=>({u_extrude_scale:new r.cb(c),u_intensity:new r.cb(c),u_matrix:new r.c8(c),u_inv_rot_matrix:new r.c8(c),u_merc_center:new r.c9(c),u_tile_id:new r.ca(c),u_zoom_transition:new r.cb(c),u_up_dir:new r.ca(c)}),heatmapTexture:c=>({u_image:new r.cc(c),u_color_ramp:new r.cc(c),u_opacity:new r.cb(c)}),hillshade:c=>({u_matrix:new r.c8(c),u_image:new r.cc(c),u_latrange:new r.c9(c),u_light:new r.c9(c),u_shadow:new r.di(c),u_highlight:new r.di(c),u_emissive_strength:new r.cb(c),u_accent:new r.di(c)}),hillshadePrepare:c=>({u_matrix:new r.c8(c),u_image:new r.cc(c),u_dimension:new r.c9(c),u_zoom:new r.cb(c)}),line:r.dG,linePattern:r.dH,raster:c=>({u_matrix:new r.c8(c),u_normalize_matrix:new r.c8(c),u_globe_matrix:new r.c8(c),u_merc_matrix:new r.c8(c),u_grid_matrix:new r.dj(c),u_tl_parent:new r.c9(c),u_scale_parent:new r.cb(c),u_fade_t:new r.cb(c),u_opacity:new r.cb(c),u_image0:new r.cc(c),u_image1:new r.cc(c),u_brightness_low:new r.cb(c),u_brightness_high:new r.cb(c),u_saturation_factor:new r.cb(c),u_contrast_factor:new r.cb(c),u_spin_weights:new r.ca(c),u_perspective_transform:new r.c9(c),u_raster_elevation:new r.cb(c),u_zoom_transition:new r.cb(c),u_merc_center:new r.c9(c),u_cutoff_params:new r.cQ(c),u_colorization_mix:new r.cQ(c),u_colorization_offset:new r.cb(c),u_color_ramp:new r.cc(c),u_texture_offset:new r.c9(c),u_texture_res:new r.c9(c),u_emissive_strength:new r.cb(c)}),rasterParticle:c=>({u_matrix:new r.c8(c),u_normalize_matrix:new r.c8(c),u_globe_matrix:new r.c8(c),u_merc_matrix:new r.c8(c),u_grid_matrix:new r.dj(c),u_tl_parent:new r.c9(c),u_scale_parent:new r.cb(c),u_fade_t:new r.cb(c),u_opacity:new r.cb(c),u_image0:new r.cc(c),u_image1:new r.cc(c),u_raster_elevation:new r.cb(c),u_zoom_transition:new r.cb(c),u_merc_center:new r.c9(c),u_cutoff_params:new r.cQ(c)}),rasterParticleTexture:c=>({u_texture:new r.cc(c),u_opacity:new r.cb(c)}),rasterParticleDraw:c=>({u_particle_texture:new r.cc(c),u_particle_texture_side_len:new r.cb(c),u_tile_offset:new r.c9(c),u_velocity:new r.cc(c),u_color_ramp:new r.cc(c),u_velocity_res:new r.c9(c),u_max_speed:new r.cb(c),u_uv_offset:new r.c9(c),u_data_scale:new r.c9(c),u_data_offset:new r.cb(c),u_particle_pos_scale:new r.cb(c),u_particle_pos_offset:new r.c9(c)}),rasterParticleUpdate:c=>({u_particle_texture:new r.cc(c),u_particle_texture_side_len:new r.cb(c),u_velocity:new r.cc(c),u_velocity_res:new r.c9(c),u_max_speed:new r.cb(c),u_speed_factor:new r.cb(c),u_reset_rate:new r.cb(c),u_rand_seed:new r.cb(c),u_uv_offset:new r.c9(c),u_data_scale:new r.c9(c),u_data_offset:new r.cb(c),u_particle_pos_scale:new r.cb(c),u_particle_pos_offset:new r.c9(c)}),symbol:c=>({u_is_size_zoom_constant:new r.cc(c),u_is_size_feature_constant:new r.cc(c),u_size_t:new r.cb(c),u_size:new r.cb(c),u_camera_to_center_distance:new r.cb(c),u_rotate_symbol:new r.cc(c),u_aspect_ratio:new r.cb(c),u_fade_change:new r.cb(c),u_matrix:new r.c8(c),u_label_plane_matrix:new r.c8(c),u_coord_matrix:new r.c8(c),u_is_text:new r.cc(c),u_elevation_from_sea:new r.cc(c),u_pitch_with_map:new r.cc(c),u_texsize:new r.c9(c),u_texsize_icon:new r.c9(c),u_texture:new r.cc(c),u_texture_icon:new r.cc(c),u_gamma_scale:new r.cb(c),u_device_pixel_ratio:new r.cb(c),u_tile_id:new r.ca(c),u_zoom_transition:new r.cb(c),u_inv_rot_matrix:new r.c8(c),u_merc_center:new r.c9(c),u_camera_forward:new r.ca(c),u_tile_matrix:new r.c8(c),u_up_vector:new r.ca(c),u_ecef_origin:new r.ca(c),u_is_halo:new r.cc(c),u_icon_transition:new r.cb(c),u_color_adj_mat:new r.c8(c),u_scale_factor:new r.cb(c),u_ground_shadow_factor:new r.ca(c),u_inv_matrix:new r.c8(c)}),background:c=>({u_matrix:new r.c8(c),u_emissive_strength:new r.cb(c),u_opacity:new r.cb(c),u_color:new r.di(c)}),backgroundPattern:c=>({u_matrix:new r.c8(c),u_emissive_strength:new r.cb(c),u_opacity:new r.cb(c),u_image:new r.cc(c),u_pattern_tl:new r.c9(c),u_pattern_br:new r.c9(c),u_texsize:new r.c9(c),u_pattern_size:new r.c9(c),u_pixel_coord_upper:new r.c9(c),u_pixel_coord_lower:new r.c9(c),u_pattern_units_to_pixels:new r.c9(c)}),terrainRaster:c=>({u_matrix:new r.c8(c),u_image0:new r.cc(c),u_skirt_height:new r.cb(c),u_ground_shadow_factor:new r.ca(c)}),skybox:c=>({u_matrix:new r.c8(c),u_sun_direction:new r.ca(c),u_cubemap:new r.cc(c),u_opacity:new r.cb(c),u_temporal_offset:new r.cb(c)}),skyboxGradient:c=>({u_matrix:new r.c8(c),u_color_ramp:new r.cc(c),u_center_direction:new r.ca(c),u_radius:new r.cb(c),u_opacity:new r.cb(c),u_temporal_offset:new r.cb(c)}),skyboxCapture:c=>({u_matrix_3f:new r.dj(c),u_sun_direction:new r.ca(c),u_sun_intensity:new r.cb(c),u_color_tint_r:new r.cQ(c),u_color_tint_m:new r.cQ(c),u_luminance:new r.cb(c)}),globeRaster:c=>({u_proj_matrix:new r.c8(c),u_globe_matrix:new r.c8(c),u_normalize_matrix:new r.c8(c),u_merc_matrix:new r.c8(c),u_zoom_transition:new r.cb(c),u_merc_center:new r.c9(c),u_image0:new r.cc(c),u_grid_matrix:new r.dj(c),u_skirt_height:new r.cb(c),u_far_z_cutoff:new r.cb(c),u_frustum_tl:new r.ca(c),u_frustum_tr:new r.ca(c),u_frustum_br:new r.ca(c),u_frustum_bl:new r.ca(c),u_globe_pos:new r.ca(c),u_globe_radius:new r.cb(c),u_viewport:new r.c9(c)}),globeAtmosphere:c=>({u_frustum_tl:new r.ca(c),u_frustum_tr:new r.ca(c),u_frustum_br:new r.ca(c),u_frustum_bl:new r.ca(c),u_horizon:new r.cb(c),u_transition:new r.cb(c),u_fadeout_range:new r.cb(c),u_color:new r.cQ(c),u_high_color:new r.cQ(c),u_space_color:new r.cQ(c),u_temporal_offset:new r.cb(c),u_horizon_angle:new r.cb(c)}),model:c=>({u_matrix:new r.c8(c),u_lighting_matrix:new r.c8(c),u_normal_matrix:new r.c8(c),u_node_matrix:new r.c8(c),u_lightpos:new r.ca(c),u_lightintensity:new r.cb(c),u_lightcolor:new r.ca(c),u_camera_pos:new r.ca(c),u_opacity:new r.cb(c),u_baseColorFactor:new r.cQ(c),u_emissiveFactor:new r.cQ(c),u_metallicFactor:new r.cb(c),u_roughnessFactor:new r.cb(c),u_baseTextureIsAlpha:new r.cc(c),u_alphaMask:new r.cc(c),u_alphaCutoff:new r.cb(c),u_baseColorTexture:new r.cc(c),u_metallicRoughnessTexture:new r.cc(c),u_normalTexture:new r.cc(c),u_occlusionTexture:new r.cc(c),u_emissionTexture:new r.cc(c),u_lutTexture:new r.cc(c),u_color_mix:new r.cQ(c),u_aoIntensity:new r.cb(c),u_emissive_strength:new r.cb(c),u_occlusionTextureTransform:new r.cQ(c)}),modelDepth:c=>({u_matrix:new r.c8(c),u_instance:new r.c8(c),u_node_matrix:new r.c8(c)}),groundShadow:c=>({u_matrix:new r.c8(c),u_ground_shadow_factor:new r.ca(c)}),stars:c=>({u_matrix:new r.c8(c),u_up:new r.ca(c),u_right:new r.ca(c),u_intensity_multiplier:new r.cb(c)}),snowParticle:c=>({u_modelview:new r.c8(c),u_projection:new r.c8(c),u_time:new r.cb(c),u_cam_pos:new r.ca(c),u_velocityConeAperture:new r.cb(c),u_velocity:new r.cb(c),u_horizontalOscillationRadius:new r.cb(c),u_horizontalOscillationRate:new r.cb(c),u_boxSize:new r.cb(c),u_billboardSize:new r.cb(c),u_simpleShapeParameters:new r.c9(c),u_screenSize:new r.c9(c),u_thinningCenterPos:new r.c9(c),u_thinningShape:new r.ca(c),u_thinningAffectedRatio:new r.cb(c),u_thinningParticleOffset:new r.cb(c),u_particleColor:new r.cQ(c),u_direction:new r.ca(c)}),rainParticle:c=>({u_modelview:new r.c8(c),u_projection:new r.c8(c),u_time:new r.cb(c),u_cam_pos:new r.ca(c),u_texScreen:new r.cc(c),u_velocityConeAperture:new r.cb(c),u_velocity:new r.cb(c),u_boxSize:new r.cb(c),u_rainDropletSize:new r.c9(c),u_distortionStrength:new r.cb(c),u_rainDirection:new r.ca(c),u_color:new r.cQ(c),u_screenSize:new r.c9(c),u_thinningCenterPos:new r.c9(c),u_thinningShape:new r.ca(c),u_thinningAffectedRatio:new r.cb(c),u_thinningParticleOffset:new r.cb(c),u_shapeDirectionalPower:new r.cb(c),u_shapeNormalPower:new r.cb(c),u_mode:new r.cb(c)}),vignette:c=>({u_vignetteShape:new r.ca(c),u_vignetteColor:new r.cQ(c)}),occlusion:c=>({u_matrix:new r.c8(c),u_anchorPos:new r.ca(c),u_screenSizePx:new r.c9(c),u_occluderSizePx:new r.c9(c),u_color:new r.cQ(c)})};class sl{constructor(t,a,u,p){this.id=sl.uniqueIdxCounter,sl.uniqueIdxCounter++,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||p||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=sl.uniqueIdxCounter,sl.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}sl.uniqueIdxCounter=0;const wp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ud{constructor(t,a,u,p,g,v){this.length=a.length,this.attributes=u,this.itemSize=a.bytesPerElement,this.dynamicDraw=p,this.instanceCount=v,this.context=t;const w=t.gl;this.buffer=w.createBuffer(),t.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||g||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let u=0;u<this.attributes.length;u++){const p=a.attributes[this.attributes[u].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,a,u){for(let p=0;p<this.attributes.length;p++){const g=this.attributes[p],v=a.attributes[g.name];v!==void 0&&t.vertexAttribPointer(v,g.components,t[wp[g.type]],!1,this.itemSize,g.offset+this.itemSize*(u||0))}}setVertexAttribDivisor(t,a,u){for(let p=0;p<this.attributes.length;p++){const g=a.attributes[this.attributes[p].name];g!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(g,u)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Us{constructor(t,a,u,p,g){this.context=t,this.width=a,this.height=u;const v=this.framebuffer=t.gl.createFramebuffer();p&&(this.colorAttachment=new El(t,v)),g&&(this.depthAttachmentType=g,this.depthAttachment=g==="renderbuffer"?new Bs(t,v):new Fs(t,v))}destroy(){const t=this.context.gl;if(this.colorAttachment){const a=this.colorAttachment.get();a&&t.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&t.deleteTexture(a)}t.deleteFramebuffer(this.framebuffer)}}class Nn{constructor(t,a){this.gl=t,this.clearColor=new uf(this),this.clearDepth=new Qc(this),this.clearStencil=new pp(this),this.colorMask=new hf(this),this.depthMask=new Wu(this),this.stencilMask=new bl(this),this.stencilFunc=new df(this),this.stencilOp=new Jh(this),this.stencilTest=new Lo(this),this.depthRange=new so(this),this.depthTest=new wl(this),this.depthFunc=new lo(this),this.blend=new ks(this),this.blendFunc=new ec(this),this.blendColor=new Jc(this),this.blendEquation=new eu(this),this.cullFace=new Yu(this),this.cullFaceSide=new Aa(this),this.frontFace=new Fr(this),this.program=new _r(this),this.activeTexture=new Tl(this),this.viewport=new Ns(this),this.bindFramebuffer=new ed(this),this.bindRenderbuffer=new rl(this),this.bindTexture=new Ku(this),this.bindVertexBuffer=new mp(this),this.bindElementBuffer=new Qu(this),this.bindVertexArrayOES=new Ju(this),this.pixelStoreUnpack=new tu(this),this.pixelStoreUnpackPremultiplyAlpha=new eh(this),this.pixelStoreUnpackFlipY=new gp(this),this.options=a?Object.assign({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=a&&!!a.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a,u){return new sl(this,t,a,u)}createVertexBuffer(t,a,u,p,g){return new ud(this,t,a,u,p,g)}createRenderbuffer(t,a,u){const p=this.gl,g=p.createRenderbuffer();return this.bindRenderbuffer.set(g),p.renderbufferStorage(p.RENDERBUFFER,t,a,u),this.bindRenderbuffer.set(null),g}createFramebuffer(t,a,u,p){return new Us(this,t,a,u,p)}clear({color:t,depth:a,stencil:u,colorMask:p}){const g=this.gl;let v=0;t&&(v|=g.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(p||[!0,!0,!0,!0])),a!==void 0&&(v|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),u!==void 0&&(v|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),g.clear(v)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){r.bv(t.blendFunction,Zi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let yr;function Yr(c,t,a,u,p,g,v){const w=c.context,A=w.gl,I=c.transform,z=c.getOrCreateProgram("collisionBox"),k=[];let O=0,j=0;for(let ve=0;ve<u.length;ve++){const Ae=u[ve],Se=t.getTile(Ae),Te=Se.getBucket(a);if(!Te)continue;const ge=Uh(Ae,Te,I);let Ce=ge;p[0]===0&&p[1]===0||(Ce=c.translatePosMatrix(ge,Se,p,g));const Le=v?Te.textCollisionBox:Te.iconCollisionBox,Qe=Te.collisionCircleArray;if(Qe.length>0){const Ze=r.bz(),ht=Ce;r.cB(Ze,Te.placementInvProjMatrix,I.glCoordMatrix),r.cB(Ze,Ze,Te.placementViewportMatrix),k.push({circleArray:Qe,circleOffset:j,transform:ht,invTransform:Ze,projection:Te.getProjection()}),O+=Qe.length/4,j=O}Le&&(c.terrain&&c.terrain.setupElevationDraw(Se,z),z.draw(c,A.LINES,ei.disabled,Di.disabled,c.colorModeForRenderPass(),Li.disabled,xp(Ce,I,Se,Te.getProjection()),a.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,null,I.zoom,null,[Le.collisionVertexBuffer,Le.collisionVertexBufferExt]))}if(!v||!k.length)return;const Q=c.getOrCreateProgram("collisionCircle"),Y=new r.dI;Y.resize(4*O),Y._trim();let ee=0;for(const ve of k)for(let Ae=0;Ae<ve.circleArray.length/4;Ae++){const Se=4*Ae,Te=ve.circleArray[Se+0],ge=ve.circleArray[Se+1],Ce=ve.circleArray[Se+2],Le=ve.circleArray[Se+3];Y.emplace(ee++,Te,ge,Ce,Le,0),Y.emplace(ee++,Te,ge,Ce,Le,1),Y.emplace(ee++,Te,ge,Ce,Le,2),Y.emplace(ee++,Te,ge,Ce,Le,3)}(!yr||yr.length<2*O)&&(yr=function(ve){const Ae=2*ve,Se=new r.a_;Se.resize(Ae),Se._trim();for(let Te=0;Te<Ae;Te++){const ge=6*Te;Se.uint16[ge+0]=4*Te+0,Se.uint16[ge+1]=4*Te+1,Se.uint16[ge+2]=4*Te+2,Se.uint16[ge+3]=4*Te+2,Se.uint16[ge+4]=4*Te+3,Se.uint16[ge+5]=4*Te+0}return Se}(O));const K=w.createIndexBuffer(yr,!0),se=w.createVertexBuffer(Y,r.dJ.members,!0);for(const ve of k){const Ae={u_matrix:ve.transform,u_inv_matrix:ve.invTransform,u_camera_to_center_distance:(pe=I).getCameraToCenterDistance(ve.projection),u_viewport_size:[pe.width,pe.height]};Q.draw(c,A.TRIANGLES,ei.disabled,Di.disabled,c.colorModeForRenderPass(),Li.disabled,Ae,a.id,se,K,r.bd.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,I.zoom)}var pe;se.destroy(),K.destroy()}const oc=r.bz();function ll(c){const t=c._camera.getWorldToCamera(c.worldSize,1),a=r.az([],t,c.globeMatrix);r.bi(a,a);const u=[0,0,0],p=[0,1,0,0];return r.aA(p,p,a),u[0]=p[0],u[1]=p[1],u[2]=p[2],r.au(u,u),u}function cl({width:c,height:t,anchor:a,textOffset:u,textScale:p},g){const{horizontalAlign:v,verticalAlign:w}=r.bV(a),A=-(v-.5)*c,I=-(w-.5)*t,z=r.bU(a,u);return new r.P((A/p+z[0])*g,(I/p+z[1])*g)}function uh(c,t,a,u,p,g,v,w,A,I){const z=c.text.placedSymbolArray,k=c.text.dynamicLayoutVertexArray,O=c.icon.dynamicLayoutVertexArray,j={},Q=c.getProjection(),Y=Vh(v,Q,p),ee=p.elevation,K=Q.upVectorScale(v.canonical,p.center.lat,p.worldSize).metersToTile;k.clear();for(let se=0;se<z.length;se++){const pe=z.get(se),{tileAnchorX:ve,tileAnchorY:Ae,numGlyphs:Se}=pe,Te=pe.hidden||!pe.crossTileID||c.allowVerticalPlacement&&!pe.placedOrientation?null:u[pe.crossTileID];if(Te){let ge=0,Ce=0,Le=0;if(ee){const pt=ee?ee.getAtTileOffset(v,ve,Ae):0,[tt,bt,dt]=Q.upVector(v.canonical,ve,Ae);ge=pt*tt*K,Ce=pt*bt*K,Le=pt*dt*K}let[Qe,Ze,ht,lt]=Mo(pe.projectedAnchorX+ge,pe.projectedAnchorY+Ce,pe.projectedAnchorZ+Le,a?Y:g);const Ct=tl(p.getCameraToCenterDistance(Q),lt);let $e=r.bJ(c.textSizeData,A,pe)*Ct/r.bO;a&&($e*=c.tilePixelRatio/w);const et=cl(Te,$e);a?({x:Qe,y:Ze,z:ht}=Q.projectTilePoint(ve+et.x,Ae+et.y,v.canonical),[Qe,Ze,ht]=Mo(Qe+ge,Ze+Ce,ht+Le,g)):(t&&et._rotate(-p.angle),Qe+=et.x,Ze+=et.y,ht=0);const Ge=c.allowVerticalPlacement&&pe.placedOrientation===r.bI.vertical?Math.PI/2:0;for(let pt=0;pt<Se;pt++)r.bL(k,Qe,Ze,ht,Ge);I&&pe.associatedIconIndex>=0&&(j[pe.associatedIconIndex]={x:Qe,y:Ze,z:ht,angle:Ge})}else Cn(Se,k)}if(I){O.clear();const se=c.icon.placedSymbolArray;for(let pe=0;pe<se.length;pe++){const ve=se.get(pe),{numGlyphs:Ae}=ve,Se=j[pe];if(ve.hidden||!Se)Cn(Ae,O);else{const{x:Te,y:ge,z:Ce,angle:Le}=Se;for(let Qe=0;Qe<Ae;Qe++)r.bL(O,Te,ge,Ce,Le)}}c.icon.dynamicLayoutVertexBuffer.updateData(O)}c.text.dynamicLayoutVertexBuffer.updateData(k)}function sc(c,t,a,u,p,g,v={}){const w=a.paint.get("icon-translate"),A=a.paint.get("text-translate"),I=a.paint.get("icon-translate-anchor"),z=a.paint.get("text-translate-anchor"),k=a.layout.get("icon-rotation-alignment"),O=a.layout.get("text-rotation-alignment"),j=a.layout.get("icon-pitch-alignment"),Q=a.layout.get("text-pitch-alignment"),Y=a.layout.get("icon-keep-upright"),ee=a.layout.get("text-keep-upright"),K=a.paint.get("icon-color-saturation"),se=a.paint.get("icon-color-contrast"),pe=a.paint.get("icon-color-brightness-min"),ve=a.paint.get("icon-color-brightness-max"),Ae=a.layout.get("symbol-elevation-reference")==="sea",Se=c.context,Te=Se.gl,ge=c.transform,Ce=k==="map",Le=O==="map",Qe=j==="map",Ze=Q==="map",ht=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let lt=!1;const Ct=c.depthModeForSublayer(0,ei.ReadOnly),$e=new ei(c.context.gl.LEQUAL,ei.ReadOnly,c.depthRangeFor3D),et=[r.ay(ge.center.lng),r.aH(ge.center.lat)],Ge=a.layout.get("text-variable-anchor"),pt=ge.projection.name==="globe",tt=[],bt=[0,-1,0];for(const dt of u){const wt=t.getTile(dt),At=wt.getBucket(a);if(!At||At.projection.name==="mercator"&&pt||At.fullyClipped)continue;const Qt=At.projection.name==="globe",ai=Qt?r.ah(ge.zoom):0,Yt=Vh(dt,At.getProjection(),ge),ci=ge.calculatePixelsToTileUnitsMatrix(wt),ii=Ge&&At.hasTextData(),Mi=At.hasIconTextFit()&&ii&&At.hasIconData(),Ni=At.elevationType==="road"?$e:Ct,Ai=At.getProjection().createInversionMatrix(ge,dt.canonical),Hi=c.shadowRenderer,zi=At.elevationType==="road"&&!!Hi&&Hi.enabled;let wi=[0,0,0];if(zi){const tr=c.style.directionalLight,ki=c.style.ambientLight;tr&&ki&&(wi=zs(c.style,tr,ki))}const an=tr=>{ge.depthOcclusionForSymbolsAndCircles&&(a.hasInitialOcclusionOpacityProperties||c.terrain)&&(tr.push("DEPTH_D24"),tr.push("DEPTH_OCCLUSION"))},zn=()=>{const tr=Ce&&a.layout.get("symbol-placement")!=="point",ki=[];an(ki);const $n=tr||Mi,mn=a.paint.get("icon-image-cross-fade");c.terrainRenderModeElevated()&&Qe&&ki.push("PITCH_WITH_MAP_TERRAIN"),Qt&&(ki.push("PROJECTION_GLOBE_VIEW"),$n&&ki.push("PROJECTED_POS_ON_VIEWPORT")),mn>0&&ki.push("ICON_TRANSITION"),At.icon.zOffsetVertexBuffer&&ki.push("Z_OFFSET"),K===0&&se===0&&pe===0&&ve===1||ki.push("COLOR_ADJUSTMENT"),At.sdfIcons&&ki.push("RENDER_SDF"),zi&&ki.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Sn=At.icon.programConfigurations.get(a.id),En=c.getOrCreateProgram("symbol",{config:Sn,defines:ki}),ir=wt.imageAtlasTexture?wt.imageAtlasTexture.size:[0,0],ra=At.iconSizeData,Zn=r.bH(ra,ge.zoom),Ur=Qe||ge.pitch!==0,jn=as(Yt,wt.tileID.canonical,Qe,Ce,ge,At.getProjection(),ci),qr=Nc(Yt,wt.tileID.canonical,Qe,Ce,ge,At.getProjection(),ci),Ya=c.translatePosMatrix(qr,wt,w,I,!0),No=c.translatePosMatrix(Yt,wt,w,I),Ka=$n?oc:jn,Bo=Ce&&!Qe&&!tr;let Zs=bt;!pt&&!ge.mercatorFromTransition||Ce||(Zs=ll(ge));const Fo=Qt?Zs:bt,Jo=a.getColorAdjustmentMatrix(K,se,pe,ve),Ra=lh(ra.kind,Zn,Bo,Qe,c,No,Ka,Ya,Ae,!1,ir,[0,0],!0,dt,ai,et,Ai,Fo,At.getProjection(),wi,Jo,mn),Sc=wt.imageAtlasTexture?wt.imageAtlasTexture:null,Qa=a.layout.get("icon-size").constantOr(0)!==1||At.iconsNeedLinear,Ad=At.sdfIcons||c.options.rotating||c.options.zooming||Qa||Ur?Te.LINEAR:Te.NEAREST,Md=At.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,Cd=c.terrain&&Qe&&tr?r.bi(r.bz(),jn):oc;if(tr&&At.icon){const Un=ge.elevation,kl=Un?Un.getAtTileOffsetFunc(dt,ge.center.lat,ge.worldSize,At.getProjection()):null,Rd=kc(Yt,wt.tileID.canonical,Qe,Ce,ge,At.getProjection(),ci);Bc(At,Yt,c,!1,Rd,qr,Qe,Y,kl,dt)}return{program:En,buffers:At.icon,uniformValues:Ra,atlasTexture:Sc,atlasTextureIcon:null,atlasInterpolation:Ad,atlasInterpolationIcon:null,isSDF:At.sdfIcons,hasHalo:Md,depthMode:Ni,tile:wt,renderWithShadows:zi,labelPlaneMatrixInv:Cd}},Bi=()=>{const tr=Le&&a.layout.get("symbol-placement")!=="point",ki=[],$n=tr||Ge||Mi;c.terrainRenderModeElevated()&&Ze&&ki.push("PITCH_WITH_MAP_TERRAIN"),Qt&&(ki.push("PROJECTION_GLOBE_VIEW"),$n&&ki.push("PROJECTED_POS_ON_VIEWPORT")),At.text.zOffsetVertexBuffer&&ki.push("Z_OFFSET"),At.iconsInText&&ki.push("RENDER_TEXT_AND_SYMBOL"),ki.push("RENDER_SDF"),zi&&ki.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),an(ki);const mn=At.text.programConfigurations.get(a.id),Sn=c.getOrCreateProgram("symbol",{config:mn,defines:ki});let En,ir=[0,0],ra=null;const Zn=At.textSizeData;At.iconsInText&&(ir=wt.imageAtlasTexture?wt.imageAtlasTexture.size:[0,0],ra=wt.imageAtlasTexture?wt.imageAtlasTexture:null,En=Ze||ge.pitch!==0||c.options.rotating||c.options.zooming||Zn.kind==="composite"||Zn.kind==="camera"?Te.LINEAR:Te.NEAREST);const Ur=wt.glyphAtlasTexture?wt.glyphAtlasTexture.size:[0,0],jn=a.layout.get("text-size-scale-range"),qr=r.aD(c.scaleFactor,jn[0],jn[1]),Ya=r.bH(Zn,ge.zoom,qr),No=as(Yt,wt.tileID.canonical,Ze,Le,ge,At.getProjection(),ci),Ka=Nc(Yt,wt.tileID.canonical,Ze,Le,ge,At.getProjection(),ci),Bo=c.translatePosMatrix(Ka,wt,A,z,!0),Zs=c.translatePosMatrix(Yt,wt,A,z),Fo=$n?oc:No,Jo=Le&&!Ze&&!tr;let Ra=bt;!pt&&!ge.mercatorFromTransition||Le||(Ra=ll(ge));const Sc=lh(Zn.kind,Ya,Jo,Ze,c,Zs,Fo,Bo,Ae,!0,Ur,ir,!0,dt,ai,et,Ai,Qt?Ra:bt,At.getProjection(),wi,null,null,qr),Qa=wt.glyphAtlasTexture?wt.glyphAtlasTexture:null,Ad=Te.LINEAR,Md=a.paint.get("text-halo-width").constantOr(1)!==0,Cd=c.terrain&&Ze&&tr?r.bi(r.bz(),No):oc;if(tr&&At.text){const Un=ge.elevation,kl=Un?Un.getAtTileOffsetFunc(dt,ge.center.lat,ge.worldSize,At.getProjection()):null,Rd=kc(Yt,wt.tileID.canonical,Ze,Le,ge,At.getProjection(),ci);Bc(At,Yt,c,!0,Rd,Ka,Ze,ee,kl,dt)}return{program:Sn,buffers:At.text,uniformValues:Sc,atlasTexture:Qa,atlasTextureIcon:ra,atlasInterpolation:Ad,atlasInterpolationIcon:En,isSDF:!0,hasHalo:Md,depthMode:Ni,tile:wt,renderWithShadows:zi,labelPlaneMatrixInv:Cd}},on=At.icon.segments.get().length,vn=At.text.segments.get().length,wn=on&&!v.onlyText?zn():null,Pn=vn&&!v.onlyIcons?Bi():null,er=a.paint.get("icon-opacity").constantOr(1),Ar=a.paint.get("text-opacity").constantOr(1);if(ht&&At.canOverlap){lt=!0;const tr=er&&!v.onlyText?At.icon.segments.get():[],ki=Ar&&!v.onlyIcons?At.text.segments.get():[];for(const $n of tr)tt.push({segments:new r.bd([$n]),sortKey:$n.sortKey,state:wn});for(const $n of ki)tt.push({segments:new r.bd([$n]),sortKey:$n.sortKey,state:Pn})}else v.onlyText||tt.push({segments:er?At.icon.segments:new r.bd([]),sortKey:0,state:wn}),v.onlyIcons||tt.push({segments:Ar?At.text.segments:new r.bd([]),sortKey:0,state:Pn})}lt&&tt.sort((dt,wt)=>dt.sortKey-wt.sortKey);for(const dt of tt){const wt=dt.state;if(wt)if(c.terrain?c.terrain.setupElevationDraw(wt.tile,wt.program,{useDepthForOcclusion:ge.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:wt.labelPlaneMatrixInv}):c.setupDepthForOcclusion(ge.depthOcclusionForSymbolsAndCircles,wt.program),Se.activeTexture.set(Te.TEXTURE0),wt.atlasTexture&&wt.atlasTexture.bind(wt.atlasInterpolation,Te.CLAMP_TO_EDGE,!0),wt.atlasTextureIcon&&(Se.activeTexture.set(Te.TEXTURE1),wt.atlasTextureIcon&&wt.atlasTextureIcon.bind(wt.atlasInterpolationIcon,Te.CLAMP_TO_EDGE,!0)),wt.renderWithShadows&&c.shadowRenderer.setupShadows(wt.tile.tileID.toUnwrapped(),wt.program,"vector-tile",wt.tile.tileID.overscaledZ),c.uploadCommonLightUniforms(c.context,wt.program),wt.hasHalo){const At=wt.uniformValues;At.u_is_halo=1,lc(wt.buffers,dt.segments,a,c,wt.program,wt.depthMode,p,g,At,2),At.u_is_halo=0}else{if(wt.isSDF){const At=wt.uniformValues;wt.hasHalo&&(At.u_is_halo=1,lc(wt.buffers,dt.segments,a,c,wt.program,wt.depthMode,p,g,At,1)),At.u_is_halo=0}lc(wt.buffers,dt.segments,a,c,wt.program,wt.depthMode,p,g,wt.uniformValues,1)}}}function lc(c,t,a,u,p,g,v,w,A,I){const z=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.iconTransitioningVertexBuffer,c.globeExtVertexBuffer,c.zOffsetVertexBuffer];p.draw(u,u.context.gl.TRIANGLES,g,v,w,Li.disabled,A,a.id,c.layoutVertexBuffer,c.indexBuffer,t,a.paint,u.transform.zoom,c.programConfigurations.get(a.id),z,I)}function hh(c,t){const a=1<<c.canonical.z,u=(t.x*a-c.canonical.x-c.wrap*a)*r.aj,p=(t.y*a-c.canonical.y)*r.aj,g=r.dS(t.z,t.y);return r.cS(u,p,g)}function Kr(c,t,a,u,p){if(!a.layout||a.layout.get("fill-elevation-reference")==="none")return;const g=c.context.gl,v=new ei(c.context.gl.LEQUAL,ei.ReadWrite,c.depthRangeFor3D),w=new ei(c.context.gl.GREATER,ei.ReadWrite,c.depthRangeFor3D),A=function(j){const Q=r.cJ(j.pitch);let Y=.01;return j.isOrthographic&&(Y=r.ai(1e-4,Y,r.cO(Q>=yl?1:Q/yl))),2*Y}(c.transform),I=c.transform.getFreeCameraOptions().position,z="elevatedStructuresDepthReconstruct",k=c.getOrCreateProgram(z,{defines:["DEPTH_RECONSTRUCTION"]}),O=c.getOrCreateProgram(z);for(const j of u){const Q=t.getTile(j),Y=Q.getBucket(a);if(!Y)continue;const ee=Y.elevatedStructures;if(!ee)continue;const K=Y.elevationBufferData.heightRange,se=hh(j.toUnwrapped(),I),pe=c.translatePosMatrix(j.projMatrix,Q,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));let ve,Ae,Se,Te;if(p==="initialize"){if(!K||K.min>=1||ee.depthSegments.segments[0].primitiveLength===0)continue;ve=au(pe,se,A,1,0),Ae=v,Se=ee.depthSegments,Te=k}else if(p==="reset"){if(!K||K.min>=0||ee.maskSegments.segments[0].primitiveLength===0)continue;ve=au(pe,se,0,0,1),Ae=w,Se=ee.maskSegments,Te=k}else if(p==="geometry"){if(ee.depthSegments.segments[0].primitiveLength===0)continue;ve=au(pe,se,A,1,0),Ae=v,Se=ee.depthSegments,Te=O}Te.draw(c,g.TRIANGLES,Ae,Di.disabled,Zi.disabled,Li.disabled,ve,a.id,ee.vertexBuffer,ee.indexBuffer,Se,a.paint,c.transform.zoom)}}function Wt(c,t,a){const{painter:u,sourceCache:p,layer:g,coords:v,colorMode:w,elevationType:A,terrainEnabled:I,pass:z}=c,k=u.context.gl,O=g.paint.get("fill-pattern"),j=g.paint.get("fill-pattern-cross-fade"),Q=O.constantOr(null);let Y=A;A!=="road"||t&&!I||(Y="none");const ee=Y==="road",K=c.painter.shadowRenderer,se=ee&&!!K&&K.enabled,pe=new ei(u.context.gl.LEQUAL,ei.ReadOnly,u.depthRangeFor3D);let ve=[0,0,0];if(se){const Te=u.style.directionalLight,ge=u.style.ambientLight;Te&&ge&&(ve=zs(u.style,Te,ge))}const Ae=O&&O.constantOr(1),Se=(Te,ge)=>{let Ce,Le,Qe,Ze,ht;ge?(Ce=Ae&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Qe=k.LINES):(Ce=Ae?"fillPattern":"fill",Qe=k.TRIANGLES);for(const lt of v){const Ct=p.getTile(lt);if(Ae&&!Ct.patternsLoaded())continue;const $e=Ct.getBucket(g);if(!$e)continue;const et=t?$e.elevationBufferData:$e.bufferData;if(et.isEmpty())continue;u.prepareDrawTile();const Ge=et.programConfigurations.get(g.id),pt=u.isTileAffectedByFog(lt),tt=[],bt=[];ee&&(tt.push("ELEVATED_ROADS"),bt.push(et.elevatedLayoutVertexBuffer)),se&&tt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ae&&(u.context.activeTexture.set(k.TEXTURE0),Ct.imageAtlasTexture&&Ct.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Ge.updatePaintBuffers());let dt=!1;if(Q&&Ct.imageAtlas){const Yt=Ct.imageAtlas,ci=r.dN.from(Q),ii=ci.getPrimary().scaleSelf(r.q.devicePixelRatio).toString(),Mi=ci.getSecondary(),Ni=Yt.patternPositions.get(ii),Ai=Mi?Yt.patternPositions.get(Mi.scaleSelf(r.q.devicePixelRatio).toString()):null;dt=!!Ni&&!!Ai,Ni&&Ge.setConstantPatternPositions(Ni,Ai)}j>0&&(dt||Ge.getPatternTransitionVertexBuffer("fill-pattern"))&&tt.push("FILL_PATTERN_TRANSITION");const wt=u.getOrCreateProgram(Ce,{config:Ge,overrideFog:pt,defines:tt}),At=u.translatePosMatrix(lt.projMatrix,Ct,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor"));se&&K.setupShadows(Ct.tileID.toUnwrapped(),wt,"vector-tile",Ct.tileID.overscaledZ);const Qt=g.paint.get("fill-emissive-strength");if(ge){Ze=et.lineIndexBuffer,ht=et.lineSegments;const Yt=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];Le=Ce==="fillOutlinePattern"&&Ae?km(At,Qt,u,Ct,Yt,ve,j):od(At,Qt,Yt,ve)}else Ze=et.indexBuffer,ht=et.triangleSegments,Le=Ae?vp(At,Qt,u,Ct,ve,j):ad(At,Qt,ve);u.uploadCommonUniforms(u.context,wt,lt.toUnwrapped());let ai=Te;(A==="road"&&!I||A==="offset")&&(ai=pe),wt.draw(u,Qe,ai,a||u.stencilModeForClipping(lt),w,Li.disabled,Le,g.id,et.layoutVertexBuffer,Ze,ht,g.paint,u.transform.zoom,Ge,bt)}};u.renderPass===z&&Se(u.depthModeForSublayer(1,u.renderPass==="opaque"?ei.ReadWrite:ei.ReadOnly),!1),Y==="none"&&u.renderPass==="translucent"&&g.paint.get("fill-antialias")&&Se(u.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,ei.ReadOnly),!0)}function su(c,t,a,u,p,g,v,w){a.resetLayerRenderingStats(c);const A=c.context,I=A.gl,z=c.transform,k=a.paint.get("fill-extrusion-pattern"),O=a.paint.get("fill-extrusion-pattern-cross-fade"),j=k.constantOr(null),Q=k.constantOr(1),Y=a.paint.get("fill-extrusion-opacity"),ee=c.style.enable3dLights(),K=a.paint.get(ee&&!Q?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),se=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),K],pe=a.layout.get("fill-extrusion-edge-radius"),ve=pe>0&&!a.paint.get("fill-extrusion-rounded-roof"),Ae=ve?0:pe,Se=z.projection.name==="globe"?r.dT():0,Te=z.projection.name==="globe",ge=Te?r.ah(z.zoom):0,Ce=[r.ay(z.center.lng),r.aH(z.center.lat)],Le=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Qe=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(Le?null:a.lut).toArray01().slice(0,3),Ze=a.paint.get("fill-extrusion-flood-light-intensity"),ht=a.paint.get("fill-extrusion-vertical-scale"),lt=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ct=a.paint.get("fill-extrusion-height-alignment"),$e=a.paint.get("fill-extrusion-base-alignment"),et=$c(c,a.paint.get("fill-extrusion-cutoff-fade-range")),Ge=[];let pt;Te&&Ge.push("PROJECTION_GLOBE_VIEW"),se[0]>0&&Ge.push("FAUX_AO"),ve&&Ge.push("ZERO_ROOF_RADIUS"),w&&Ge.push("HAS_CENTROID"),Ze>0&&Ge.push("FLOOD_LIGHT"),et.shouldRenderCutoff&&Ge.push("RENDER_CUTOFF"),lt&&Ge.push("RENDER_WALL_MODE");const tt=c.renderPass==="shadow",bt=c.shadowRenderer,dt=tt&&!!bt,wt=tt?Li.disabled:Li.backCCW;c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!0);let At=[0,0,0];if(bt){const Yt=c.style.directionalLight,ci=c.style.ambientLight;Yt&&ci&&(At=zs(c.style,Yt,ci)),tt||(Ge.push("RENDER_SHADOWS","DEPTH_TEXTURE"),bt.useNormalOffset&&Ge.push("NORMAL_OFFSET")),pt=Ge.concat(["SHADOWS_SINGLE_CASCADE"])}const Qt=dt?"fillExtrusionDepth":Q?"fillExtrusionPattern":"fillExtrusion",ai=a.getLayerRenderingStats();for(const Yt of u){const ci=t.getTile(Yt),ii=ci.getBucket(a);if(!ii||ii.projection.name!==z.projection.name)continue;let Mi=!1;bt&&(Mi=bt.getMaxCascadeForTile(Yt.toUnwrapped())===0);const Ni=c.isTileAffectedByFog(Yt),Ai=ii.programConfigurations.get(a.id);let Hi=!1;if(j&&ci.imageAtlas){const vn=ci.imageAtlas,wn=r.dN.from(j),Pn=wn.getPrimary().scaleSelf(r.q.devicePixelRatio).toString(),er=wn.getSecondary(),Ar=vn.patternPositions.get(Pn),tr=er?vn.patternPositions.get(er.scaleSelf(r.q.devicePixelRatio).toString()):null;Hi=!!Ar&&!!tr,Ar&&Ai.setConstantPatternPositions(Ar,tr)}O>0&&(Hi||Ai.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ge.push("FILL_EXTRUSION_PATTERN_TRANSITION");const zi=c.getOrCreateProgram(Qt,{config:Ai,defines:Mi?pt:Ge,overrideFog:Ni});if(c.terrain&&c.terrain.setupElevationDraw(ci,zi,{useMeterToDem:!0}),!ii.centroidVertexBuffer){const vn=zi.attributes.a_centroid_pos;vn!==void 0&&I.vertexAttrib2f(vn,0,0)}!tt&&bt&&bt.setupShadows(ci.tileID.toUnwrapped(),zi,"vector-tile",ci.tileID.overscaledZ),Q&&(c.context.activeTexture.set(I.TEXTURE0),ci.imageAtlasTexture&&ci.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Ai.updatePaintBuffers());const wi=a.paint.get("fill-extrusion-vertical-gradient"),an=1/ii.tileToMeter;let zn;if(tt&&bt){if(Tp(ci.tileID,ii,c))continue;const vn=bt.calculateShadowPassMatrixFromTile(ci.tileID.toUnwrapped());zn=ru(vn,Ae,an,ht,Ct,$e)}else{const vn=c.translatePosMatrix(Yt.expandedProjMatrix,ci,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),wn=z.projection.createInversionMatrix(z,Yt.canonical);zn=Q?yp(vn,c,wi,Y,se,Ae,an,Yt,ci,Se,Ct,$e,ge,Ce,wn,Qe,ht,O):nc(vn,c,wi,Y,se,Ae,an,Yt,Se,Ct,$e,ge,Ce,wn,Qe,ht,Ze,At)}c.uploadCommonUniforms(A,zi,Yt.toUnwrapped(),null,et);let Bi=ii.segments;if(z.projection.name==="mercator"&&!tt&&(Bi=ii.getVisibleSegments(ci.tileID,c.terrain,c.transform.getFrustum(0)),!Bi.get().length))continue;if(ai)if(tt)for(const vn of Bi.get())ai.numRenderedVerticesInShadowPass+=vn.primitiveLength;else for(const vn of Bi.get())ai.numRenderedVerticesInTransparentPass+=vn.primitiveLength;const on=[];(c.terrain||w)&&on.push(ii.centroidVertexBuffer),Te&&on.push(ii.layoutVertexExtBuffer),lt&&on.push(ii.wallVertexBuffer),zi.draw(c,A.gl.TRIANGLES,p,g,v,wt,zn,a.id,ii.layoutVertexBuffer,ii.indexBuffer,Bi,a.paint,c.transform.zoom,Ai,on)}c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!1)}function cc(c,t,a,u,p,g,v,w,A,I,z,k,O,j,Q,Y,ee,K,se){const pe=c.context,ve=pe.gl,Ae=c.transform,Se=c.transform.zoom,Te=[],ge=$c(c,a.paint.get("fill-extrusion-cutoff-fade-range"));I==="clear"?(Te.push("CLEAR_SUBPASS"),se&&(Te.push("CLEAR_FROM_TEXTURE"),pe.activeTexture.set(ve.TEXTURE0),se.bind(ve.LINEAR,ve.CLAMP_TO_EDGE))):I==="sdf"&&Te.push("SDF_SUBPASS"),ee&&Te.push("HAS_CENTROID"),ge.shouldRenderCutoff&&Te.push("RENDER_CUTOFF");const Ce=a.layout.get("fill-extrusion-edge-radius"),Le=(Qe,Ze,ht,lt,Ct)=>{const $e=Ze.programConfigurations.get(a.id),et=c.isTileAffectedByFog(Qe),Ge=c.getOrCreateProgram("fillExtrusionGroundEffect",{config:$e,defines:Te,overrideFog:et}),pt=((bt,dt,wt,At,Qt,ai,Yt,ci,ii,Mi,Ni)=>({u_matrix:dt,u_opacity:wt,u_ao_pass:At?1:0,u_meter_to_tile:Qt,u_ao:ai,u_flood_light_intensity:Yt,u_flood_light_color:ci,u_attenuation:ii,u_edge_radius:Mi,u_fb:0,u_fb_size:Ni,u_dynamic_offset:1}))(0,lt,z,A,Ct,[k,O*Ct],j,Q,Y,Se>=17?0:Ce*Ct,se?se.size[0]:0),tt=[];ee&&tt.push(Ze.hiddenByLandmarkVertexBuffer),c.uploadCommonUniforms(pe,Ge,Qe.toUnwrapped(),null,ge),Ge.draw(c,pe.gl.TRIANGLES,p,g,v,w,pt,a.id,Ze.vertexBuffer,Ze.indexBuffer,ht,a.paint,Se,$e,tt)};for(const Qe of u){const Ze=t.getTile(Qe),ht=Ze.getBucket(a);if(!ht||ht.projection.name!==Ae.projection.name||!ht.groundEffect||ht.groundEffect&&!ht.groundEffect.hasData())continue;const lt=ht.groundEffect,Ct=1/ht.tileToMeter;{const $e=c.translatePosMatrix(Qe.projMatrix,Ze,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),et=lt.getDefaultSegment();Le(Qe,lt,et,$e,Ct)}if(K)for(let $e=0;$e<4;$e++){const et=r.dU[$e](Qe),Ge=t.getTile(et);if(!Ge)continue;const pt=Ge.getBucket(a);if(!pt||pt.projection.name!==Ae.projection.name||!pt.groundEffect||pt.groundEffect&&!pt.groundEffect.hasData())continue;const tt=pt.groundEffect;let bt,dt;$e===0?(bt=[-r.aj,0,0],dt=1):$e===1?(bt=[r.aj,0,0],dt=0):$e===2?(bt=[0,-r.aj,0],dt=3):(bt=[0,r.aj,0],dt=2);const wt=tt.regionSegments[dt];if(!wt)continue;const At=new Float32Array(16);r.bo(At,Qe.projMatrix,bt),Le(Qe,tt,wt,c.translatePosMatrix(At,Ze,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ct)}}}function Cl(c,t,a,u,p,g,v){u.centroidVertexArray.length===0&&u.createCentroidsBuffer();const w=g?g.findDEMTileFor(a):null;if(!(w&&w.dem||v))return;g&&w&&w.dem&&u.selfDEMTileTimestamp!==w.dem._timestamp&&(u.borderDoneWithNeighborZ=[-1,-1,-1,-1],u.selfDEMTileTimestamp=w.dem._timestamp);const A=K=>new r.P(Math.ceil((K+r.dX)*r.dY),0),I=K=>{const se=t.getSource().minzoom,pe=Ae=>{const Se=t.getTileByID(Ae);if(Se&&Se.hasData())return Se.getBucket(p)},ve=[0,-1,1];for(const Ae of ve){if(K.overscaledZ+Ae<se)continue;const Se=pe(K.calculateScaledKey(K.overscaledZ+Ae));if(Se)return Se}},z=[0,0,0],k=(K,se)=>(z[0]=Math.min(K.min.y,se.min.y),z[1]=Math.max(K.max.y,se.max.y),z[2]=r.aj-se.min.x>K.max.x?se.min.x-r.aj:K.max.x,z),O=(K,se)=>(z[0]=Math.min(K.min.x,se.min.x),z[1]=Math.max(K.max.x,se.max.x),z[2]=r.aj-se.min.y>K.max.y?se.min.y-r.aj:K.max.y,z),j=[(K,se)=>k(K,se),(K,se)=>k(se,K),(K,se)=>O(K,se),(K,se)=>O(se,K)],Q=(K,se,pe,ve,Ae,Se,Te)=>{if(!g)return 0;const ge=[[Se?pe:K,Se?K:pe,0],[Se?pe:se,Se?se:pe,0]],Ce=Te<0?r.aj+Te:Te,Le=[Se?Ce:(K+se)/2,Se?(K+se)/2:Ce,0];return pe===0&&Te<0||pe!==0&&Te>0?g.getForTilePoints(Ae,[Le],!0,ve):ge.push(Le),g.getForTilePoints(a,ge,!0,w),Math.max(ge[0][2],ge[1][2],Le[2])/g.exaggeration()};for(let K=0;K<4;K++){const se=u.borderFeatureIndices[K];if(se.length===0)continue;const pe=r.dU[K](a),ve=I(pe);if(!(ve&&ve instanceof r.dV))continue;const Ae=g?g.findDEMTileFor(pe):null;if(!(Ae&&Ae.dem||v)||(g&&Ae&&Ae.dem&&u.borderDEMTileTimestamp[K]!==Ae.dem._timestamp&&(u.borderDoneWithNeighborZ[K]=-1,u.borderDEMTileTimestamp[K]=Ae.dem._timestamp),u.borderDoneWithNeighborZ[K]===ve.canonical.z))continue;ve.centroidVertexArray.length===0&&ve.createCentroidsBuffer();const Se=(K<2?1:5)-K,Te=ve.borderDoneWithNeighborZ[Se]!==u.canonical.z,ge=ve.borderFeatureIndices[Se];let Ce=0;if(u.canonical.z!==ve.canonical.z){for(const Le of se)u.showCentroid(u.featuresOnBorder[Le]);if(Te)for(const Le of ge)ve.showCentroid(ve.featuresOnBorder[Le]);u.borderDoneWithNeighborZ[K]=ve.canonical.z,ve.borderDoneWithNeighborZ[Se]=u.canonical.z}for(const Le of se){const Qe=u.featuresOnBorder[Le],Ze=u.centroidData[Qe.centroidDataIndex],ht=Qe.borders[K];let lt;for(;Ce<ge.length;){lt=ve.featuresOnBorder[ge[Ce]];const Ct=lt.borders[Se];if(Ct[1]>ht[0]+3||Ct[0]>ht[0]-3)break;ve.showCentroid(lt),Ce++}if(lt&&Ce<ge.length){const Ct=Ce;let $e=0;for(;!(lt.borders[Se][0]>ht[1]-3)&&($e++,++Ce!==ge.length);)lt=ve.featuresOnBorder[ge[Ce]];lt=ve.featuresOnBorder[ge[Ct]];let et=!1;if($e>=1){const tt=lt.borders[Se];Math.abs(ht[0]-tt[0])<3&&Math.abs(ht[1]-tt[1])<3&&($e=1,et=!0,Ce=Ct+1)}else if($e===0){u.showCentroid(Qe);continue}const Ge=ve.centroidData[lt.centroidDataIndex];v&&et&&(((Y=Ze).flags|(ee=Ge).flags)&r.dW?(Y.flags|=r.dW,ee.flags|=r.dW):(Y.flags&=~r.dW,ee.flags&=~r.dW));const pt=Qe.intersectsCount()>1||lt.intersectsCount()>1;if($e>1)Ce=Ct,Ze.centroidXY=Ge.centroidXY=new r.P(0,0);else if(Ae&&Ae.dem&&!pt){const tt=j[K](Ze,Ge),bt=K%2?r.aj-1:0,dt=Q(tt[0],Math.min(r.aj-1,tt[1]),bt,Ae,pe,K<2,tt[2]);Ze.centroidXY=Ge.centroidXY=A(dt)}else pt?Ze.centroidXY=Ge.centroidXY=new r.P(0,0):(Ze.centroidXY=u.encodeBorderCentroid(Qe),Ge.centroidXY=ve.encodeBorderCentroid(lt));u.writeCentroidToBuffer(Ze),ve.writeCentroidToBuffer(Ge)}else u.showCentroid(Qe)}u.borderDoneWithNeighborZ[K]=ve.canonical.z,ve.borderDoneWithNeighborZ[Se]=u.canonical.z}var Y,ee;(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(c)}const uc=[1,0,0],Si=[0,1,0],hd=[0,0,1];function Tp(c,t,a){const u=a.transform,p=a.shadowRenderer;if(!p)return!0;const g=c.toUnwrapped(),v=u.tileSize*p._cascades[a.currentShadowCascade].scale;let w=t.maxHeight;if(u.elevation){const Y=u.elevation.getMinMaxForTile(c);Y&&(w+=Y.max)}const A=[...p.shadowDirection];A[2]=-A[2];const I=p.computeSimplifiedTileShadowVolume(g,w,v,A);if(!I)return!1;const z=[uc,Si,hd,A,[A[0],0,A[2]],[0,A[1],A[2]]],k=u.projection.name==="globe",O=u.scaleZoom(v),j=r.cn.fromInvProjectionMatrix(u.invProjMatrix,u.worldSize,O,!k),Q=p.getCurrentCascadeFrustum();return j.intersectsPrecise(I.vertices,I.planes,z)===0||Q.intersectsPrecise(I.vertices,I.planes,z)===0}function fo(c){return[c[0]*r.dZ,c[1]*r.dZ,c[2]*r.dZ,0]}function na(c,t,a,u,p,g,v,w,A){const I=u.getSource(),z=a.globeSharedBuffers;if(!z)return;let k,O,j;if(t&&(k=u.getTile(t)),I instanceof r.aP?(O=I.texture,j=r.ds(0,0,a.transform)):k&&t&&(O=k.texture,j=r.ds(t.canonical.z,t.canonical.x,a.transform)),!O||!j)return;c||(j=r.cE(r.bz(),j,[1,-1,1]));const Q=a.context,Y=Q.gl,ee=p.paint.get("raster-resampling")==="nearest"?Y.NEAREST:Y.LINEAR,K=a.colorModeForDrapableLayerRenderPass(g),se=v.defines;se.push("GLOBE_POLES");const pe=new ei(Y.LEQUAL,ei.ReadWrite,a.depthRangeFor3D),ve=Float32Array.from(a.transform.expandedFarZProjMatrix),Ae=Float32Array.from(r.bh(r.dr(new r.cp(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),Q.activeTexture.set(Y.TEXTURE0),O.bind(ee,Y.CLAMP_TO_EDGE),Q.activeTexture.set(Y.TEXTURE1),O.bind(ee,Y.CLAMP_TO_EDGE),"useMipmap"in O&&Q.extTextureFilterAnisotropic&&a.transform.pitch>20&&Y.texParameterf(Y.TEXTURE_2D,Q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Q.extTextureFilterAnisotropicMax);const[Se,Te,ge,Ce]=t?z.getPoleBuffers(t.canonical.z,!1):z.getPoleBuffers(0,!0),Le=p.paint.get("raster-elevation");let Qe;c?(Qe=Se,a.renderDefaultNorthPole=Le!==0):(Qe=Te,a.renderDefaultSouthPole=Le!==0);const Ze=fo(v.mix),ht=((Ct,$e,et,Ge,pt,tt,bt,dt,wt,At,Qt,ai,Yt)=>uo(Ct,$e,et,new Float32Array(16),new Float32Array(9),[0,0],Ge,[0,0],[0,0,0,0],1,{opacity:1,mix:0},tt,[0,0],dt,2,At,Qt,ai,1,0,Yt))(ve,Ae,j,r.ah(a.transform.zoom),0,p,0,Le,0,Ze,v.offset,v.range,g),lt=a.getOrCreateProgram("raster",{defines:se});a.uploadCommonUniforms(Q,lt,null),lt.draw(a,Y.TRIANGLES,pe,A,K,w,ht,p.id,Qe,ge,Ce)}function _f(c){const t=c._nearZ,a=c.projection.farthestPixelDistance(c),u=a-t,p=.2*c.height,g=t+p;return[t,a,(g-p-t)/u,(g-t)/u]}function dd(c,t,a,u){if(c)return t instanceof ma&&c instanceof kh?t.getTextureDescriptor(c,a,!0):{texture:c.texture,mix:fo(u.mix),offset:u.offset,buffer:0,tileSize:1}}var fd=r.d_([{name:"a_index",type:"Int16",components:1}]);class Sp{constructor(t,a,u,p){const g={width:u[0],height:u[1],data:null},v=t.gl;this.targetColorTexture=new r.T(t,g,v.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(t,g,v.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(a,p),this.lastInvalidatedAt=0}updateParticleTexture(t,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const u=this.context.gl,p=a.width*a.height;this.particleTexture0=new r.T(this.context,a,u.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,a,u.RGBA8,{premultiply:!1,useMipmap:!1});const g=new r.d$;g.reserve(p);for(let v=0;v<p;v++)g.emplaceBack(v);this.particleIndexBuffer=this.context.createVertexBuffer(g,fd.members,!0),this.particleSegment=r.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=r.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Rl(c,t,a){if(!c)return null;const u=t.getTextureDescriptor(c,a,!0);if(!u)return null;let{texture:p,mix:g,offset:v,tileSize:w,buffer:A,format:I}=u;if(!p||!I)return null;let z=!1;return I==="uint32"&&(z=!0,g[3]=0,g=pf(r.e0,g,[0,a.paint.get("raster-particle-max-speed")]),v=sd(r.e0,v,[0,a.paint.get("raster-particle-max-speed")])),{texture:p,textureOffset:[A/(w+2*A),w/(w+2*A)],tileSize:w,scalarData:z,scale:g,offset:v,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[I]]}}function dh(c){const t=c._nearZ,a=c.projection.farthestPixelDistance(c),u=a-t,p=.2*c.height,g=t+p;return[t,a,(g-p-t)/u,(g-t)/u]}const pd=new r.am(1,0,0,1),md=new r.am(0,1,0,1),yf=new r.am(0,0,1,1),po=new r.am(1,0,1,1),Il=new r.am(0,1,1,1);function hc(c,t,a,u,p,g,v){const w=c.context,A=c.transform,I=w.gl,z=A.projection.name==="globe",k=z?["PROJECTION_GLOBE_VIEW"]:[];let O=r.bw(a.projMatrix);if(z&&r.ah(A.zoom)>0){const Ze=r.bg(a.canonical,A),ht=r.e1(Ze);O=r.az(new Float32Array(16),A.globeMatrix,ht),r.az(O,A.projMatrix,O)}const j=r.bz();j[12]+=2*p/(r.q.devicePixelRatio*A.width),j[13]+=2*g/(r.q.devicePixelRatio*A.height),r.az(O,j,O);const Q=c.getOrCreateProgram("debug",{defines:k}),Y=t.getTileByID(a.key);c.terrain&&c.terrain.setupElevationDraw(Y,Q);const ee=ei.disabled,K=Di.disabled,se=c.colorModeForRenderPass(),pe="$debug";w.activeTexture.set(I.TEXTURE0),c.emptyTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),z?Y._makeGlobeTileDebugBuffers(c.context,A):Y._makeDebugTileBoundsBuffers(c.context,A.projection);const ve=Y._tileDebugBuffer||c.debugBuffer,Ae=Y._tileDebugIndexBuffer||c.debugIndexBuffer,Se=Y._tileDebugSegments||c.debugSegments;if(Q.draw(c,I.LINE_STRIP,ee,K,se,Li.disabled,al(O,u),pe,ve,Ae,Se,null,null,null,[Y._globeTileDebugBorderBuffer]),v){const Ze=Y.latestRawTileData,ht=Math.floor((Ze&&Ze.byteLength||0)/1024);let lt=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(lt+=` => ${a.overscaledZ}`),lt+=` ${Y.state}`,lt+=` ${ht}kb`,function(Ct,$e){Ct.initDebugOverlayCanvas();const et=Ct.debugOverlayCanvas,Ge=Ct.context.gl,pt=Ct.debugOverlayCanvas.getContext("2d");pt.clearRect(0,0,et.width,et.height),pt.shadowColor="white",pt.shadowBlur=2,pt.lineWidth=1.5,pt.strokeStyle="white",pt.textBaseline="top",pt.font="bold 36px Open Sans, sans-serif",pt.fillText($e,5,5),pt.strokeText($e,5,5),Ct.debugOverlayTexture.update(et),Ct.debugOverlayTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE)}(c,lt)}const Te=t.getTile(a).tileSize,ge=512/Math.min(Te,512)*(a.overscaledZ/A.zoom)*.5,Ce=Y._tileDebugTextBuffer||c.debugBuffer,Le=Y._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,Qe=Y._tileDebugTextSegments||c.debugSegments;Q.draw(c,I.TRIANGLES,ee,K,Zi.alphaBlended,Li.disabled,al(O,r.am.transparent,ge),pe,Ce,Le,Qe,null,null,null,[Y._globeTileDebugTextBuffer])}function gd(c,t,a,u){dc(c,0,t+a/2,c.transform.width,a,u)}function _d(c,t,a,u){dc(c,t-a/2,0,a,c.transform.height,u)}function dc(c,t,a,u,p,g){const v=c.context,w=v.gl;w.enable(w.SCISSOR_TEST),w.scissor(t*r.q.devicePixelRatio,a*r.q.devicePixelRatio,u*r.q.devicePixelRatio,p*r.q.devicePixelRatio),v.clear({color:g}),w.disable(w.SCISSOR_TEST)}const Ep=r.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:fs}=Ep;function Fn(c,t,a,u){c.emplaceBack(t,a,u)}class fh{constructor(t){this.vertexArray=new r.e2,this.indices=new r.a_,Fn(this.vertexArray,-1,-1,1),Fn(this.vertexArray,1,-1,1),Fn(this.vertexArray,-1,1,1),Fn(this.vertexArray,1,1,1),Fn(this.vertexArray,-1,-1,-1),Fn(this.vertexArray,1,-1,-1),Fn(this.vertexArray,-1,1,-1),Fn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,fs),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=r.bd.simpleSegment(0,0,36,12)}}function Dl(c,t,a,u,p,g){const v=c.context.gl,w=t.paint.get("sky-atmosphere-color"),A=t.paint.get("sky-atmosphere-halo-color"),I=t.paint.get("sky-atmosphere-sun-intensity"),z=((k,O,j,Q,Y)=>({u_matrix_3f:k,u_sun_direction:O,u_sun_intensity:j,u_color_tint_r:[Q.r,Q.g,Q.b,Q.a],u_color_tint_m:[Y.r,Y.g,Y.b,Y.a],u_luminance:5e-5}))(r.e4(r.dx(),u),p,I,w,A);v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_CUBE_MAP_POSITIVE_X+g,t.skyboxTexture,0),a.draw(c,v.TRIANGLES,ei.disabled,Di.disabled,Zi.unblended,Li.frontCW,z,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const vf=r.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ap{constructor(t){const a=new r.e5;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const u=new r.a_;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(a,vf.members),this.indexBuffer=t.createIndexBuffer(u),this.segments=r.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Mp=r.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Nm{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class lu{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Zi([1,$a,1,$a],r.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Zi([1,0,1,0],r.am.transparent,[!1,!1,!1,!0]),this.params=new Nm,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const a=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ap(a);const u=this.params.sizeRange,p=this.params.intensityRange,g=function(z){const k=r.ea(30),O=[];for(let j=0;j<z;++j){const Q=2*Math.PI*k(),Y=Math.acos(1-2*k())-.5*Math.PI;O.push(r.cS(Math.cos(Y)*Math.cos(Q),Math.cos(Y)*Math.sin(Q),Math.sin(Y)))}return O}(this.params.starsCount),v=r.ea(300),w=new r.e6,A=new r.a_;let I=0;for(let z=0;z<g.length;++z){const k=r.b$([],g[z],200),O=Math.max(0,1+.01*u*(1*v()-.5)),j=Math.max(0,1+.01*p*(1*v()-.5));w.emplaceBack(k[0],k[1],k[2],-1,-1,O,j),w.emplaceBack(k[0],k[1],k[2],1,-1,O,j),w.emplaceBack(k[0],k[1],k[2],1,1,O,j),w.emplaceBack(k[0],k[1],k[2],-1,1,O,j),A.emplaceBack(I+0,I+1,I+2),A.emplaceBack(I+0,I+2,I+3),I+=4}this.starsVx=a.createVertexBuffer(w,Mp.members),this.starsIdx=a.createIndexBuffer(A),this.starsSegments=r.bd.simpleSegment(0,0,w.length,A.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,a){const u=t.context,p=u.gl,g=t.transform,v=new ei(p.LEQUAL,ei.ReadOnly,[0,1]),w=r.ah(g.zoom),A=t.style.getLut(a.scope),I=a.properties.get("color-use-theme")==="none",z=a.properties.get("color").toRenderColor(I?null:A).toArray01(),k=a.properties.get("high-color-use-theme")==="none",O=a.properties.get("high-color").toRenderColor(k?null:A).toArray01(),j=a.properties.get("space-color-use-theme")==="none",Q=a.properties.get("space-color").toRenderColor(j?null:A).toArray01PremultipliedAlpha(),Y=5e-4,ee=r.e7(a.properties.get("horizon-blend"),0,1,Y,.25),K=r.dl(t,u,g)&&ee===Y?g.worldSize/(2*Math.PI*1.025)-1:g.globeRadius,se=t.frameCounter/1e3%1,pe=r.ae(g.globeCenterInViewSpace),ve=Math.sqrt(Math.pow(pe,2)-Math.pow(K,2)),Ae=Math.acos(ve/pe),Se=Te=>{const ge=g.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Te&&ge.push("ALPHA_PASS");const Ce=t.getOrCreateProgram("globeAtmosphere",{defines:ge}),Le=((Ze,ht,lt,Ct,$e,et,Ge,pt,tt,bt,dt,wt)=>({u_frustum_tl:Ze,u_frustum_tr:ht,u_frustum_br:lt,u_frustum_bl:Ct,u_horizon:$e,u_transition:et,u_fadeout_range:Ge,u_color:pt,u_high_color:tt,u_space_color:bt,u_temporal_offset:dt,u_horizon_angle:wt}))(g.frustumCorners.TL,g.frustumCorners.TR,g.frustumCorners.BR,g.frustumCorners.BL,g.frustumCorners.horizon,w,ee,z,O,Q,se,Ae);t.uploadCommonUniforms(u,Ce);const Qe=this.atmosphereBuffer;Qe&&Ce.draw(t,p.TRIANGLES,v,Di.disabled,Te?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Li.backCW,Le,Te?"atmosphere_glow_alpha":"atmosphere_glow",Qe.vertexBuffer,Qe.indexBuffer,Qe.segments)};Se(!1),Se(!0)}drawStars(t,a){const u=r.aD(a.properties.get("star-intensity"),0,1);if(u===0)return;const p=t.context,g=p.gl,v=t.transform,w=t.getOrCreateProgram("stars"),A=r.bY([]);r.b_(A,A,-v._pitch),r.bZ(A,A,-v.angle),r.b_(A,A,r.al(v._center.lat)),r.e8(A,A,-r.al(v._center.lng));const I=r.c3(new Float32Array(16),A),z=r.az([],v.starsProjMatrix,I),k=r.e4([],I),O=r.e9([],k),j=[0,1,0];r.dz(j,j,O),r.b$(j,j,this.params.sizeMultiplier);const Q=[1,0,0];r.dz(Q,Q,O),r.b$(Q,Q,this.params.sizeMultiplier);const Y=(ee=j,K=Q,se=u,{u_matrix:Float32Array.from(z),u_up:ee,u_right:K,u_intensity_multiplier:se});var ee,K,se;t.uploadCommonUniforms(p,w),this.starsVx&&this.starsIdx&&w.draw(t,g.TRIANGLES,ei.disabled,Di.disabled,this.colorModeAlphaBlendedWriteRGB,Li.disabled,Y,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function fc(c,t){const a=[...c],u=t.cameraWorldSizeForFog/t.worldSize,p=r.bx([]);return r.cE(p,p,[u,u,1]),r.az(a,p,a),r.az(a,t.worldToFogMatrix,a),a}function Nt(c,t,a,u,p){const g=a.material,v=u.context,{baseColorTexture:w,metallicRoughnessTexture:A}=g.pbrMetallicRoughness,{normalTexture:I,occlusionTexture:z,emissionTexture:k}=g;function O(Q,Y,ee){if(Q&&(c.push(Y),v.activeTexture.set(v.gl.TEXTURE0+ee),Q.gfxTexture)){const{minFilter:K,magFilter:se,wrapS:pe,wrapT:ve}=Q.sampler;Q.gfxTexture.bindExtraParam(K,se,pe,ve)}}O(w,"HAS_TEXTURE_u_baseColorTexture",Oa.BaseColor),O(A,"HAS_TEXTURE_u_metallicRoughnessTexture",Oa.MetallicRoughness),O(I,"HAS_TEXTURE_u_normalTexture",Oa.Normal),O(z,"HAS_TEXTURE_u_occlusionTexture",Oa.Occlusion),O(k,"HAS_TEXTURE_u_emissionTexture",Oa.Emission),p&&(p.texture||(p.texture=new r.ed(u.context,p.image,[p.image.height,p.image.height,p.image.height],v.gl.RGBA8)),v.activeTexture.set(v.gl.TEXTURE0+Oa.LUT),p.texture&&p.texture.bind(v.gl.LINEAR,v.gl.CLAMP_TO_EDGE),c.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(c.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(a.texcoordBuffer)),a.colorBuffer&&(c.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(a.colorBuffer)),a.normalBuffer&&(c.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(a.normalBuffer)),a.pbrBuffer&&(c.push("HAS_ATTRIBUTE_a_pbr"),c.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(a.pbrBuffer)),g.alphaMode!=="OPAQUE"&&g.alphaMode!=="MASK"||c.push("UNPREMULT_TEXTURE_IN_SHADER"),g.defined||c.push("DIFFUSE_SHADED");const j=u.shadowRenderer;j&&(c.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&c.push("NORMAL_OFFSET"))}function Xt(c,t,a,u,p,g){const v=a.paint.get("model-opacity").constantOr(1),w=t.context,A=new ei(t.context.gl.LEQUAL,ei.ReadWrite,t.depthRangeFor3D),I=t.transform,z=c.mesh,k=z.material,O=k.pbrMetallicRoughness,j=t.style.fog;let Q;Q=t.transform.projection.zAxisUnit==="pixels"?[...c.nodeModelMatrix]:r.az([],u.zScaleMatrix,c.nodeModelMatrix),r.az(Q,u.negCameraPosMatrix,Q);const Y=r.bi([],Q);r.ee(Y,Y);const ee=a.paint.get("model-color-use-theme").constantOr("default")==="none",K=a.paint.get("model-emissive-strength").constantOr(0),se=ac(new Float32Array(c.worldViewProjection),new Float32Array(Q),new Float32Array(Y),null,t,v,O.baseColorFactor.toRenderColor(null),k.emissiveFactor,O.metallicFactor,O.roughnessFactor,k,K,a),pe={defines:[]},ve=[],Ae=t.shadowRenderer;Ae&&(Ae.useNormalOffset=!1),Nt(pe.defines,ve,z,t,ee?null:a.lut);let Se=null;if(j){const Ce=fc(c.nodeModelMatrix,t.transform);if(Se=new Float32Array(Ce),I.projection.name!=="globe"){const Le=z.aabb.min,Qe=z.aabb.max,[Ze,ht]=j.getOpacityForBounds(Ce,Le[0],Le[1],Qe[0],Qe[1]);pe.overrideFog=Ze>=Pt||ht>=Pt}}const Te=$c(t,a.paint.get("model-cutoff-fade-range"));Te.shouldRenderCutoff&&pe.defines.push("RENDER_CUTOFF");const ge=t.getOrCreateProgram("model",pe);t.uploadCommonUniforms(w,ge,null,Se,Te),t.renderPass!=="shadow"&&Ae&&Ae.setupShadowsFromMatrix(c.nodeModelMatrix,ge),ge.draw(t,w.gl.TRIANGLES,A,p,g,z.material.doubleSided?Li.disabled:Li.backCCW,se,a.id,z.vertexBuffer,z.indexBuffer,z.segments,a.paint,t.transform.zoom,void 0,ve)}function ps(c,t,a,u,p,g,v){let w;w=c.projection.name==="globe"?r.ef(a,c):[...a],r.az(w,w,t.matrix);const A=r.az([],u,w);if(t.meshes)for(const I of t.meshes){if(I.material.alphaMode!=="BLEND"){v.push({mesh:I,depth:0,modelIndex:p,worldViewProjection:A,nodeModelMatrix:w});continue}const z=r.ad([],I.centroid,A);!c.isOrthographic&&z[2]<=0||g.push({mesh:I,depth:z[2],modelIndex:p,worldViewProjection:A,nodeModelMatrix:w})}if(t.children)for(const I of t.children)ps(c,I,a,u,p,g,v)}function wr(c,t,a,u){const p=a.shadowRenderer;if(!p)return;const g=p.getShadowPassDepthMode(),v=p.getShadowPassColorMode(),w=p.calculateShadowPassMatrixFromMatrix(t),A=ou(w);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,g,Di.disabled,v,Li.backCCW,A,u.id,c.vertexBuffer,c.indexBuffer,c.segments,u.paint,a.transform.zoom,void 0,void 0)}function We(c,t,a){const u=t.updateZoomBasedPaintProperties(),p=function(g,v,w){let A,I,z,k=g.terrain?g.terrain.exaggeration():0;if(g.terrain&&k>0){const O=g.terrain,j=O.findDEMTileFor(w);j&&j.dem?A=r.el.create(O,w,j):k=0}if(k===0&&(v.terrainElevationMin=0,v.terrainElevationMax=0),k===v.validForExaggeration&&(k===0||A&&A._demTile&&A._demTile.tileID===v.validForDEMTile.id&&A._dem._timestamp===v.validForDEMTile.timestamp))return!1;for(const O in v.instancesPerModel){const j=v.instancesPerModel[O];for(let Q=0;Q<j.instancedDataArray.length;++Q){const Y=(A?k*A.getElevationAt(0|j.instancedDataArray.float32[16*Q],0|j.instancedDataArray.float32[16*Q+1],!0,!0):0)+j.instancesEvaluatedElevation[Q];j.instancedDataArray.float32[16*Q+6]=Y,I=I?Math.min(v.terrainElevationMin,Y):Y,z=z?Math.max(v.terrainElevationMax,Y):Y}}return v.terrainElevationMin=I||0,v.terrainElevationMax=z||0,v.validForExaggeration=k,v.validForDEMTile=A&&A._demTile?{id:A._demTile.tileID,timestamp:A._dem._timestamp}:{id:void 0,timestamp:0},!0}(c,t,a);(u||p)&&(t.uploaded=!1,t.upload(c.context))}const Oo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.cV([0,0,0],[r.aj,r.aj,0])};function pc(c,t){const a=1<<c.canonical.z,u=t.getFreeCameraOptions().position,p=t.elevation,g=c.canonical.x/a,v=(c.canonical.x+1)/a,w=c.canonical.y/a,A=(c.canonical.y+1)/a;let I=t._centerAltitude;if(p){const j=p.getMinMaxForTile(c);j&&j.max>I&&(I=j.max)}const z=r.aD(u.x,g,v)-u.x,k=r.aD(u.y,w,A)-u.y,O=r.c6(I,t.center.lat)-u.z;return t._zoomFromMercatorZ(Math.sqrt(z*z+k*k+O*O))}function yd(c,t,a,u,p,g,v){const w=c.context,A=c.renderPass==="shadow",I=c.shadowRenderer,z=A&&I?I.getShadowPassDepthMode():new ei(w.gl.LEQUAL,ei.ReadWrite,c.depthRangeFor3D),k=c.isTileAffectedByFog(g);if(a.meshes)for(const O of a.meshes){const j=["MODEL_POSITION_ON_GPU"],Q=[];let Y,ee,K;u.instancedDataArray.length>20&&j.push("INSTANCED_ARRAYS");const se=$c(c,t.paint.get("model-cutoff-fade-range"));if(se.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),A&&I)Y=c.getOrCreateProgram("modelDepth",{defines:j}),ee=ou(v.shadowTileMatrix,v.shadowTileMatrix,Float32Array.from(a.matrix)),K=I.getShadowPassColorMode();else{Nt(j,Q,O,c,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),Y=c.getOrCreateProgram("model",{defines:j,overrideFog:k});const ve=O.material,Ae=ve.pbrMetallicRoughness,Se=t.paint.get("model-opacity").constantOr(1),Te=t.paint.get("model-emissive-strength").constantOr(0);ee=ac(g.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),null,c,Se,Ae.baseColorFactor.toRenderColor(null),ve.emissiveFactor,Ae.metallicFactor,Ae.roughnessFactor,ve,Te,t,p),I&&(v.shadowUniformsInitialized?Y.setShadowUniformValues(w,I.getShadowUniformValues()):(I.setupShadows(g.toUnwrapped(),Y,"model-tile",g.overscaledZ),v.shadowUniformsInitialized=!0)),K=se.shouldRenderCutoff||Se<1||ve.alphaMode!=="OPAQUE"?Zi.alphaBlended:Zi.unblended}c.uploadCommonUniforms(w,Y,g.toUnwrapped(),null,se);const pe=O.material.doubleSided?Li.disabled:Li.backCCW;if(u.instancedDataArray.length>20)Q.push(u.instancedDataBuffer),Y.draw(c,w.gl.TRIANGLES,z,Di.disabled,K,pe,ee,t.id,O.vertexBuffer,O.indexBuffer,O.segments,t.paint,c.transform.zoom,void 0,Q,u.instancedDataArray.length);else{const ve=A?"u_instance":"u_normal_matrix";for(let Ae=0;Ae<u.instancedDataArray.length;++Ae)ee[ve]=new Float32Array(u.instancedDataArray.arrayBuffer,64*Ae,16),Y.draw(c,w.gl.TRIANGLES,z,Di.disabled,K,pe,ee,t.id,O.vertexBuffer,O.indexBuffer,O.segments,t.paint,c.transform.zoom,void 0,Q)}}if(a.children)for(const O of a.children)yd(c,t,O,u,p,g,v)}const xf=[1,-1,1];function Cp(c,t,a,u){if(!a.modelManager)return!0;const p=a.modelManager;if(!a.shadowRenderer)return!0;const g=a.shadowRenderer,v=t.aabb;let w=!0,A=c.maxHeight;if(A===0){let z=0;for(const k in c.instancesPerModel){const O=p.getModel(k,u);O?z=Math.max(z,Math.max(Math.max(O.aabb.max[0],O.aabb.max[1]),O.aabb.max[2])):w=!1}A=c.maxScale*z*1.41+c.maxVerticalOffset,w&&(c.maxHeight=A)}v.max[2]=A,v.min[2]+=c.terrainElevationMin,v.max[2]+=c.terrainElevationMax,r.ad(v.min,v.min,t.tileMatrix),r.ad(v.max,v.max,t.tileMatrix);const I=v.intersects(g.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(c.isInsideFirstShadowMapFrustum=I===2),I===0}function Rp(c,t){const a=c.uniformValues.u_cutoff_params[0],u=c.uniformValues.u_cutoff_params[1],p=c.uniformValues.u_cutoff_params[2],g=c.uniformValues.u_cutoff_params[3];return u===a||g===p?1:r.aD(((t-a)/(u-a)-p)/(g-p),0,1)}function cu(c,t,a,u){if(t.pitch<20)return 1;const p=t.getWorldToCameraMatrix();r.az(p,p,c);const g=r.ei(a.min[0],a.min[1],a.min[2],1);let v=r.aA(r.ej(),g,p),w=v,A=v;g[1]=a.max[1],v=r.aA(r.ej(),g,p),w=v[1]<w[1]?v:w,A=v[1]>A[1]?v:A,g[0]=a.max[0],v=r.aA(r.ej(),g,p),w=v[1]<w[1]?v:w,A=v[1]>A[1]?v:A,g[1]=a.min[1],v=r.aA(r.ej(),g,p),w=v[1]<w[1]?v:w,A=v[1]>A[1]?v:A;const I=r.aD(u[0],0,1),z=100*t.pixelsPerMeter*r.aD(u[1],0,1),k=r.aD(u[2],0,1),O=r.ek(r.ej(),w,A,I),j=Math.tan(.5*t.fovX),Q=-O[2]*j;if(z===0)return O[1]<-Math.abs(Q)?k:1;const Y=(-Math.abs(Q)-O[1])/z,ee=(se,pe,ve)=>(1-ve)*se+ve*pe,K=r.aD(ee(1,k,Y),k,1);return ee(1,K,r.aD((t.pitch-20)/20,0,1))}class Bm{}class Ip{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,a,u){{const k=this._storage.get(a.id);if(k)return k.lastUsedFrameIdx=t,k.buf}const p=u.gl,g=p.getBufferParameter(p.ELEMENT_ARRAY_BUFFER,p.BUFFER_SIZE),v=new ArrayBuffer(g),w=new Int16Array(v);p.getBufferSubData(p.ELEMENT_ARRAY_BUFFER,0,new Int16Array(v));const A=new r.en;for(let k=0;k<g/2;k+=3){const O=w[k],j=w[k+1],Q=w[k+2];A.emplaceBack(O,j),A.emplaceBack(j,Q),A.emplaceBack(Q,O)}const I=u.bindVertexArrayOES.current,z=new Bm;return z.buf=new sl(u,A),z.lastUsedFrameIdx=t,this._storage.set(a.id,z),u.bindVertexArrayOES.set(I),z.buf}update(t){for(const[a,u]of this._storage)t-u.lastUsedFrameIdx>30&&(u.buf.destroy(),this._storage.delete(a))}destroy(){for(const[t,a]of this._storage)a.buf.destroy(),this._storage.delete(t)}}class Dp{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const vd=r.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class xd{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class bf{constructor(t,a){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...a,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...a,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const zp=r.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class wf{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,a){const u=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const v=new r.eo,w=new r.a_;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(1,1),v.emplaceBack(-1,1),w.emplaceBack(0,1,2),w.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(v,zp.members),this.vignetteIdx=t.context.createIndexBuffer(w)}const p=r.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,u);const v={u_vignetteShape:(g={vignetteShape:[a.start,a.range,Math.pow(10,a.fadePower)],vignetteColor:[a.color.r,a.color.g,a.color.b,a.color.a*a.strength]}).vignetteShape,u_vignetteColor:g.vignetteColor};u.draw(t,t.context.gl.TRIANGLES,ei.disabled,Di.disabled,Zi.alphaBlended,Li.disabled,v,"vignette",this.vignetteVx,this.vignetteIdx,p)}var g}}class uu{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,a){const u=t.getFreeCameraOptions().position,p=u.toAltitude(),g=u.toLngLat(),v=r.al(g.lng),w=r.al(g.lat),A=t.pixelsPerMeter/a,I=v*r.eq,z=r.eq*Math.log(Math.tan(Math.PI/4+w/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const k=-this._offsetYPrev+z,O=-this._elevationPrev+p;this._accumulatedOffsetX+=(-this._offsetXPrev+I)*A,this._accumulatedOffsetY+=k*A,this._accumulatedElevation+=O*A,this._offsetXPrev=I,this._offsetYPrev=z,this._elevationPrev=p}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function mc(c,t){return[-(c[0]-Math.floor(c[0]/t)*t),-(c[1]-Math.floor(c[1]/t)*t),-(c[2]-Math.floor(c[2]/t)*t)]}function Tf(c){const t=r.ea(1323123451230),a=[];for(let u=0;u<c;++u){const p=2*t()-1,g=2*t()-1,v=2*t()-1;a.push(r.cS(p,g,v))}return a}function ul(c,t,a,u,p){const g=r.aD((p-a)/(u-a),0,1);return(1-g)*c+g*t}class ka{constructor(t){this._movement=new uu,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new wf,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,a){const u=t.transform;this._movement.update(u,this._ppmScaleFactor);const p=u.starsProjMatrix,g=r.bY([]);r.b_(g,g,r.al(90)-u._pitch),r.bZ(g,g,-u.angle);const v=r.c3(new Float32Array(16),g),w=r.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),A=r.ee([],w),I=r.az([],A,v),z=Date.now()/1e3;return this._accumulatedTimeFromStart+=(z-this._prevTime)*a,this._prevTime=z,{projectionMatrix:p,modelviewMatrix:I}}}class Fm extends ka{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new bf(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const a=t.context;if(!this.particlesVx){const u=Tf(this.particlesCount),p=new r.er,g=new r.a_;let v=0;const w=r.ea(1323123451230);for(let A=0;A<u.length;++A){const I=u[A],z=[2*w()-1,w(),w(),w()];p.emplaceBack(I[0],I[1],I[2],-1,-1,...z),p.emplaceBack(I[0],I[1],I[2],1,-1,...z),p.emplaceBack(I[0],I[1],I[2],1,1,...z),p.emplaceBack(I[0],I[1],I[2],-1,1,...z),g.emplaceBack(v+0,v+1,v+2),g.emplaceBack(v+0,v+2,v+3),v+=4}this.particlesVx=a.createVertexBuffer(p,vd.members),this.particlesIdx=a.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const a=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},u=t.transform.zoom;if(a.revealStart>u)return;const p=ul(0,1,a.revealStart,a.revealStart+a.revealRange,u);if(!this.particlesVx||!this.particlesIdx)return;const g=structuredClone(this._params);let v=[-g.direction.x,g.direction.y,-100];r.au(v,v);const w=structuredClone(this._vignetteParams);w.strength*=p,g.overrideStyleParameters||(g.intensity=t.style.rain.state.density,g.timeFactor=t.style.rain.state.intensity,g.color=structuredClone(t.style.rain.state.color),v=structuredClone(t.style.rain.state.direction),g.screenThinning.intensity=t.style.rain.state.centerThinning,g.dropletSizeX=t.style.rain.state.dropletSize[0],g.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],g.distortionStrength=100*t.style.rain.state.distortionStrength,w.strength=1,w.color=structuredClone(t.style.rain.state.vignetteColor));const A=this.updateOnRender(t,g.timeFactor),I=t.context,z=I.gl,k=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new r.T(I,{width:t.width,height:t.height,data:null},z.RGBA8)),g.distortionStrength>0&&(I.activeTexture.set(z.TEXTURE0),this.screenTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),z.copyTexSubImage2D(z.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const O=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(I,O),I.activeTexture.set(z.TEXTURE0),this.screenTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const j=[g.color.r,g.color.g,g.color.b,g.color.a],Q=(Y,ee)=>{const K=mc(this._movement.getPosition(),Y),se=g.dropletSizeX,pe=g.dropletSizeX*g.dropletSizeYScale,ve=t.width/2,Ae=t.height/2,Se=ul(0,g.screenThinning.start,0,1,g.screenThinning.intensity),Te=ul(.001,g.screenThinning.range,0,1,g.screenThinning.intensity),ge=ul(0,g.screenThinning.particleOffset,0,1,g.screenThinning.intensity),Ce=(Le={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:K,velocityConeAperture:g.velocityConeAperture,velocity:g.velocity,boxSize:Y,rainDropletSize:[se,pe],distortionStrength:g.distortionStrength,rainDirection:v,color:j,screenSize:[k.width,k.height],thinningCenterPos:[ve,Ae],thinningShape:[Se,Te,Math.pow(10,g.screenThinning.fadePower)],thinningAffectedRatio:g.screenThinning.affectedRatio,thinningParticleOffset:ge,shapeDirectionalPower:g.shapeDirPower,shapeNormalPower:g.shapeNormalPower,mode:ee?0:1},{u_modelview:Float32Array.from(Le.modelview),u_projection:Float32Array.from(Le.projection),u_time:Le.time,u_cam_pos:Le.camPos,u_texScreen:0,u_velocityConeAperture:Le.velocityConeAperture,u_velocity:Le.velocity,u_boxSize:Le.boxSize,u_rainDropletSize:Le.rainDropletSize,u_distortionStrength:Le.distortionStrength,u_rainDirection:Le.rainDirection,u_color:Le.color,u_screenSize:Le.screenSize,u_thinningCenterPos:Le.thinningCenterPos,u_thinningShape:Le.thinningShape,u_thinningAffectedRatio:Le.thinningAffectedRatio,u_thinningParticleOffset:Le.thinningParticleOffset,u_shapeDirectionalPower:Le.shapeDirectionalPower,u_shapeNormalPower:Le.shapeNormalPower,u_mode:Le.mode});var Le;const Qe=Math.round(g.intensity*this.particlesCount),Ze=r.bd.simpleSegment(0,0,4*Qe,2*Qe);O.draw(t,z.TRIANGLES,ei.disabled,Di.disabled,Zi.alphaBlended,Li.disabled,Ce,"rain_particles",this.particlesVx,this.particlesIdx,Ze)};g.distortionStrength>0&&Q(g.boxSize,!0),Q(g.boxSize,!1),this._vignette.draw(t,w)}}const bd=r.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class hr extends ka{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new bf(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const a=t.context;if(!this.particlesVx){const u=Tf(this.particlesCount),p=new r.es,g=new r.a_;let v=0;const w=r.ea(1323123451230);for(let A=0;A<u.length;++A){const I=u[A],z=w(),k=w(),O=w(),j=[A/u.length,z,k,O],Q=[w(),w()];p.emplaceBack(I[0],I[1],I[2],-1,-1,...j,...Q),p.emplaceBack(I[0],I[1],I[2],1,-1,...j,...Q),p.emplaceBack(I[0],I[1],I[2],1,1,...j,...Q),p.emplaceBack(I[0],I[1],I[2],-1,1,...j,...Q),g.emplaceBack(v+0,v+1,v+2),g.emplaceBack(v+0,v+2,v+3),v+=4}this.particlesVx=a.createVertexBuffer(p,bd.members),this.particlesIdx=a.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const a=structuredClone(this._params);let u=[-a.direction.x,a.direction.y,-100];r.au(u,u);const p=structuredClone(this._vignetteParams),g=a.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},v=t.transform.zoom;if(g.revealStart>v)return;const w=ul(0,1,g.revealStart,g.revealStart+g.revealRange,v);p.strength*=w,a.overrideStyleParameters||(a.intensity=t.style.snow.state.density,a.timeFactor=t.style.snow.state.intensity,a.color=structuredClone(t.style.snow.state.color),u=structuredClone(t.style.snow.state.direction),a.screenThinning.intensity=t.style.snow.state.centerThinning,a.billboardSize=2.79*t.style.snow.state.flakeSize,p.strength=1,p.color=structuredClone(t.style.snow.state.vignetteColor));const A=this.updateOnRender(t,a.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const I=t.context,z=I.gl,k=t.transform,O=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(I,O),((j,Q,Y)=>{const ee=mc(this._movement.getPosition(),j),K=k.width/2,se=k.height/2,pe=ul(0,Y.screenThinning.start,0,1,Y.screenThinning.intensity),ve=ul(.001,Y.screenThinning.range,0,1,Y.screenThinning.intensity),Ae=ul(0,Y.screenThinning.particleOffset,0,1,Y.screenThinning.intensity),Se=(Te={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ee,velocityConeAperture:Y.velocityConeAperture,velocity:Y.velocity,horizontalOscillationRadius:Y.horizontalOscillationRadius,horizontalOscillationRate:Y.horizontalOscillationRate,boxSize:j,billboardSize:1*Y.billboardSize,simpleShapeParameters:[Y.shapeFadeStart,Y.shapeFadePower],screenSize:[k.width,k.height],thinningCenterPos:[K,se],thinningShape:[pe,ve,Math.pow(10,Y.screenThinning.fadePower)],thinningAffectedRatio:Y.screenThinning.affectedRatio,thinningParticleOffset:Ae,color:[Y.color.r,Y.color.g,Y.color.b,Y.color.a],direction:u},{u_modelview:Float32Array.from(Te.modelview),u_projection:Float32Array.from(Te.projection),u_time:Te.time,u_cam_pos:Te.camPos,u_velocityConeAperture:Te.velocityConeAperture,u_velocity:Te.velocity,u_horizontalOscillationRadius:Te.horizontalOscillationRadius,u_horizontalOscillationRate:Te.horizontalOscillationRate,u_boxSize:Te.boxSize,u_billboardSize:Te.billboardSize,u_simpleShapeParameters:Te.simpleShapeParameters,u_screenSize:Te.screenSize,u_thinningCenterPos:Te.thinningCenterPos,u_thinningShape:Te.thinningShape,u_thinningAffectedRatio:Te.thinningAffectedRatio,u_thinningParticleOffset:Te.thinningParticleOffset,u_particleColor:Te.color,u_direction:Te.direction});var Te;const ge=Math.round(Y.intensity*this.particlesCount),Ce=r.bd.simpleSegment(0,0,4*ge,2*ge);this.particlesVx&&this.particlesIdx&&O.draw(t,z.TRIANGLES,ei.disabled,Di.disabled,Zi.alphaBlended,Li.disabled,Se,"snow_particles",this.particlesVx,this.particlesIdx,Ce)})(a.boxSize,0,a),this._vignette.draw(t,p)}}const bn={symbol:function(c,t,a,u,p){if(c.renderPass!=="translucent")return;const g=Di.disabled,v=c.colorModeForRenderPass(),w=a.layout.get("text-variable-anchor"),A=a.layout.get("text-size-scale-range"),I=r.aD(c.scaleFactor,A[0],A[1]);w&&function(O,j,Q,Y,ee,K,se,pe){const ve=j.transform,Ae=ee==="map",Se=K==="map";for(const Te of O){const ge=Y.getTile(Te),Ce=ge.getBucket(Q);if(!Ce||!Ce.text||!Ce.text.segments.get().length)continue;const Le=r.bH(Ce.textSizeData,ve.zoom,pe),Qe=Vh(Te,Ce.getProjection(),ve),Ze=ve.calculatePixelsToTileUnitsMatrix(ge),ht=as(Qe,ge.tileID.canonical,Se,Ae,ve,Ce.getProjection(),Ze),lt=Ce.hasIconTextFit()&&Ce.hasIconData();Le&&uh(Ce,Ae,Se,se,ve,ht,Te,Math.pow(2,ve.zoom-ge.tileID.overscaledZ),Le,lt)}}(u,c,a,t,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),p,I);const z=a.paint.get("icon-opacity").constantOr(1)!==0,k=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(z||k)?sc(c,t,a,u,g,v):(z&&sc(c,t,a,u,g,v,{onlyIcons:!0}),k&&sc(c,t,a,u,g,v,{onlyText:!0})),t.map.showCollisionBoxes&&(Yr(c,t,a,u,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Yr(c,t,a,u,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(c,t,a,u){if(c.renderPass!=="translucent")return;const p=a.paint.get("circle-opacity"),g=a.paint.get("circle-stroke-width"),v=a.paint.get("circle-stroke-opacity"),w=a.layout.get("circle-sort-key").constantOr(1)!==void 0,A=a.paint.get("circle-emissive-strength");if(p.constantOr(1)===0&&(g.constantOr(1)===0||v.constantOr(1)===0))return;const I=c.context,z=I.gl,k=c.transform,O=c.depthModeForSublayer(0,ei.ReadOnly),j=Di.disabled,Q=c.colorModeForDrapableLayerRenderPass(A),Y=k.projection.name==="globe",ee=[r.ay(k.center.lng),r.aH(k.center.lat)],K=[];for(let pe=0;pe<u.length;pe++){const ve=u[pe],Ae=t.getTile(ve),Se=Ae.getBucket(a);if(!Se||Se.projection.name!==k.projection.name)continue;const Te=Se.programConfigurations.get(a.id),ge=r.dK(a),Ce=c.isTileAffectedByFog(ve);Y&&ge.push("PROJECTION_GLOBE_VIEW"),ge.push("DEPTH_D24"),c.terrain&&k.depthOcclusionForSymbolsAndCircles&&ge.push("DEPTH_OCCLUSION");const Le=c.getOrCreateProgram("circle",{config:Te,defines:ge,overrideFog:Ce}),Qe=Se.layoutVertexBuffer,Ze=Se.globeExtVertexBuffer,ht=Se.indexBuffer,lt=k.projection.createInversionMatrix(k,ve.canonical),Ct={programConfiguration:Te,program:Le,layoutVertexBuffer:Qe,globeExtVertexBuffer:Ze,indexBuffer:ht,uniformValues:r.dL(c,ve,Ae,lt,ee,a),tile:Ae};if(w){const $e=Se.segments.get();for(const et of $e)K.push({segments:new r.bd([et]),sortKey:et.sortKey,state:Ct})}else K.push({segments:Se.segments,sortKey:0,state:Ct})}w&&K.sort((pe,ve)=>pe.sortKey-ve.sortKey);const se={useDepthForOcclusion:k.depthOcclusionForSymbolsAndCircles};for(const pe of K){const{programConfiguration:ve,program:Ae,layoutVertexBuffer:Se,globeExtVertexBuffer:Te,indexBuffer:ge,uniformValues:Ce,tile:Le}=pe.state,Qe=pe.segments;c.terrain&&c.terrain.setupElevationDraw(Le,Ae,se),c.uploadCommonUniforms(I,Ae,Le.tileID.toUnwrapped()),Ae.draw(c,z.TRIANGLES,O,j,Q,Li.disabled,Ce,a.id,Se,ge,Qe,a.paint,k.zoom,ve,[Te])}},heatmap:function(c,t,a,u){if(a.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const p=c.context,g=p.gl,v=Di.disabled,w=new Zi([g.ONE,g.ONE,g.ONE,g.ONE],r.am.transparent,[!0,!0,!0,!0]);(function(j,Q,Y,ee){const K=j.gl,se=Q.width*ee,pe=Q.height*ee;j.activeTexture.set(K.TEXTURE1),j.viewport.set([0,0,se,pe]);let ve=Y.heatmapFbo;if(!ve||ve&&(ve.width!==se||ve.height!==pe)){ve&&ve.destroy();const Ae=K.createTexture();K.bindTexture(K.TEXTURE_2D,Ae),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),ve=Y.heatmapFbo=j.createFramebuffer(se,pe,!0,null),function(Se,Te,ge,Ce,Le,Qe){const Ze=Se.gl;Ze.texImage2D(Ze.TEXTURE_2D,0,Se.extRenderToTextureHalfFloat?Ze.RGBA16F:Ze.RGBA,Le,Qe,0,Ze.RGBA,Se.extRenderToTextureHalfFloat?Ze.HALF_FLOAT:Ze.UNSIGNED_BYTE,null),Ce.colorAttachment.set(ge)}(j,0,Ae,ve,se,pe)}else K.bindTexture(K.TEXTURE_2D,ve.colorAttachment.get()),j.bindFramebuffer.set(ve.framebuffer)})(p,c,a,c.transform.projection.name==="globe"?.5:.25),p.clear({color:r.am.transparent});const A=c.transform,I=A.projection.name==="globe",z=I?["PROJECTION_GLOBE_VIEW"]:[],k=I?Li.frontCCW:Li.disabled,O=[r.ay(A.center.lng),r.aH(A.center.lat)];for(let j=0;j<u.length;j++){const Q=u[j];if(t.hasRenderableParent(Q))continue;const Y=t.getTile(Q),ee=Y.getBucket(a);if(!ee||ee.projection.name!==A.projection.name)continue;const K=c.isTileAffectedByFog(Q),se=ee.programConfigurations.get(a.id),pe=c.getOrCreateProgram("heatmap",{config:se,defines:z,overrideFog:K}),{zoom:ve}=c.transform;c.terrain&&c.terrain.setupElevationDraw(Y,pe),c.uploadCommonUniforms(p,pe,Q.toUnwrapped());const Ae=A.projection.createInversionMatrix(A,Q.canonical);pe.draw(c,g.TRIANGLES,ei.disabled,v,w,k,oh(c,Q,Y,Ae,O,ve,a.paint.get("heatmap-intensity")),a.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,a.paint,c.transform.zoom,se,I?[ee.globeExtVertexBuffer]:null)}p.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(p,g){const v=p.context,w=v.gl,A=g.heatmapFbo;if(!A)return;v.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,A.colorAttachment.get()),v.activeTexture.set(w.TEXTURE1);let I=g.colorRampTexture;I||(I=g.colorRampTexture=new r.T(v,g.colorRamp,w.RGBA8)),I.bind(w.LINEAR,w.CLAMP_TO_EDGE),p.getOrCreateProgram("heatmapTexture").draw(p,w.TRIANGLES,ei.disabled,Di.disabled,p.colorModeForRenderPass(),Li.disabled,((z,k,O,j)=>({u_image:0,u_color_ramp:1,u_opacity:k.paint.get("heatmap-opacity")}))(0,g),g.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,g.paint,p.transform.zoom)}(c,a))},line:function(c,t,a,u){if(c.renderPass!=="translucent")return;const p=a.paint.get("line-opacity"),g=a.paint.get("line-width");if(p.constantOr(1)===0||g.constantOr(1)===0)return;const v=a.paint.get("line-emissive-strength"),w=a.paint.get("line-occlusion-opacity"),A=a.layout.get("line-elevation-reference"),I=a.layout.get("line-width-unit")==="meters",z=A==="sea",k=!(!c.terrain||!c.terrain.enabled),O=c.context,j=O.gl;if(a.hasElevatedBuckets&&c.transform.projection.name==="globe")return;const Q=a.layout.get("line-cross-slope"),Y=Q!==void 0,ee=Q<1,K=c.colorModeForDrapableLayerRenderPass(v),se=c.terrain&&c.terrain.renderingToTexture,pe=se?1:r.q.devicePixelRatio,ve=a.paint.get("line-dasharray"),Ae=ve.constantOr(1),Se=a.layout.get("line-cap"),Te=ve.constantOr(null),ge=Se.constantOr(null),Ce=a.paint.get("line-pattern"),Le=Ce.constantOr(1),Qe=a.paint.get("line-pattern-cross-fade"),Ze=Ce.constantOr(null),ht=a.paint.get("line-opacity").constantOr(1);let lt=!Le&&ht!==1||c.depthOcclusion&&w>0&&w<1;const Ct=a.paint.get("line-gradient"),$e=Le?"linePattern":"line",et=r.dM(a);let Ge;if(se&&c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(lt=!1),w!==0&&c.depthOcclusion){const dt=a.paint._values["line-opacity"];dt&&dt.value&&dt.value.kind==="constant"?Ge=dt.value:r.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}g.value.kind!=="constant"&&g.value.isLineProgressConstant===!1&&et.push("VARIABLE_LINE_WIDTH");const pt=(dt,wt,At,Qt,ai,Yt)=>{for(const ci of dt){const ii=t.getTile(ci);if(Le&&!ii.patternsLoaded())continue;const Mi=ii.getBucket(a);if(!Mi||Mi.elevationType!=="none"&&!ai||Mi.elevationType==="none"&&ai)continue;c.prepareDrawTile();const Ni=[...wt],Ai=c.shadowRenderer,Hi=Mi.elevationType==="road"&&!!Ai&&Ai.enabled;let zi=[0,0,0];if(Hi){const ki=c.style.directionalLight,$n=c.style.ambientLight;ki&&$n&&(zi=zs(c.style,ki,$n)),Ni.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const wi=Mi.programConfigurations.get(a.id);let an=!1;if(Ze&&ii.imageAtlas){const ki=r.dN.from(Ze),$n=ki.getPrimary().scaleSelf(pe).toString(),mn=ii.imageAtlas.patternPositions.get($n),Sn=ki.getSecondary(),En=Sn?ii.imageAtlas.patternPositions.get(Sn.scaleSelf(pe).toString()):null;an=!!mn&&!!En,mn&&wi.setConstantPatternPositions(mn,En)}Qe>0&&(an||wi.getPatternTransitionVertexBuffer("line-pattern"))&&Ni.push("LINE_PATTERN_TRANSITION");const zn=c.isTileAffectedByFog(ci),Bi=c.getOrCreateProgram($e,{config:wi,defines:Ni,overrideFog:zn,overrideRtt:!ai&&void 0});if(!Le&&Te&&ge&&ii.lineAtlas){const ki=ii.lineAtlas.getDash(Te,ge);ki&&wi.setConstantPatternPositions(ki)}Hi&&Ai.setupShadows(ii.tileID.toUnwrapped(),Bi,"vector-tile",ii.tileID.overscaledZ);let[on,vn]=a.paint.get("line-trim-offset");(ge==="round"||ge==="square")&&on!==vn&&(on===0&&(on-=1),vn===1&&(vn+=1));const wn=se?ci.projMatrix:null,Pn=I?1/Mi.tileToMeter/r.aw(ii,1,c.transform.zoom):1,er=I?1/Mi.tileToMeter/r.aw(ii,1,Math.floor(c.transform.zoom)):1,Ar=Le?r.dO(c,ii,a,wn,pe,Pn,er,[on,vn],zi,Qe):r.dP(c,ii,a,wn,Mi.lineClipsArray.length,pe,Pn,er,[on,vn],zi);if(Ct){const ki=Mi.gradients[a.id];let $n=ki.texture;if(a.gradientVersion!==ki.version){let mn=256;if(a.stepInterpolant){const Sn=t.getSource().maxzoom,En=ci.canonical.z===Sn?Math.ceil(1<<c.transform.maxZoom-ci.canonical.z):1;mn=r.aD(r.dQ(Mi.maxLineLength/r.aj*1024*En),256,O.maxTextureSize)}ki.gradient=r.dR({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:mn,image:ki.gradient||void 0,clips:Mi.lineClipsArray}),ki.texture?ki.texture.update(ki.gradient):ki.texture=new r.T(O,ki.gradient,j.RGBA8),ki.version=a.gradientVersion,$n=ki.texture}O.activeTexture.set(j.TEXTURE1),$n.bind(a.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}Ae&&(O.activeTexture.set(j.TEXTURE0),ii.lineAtlasTexture&&ii.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),wi.updatePaintBuffers()),Le&&(O.activeTexture.set(j.TEXTURE0),ii.imageAtlasTexture&&ii.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),wi.updatePaintBuffers()),ai&&!z&&c.terrain.setupElevationDraw(ii,Bi),c.uploadCommonUniforms(O,Bi,ci.toUnwrapped());const tr=ki=>{Ge!=null&&(Ge.value=ht*w),Bi.draw(c,j.TRIANGLES,At,ki,K,Li.disabled,Ar,a.id,Mi.layoutVertexBuffer,Mi.indexBuffer,Mi.segments,a.paint,c.transform.zoom,wi,[Mi.layoutVertexBuffer2,Mi.patternVertexBuffer,Mi.zOffsetVertexBuffer]),Ge!=null&&(Ge.value=ht)};if(lt&&!ai){const ki=c.stencilModeForClipping(ci).ref;ki===0&&se&&O.clear({stencil:0});const $n={func:j.EQUAL,mask:255};Ar.u_alpha_discard_threshold=.8,tr(new Di($n,ki,255,j.KEEP,j.KEEP,j.INVERT)),Ar.u_alpha_discard_threshold=0,tr(new Di($n,ki,255,j.KEEP,j.KEEP,j.KEEP))}else Ar.u_alpha_discard_threshold=lt&&ai&&Yt?.8:0,tr(ai?Qt:c.stencilModeForClipping(ci))}};let tt=c.depthModeForSublayer(0,ei.ReadOnly);const bt=new ei(c.depthOcclusion?j.GREATER:j.LEQUAL,ei.ReadOnly,c.depthRangeFor3D);if(a.hasNonElevatedBuckets){const dt=!se&&c.terrain;w!==0&&dt?r.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has line-z-offset enabled.`):dt?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${a.id}.`):pt(u,et,tt,Di.disabled,!1,!0)}if(a.hasElevatedBuckets){A==="hd-road-markup"?k||(tt=bt,et.push("ELEVATED_ROADS")):(et.push("ELEVATED"),tt=bt,Y&&et.push(ee?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),z&&et.push("ELEVATION_REFERENCE_SEA"));const dt=lt?c.stencilModeFor3D():Di.disabled;c.forceTerrainMode=!0,pt(u,et,tt,dt,!0,!0),lt&&pt(u,et,tt,dt,!0,!1),c.forceTerrainMode=!1}lt&&(c.resetStencilClippingMasks(),se&&O.clear({stencil:0})),w===0||c.depthOcclusion||se||c.layersWithOcclusionOpacity.push(c.currentLayer)},fill:function(c,t,a,u){const p=a.paint.get("fill-color"),g=a.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const v=a.paint.get("fill-emissive-strength"),w=c.colorModeForDrapableLayerRenderPass(v),A=a.paint.get("fill-pattern"),I=c.opaquePassEnabledForLayer()&&!A.constantOr(1)&&p.constantOr(r.am.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";let z="none";a.layout.get("fill-elevation-reference")!=="none"?z="road":a.paint.get("fill-z-offset").constantOr(1)!==0&&(z="offset");const k=!(!c.terrain||!c.terrain.enabled),O={painter:c,sourceCache:t,layer:a,coords:u,colorMode:w,elevationType:z,terrainEnabled:k,pass:I};if(c.renderPass!=="shadow")if(z!=="offset"){if(Wt(O,!1),z==="road"){const j=!k&&c.renderPass==="translucent";j&&Kr(c,t,a,u,"geometry"),Wt(O,!0,Di.disabled),j&&function(Q){const{painter:Y,sourceCache:ee,layer:K,coords:se,colorMode:pe}=Q,ve=Y.context.gl,Ae=Q.painter.shadowRenderer,Se=!!Ae&&Ae.enabled,Te=new ei(Y.context.gl.LEQUAL,ei.ReadOnly,Y.depthRangeFor3D);let ge=[0,0,0];if(Se){const Ce=Y.style.directionalLight,Le=Y.style.ambientLight;Ce&&Le&&(ge=zs(Y.style,Ce,Le))}for(const Ce of se){const Le=ee.getTile(Ce),Qe=Le.getBucket(K);if(!Qe)continue;const Ze=Qe.elevatedStructures;if(!Ze||!Ze.renderableSegments||Ze.renderableSegments.segments[0].primitiveLength===0)continue;Y.prepareDrawTile();const ht=Qe.bufferData.programConfigurations.get(K.id),lt=Y.isTileAffectedByFog(Ce),Ct=[];Se&&Ct.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const $e=Y.getOrCreateProgram("elevatedStructures",{config:ht,overrideFog:lt,defines:Ct}),et=Y.translatePosMatrix(Ce.projMatrix,Le,K.paint.get("fill-translate"),K.paint.get("fill-translate-anchor"));Se&&Ae.setupShadows(Le.tileID.toUnwrapped(),$e,"vector-tile",Le.tileID.overscaledZ);const Ge=ah(et,ge);Y.uploadCommonUniforms(Y.context,$e,Ce.toUnwrapped()),$e.draw(Y,ve.TRIANGLES,Te,Di.disabled,pe,Li.backCCW,Ge,K.id,Ze.vertexBuffer,Ze.indexBuffer,Ze.renderableSegments,K.paint,Y.transform.zoom,ht,[Ze.vertexBufferNormal])}}(O)}}else Wt(O,!1,c.stencilModeFor3D());else c.shadowRenderer&&z==="road"&&!k&&function(j){const{painter:Q,sourceCache:Y,layer:ee,coords:K}=j,se=Q.context.gl,pe=j.painter.shadowRenderer;for(const ve of K){const Ae=Y.getTile(ve),Se=Ae.getBucket(ee);if(!Se)continue;const Te=Se.elevatedStructures;if(!Te||!Te.shadowCasterSegments||Te.shadowCasterSegments.segments[0].primitiveLength===0)continue;Q.prepareDrawTile();const ge=Se.bufferData.programConfigurations.get(ee.id),Ce=Q.isTileAffectedByFog(ve),Le=Q.getOrCreateProgram("elevatedStructuresDepth",{config:ge,overrideFog:Ce}),Qe=pe.calculateShadowPassMatrixFromTile(Ae.tileID.toUnwrapped());Q.uploadCommonUniforms(Q.context,Le,ve.toUnwrapped());const Ze={u_matrix:Qe,u_depth_bias:.001};Le.draw(Q,se.TRIANGLES,pe.getShadowPassDepthMode(),Di.disabled,pe.getShadowPassColorMode(),Li.disabled,Ze,ee.id,Te.vertexBuffer,Te.indexBuffer,Te.shadowCasterSegments,ee.paint,Q.transform.zoom,ge)}}(O)},"fill-extrusion":function(c,t,a,u){const p=a.paint.get("fill-extrusion-opacity"),g=c.context,v=g.gl,w=c.terrain,A=w&&w.renderingToTexture;if(p===0)return;const I=c.conflationActive&&c.style.isLayerClipped(a,t.getSource()),z=c.style.order.indexOf(a.fqid);if(I&&function(k,O,j,Q,Y){for(const ee of Q){const K=O.getTile(ee).getBucket(j);K&&(K.updateReplacement(ee,k.replacementSource,Y),K.uploadCentroid(k.context))}}(c,t,a,u,z),w||I)for(const k of u){const O=t.getTile(k).getBucket(a);O&&Cl(c.context,t,k,O,a,w,I)}if(c.renderPass==="shadow"&&c.shadowRenderer){const k=c.shadowRenderer;if(w&&p<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.ab)return;const O=k.getShadowPassDepthMode(),j=k.getShadowPassColorMode();su(c,t,a,u,O,Di.disabled,j,I)}else if(c.renderPass==="translucent"){const k=!a.paint.get("fill-extrusion-pattern").constantOr(1),O=a.paint.get("fill-extrusion-color").constantOr(r.am.white);if(!A&&O.a!==0){const j=new ei(c.context.gl.LEQUAL,ei.ReadWrite,c.depthRangeFor3D);p===1&&k?su(c,t,a,u,j,Di.disabled,Zi.unblended,I):(su(c,t,a,u,j,Di.disabled,Zi.disabled,I),su(c,t,a,u,j,c.stencilModeFor3D(),c.colorModeForRenderPass(),I),c.resetStencilClippingMasks())}if(c.style.enable3dLights()&&k&&(!w&&c.transform.projection.name!=="globe"||A)){const j=a.paint.get("fill-extrusion-opacity"),Q=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),Y=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ee=a.paint.get("fill-extrusion-flood-light-intensity"),K=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",se=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(K?null:a.lut).toArray01().slice(0,3),pe=Q>0&&Y>0,ve=ee>0,Ae=(Te,ge,Ce)=>(1-Ce)*Te+Ce*ge,Se=Te=>{const ge=c.depthModeForSublayer(1,ei.ReadOnly,v.LEQUAL,!0),Ce=a.paint.get(Te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Le=Ae(.1,3,Ce),Qe=c._showOverdrawInspector;if(!Qe){const Ze=new Di({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),ht=new Zi([v.ONE,v.ONE,v.ONE,v.ONE],r.am.transparent,[!1,!1,!1,!0],v.MIN);cc(c,t,a,u,ge,Ze,ht,Li.disabled,Te,"sdf",j,Q,Y,ee,se,Le,I,!1)}{const Ze=Qe?Di.disabled:new Di({func:v.EQUAL,mask:255},255,255,v.KEEP,v.DECR,v.DECR),ht=Qe?c.colorModeForRenderPass():new Zi([v.ONE_MINUS_DST_ALPHA,v.DST_ALPHA,v.ONE,v.ONE],r.am.transparent,[!0,!0,!0,!0]);cc(c,t,a,u,ge,Ze,ht,Li.disabled,Te,"color",j,Q,Y,ee,se,Le,I,!1)}};if(A){const Te=(ge,Ce,Le)=>{const Qe=c.depthModeForSublayer(1,ei.ReadOnly,v.LEQUAL,!1),Ze=a.paint.get(ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ht=Ae(.1,3,Ze);{const lt=new Zi([v.ONE,v.ONE,v.ONE,v.ONE],r.am.transparent,[!1,!1,!1,!0]);cc(c,t,a,u,Qe,Di.disabled,lt,Li.disabled,ge,"clear",j,Q,Y,ee,se,ht,I,Ce)}{const lt=new Di({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),Ct=new Zi([v.ONE,v.ONE,v.ONE,v.ONE],r.am.transparent,[!1,!1,!1,!0],v.MIN);cc(c,t,a,u,Qe,lt,Ct,Li.disabled,ge,"sdf",j,Q,Y,ee,se,ht,I,Ce)}{const lt=ge?v.ZERO:v.ONE_MINUS_DST_ALPHA,Ct=new Di({func:v.EQUAL,mask:255},255,255,v.KEEP,v.DECR,v.DECR),$e=new Zi([lt,v.DST_ALPHA,v.ONE_MINUS_DST_ALPHA,v.ZERO],r.am.transparent,[!0,!0,!0,!0]);cc(c,t,a,u,Qe,Ct,$e,Li.disabled,ge,"color",j,Q,Y,ee,se,ht,I,Ce)}{const lt=new Zi([v.ONE,v.ONE,v.ONE,ge?v.ZERO:v.ONE],r.am.transparent,[!1,!1,!1,!0],ge?v.FUNC_ADD:v.MAX);cc(c,t,a,u,Qe,Di.disabled,lt,Li.disabled,ge,"clear",j,Q,Y,ee,se,ht,I,Ce,Le)}};if(pe||ve){let ge;if(c.prepareDrawTile(),w){const Ce=w.drapeBufferSize[0],Le=w.drapeBufferSize[1];ge=w.framebufferCopyTexture,ge&&(!ge||ge.size[0]===Ce&&ge.size[1]===Le)||(ge&&ge.destroy(),ge=w.framebufferCopyTexture=new r.T(g,new r.r({width:Ce,height:Le}),v.RGBA8)),ge.bind(v.LINEAR,v.CLAMP_TO_EDGE),v.copyTexSubImage2D(v.TEXTURE_2D,0,0,0,0,0,Ce,Le)}pe&&Te(!0,!1,ge),ve&&Te(!1,!0,ge)}}else pe&&Se(!0),ve&&Se(!1),(pe||ve)&&c.resetStencilClippingMasks()}}},hillshade:function(c,t,a,u){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent"||c.style.disableElevatedTerrain)return;const p=c.context,g=c.terrain&&c.terrain.renderingToTexture,[v,w]=c.renderPass!=="translucent"||g?[{},u]:c.stencilConfigForOverlap(u);for(const A of w){const I=t.getTile(A);if(I.needsHillshadePrepare&&c.renderPass==="offscreen")Os(c,I,a);else if(c.renderPass==="translucent"){const z=c.depthModeForSublayer(0,ei.ReadOnly),k=a.paint.get("hillshade-emissive-strength"),O=c.colorModeForDrapableLayerRenderPass(k),j=g&&c.terrain?c.terrain.stencilModeForRTTOverlap(A):v[A.overscaledZ];Po(c,A,I,a,z,j,O)}}p.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,t,a,u,p,g){if(c.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const v=c.transform.projection.name==="globe",w=a.paint.get("raster-elevation")!==0,A=w&&v;if(c.renderElevatedRasterBackface&&!A)return;const I=c.context,z=I.gl,k=t.getSource(),O=function(Se,Te,ge,Ce){const Le=Te.paint.get("raster-color"),Qe=Se.type==="raster-array",Ze=[],ht=Te.paint.get("raster-resampling"),lt=Te.paint.get("raster-color-mix");let Ct=Te.paint.get("raster-color-range");const $e=[lt[0],lt[1],lt[2],0],et=lt[3];let Ge=ht==="nearest"?Ce.NEAREST:Ce.LINEAR;if(Qe&&(Ze.push("RASTER_ARRAY"),Le||Ze.push("RASTER_COLOR"),ht==="linear"&&Ze.push("RASTER_ARRAY_LINEAR"),Ge=Ce.NEAREST,!Ct&&Se.rasterLayers)){const pt=Se.rasterLayers.find(({id:tt})=>tt===Te.sourceLayer);pt&&pt.fields&&pt.fields.range&&(Ct=pt.fields.range)}if(Ct=Ct||[0,1],Le){Ze.push("RASTER_COLOR"),ge.activeTexture.set(Ce.TEXTURE2),Te.updateColorRamp(Ct);let pt=Te.colorRampTexture;pt||(pt=Te.colorRampTexture=new r.T(ge,Te.colorRamp,Ce.RGBA8)),pt.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE)}return{mix:$e,range:Ct,offset:et,defines:Ze,resampling:Ge}}(k,a,I,z);if(k instanceof r.aP&&!u.length&&!v)return;const j=a.paint.get("raster-emissive-strength"),Q=c.colorModeForDrapableLayerRenderPass(j),Y=c.terrain&&c.terrain.renderingToTexture,ee=!c.options.moving,K=a.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;if(k instanceof r.aP&&!u.length&&(k.onNorthPole||k.onSouthPole)){const Se=w?c.stencilModeFor3D():Di.disabled;return void na(!!k.onNorthPole,null,c,t,a,j,O,Li.disabled,Se)}if(!u.length)return;const[se,pe]=k instanceof r.aP||Y?[{},u]:c.stencilConfigForOverlap(u),ve=pe[pe.length-1].overscaledZ;A&&O.defines.push("PROJECTION_GLOBE_VIEW"),w&&O.defines.push("RENDER_CUTOFF");const Ae=(Se,Te,ge)=>{for(const Ce of Se){const Le=Ce.toUnwrapped(),Qe=t.getTile(Ce);if(Y&&(!Qe||!Qe.hasData()))continue;I.activeTexture.set(z.TEXTURE0);const Ze=dd(Qe,k,a,O);if(!Ze||!Ze.texture)continue;const{texture:ht,mix:lt,offset:Ct,tileSize:$e,buffer:et}=Ze;let Ge,pt;Y?(Ge=ei.disabled,pt=Ce.projMatrix):w?(Ge=new ei(z.LEQUAL,ei.ReadWrite,c.depthRangeFor3D),pt=v?Float32Array.from(c.transform.expandedFarZProjMatrix):c.transform.calculateProjMatrix(Le,ee)):(Ge=c.depthModeForSublayer(Ce.overscaledZ-ve,a.paint.get("raster-opacity")===1?ei.ReadWrite:ei.ReadOnly,z.LESS),pt=c.transform.calculateProjMatrix(Le,ee));const tt=c.terrain&&Y?c.terrain.stencilModeForRTTOverlap(Ce):se[Ce.overscaledZ],bt=g?0:a.paint.get("raster-fade-duration");Qe.registerFadeDuration(bt);const dt=t.findLoadedParent(Ce,0),wt=nd(Qe,dt,t,c.transform,bt);let At,Qt;c.terrain&&c.terrain.prepareDrawTile(),I.activeTexture.set(z.TEXTURE0),ht.bind(K,z.CLAMP_TO_EDGE),I.activeTexture.set(z.TEXTURE1),dt?(dt.texture&&dt.texture.bind(K,z.CLAMP_TO_EDGE),At=Math.pow(2,dt.tileID.overscaledZ-Qe.tileID.overscaledZ),Qt=[Qe.tileID.canonical.x*At%1,Qe.tileID.canonical.y*At%1]):ht.bind(K,z.CLAMP_TO_EDGE),"useMipmap"in ht&&I.extTextureFilterAnisotropic&&c.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const ai=c.transform;let Yt;const ci=w?_f(ai):[0,0,0,0];let ii,Mi,Ni,Ai,Hi,zi=0;if(A&&k instanceof r.aP&&k.coordinates.length>3)ii=Float32Array.from(r.bh(r.dr(new r.cp(0,0,0)))),Mi=Float32Array.from(ai.globeMatrix),Ni=Float32Array.from(r.dm(ai)),Ai=[r.ay(ai.center.lng),r.aH(ai.center.lat)],Yt=k.elevatedGlobePerspectiveTransform,Hi=k.elevatedGlobeGridMatrix||new Float32Array(9);else if(A){const Bi=r.dn(Ce.canonical);zi=r.dp(Bi.getCenter().lat),ii=Float32Array.from(r.bh(r.dr(Ce.canonical))),Mi=Float32Array.from(ai.globeMatrix),Ni=Float32Array.from(r.dm(ai)),Ai=[r.ay(ai.center.lng),r.aH(ai.center.lat)],Yt=[0,0],Hi=Float32Array.from(r.dq(Ce.canonical,Bi,zi,ai.worldSize/ai._pixelsPerMercatorPixel))}else Yt=k instanceof r.aP?k.perspectiveTransform:[0,0],ii=new Float32Array(16),Mi=new Float32Array(9),Ni=new Float32Array(16),Ai=[0,0],Hi=new Float32Array(9);const wi=uo(pt,ii,Mi,Ni,Hi,Qt||[0,0],r.ah(c.transform.zoom),Ai,ci,At||1,wt,a,Yt,w?a.paint.get("raster-elevation"):0,2,lt,Ct,O.range,$e,et,j),an=c.isTileAffectedByFog(Ce),zn=c.getOrCreateProgram("raster",{defines:O.defines,overrideFog:an});if(c.uploadCommonUniforms(I,zn,Le),k instanceof r.aP){const Bi=k.elevatedGlobeVertexBuffer,on=k.elevatedGlobeIndexBuffer;if(Y||!v)k.boundsBuffer&&k.boundsSegments&&zn.draw(c,z.TRIANGLES,Ge,Di.disabled,Q,Li.disabled,wi,a.id,k.boundsBuffer,c.quadTriangleIndexBuffer,k.boundsSegments);else if(Bi&&on){const vn=ai.zoom<=r.cL?k.elevatedGlobeSegments:k.getSegmentsForLongitude(ai.center.lng);vn&&zn.draw(c,z.TRIANGLES,Ge,Di.disabled,Q,Te,wi,a.id,Bi,on,vn)}}else if(A){Ge=new ei(z.LEQUAL,ei.ReadOnly,c.depthRangeFor3D);const Bi=c.globeSharedBuffers;if(Bi){const[on,vn,wn]=Bi.getGridBuffers(zi,!1);zn.draw(c,z.TRIANGLES,Ge,ge||tt,c.colorModeForRenderPass(),Te,wi,a.id,on,vn,wn)}}else{const{tileBoundsBuffer:Bi,tileBoundsIndexBuffer:on,tileBoundsSegments:vn}=c.getTileBoundsBuffers(Qe);zn.draw(c,z.TRIANGLES,Ge,tt,Q,Li.disabled,wi,a.id,Bi,on,vn)}}if(!(k instanceof r.aP)&&A)for(const Ce of Se){const Le=Ce.canonical.y===(1<<Ce.canonical.z)-1;Ce.canonical.y===0&&na(!0,Ce,c,t,a,j,O,Te,ge||Di.disabled),Le&&na(!1,Ce,c,t,a,j,O,Te===Li.frontCW?Li.backCW:Li.frontCW,ge||Di.disabled)}};A?Ae(pe,c.renderElevatedRasterBackface?Li.backCW:Li.frontCW,c.stencilModeFor3D()):Ae(pe,Li.disabled,void 0),c.resetStencilClippingMasks()},"raster-particle":function(c,t,a,u,p,g){c.renderPass==="offscreen"&&function(v,w,A,I){if(!I.length)return;const z=v.context,k=z.gl,O=w.getSource();if(!(O instanceof ma))return;const j=Math.ceil(Math.sqrt(A.paint.get("raster-particle-count")));let Q=A.particlePositionRGBAImage;if(!Q||Q.width!==j){const pe=function(ve){const Ae=ve*ve,Se=new Uint8Array(4*Ae),Te=function(Ce){return Ce|=0,Ce=Math.imul(2747636419^Ce,2654435769),Ce=Math.imul(Ce^Ce>>>16,2654435769),((Ce=Math.imul(Ce^Ce>>>16,2654435769))>>>0)/4294967296},ge=1/1.1;for(let Ce=0;Ce<Ae;Ce++){const Le=ge*(Te(2*Ce+0)+ho),Qe=ge*(Te(2*Ce+1)+ho),Ze=255*Le%1,ht=255*Qe%1,lt=Ze,Ct=Qe-ht/255,$e=ht;Se[4*Ce+0]=255*(Le-Ze/255),Se[4*Ce+1]=255*lt,Se[4*Ce+2]=255*Ct,Se[4*Ce+3]=255*$e}return Se}(j);Q=A.particlePositionRGBAImage=new r.r({width:j,height:j},pe)}let Y=A.particleFramebuffer;Y?Y.width!==j&&(Y.destroy(),Y=A.particleFramebuffer=z.createFramebuffer(j,j,!0,null)):Y=A.particleFramebuffer=z.createFramebuffer(j,j,!0,null);const ee=[];for(const pe of I){const ve=w.getTile(pe);if(!(ve instanceof kh))continue;const Ae=Rl(ve,O,A);if(!Ae)continue;const Se=[ve.tileSize,ve.tileSize];let Te=A.tileFramebuffer;Te||(Te=A.tileFramebuffer=z.createFramebuffer(Se[0],Se[1],!0,null));let ge=ve.rasterParticleState;ge||(ge=ve.rasterParticleState=new Sp(z,pe,Se,Q));const Ce=ge.update(A.lastInvalidatedAt);ge.particleTextureDimension!==j&&ge.updateParticleTexture(pe,Q);const Le=ge.targetColorTexture;ge.targetColorTexture=ge.backgroundColorTexture,ge.backgroundColorTexture=Le;const Qe=ge.particleTexture0;ge.particleTexture0=ge.particleTexture1,ge.particleTexture1=Qe,ee.push([pe,Ae,ge,Ce])}if(ee.length===0)return;const K=r.q.now(),se=A.previousDrawTimestamp?.001*(K-A.previousDrawTimestamp):.0167;if(A.previousDrawTimestamp=K,A.hasColorMap()){z.activeTexture.set(k.TEXTURE0+2);let pe=A.colorRampTexture;pe||(pe=A.colorRampTexture=new r.T(z,A.colorRamp,k.RGBA8)),pe.bind(k.LINEAR,k.CLAMP_TO_EDGE)}z.bindFramebuffer.set(A.tileFramebuffer.framebuffer),function(pe,ve,Ae){const Se=pe.context,Te=Se.gl,ge=ve.tileFramebuffer;Se.activeTexture.set(Te.TEXTURE0);const Ce={u_texture:0,u_opacity:1.05*(Qe=ve.paint.get("raster-particle-fade-opacity-factor"))/(Qe+.05)},Le=pe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Qe;for(const Ze of Ae){const[,,ht,lt]=Ze;ge.colorAttachment.set(ht.targetColorTexture.texture),Se.viewport.set([0,0,ge.width,ge.height]),Se.clear({color:r.am.transparent}),lt&&(ht.backgroundColorTexture.bind(Te.NEAREST,Te.CLAMP_TO_EDGE),Le.draw(pe,Te.TRIANGLES,ei.disabled,Di.disabled,Zi.alphaBlended,Li.disabled,Ce,ve.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments))}}(v,A,ee),function(pe,ve,Ae,Se){const Te=pe.context,ge=Te.gl,Ce=Ae.tileFramebuffer,Le=pe.transform.projection.name==="globe",Qe=Ae.paint.get("raster-particle-max-speed");for(const Ze of Se){const[ht,lt,Ct]=Ze;Te.activeTexture.set(ge.TEXTURE0+0),lt.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),Ce.colorAttachment.set(Ct.targetColorTexture.texture);const $e=pe.getOrCreateProgram("rasterParticleDraw",{defines:lt.defines,overrideFog:!1});Te.activeTexture.set(ge.TEXTURE0+1);const et=lt.scalarData?[]:[0,1,2,3].map(tt=>r.dU[tt](ht));et.push(ht);const Ge=ht.canonical.x,pt=ht.canonical.y;for(const tt of et){const bt=ve.getTile(Le?tt.wrapped():tt);if(!bt)continue;const dt=bt.rasterParticleState;if(!dt)continue;const wt=tt.canonical.x+(1<<tt.canonical.z)*(tt.wrap-ht.wrap),At=tt.canonical.y;dt.particleTexture0.bind(ge.NEAREST,ge.CLAMP_TO_EDGE);const Qt=js(1,dt.particleTexture0.size[0],[wt-Ge,At-pt],0,lt.texture.size,2,Qe,lt.textureOffset,lt.scale,lt.offset);$e.draw(pe,ge.POINTS,ei.disabled,Di.disabled,Zi.alphaBlended,Li.disabled,Qt,Ae.id,dt.particleIndexBuffer,void 0,dt.particleSegment)}}}(v,w,A,ee),z.bindFramebuffer.set(A.particleFramebuffer.framebuffer),function(pe,ve,Ae,Se){const Te=pe.context,ge=Te.gl,Ce=ve.paint.get("raster-particle-max-speed"),Le=Se*ve.paint.get("raster-particle-speed-factor")*.15,Qe=function(ht){return Math.pow(ht,6)}(.01+1*ve.paint.get("raster-particle-reset-rate-factor")),Ze=ve.particleFramebuffer;Te.viewport.set([0,0,Ze.width,Ze.height]);for(const ht of Ae){const[,lt,Ct]=ht;Te.activeTexture.set(ge.TEXTURE0+0),lt.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),Te.activeTexture.set(ge.TEXTURE0+1);const $e=Ct.particleTexture0;$e.bind(ge.NEAREST,ge.CLAMP_TO_EDGE);const et=sh(1,$e.size[0],0,lt.texture.size,Ce,Le,Qe,lt.textureOffset,lt.scale,lt.offset);Ze.colorAttachment.set(Ct.particleTexture1.texture),Te.clear({color:r.am.transparent}),pe.getOrCreateProgram("rasterParticleUpdate",{defines:lt.defines}).draw(pe,ge.TRIANGLES,ei.disabled,Di.disabled,Zi.unblended,Li.disabled,et,ve.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments)}}(v,A,ee,se)}(c,t,a,u),c.renderPass==="translucent"&&(function(v,w,A,I,z){const k=v.context,O=k.gl,j=w.getSource().tileSize,Q=5*(1-r.af(r.cx,r.cx+1,v.transform.zoom))*j+A.paint.get("raster-particle-elevation"),Y=!v.options.moving,ee=v.transform.projection.name==="globe";if(!I.length)return;const[K,se]=v.stencilConfigForOverlap(I),pe=[];ee&&pe.push("PROJECTION_GLOBE_VIEW");const ve=v.stencilModeFor3D();for(const Ae of se){const Se=Ae.toUnwrapped(),Te=w.getTile(Ae);if(!Te.rasterParticleState)continue;const ge=Te.rasterParticleState,Ce=100;Te.registerFadeDuration(Ce);const Le=w.findLoadedParent(Ae,0),Qe=nd(Te,Le,w,v.transform,Ce);let Ze,ht;v.terrain&&v.terrain.prepareDrawTile(),k.activeTexture.set(O.TEXTURE0),ge.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),k.activeTexture.set(O.TEXTURE1),Le&&Le.rasterParticleState?(Le.rasterParticleState.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Ze=Math.pow(2,Le.tileID.overscaledZ-Te.tileID.overscaledZ),ht=[Te.tileID.canonical.x*Ze%1,Te.tileID.canonical.y*Ze%1]):ge.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const lt=ee?Float32Array.from(v.transform.expandedFarZProjMatrix):v.transform.calculateProjMatrix(Se,Y),Ct=v.transform,$e=dh(Ct),et=r.dn(Ae.canonical),Ge=r.dp(et.getCenter().lat);let pt,tt,bt,dt,wt;ee?(pt=Float32Array.from(r.bh(r.dr(Ae.canonical))),tt=Float32Array.from(Ct.globeMatrix),bt=Float32Array.from(r.dm(Ct)),dt=[r.ay(Ct.center.lng),r.aH(Ct.center.lat)],wt=Float32Array.from(r.dq(Ae.canonical,et,Ge,Ct.worldSize/Ct._pixelsPerMercatorPixel))):(pt=new Float32Array(16),tt=new Float32Array(9),bt=new Float32Array(16),dt=[0,0],wt=new Float32Array(9));const At=ol(lt,pt,tt,bt,wt,ht||[0,0],r.ah(v.transform.zoom),dt,$e,Ze||1,Qe,Q),Qt=v.isTileAffectedByFog(Ae),ai=v.getOrCreateProgram("rasterParticle",{defines:pe,overrideFog:Qt});if(v.uploadCommonUniforms(k,ai,Se),ee){const Yt=new ei(O.LEQUAL,ei.ReadOnly,v.depthRangeFor3D),ci=0,ii=v.globeSharedBuffers;if(ii){const[Mi,Ni,Ai]=ii.getGridBuffers(Ge,ci!==0);ai.draw(v,O.TRIANGLES,Yt,ve,Zi.alphaBlended,v.renderElevatedRasterBackface?Li.frontCCW:Li.backCCW,At,A.id,Mi,Ni,Ai)}}else{const Yt=v.depthModeForSublayer(0,ei.ReadOnly),ci=K[Ae.overscaledZ],{tileBoundsBuffer:ii,tileBoundsIndexBuffer:Mi,tileBoundsSegments:Ni}=v.getTileBoundsBuffers(Te);ai.draw(v,O.TRIANGLES,Yt,ci,Zi.alphaBlended,Li.disabled,At,A.id,ii,Mi,Ni)}}v.resetStencilClippingMasks()}(c,t,a,u),c.style.map.triggerRepaint())},background:function(c,t,a,u){const p=a.paint.get("background-color"),g=a.paint.get("background-color-use-theme").constantOr("default")==="none",v=a.paint.get("background-opacity"),w=a.paint.get("background-emissive-strength"),A=a.paint.get("background-pitch-alignment")==="viewport";if(v===0)return;const I=c.context,z=I.gl,k=c.transform,O=k.tileSize,j=a.paint.get("background-pattern");let Q;if(j!==void 0&&(j===null||(Q=c.imageManager.getPattern(r.I.from(j.toString()),a.scope,c.style.getLut(a.scope)),!Q)))return;const Y=!j&&p.a===1&&v===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==Y)return;const ee=Di.disabled,K=c.depthModeForSublayer(0,Y==="opaque"?ei.ReadWrite:ei.ReadOnly),se=c.colorModeForDrapableLayerRenderPass(w),pe=j?"backgroundPattern":"background";let ve,Ae=u;if(Ae||(ve=c.getBackgroundTiles(),Ae=Object.values(ve).map(Se=>Se.tileID)),j&&(I.activeTexture.set(z.TEXTURE0),c.imageManager.bind(c.context,a.scope)),A){const Se=c.getOrCreateProgram(pe,{overrideFog:!1,overrideRtt:!0}),Te=new Float32Array(r.bx([])),ge=new r.aM(0,0,0,0,0),Ce=j?ch(Te,w,v,c,0,a.scope,Q,A,{tileID:ge,tileSize:O}):rc(Te,w,v,p.toRenderColor(g?null:a.lut));Se.draw(c,z.TRIANGLES,K,ee,se,Li.disabled,Ce,a.id,c.viewportBuffer,c.quadTriangleIndexBuffer,c.viewportSegments)}else for(const Se of Ae){const Te=c.isTileAffectedByFog(Se),ge=c.getOrCreateProgram(pe,{overrideFog:Te}),Ce=Se.toUnwrapped(),Le=u?Se.projMatrix:c.transform.calculateProjMatrix(Ce);c.prepareDrawTile();const Qe=t?t.getTile(Se):ve?ve[Se.key]:new Cs(Se,O,k.zoom,c),Ze=j?ch(Le,w,v,c,0,a.scope,Q,A,{tileID:Se,tileSize:O}):rc(Le,w,v,p.toRenderColor(g?null:a.lut));c.uploadCommonUniforms(I,ge,Ce);const{tileBoundsBuffer:ht,tileBoundsIndexBuffer:lt,tileBoundsSegments:Ct}=c.getTileBoundsBuffers(Qe);ge.draw(c,z.TRIANGLES,K,ee,se,Li.disabled,Ze,a.id,ht,lt,Ct)}},sky:function(c,t,a){const u=c._atmosphere?r.ah(c.transform.zoom):1,p=a.paint.get("sky-opacity")*u;if(p===0)return;const g=c.context,v=a.paint.get("sky-type"),w=new ei(g.gl.LEQUAL,ei.ReadOnly,[0,1]),A=c.frameCounter/1e3%1;v==="atmosphere"?c.renderPass==="offscreen"?a.needsSkyboxCapture(c)&&(function(I,z,k,O){const j=I.context,Q=j.gl;let Y=z.skyboxFbo;if(!Y){Y=z.skyboxFbo=j.createFramebuffer(32,32,!0,null),z.skyboxGeometry=new fh(j),z.skyboxTexture=j.gl.createTexture(),Q.bindTexture(Q.TEXTURE_CUBE_MAP,z.skyboxTexture),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MAG_FILTER,Q.LINEAR);for(let pe=0;pe<6;++pe)Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,Q.RGBA,32,32,0,Q.RGBA,Q.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(Y.framebuffer),j.viewport.set([0,0,32,32]);const ee=z.getCenter(I,!0),K=I.getOrCreateProgram("skyboxCapture"),se=new Float64Array(16);r.bx(se),r.e3(se,se,.5*-Math.PI),Dl(I,z,K,se,ee,0),r.bx(se),r.e3(se,se,.5*Math.PI),Dl(I,z,K,se,ee,1),r.bx(se),r.cG(se,se,.5*-Math.PI),Dl(I,z,K,se,ee,2),r.bx(se),r.cG(se,se,.5*Math.PI),Dl(I,z,K,se,ee,3),r.bx(se),Dl(I,z,K,se,ee,4),r.bx(se),r.e3(se,se,Math.PI),Dl(I,z,K,se,ee,5),j.viewport.set([0,0,I.width,I.height])}(c,a),a.markSkyboxValid(c)):c.renderPass==="sky"&&function(I,z,k,O,j){const Q=I.context,Y=Q.gl,ee=I.transform,K=I.getOrCreateProgram("skybox");Q.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_CUBE_MAP,z.skyboxTexture);const se=((pe,ve,Ae,Se,Te)=>({u_matrix:pe,u_sun_direction:ve,u_cubemap:0,u_opacity:Se,u_temporal_offset:Te}))(ee.skyboxMatrix,z.getCenter(I,!1),0,O,j);I.uploadCommonUniforms(Q,K),K.draw(I,Y.TRIANGLES,k,Di.disabled,I.colorModeForRenderPass(),Li.backCW,se,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(c,a,w,p,A):v==="gradient"&&c.renderPass==="sky"&&function(I,z,k,O,j){const Q=I.context,Y=Q.gl,ee=I.transform,K=I.getOrCreateProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new fh(Q)),Q.activeTexture.set(Y.TEXTURE0);let se=z.colorRampTexture;se||(se=z.colorRampTexture=new r.T(Q,z.colorRamp,Y.RGBA8)),se.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const pe=((ve,Ae,Se,Te,ge)=>({u_matrix:ve,u_color_ramp:0,u_center_direction:Ae,u_radius:r.al(Se),u_opacity:Te,u_temporal_offset:ge}))(ee.skyboxMatrix,z.getCenter(I,!1),z.paint.get("sky-gradient-radius"),O,j);I.uploadCommonUniforms(Q,K),K.draw(I,Y.TRIANGLES,k,Di.disabled,I.colorModeForRenderPass(),Li.backCW,pe,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(c,a,w,p,A)},debug:function(c,t,a,u,p,g){for(let v=0;v<a.length;v++)if(p){const I=new r.am(u.r*.8,u.g*.8,u.b*.8,1);hc(c,t,a[v],u,-1,-1,g),hc(c,t,a[v],u,-1,1,g),hc(c,t,a[v],u,1,1,g),hc(c,t,a[v],u,1,-1,g),hc(c,t,a[v],I,0,0,g)}else hc(c,t,a[v],u,0,0,g)},custom:function(c,t,a,u){const p=c.context,g=a.implementation;if(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes("custom")||c.terrain&&(c.terrain.renderingToTexture||c.renderPass==="offscreen")&&a.isDraped(t)){if(c.renderPass==="offscreen"){const v=g.prerender;if(v){if(c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),c.transform.projection.name==="globe"){const w=c.transform.pointMerc;v.call(g,p.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),r.ah(c.transform.zoom),[w.x,w.y],c.transform.pixelsPerMeterRatio)}else v.call(g,p.gl,c.transform.customLayerMatrix());p.setDirty(),c.setBaseState()}}else if(c.renderPass==="translucent"){if(c.terrain&&c.terrain.renderingToTexture){const w=g.renderToTile;if(w){const A=u[0].canonical,I={x:A.x+u[0].wrap*(g.wrapTileId?0:1<<A.z),y:A.y,z:A.z};p.setDepthMode(ei.disabled),p.setStencilMode(Di.disabled),p.setColorMode(c.colorModeForRenderPass()),c.setCustomLayerDefaults(),w.call(g,p.gl,I),p.setDirty(),c.setBaseState()}return}c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),p.setStencilMode(Di.disabled);const v=g.renderingMode==="3d"?new ei(c.context.gl.LEQUAL,ei.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,ei.ReadOnly);if(p.setDepthMode(v),c.transform.projection.name==="globe"){const w=c.transform.pointMerc;g.render(p.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),r.ah(c.transform.zoom),[w.x,w.y],c.transform.pixelsPerMeterRatio)}else g.render(p.gl,c.transform.customLayerMatrix());p.setDirty(),c.setBaseState(),p.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(c,t,a,u){if(c.renderPass==="opaque")return;const p=a.paint.get("model-opacity").constantOr(1);if(p===0)return;const g=a.paint.get("model-cast-shadows");if(c.renderPass==="shadow"&&(!g||c.terrain&&p<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof r.ab))return;const v=c.shadowRenderer,w=a.paint.get("model-receive-shadows");v&&(v.useNormalOffset=!0,w||(v.enabled=!1));const A=()=>{v&&(v.useNormalOffset=!0,w||(v.enabled=!0))},I=t.getSource();if(c.renderPass==="light-beam"&&I.type!=="batched-model")return;if(I.type==="vector"||I.type==="geojson")return function(K,se,pe,ve,Ae){const Se=K.transform;if(Se.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${Se.projection.name} projection is not yet implemented`);const Te=Se.getFreeCameraOptions().position;if(!K.modelManager)return;const ge=K.modelManager;pe.modelManager=ge;const Ce=K.shadowRenderer;if(!pe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Le=pe._unevaluatedLayout._values["model-id"],Qe=Object.assign({},pe.layout.get("model-id").parameters),Ze=K.style.order.indexOf(pe.fqid);for(const ht of ve){const lt=se.getTile(ht).getBucket(pe);if(!lt||lt.projection.name!==Se.projection.name)continue;const Ct=lt.getModelUris();Ct&&!lt.modelsRequested&&(ge.addModelsFromBucket(Ct,Ae),lt.modelsRequested=!0);const $e=pc(ht,Se);Qe.zoom=$e;const et=Le.possiblyEvaluate(Qe);if(We(K,lt,ht),Oo.shadowUniformsInitialized=!1,Oo.useSingleShadowCascade=!!Ce&&Ce.getMaxCascadeForTile(ht.toUnwrapped())===0,K.renderPass==="shadow"&&Ce){if(K.currentShadowCascade===1&&lt.isInsideFirstShadowMapFrustum)continue;const tt=Se.calculatePosMatrix(ht.toUnwrapped(),Se.worldSize);if(Oo.tileMatrix.set(tt),Oo.shadowTileMatrix=Float32Array.from(Ce.calculateShadowPassMatrixFromMatrix(tt)),Oo.aabb.min.fill(0),Oo.aabb.max[0]=Oo.aabb.max[1]=r.aj,Oo.aabb.max[2]=0,Cp(lt,Oo,K,pe.scope))continue}const Ge=1<<ht.canonical.z,pt=[((Te.x-ht.wrap)*Ge-ht.canonical.x)*r.aj,(Te.y*Ge-ht.canonical.y)*r.aj,Te.z*Ge*r.aj];K.conflationActive&&Object.keys(lt.instancesPerModel).length>0&&K.style.isLayerClipped(pe,se.getSource())&&lt.updateReplacement(ht,K.replacementSource,Ze,Ae)&&(lt.uploaded=!1,lt.upload(K.context));for(let tt in lt.instancesPerModel){const bt=lt.instancesPerModel[tt];bt.features.length>0&&(tt=et.evaluate(bt.features[0].feature,{}));const dt=ge.getModel(tt,Ae);if(dt||ge.hasURLBeenRequested(tt)||lt.modelUris.includes(tt)||(lt.modelUris.push(tt),lt.modelsRequested=!1),dt&&dt.uploaded)for(const wt of dt.nodes)yd(K,pe,wt,bt,pt,ht,Oo)}}}(c,t,a,u,I.type==="vector"?a.scope:""),void A();if(!I.loaded())return;if(I.type==="batched-model")return function(K,se,pe,ve){pe.resetLayerRenderingStats(K);const Ae=K.context,Se=K.transform,Te=K.style.fog,ge=K.shadowRenderer;if(Se.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${Se.projection.name} projection is not yet implemented`);const Ce=K.transform.getFreeCameraOptions().position,Le=r.b$([],[Ce.x,Ce.y,Ce.z],K.transform.worldSize),Qe=r.eb([],Le),Ze=r.bx([]),ht=r.ec(Se.center.lat,Se.zoom),lt=r.bn([],[1,1,1/ht]);r.bo(Ze,Ze,Qe);const Ct=pe.paint.get("model-opacity").constantOr(1),$e=new ei(Ae.gl.LEQUAL,ei.ReadWrite,K.depthRangeFor3D),et=new ei(Ae.gl.LEQUAL,ei.ReadOnly,K.depthRangeFor3D),Ge=new r.cV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),pt=K.renderPass==="shadow",tt=pt&&ge?ge.getCurrentCascadeFrustum():Se.getFrustum(Se.scaleZoom(Se.worldSize)),bt=pe.paint.get("model-front-cutoff"),dt=bt[2]<1,wt=$c(K,pe.paint.get("model-cutoff-fade-range")),At=pe.getLayerRenderingStats();(function(Qt,ai,Yt,ci){const ii=Qt.terrain?Qt.terrain.exaggeration():0,Mi=Qt.transform.zoom;for(const Ni of ci){const Ai=ai.getTile(Ni).getBucket(Yt);Ai&&(Ai.setFilter(Yt.filter),Qt.conflationActive&&Ai.updateReplacement(Ni,Qt.replacementSource),Ai.evaluateScale(Qt,Yt),Qt.terrain&&ii>0&&Ai.elevationUpdate(Qt.terrain,ii,Ni,Yt.source),Ai.needsReEvaluation(Qt,Mi,Yt)&&Ai.evaluate(Yt))}})(K,se,pe,ve),function(){let Qt,ai,Yt;dt?(Qt=ve.length-1,ai=-1,Yt=-1):(Qt=0,ai=ve.length,Yt=1);const ci=new Float64Array(16),ii=r.eg(),Mi=new r.P(0,0);for(let Ni=Qt;Ni!==ai;Ni+=Yt){const Ai=ve[Ni],Hi=se.getTile(Ai).getBucket(pe);if(!Hi||!Hi.uploaded)continue;let zi=!1;ge&&(zi=ge.getMaxCascadeForTile(Ai.toUnwrapped())===0);const wi=Se.calculatePosMatrix(Ai.toUnwrapped(),Se.worldSize),an=Hi.modelTraits;!pt&&dt&&(r.bi(ci,wi),r.ad(ii,Le,ci),Mi.x=ii[0],Mi.y=ii[1]);const zn=[];Hi.setFilter(pe.filter);for(const Bi of Hi.getNodesInfo()){if(Bi.hiddenByReplacement||!Bi.node.meshes)continue;const on=Bi.node;let vn=0;K.terrain&&on.elevation&&(vn=on.elevation*K.terrain.exaggeration());const wn=(()=>{const ir=Bi.aabb;return Ge.min=[...ir.min],Ge.max=[...ir.max],Ge.min[2]+=vn,Ge.max[2]+=vn,r.ad(Ge.min,Ge.min,wi),r.ad(Ge.max,Ge.max,wi),Ge})(),Pn=Bi.evaluatedScale;if(Pn[0]<=1&&Pn[1]<=1&&Pn[2]<=1&&wn.intersects(tt)===0)continue;if(!pt&&dt){const ir=.16666666666666666;Bi.cameraCollisionOpacity=Le[0]>wn.min[0]&&Le[0]<wn.max[0]&&Le[1]>wn.min[1]&&Le[1]<wn.max[1]&&Le[2]*ht<wn.max[2]&&on.footprint&&r.bS(Mi,on.footprint)?Math.max(Bi.cameraCollisionOpacity-ir,0):Math.min(1,Bi.cameraCollisionOpacity+ir)}const er=[...wi],Ar=on.anchor?on.anchor[0]:0,tr=on.anchor?on.anchor[1]:0;r.bo(er,er,[Ar*(Pn[0]-1),tr*(Pn[1]-1),vn]),r.ci(Pn,r.eh)||r.cE(er,er,Pn);const ki=r.az([],er,on.matrix),$n=r.az([],Se.expandedFarZProjMatrix,ki),mn=r.az([],Se.expandedFarZProjMatrix,er),Sn=r.aA([],[Ar,tr,vn,1],$n)[2];on.hidden=!1;let En=Ct;pt||(dt&&(En*=Bi.cameraCollisionOpacity,En*=cu(er,Se,Bi.aabb,bt)),En*=Rp(wt,Sn)),En!==0?zn.push({nodeInfo:Bi,depth:Sn,opacity:En,wvpForNode:$n,wvpForTile:mn,nodeModelMatrix:ki,tileModelMatrix:er}):on.hidden=!0}pt||zn.sort((Bi,on)=>!dt||Bi.opacity===1&&on.opacity===1?Bi.depth<on.depth?-1:1:Bi.opacity===1?-1:on.opacity===1?1:Bi.depth>on.depth?-1:1);for(const Bi of zn){const on=Bi.nodeInfo,vn=on.node;let wn=r.az([],lt,Bi.tileModelMatrix);r.az(wn,Ze,wn);const Pn=r.bi([],wn);r.ee(Pn,Pn),r.cE(Pn,Pn,xf),wn=r.az(wn,wn,vn.matrix);const er=K.renderPass==="light-beam",Ar=pe.paint.get("model-color-use-theme").constantOr("default")==="none",tr=an&r.em.HasMapboxMeshFeatures,ki=tr?0:on.evaluatedRMEA[0][2];for(let $n=0;$n<vn.meshes.length;++$n){const mn=vn.meshes[$n],Sn=$n===vn.lightMeshIndex;let En=Bi.wvpForNode;if(Sn){if(!er&&!K.terrain&&K.shadowRenderer){K.currentLayer<K.firstLightBeamLayer&&(K.firstLightBeamLayer=K.currentLayer);continue}En=Bi.wvpForTile}else if(er)continue;const ir={defines:[]},ra=[];if(!pt&&ge&&(ge.useNormalOffset=!!mn.normalBuffer),Nt(ir.defines,ra,mn,K,Ar?null:pe.lut),tr||ir.defines.push("DIFFUSE_SHADED"),zi&&ir.defines.push("SHADOWS_SINGLE_CASCADE"),At&&(pt?At.numRenderedVerticesInShadowPass+=mn.vertexArray.length:At.numRenderedVerticesInTransparentPass+=mn.vertexArray.length),pt){wr(mn,Bi.nodeModelMatrix,K,pe);continue}let Zn=null;if(Te){const Ka=fc(Bi.nodeModelMatrix,K.transform);if(Zn=new Float32Array(Ka),Se.projection.name!=="globe"){const Bo=mn.aabb.min,Zs=mn.aabb.max,[Fo,Jo]=Te.getOpacityForBounds(Ka,Bo[0],Bo[1],Zs[0],Zs[1]);ir.overrideFog=Fo>=Pt||Jo>=Pt}}const Ur=mn.material;let jn;Ur.occlusionTexture&&Ur.occlusionTexture.offsetScale&&(jn=Ur.occlusionTexture.offsetScale,ir.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const qr=K.getOrCreateProgram("model",ir);!pt&&ge&&ge.setupShadowsFromMatrix(Bi.tileModelMatrix,qr,ge.useNormalOffset),K.uploadCommonUniforms(Ae,qr,null,Zn);const Ya=Ur.pbrMetallicRoughness;Ya.metallicFactor=.9,Ya.roughnessFactor=.5;const No=ac(new Float32Array(En),new Float32Array(wn),new Float32Array(Pn),new Float32Array(vn.matrix),K,Bi.opacity,Ya.baseColorFactor.toRenderColor(null),Ur.emissiveFactor,Ya.metallicFactor,Ya.roughnessFactor,Ur,ki,pe,[0,0,0],jn);!Sn&&(on.hasTranslucentParts||Bi.opacity<1)&&qr.draw(K,Ae.gl.TRIANGLES,$e,Di.disabled,Zi.disabled,Li.backCCW,No,pe.id,mn.vertexBuffer,mn.indexBuffer,mn.segments,pe.paint,K.transform.zoom,void 0,ra),qr.draw(K,Ae.gl.TRIANGLES,Sn?et:$e,Di.disabled,Sn||Bi.opacity<1||on.hasTranslucentParts?Zi.alphaBlended:Zi.unblended,Li.backCCW,No,pe.id,mn.vertexBuffer,mn.indexBuffer,mn.segments,pe.paint,K.transform.zoom,void 0,ra)}}}}()}(c,t,a,u),void A();if(I.type!=="model")return;const z=I.getModels(),k=[],O=c.transform.getFreeCameraOptions().position,j=r.b$([],[O.x,O.y,O.z],c.transform.worldSize);r.eb(j,j);const Q=[],Y=[];let ee=0;for(const K of z){const se=a.paint.get("model-rotation").constantOr(null),pe=a.paint.get("model-scale").constantOr(null),ve=a.paint.get("model-translation").constantOr(null);K.computeModelMatrix(c,se,pe,ve,!0,!0,!1);const Ae=r.bx([]),Se=r.ec(K.position.lat,c.transform.zoom),Te=r.bn([],[1,1,1/Se]);r.bo(Ae,Ae,j),k.push({zScaleMatrix:Te,negCameraPosMatrix:Ae});for(const ge of K.nodes)ps(c.transform,ge,K.matrix,c.transform.expandedFarZProjMatrix,ee,Q,Y);ee++}if(Q.sort((K,se)=>se.depth-K.depth),c.renderPass!=="shadow"){if(p===1)for(const K of Y)Xt(K,c,a,k[K.modelIndex],Di.disabled,c.colorModeForRenderPass());else{for(const K of Y)Xt(K,c,a,k[K.modelIndex],Di.disabled,Zi.disabled);for(const K of Y)Xt(K,c,a,k[K.modelIndex],c.stencilModeFor3D(),c.colorModeForRenderPass());c.resetStencilClippingMasks()}for(const K of Q)Xt(K,c,a,k[K.modelIndex],Di.disabled,c.colorModeForRenderPass());A()}else{for(const K of Y)wr(K.mesh,K.nodeModelMatrix,c,a);for(const K of Q)wr(K.mesh,K.nodeModelMatrix,c,a);A()}}},hu={line:function(c,t,a){if(c.hasElevatedBuckets=!1,c.hasNonElevatedBuckets=!1,c._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||c._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const u=t.getVisibleCoordinates();for(const p of u){const g=t.getTile(p).getBucket(c);if(g&&(g.elevationType!=="none"?c.hasElevatedBuckets=!0:c.hasNonElevatedBuckets=!0,c.hasElevatedBuckets&&c.hasNonElevatedBuckets))break}}}else c.hasNonElevatedBuckets=!0},model:function(c,t,a){const u=t.getSource();if(!u.loaded())return;if(u.type==="vector"||u.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,u.type==="vector"?c.scope:""));if(u.type==="batched-model"||u.type!=="model")return;const p=u.getModels();for(const g of p)g.upload(a.context)},raster:function(c,t,a){const u=t.getSource();if(!(u instanceof ma&&u.loaded()))return;const p=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const g=c.paint.get("raster-array-band")||u.getInitialBand(p);if(g==null)return;const v=t.getIds().map(w=>t.getTileByID(w));for(const w of v)w.updateNeeded(p,g)&&u.prepareTile(w,p,g)},"raster-particle":function(c,t,a){const u=t.getSource();if(!(u instanceof ma&&u.loaded()))return;const p=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const g=c.paint.get("raster-particle-array-band")||u.getInitialBand(p);if(g==null)return;const v=t.getIds().map(w=>t.getTileByID(w));for(const w of v)w.updateNeeded(p,g)&&u.prepareTile(w,p,g)}},Vs={fill:Kr};class du{constructor(t,a,u,p,g){this.context=new Nn(t,a),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=g,this._timeStamp=r.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const v=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const A of v)this._debugParams.enabledLayers[A]=!0;g.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),g.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),g.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),g.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const A of v)g.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],A);this.occlusionParams=new Dp(g),this.setup(),this.numSublayers=Sa.maxUnderzooming+Sa.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new qo(this),this._wireframeDebugCache=new Ip,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const w=new r.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,w,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=p}updateTerrain(t,a){const u=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new tc(this,t));const p=this._terrain;this.transform.elevation=u?p:null,p.update(t,this.transform,a),this.transform.elevation&&!p.enabled&&(this.transform.elevation=null)}_updateFog(t){const a=t.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,p]=a.getFovAdjustedRange(this.transform._fov);if(u>p)return void(this.transform.fogCullDistSq=null);const g=u+.78*(p-u);this.transform.fogCullDistSq=g*g}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new tc(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,a){if(this.width=t*r.q.devicePixelRatio,this.height=a*r.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._mergedLayers[u].resize()}setup(){const t=this.context,a=new r.ba;a.emplaceBack(0,0),a.emplaceBack(r.aj,0),a.emplaceBack(0,r.aj),a.emplaceBack(r.aj,r.aj),this.tileExtentBuffer=t.createVertexBuffer(a,r.bc.members),this.tileExtentSegments=r.bd.simpleSegment(0,0,4,2);const u=new r.ba;u.emplaceBack(0,0),u.emplaceBack(r.aj,0),u.emplaceBack(0,r.aj),u.emplaceBack(r.aj,r.aj),this.debugBuffer=t.createVertexBuffer(u,r.bc.members),this.debugSegments=r.bd.simpleSegment(0,0,4,5);const p=new r.ba;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(p,r.bc.members),this.viewportSegments=r.bd.simpleSegment(0,0,4,2);const g=new r.aZ;g.emplaceBack(0,0,0,0),g.emplaceBack(r.aj,0,r.aj,0),g.emplaceBack(0,r.aj,0,r.aj),g.emplaceBack(r.aj,r.aj,r.aj,r.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(g,r.bf.members),this.mercatorBoundsSegments=r.bd.simpleSegment(0,0,4,2);const v=new r.a_;v.emplaceBack(0,1,2),v.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(v);const w=new r.bb;for(const I of[0,1,3,2,0])w.emplaceBack(I);this.debugIndexBuffer=t.createIndexBuffer(w),this.emptyTexture=new r.T(t,new r.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=r.bz();const A=this.context.gl;this.stencilClearMode=new Di({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,ei.disabled,this.stencilClearMode,Zi.disabled,Li.disabled,co(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,a,u){if(!a||this.currentStencilSource===a.id||!t.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let w=!1;for(const A of u)if(this._tileClippingMaskIDs[A.key]===void 0){w=!0;break}if(!w)return}this.currentStencilSource=a.id;const p=this.context,g=p.gl;this.nextStencilID+u.length>256&&this.clearStencil(),p.setColorMode(Zi.disabled),p.setDepthMode(ei.disabled);const v=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of u){const A=a.getTile(w),I=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:k,tileBoundsSegments:O}=this.getTileBoundsBuffers(A);v.draw(this,g.TRIANGLES,ei.disabled,new Di({func:g.ALWAYS,mask:0},I,255,g.KEEP,g.KEEP,g.REPLACE),Zi.disabled,Li.disabled,co(w.projMatrix),"$clipping",z,k,O)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new Di({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const a=this.context.gl;return new Di({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,u=t.sort((v,w)=>w.overscaledZ-v.overscaledZ),p=u[u.length-1].overscaledZ,g=u[0].overscaledZ-p+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const v={};for(let w=0;w<g;w++)v[w+p]=new Di({func:a.GEQUAL,mask:255},w+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=g,[v,u]}return[{[p]:Di.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Zi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new r.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Zi.unblended:Zi.alphaBlended}colorModeForDrapableLayerRenderPass(t){const a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Zi([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new r.am(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,a,u,p=!1){if(this.depthOcclusion)return new ei(this.context.gl.GREATER,ei.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!p)return ei.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ei(u||this.context.gl.LEQUAL,a,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,a=Math.ceil(this.width),u=Math.ceil(this.height),p=this.context.bindFramebuffer.get(),g=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===u||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&u!==0&&(this.depthFBO=new Us(this.context,a,u,!1,"texture"),this.depthTexture=new r.T(this.context,{width:a,height:u,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(p),t.bindTexture(t.TEXTURE_2D,g),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,a,u,0,0,a,u,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,a)=>t+a/this._fpsHistory.length,0))}render(t,a){const u=r.q.now();this._dt=u-this._timeStamp,this._timeStamp=u,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=a;const p=this.style._mergedLayers,g=!(!this.terrain||!this.terrain.enabled),v=()=>this.style._getOrder(g).filter($e=>{const et=p[$e];return!(et.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[et.type]});let w=v(),A=!1,I=!1;for(const $e of w){const et=p[$e];et.type==="circle"&&(A=!0),et.type==="symbol"&&(et.hasInitialOcclusionOpacityProperties?I=!0:A=!0)}let z=w.map($e=>p[$e]);const k=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(r.q.now()),this.imageManager.beginFrame();let O=0,j=!1;for(const $e in k){const et=k[$e];et.used&&(et.prepare(this.context),et.getSource().usedInConflation&&++O)}let Q=!1;for(const $e of z)$e.isHidden(this.transform.zoom)||($e.type==="clip"&&(Q=!0),this.prepareLayer($e));const Y={},ee={},K={},se={},pe={};for(const $e in k){const et=k[$e];Y[$e]=et.getVisibleCoordinates(),ee[$e]=Y[$e].slice().reverse(),K[$e]=et.getVisibleCoordinates(!0).reverse(),se[$e]=et.getShadowCasterCoordinates(),pe[$e]=et.sortCoordinatesByDistance(Y[$e])}const ve=$e=>{const et=this.style.getLayerSourceCache($e);return et&&et.used?et.getSource():null};if(O||Q||this._clippingActiveLastFrame){const $e=[],et=[];let Ge=0;for(const pt of z)this.isSourceForClippingOrConflation(pt,ve(pt))&&($e.push(pt),et.push(Ge)),Ge++;if($e&&(Q||$e.length>1)||this._clippingActiveLastFrame){Q=!1;const pt=[];for(let tt=0;tt<$e.length;tt++){const bt=$e[tt],dt=et[tt],wt=this.style.getLayerSourceCache(bt);if(!wt||!wt.used||!wt.getSource().usedInConflation&&bt.type!=="clip")continue;let At=r.ev,Qt=r.bQ.None;const ai=[];let Yt=!0;if(bt.type==="clip"){At=dt;for(const ci of bt.layout.get("clip-layer-types"))Qt|=ci==="model"?r.bQ.Model:ci==="symbol"?r.bQ.Symbol:r.bQ.FillExtrusion;for(const ci of bt.layout.get("clip-layer-scope"))ai.push(ci);bt.isHidden(this.transform.zoom)?Yt=!1:Q=!0}Yt&&pt.push({layer:bt.fqid,cache:wt,order:At,clipMask:Qt,clipScope:ai})}this.replacementSource.setSources(pt),j=!0}}this._clippingActiveLastFrame=Q,j||this.replacementSource.clear(),this.conflationActive=j,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let $e=0;$e<z.length;$e++){const et=z[$e],Ge=et.cutoffRange();if(this.longestCutoffRange=Math.max(Ge,this.longestCutoffRange),Ge>0){const pt=ve(et);pt&&(this.minCutoffZoom=Math.max(pt.minzoom,this.minCutoffZoom)),et.minzoom&&(this.minCutoffZoom=Math.max(et.minzoom,this.minCutoffZoom))}et.is3D(g)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=$e),this._lastOcclusionLayer=$e)}const Ae=this.style&&this.style.fog;Ae?(this._fogVisible=Ae.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ae.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(K),this.opaquePassCutoff=0,w=v(),z=w.map($e=>p[$e]));const Se=this._shadowRenderer;if(Se){Se.updateShadowParameters(this.transform,this.style.directionalLight);for(const $e in k)for(const et of Y[$e]){let Ge={min:0,max:0};this.terrain&&(Ge=this.terrain.getMinMaxForTile(et)||Ge),Se.addShadowReceiver(et.toUnwrapped(),Ge.min,Ge.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.eu(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new lu(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ge=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Te&&!this._snow&&(this._snow=new hr(this)),!Te&&this._snow&&(this._snow.destroy(),delete this._snow),ge&&!this._rain&&(this._rain=new Fm(this)),!ge&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!xn.has(this.context.gl))return;this.renderPass="offscreen";for(const $e of z){const et=t.getLayerSourceCache($e);if(!$e.hasOffscreenPass()||$e.isHidden(this.transform.zoom))continue;const Ge=et?ee[et.id]:void 0;($e.type==="custom"||$e.type==="raster"||$e.type==="raster-particle"||$e.isSky()||Ge&&Ge.length)&&this.renderLayer(this,et,$e,Ge)}this.depthRangeFor3D=[0,1-(z.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,se)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ce=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Le=(()=>{if(a.showOverdrawInspector)return r.am.black;const $e=this.style.fog;if($e&&this.transform.projection.supportsFog){const et=this.style.getLut($e.scope);if(!Ce){const Ge=$e.properties.get("color-use-theme")==="none",pt=$e.properties.get("color").toRenderColor(Ge?null:et).toArray01();return new r.am(...pt)}if(Ce){const Ge=$e.properties.get("space-color-use-theme")==="none",pt=$e.properties.get("space-color").toRenderColor(Ge?null:et).toArray01();return new r.am(...pt)}}return r.am.transparent})();if(this.context.clear({color:Le,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ce&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const $e=z[this.currentLayer],et=t.getLayerSourceCache($e);if($e.isSky())continue;const Ge=et?($e.is3D(g)?pe:ee)[et.id]:void 0;this._renderTileClippingMasks($e,et,Ge),this.renderLayer(this,et,$e,Ge)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ce&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const $e=z[this.currentLayer],et=t.getLayerSourceCache($e);$e.isSky()&&this.renderLayer(this,et,$e,et?ee[et.id]:void 0)}function Qe($e,et){let Ge;return et&&(Ge=($e.type==="symbol"?K:$e.is3D(g)?pe:ee)[et.id]),Ge}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<w.length;){const $e=z[this.currentLayer];if($e.type==="raster"||$e.type==="raster-particle"){const et=t.getLayerSourceCache($e);this.renderLayer(this,et,$e,Qe($e,et))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ze=0;Se&&(Ze=Se.getShadowCastingLayerCount());let ht=!1,lt=-1;for(let $e=0;$e<w.length;++$e){const et=z[$e];et.isHidden(this.transform.zoom)||et.is3D(g)&&(lt=$e)}I&&lt===-1&&(A=!0);let Ct=!1;for(;this.currentLayer<w.length;){const $e=z[this.currentLayer],et=t.getLayerSourceCache($e);if($e.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped($e)){if($e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Ct&&$e.is3D(g)&&!g){const Ge=this.currentLayer,pt=tt=>{for(this.currentLayer=0;this.currentLayer<z.length;this.currentLayer++){const bt=z[this.currentLayer];if(Vs[bt.type]){const dt=this.style.getLayerSourceCache(bt);Vs[bt.type](this,dt,bt,Qe(bt,dt),tt)}}};pt("initialize"),pt("reset"),this.currentLayer=Ge,Ct=!0}if(A&&!ht&&this.terrain&&!this.transform.isOrthographic&&(ht=!0,this.blitDepth()),I&&lt!==-1&&this.currentLayer===lt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks($e,et,et?Y[et.id]:void 0),this.renderLayer(this,et,$e,Qe($e,et)),!this.terrain&&Se&&Ze>0&&$e.hasShadowPass()&&--Ze==0&&(Se.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Ge=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ge;this.currentLayer++){const pt=z[this.currentLayer];if(!pt.hasLightBeamPass())continue;const tt=t.getLayerSourceCache(pt);this.renderLayer(this,tt,pt,tt?ee[tt.id]:void 0)}this.currentLayer=Ge,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ge=this.currentLayer;this.depthOcclusion=!0;for(const pt of this.layersWithOcclusionOpacity){this.currentLayer=pt;const tt=z[this.currentLayer],bt=t.getLayerSourceCache(tt),dt=bt?ee[bt.id]:void 0;this.terrain||this._renderTileClippingMasks(tt,bt,bt?Y[bt.id]:void 0),this.renderLayer(this,bt,tt,dt)}this.depthOcclusion=!1,this.currentLayer=Ge,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let $e=null;z.forEach(et=>{const Ge=t.getLayerSourceCache(et);Ge&&!et.isHidden(this.transform.zoom)&&Ge.getVisibleCoordinates().length&&(!$e||$e.getSource().maxzoom<Ge.getSource().maxzoom)&&($e=Ge)}),$e&&this.options.showTileBoundaries&&bn.debug(this,$e,$e.getVisibleCoordinates(),r.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&bn.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function($e){const et=$e.transform.padding;gd($e,$e.transform.height-(et.top||0),3,pd),gd($e,et.bottom||0,3,md),_d($e,et.left||0,3,yf),_d($e,$e.transform.width-(et.right||0),3,po);const Ge=$e.transform.centerPoint;(function(pt,tt,bt,dt){dc(pt,tt-1,bt-10,2,20,dt),dc(pt,tt-10,bt-1,20,2,dt)})($e,Ge.x,$e.transform.height-Ge.y,Il)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),j||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:a}=this.transform.projection,u=!a||!a.includes(t.type);if(hu[t.type]&&(u||this.terrain&&t.type==="custom")){const p=this.style.getLayerSourceCache(t);hu[t.type](t,p,this)}this.gpuTimingEnd()}renderLayer(t,a,u,p){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||u.type==="model"||u.type==="raster"||u.type==="raster-particle"||p&&p.length)&&(this.id=u.id,this.gpuTimingStart(u),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(u.type)&&(!t.terrain||u.type!=="custom")||u.type==="clip"||bn[u.type](t,a,u,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,u=this.context.gl;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:u.createQuery()}),p.calls++,u.beginQuery(a.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,a=this.context.gl,u=a.createQuery();this.deferredRenderGpuTimeQueries.push(u),a.beginQuery(t.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const a={};for(const u in t){const p=t[u],g=this.context.extTimerQuery,v=g.getQueryParameter(p.query,this.context.gl.QUERY_RESULT)/1e6;g.deleteQueryEXT(p.query),a[u]=v}return a}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.gl;let u=0;for(const p of t)u+=a.getQueryParameter(p,a.QUERY_RESULT)/1e6,a.deleteQuery(p);return u}translatePosMatrix(t,a,u,p,g){if(!u[0]&&!u[1])return t;const v=g?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(v){const I=Math.sin(v),z=Math.cos(v);u=[u[0]*z-u[1]*I,u[0]*I+u[1]*z]}const w=[g?u[0]:r.aw(a,u[0],this.transform.zoom),g?u[1]:r.aw(a,u[1],this.transform.zoom),0],A=new Float32Array(16);return r.bo(A,t,w),A}saveTileTexture(t){const a=t.size[0],u=this._tileTextures[a];u?u.push(t):this._tileTextures[a]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,a,u){const p=u===void 0?this.terrain&&this.terrain.renderingToTexture:u,g=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(g.push("LIGHTING_3D_MODE"),g.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):p||g.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||g.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(g.push("TERRAIN"),this.linearFloatFilteringSupported()&&g.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&g.push("GLOBE"),!this._fogVisible||p||a!==void 0&&!a||g.push("FOG","FOG_DITHERING"),p&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}getOrCreateProgram(t,a){this.cache=this.cache||{};const u=a&&a.defines||[],p=a&&a.config,g=this.currentGlobalDefines(t,a&&a.overrideFog,a&&a.overrideRtt).concat(u),v=Ml.cacheKey(hs[t],t,g,p);return this.cache[v]||(this.cache[v]=new Ml(this.context,t,hs[t],p,gf[t],g)),this.cache[v]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,a){if(this.style.enable3dLights()){const u=this.style.directionalLight,p=this.style.ambientLight;if(u&&p){const g=((v,w,A)=>{const I=v.properties.get("direction"),z=v.properties.get("color-use-theme")==="none",k=v.properties.get("color").toRenderColor(z?null:A.getLut(v.scope)).toArray01(),O=v.properties.get("intensity"),j=w.properties.get("color-use-theme")==="none",Q=w.properties.get("color").toRenderColor(j?null:A.getLut(w.scope)).toArray01(),Y=w.properties.get("intensity"),ee=[I.x,I.y,I.z],K=r.dw(Q,Y),se=r.dw(k,O);return{u_lighting_ambient_color:K,u_lighting_directional_dir:ee,u_lighting_directional_color:se,u_ground_radiance:nu(ee,se,K)}})(u,p,this.style);a.setLightsUniformValues(t,g)}}}uploadCommonUniforms(t,a,u,p,g){if(this.uploadCommonLightUniforms(t,a),this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const w=v.getOpacity(this.transform.pitch),A=((I,z,k,O,j,Q,Y,ee,K,se,pe,ve)=>{const Ae=I.transform,Se=z.properties.get("color-use-theme")==="none",Te=z.properties.get("color").toRenderColor(Se?null:I.style.getLut(z.scope)).toArray01();Te[3]=O;const ge=I.frameCounter/1e3%1,[Ce,Le]=z.properties.get("vertical-range");return{u_fog_matrix:k?Ae.calculateFogTileMatrix(k):ve||I.identityMat,u_fog_range:z.getFovAdjustedRange(Ae._fov),u_fog_color:Te,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ce,Le),Le],u_fog_temporal_offset:ge,u_frustum_tl:j,u_frustum_tr:Q,u_frustum_br:Y,u_frustum_bl:ee,u_globe_pos:K,u_globe_radius:se,u_viewport:pe,u_globe_transition:r.ah(Ae.zoom),u_is_globe:+(Ae.projection.name==="globe")}})(this,v,u,w,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.q.devicePixelRatio,this.transform.height*r.q.devicePixelRatio],p);a.setFogUniformValues(t,A)}g&&a.setCutoffUniformValues(t,g.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,a=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const p of u)a[p.key]=t[p.key]||new Cs(p,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,a){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[t.key];return a||(this._cachedTileFogOpacities[t.key]=a=this.style.fog.getOpacityForTile(t)),a[0]>=Pt||a[1]>=Pt}setupDepthForOcclusion(t,a,u){const p=this.context,g=p.gl,v=!!u;var w;u||(u={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),p.activeTexture.set(g.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),u.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],u.u_depth_range_unpack=[2/((w=this.depthRangeFor3D)[1]-w[0]),-1-2*w[0]/(w[1]-w[0])],u.u_occluder_half_size=.5*this.occlusionParams.occluderSize,u.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),p.activeTexture.set(g.TEXTURE0),v||a.setTerrainUniformValues(p,u)}}function gc(c,t){let a=!1,u=null;const p=()=>{u=null,a&&(c(),u=setTimeout(p,t),a=!1)};return()=>(a=!0,u||p(),u)}class fu{constructor(t){this._hashName=t&&encodeURIComponent(t),r.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=gc(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const a=pu(t);if(this._hashName){const u=this._hashName;let p=!1;const g=location.hash.slice(1).split("&").map(v=>{const w=v.split("=")[0];return w===u?(p=!0,`${w}=${a}`):v}).filter(v=>v);return p||g.push(`${u}=${a}`),`#${g.join("&")}`}return`#${a}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let a;return t.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(a=u)}),(a&&a[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(u=>isNaN(Number(u)))){const u=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(a[3]||0):t.getBearing();return t.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:u,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function pu(c,t){const a=c.getCenter(),u=Math.round(100*c.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,p),v=Math.round(a.lng*g)/g,w=Math.round(a.lat*g)/g,A=c.getBearing(),I=c.getPitch();let z=t?`/${v}/${w}/${u}`:`${u}/${w}/${v}`;return(A||I)&&(z+="/"+Math.round(10*A)/10),I&&(z+=`/${Math.round(I)}`),z}const mu={linearity:.3,easing:r.ew(0,0,.3,1)},Sf=r.l({deceleration:2500,maxSpeed:1400},mu),Pp=r.l({deceleration:20,maxSpeed:1400},mu),mo=r.l({deceleration:1e3,maxSpeed:360},mu),Wo=r.l({deceleration:1e3,maxSpeed:90},mu);class gu{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=r.q.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)a.zoom+=g.zoomDelta||0,a.bearing+=g.bearingDelta||0,a.pitch+=g.pitchDelta||0,g.panDelta&&a.pan._add(g.panDelta),g.around&&(a.around=g.around),g.pinchAround&&(a.pinchAround=g.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(a.pan.mag()){const g=zl(a.pan.mag(),u,r.l({},Sf,t||{}));p.offset=a.pan.mult(g.amount/a.pan.mag()),p.center=this._map.transform.center,Gs(p,g)}if(a.zoom){const g=zl(a.zoom,u,Pp);p.zoom=this._map.transform.zoom+g.amount,Gs(p,g)}if(a.bearing){const g=zl(a.bearing,u,mo);p.bearing=this._map.transform.bearing+r.aD(g.amount,-179,179),Gs(p,g)}if(a.pitch){const g=zl(a.pitch,u,Wo);p.pitch=this._map.transform.pitch+g.amount,Gs(p,g)}if(p.zoom||p.bearing){const g=a.pinchAround===void 0?a.around:a.pinchAround;p.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function Gs(c,t){(!c.duration||c.duration<t.duration)&&(c.duration=t.duration,c.easing=t.easing)}function zl(c,t,a){const{maxSpeed:u,linearity:p,deceleration:g}=a,v=r.aD(c*p/(t/1e3),-u,u),w=Math.abs(v)/(g*p);return{easing:a.easing,duration:1e3*w,amount:v*(w/2)}}class Xa extends r.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,u,p={}){const g=vt(a.getCanvasContainer(),u),v=a.unproject(g);super(t,r.l({point:g,lngLat:v,originalEvent:u},p)),this._defaultPrevented=!1,this.target=a}}class Hs extends r.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,u){const p=t==="touchend"?u.changedTouches:u.touches,g=ni(a.getCanvasContainer(),p),v=g.map(A=>a.unproject(A)),w=g.reduce((A,I,z,k)=>A.add(I.div(k.length)),new r.P(0,0));super(t,{points:g,point:w,lngLats:v,lngLat:a.unproject(w),originalEvent:u}),this._defaultPrevented=!1}}class _c extends r.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class Pl{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new _c(this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Xa(t.type,this._map,t))}mouseup(t){this._map.fire(new Xa(t.type,this._map,t))}preclick(t){const a=r.l({},t);a.type="preclick",this._map.fire(new Xa(a.type,this._map,a))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Xa(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Xa(t.type,this._map,t))}mouseover(t){this._map.fire(new Xa(t.type,this._map,t))}mouseout(t){this._map.fire(new Xa(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Hs(t.type,this._map,t))}touchmove(t){this._map.fire(new Hs(t.type,this._map,t))}touchend(t){this._map.fire(new Hs(t.type,this._map,t))}touchcancel(t){this._map.fire(new Hs(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ko{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Xa(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Xa(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yo{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(at(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const u=a,p=this._startPos,g=this._lastPos;if(!p||!g||g.equals(u)||!this._box&&u.dist(p)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=be("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const v=Math.min(p.x,u.x),w=Math.max(p.x,u.x),A=Math.min(p.y,u.y),I=Math.max(p.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${A}px)`,this._box.style.width=w-v+"px",this._box.style.height=I-A+"px")})}mouseupWindow(t,a){if(!this._active)return;const u=this._startPos,p=a;if(u&&t.button===0){if(this.reset(),Tt(),u.x!==p.x||u.y!==p.y)return this._map.fire(new r.A("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(u,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ut(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new r.A(t,{originalEvent:a}))}}function ms(c,t){const a={};for(let u=0;u<c.length;u++)a[c[u].identifier]=t[u];return a}class Ef{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,a,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(p){const g=new r.P(0,0);for(const v of p)g._add(v);return g.div(p.length)}(a),this.touches=ms(u,a)))}touchmove(t,a,u){if(this.aborted||!this.centroid)return;const p=ms(u,a);for(const g in this.touches){const v=p[g];(!v||v.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(t,a,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Pr{constructor(t){this.singleTap=new Ef(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,a,u){this.singleTap.touchstart(t,a,u)}touchmove(t,a,u){this.singleTap.touchmove(t,a,u)}touchend(t,a,u){const p=this.singleTap.touchend(t,a,u);if(p){const g=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(p)<30;if(g&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class qs{constructor(){this._zoomIn=new Pr({numTouches:1,numTaps:2}),this._zoomOut=new Pr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,u){this._zoomIn.touchstart(t,a,u),this._zoomOut.touchstart(t,a,u)}touchmove(t,a,u){this._zoomIn.touchmove(t,a,u),this._zoomOut.touchmove(t,a,u)}touchend(t,a,u){const p=this._zoomIn.touchend(t,a,u),g=this._zoomOut.touchend(t,a,u);return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()+1,around:v.unproject(p)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()-1,around:v.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const fa={0:1,2:2},$s={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class _u{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,a){return!1}_move(t,a){return{}}mousedown(t,a){if(this._lastPoint)return;const u=Pi(t);this._correctButton(t,u)&&(this._lastPoint=a,this._eventButton=u)}mousemoveWindow(t,a){const u=this._lastPoint;if(u){if(t.preventDefault(),this._eventButton!=null&&function(p,g){const v=fa[g];return p.buttons===void 0||(p.buttons&v)!==v}(t,this._eventButton))this.reset();else if(this._moved||!(a.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(u,a)}}mouseupWindow(t){this._lastPoint&&Pi(t)===this._eventButton&&(this._moved&&Tt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wd extends _u{mousedown(t,a){super.mousedown(t,a),this._lastPoint&&(this._active=!0)}_correctButton(t,a){return a===0&&!t.ctrlKey}_move(t,a){return{around:a,panDelta:a.sub(t)}}}class Td extends _u{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?$s[t.pitchRotateKey]:void 0}_correctButton(t,a){return this._pitchRotateKey?a===0&&t[this._pitchRotateKey]:a===0&&t.ctrlKey||a===2}_move(t,a){const u=.8*(a.x-t.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class yc extends _u{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?$s[t.pitchRotateKey]:void 0}_correctButton(t,a){return this._pitchRotateKey?a===0&&t[this._pitchRotateKey]:a===0&&t.ctrlKey||a===2}_move(t,a){const u=-.5*(a.y-t.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Ll{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),r.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(t,a,u){return this._calculateTransform(t,a,u)}touchmove(t,a,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!r.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,a,u)}}touchend(t,a,u){this._calculateTransform(t,a,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,u){u.length>0&&(this._active=!0);const p=ms(u,a),g=new r.P(0,0),v=new r.P(0,0);let w=0;for(const I in p){const z=p[I],k=this._touches[I];k&&(g._add(z),v._add(z.sub(k)),w++,p[I]=z)}if(this._touches=p,w<this._minTouches||!v.mag())return;const A=v.div(w);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(w),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=be("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class vc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,a,u){return{}}touchstart(t,a,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,u){const p=this._firstTwoTouches;if(!p)return;t.preventDefault();const[g,v]=p,w=yu(u,a,g),A=yu(u,a,v);if(!w||!A)return;const I=this._aroundCenter?null:w.add(A).div(2);return this._move([w,A],I,t)}touchend(t,a,u){if(!this._firstTwoTouches)return;const[p,g]=this._firstTwoTouches,v=yu(u,a,p),w=yu(u,a,g);v&&w||(this._active&&Tt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function yu(c,t,a){for(let u=0;u<c.length;u++)if(c[u].identifier===a)return t[u]}function ph(c,t){return Math.log(c/t)/Math.LN2}class Af extends vc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(ph(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ph(this._distance,u),pinchAround:a}}}function vu(c,t){return 180*c.angleWith(t)/Math.PI}class Lp extends vc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){const u=this._vector;if(this._vector=t[0].sub(t[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:vu(this._vector,u),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const p=vu(t,u);return Math.abs(p)<a}}function mh(c){return Math.abs(c.y)>Math.abs(c.x)}class Op extends vc{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,mh(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,u){const p=this._lastPoints;if(!p)return;const g=t[0].sub(p[0]),v=t[1].sub(p[1]);return this._map._cooperativeGestures&&!r.ex()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(g,v,u.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(g.y+v.y)/2*-.5})}gestureBeginsVertically(t,a,u){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,g=a.mag()>=2;if(!p&&!g)return;if(!p||!g)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const v=t.y>0==a.y>0;return mh(t)&&mh(a)&&v}}const kp={panStep:100,bearingStep:15,pitchStep:10};class jm{constructor(){const t=kp;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,u=0,p=0,g=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:w=>{const A=w.getZoom();w.easeTo({duration:300,easeId:"keyboardHandler",easing:Np,zoom:a?Math.round(A)+a*(t.shiftKey?2:1):A,bearing:w.getBearing()+u*this._bearingStep,pitch:w.getPitch()+p*this._pitchStep,offset:[-g*this._panStep,-v*this._panStep],center:w.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Np(c){return c*(2-c)}const ga=4.000244140625,Ma=1/450;class Bp{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ma,r.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||r.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=r.q.now(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,a!==0&&a%ga==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=vt(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>ga?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&z!==0&&(z=1/z);const k=a(),O=Math.pow(2,k),j=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(j*z))),this._type==="wheel"&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:a(),p=this._startZoom,g=this._easing;let v,w=!1;if(this._type==="wheel"&&p&&g){const I=Math.min((r.q.now()-this._lastWheelEventTime)/200,1),z=g(I);v=r.ai(p,u,z),I<1?this._frameId||(this._frameId=!0):w=!0}else v=u,w=!0;this._active=!0,w&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let A=v-a();return A*this._lastDelta<0&&(A=0),{noInertia:!0,needsRenderFrame:!w,zoomDelta:A,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=r.ey;if(this._prevEase){const u=this._prevEase,p=(r.q.now()-u.start)/u.duration,g=u.easing(p+.01)-u.easing(p),v=.27/Math.sqrt(g*g+1e-4)*.01,w=Math.sqrt(.0729-v*v);a=r.ew(v,w,.25,1)}return this._prevEase={start:r.q.now(),duration:t,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=be("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Fp{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class jp{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,a){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(t.shiftKey?-1:1),around:u.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Up{constructor(){this._tap=new Pr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,a,u){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=a[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(t,a,u))}touchmove(t,a,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=a[0],g=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,a,u)}touchend(t,a,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(t,a,u)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vp{constructor(t,a,u){this._el=t,this._mousePan=a,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Mf{constructor(t,a,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Gp{constructor(t,a,u,p){this._el=t,this._touchZoom=a,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const vr=c=>c.zoom||c.drag||c.pitch||c.rotate;class Hp extends r.A{}class Um{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,a){const u=r.at([],a,t);this.radius=r.ae(u[2]<0?r.eA([],u,this.constants):[u[0],u[1],0])}projectRay(t){r.eA(t,t,this.constants),r.au(t,t),r.eB(t,t,this.constants);const a=r.b$([],t,this.radius);if(a[2]>0){const u=r.b$([],[0,0,1],r.bE(a,[0,0,1])),p=r.b$([],r.au([],[a[0],a[1],0]),this.radius),g=r.cU([],a,r.b$([],r.at([],r.cU([],p,u),a),2));a[0]=g[0],a[1]=g[1]}return a}}function xc(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class qp{constructor(t,a){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new gu(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Um,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),r.aV(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,g,v]of this._listeners){const w=p===document?this.handleWindowEvent:this.handleEvent;p.addEventListener(g,w,v)}}destroy(){for(const[t,a,u]of this._listeners){const p=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(a,p,u)}}_addDefaultHandlers(t){const a=this._map,u=a.getCanvasContainer();this._add("mapEvent",new Pl(a,t));const p=a.boxZoom=new Yo(a,t);this._add("boxZoom",p);const g=new qs,v=new jp;a.doubleClickZoom=new Fp(v,g),this._add("tapZoom",g),this._add("clickZoom",v);const w=new Up;this._add("tapDragZoom",w);const A=a.touchPitch=new Op(a);this._add("touchPitch",A);const I=new Td(t),z=new yc(t);a.dragRotate=new Mf(t,I,z),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const k=new wd(t),O=new Ll(a,t);a.dragPan=new Vp(u,k,O),this._add("mousePan",k),this._add("touchPan",O,["touchZoom","touchRotate"]);const j=new Lp,Q=new Af;a.touchZoomRotate=new Gp(u,Q,j,w),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ko(a));const Y=a.scrollZoom=new Bp(a,this);this._add("scrollZoom",Y,["mousePan"]);const ee=a.keyboard=new jm;this._add("keyboard",ee);for(const K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[K]&&a[K].enable(t[K])}_add(t,a,u){this._handlers.push({handlerName:t,handler:a,allowed:u}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!vr(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,a,u){for(const p in t)if(p!==u&&(!a||a.indexOf(p)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const a=[];for(const u of t)this._el.contains(u.target)&&a.push(u);return a}handleEvent(t,a){this._updatingCamera=!0;const u=t.type==="renderFrame",p=u?void 0:t,g={needsRenderFrame:!1},v={},w={},A=t.touches?this._getMapTouches(t.touches):void 0,I=A?ni(this._el,A):u?void 0:vt(this._el,t);for(const{handlerName:O,handler:j,allowed:Q}of this._handlers){if(!j.isEnabled())continue;let Y;this._blockedByActive(w,Q,O)?j.reset():j[a||t.type]&&(Y=j[a||t.type](t,I,A),this.mergeHandlerResult(g,v,Y,O,p),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||j.isActive())&&(w[O]=j)}const z={};for(const O in this._previousActiveHandlers)w[O]||(z[O]=p);this._previousActiveHandlers=w,(Object.keys(z).length||xc(g))&&(this._changes.push([g,v,z]),this._triggerRenderFrame()),(Object.keys(w).length||xc(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:k}=g;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))}mergeHandlerResult(t,a,u,p,g){if(!u)return;r.l(t,u);const v={handlerName:p,originalEvent:u.originalEvent||g};u.zoomDelta!==void 0&&(a.zoom=v),u.panDelta!==void 0&&(a.drag=v),u.pitchDelta!==void 0&&(a.pitch=v),u.bearingDelta!==void 0&&(a.rotate=v)}_applyChanges(){const t={},a={},u={};for(const[p,g,v]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new r.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.aroundCoord!==void 0&&(t.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),r.l(a,g),r.l(u,v);this._updateMapTransform(t,a,u),this._changes=[]}_updateMapTransform(t,a,u){const p=this._map,g=p.transform,v=se=>[se.x,se.y,se.z];if((se=>{const pe=this._eventsInProgress.drag;return pe&&!this._handlersById[pe.handlerName].isActive()})()&&!xc(t)){const se=g.zoom;g.cameraElevationReference="sea",this._originalZoom!=null&&g._orthographicProjectionAtLowPitch&&g.projection.name!=="globe"&&g.pitch===0?(g.cameraElevationReference="ground",g.zoom=this._originalZoom):(g.recenterOnTerrain(),g.cameraElevationReference="ground"),se!==g.zoom&&this._map._update(!0)}if(g._isCameraConstrained&&p._stop(!0),!xc(t))return void this._fireEvents(a,u,!0);let{panDelta:w,zoomDelta:A,bearingDelta:I,pitchDelta:z,around:k,aroundCoord:O,pinchAround:j}=t;g._isCameraConstrained&&(A>0&&(A=0),g._isCameraConstrained=!1),j!==void 0&&(k=j),(A||(se=>a[se]&&!this._eventsInProgress[se])("drag"))&&k&&(this._dragOrigin=v(g.pointCoordinate3D(k)),this._originalZoom=g.zoom,this._trackingEllipsoid.setup(g._camera.position,this._dragOrigin)),g.cameraElevationReference="sea",p._stop(!0),k=k||p.transform.centerPoint,I&&(g.bearing+=I),z&&(g.pitch+=z),g._updateCameraState();const Q=[0,0,0];if(w)if(g.projection.name==="mercator"){const se=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(k).dir),pe=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(k.sub(w)).dir);Q[0]=pe[0]-se[0],Q[1]=pe[1]-se[1]}else{const se=g.pointCoordinate(k);if(g.projection.name==="globe"){w=w.rotate(-g.angle);const pe=g._pixelsPerMercatorPixel/g.worldSize;Q[0]=-w.x*r.ez(r.aY(se.y))*pe,Q[1]=-w.y*r.ez(g.center.lat)*pe}else{const pe=g.pointCoordinate(k.sub(w));se&&pe&&(Q[0]=pe.x-se.x,Q[1]=pe.y-se.y)}}const Y=g.zoom,ee=[0,0,0];if(A){const se=v(O||g.pointCoordinate3D(k)),pe={dir:r.au([],r.at([],se,g._camera.position))};if(pe.dir[2]<0){const ve=g.zoomDeltaToMovement(se,A);r.b$(ee,pe.dir,ve)}}const K=r.cU(Q,Q,ee);g._translateCameraConstrained(K),A&&Math.abs(g.zoom-Y)>1e-4&&g.recenterOnTerrain(),g.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,u,!0)}_fireEvents(t,a,u){const p=vr(this._eventsInProgress),g=vr(t),v={};for(const z in t){const{originalEvent:k}=t[z];this._eventsInProgress[z]||(v[`${z}start`]=k),this._eventsInProgress[z]=t[z]}!p&&g&&this._fireEvent("movestart",g.originalEvent);for(const z in v)this._fireEvent(z,v[z]);g&&this._fireEvent("move",g.originalEvent);for(const z in t){const{originalEvent:k}=t[z];this._fireEvent(z,k)}const w={};let A;for(const z in this._eventsInProgress){const{handlerName:k,originalEvent:O}=this._eventsInProgress[z];this._handlersById[k].isActive()||(delete this._eventsInProgress[z],A=a[k]||O,w[`${z}end`]=A)}for(const z in w)this._fireEvent(z,w[z]);const I=vr(this._eventsInProgress);if(u&&(p||g)&&!I){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;z?(k(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:A})):(this._map.fire(new r.A("moveend",{originalEvent:A})),k(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new r.A(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Hp("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const bc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class $p extends r.E{constructor(t,a){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,r.aV(["_renderFrameCallback"],this)}getCenter(){return new r.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,u){return t=r.P.convert(t).mult(-1),this.panTo(this.transform.center,r.l({offset:t},a),u)}panTo(t,a,u){return this.easeTo(r.l({center:t},a),u)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,u){return this.easeTo(r.l({zoom:t},a),u)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,u){return this.easeTo(r.l({bearing:t},a),u)}resetNorth(t,a){return this.rotateTo(0,r.l({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(r.l({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=r.aG.convert(t);const u=a&&a.bearing||0,p=a&&a.pitch||0,g=t.getNorthWest(),v=t.getSouthEast();return this._cameraForBounds(this.transform,g,v,u,p,a)}_extendPadding(t){const a={top:0,right:0,bottom:0,left:0};return t==null?r.l({},a,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:r.l({},a,t)}_extendCameraOptions(t){return(t=r.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,a){const u=a.max[0]-a.min[0],p=a.max[1]-a.min[1];return u/p>t.aspect?u/(2*Math.tan(.5*t.fovX)*t.aspect):p/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,a,u,p,g,v){const w=t.clone(),A=this._extendCameraOptions(v);w.bearing=p,w.pitch=g;const I=r.cd.convert(a),z=r.cd.convert(u),k=.5*(I.lat+z.lat),O=.5*(I.lng+z.lng),j=r.eC(k,O),Q=r.au([],j),Y=r.au([],r.bG([],Q,[0,1,0])),ee=r.bG([],Y,Q),K=[Y[0],Y[1],Y[2],0,ee[0],ee[1],ee[2],0,Q[0],Q[1],Q[2],0,0,0,0,1],se=[j,r.eC(I.lat,I.lng),r.eC(z.lat,I.lng),r.eC(z.lat,z.lng),r.eC(I.lat,z.lng),r.eC(k,I.lng),r.eC(k,z.lng),r.eC(I.lat,O),r.eC(z.lat,O)];let pe=r.cV.fromPoints(se.map(tt=>[r.bE(Y,tt),r.bE(ee,tt),r.bE(Q,tt)]));const ve=r.ad([],pe.center,K);r.eD(ve)===0&&r.eE(ve,0,0,1),r.au(ve,ve),r.b$(ve,ve,r.aE),w.center=r.eF(ve);const Ae=w.getWorldToCameraMatrix(),Se=r.bi(new Float64Array(16),Ae);pe=r.cV.applyTransform(pe,r.az([],Ae,K));const Te=this._extendAABB(pe,w,A,p);if(!Te)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pe=Te,r.ad(ve,ve,Ae);const ge=.5*(pe.max[2]-pe.min[2]),Ce=this._minimumAABBFrustumDistance(w,pe),Le=r.b$([],[0,0,1],ge),Qe=r.cU(Le,ve,Le),Ze=Ce+(w.pitch===0?0:r.bD(ve,Qe)),ht=w.globeCenterInViewSpace,lt=r.at([],ve,[ht[0],ht[1],ht[2]]);r.au(lt,lt),r.b$(lt,lt,Ze);const Ct=r.cU([],ve,lt);r.ad(Ct,Ct,Se);const $e=r.eq/r.aE,et=r.ae(Ct),Ge=r.c6(Math.max(et*$e-r.eq,Number.EPSILON),0),pt=Math.min(w.zoomFromMercatorZAdjusted(Ge),A.maxZoom);return pt>.5*(r.cL+r.cx)?(w.setProjection({name:"mercator"}),w.zoom=pt,this._cameraForBounds(w,a,u,p,g,v)):{center:w.center,zoom:pt,bearing:p,pitch:g}}_extendAABB(t,a,u,p){const g=.5*((u.padding.left||0)+(u.padding.right||0)),v=.5*((u.padding.top||0)+(u.padding.bottom||0)),w=v,A=g,I=g,z=v,k=a.width-(A+I),O=a.height-(w+z),j=r.at([],t.max,t.min),Q=Math.min(k/j[0],O/j[1]),Y=Math.min(a.scaleZoom(a.scale*Q),u.maxZoom);if(isNaN(Y))return null;const ee=a.scale/a.zoomScale(Y),K=new r.cV([t.min[0]-A*ee,t.min[1]-z*ee,t.min[2]],[t.max[0]+I*ee,t.max[1]+w*ee,t.max[2]]),se=(typeof u.offset.x=="number"&&typeof u.offset.y=="number"?new r.P(u.offset.x,u.offset.y):r.P.convert(u.offset)).rotate(-r.al(p));return K.center[0]-=se.x*ee,K.center[1]+=se.y*ee,K}queryTerrainElevation(t,a){const u=this.transform.elevation;return u?(a=r.l({},{exaggerated:!0},a),u.getAtPoint(r.ac.fromLngLat(t),null,a.exaggerated)):null}_cameraForBounds(t,a,u,p,g,v){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,a,u,p,g,v);const w=t.clone(),A=this._extendCameraOptions(v);w.bearing=p,w.pitch=g;const I=r.cd.convert(a),z=r.cd.convert(u),k=new r.cd(I.lng,z.lat),O=new r.cd(z.lng,I.lat),j=w.project(I),Q=w.project(z),Y=this.queryTerrainElevation(I),ee=this.queryTerrainElevation(z),K=this.queryTerrainElevation(k),se=this.queryTerrainElevation(O),pe=[[j.x,j.y,Math.min(Y||0,ee||0,K||0,se||0)],[Q.x,Q.y,Math.max(Y||0,ee||0,K||0,se||0)]];let ve=r.cV.fromPoints(pe);const Ae=w.getWorldToCameraMatrix(),Se=r.bi(new Float64Array(16),Ae);ve=r.cV.applyTransform(ve,Ae);const Te=this._extendAABB(ve,w,A,p);if(!Te)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ve=Te;const ge=.5*r.at([],ve.max,ve.min)[2],Ce=this._minimumAABBFrustumDistance(w,ve),Le=[0,0,1,0];r.aA(Le,Le,Ae),r.eG(Le,Le);const Qe=r.b$([],Le,Ce+ge),Ze=r.cU([],ve.center,Qe);r.ad(ve.center,ve.center,Se),r.ad(Ze,Ze,Se);const ht=w.unproject(new r.P(ve.center[0],ve.center[1])),lt=r.eH(w.projection,ht),Ct=Math.pow(2,lt),$e=Math.min(w._zoomFromMercatorZ(Ze[2]*w.pixelsPerMeter*Ct/w.worldSize),A.maxZoom);return w.mercatorFromTransition&&$e<.5*(r.cL+r.cx)?(w.setProjection({name:"globe"}),w.zoom=$e,this._cameraForBounds(w,a,u,p,g,v)):{center:ht,zoom:$e,bearing:p,pitch:g}}fitBounds(t,a,u){const p=this.cameraForBounds(t,a);return this._fitInternal(p,a,u)}fitScreenCoordinates(t,a,u,p,g){const v=r.P.convert(t),w=r.P.convert(a),A=new r.P(Math.min(v.x,w.x),Math.min(v.y,w.y)),I=new r.P(Math.max(v.x,w.x),Math.max(v.y,w.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(v,w))return this;const z=this.transform.pointLocation3D(A),k=this.transform.pointLocation3D(I),O=this.transform.pointLocation3D(new r.P(A.x,I.y)),j=this.transform.pointLocation3D(new r.P(I.x,A.y)),Q=[Math.min(z.lng,k.lng,O.lng,j.lng),Math.min(z.lat,k.lat,O.lat,j.lat)],Y=[Math.max(z.lng,k.lng,O.lng,j.lng),Math.max(z.lat,k.lat,O.lat,j.lat)],ee=p&&p.pitch?p.pitch:this.getPitch(),K=this._cameraForBounds(this.transform,Q,Y,u,ee,p);return this._fitInternal(K,p,g)}_fitInternal(t,a,u){return t?(a=r.l(t,a)).linear?this.easeTo(a,u):this.flyTo(a,u):this}jumpTo(t,a){this.stop();const u=t.preloadOnly?this.transform.clone():this.transform;let p=!1,g=!1,v=!1;"zoom"in t&&u.zoom!==+t.zoom&&(p=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=r.cd.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(g=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(v=!0,u.pitch=+t.pitch);const w=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!u.isPaddingEqual(w))if(t.retainPadding===!1){const A=u.clone();A.padding=w,u.setLocationAtPoint(u.center,A.centerPoint)}else u.padding=w;return t.preloadOnly?(this._preloadTiles(u),this):(this.fire(new r.A("movestart",a)).fire(new r.A("move",a)),p&&this.fire(new r.A("zoomstart",a)).fire(new r.A("zoom",a)).fire(new r.A("zoomend",a)),g&&this.fire(new r.A("rotatestart",a)).fire(new r.A("rotate",a)).fire(new r.A("rotateend",a)),v&&this.fire(new r.A("pitchstart",a)).fire(new r.A("pitch",a)).fire(new r.A("pitchend",a)),this.fire(new r.A("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(bc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,a){const u=this.transform;if(!u.projection.supportsFreeCamera)return r.w(bc),this;this.stop();const p=u.zoom,g=u.pitch,v=u.bearing;u.setFreeCameraOptions(t);const w=p!==u.zoom,A=g!==u.pitch,I=v!==u.bearing;return this.fire(new r.A("movestart",a)).fire(new r.A("move",a)),w&&this.fire(new r.A("zoomstart",a)).fire(new r.A("zoom",a)).fire(new r.A("zoomend",a)),I&&this.fire(new r.A("rotatestart",a)).fire(new r.A("rotate",a)).fire(new r.A("rotateend",a)),A&&this.fire(new r.A("pitchstart",a)).fire(new r.A("pitch",a)).fire(new r.A("pitchend",a)),this.fire(new r.A("moveend",a)),this}easeTo(t,a){this._stop(!1,t.easeId),((t=r.l({offset:[0,0],duration:500,easing:r.ey},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const u=this.transform,p=this.getZoom(),g=this.getBearing(),v=this.getPitch(),w=this.getPadding(),A="zoom"in t?+t.zoom:p,I="bearing"in t?this._normalizeBearing(t.bearing,g):g,z="pitch"in t?+t.pitch:v,k=this._extendPadding(t.padding),O=r.P.convert(t.offset);let j,Q,Y;if(u.projection.name==="globe"){const Le=r.ac.fromLngLat(u.center),Qe=O.rotate(-u.angle);Le.x+=Qe.x/u.worldSize,Le.y+=Qe.y/u.worldSize;const Ze=Le.toLngLat(),ht=r.cd.convert(t.center||Ze);this._normalizeCenter(ht),j=u.centerPoint.add(Qe),Q=new r.P(Le.x,Le.y).mult(u.worldSize),Y=new r.P(r.ay(ht.lng),r.aH(ht.lat)).mult(u.worldSize).sub(Q)}else{j=u.centerPoint.add(O);const Le=u.pointLocation(j),Qe=r.cd.convert(t.center||Le);this._normalizeCenter(Qe),Q=u.project(Le),Y=u.project(Qe).sub(Q)}const ee=u.zoomScale(A-p);let K,se;t.around&&(K=r.cd.convert(t.around),se=u.locationPoint(K));const pe=this._zooming||A!==p,ve=this._rotating||g!==I,Ae=this._pitching||z!==v,Se=!u.isPaddingEqual(k),Te=t.retainPadding===!1?u.clone():u,ge=Le=>Qe=>{if(pe&&(Le.zoom=r.ai(p,A,Qe)),ve&&(Le.bearing=r.ai(g,I,Qe)),Ae&&(Le.pitch=r.ai(v,z,Qe)),Se&&(Te.interpolatePadding(w,k,Qe),j=Te.centerPoint.add(O)),K)Le.setLocationAtPoint(K,se);else{const Ze=Le.zoomScale(Le.zoom-p),ht=A>p?Math.min(2,ee):Math.max(.5,ee),lt=Math.pow(ht,1-Qe),Ct=Le.unproject(Q.add(Y.mult(Qe*lt)).mult(Ze));Le.setLocationAtPoint(Le.renderWorldCopies?Ct.wrap():Ct,j)}return t.preloadOnly||this._fireMoveEvents(a),Le};if(t.preloadOnly){const Le=this._emulate(ge,t.duration,u);return this._preloadTiles(Le),this}const Ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pe,this._rotating=ve,this._pitching=Ae,this._padding=Se,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,Ce),this._ease(ge(u),Le=>{u.cameraElevationReference==="sea"&&u.recenterOnTerrain(),this._afterEase(a,Le)},t),this}_prepareEase(t,a,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||u.moving||this.fire(new r.A("movestart",t)),this._zooming&&!u.zooming&&this.fire(new r.A("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new r.A("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new r.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new r.A("move",t)),this._zooming&&this.fire(new r.A("zoom",t)),this._rotating&&this.fire(new r.A("rotate",t)),this._pitching&&this.fire(new r.A("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,p=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new r.A("zoomend",t)),p&&this.fire(new r.A("rotateend",t)),g&&this.fire(new r.A("pitchend",t)),this.fire(new r.A("moveend",t))}flyTo(t,a){if(this._prefersReducedMotion(t)){const tt=r.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(tt,a)}this.stop(),t=r.l({offset:[0,0],speed:1.2,curve:1.42,easing:r.ey},t);const u=this.transform,p=this.getZoom(),g=this.getBearing(),v=this.getPitch(),w=this.getPadding(),A="zoom"in t?r.aD(+t.zoom,u.minZoom,u.maxZoom):p,I="bearing"in t?this._normalizeBearing(t.bearing,g):g,z="pitch"in t?+t.pitch:v,k=this._extendPadding(t.padding),O=u.zoomScale(A-p),j=r.P.convert(t.offset);let Q=u.centerPoint.add(j);const Y=u.pointLocation(Q),ee=r.cd.convert(t.center||Y);this._normalizeCenter(ee);const K=u.project(Y),se=u.project(ee).sub(K);let pe=t.curve;const ve=Math.max(u.width,u.height),Ae=ve/O,Se=se.mag();if("minZoom"in t){const tt=r.aD(Math.min(t.minZoom,p,A),u.minZoom,u.maxZoom),bt=ve/u.zoomScale(tt-p);pe=Math.sqrt(bt/Se*2)}const Te=pe*pe;function ge(tt){const bt=(Ae*Ae-ve*ve+(tt?-1:1)*Te*Te*Se*Se)/(2*(tt?Ae:ve)*Te*Se);return Math.log(Math.sqrt(bt*bt+1)-bt)}function Ce(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function Le(tt){return(Math.exp(tt)+Math.exp(-tt))/2}const Qe=ge(0);let Ze=function(tt){return Le(Qe)/Le(Qe+pe*tt)},ht=function(tt){return ve*((Le(Qe)*(Ce(bt=Qe+pe*tt)/Le(bt))-Ce(Qe))/Te)/Se;var bt},lt=(ge(1)-Qe)/pe;if(Math.abs(Se)<1e-6||!isFinite(lt)){if(Math.abs(ve-Ae)<1e-6)return this.easeTo(t,a);const tt=Ae<ve?-1:1;lt=Math.abs(Math.log(Ae/ve))/pe,ht=function(){return 0},Ze=function(bt){return Math.exp(tt*pe*bt)}}t.duration="duration"in t?+t.duration:1e3*lt/("screenSpeed"in t?+t.screenSpeed/pe:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Ct=g!==I,$e=z!==v,et=!u.isPaddingEqual(k),Ge=t.retainPadding===!1?u.clone():u,pt=tt=>bt=>{const dt=bt*lt,wt=1/Ze(dt);tt.zoom=bt===1?A:p+tt.scaleZoom(wt),Ct&&(tt.bearing=r.ai(g,I,bt)),$e&&(tt.pitch=r.ai(v,z,bt)),et&&(Ge.interpolatePadding(w,k,bt),Q=Ge.centerPoint.add(j));const At=bt===1?ee:tt.unproject(K.add(se.mult(ht(dt))).mult(wt));return tt.setLocationAtPoint(tt.renderWorldCopies?At.wrap():At,Q),tt._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(a),tt};if(t.preloadOnly){const tt=this._emulate(pt,t.duration,u);return this._preloadTiles(tt),this}return this._zooming=!0,this._rotating=Ct,this._pitching=$e,this._padding=et,this._prepareEase(a,!1),this._ease(pt(u),()=>this._afterEase(a),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,a)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,a,u){u.animate===!1||u.duration===0?(t(1),a()):(this._easeStart=r.q.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((r.q.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,a){t=r.bX(t,-180,180);const u=Math.abs(t-a);return Math.abs(t-360-a)<u&&(t-=360),Math.abs(t+360-a)<u&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const u=t.lng-a.center.lng;t.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&r.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,a,u){const p=Math.ceil(15*a/1e3),g=[],v=t(u.clone());for(let w=0;w<=p;w++){const A=v(w/p);g.push(A.clone())}return g}_preloadTiles(t,a){}}class gh{constructor(t={}){this.options=t,r.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const a=this.options&&this.options.compact,u=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=be("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=be("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",u);const p=be("span","mapboxgl-ctrl-icon",this._compactButton);return p.setAttribute("aria-hidden","true"),p.setAttribute("title",u),this._innerContainer=be("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(t){const u=a.reduce((p,g,v)=>(g.value&&(p+=`${g.key}=${g.value}${v<a.length-1?"&":""}`),p),"?");t.href=`${r.e.FEEDBACK_URL}/${u}#${pu(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const a=this._map.style._mergedSourceCaches;for(const p in a){const g=a[p];if(g.used){const v=g.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t.sort((p,g)=>p.length-g.length),t=t.filter((p,g)=>{for(let v=g+1;v<t.length;v++)if(t[v].indexOf(p)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class wc{constructor(){r.aV(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=be("div","mapboxgl-ctrl");const a=be("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const a in t){const u=t[a].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const a=t[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class gs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,u=a?this._queue.concat(a):this._queue;for(const p of u)if(p.id===t)return void(p.cancelled=!0)}run(t=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const u of a)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Sd{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const a=r.dk((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,a,u){this._start=this.getValue(a),this._end=t,this._startTime=a,this._endTime=a+u}}const Lr={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class _s extends r.A{constructor(t,a,u,p){const{point:g,lngLat:v,originalEvent:w,target:A}=t;super(t.type,{point:g,lngLat:v,originalEvent:w,target:A}),this.preventDefault=()=>{t.preventDefault()},this.id=a,this.interaction=u,this.feature=p}}class Ko{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,a){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const u=a.filter;let p=a.type;u&&this.filters.set(t,r.b3(u)),p==="mouseover"&&(p="mouseenter"),p==="mouseout"&&(p="mouseleave");const g=this.interactionsByType.get(p)||new Map;p==="mouseenter"||p==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,a)):g.size===0&&this.map.on(p,this.handleType),g.size===0&&this.interactionsByType.set(p,g),g.set(t,a),this.typeById.set(t,p)}get(t){const a=this.typeById.get(t);if(!a)return;const u=this.interactionsByType.get(a);return u?u.get(t):void 0}remove(t){const a=this.typeById.get(t);if(!a)return;this.typeById.delete(t),this.filters.delete(t);const u=this.interactionsByType.get(a);u&&(u.delete(t),a==="mouseenter"||a==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):u.size===0&&this.map.off(a,this.handleType))}queryTargets(t,a){const u=[];for(const[p,g]of a)g.target&&u.push({targetId:p,target:g.target,filter:this.filters.get(p)});return this.map.style.queryRenderedTargets(t,u,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const a=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());a.length&&(t.type="mouseenter",this.handleType(t,a));const u=new Map;for(const[p,{feature:g}]of this.prevHoveredFeatures)this.hoveredFeatures.has(p)||u.set(g.id,g);u.size&&(t.type="mouseleave",this.handleType(t,Array.from(u.values())))}handleOut(t){const a=Array.from(this.hoveredFeatures.values()).map(({feature:u})=>u);a.length&&(t.type="mouseleave",this.handleType(t,a)),this.hoveredFeatures.clear()}handleType(t,a){const u=Array.from(this.interactionsByType.get(t.type)).reverse(),p=!!a;a=a||this.queryTargets(t.point,u);const g=t.type==="mouseenter";let v=!1;const w=new Set;for(const A of a){for(const[I,z]of u){if(!z.target)continue;const k=A.variants?A.variants[I]:null;if(k){for(const O of k){if(ju(O,A,w,I))continue;const j=new r.df(A,O),Q=Lc(O,A,I);p&&(j.state=this.map.getFeatureState(j));const Y=g?this.prevHoveredFeatures.get(Q):null,ee=new _s(t,I,z,j),K=Y?Y.stop:z.handler(ee);if(g&&this.hoveredFeatures.set(Q,{feature:A,stop:K}),K!==!1){v=!0;break}}if(v)break}}if(v)break}if(!v)for(const[A,I]of u){const{handler:z,target:k}=I;if(!k&&z(new _s(t,A,I,null))!==!1)break}}}function _h(c,t){if(Array.isArray(c)&&Array.isArray(t)){const a=new Set(c),u=new Set(t);return a.size===u.size&&c.every(p=>u.has(p))}return r.bv(c,t)}const Vm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Gm={showCompass:!0,showZoom:!0,visualizePitch:!1};class Qo{constructor(t,a,u=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Td({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,u&&(this.mousePitch=new yc({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),r.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(t,a){this.mouseRotate.mousedown(t,a),this.mousePitch&&this.mousePitch.mousedown(t,a),at()}move(t,a){const u=this.map,p=this.mouseRotate.mousemoveWindow(t,a),g=p&&p.bearingDelta;if(g&&u.setBearing(u.getBearing()+g),this.mousePitch){const v=this.mousePitch.mousemoveWindow(t,a),w=v&&v.pitchDelta;w&&u.setPitch(u.getPitch()+w)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ut(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(r.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),vt(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,vt(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ni(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=ni(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Zp(c,t,a){if(c=new r.cd(c.lng,c.lat),t){const u=new r.cd(c.lng-360,c.lat),p=new r.cd(c.lng+360,c.lat),g=360*Math.ceil(Math.abs(c.lng-a.center.lng)/360),v=a.locationPoint3D(c).distSqr(t),w=t.x<0||t.y<0||t.x>a.width||t.y>a.height;a.locationPoint3D(u).distSqr(t)<v&&(w||Math.abs(u.lng-a.center.lng)<g)?c=u:a.locationPoint3D(p).distSqr(t)<v&&(w||Math.abs(p.lng-a.center.lng)<g)&&(c=p)}for(;Math.abs(c.lng-a.center.lng)>180;){const u=a.locationPoint3D(c);if(u.x>=0&&u.y>=0&&u.x<=a.width&&u.y<=a.height)break;c.lng>a.center.lng?c.lng-=360:c.lng+=360}return c}const yh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Wa={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class jr extends r.E{constructor(t,a){super(),(t instanceof HTMLElement||a)&&(t=r.l({element:t},a)),r.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:u="center",color:p="#3FB1CE",scale:g=1,draggable:v=!1,clickTolerance:w=0,rotation:A=Wa.rotation,rotationAlignment:I=Wa.rotationAlignment,pitchAlignment:z=Wa.pitchAlignment,occludedOpacity:k=Wa.occludedOpacity,altitude:O=Wa.altitude}=t||{};this._anchor=u,this._color=p,this._scale=g,this._draggable=v,this._clickTolerance=w,this._rotation=A,this._rotationAlignment=I,this._pitchAlignment=z,this._occludedOpacity=k,this._altitude=O,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=r.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=r.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Y=>{Y.preventDefault()}),this._element.addEventListener("mousedown",Y=>{Y.preventDefault()});const j=this._element.classList;for(const Y in yh)j.remove(`mapboxgl-marker-anchor-${Y}`);j.add(`mapboxgl-marker-anchor-${this._anchor}`);const Q=t&&t.className?t.className.trim().split(/\s+/):[];j.add(...Q),this._popup=null}_createDefaultMarker(){const t=be("div"),a=ke("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const u=ke("radialGradient",{id:"shadowGradient"},ke("defs",{},a));ke("stop",{offset:"10%","stop-opacity":.4},u),ke("stop",{offset:"100%","stop-opacity":.05},u),ke("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},a)}return ke("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},a),ke("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},a),ke("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},a),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=r.cd.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Wa.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const a=t.code,u=t.charCode||t.keyCode;a!=="Space"&&a!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(t){const a=t.originalEvent.target,u=this._element;this._popup&&(a===u||u.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,a=this._pos;if(!t||!a)return!1;const u=t.unproject(a,this._altitude),p=t.getFreeCameraOptions();if(!p.position)return!1;const g=p.position.toLngLat();return g.distanceTo(u)<.9*g.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const a=this._pos;if(!a||a.x<0||a.x>t.transform.width||a.y<0||a.y>t.transform.height)return void this._clearFadeTimer();const u=t.unproject(a,this._altitude);let p;t._showingGlobe()&&r.eK(t.transform,this._lngLat)?p=0:(p=1-t._queryFogOpacity(u),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(p*=this._occludedOpacity)),this._element.style.opacity=`${p}`,this._element.style.pointerEvents=p>0?"auto":"none",this._popup&&this._popup._setOpacity(p),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${yh[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const t=this._pos,a=this._map,u=this.getPitchAlignment();if(!a||!t||u!=="map")return"";if(!a._showingGlobe()){const A=a.getPitch();return A?`rotateX(${A}deg)`:""}const p=r.cJ(r.eL(a.transform,this._lngLat)),g=t.sub(r.eM(a.transform)),v=Math.abs(g.x)+Math.abs(g.y);if(v===0)return"";const w=p/v;return`rotateX(${-g.y*w}deg) rotateY(${g.x*w}deg)`}_calculateZTransform(){const t=this._pos,a=this._map;if(!a||!t)return"";let u=0;const p=this.getRotationAlignment();if(p==="map")if(a._showingGlobe()){const g=a.project(new r.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),v=a.project(new r.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(g);u=r.cJ(Math.atan2(v.y,v.x))-90}else u=-a.getBearing();else if(p==="horizon"){const g=r.af(4,6,a.getZoom()),v=r.eM(a.transform);v.y+=g*a.transform.height;const w=t.sub(v),A=r.cJ(Math.atan2(w.y,w.x));u=(A>90?A-270:A+90)*(1-g)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=Zp(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=r.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const a=this._map;if(!a)return;const u=this._pointerdownPos,p=this._positionDelta;if(u&&p){if(!this._isDragging){const g=this._clickTolerance||a._clickTolerance;if(t.point.dist(u)<g)return;this._isDragging=!0}this._pos=t.point.sub(p),this._lngLat=a.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.A("dragstart"))),this.fire(new r.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.A("dragend")),this._state="inactive"}_addDragHandler(t){const a=this._map,u=this._pos;a&&u&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(u),this._pointerdownPos=t.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const a=this._map;return a&&(t?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Wa.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Wa.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Wa.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Wa.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ed={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},vh={maxWidth:100,unit:"metric"},hl={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},go={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Ca=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ol(c=new r.P(0,0),t="bottom"){if(typeof c=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(t){case"top":return new r.P(0,c);case"top-left":return new r.P(a,a);case"top-right":return new r.P(-a,a);case"bottom":return new r.P(0,-c);case"bottom-left":return new r.P(a,-a);case"bottom-right":return new r.P(-a,-a);case"left":return new r.P(c,0);case"right":return new r.P(-c,0)}return new r.P(0,0)}return c instanceof r.P||Array.isArray(c)?r.P.convert(c):r.P.convert(c[t]||[0,0])}return{version:Z,supported:Ie.supported,setRTLTextPlugin:r.eN,getRTLTextPluginStatus:r.eO,Map:class extends $p{constructor(c){ie.mark($.create);const t=c;if((c=r.l({},Vm,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&r.eI(window)&&(c.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new qc(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies,null,null),c),this._repaint=!!c.repaint,this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._collectResourceTiming=c.collectResourceTiming,this._language=this._parseLanguage(c.language),this._worldview=c.worldview,this._renderTaskQueue=new gs,this._domRenderTaskQueue=new gs,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.a$(),this._locale=r.l({},Lr,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._performanceMetricsCollection=c.performanceMetricsCollection,this._tessellationStep=c.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=c.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Sd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=c.scaleFactor,this._requestManager=new fi(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,this._contextCreateOptions=c.contextCreateOptions?Object.assign({},c.contextCreateOptions):{},typeof c.container=="string"){const a=document.getElementById(c.container);if(!a)throw new Error(`Container '${c.container.toString()}' not found.`);this._container=a}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),this._spriteFormat=c.spriteFormat,r.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new xd),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new qp(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,(c.style||!c.testMode)&&this.setStyle(c.style||r.e.DEFAULT_STYLE,{config:c.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this.indoor=new of(this),c.hash&&(this._hash=new fu(typeof c.hash=="string"&&c.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch});const a=c.bounds;a&&(this.resize(),this.fitBounds(a,r.l({},c.fitBoundsOptions,{duration:0})))}this.resize(),c.attributionControl&&this.addControl(new gh({customAttribution:c.customAttribution})),this._logoControl=new wc,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new r.A(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new r.A(`${a.dataType}dataloading`,a))}),this._interactions=new Ko(this)}_getMapId(){return this._mapId}addControl(c,t){if(t===void 0&&(t=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new r.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=c.onAdd(this);this._controls.push(c);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(a,u.firstChild):u.appendChild(a),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new r.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(c);return t>-1&&this._controls.splice(t,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new r.A("movestart",c)).fire(new r.A("move",c)),this.fire(new r.A("resize",c)),t&&this.fire(new r.A("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(r.aG.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new r.A("zoomstart")).fire(new r.A("zoom")).fire(new r.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new r.A("zoomstart")).fire(new r.A("zoom")).fire(new r.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new r.A("pitchstart")).fire(new r.A("pitch")).fire(new r.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new r.A("pitchstart")).fire(new r.A("pitch")).fire(new r.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(c){return this._scaleFactor=c,this.painter.scaleFactor=c,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(c){return c==="auto"?navigator.language:Array.isArray(c)?c.length===0?void 0:c.map(t=>t==="auto"?navigator.language:t):c}setLanguage(c){const t=this._parseLanguage(c);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){return this.style&&c!==this._worldview?(this._worldview=c,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,t=c.projection.name;let a;t==="globe"&&c.zoom>=r.cx?(c.setMercatorFromTransition(),a=!0):t==="mercator"&&c.zoom<r.cx&&(c.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,t){return this._updateProjection(c||t||{name:"mercator"})}_updateProjection(c){let t;return t=c.name==="globe"&&this.transform.zoom>=r.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(c,t){return this.transform.locationPoint3D(r.cd.convert(c),t)}unproject(c,t){return this.transform.pointLocation3D(r.P.convert(c),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(c,t,a){const u=p=>{let g=[];if(Array.isArray(t)){const v=t.filter(w=>this.getLayer(w));g=v.length?this.queryRenderedFeatures(p,{layers:v}):[]}else g=this.queryRenderedFeatures(p,{target:t});return g};if(c==="mouseenter"||c==="mouseover"){let p=!1;return{listener:a,targets:t,delegates:{mousemove:v=>{const w=u(v.point);w.length?p||(p=!0,a.call(this,new Xa(c,this,v.originalEvent,{features:w}))):p=!1},mouseout:()=>{p=!1}}}}if(c==="mouseleave"||c==="mouseout"){let p=!1;return{listener:a,targets:t,delegates:{mousemove:w=>{u(w.point).length?p=!0:p&&(p=!1,a.call(this,new Xa(c,this,w.originalEvent)))},mouseout:w=>{p&&(p=!1,a.call(this,new Xa(c,this,w.originalEvent)))}}}}{const p=g=>{const v=u(g.point);v.length&&(g.features=v,a.call(this,g),delete g.features)};return{listener:a,targets:t,delegates:{[c]:p}}}}on(c,t,a){if(typeof t=="function"||a===void 0)return super.on(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(c,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(u);for(const p in u.delegates)this.on(p,u.delegates[p]);return this}once(c,t,a){if(typeof t=="function"||a===void 0)return super.once(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(c,t,a);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(c,t,a){if(typeof t=="function"||a===void 0)return super.off(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._delegatedListeners?this._delegatedListeners[c]:void 0;return u&&(p=>{for(let g=0;g<p.length;g++){const v=p[g];if(v.listener===a&&_h(v.targets,t)){for(const w in v.delegates)this.off(w,v.delegates[w]);return p.splice(g,1),this}}})(u),this}queryRenderedFeatures(c,t){if(!this.style)return[];if(c===void 0||c instanceof r.P||Array.isArray(c)||t!==void 0||(t=c,c=void 0),c=c||[[0,0],[this.transform.width,this.transform.height]],!t){const g=this.style.queryRenderedFeatures(c,void 0,this.transform),v=this.style.queryRenderedFeatureset(c,void 0,this.transform);return g.concat(v)}let a=!0;if(t.target&&(a=this._isTargetValid(t.target),a&&!t.layers))return this.style.queryRenderedFeatureset(c,t,this.transform);let u=!0;if(t.layers&&Array.isArray(t.layers)){for(const g of t.layers)if(!this._isValidId(g)){u=!1;break}if(u&&!t.target)return this.style.queryRenderedFeatures(c,t,this.transform)}let p=[];return u&&(p=p.concat(this.style.queryRenderedFeatures(c,t,this.transform))),a&&(p=p.concat(this.style.queryRenderedFeatureset(c,t,this.transform))),p}querySourceFeatures(c,t){return!c||typeof c=="string"&&!this._isValidId(c)?[]:this.style.querySourceFeatures(c,t)}isPointOnSurface(c){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&r.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(c))}addInteraction(c,t){return this._interactions.add(c,t),this}removeInteraction(c){return this._interactions.remove(c),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(c){return this._cooperativeGestures=c,this}setStyle(c,t){return t=r.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&c&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(c,(a,u)=>{if(a){const p=typeof a=="string"?a:a instanceof Error?a.message:a.error;r.w(`Unable to perform style diff: ${p}. Rebuilding the style from scratch.`),this._updateStyle(c,t)}else u&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(c,t))}_getUIString(c){const t=this._locale[c];if(t==null)throw new Error(`Missing UI string '${c}'`);return t}_updateStyle(c,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c){const a=r.l({},t);t&&t.config&&(a.initialConfig=t.config,delete a.config),this.style=new Zo(this,a).load(c),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Zo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(c){return c==null?(this.fire(new r.z(new Error("IDs can't be empty."))),!1):!r.d9(c)||(this.fire(new r.z(new Error(`IDs can't contain special symbols: "${c}".`))),!1)}_isTargetValid(c){return"featuresetId"in c?this._isValidId("importId"in c?c.importId:c.featuresetId):"layerId"in c&&this._isValidId(c.layerId)}_areTargetsValid(c){if(Array.isArray(c)){for(const t of c)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(c)}addSource(c,t){return this._isValidId(c)?(this._lazyInitEmptyStyle(),this.style.addSource(c,t),this._update(!0)):this}isSourceLoaded(c){return!!this._isValidId(c)&&!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(c,t,a){this._lazyInitEmptyStyle(),this.style.addSourceType(c,t,a)}removeSource(c){return this._isValidId(c)?(this.style.removeSource(c),this._updateTerrain(),this._update(!0)):this}getSource(c){return this._isValidId(c)?this.style.getOwnSource(c):null}addImage(c,t,{pixelRatio:a=1,sdf:u=!1,stretchX:p,stretchY:g,content:v}={}){this._lazyInitEmptyStyle();const w=r.I.from(c);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:A,height:I,data:z}=r.q.getImageData(t);this.style.addImage(w,{data:new r.r({width:A,height:I},z),pixelRatio:a,stretchX:p,stretchY:g,content:v,sdf:u,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new r.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:I}=t,z=t;this.style.addImage(w,{data:new r.r({width:A,height:I},new Uint8Array(z.data)),pixelRatio:a,stretchX:p,stretchY:g,content:v,sdf:u,usvg:!1,version:0,userImage:z}),z.onAdd&&z.onAdd(this,c)}}updateImage(c,t){this._lazyInitEmptyStyle();const a=r.I.from(c),u=this.style.getImage(a);if(!u)return void this.fire(new r.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?r.q.getImageData(t):t,{width:g,height:v,data:w}=p;if(g===void 0||v===void 0)return void this.fire(new r.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==(u.usvg?u.icon.usvg_tree.width:u.data.width)||v!==(u.usvg?u.icon.usvg_tree.height:u.data.height))return void this.fire(new r.z(new Error(`The width and height of the updated image (${g}, ${v})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`)));const A=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let I=!1;u.usvg?(u.data=new r.r({width:g,height:v},new Uint8Array(w)),u.usvg=!1,u.icon=void 0,I=!0):u.data.replace(w,A),this.style.updateImage(a,u,I)}hasImage(c){return c?!!this.style&&!!this.style.getImage(r.I.from(c)):(this.fire(new r.z(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(r.I.from(c))}loadImage(c,t){r.o(this._requestManager.transformRequest(c,r.R.Image),(a,u)=>{t(a,u instanceof HTMLImageElement?r.q.getImageData(u):u)})}listImages(){return this.style.listImages().map(c=>c.name)}addModel(c,t){this._lazyInitEmptyStyle(),this.style.addModel(c,t)}hasModel(c){return c?this.style.hasModel(c):(this.fire(new r.z(new Error("Missing required model id"))),!1)}removeModel(c){this.style.removeModel(c)}listModels(){return this.style.listModels()}addLayer(c,t){return this._isValidId(c.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(c,t),this._update(!0)):this}getSlot(c){const t=this.getLayer(c);return t&&t.slot||null}setSlot(c,t){return this.style.setSlot(c,t),this.style.mergeLayers(),this._update(!0)}addImport(c,t){return this.style.addImport(c,t).catch(a=>this.fire(new r.z(new Error("Failed to add import",a)))),this}updateImport(c,t){return typeof t!="string"&&t.id!==c?(this.removeImport(c),this.addImport(t)):(this.style.updateImport(c,t),this._update(!0))}removeImport(c){return this.style.removeImport(c),this}moveImport(c,t){return this.style.moveImport(c,t),this._update(!0)}moveLayer(c,t){return this._isValidId(c)?(this.style.moveLayer(c,t),this._update(!0)):this}removeLayer(c){return this._isValidId(c)?(this.style.removeLayer(c),this._update(!0)):this}getLayer(c){if(!this._isValidId(c))return null;const t=this.style.getOwnLayer(c);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(c,t,a){return this._isValidId(c)?(this.style.setLayerZoomRange(c,t,a),this._update(!0)):this}setFilter(c,t,a={}){return this._isValidId(c)?(this.style.setFilter(c,t,a),this._update(!0)):this}getFilter(c){return this._isValidId(c)?this.style.getFilter(c):null}setPaintProperty(c,t,a,u={}){return this._isValidId(c)?(this.style.setPaintProperty(c,t,a,u),this._update(!0)):this}getPaintProperty(c,t){return this._isValidId(c)?this.style.getPaintProperty(c,t):null}setLayoutProperty(c,t,a,u={}){return this._isValidId(c)?(this.style.setLayoutProperty(c,t,a,u),this._update(!0)):this}getLayoutProperty(c,t){return this._isValidId(c)?this.style.getLayoutProperty(c,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(c){return this.style.setGlyphsUrl(c),this._update(!0)}getSchema(c){return this.style.getSchema(c)}setSchema(c,t){return this.style.setSchema(c,t),this._update(!0)}getConfig(c){return this.style.getConfig(c)}setConfig(c,t){return this.style.setConfig(c,t),this._update(!0)}getConfigProperty(c,t){return this.style.getConfigProperty(c,t)}setConfigProperty(c,t,a){return this.style.setConfigProperty(c,t,a),this._update(!0)}getFeaturesetDescriptors(c){return this.style.getFeaturesetDescriptors(c)}setLights(c){if(this._lazyInitEmptyStyle(),c&&c.length===1&&c[0].type==="flat"){const t=c[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(c),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const c=this.style.getLights()||[];return c.length===0&&c.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),c}setLight(c,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:c}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(c){return this._lazyInitEmptyStyle(),this.style.setSnow(c),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(c){return this._lazyInitEmptyStyle(),this.style.setRain(c),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(c){return this._lazyInitEmptyStyle(),this.style.setColorTheme(c),this._update(!0)}setImportColorTheme(c,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(c,t),this._update(!0)}setCamera(c){return this.style.setCamera(c),this._triggerCameraUpdate(c)}_triggerCameraUpdate(c){return this._update(this.transform.setOrthographicProjectionAtLowPitch(c["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.cd.convert(c),this.transform):0}setFeatureState(c,t){return c.source&&!this._isValidId(c.source)?this:(this.style.setFeatureState(c,t),this._update())}removeFeatureState(c,t){return c.source&&!this._isValidId(c.source)?this:(this.style.removeFeatureState(c,t),this._update())}getFeatureState(c){return c.source&&!this._isValidId(c.source)?null:this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let a,u,p,g=this._container;for(;g&&(!u||!p);){const v=window.getComputedStyle(g).transform;v&&v!=="none"&&(a=v.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(u=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(p=a[3])),g=g.parentElement}this._containerWidth=u?Math.abs(c/u):c,this._containerHeight=p?Math.abs(t/p):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=be("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=be("div","mapboxgl-canvas-container",c);this._canvas=be("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=be("div","mapboxgl-control-container",c),u=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(p=>{u[p]=be("div",`mapboxgl-ctrl-${p}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,t){const a=r.q.devicePixelRatio||1;this._canvas.width=a*Math.ceil(c),this._canvas.height=a*Math.ceil(t),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${t}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const t=this._markers.indexOf(c);t!==-1&&this._markers.splice(t,1)}_addPopup(c){this._popups.push(c)}_removePopup(c){const t=this._popups.indexOf(c);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const c=r.l({},Ie.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",c);t?(_n(t,!0),this.painter=new du(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.m.testSupport(t)):this.fire(new r.z(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.A("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new r.A("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let t;this.fire(new r.A("renderstart")),++this._frameId;const a=this.painter.context.extTimerQuery,u=r.q.now(),p=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=p.createQuery(),p.beginQuery(a.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,z=this.transform.pitch,k=r.q.now(),O=new r.aa(I,{now:k,fadeDuration:g,pitch:z,transition:this.style.transition});this.style.update(O)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let v=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),v=this._updateAverageElevation(u),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):v=this._updateAverageElevation(u);const w=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),w&&(this._placementDirty=w.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,ie.mark($.load),this.fire(new r.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const I=r.q.now()-u;p.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{const z=p.getQueryParameter(t,p.QUERY_RESULT)/1e6;p.deleteQuery(t),this.fire(new r.A("gpu-timing-frame",{cpuTime:I,gpuTime:z}))},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(I);this.fire(new r.A("gpu-timing-layer",{layerTimes:z}))},50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const z=this.painter.queryGpuTimeDeferredRender(I);this.fire(new r.A("gpu-timing-deferred-render",{gpuTime:z}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(A||this._repaint)this.triggerRepaint();else{const I=this.idle();if(I&&(v=this._updateAverageElevation(u,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new r.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new r.A("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,ie.mark($.fullLoad),this._performanceMetricsCollection&&Yi(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(c){for(const t of this._markers)c&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!c||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(c,t=!1){const a=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const u=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(u||(t||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const p=this.transform.averageElevation;let g=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(g)?g=0:this._averageElevationLastSampledAt=c;const v=Math.abs(p-g);if(v>1){if(this._isInitialLoad||u)return this._averageElevation.jumpTo(g),a(g);this._averageElevation.easeTo(g,c,300)}else if(v>1e-4)return this._averageElevation.jumpTo(g),a(g)}return!!this._averageElevation.isEasing(c)&&a(this._averageElevation.getValue(c))}_authenticate(){rn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===Ei||c.status===401)){const t=this.painter.context.gl;_n(t,!1),this._logoControl instanceof wc&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),bi(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&pi(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const c=this._isDragging();this.painter.updateTerrain(this.style,c)}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const a=this.painter.context.gl,u=a.createFramebuffer();function p(g){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,g,0);const v=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,v),v}return a.bindFramebuffer(a.FRAMEBUFFER,u),this._canvasPixelComparison(p(c),t.canvasCopies.map(p),t.timeStamps)}_canvasPixelComparison(c,t,a){let u=a[1]-a[0];const p=c.length/4;for(let g=0;g<t.length;g++){const v=t[g];let w=0;for(let A=0;A<v.length;A+=4)v[A]===c[A]&&v[A+1]===c[A+1]&&v[A+2]===c[A+2]&&v[A+3]===c[A+3]&&(w+=1);u+=(a[g+2]-a[g+1])*(1-w/p)}return u}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),xn.delete(this.painter.context.gl),Vi.remove(),Jt.remove(),this._removed=!0,this.fire(new r.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=r.q.frame(t=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(t)}))}_preloadTiles(c){const t=this.style?this.style.getSourceCaches():[];return r.bt(t,(a,u)=>a._preloadTiles(c,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(c){this._showParseStatus!==c&&(this._showParseStatus=c,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(c){this._showLayers2DWireframe!==c&&(this._showLayers2DWireframe=c,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(c){this._showLayers3DWireframe!==c&&(this._showLayers3DWireframe=c,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,this._tp.refreshUI(),c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(c){this._showTileAABBs!==c&&(this._showTileAABBs=c,this._tp.refreshUI(),c&&this._update())}_setCacheLimits(c,t){r.eJ(c,t)}get version(){return Z}},NavigationControl:class{constructor(c={}){this.options=r.l({},Gm,c),this._container=be("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(r.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),be("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),be("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:t}):a.resetNorth({},{originalEvent:t}))}),this._compassIcon=be("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const t=c.getZoom(),a=t===c.getMaxZoom(),u=t===c.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qo(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,t){const a=be("button",c,this._container);return a.type="button",a.addEventListener("click",t),a}_setButtonTitle(c,t){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${t}`);c.setAttribute("aria-label",a),c.firstElementChild&&c.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends r.E{constructor(c={}){super();const t=navigator.geolocation;this.options=r.l({geolocation:t},Ed,c),r.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=gc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=be("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){const t=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,c(a)};this._supportsGeolocation!==void 0?c(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>t(a.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(c){const t=this._map.getMaxBounds(),a=c.coords;return!!t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new r.A("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.A("geolocate",c)),this._finish()}}_updateCamera(c){const t=new r.cd(c.coords.longitude,c.coords.latitude),a=c.coords.accuracy,u=this._map.getBearing(),p=r.l({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(a),p,{geolocateSource:!0})}_updateMarker(c){if(c){const t=new r.cd(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,t=r.c6(1,c._center.lat)*c.worldSize,a=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.A("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=be("button","mapboxgl-ctrl-geolocate",this._container),be("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=be("div","mapboxgl-user-location"),this._dotElement.appendChild(be("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(be("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new jr({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=be("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.A("trackuserlocationend")))})}}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:gh,ScaleControl:class{constructor(c={}){this.options=r.l({},vh,c),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,t=this._map,a=t._containerHeight/2,u=t._containerWidth/2-c/2,p=t.unproject([u,a]),g=t.unproject([u+c,a]),v=p.distanceTo(g);if(this.options.unit==="imperial"){const w=3.2808*v;w>5280?this._setScale(c,w/5280,"mile"):this._setScale(c,w,"foot")}else this.options.unit==="nautical"?this._setScale(c,v/1852,"nautical-mile"):v>=1e3?this._setScale(c,v/1e3,"kilometer"):this._setScale(c,v,"meter")}_setScale(c,t,a){this._map._requestDomTask(()=>{const u=function(g){const v=Math.pow(10,`${Math.floor(g)}`.length-1);let w=g/v;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(A){const I=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*I)/I}(w),v*w}(t),p=u/t;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(u):`${u}&nbsp;${hl[a]}`,this._container.style.width=c*p+"px"})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=be("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c={}){this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:r.w("Full screen control 'container' must be a DOM element.")),r.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=be("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=be("button","mapboxgl-ctrl-fullscreen",this._controlContainer);be("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(c){super(),this.options=r.l(Object.create(go),c),this._altitude=this.options.altitude,r.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),c._addPopup(this),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new r.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),c._canvasContainer&&c._canvasContainer.classList.remove("mapboxgl-track-pointer"),c._removePopup(this),this._map=void 0),this.fire(new r.A("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=r.cd.convert(c),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(c){return this._altitude=c,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const t=document.createDocumentFragment(),a=document.createElement("body");let u;for(a.innerHTML=c;u=a.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=be("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(c),this.options.closeButton){const a=this._closeButton=be("button","mapboxgl-popup-close-button",t);a.type="button",a.setAttribute("aria-label","Close popup"),a.innerHTML='<span aria-hidden="true">&#215;</span>',a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let t;return this._classList.delete(c)?t=!1:(this._classList.add(c),t=!0),this._updateClassList(),t}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const t=this._map,a=this._container,u=this._pos;if(!t||!a||!u)return"bottom";const p=a.offsetWidth,g=a.offsetHeight,v=u.x<p/2,w=u.x>t.transform.width-p/2;if(u.y+c<g)return v?"top-left":w?"top-right":"top";if(u.y>t.transform.height-g){if(v)return"bottom-left";if(w)return"bottom-right"}return v?"left":w?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),c.className=t.join(" ")}_update(c){const t=this._map,a=this._content;if(!t||!this._lngLat&&!this._trackPointer||!a)return;let u=this._container;if(u||(u=this._container=be("div","mapboxgl-popup",t.getContainer()),this._tip=be("div","mapboxgl-popup-tip",u),u.appendChild(a)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Zp(this._lngLat,this._pos,t.transform)),!this._trackPointer||c){const p=this._pos=this._trackPointer&&c instanceof r.P?c:t.project(this._lngLat,this._altitude),g=Ol(this.options.offset),v=this._anchor=this._getAnchor(g.y),w=Ol(this.options.offset,v),A=p.add(w).round();t._requestDomTask(()=>{this._container&&v&&(this._container.style.transform=`${yh[v]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&t._showingGlobe()){const p=r.eK(t.transform,this._lngLat)?0:1;this._setOpacity(p)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(Ca);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:jr,Style:Zo,LngLat:r.cd,LngLatBounds:r.aG,Point:r.P,MercatorCoordinate:r.ac,FreeCameraOptions:$u,Evented:r.E,config:r.e,prewarm:r.eP,clearPrewarmedResources:r.eQ,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(c){r.e.ACCESS_TOKEN=c},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(c){r.e.API_URL=c},get workerCount(){return r.eR.workerCount},set workerCount(c){r.eR.workerCount=c},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){r.e.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){r.eS(c)},get workerUrl(){return r.eT.workerUrl},set workerUrl(c){r.eT.workerUrl=c},get workerClass(){return r.eT.workerClass},set workerClass(c){r.eT.workerClass=c},get workerParams(){return r.eT.workerParams},set workerParams(c){r.eT.workerParams=c},get dracoUrl(){return r.eU()},set dracoUrl(c){r.eV(c)},get meshoptUrl(){return r.eW()},set meshoptUrl(c){r.eX(c)},setNow:r.q.setNow,restoreNow:r.q.restoreNow}});var G=L;return G})}(l0)),l0.exports}var dL=hL();const Og=Wb(dL),fL="pk.eyJ1Ijoic2FoaWw0NDQ0IiwiYSI6ImNtYW5vMG9jdDAxMGMybXNndm93aHhodWUifQ.fuS1ttNnQmKnDKq_cHR0JA";function bE({profiles:m,selectedProfile:b,onProfileSelect:E,singleProfileMode:C=!1}){const L=ne.useRef(null),N=ne.useRef(null),G=ne.useRef({}),[r,Z]=ne.useState(!0);return ne.useEffect(()=>{if(L.current)return Og.accessToken=fL,N.current=new Og.Map({container:L.current,style:"mapbox://styles/mapbox/streets-v12",center:[0,20],zoom:1.5}),N.current.addControl(new Og.NavigationControl,"top-right"),N.current.on("load",()=>{Z(!1)}),()=>{N.current&&(N.current.remove(),N.current=null)}},[]),ne.useEffect(()=>{if(!(!N.current||r||!m.length)&&(Object.values(G.current).forEach($=>$.remove()),G.current={},m.forEach($=>{const{lat:ie,lng:oe}=$.location.coordinates,fe=document.createElement("div");fe.className="flex items-center justify-center",fe.style.width="32px",fe.style.height="32px",fe.style.borderRadius="50%",fe.style.backgroundColor=(b==null?void 0:b.id)===$.id?"#10b981":"#0f766e",fe.style.border="2px solid white",fe.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)",fe.style.cursor="pointer",fe.style.transition="all 0.3s ease";const Re=document.createElement("div");Re.style.width="6px",Re.style.height="6px",Re.style.borderRadius="50%",Re.style.backgroundColor="white",fe.appendChild(Re);const Ie=new Og.Popup({offset:25,closeButton:!1}).setHTML(`
          <div class="flex items-center gap-2 p-1">
            <img src="${$.avatar}" alt="${$.name}" class="w-10 h-10 rounded-full object-cover" />
            <div>
              <div class="font-semibold text-gray-700">${$.name}</div>
              <div class="text-xs text-gray-600">${$.location.city}, ${$.location.country}</div>
            </div>
          </div>
        `),be=new Og.Marker(fe).setLngLat([oe,ie]).setPopup(Ie).addTo(N.current);be.getElement().addEventListener("click",()=>{E&&E($)}),G.current[$.id]=be}),m.length>0)){const $=new Og.LngLatBounds;m.forEach(ie=>{const{lat:oe,lng:fe}=ie.location.coordinates;$.extend([fe,oe])}),N.current.fitBounds($,{padding:50,maxZoom:C?13:10})}},[m,r,b,E,C]),ne.useEffect(()=>{if(!N.current||r||!b)return;const{lat:$,lng:ie}=b.location.coordinates;N.current.flyTo({center:[ie,$],zoom:13,speed:1.5,curve:1.5});const oe=G.current[b.id];oe&&oe.togglePopup(),Object.entries(G.current).forEach(([fe,Re])=>{const Ie=Re.getElement().firstChild;Ie&&(fe===b.id?(Ie.style.backgroundColor="#10b981",Ie.style.width="40px",Ie.style.height="40px",Ie.style.zIndex="10"):(Ie.style.backgroundColor="#0f766e",Ie.style.width="32px",Ie.style.height="32px",Ie.style.zIndex="1"))})},[b,r]),H.jsxs("div",{className:"relative w-full h-full",children:[r&&H.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 dark:bg-gray-800 bg-opacity-50 dark:bg-opacity-50 z-10",children:H.jsx(Py,{className:"h-8 w-8 text-emerald-600 dark:text-emerald-400 animate-spin"})}),H.jsx("div",{ref:L,className:"map-container"})]})}function dl({className:m,type:b,...E}){return H.jsx("input",{type:b,"data-slot":"input",className:Sr("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",m),...E})}function Y2(m,[b,E]){return Math.min(E,Math.max(b,m))}function pn(m,b,{checkForDefaultPrevented:E=!0}={}){return function(L){if(m==null||m(L),E===!1||!L.defaultPrevented)return b==null?void 0:b(L)}}function pL(m,b){const E=ne.createContext(b),C=N=>{const{children:G,...r}=N,Z=ne.useMemo(()=>r,Object.values(r));return H.jsx(E.Provider,{value:Z,children:G})};C.displayName=m+"Provider";function L(N){const G=ne.useContext(E);if(G)return G;if(b!==void 0)return b;throw new Error(`\`${N}\` must be used within \`${m}\``)}return[C,L]}function Wd(m,b=[]){let E=[];function C(N,G){const r=ne.createContext(G),Z=E.length;E=[...E,G];const $=oe=>{var Oe;const{scope:fe,children:Re,...Ie}=oe,be=((Oe=fe==null?void 0:fe[m])==null?void 0:Oe[Z])||r,ke=ne.useMemo(()=>Ie,Object.values(Ie));return H.jsx(be.Provider,{value:ke,children:Re})};$.displayName=N+"Provider";function ie(oe,fe){var be;const Re=((be=fe==null?void 0:fe[m])==null?void 0:be[Z])||r,Ie=ne.useContext(Re);if(Ie)return Ie;if(G!==void 0)return G;throw new Error(`\`${oe}\` must be used within \`${N}\``)}return[$,ie]}const L=()=>{const N=E.map(G=>ne.createContext(G));return function(r){const Z=(r==null?void 0:r[m])||N;return ne.useMemo(()=>({[`__scope${m}`]:{...r,[m]:Z}}),[r,Z])}};return L.scopeName=m,[C,mL(L,...b)]}function mL(...m){const b=m[0];if(m.length===1)return b;const E=()=>{const C=m.map(L=>({useScope:L(),scopeName:L.scopeName}));return function(N){const G=C.reduce((r,{useScope:Z,scopeName:$})=>{const oe=Z(N)[`__scope${$}`];return{...r,...oe}},{});return ne.useMemo(()=>({[`__scope${b.scopeName}`]:G}),[G])}};return E.scopeName=b.scopeName,E}function p1(m){const b=m+"CollectionProvider",[E,C]=Wd(b),[L,N]=E(b,{collectionRef:{current:null},itemMap:new Map}),G=be=>{const{scope:ke,children:Oe}=be,Be=zr.useRef(null),je=zr.useRef(new Map).current;return H.jsx(L,{scope:ke,itemMap:je,collectionRef:Be,children:Oe})};G.displayName=b;const r=m+"CollectionSlot",Z=Em(r),$=zr.forwardRef((be,ke)=>{const{scope:Oe,children:Be}=be,je=N(r,Oe),at=Xr(ke,je.collectionRef);return H.jsx(Z,{ref:at,children:Be})});$.displayName=r;const ie=m+"CollectionItemSlot",oe="data-radix-collection-item",fe=Em(ie),Re=zr.forwardRef((be,ke)=>{const{scope:Oe,children:Be,...je}=be,at=zr.useRef(null),ut=Xr(ke,at),Xe=N(ie,Oe);return zr.useEffect(()=>(Xe.itemMap.set(at,{ref:at,...je}),()=>void Xe.itemMap.delete(at))),H.jsx(fe,{[oe]:"",ref:ut,children:Be})});Re.displayName=ie;function Ie(be){const ke=N(m+"CollectionConsumer",be);return zr.useCallback(()=>{const Be=ke.collectionRef.current;if(!Be)return[];const je=Array.from(Be.querySelectorAll(`[${oe}]`));return Array.from(ke.itemMap.values()).sort((Xe,Tt)=>je.indexOf(Xe.ref.current)-je.indexOf(Tt.ref.current))},[ke.collectionRef,ke.itemMap])}return[{Provider:G,Slot:$,ItemSlot:Re},Ie,C]}var gL=ne.createContext(void 0);function D0(m){const b=ne.useContext(gL);return m||b||"ltr"}var _L=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ur=_L.reduce((m,b)=>{const E=Em(`Primitive.${b}`),C=ne.forwardRef((L,N)=>{const{asChild:G,...r}=L,Z=G?E:b;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),H.jsx(Z,{...r,ref:N})});return C.displayName=`Primitive.${b}`,{...m,[b]:C}},{});function wE(m,b){m&&Yg.flushSync(()=>m.dispatchEvent(b))}function Ih(m){const b=ne.useRef(m);return ne.useEffect(()=>{b.current=m}),ne.useMemo(()=>(...E)=>{var C;return(C=b.current)==null?void 0:C.call(b,...E)},[])}function yL(m,b=globalThis==null?void 0:globalThis.document){const E=Ih(m);ne.useEffect(()=>{const C=L=>{L.key==="Escape"&&E(L)};return b.addEventListener("keydown",C,{capture:!0}),()=>b.removeEventListener("keydown",C,{capture:!0})},[E,b])}var vL="DismissableLayer",Nb="dismissableLayer.update",xL="dismissableLayer.pointerDownOutside",bL="dismissableLayer.focusOutside",K2,TE=ne.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),z0=ne.forwardRef((m,b)=>{const{disableOutsidePointerEvents:E=!1,onEscapeKeyDown:C,onPointerDownOutside:L,onFocusOutside:N,onInteractOutside:G,onDismiss:r,...Z}=m,$=ne.useContext(TE),[ie,oe]=ne.useState(null),fe=(ie==null?void 0:ie.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,Re]=ne.useState({}),Ie=Xr(b,Tt=>oe(Tt)),be=Array.from($.layers),[ke]=[...$.layersWithOutsidePointerEventsDisabled].slice(-1),Oe=be.indexOf(ke),Be=ie?be.indexOf(ie):-1,je=$.layersWithOutsidePointerEventsDisabled.size>0,at=Be>=Oe,ut=SL(Tt=>{const vt=Tt.target,ni=[...$.branches].some(Pi=>Pi.contains(vt));!at||ni||(L==null||L(Tt),G==null||G(Tt),Tt.defaultPrevented||r==null||r())},fe),Xe=EL(Tt=>{const vt=Tt.target;[...$.branches].some(Pi=>Pi.contains(vt))||(N==null||N(Tt),G==null||G(Tt),Tt.defaultPrevented||r==null||r())},fe);return yL(Tt=>{Be===$.layers.size-1&&(C==null||C(Tt),!Tt.defaultPrevented&&r&&(Tt.preventDefault(),r()))},fe),ne.useEffect(()=>{if(ie)return E&&($.layersWithOutsidePointerEventsDisabled.size===0&&(K2=fe.body.style.pointerEvents,fe.body.style.pointerEvents="none"),$.layersWithOutsidePointerEventsDisabled.add(ie)),$.layers.add(ie),Q2(),()=>{E&&$.layersWithOutsidePointerEventsDisabled.size===1&&(fe.body.style.pointerEvents=K2)}},[ie,fe,E,$]),ne.useEffect(()=>()=>{ie&&($.layers.delete(ie),$.layersWithOutsidePointerEventsDisabled.delete(ie),Q2())},[ie,$]),ne.useEffect(()=>{const Tt=()=>Re({});return document.addEventListener(Nb,Tt),()=>document.removeEventListener(Nb,Tt)},[]),H.jsx(ur.div,{...Z,ref:Ie,style:{pointerEvents:je?at?"auto":"none":void 0,...m.style},onFocusCapture:pn(m.onFocusCapture,Xe.onFocusCapture),onBlurCapture:pn(m.onBlurCapture,Xe.onBlurCapture),onPointerDownCapture:pn(m.onPointerDownCapture,ut.onPointerDownCapture)})});z0.displayName=vL;var wL="DismissableLayerBranch",TL=ne.forwardRef((m,b)=>{const E=ne.useContext(TE),C=ne.useRef(null),L=Xr(b,C);return ne.useEffect(()=>{const N=C.current;if(N)return E.branches.add(N),()=>{E.branches.delete(N)}},[E.branches]),H.jsx(ur.div,{...m,ref:L})});TL.displayName=wL;function SL(m,b=globalThis==null?void 0:globalThis.document){const E=Ih(m),C=ne.useRef(!1),L=ne.useRef(()=>{});return ne.useEffect(()=>{const N=r=>{if(r.target&&!C.current){let Z=function(){SE(xL,E,$,{discrete:!0})};const $={originalEvent:r};r.pointerType==="touch"?(b.removeEventListener("click",L.current),L.current=Z,b.addEventListener("click",L.current,{once:!0})):Z()}else b.removeEventListener("click",L.current);C.current=!1},G=window.setTimeout(()=>{b.addEventListener("pointerdown",N)},0);return()=>{window.clearTimeout(G),b.removeEventListener("pointerdown",N),b.removeEventListener("click",L.current)}},[b,E]),{onPointerDownCapture:()=>C.current=!0}}function EL(m,b=globalThis==null?void 0:globalThis.document){const E=Ih(m),C=ne.useRef(!1);return ne.useEffect(()=>{const L=N=>{N.target&&!C.current&&SE(bL,E,{originalEvent:N},{discrete:!1})};return b.addEventListener("focusin",L),()=>b.removeEventListener("focusin",L)},[b,E]),{onFocusCapture:()=>C.current=!0,onBlurCapture:()=>C.current=!1}}function Q2(){const m=new CustomEvent(Nb);document.dispatchEvent(m)}function SE(m,b,E,{discrete:C}){const L=E.originalEvent.target,N=new CustomEvent(m,{bubbles:!1,cancelable:!0,detail:E});b&&L.addEventListener(m,b,{once:!0}),C?wE(L,N):L.dispatchEvent(N)}var pb=0;function m1(){ne.useEffect(()=>{const m=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",m[0]??J2()),document.body.insertAdjacentElement("beforeend",m[1]??J2()),pb++,()=>{pb===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(b=>b.remove()),pb--}},[])}function J2(){const m=document.createElement("span");return m.setAttribute("data-radix-focus-guard",""),m.tabIndex=0,m.style.outline="none",m.style.opacity="0",m.style.position="fixed",m.style.pointerEvents="none",m}var mb="focusScope.autoFocusOnMount",gb="focusScope.autoFocusOnUnmount",eS={bubbles:!1,cancelable:!0},AL="FocusScope",P0=ne.forwardRef((m,b)=>{const{loop:E=!1,trapped:C=!1,onMountAutoFocus:L,onUnmountAutoFocus:N,...G}=m,[r,Z]=ne.useState(null),$=Ih(L),ie=Ih(N),oe=ne.useRef(null),fe=Xr(b,be=>Z(be)),Re=ne.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;ne.useEffect(()=>{if(C){let be=function(je){if(Re.paused||!r)return;const at=je.target;r.contains(at)?oe.current=at:Xf(oe.current,{select:!0})},ke=function(je){if(Re.paused||!r)return;const at=je.relatedTarget;at!==null&&(r.contains(at)||Xf(oe.current,{select:!0}))},Oe=function(je){if(document.activeElement===document.body)for(const ut of je)ut.removedNodes.length>0&&Xf(r)};document.addEventListener("focusin",be),document.addEventListener("focusout",ke);const Be=new MutationObserver(Oe);return r&&Be.observe(r,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",be),document.removeEventListener("focusout",ke),Be.disconnect()}}},[C,r,Re.paused]),ne.useEffect(()=>{if(r){iS.add(Re);const be=document.activeElement;if(!r.contains(be)){const Oe=new CustomEvent(mb,eS);r.addEventListener(mb,$),r.dispatchEvent(Oe),Oe.defaultPrevented||(ML(zL(EE(r)),{select:!0}),document.activeElement===be&&Xf(r))}return()=>{r.removeEventListener(mb,$),setTimeout(()=>{const Oe=new CustomEvent(gb,eS);r.addEventListener(gb,ie),r.dispatchEvent(Oe),Oe.defaultPrevented||Xf(be??document.body,{select:!0}),r.removeEventListener(gb,ie),iS.remove(Re)},0)}}},[r,$,ie,Re]);const Ie=ne.useCallback(be=>{if(!E&&!C||Re.paused)return;const ke=be.key==="Tab"&&!be.altKey&&!be.ctrlKey&&!be.metaKey,Oe=document.activeElement;if(ke&&Oe){const Be=be.currentTarget,[je,at]=CL(Be);je&&at?!be.shiftKey&&Oe===at?(be.preventDefault(),E&&Xf(je,{select:!0})):be.shiftKey&&Oe===je&&(be.preventDefault(),E&&Xf(at,{select:!0})):Oe===Be&&be.preventDefault()}},[E,C,Re.paused]);return H.jsx(ur.div,{tabIndex:-1,...G,ref:fe,onKeyDown:Ie})});P0.displayName=AL;function ML(m,{select:b=!1}={}){const E=document.activeElement;for(const C of m)if(Xf(C,{select:b}),document.activeElement!==E)return}function CL(m){const b=EE(m),E=tS(b,m),C=tS(b.reverse(),m);return[E,C]}function EE(m){const b=[],E=document.createTreeWalker(m,NodeFilter.SHOW_ELEMENT,{acceptNode:C=>{const L=C.tagName==="INPUT"&&C.type==="hidden";return C.disabled||C.hidden||L?NodeFilter.FILTER_SKIP:C.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;E.nextNode();)b.push(E.currentNode);return b}function tS(m,b){for(const E of m)if(!RL(E,{upTo:b}))return E}function RL(m,{upTo:b}){if(getComputedStyle(m).visibility==="hidden")return!0;for(;m;){if(b!==void 0&&m===b)return!1;if(getComputedStyle(m).display==="none")return!0;m=m.parentElement}return!1}function IL(m){return m instanceof HTMLInputElement&&"select"in m}function Xf(m,{select:b=!1}={}){if(m&&m.focus){const E=document.activeElement;m.focus({preventScroll:!0}),m!==E&&IL(m)&&b&&m.select()}}var iS=DL();function DL(){let m=[];return{add(b){const E=m[0];b!==E&&(E==null||E.pause()),m=nS(m,b),m.unshift(b)},remove(b){var E;m=nS(m,b),(E=m[0])==null||E.resume()}}}function nS(m,b){const E=[...m],C=E.indexOf(b);return C!==-1&&E.splice(C,1),E}function zL(m){return m.filter(b=>b.tagName!=="A")}var Ss=globalThis!=null&&globalThis.document?ne.useLayoutEffect:()=>{},PL=wS[" useId ".trim().toString()]||(()=>{}),LL=0;function Ch(m){const[b,E]=ne.useState(PL());return Ss(()=>{E(C=>C??String(LL++))},[m]),m||(b?`radix-${b}`:"")}const OL=["top","right","bottom","left"],Kf=Math.min,Hl=Math.max,y0=Math.round,Jv=Math.floor,Rh=m=>({x:m,y:m}),kL={left:"right",right:"left",bottom:"top",top:"bottom"},NL={start:"end",end:"start"};function Bb(m,b,E){return Hl(m,Kf(b,E))}function Zd(m,b){return typeof m=="function"?m(b):m}function Xd(m){return m.split("-")[0]}function Jg(m){return m.split("-")[1]}function g1(m){return m==="x"?"y":"x"}function _1(m){return m==="y"?"height":"width"}function qd(m){return["top","bottom"].includes(Xd(m))?"y":"x"}function y1(m){return g1(qd(m))}function BL(m,b,E){E===void 0&&(E=!1);const C=Jg(m),L=y1(m),N=_1(L);let G=L==="x"?C===(E?"end":"start")?"right":"left":C==="start"?"bottom":"top";return b.reference[N]>b.floating[N]&&(G=v0(G)),[G,v0(G)]}function FL(m){const b=v0(m);return[Fb(m),b,Fb(b)]}function Fb(m){return m.replace(/start|end/g,b=>NL[b])}function jL(m,b,E){const C=["left","right"],L=["right","left"],N=["top","bottom"],G=["bottom","top"];switch(m){case"top":case"bottom":return E?b?L:C:b?C:L;case"left":case"right":return b?N:G;default:return[]}}function UL(m,b,E,C){const L=Jg(m);let N=jL(Xd(m),E==="start",C);return L&&(N=N.map(G=>G+"-"+L),b&&(N=N.concat(N.map(Fb)))),N}function v0(m){return m.replace(/left|right|bottom|top/g,b=>kL[b])}function VL(m){return{top:0,right:0,bottom:0,left:0,...m}}function AE(m){return typeof m!="number"?VL(m):{top:m,right:m,bottom:m,left:m}}function x0(m){const{x:b,y:E,width:C,height:L}=m;return{width:C,height:L,top:E,left:b,right:b+C,bottom:E+L,x:b,y:E}}function rS(m,b,E){let{reference:C,floating:L}=m;const N=qd(b),G=y1(b),r=_1(G),Z=Xd(b),$=N==="y",ie=C.x+C.width/2-L.width/2,oe=C.y+C.height/2-L.height/2,fe=C[r]/2-L[r]/2;let Re;switch(Z){case"top":Re={x:ie,y:C.y-L.height};break;case"bottom":Re={x:ie,y:C.y+C.height};break;case"right":Re={x:C.x+C.width,y:oe};break;case"left":Re={x:C.x-L.width,y:oe};break;default:Re={x:C.x,y:C.y}}switch(Jg(b)){case"start":Re[G]-=fe*(E&&$?-1:1);break;case"end":Re[G]+=fe*(E&&$?-1:1);break}return Re}const GL=async(m,b,E)=>{const{placement:C="bottom",strategy:L="absolute",middleware:N=[],platform:G}=E,r=N.filter(Boolean),Z=await(G.isRTL==null?void 0:G.isRTL(b));let $=await G.getElementRects({reference:m,floating:b,strategy:L}),{x:ie,y:oe}=rS($,C,Z),fe=C,Re={},Ie=0;for(let be=0;be<r.length;be++){const{name:ke,fn:Oe}=r[be],{x:Be,y:je,data:at,reset:ut}=await Oe({x:ie,y:oe,initialPlacement:C,placement:fe,strategy:L,middlewareData:Re,rects:$,platform:G,elements:{reference:m,floating:b}});ie=Be??ie,oe=je??oe,Re={...Re,[ke]:{...Re[ke],...at}},ut&&Ie<=50&&(Ie++,typeof ut=="object"&&(ut.placement&&(fe=ut.placement),ut.rects&&($=ut.rects===!0?await G.getElementRects({reference:m,floating:b,strategy:L}):ut.rects),{x:ie,y:oe}=rS($,fe,Z)),be=-1)}return{x:ie,y:oe,placement:fe,strategy:L,middlewareData:Re}};async function Ty(m,b){var E;b===void 0&&(b={});const{x:C,y:L,platform:N,rects:G,elements:r,strategy:Z}=m,{boundary:$="clippingAncestors",rootBoundary:ie="viewport",elementContext:oe="floating",altBoundary:fe=!1,padding:Re=0}=Zd(b,m),Ie=AE(Re),ke=r[fe?oe==="floating"?"reference":"floating":oe],Oe=x0(await N.getClippingRect({element:(E=await(N.isElement==null?void 0:N.isElement(ke)))==null||E?ke:ke.contextElement||await(N.getDocumentElement==null?void 0:N.getDocumentElement(r.floating)),boundary:$,rootBoundary:ie,strategy:Z})),Be=oe==="floating"?{x:C,y:L,width:G.floating.width,height:G.floating.height}:G.reference,je=await(N.getOffsetParent==null?void 0:N.getOffsetParent(r.floating)),at=await(N.isElement==null?void 0:N.isElement(je))?await(N.getScale==null?void 0:N.getScale(je))||{x:1,y:1}:{x:1,y:1},ut=x0(N.convertOffsetParentRelativeRectToViewportRelativeRect?await N.convertOffsetParentRelativeRectToViewportRelativeRect({elements:r,rect:Be,offsetParent:je,strategy:Z}):Be);return{top:(Oe.top-ut.top+Ie.top)/at.y,bottom:(ut.bottom-Oe.bottom+Ie.bottom)/at.y,left:(Oe.left-ut.left+Ie.left)/at.x,right:(ut.right-Oe.right+Ie.right)/at.x}}const HL=m=>({name:"arrow",options:m,async fn(b){const{x:E,y:C,placement:L,rects:N,platform:G,elements:r,middlewareData:Z}=b,{element:$,padding:ie=0}=Zd(m,b)||{};if($==null)return{};const oe=AE(ie),fe={x:E,y:C},Re=y1(L),Ie=_1(Re),be=await G.getDimensions($),ke=Re==="y",Oe=ke?"top":"left",Be=ke?"bottom":"right",je=ke?"clientHeight":"clientWidth",at=N.reference[Ie]+N.reference[Re]-fe[Re]-N.floating[Ie],ut=fe[Re]-N.reference[Re],Xe=await(G.getOffsetParent==null?void 0:G.getOffsetParent($));let Tt=Xe?Xe[je]:0;(!Tt||!await(G.isElement==null?void 0:G.isElement(Xe)))&&(Tt=r.floating[je]||N.floating[Ie]);const vt=at/2-ut/2,ni=Tt/2-be[Ie]/2-1,Pi=Kf(oe[Oe],ni),xi=Kf(oe[Be],ni),Fi=Pi,Ei=Tt-be[Ie]-xi,fi=Tt/2-be[Ie]/2+vt,yi=Bb(Fi,fi,Ei),Je=!Z.arrow&&Jg(L)!=null&&fi!==yi&&N.reference[Ie]/2-(fi<Fi?Pi:xi)-be[Ie]/2<0,jt=Je?fi<Fi?fi-Fi:fi-Ei:0;return{[Re]:fe[Re]+jt,data:{[Re]:yi,centerOffset:fi-yi-jt,...Je&&{alignmentOffset:jt}},reset:Je}}}),qL=function(m){return m===void 0&&(m={}),{name:"flip",options:m,async fn(b){var E,C;const{placement:L,middlewareData:N,rects:G,initialPlacement:r,platform:Z,elements:$}=b,{mainAxis:ie=!0,crossAxis:oe=!0,fallbackPlacements:fe,fallbackStrategy:Re="bestFit",fallbackAxisSideDirection:Ie="none",flipAlignment:be=!0,...ke}=Zd(m,b);if((E=N.arrow)!=null&&E.alignmentOffset)return{};const Oe=Xd(L),Be=qd(r),je=Xd(r)===r,at=await(Z.isRTL==null?void 0:Z.isRTL($.floating)),ut=fe||(je||!be?[v0(r)]:FL(r)),Xe=Ie!=="none";!fe&&Xe&&ut.push(...UL(r,be,Ie,at));const Tt=[r,...ut],vt=await Ty(b,ke),ni=[];let Pi=((C=N.flip)==null?void 0:C.overflows)||[];if(ie&&ni.push(vt[Oe]),oe){const yi=BL(L,G,at);ni.push(vt[yi[0]],vt[yi[1]])}if(Pi=[...Pi,{placement:L,overflows:ni}],!ni.every(yi=>yi<=0)){var xi,Fi;const yi=(((xi=N.flip)==null?void 0:xi.index)||0)+1,Je=Tt[yi];if(Je){var Ei;const _t=oe==="alignment"?Be!==qd(Je):!1,$t=((Ei=Pi[0])==null?void 0:Ei.overflows[0])>0;if(!_t||$t)return{data:{index:yi,overflows:Pi},reset:{placement:Je}}}let jt=(Fi=Pi.filter(_t=>_t.overflows[0]<=0).sort((_t,$t)=>_t.overflows[1]-$t.overflows[1])[0])==null?void 0:Fi.placement;if(!jt)switch(Re){case"bestFit":{var fi;const _t=(fi=Pi.filter($t=>{if(Xe){const Fe=qd($t.placement);return Fe===Be||Fe==="y"}return!0}).map($t=>[$t.placement,$t.overflows.filter(Fe=>Fe>0).reduce((Fe,zt)=>Fe+zt,0)]).sort(($t,Fe)=>$t[1]-Fe[1])[0])==null?void 0:fi[0];_t&&(jt=_t);break}case"initialPlacement":jt=r;break}if(L!==jt)return{reset:{placement:jt}}}return{}}}};function aS(m,b){return{top:m.top-b.height,right:m.right-b.width,bottom:m.bottom-b.height,left:m.left-b.width}}function oS(m){return OL.some(b=>m[b]>=0)}const $L=function(m){return m===void 0&&(m={}),{name:"hide",options:m,async fn(b){const{rects:E}=b,{strategy:C="referenceHidden",...L}=Zd(m,b);switch(C){case"referenceHidden":{const N=await Ty(b,{...L,elementContext:"reference"}),G=aS(N,E.reference);return{data:{referenceHiddenOffsets:G,referenceHidden:oS(G)}}}case"escaped":{const N=await Ty(b,{...L,altBoundary:!0}),G=aS(N,E.floating);return{data:{escapedOffsets:G,escaped:oS(G)}}}default:return{}}}}};async function ZL(m,b){const{placement:E,platform:C,elements:L}=m,N=await(C.isRTL==null?void 0:C.isRTL(L.floating)),G=Xd(E),r=Jg(E),Z=qd(E)==="y",$=["left","top"].includes(G)?-1:1,ie=N&&Z?-1:1,oe=Zd(b,m);let{mainAxis:fe,crossAxis:Re,alignmentAxis:Ie}=typeof oe=="number"?{mainAxis:oe,crossAxis:0,alignmentAxis:null}:{mainAxis:oe.mainAxis||0,crossAxis:oe.crossAxis||0,alignmentAxis:oe.alignmentAxis};return r&&typeof Ie=="number"&&(Re=r==="end"?Ie*-1:Ie),Z?{x:Re*ie,y:fe*$}:{x:fe*$,y:Re*ie}}const XL=function(m){return m===void 0&&(m=0),{name:"offset",options:m,async fn(b){var E,C;const{x:L,y:N,placement:G,middlewareData:r}=b,Z=await ZL(b,m);return G===((E=r.offset)==null?void 0:E.placement)&&(C=r.arrow)!=null&&C.alignmentOffset?{}:{x:L+Z.x,y:N+Z.y,data:{...Z,placement:G}}}}},WL=function(m){return m===void 0&&(m={}),{name:"shift",options:m,async fn(b){const{x:E,y:C,placement:L}=b,{mainAxis:N=!0,crossAxis:G=!1,limiter:r={fn:ke=>{let{x:Oe,y:Be}=ke;return{x:Oe,y:Be}}},...Z}=Zd(m,b),$={x:E,y:C},ie=await Ty(b,Z),oe=qd(Xd(L)),fe=g1(oe);let Re=$[fe],Ie=$[oe];if(N){const ke=fe==="y"?"top":"left",Oe=fe==="y"?"bottom":"right",Be=Re+ie[ke],je=Re-ie[Oe];Re=Bb(Be,Re,je)}if(G){const ke=oe==="y"?"top":"left",Oe=oe==="y"?"bottom":"right",Be=Ie+ie[ke],je=Ie-ie[Oe];Ie=Bb(Be,Ie,je)}const be=r.fn({...b,[fe]:Re,[oe]:Ie});return{...be,data:{x:be.x-E,y:be.y-C,enabled:{[fe]:N,[oe]:G}}}}}},YL=function(m){return m===void 0&&(m={}),{options:m,fn(b){const{x:E,y:C,placement:L,rects:N,middlewareData:G}=b,{offset:r=0,mainAxis:Z=!0,crossAxis:$=!0}=Zd(m,b),ie={x:E,y:C},oe=qd(L),fe=g1(oe);let Re=ie[fe],Ie=ie[oe];const be=Zd(r,b),ke=typeof be=="number"?{mainAxis:be,crossAxis:0}:{mainAxis:0,crossAxis:0,...be};if(Z){const je=fe==="y"?"height":"width",at=N.reference[fe]-N.floating[je]+ke.mainAxis,ut=N.reference[fe]+N.reference[je]-ke.mainAxis;Re<at?Re=at:Re>ut&&(Re=ut)}if($){var Oe,Be;const je=fe==="y"?"width":"height",at=["top","left"].includes(Xd(L)),ut=N.reference[oe]-N.floating[je]+(at&&((Oe=G.offset)==null?void 0:Oe[oe])||0)+(at?0:ke.crossAxis),Xe=N.reference[oe]+N.reference[je]+(at?0:((Be=G.offset)==null?void 0:Be[oe])||0)-(at?ke.crossAxis:0);Ie<ut?Ie=ut:Ie>Xe&&(Ie=Xe)}return{[fe]:Re,[oe]:Ie}}}},KL=function(m){return m===void 0&&(m={}),{name:"size",options:m,async fn(b){var E,C;const{placement:L,rects:N,platform:G,elements:r}=b,{apply:Z=()=>{},...$}=Zd(m,b),ie=await Ty(b,$),oe=Xd(L),fe=Jg(L),Re=qd(L)==="y",{width:Ie,height:be}=N.floating;let ke,Oe;oe==="top"||oe==="bottom"?(ke=oe,Oe=fe===(await(G.isRTL==null?void 0:G.isRTL(r.floating))?"start":"end")?"left":"right"):(Oe=oe,ke=fe==="end"?"top":"bottom");const Be=be-ie.top-ie.bottom,je=Ie-ie.left-ie.right,at=Kf(be-ie[ke],Be),ut=Kf(Ie-ie[Oe],je),Xe=!b.middlewareData.shift;let Tt=at,vt=ut;if((E=b.middlewareData.shift)!=null&&E.enabled.x&&(vt=je),(C=b.middlewareData.shift)!=null&&C.enabled.y&&(Tt=Be),Xe&&!fe){const Pi=Hl(ie.left,0),xi=Hl(ie.right,0),Fi=Hl(ie.top,0),Ei=Hl(ie.bottom,0);Re?vt=Ie-2*(Pi!==0||xi!==0?Pi+xi:Hl(ie.left,ie.right)):Tt=be-2*(Fi!==0||Ei!==0?Fi+Ei:Hl(ie.top,ie.bottom))}await Z({...b,availableWidth:vt,availableHeight:Tt});const ni=await G.getDimensions(r.floating);return Ie!==ni.width||be!==ni.height?{reset:{rects:!0}}:{}}}};function L0(){return typeof window<"u"}function e_(m){return ME(m)?(m.nodeName||"").toLowerCase():"#document"}function ql(m){var b;return(m==null||(b=m.ownerDocument)==null?void 0:b.defaultView)||window}function Lh(m){var b;return(b=(ME(m)?m.ownerDocument:m.document)||window.document)==null?void 0:b.documentElement}function ME(m){return L0()?m instanceof Node||m instanceof ql(m).Node:!1}function Ou(m){return L0()?m instanceof Element||m instanceof ql(m).Element:!1}function Dh(m){return L0()?m instanceof HTMLElement||m instanceof ql(m).HTMLElement:!1}function sS(m){return!L0()||typeof ShadowRoot>"u"?!1:m instanceof ShadowRoot||m instanceof ql(m).ShadowRoot}function Ly(m){const{overflow:b,overflowX:E,overflowY:C,display:L}=ku(m);return/auto|scroll|overlay|hidden|clip/.test(b+C+E)&&!["inline","contents"].includes(L)}function QL(m){return["table","td","th"].includes(e_(m))}function O0(m){return[":popover-open",":modal"].some(b=>{try{return m.matches(b)}catch{return!1}})}function v1(m){const b=x1(),E=Ou(m)?ku(m):m;return["transform","translate","scale","rotate","perspective"].some(C=>E[C]?E[C]!=="none":!1)||(E.containerType?E.containerType!=="normal":!1)||!b&&(E.backdropFilter?E.backdropFilter!=="none":!1)||!b&&(E.filter?E.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(C=>(E.willChange||"").includes(C))||["paint","layout","strict","content"].some(C=>(E.contain||"").includes(C))}function JL(m){let b=Qf(m);for(;Dh(b)&&!Xg(b);){if(v1(b))return b;if(O0(b))return null;b=Qf(b)}return null}function x1(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Xg(m){return["html","body","#document"].includes(e_(m))}function ku(m){return ql(m).getComputedStyle(m)}function k0(m){return Ou(m)?{scrollLeft:m.scrollLeft,scrollTop:m.scrollTop}:{scrollLeft:m.scrollX,scrollTop:m.scrollY}}function Qf(m){if(e_(m)==="html")return m;const b=m.assignedSlot||m.parentNode||sS(m)&&m.host||Lh(m);return sS(b)?b.host:b}function CE(m){const b=Qf(m);return Xg(b)?m.ownerDocument?m.ownerDocument.body:m.body:Dh(b)&&Ly(b)?b:CE(b)}function Sy(m,b,E){var C;b===void 0&&(b=[]),E===void 0&&(E=!0);const L=CE(m),N=L===((C=m.ownerDocument)==null?void 0:C.body),G=ql(L);if(N){const r=jb(G);return b.concat(G,G.visualViewport||[],Ly(L)?L:[],r&&E?Sy(r):[])}return b.concat(L,Sy(L,[],E))}function jb(m){return m.parent&&Object.getPrototypeOf(m.parent)?m.frameElement:null}function RE(m){const b=ku(m);let E=parseFloat(b.width)||0,C=parseFloat(b.height)||0;const L=Dh(m),N=L?m.offsetWidth:E,G=L?m.offsetHeight:C,r=y0(E)!==N||y0(C)!==G;return r&&(E=N,C=G),{width:E,height:C,$:r}}function b1(m){return Ou(m)?m:m.contextElement}function Gg(m){const b=b1(m);if(!Dh(b))return Rh(1);const E=b.getBoundingClientRect(),{width:C,height:L,$:N}=RE(b);let G=(N?y0(E.width):E.width)/C,r=(N?y0(E.height):E.height)/L;return(!G||!Number.isFinite(G))&&(G=1),(!r||!Number.isFinite(r))&&(r=1),{x:G,y:r}}const eO=Rh(0);function IE(m){const b=ql(m);return!x1()||!b.visualViewport?eO:{x:b.visualViewport.offsetLeft,y:b.visualViewport.offsetTop}}function tO(m,b,E){return b===void 0&&(b=!1),!E||b&&E!==ql(m)?!1:b}function Am(m,b,E,C){b===void 0&&(b=!1),E===void 0&&(E=!1);const L=m.getBoundingClientRect(),N=b1(m);let G=Rh(1);b&&(C?Ou(C)&&(G=Gg(C)):G=Gg(m));const r=tO(N,E,C)?IE(N):Rh(0);let Z=(L.left+r.x)/G.x,$=(L.top+r.y)/G.y,ie=L.width/G.x,oe=L.height/G.y;if(N){const fe=ql(N),Re=C&&Ou(C)?ql(C):C;let Ie=fe,be=jb(Ie);for(;be&&C&&Re!==Ie;){const ke=Gg(be),Oe=be.getBoundingClientRect(),Be=ku(be),je=Oe.left+(be.clientLeft+parseFloat(Be.paddingLeft))*ke.x,at=Oe.top+(be.clientTop+parseFloat(Be.paddingTop))*ke.y;Z*=ke.x,$*=ke.y,ie*=ke.x,oe*=ke.y,Z+=je,$+=at,Ie=ql(be),be=jb(Ie)}}return x0({width:ie,height:oe,x:Z,y:$})}function w1(m,b){const E=k0(m).scrollLeft;return b?b.left+E:Am(Lh(m)).left+E}function DE(m,b,E){E===void 0&&(E=!1);const C=m.getBoundingClientRect(),L=C.left+b.scrollLeft-(E?0:w1(m,C)),N=C.top+b.scrollTop;return{x:L,y:N}}function iO(m){let{elements:b,rect:E,offsetParent:C,strategy:L}=m;const N=L==="fixed",G=Lh(C),r=b?O0(b.floating):!1;if(C===G||r&&N)return E;let Z={scrollLeft:0,scrollTop:0},$=Rh(1);const ie=Rh(0),oe=Dh(C);if((oe||!oe&&!N)&&((e_(C)!=="body"||Ly(G))&&(Z=k0(C)),Dh(C))){const Re=Am(C);$=Gg(C),ie.x=Re.x+C.clientLeft,ie.y=Re.y+C.clientTop}const fe=G&&!oe&&!N?DE(G,Z,!0):Rh(0);return{width:E.width*$.x,height:E.height*$.y,x:E.x*$.x-Z.scrollLeft*$.x+ie.x+fe.x,y:E.y*$.y-Z.scrollTop*$.y+ie.y+fe.y}}function nO(m){return Array.from(m.getClientRects())}function rO(m){const b=Lh(m),E=k0(m),C=m.ownerDocument.body,L=Hl(b.scrollWidth,b.clientWidth,C.scrollWidth,C.clientWidth),N=Hl(b.scrollHeight,b.clientHeight,C.scrollHeight,C.clientHeight);let G=-E.scrollLeft+w1(m);const r=-E.scrollTop;return ku(C).direction==="rtl"&&(G+=Hl(b.clientWidth,C.clientWidth)-L),{width:L,height:N,x:G,y:r}}function aO(m,b){const E=ql(m),C=Lh(m),L=E.visualViewport;let N=C.clientWidth,G=C.clientHeight,r=0,Z=0;if(L){N=L.width,G=L.height;const $=x1();(!$||$&&b==="fixed")&&(r=L.offsetLeft,Z=L.offsetTop)}return{width:N,height:G,x:r,y:Z}}function oO(m,b){const E=Am(m,!0,b==="fixed"),C=E.top+m.clientTop,L=E.left+m.clientLeft,N=Dh(m)?Gg(m):Rh(1),G=m.clientWidth*N.x,r=m.clientHeight*N.y,Z=L*N.x,$=C*N.y;return{width:G,height:r,x:Z,y:$}}function lS(m,b,E){let C;if(b==="viewport")C=aO(m,E);else if(b==="document")C=rO(Lh(m));else if(Ou(b))C=oO(b,E);else{const L=IE(m);C={x:b.x-L.x,y:b.y-L.y,width:b.width,height:b.height}}return x0(C)}function zE(m,b){const E=Qf(m);return E===b||!Ou(E)||Xg(E)?!1:ku(E).position==="fixed"||zE(E,b)}function sO(m,b){const E=b.get(m);if(E)return E;let C=Sy(m,[],!1).filter(r=>Ou(r)&&e_(r)!=="body"),L=null;const N=ku(m).position==="fixed";let G=N?Qf(m):m;for(;Ou(G)&&!Xg(G);){const r=ku(G),Z=v1(G);!Z&&r.position==="fixed"&&(L=null),(N?!Z&&!L:!Z&&r.position==="static"&&!!L&&["absolute","fixed"].includes(L.position)||Ly(G)&&!Z&&zE(m,G))?C=C.filter(ie=>ie!==G):L=r,G=Qf(G)}return b.set(m,C),C}function lO(m){let{element:b,boundary:E,rootBoundary:C,strategy:L}=m;const G=[...E==="clippingAncestors"?O0(b)?[]:sO(b,this._c):[].concat(E),C],r=G[0],Z=G.reduce(($,ie)=>{const oe=lS(b,ie,L);return $.top=Hl(oe.top,$.top),$.right=Kf(oe.right,$.right),$.bottom=Kf(oe.bottom,$.bottom),$.left=Hl(oe.left,$.left),$},lS(b,r,L));return{width:Z.right-Z.left,height:Z.bottom-Z.top,x:Z.left,y:Z.top}}function cO(m){const{width:b,height:E}=RE(m);return{width:b,height:E}}function uO(m,b,E){const C=Dh(b),L=Lh(b),N=E==="fixed",G=Am(m,!0,N,b);let r={scrollLeft:0,scrollTop:0};const Z=Rh(0);function $(){Z.x=w1(L)}if(C||!C&&!N)if((e_(b)!=="body"||Ly(L))&&(r=k0(b)),C){const Re=Am(b,!0,N,b);Z.x=Re.x+b.clientLeft,Z.y=Re.y+b.clientTop}else L&&$();N&&!C&&L&&$();const ie=L&&!C&&!N?DE(L,r):Rh(0),oe=G.left+r.scrollLeft-Z.x-ie.x,fe=G.top+r.scrollTop-Z.y-ie.y;return{x:oe,y:fe,width:G.width,height:G.height}}function _b(m){return ku(m).position==="static"}function cS(m,b){if(!Dh(m)||ku(m).position==="fixed")return null;if(b)return b(m);let E=m.offsetParent;return Lh(m)===E&&(E=E.ownerDocument.body),E}function PE(m,b){const E=ql(m);if(O0(m))return E;if(!Dh(m)){let L=Qf(m);for(;L&&!Xg(L);){if(Ou(L)&&!_b(L))return L;L=Qf(L)}return E}let C=cS(m,b);for(;C&&QL(C)&&_b(C);)C=cS(C,b);return C&&Xg(C)&&_b(C)&&!v1(C)?E:C||JL(m)||E}const hO=async function(m){const b=this.getOffsetParent||PE,E=this.getDimensions,C=await E(m.floating);return{reference:uO(m.reference,await b(m.floating),m.strategy),floating:{x:0,y:0,width:C.width,height:C.height}}};function dO(m){return ku(m).direction==="rtl"}const fO={convertOffsetParentRelativeRectToViewportRelativeRect:iO,getDocumentElement:Lh,getClippingRect:lO,getOffsetParent:PE,getElementRects:hO,getClientRects:nO,getDimensions:cO,getScale:Gg,isElement:Ou,isRTL:dO};function LE(m,b){return m.x===b.x&&m.y===b.y&&m.width===b.width&&m.height===b.height}function pO(m,b){let E=null,C;const L=Lh(m);function N(){var r;clearTimeout(C),(r=E)==null||r.disconnect(),E=null}function G(r,Z){r===void 0&&(r=!1),Z===void 0&&(Z=1),N();const $=m.getBoundingClientRect(),{left:ie,top:oe,width:fe,height:Re}=$;if(r||b(),!fe||!Re)return;const Ie=Jv(oe),be=Jv(L.clientWidth-(ie+fe)),ke=Jv(L.clientHeight-(oe+Re)),Oe=Jv(ie),je={rootMargin:-Ie+"px "+-be+"px "+-ke+"px "+-Oe+"px",threshold:Hl(0,Kf(1,Z))||1};let at=!0;function ut(Xe){const Tt=Xe[0].intersectionRatio;if(Tt!==Z){if(!at)return G();Tt?G(!1,Tt):C=setTimeout(()=>{G(!1,1e-7)},1e3)}Tt===1&&!LE($,m.getBoundingClientRect())&&G(),at=!1}try{E=new IntersectionObserver(ut,{...je,root:L.ownerDocument})}catch{E=new IntersectionObserver(ut,je)}E.observe(m)}return G(!0),N}function mO(m,b,E,C){C===void 0&&(C={});const{ancestorScroll:L=!0,ancestorResize:N=!0,elementResize:G=typeof ResizeObserver=="function",layoutShift:r=typeof IntersectionObserver=="function",animationFrame:Z=!1}=C,$=b1(m),ie=L||N?[...$?Sy($):[],...Sy(b)]:[];ie.forEach(Oe=>{L&&Oe.addEventListener("scroll",E,{passive:!0}),N&&Oe.addEventListener("resize",E)});const oe=$&&r?pO($,E):null;let fe=-1,Re=null;G&&(Re=new ResizeObserver(Oe=>{let[Be]=Oe;Be&&Be.target===$&&Re&&(Re.unobserve(b),cancelAnimationFrame(fe),fe=requestAnimationFrame(()=>{var je;(je=Re)==null||je.observe(b)})),E()}),$&&!Z&&Re.observe($),Re.observe(b));let Ie,be=Z?Am(m):null;Z&&ke();function ke(){const Oe=Am(m);be&&!LE(be,Oe)&&E(),be=Oe,Ie=requestAnimationFrame(ke)}return E(),()=>{var Oe;ie.forEach(Be=>{L&&Be.removeEventListener("scroll",E),N&&Be.removeEventListener("resize",E)}),oe==null||oe(),(Oe=Re)==null||Oe.disconnect(),Re=null,Z&&cancelAnimationFrame(Ie)}}const gO=XL,_O=WL,yO=qL,vO=KL,xO=$L,uS=HL,bO=YL,wO=(m,b,E)=>{const C=new Map,L={platform:fO,...E},N={...L.platform,_c:C};return GL(m,b,{...L,platform:N})};var c0=typeof document<"u"?ne.useLayoutEffect:ne.useEffect;function b0(m,b){if(m===b)return!0;if(typeof m!=typeof b)return!1;if(typeof m=="function"&&m.toString()===b.toString())return!0;let E,C,L;if(m&&b&&typeof m=="object"){if(Array.isArray(m)){if(E=m.length,E!==b.length)return!1;for(C=E;C--!==0;)if(!b0(m[C],b[C]))return!1;return!0}if(L=Object.keys(m),E=L.length,E!==Object.keys(b).length)return!1;for(C=E;C--!==0;)if(!{}.hasOwnProperty.call(b,L[C]))return!1;for(C=E;C--!==0;){const N=L[C];if(!(N==="_owner"&&m.$$typeof)&&!b0(m[N],b[N]))return!1}return!0}return m!==m&&b!==b}function OE(m){return typeof window>"u"?1:(m.ownerDocument.defaultView||window).devicePixelRatio||1}function hS(m,b){const E=OE(m);return Math.round(b*E)/E}function yb(m){const b=ne.useRef(m);return c0(()=>{b.current=m}),b}function TO(m){m===void 0&&(m={});const{placement:b="bottom",strategy:E="absolute",middleware:C=[],platform:L,elements:{reference:N,floating:G}={},transform:r=!0,whileElementsMounted:Z,open:$}=m,[ie,oe]=ne.useState({x:0,y:0,strategy:E,placement:b,middlewareData:{},isPositioned:!1}),[fe,Re]=ne.useState(C);b0(fe,C)||Re(C);const[Ie,be]=ne.useState(null),[ke,Oe]=ne.useState(null),Be=ne.useCallback(_t=>{_t!==Xe.current&&(Xe.current=_t,be(_t))},[]),je=ne.useCallback(_t=>{_t!==Tt.current&&(Tt.current=_t,Oe(_t))},[]),at=N||Ie,ut=G||ke,Xe=ne.useRef(null),Tt=ne.useRef(null),vt=ne.useRef(ie),ni=Z!=null,Pi=yb(Z),xi=yb(L),Fi=yb($),Ei=ne.useCallback(()=>{if(!Xe.current||!Tt.current)return;const _t={placement:b,strategy:E,middleware:fe};xi.current&&(_t.platform=xi.current),wO(Xe.current,Tt.current,_t).then($t=>{const Fe={...$t,isPositioned:Fi.current!==!1};fi.current&&!b0(vt.current,Fe)&&(vt.current=Fe,Yg.flushSync(()=>{oe(Fe)}))})},[fe,b,E,xi,Fi]);c0(()=>{$===!1&&vt.current.isPositioned&&(vt.current.isPositioned=!1,oe(_t=>({..._t,isPositioned:!1})))},[$]);const fi=ne.useRef(!1);c0(()=>(fi.current=!0,()=>{fi.current=!1}),[]),c0(()=>{if(at&&(Xe.current=at),ut&&(Tt.current=ut),at&&ut){if(Pi.current)return Pi.current(at,ut,Ei);Ei()}},[at,ut,Ei,Pi,ni]);const yi=ne.useMemo(()=>({reference:Xe,floating:Tt,setReference:Be,setFloating:je}),[Be,je]),Je=ne.useMemo(()=>({reference:at,floating:ut}),[at,ut]),jt=ne.useMemo(()=>{const _t={position:E,left:0,top:0};if(!Je.floating)return _t;const $t=hS(Je.floating,ie.x),Fe=hS(Je.floating,ie.y);return r?{..._t,transform:"translate("+$t+"px, "+Fe+"px)",...OE(Je.floating)>=1.5&&{willChange:"transform"}}:{position:E,left:$t,top:Fe}},[E,r,Je.floating,ie.x,ie.y]);return ne.useMemo(()=>({...ie,update:Ei,refs:yi,elements:Je,floatingStyles:jt}),[ie,Ei,yi,Je,jt])}const SO=m=>{function b(E){return{}.hasOwnProperty.call(E,"current")}return{name:"arrow",options:m,fn(E){const{element:C,padding:L}=typeof m=="function"?m(E):m;return C&&b(C)?C.current!=null?uS({element:C.current,padding:L}).fn(E):{}:C?uS({element:C,padding:L}).fn(E):{}}}},EO=(m,b)=>({...gO(m),options:[m,b]}),AO=(m,b)=>({..._O(m),options:[m,b]}),MO=(m,b)=>({...bO(m),options:[m,b]}),CO=(m,b)=>({...yO(m),options:[m,b]}),RO=(m,b)=>({...vO(m),options:[m,b]}),IO=(m,b)=>({...xO(m),options:[m,b]}),DO=(m,b)=>({...SO(m),options:[m,b]});var zO="Arrow",kE=ne.forwardRef((m,b)=>{const{children:E,width:C=10,height:L=5,...N}=m;return H.jsx(ur.svg,{...N,ref:b,width:C,height:L,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:m.asChild?E:H.jsx("polygon",{points:"0,0 30,0 15,10"})})});kE.displayName=zO;var PO=kE;function LO(m){const[b,E]=ne.useState(void 0);return Ss(()=>{if(m){E({width:m.offsetWidth,height:m.offsetHeight});const C=new ResizeObserver(L=>{if(!Array.isArray(L)||!L.length)return;const N=L[0];let G,r;if("borderBoxSize"in N){const Z=N.borderBoxSize,$=Array.isArray(Z)?Z[0]:Z;G=$.inlineSize,r=$.blockSize}else G=m.offsetWidth,r=m.offsetHeight;E({width:G,height:r})});return C.observe(m,{box:"border-box"}),()=>C.unobserve(m)}else E(void 0)},[m]),b}var T1="Popper",[NE,N0]=Wd(T1),[OO,BE]=NE(T1),FE=m=>{const{__scopePopper:b,children:E}=m,[C,L]=ne.useState(null);return H.jsx(OO,{scope:b,anchor:C,onAnchorChange:L,children:E})};FE.displayName=T1;var jE="PopperAnchor",UE=ne.forwardRef((m,b)=>{const{__scopePopper:E,virtualRef:C,...L}=m,N=BE(jE,E),G=ne.useRef(null),r=Xr(b,G);return ne.useEffect(()=>{N.onAnchorChange((C==null?void 0:C.current)||G.current)}),C?null:H.jsx(ur.div,{...L,ref:r})});UE.displayName=jE;var S1="PopperContent",[kO,NO]=NE(S1),VE=ne.forwardRef((m,b)=>{var ri,Yi,Vi,rn,xn,_n;const{__scopePopper:E,side:C="bottom",sideOffset:L=0,align:N="center",alignOffset:G=0,arrowPadding:r=0,avoidCollisions:Z=!0,collisionBoundary:$=[],collisionPadding:ie=0,sticky:oe="partial",hideWhenDetached:fe=!1,updatePositionStrategy:Re="optimized",onPlaced:Ie,...be}=m,ke=BE(S1,E),[Oe,Be]=ne.useState(null),je=Xr(b,Rn=>Be(Rn)),[at,ut]=ne.useState(null),Xe=LO(at),Tt=(Xe==null?void 0:Xe.width)??0,vt=(Xe==null?void 0:Xe.height)??0,ni=C+(N!=="center"?"-"+N:""),Pi=typeof ie=="number"?ie:{top:0,right:0,bottom:0,left:0,...ie},xi=Array.isArray($)?$:[$],Fi=xi.length>0,Ei={padding:Pi,boundary:xi.filter(FO),altBoundary:Fi},{refs:fi,floatingStyles:yi,placement:Je,isPositioned:jt,middlewareData:_t}=TO({strategy:"fixed",placement:ni,whileElementsMounted:(...Rn)=>mO(...Rn,{animationFrame:Re==="always"}),elements:{reference:ke.anchor},middleware:[EO({mainAxis:L+vt,alignmentAxis:G}),Z&&AO({mainAxis:!0,crossAxis:!1,limiter:oe==="partial"?MO():void 0,...Ei}),Z&&CO({...Ei}),RO({...Ei,apply:({elements:Rn,rects:Jr,availableWidth:io,availableHeight:ea})=>{const{width:kr,height:is}=Jr.reference,la=Rn.floating.style;la.setProperty("--radix-popper-available-width",`${io}px`),la.setProperty("--radix-popper-available-height",`${ea}px`),la.setProperty("--radix-popper-anchor-width",`${kr}px`),la.setProperty("--radix-popper-anchor-height",`${is}px`)}}),at&&DO({element:at,padding:r}),jO({arrowWidth:Tt,arrowHeight:vt}),fe&&IO({strategy:"referenceHidden",...Ei})]}),[$t,Fe]=qE(Je),zt=Ih(Ie);Ss(()=>{jt&&(zt==null||zt())},[jt,zt]);const _i=(ri=_t.arrow)==null?void 0:ri.x,Jt=(Yi=_t.arrow)==null?void 0:Yi.y,bi=((Vi=_t.arrow)==null?void 0:Vi.centerOffset)!==0,[Ci,pi]=ne.useState();return Ss(()=>{Oe&&pi(window.getComputedStyle(Oe).zIndex)},[Oe]),H.jsx("div",{ref:fi.setFloating,"data-radix-popper-content-wrapper":"",style:{...yi,transform:jt?yi.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ci,"--radix-popper-transform-origin":[(rn=_t.transformOrigin)==null?void 0:rn.x,(xn=_t.transformOrigin)==null?void 0:xn.y].join(" "),...((_n=_t.hide)==null?void 0:_n.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:m.dir,children:H.jsx(kO,{scope:E,placedSide:$t,onArrowChange:ut,arrowX:_i,arrowY:Jt,shouldHideArrow:bi,children:H.jsx(ur.div,{"data-side":$t,"data-align":Fe,...be,ref:je,style:{...be.style,animation:jt?void 0:"none"}})})})});VE.displayName=S1;var GE="PopperArrow",BO={top:"bottom",right:"left",bottom:"top",left:"right"},HE=ne.forwardRef(function(b,E){const{__scopePopper:C,...L}=b,N=NO(GE,C),G=BO[N.placedSide];return H.jsx("span",{ref:N.onArrowChange,style:{position:"absolute",left:N.arrowX,top:N.arrowY,[G]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[N.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[N.placedSide],visibility:N.shouldHideArrow?"hidden":void 0},children:H.jsx(PO,{...L,ref:E,style:{...L.style,display:"block"}})})});HE.displayName=GE;function FO(m){return m!==null}var jO=m=>({name:"transformOrigin",options:m,fn(b){var ke,Oe,Be;const{placement:E,rects:C,middlewareData:L}=b,G=((ke=L.arrow)==null?void 0:ke.centerOffset)!==0,r=G?0:m.arrowWidth,Z=G?0:m.arrowHeight,[$,ie]=qE(E),oe={start:"0%",center:"50%",end:"100%"}[ie],fe=(((Oe=L.arrow)==null?void 0:Oe.x)??0)+r/2,Re=(((Be=L.arrow)==null?void 0:Be.y)??0)+Z/2;let Ie="",be="";return $==="bottom"?(Ie=G?oe:`${fe}px`,be=`${-Z}px`):$==="top"?(Ie=G?oe:`${fe}px`,be=`${C.floating.height+Z}px`):$==="right"?(Ie=`${-Z}px`,be=G?oe:`${Re}px`):$==="left"&&(Ie=`${C.floating.width+Z}px`,be=G?oe:`${Re}px`),{data:{x:Ie,y:be}}}});function qE(m){const[b,E="center"]=m.split("-");return[b,E]}var $E=FE,ZE=UE,XE=VE,WE=HE,UO="Portal",B0=ne.forwardRef((m,b)=>{var r;const{container:E,...C}=m,[L,N]=ne.useState(!1);Ss(()=>N(!0),[]);const G=E||L&&((r=globalThis==null?void 0:globalThis.document)==null?void 0:r.body);return G?zz.createPortal(H.jsx(ur.div,{...C,ref:b}),G):null});B0.displayName=UO;var VO=wS[" useInsertionEffect ".trim().toString()]||Ss;function Wg({prop:m,defaultProp:b,onChange:E=()=>{},caller:C}){const[L,N,G]=GO({defaultProp:b,onChange:E}),r=m!==void 0,Z=r?m:L;{const ie=ne.useRef(m!==void 0);ne.useEffect(()=>{const oe=ie.current;oe!==r&&console.warn(`${C} is changing from ${oe?"controlled":"uncontrolled"} to ${r?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),ie.current=r},[r,C])}const $=ne.useCallback(ie=>{var oe;if(r){const fe=HO(ie)?ie(m):ie;fe!==m&&((oe=G.current)==null||oe.call(G,fe))}else N(ie)},[r,m,N,G]);return[Z,$]}function GO({defaultProp:m,onChange:b}){const[E,C]=ne.useState(m),L=ne.useRef(E),N=ne.useRef(b);return VO(()=>{N.current=b},[b]),ne.useEffect(()=>{var G;L.current!==E&&((G=N.current)==null||G.call(N,E),L.current=E)},[E,L]),[E,C,N]}function HO(m){return typeof m=="function"}function qO(m){const b=ne.useRef({value:m,previous:m});return ne.useMemo(()=>(b.current.value!==m&&(b.current.previous=b.current.value,b.current.value=m),b.current.previous),[m])}var YE=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),$O="VisuallyHidden",ZO=ne.forwardRef((m,b)=>H.jsx(ur.span,{...m,ref:b,style:{...YE,...m.style}}));ZO.displayName=$O;var XO=function(m){if(typeof document>"u")return null;var b=Array.isArray(m)?m[0]:m;return b.ownerDocument.body},kg=new WeakMap,e0=new WeakMap,t0={},vb=0,KE=function(m){return m&&(m.host||KE(m.parentNode))},WO=function(m,b){return b.map(function(E){if(m.contains(E))return E;var C=KE(E);return C&&m.contains(C)?C:(console.error("aria-hidden",E,"in not contained inside",m,". Doing nothing"),null)}).filter(function(E){return!!E})},YO=function(m,b,E,C){var L=WO(b,Array.isArray(m)?m:[m]);t0[E]||(t0[E]=new WeakMap);var N=t0[E],G=[],r=new Set,Z=new Set(L),$=function(oe){!oe||r.has(oe)||(r.add(oe),$(oe.parentNode))};L.forEach($);var ie=function(oe){!oe||Z.has(oe)||Array.prototype.forEach.call(oe.children,function(fe){if(r.has(fe))ie(fe);else try{var Re=fe.getAttribute(C),Ie=Re!==null&&Re!=="false",be=(kg.get(fe)||0)+1,ke=(N.get(fe)||0)+1;kg.set(fe,be),N.set(fe,ke),G.push(fe),be===1&&Ie&&e0.set(fe,!0),ke===1&&fe.setAttribute(E,"true"),Ie||fe.setAttribute(C,"true")}catch(Oe){console.error("aria-hidden: cannot operate on ",fe,Oe)}})};return ie(b),r.clear(),vb++,function(){G.forEach(function(oe){var fe=kg.get(oe)-1,Re=N.get(oe)-1;kg.set(oe,fe),N.set(oe,Re),fe||(e0.has(oe)||oe.removeAttribute(C),e0.delete(oe)),Re||oe.removeAttribute(E)}),vb--,vb||(kg=new WeakMap,kg=new WeakMap,e0=new WeakMap,t0={})}},E1=function(m,b,E){E===void 0&&(E="data-aria-hidden");var C=Array.from(Array.isArray(m)?m:[m]),L=XO(m);return L?(C.push.apply(C,Array.from(L.querySelectorAll("[aria-live]"))),YO(C,L,E,"aria-hidden")):function(){return null}},Ah=function(){return Ah=Object.assign||function(b){for(var E,C=1,L=arguments.length;C<L;C++){E=arguments[C];for(var N in E)Object.prototype.hasOwnProperty.call(E,N)&&(b[N]=E[N])}return b},Ah.apply(this,arguments)};function QE(m,b){var E={};for(var C in m)Object.prototype.hasOwnProperty.call(m,C)&&b.indexOf(C)<0&&(E[C]=m[C]);if(m!=null&&typeof Object.getOwnPropertySymbols=="function")for(var L=0,C=Object.getOwnPropertySymbols(m);L<C.length;L++)b.indexOf(C[L])<0&&Object.prototype.propertyIsEnumerable.call(m,C[L])&&(E[C[L]]=m[C[L]]);return E}function KO(m,b,E){if(E||arguments.length===2)for(var C=0,L=b.length,N;C<L;C++)(N||!(C in b))&&(N||(N=Array.prototype.slice.call(b,0,C)),N[C]=b[C]);return m.concat(N||Array.prototype.slice.call(b))}var u0="right-scroll-bar-position",h0="width-before-scroll-bar",QO="with-scroll-bars-hidden",JO="--removed-body-scroll-bar-size";function xb(m,b){return typeof m=="function"?m(b):m&&(m.current=b),m}function ek(m,b){var E=ne.useState(function(){return{value:m,callback:b,facade:{get current(){return E.value},set current(C){var L=E.value;L!==C&&(E.value=C,E.callback(C,L))}}}})[0];return E.callback=b,E.facade}var tk=typeof window<"u"?ne.useLayoutEffect:ne.useEffect,dS=new WeakMap;function ik(m,b){var E=ek(null,function(C){return m.forEach(function(L){return xb(L,C)})});return tk(function(){var C=dS.get(E);if(C){var L=new Set(C),N=new Set(m),G=E.current;L.forEach(function(r){N.has(r)||xb(r,null)}),N.forEach(function(r){L.has(r)||xb(r,G)})}dS.set(E,m)},[m]),E}function nk(m){return m}function rk(m,b){b===void 0&&(b=nk);var E=[],C=!1,L={read:function(){if(C)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return E.length?E[E.length-1]:m},useMedium:function(N){var G=b(N,C);return E.push(G),function(){E=E.filter(function(r){return r!==G})}},assignSyncMedium:function(N){for(C=!0;E.length;){var G=E;E=[],G.forEach(N)}E={push:function(r){return N(r)},filter:function(){return E}}},assignMedium:function(N){C=!0;var G=[];if(E.length){var r=E;E=[],r.forEach(N),G=E}var Z=function(){var ie=G;G=[],ie.forEach(N)},$=function(){return Promise.resolve().then(Z)};$(),E={push:function(ie){G.push(ie),$()},filter:function(ie){return G=G.filter(ie),E}}}};return L}function ak(m){m===void 0&&(m={});var b=rk(null);return b.options=Ah({async:!0,ssr:!1},m),b}var JE=function(m){var b=m.sideCar,E=QE(m,["sideCar"]);if(!b)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var C=b.read();if(!C)throw new Error("Sidecar medium not found");return ne.createElement(C,Ah({},E))};JE.isSideCarExport=!0;function ok(m,b){return m.useMedium(b),JE}var eA=ak(),bb=function(){},F0=ne.forwardRef(function(m,b){var E=ne.useRef(null),C=ne.useState({onScrollCapture:bb,onWheelCapture:bb,onTouchMoveCapture:bb}),L=C[0],N=C[1],G=m.forwardProps,r=m.children,Z=m.className,$=m.removeScrollBar,ie=m.enabled,oe=m.shards,fe=m.sideCar,Re=m.noIsolation,Ie=m.inert,be=m.allowPinchZoom,ke=m.as,Oe=ke===void 0?"div":ke,Be=m.gapMode,je=QE(m,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),at=fe,ut=ik([E,b]),Xe=Ah(Ah({},je),L);return ne.createElement(ne.Fragment,null,ie&&ne.createElement(at,{sideCar:eA,removeScrollBar:$,shards:oe,noIsolation:Re,inert:Ie,setCallbacks:N,allowPinchZoom:!!be,lockRef:E,gapMode:Be}),G?ne.cloneElement(ne.Children.only(r),Ah(Ah({},Xe),{ref:ut})):ne.createElement(Oe,Ah({},Xe,{className:Z,ref:ut}),r))});F0.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};F0.classNames={fullWidth:h0,zeroRight:u0};var sk=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function lk(){if(!document)return null;var m=document.createElement("style");m.type="text/css";var b=sk();return b&&m.setAttribute("nonce",b),m}function ck(m,b){m.styleSheet?m.styleSheet.cssText=b:m.appendChild(document.createTextNode(b))}function uk(m){var b=document.head||document.getElementsByTagName("head")[0];b.appendChild(m)}var hk=function(){var m=0,b=null;return{add:function(E){m==0&&(b=lk())&&(ck(b,E),uk(b)),m++},remove:function(){m--,!m&&b&&(b.parentNode&&b.parentNode.removeChild(b),b=null)}}},dk=function(){var m=hk();return function(b,E){ne.useEffect(function(){return m.add(b),function(){m.remove()}},[b&&E])}},tA=function(){var m=dk(),b=function(E){var C=E.styles,L=E.dynamic;return m(C,L),null};return b},fk={left:0,top:0,right:0,gap:0},wb=function(m){return parseInt(m||"",10)||0},pk=function(m){var b=window.getComputedStyle(document.body),E=b[m==="padding"?"paddingLeft":"marginLeft"],C=b[m==="padding"?"paddingTop":"marginTop"],L=b[m==="padding"?"paddingRight":"marginRight"];return[wb(E),wb(C),wb(L)]},mk=function(m){if(m===void 0&&(m="margin"),typeof window>"u")return fk;var b=pk(m),E=document.documentElement.clientWidth,C=window.innerWidth;return{left:b[0],top:b[1],right:b[2],gap:Math.max(0,C-E+b[2]-b[0])}},gk=tA(),Hg="data-scroll-locked",_k=function(m,b,E,C){var L=m.left,N=m.top,G=m.right,r=m.gap;return E===void 0&&(E="margin"),`
  .`.concat(QO,` {
   overflow: hidden `).concat(C,`;
   padding-right: `).concat(r,"px ").concat(C,`;
  }
  body[`).concat(Hg,`] {
    overflow: hidden `).concat(C,`;
    overscroll-behavior: contain;
    `).concat([b&&"position: relative ".concat(C,";"),E==="margin"&&`
    padding-left: `.concat(L,`px;
    padding-top: `).concat(N,`px;
    padding-right: `).concat(G,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(r,"px ").concat(C,`;
    `),E==="padding"&&"padding-right: ".concat(r,"px ").concat(C,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(u0,` {
    right: `).concat(r,"px ").concat(C,`;
  }
  
  .`).concat(h0,` {
    margin-right: `).concat(r,"px ").concat(C,`;
  }
  
  .`).concat(u0," .").concat(u0,` {
    right: 0 `).concat(C,`;
  }
  
  .`).concat(h0," .").concat(h0,` {
    margin-right: 0 `).concat(C,`;
  }
  
  body[`).concat(Hg,`] {
    `).concat(JO,": ").concat(r,`px;
  }
`)},fS=function(){var m=parseInt(document.body.getAttribute(Hg)||"0",10);return isFinite(m)?m:0},yk=function(){ne.useEffect(function(){return document.body.setAttribute(Hg,(fS()+1).toString()),function(){var m=fS()-1;m<=0?document.body.removeAttribute(Hg):document.body.setAttribute(Hg,m.toString())}},[])},vk=function(m){var b=m.noRelative,E=m.noImportant,C=m.gapMode,L=C===void 0?"margin":C;yk();var N=ne.useMemo(function(){return mk(L)},[L]);return ne.createElement(gk,{styles:_k(N,!b,L,E?"":"!important")})},Ub=!1;if(typeof window<"u")try{var i0=Object.defineProperty({},"passive",{get:function(){return Ub=!0,!0}});window.addEventListener("test",i0,i0),window.removeEventListener("test",i0,i0)}catch{Ub=!1}var Ng=Ub?{passive:!1}:!1,xk=function(m){return m.tagName==="TEXTAREA"},iA=function(m,b){if(!(m instanceof Element))return!1;var E=window.getComputedStyle(m);return E[b]!=="hidden"&&!(E.overflowY===E.overflowX&&!xk(m)&&E[b]==="visible")},bk=function(m){return iA(m,"overflowY")},wk=function(m){return iA(m,"overflowX")},pS=function(m,b){var E=b.ownerDocument,C=b;do{typeof ShadowRoot<"u"&&C instanceof ShadowRoot&&(C=C.host);var L=nA(m,C);if(L){var N=rA(m,C),G=N[1],r=N[2];if(G>r)return!0}C=C.parentNode}while(C&&C!==E.body);return!1},Tk=function(m){var b=m.scrollTop,E=m.scrollHeight,C=m.clientHeight;return[b,E,C]},Sk=function(m){var b=m.scrollLeft,E=m.scrollWidth,C=m.clientWidth;return[b,E,C]},nA=function(m,b){return m==="v"?bk(b):wk(b)},rA=function(m,b){return m==="v"?Tk(b):Sk(b)},Ek=function(m,b){return m==="h"&&b==="rtl"?-1:1},Ak=function(m,b,E,C,L){var N=Ek(m,window.getComputedStyle(b).direction),G=N*C,r=E.target,Z=b.contains(r),$=!1,ie=G>0,oe=0,fe=0;do{var Re=rA(m,r),Ie=Re[0],be=Re[1],ke=Re[2],Oe=be-ke-N*Ie;(Ie||Oe)&&nA(m,r)&&(oe+=Oe,fe+=Ie),r instanceof ShadowRoot?r=r.host:r=r.parentNode}while(!Z&&r!==document.body||Z&&(b.contains(r)||b===r));return(ie&&Math.abs(oe)<1||!ie&&Math.abs(fe)<1)&&($=!0),$},n0=function(m){return"changedTouches"in m?[m.changedTouches[0].clientX,m.changedTouches[0].clientY]:[0,0]},mS=function(m){return[m.deltaX,m.deltaY]},gS=function(m){return m&&"current"in m?m.current:m},Mk=function(m,b){return m[0]===b[0]&&m[1]===b[1]},Ck=function(m){return`
  .block-interactivity-`.concat(m,` {pointer-events: none;}
  .allow-interactivity-`).concat(m,` {pointer-events: all;}
`)},Rk=0,Bg=[];function Ik(m){var b=ne.useRef([]),E=ne.useRef([0,0]),C=ne.useRef(),L=ne.useState(Rk++)[0],N=ne.useState(tA)[0],G=ne.useRef(m);ne.useEffect(function(){G.current=m},[m]),ne.useEffect(function(){if(m.inert){document.body.classList.add("block-interactivity-".concat(L));var be=KO([m.lockRef.current],(m.shards||[]).map(gS),!0).filter(Boolean);return be.forEach(function(ke){return ke.classList.add("allow-interactivity-".concat(L))}),function(){document.body.classList.remove("block-interactivity-".concat(L)),be.forEach(function(ke){return ke.classList.remove("allow-interactivity-".concat(L))})}}},[m.inert,m.lockRef.current,m.shards]);var r=ne.useCallback(function(be,ke){if("touches"in be&&be.touches.length===2||be.type==="wheel"&&be.ctrlKey)return!G.current.allowPinchZoom;var Oe=n0(be),Be=E.current,je="deltaX"in be?be.deltaX:Be[0]-Oe[0],at="deltaY"in be?be.deltaY:Be[1]-Oe[1],ut,Xe=be.target,Tt=Math.abs(je)>Math.abs(at)?"h":"v";if("touches"in be&&Tt==="h"&&Xe.type==="range")return!1;var vt=pS(Tt,Xe);if(!vt)return!0;if(vt?ut=Tt:(ut=Tt==="v"?"h":"v",vt=pS(Tt,Xe)),!vt)return!1;if(!C.current&&"changedTouches"in be&&(je||at)&&(C.current=ut),!ut)return!0;var ni=C.current||ut;return Ak(ni,ke,be,ni==="h"?je:at)},[]),Z=ne.useCallback(function(be){var ke=be;if(!(!Bg.length||Bg[Bg.length-1]!==N)){var Oe="deltaY"in ke?mS(ke):n0(ke),Be=b.current.filter(function(ut){return ut.name===ke.type&&(ut.target===ke.target||ke.target===ut.shadowParent)&&Mk(ut.delta,Oe)})[0];if(Be&&Be.should){ke.cancelable&&ke.preventDefault();return}if(!Be){var je=(G.current.shards||[]).map(gS).filter(Boolean).filter(function(ut){return ut.contains(ke.target)}),at=je.length>0?r(ke,je[0]):!G.current.noIsolation;at&&ke.cancelable&&ke.preventDefault()}}},[]),$=ne.useCallback(function(be,ke,Oe,Be){var je={name:be,delta:ke,target:Oe,should:Be,shadowParent:Dk(Oe)};b.current.push(je),setTimeout(function(){b.current=b.current.filter(function(at){return at!==je})},1)},[]),ie=ne.useCallback(function(be){E.current=n0(be),C.current=void 0},[]),oe=ne.useCallback(function(be){$(be.type,mS(be),be.target,r(be,m.lockRef.current))},[]),fe=ne.useCallback(function(be){$(be.type,n0(be),be.target,r(be,m.lockRef.current))},[]);ne.useEffect(function(){return Bg.push(N),m.setCallbacks({onScrollCapture:oe,onWheelCapture:oe,onTouchMoveCapture:fe}),document.addEventListener("wheel",Z,Ng),document.addEventListener("touchmove",Z,Ng),document.addEventListener("touchstart",ie,Ng),function(){Bg=Bg.filter(function(be){return be!==N}),document.removeEventListener("wheel",Z,Ng),document.removeEventListener("touchmove",Z,Ng),document.removeEventListener("touchstart",ie,Ng)}},[]);var Re=m.removeScrollBar,Ie=m.inert;return ne.createElement(ne.Fragment,null,Ie?ne.createElement(N,{styles:Ck(L)}):null,Re?ne.createElement(vk,{gapMode:m.gapMode}):null)}function Dk(m){for(var b=null;m!==null;)m instanceof ShadowRoot&&(b=m.host,m=m.host),m=m.parentNode;return b}const zk=ok(eA,Ik);var j0=ne.forwardRef(function(m,b){return ne.createElement(F0,Ah({},m,{ref:b,sideCar:zk}))});j0.classNames=F0.classNames;var Pk=[" ","Enter","ArrowUp","ArrowDown"],Lk=[" ","Enter"],Mm="Select",[U0,V0,Ok]=p1(Mm),[t_,yF]=Wd(Mm,[Ok,N0]),G0=N0(),[kk,np]=t_(Mm),[Nk,Bk]=t_(Mm),aA=m=>{const{__scopeSelect:b,children:E,open:C,defaultOpen:L,onOpenChange:N,value:G,defaultValue:r,onValueChange:Z,dir:$,name:ie,autoComplete:oe,disabled:fe,required:Re,form:Ie}=m,be=G0(b),[ke,Oe]=ne.useState(null),[Be,je]=ne.useState(null),[at,ut]=ne.useState(!1),Xe=D0($),[Tt,vt]=Wg({prop:C,defaultProp:L??!1,onChange:N,caller:Mm}),[ni,Pi]=Wg({prop:G,defaultProp:r,onChange:Z,caller:Mm}),xi=ne.useRef(null),Fi=ke?Ie||!!ke.closest("form"):!0,[Ei,fi]=ne.useState(new Set),yi=Array.from(Ei).map(Je=>Je.props.value).join(";");return H.jsx($E,{...be,children:H.jsxs(kk,{required:Re,scope:b,trigger:ke,onTriggerChange:Oe,valueNode:Be,onValueNodeChange:je,valueNodeHasChildren:at,onValueNodeHasChildrenChange:ut,contentId:Ch(),value:ni,onValueChange:Pi,open:Tt,onOpenChange:vt,dir:Xe,triggerPointerDownPosRef:xi,disabled:fe,children:[H.jsx(U0.Provider,{scope:b,children:H.jsx(Nk,{scope:m.__scopeSelect,onNativeOptionAdd:ne.useCallback(Je=>{fi(jt=>new Set(jt).add(Je))},[]),onNativeOptionRemove:ne.useCallback(Je=>{fi(jt=>{const _t=new Set(jt);return _t.delete(Je),_t})},[]),children:E})}),Fi?H.jsxs(MA,{"aria-hidden":!0,required:Re,tabIndex:-1,name:ie,autoComplete:oe,value:ni,onChange:Je=>Pi(Je.target.value),disabled:fe,form:Ie,children:[ni===void 0?H.jsx("option",{value:""}):null,Array.from(Ei)]},yi):null]})})};aA.displayName=Mm;var oA="SelectTrigger",sA=ne.forwardRef((m,b)=>{const{__scopeSelect:E,disabled:C=!1,...L}=m,N=G0(E),G=np(oA,E),r=G.disabled||C,Z=Xr(b,G.onTriggerChange),$=V0(E),ie=ne.useRef("touch"),[oe,fe,Re]=RA(be=>{const ke=$().filter(je=>!je.disabled),Oe=ke.find(je=>je.value===G.value),Be=IA(ke,be,Oe);Be!==void 0&&G.onValueChange(Be.value)}),Ie=be=>{r||(G.onOpenChange(!0),Re()),be&&(G.triggerPointerDownPosRef.current={x:Math.round(be.pageX),y:Math.round(be.pageY)})};return H.jsx(ZE,{asChild:!0,...N,children:H.jsx(ur.button,{type:"button",role:"combobox","aria-controls":G.contentId,"aria-expanded":G.open,"aria-required":G.required,"aria-autocomplete":"none",dir:G.dir,"data-state":G.open?"open":"closed",disabled:r,"data-disabled":r?"":void 0,"data-placeholder":CA(G.value)?"":void 0,...L,ref:Z,onClick:pn(L.onClick,be=>{be.currentTarget.focus(),ie.current!=="mouse"&&Ie(be)}),onPointerDown:pn(L.onPointerDown,be=>{ie.current=be.pointerType;const ke=be.target;ke.hasPointerCapture(be.pointerId)&&ke.releasePointerCapture(be.pointerId),be.button===0&&be.ctrlKey===!1&&be.pointerType==="mouse"&&(Ie(be),be.preventDefault())}),onKeyDown:pn(L.onKeyDown,be=>{const ke=oe.current!=="";!(be.ctrlKey||be.altKey||be.metaKey)&&be.key.length===1&&fe(be.key),!(ke&&be.key===" ")&&Pk.includes(be.key)&&(Ie(),be.preventDefault())})})})});sA.displayName=oA;var lA="SelectValue",cA=ne.forwardRef((m,b)=>{const{__scopeSelect:E,className:C,style:L,children:N,placeholder:G="",...r}=m,Z=np(lA,E),{onValueNodeHasChildrenChange:$}=Z,ie=N!==void 0,oe=Xr(b,Z.onValueNodeChange);return Ss(()=>{$(ie)},[$,ie]),H.jsx(ur.span,{...r,ref:oe,style:{pointerEvents:"none"},children:CA(Z.value)?H.jsx(H.Fragment,{children:G}):N})});cA.displayName=lA;var Fk="SelectIcon",uA=ne.forwardRef((m,b)=>{const{__scopeSelect:E,children:C,...L}=m;return H.jsx(ur.span,{"aria-hidden":!0,...L,ref:b,children:C||""})});uA.displayName=Fk;var jk="SelectPortal",hA=m=>H.jsx(B0,{asChild:!0,...m});hA.displayName=jk;var Cm="SelectContent",dA=ne.forwardRef((m,b)=>{const E=np(Cm,m.__scopeSelect),[C,L]=ne.useState();if(Ss(()=>{L(new DocumentFragment)},[]),!E.open){const N=C;return N?Yg.createPortal(H.jsx(fA,{scope:m.__scopeSelect,children:H.jsx(U0.Slot,{scope:m.__scopeSelect,children:H.jsx("div",{children:m.children})})}),N):null}return H.jsx(pA,{...m,ref:b})});dA.displayName=Cm;var Pu=10,[fA,rp]=t_(Cm),Uk="SelectContentImpl",Vk=Em("SelectContent.RemoveScroll"),pA=ne.forwardRef((m,b)=>{const{__scopeSelect:E,position:C="item-aligned",onCloseAutoFocus:L,onEscapeKeyDown:N,onPointerDownOutside:G,side:r,sideOffset:Z,align:$,alignOffset:ie,arrowPadding:oe,collisionBoundary:fe,collisionPadding:Re,sticky:Ie,hideWhenDetached:be,avoidCollisions:ke,...Oe}=m,Be=np(Cm,E),[je,at]=ne.useState(null),[ut,Xe]=ne.useState(null),Tt=Xr(b,ri=>at(ri)),[vt,ni]=ne.useState(null),[Pi,xi]=ne.useState(null),Fi=V0(E),[Ei,fi]=ne.useState(!1),yi=ne.useRef(!1);ne.useEffect(()=>{if(je)return E1(je)},[je]),m1();const Je=ne.useCallback(ri=>{const[Yi,...Vi]=Fi().map(_n=>_n.ref.current),[rn]=Vi.slice(-1),xn=document.activeElement;for(const _n of ri)if(_n===xn||(_n==null||_n.scrollIntoView({block:"nearest"}),_n===Yi&&ut&&(ut.scrollTop=0),_n===rn&&ut&&(ut.scrollTop=ut.scrollHeight),_n==null||_n.focus(),document.activeElement!==xn))return},[Fi,ut]),jt=ne.useCallback(()=>Je([vt,je]),[Je,vt,je]);ne.useEffect(()=>{Ei&&jt()},[Ei,jt]);const{onOpenChange:_t,triggerPointerDownPosRef:$t}=Be;ne.useEffect(()=>{if(je){let ri={x:0,y:0};const Yi=rn=>{var xn,_n;ri={x:Math.abs(Math.round(rn.pageX)-(((xn=$t.current)==null?void 0:xn.x)??0)),y:Math.abs(Math.round(rn.pageY)-(((_n=$t.current)==null?void 0:_n.y)??0))}},Vi=rn=>{ri.x<=10&&ri.y<=10?rn.preventDefault():je.contains(rn.target)||_t(!1),document.removeEventListener("pointermove",Yi),$t.current=null};return $t.current!==null&&(document.addEventListener("pointermove",Yi),document.addEventListener("pointerup",Vi,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Yi),document.removeEventListener("pointerup",Vi,{capture:!0})}}},[je,_t,$t]),ne.useEffect(()=>{const ri=()=>_t(!1);return window.addEventListener("blur",ri),window.addEventListener("resize",ri),()=>{window.removeEventListener("blur",ri),window.removeEventListener("resize",ri)}},[_t]);const[Fe,zt]=RA(ri=>{const Yi=Fi().filter(xn=>!xn.disabled),Vi=Yi.find(xn=>xn.ref.current===document.activeElement),rn=IA(Yi,ri,Vi);rn&&setTimeout(()=>rn.ref.current.focus())}),_i=ne.useCallback((ri,Yi,Vi)=>{const rn=!yi.current&&!Vi;(Be.value!==void 0&&Be.value===Yi||rn)&&(ni(ri),rn&&(yi.current=!0))},[Be.value]),Jt=ne.useCallback(()=>je==null?void 0:je.focus(),[je]),bi=ne.useCallback((ri,Yi,Vi)=>{const rn=!yi.current&&!Vi;(Be.value!==void 0&&Be.value===Yi||rn)&&xi(ri)},[Be.value]),Ci=C==="popper"?Vb:mA,pi=Ci===Vb?{side:r,sideOffset:Z,align:$,alignOffset:ie,arrowPadding:oe,collisionBoundary:fe,collisionPadding:Re,sticky:Ie,hideWhenDetached:be,avoidCollisions:ke}:{};return H.jsx(fA,{scope:E,content:je,viewport:ut,onViewportChange:Xe,itemRefCallback:_i,selectedItem:vt,onItemLeave:Jt,itemTextRefCallback:bi,focusSelectedItem:jt,selectedItemText:Pi,position:C,isPositioned:Ei,searchRef:Fe,children:H.jsx(j0,{as:Vk,allowPinchZoom:!0,children:H.jsx(P0,{asChild:!0,trapped:Be.open,onMountAutoFocus:ri=>{ri.preventDefault()},onUnmountAutoFocus:pn(L,ri=>{var Yi;(Yi=Be.trigger)==null||Yi.focus({preventScroll:!0}),ri.preventDefault()}),children:H.jsx(z0,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:N,onPointerDownOutside:G,onFocusOutside:ri=>ri.preventDefault(),onDismiss:()=>Be.onOpenChange(!1),children:H.jsx(Ci,{role:"listbox",id:Be.contentId,"data-state":Be.open?"open":"closed",dir:Be.dir,onContextMenu:ri=>ri.preventDefault(),...Oe,...pi,onPlaced:()=>fi(!0),ref:Tt,style:{display:"flex",flexDirection:"column",outline:"none",...Oe.style},onKeyDown:pn(Oe.onKeyDown,ri=>{const Yi=ri.ctrlKey||ri.altKey||ri.metaKey;if(ri.key==="Tab"&&ri.preventDefault(),!Yi&&ri.key.length===1&&zt(ri.key),["ArrowUp","ArrowDown","Home","End"].includes(ri.key)){let rn=Fi().filter(xn=>!xn.disabled).map(xn=>xn.ref.current);if(["ArrowUp","End"].includes(ri.key)&&(rn=rn.slice().reverse()),["ArrowUp","ArrowDown"].includes(ri.key)){const xn=ri.target,_n=rn.indexOf(xn);rn=rn.slice(_n+1)}setTimeout(()=>Je(rn)),ri.preventDefault()}})})})})})})});pA.displayName=Uk;var Gk="SelectItemAlignedPosition",mA=ne.forwardRef((m,b)=>{const{__scopeSelect:E,onPlaced:C,...L}=m,N=np(Cm,E),G=rp(Cm,E),[r,Z]=ne.useState(null),[$,ie]=ne.useState(null),oe=Xr(b,Tt=>ie(Tt)),fe=V0(E),Re=ne.useRef(!1),Ie=ne.useRef(!0),{viewport:be,selectedItem:ke,selectedItemText:Oe,focusSelectedItem:Be}=G,je=ne.useCallback(()=>{if(N.trigger&&N.valueNode&&r&&$&&be&&ke&&Oe){const Tt=N.trigger.getBoundingClientRect(),vt=$.getBoundingClientRect(),ni=N.valueNode.getBoundingClientRect(),Pi=Oe.getBoundingClientRect();if(N.dir!=="rtl"){const xn=Pi.left-vt.left,_n=ni.left-xn,Rn=Tt.left-_n,Jr=Tt.width+Rn,io=Math.max(Jr,vt.width),ea=window.innerWidth-Pu,kr=Y2(_n,[Pu,Math.max(Pu,ea-io)]);r.style.minWidth=Jr+"px",r.style.left=kr+"px"}else{const xn=vt.right-Pi.right,_n=window.innerWidth-ni.right-xn,Rn=window.innerWidth-Tt.right-_n,Jr=Tt.width+Rn,io=Math.max(Jr,vt.width),ea=window.innerWidth-Pu,kr=Y2(_n,[Pu,Math.max(Pu,ea-io)]);r.style.minWidth=Jr+"px",r.style.right=kr+"px"}const xi=fe(),Fi=window.innerHeight-Pu*2,Ei=be.scrollHeight,fi=window.getComputedStyle($),yi=parseInt(fi.borderTopWidth,10),Je=parseInt(fi.paddingTop,10),jt=parseInt(fi.borderBottomWidth,10),_t=parseInt(fi.paddingBottom,10),$t=yi+Je+Ei+_t+jt,Fe=Math.min(ke.offsetHeight*5,$t),zt=window.getComputedStyle(be),_i=parseInt(zt.paddingTop,10),Jt=parseInt(zt.paddingBottom,10),bi=Tt.top+Tt.height/2-Pu,Ci=Fi-bi,pi=ke.offsetHeight/2,ri=ke.offsetTop+pi,Yi=yi+Je+ri,Vi=$t-Yi;if(Yi<=bi){const xn=xi.length>0&&ke===xi[xi.length-1].ref.current;r.style.bottom="0px";const _n=$.clientHeight-be.offsetTop-be.offsetHeight,Rn=Math.max(Ci,pi+(xn?Jt:0)+_n+jt),Jr=Yi+Rn;r.style.height=Jr+"px"}else{const xn=xi.length>0&&ke===xi[0].ref.current;r.style.top="0px";const Rn=Math.max(bi,yi+be.offsetTop+(xn?_i:0)+pi)+Vi;r.style.height=Rn+"px",be.scrollTop=Yi-bi+be.offsetTop}r.style.margin=`${Pu}px 0`,r.style.minHeight=Fe+"px",r.style.maxHeight=Fi+"px",C==null||C(),requestAnimationFrame(()=>Re.current=!0)}},[fe,N.trigger,N.valueNode,r,$,be,ke,Oe,N.dir,C]);Ss(()=>je(),[je]);const[at,ut]=ne.useState();Ss(()=>{$&&ut(window.getComputedStyle($).zIndex)},[$]);const Xe=ne.useCallback(Tt=>{Tt&&Ie.current===!0&&(je(),Be==null||Be(),Ie.current=!1)},[je,Be]);return H.jsx(qk,{scope:E,contentWrapper:r,shouldExpandOnScrollRef:Re,onScrollButtonChange:Xe,children:H.jsx("div",{ref:Z,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:at},children:H.jsx(ur.div,{...L,ref:oe,style:{boxSizing:"border-box",maxHeight:"100%",...L.style}})})})});mA.displayName=Gk;var Hk="SelectPopperPosition",Vb=ne.forwardRef((m,b)=>{const{__scopeSelect:E,align:C="start",collisionPadding:L=Pu,...N}=m,G=G0(E);return H.jsx(XE,{...G,...N,ref:b,align:C,collisionPadding:L,style:{boxSizing:"border-box",...N.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Vb.displayName=Hk;var[qk,A1]=t_(Cm,{}),Gb="SelectViewport",gA=ne.forwardRef((m,b)=>{const{__scopeSelect:E,nonce:C,...L}=m,N=rp(Gb,E),G=A1(Gb,E),r=Xr(b,N.onViewportChange),Z=ne.useRef(0);return H.jsxs(H.Fragment,{children:[H.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:C}),H.jsx(U0.Slot,{scope:E,children:H.jsx(ur.div,{"data-radix-select-viewport":"",role:"presentation",...L,ref:r,style:{position:"relative",flex:1,overflow:"hidden auto",...L.style},onScroll:pn(L.onScroll,$=>{const ie=$.currentTarget,{contentWrapper:oe,shouldExpandOnScrollRef:fe}=G;if(fe!=null&&fe.current&&oe){const Re=Math.abs(Z.current-ie.scrollTop);if(Re>0){const Ie=window.innerHeight-Pu*2,be=parseFloat(oe.style.minHeight),ke=parseFloat(oe.style.height),Oe=Math.max(be,ke);if(Oe<Ie){const Be=Oe+Re,je=Math.min(Ie,Be),at=Be-je;oe.style.height=je+"px",oe.style.bottom==="0px"&&(ie.scrollTop=at>0?at:0,oe.style.justifyContent="flex-end")}}}Z.current=ie.scrollTop})})})]})});gA.displayName=Gb;var _A="SelectGroup",[$k,Zk]=t_(_A),Xk=ne.forwardRef((m,b)=>{const{__scopeSelect:E,...C}=m,L=Ch();return H.jsx($k,{scope:E,id:L,children:H.jsx(ur.div,{role:"group","aria-labelledby":L,...C,ref:b})})});Xk.displayName=_A;var yA="SelectLabel",Wk=ne.forwardRef((m,b)=>{const{__scopeSelect:E,...C}=m,L=Zk(yA,E);return H.jsx(ur.div,{id:L.id,...C,ref:b})});Wk.displayName=yA;var w0="SelectItem",[Yk,vA]=t_(w0),xA=ne.forwardRef((m,b)=>{const{__scopeSelect:E,value:C,disabled:L=!1,textValue:N,...G}=m,r=np(w0,E),Z=rp(w0,E),$=r.value===C,[ie,oe]=ne.useState(N??""),[fe,Re]=ne.useState(!1),Ie=Xr(b,Be=>{var je;return(je=Z.itemRefCallback)==null?void 0:je.call(Z,Be,C,L)}),be=Ch(),ke=ne.useRef("touch"),Oe=()=>{L||(r.onValueChange(C),r.onOpenChange(!1))};if(C==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return H.jsx(Yk,{scope:E,value:C,disabled:L,textId:be,isSelected:$,onItemTextChange:ne.useCallback(Be=>{oe(je=>je||((Be==null?void 0:Be.textContent)??"").trim())},[]),children:H.jsx(U0.ItemSlot,{scope:E,value:C,disabled:L,textValue:ie,children:H.jsx(ur.div,{role:"option","aria-labelledby":be,"data-highlighted":fe?"":void 0,"aria-selected":$&&fe,"data-state":$?"checked":"unchecked","aria-disabled":L||void 0,"data-disabled":L?"":void 0,tabIndex:L?void 0:-1,...G,ref:Ie,onFocus:pn(G.onFocus,()=>Re(!0)),onBlur:pn(G.onBlur,()=>Re(!1)),onClick:pn(G.onClick,()=>{ke.current!=="mouse"&&Oe()}),onPointerUp:pn(G.onPointerUp,()=>{ke.current==="mouse"&&Oe()}),onPointerDown:pn(G.onPointerDown,Be=>{ke.current=Be.pointerType}),onPointerMove:pn(G.onPointerMove,Be=>{var je;ke.current=Be.pointerType,L?(je=Z.onItemLeave)==null||je.call(Z):ke.current==="mouse"&&Be.currentTarget.focus({preventScroll:!0})}),onPointerLeave:pn(G.onPointerLeave,Be=>{var je;Be.currentTarget===document.activeElement&&((je=Z.onItemLeave)==null||je.call(Z))}),onKeyDown:pn(G.onKeyDown,Be=>{var at;((at=Z.searchRef)==null?void 0:at.current)!==""&&Be.key===" "||(Lk.includes(Be.key)&&Oe(),Be.key===" "&&Be.preventDefault())})})})})});xA.displayName=w0;var _y="SelectItemText",bA=ne.forwardRef((m,b)=>{const{__scopeSelect:E,className:C,style:L,...N}=m,G=np(_y,E),r=rp(_y,E),Z=vA(_y,E),$=Bk(_y,E),[ie,oe]=ne.useState(null),fe=Xr(b,Oe=>oe(Oe),Z.onItemTextChange,Oe=>{var Be;return(Be=r.itemTextRefCallback)==null?void 0:Be.call(r,Oe,Z.value,Z.disabled)}),Re=ie==null?void 0:ie.textContent,Ie=ne.useMemo(()=>H.jsx("option",{value:Z.value,disabled:Z.disabled,children:Re},Z.value),[Z.disabled,Z.value,Re]),{onNativeOptionAdd:be,onNativeOptionRemove:ke}=$;return Ss(()=>(be(Ie),()=>ke(Ie)),[be,ke,Ie]),H.jsxs(H.Fragment,{children:[H.jsx(ur.span,{id:Z.textId,...N,ref:fe}),Z.isSelected&&G.valueNode&&!G.valueNodeHasChildren?Yg.createPortal(N.children,G.valueNode):null]})});bA.displayName=_y;var wA="SelectItemIndicator",TA=ne.forwardRef((m,b)=>{const{__scopeSelect:E,...C}=m;return vA(wA,E).isSelected?H.jsx(ur.span,{"aria-hidden":!0,...C,ref:b}):null});TA.displayName=wA;var Hb="SelectScrollUpButton",SA=ne.forwardRef((m,b)=>{const E=rp(Hb,m.__scopeSelect),C=A1(Hb,m.__scopeSelect),[L,N]=ne.useState(!1),G=Xr(b,C.onScrollButtonChange);return Ss(()=>{if(E.viewport&&E.isPositioned){let r=function(){const $=Z.scrollTop>0;N($)};const Z=E.viewport;return r(),Z.addEventListener("scroll",r),()=>Z.removeEventListener("scroll",r)}},[E.viewport,E.isPositioned]),L?H.jsx(AA,{...m,ref:G,onAutoScroll:()=>{const{viewport:r,selectedItem:Z}=E;r&&Z&&(r.scrollTop=r.scrollTop-Z.offsetHeight)}}):null});SA.displayName=Hb;var qb="SelectScrollDownButton",EA=ne.forwardRef((m,b)=>{const E=rp(qb,m.__scopeSelect),C=A1(qb,m.__scopeSelect),[L,N]=ne.useState(!1),G=Xr(b,C.onScrollButtonChange);return Ss(()=>{if(E.viewport&&E.isPositioned){let r=function(){const $=Z.scrollHeight-Z.clientHeight,ie=Math.ceil(Z.scrollTop)<$;N(ie)};const Z=E.viewport;return r(),Z.addEventListener("scroll",r),()=>Z.removeEventListener("scroll",r)}},[E.viewport,E.isPositioned]),L?H.jsx(AA,{...m,ref:G,onAutoScroll:()=>{const{viewport:r,selectedItem:Z}=E;r&&Z&&(r.scrollTop=r.scrollTop+Z.offsetHeight)}}):null});EA.displayName=qb;var AA=ne.forwardRef((m,b)=>{const{__scopeSelect:E,onAutoScroll:C,...L}=m,N=rp("SelectScrollButton",E),G=ne.useRef(null),r=V0(E),Z=ne.useCallback(()=>{G.current!==null&&(window.clearInterval(G.current),G.current=null)},[]);return ne.useEffect(()=>()=>Z(),[Z]),Ss(()=>{var ie;const $=r().find(oe=>oe.ref.current===document.activeElement);(ie=$==null?void 0:$.ref.current)==null||ie.scrollIntoView({block:"nearest"})},[r]),H.jsx(ur.div,{"aria-hidden":!0,...L,ref:b,style:{flexShrink:0,...L.style},onPointerDown:pn(L.onPointerDown,()=>{G.current===null&&(G.current=window.setInterval(C,50))}),onPointerMove:pn(L.onPointerMove,()=>{var $;($=N.onItemLeave)==null||$.call(N),G.current===null&&(G.current=window.setInterval(C,50))}),onPointerLeave:pn(L.onPointerLeave,()=>{Z()})})}),Kk="SelectSeparator",Qk=ne.forwardRef((m,b)=>{const{__scopeSelect:E,...C}=m;return H.jsx(ur.div,{"aria-hidden":!0,...C,ref:b})});Qk.displayName=Kk;var $b="SelectArrow",Jk=ne.forwardRef((m,b)=>{const{__scopeSelect:E,...C}=m,L=G0(E),N=np($b,E),G=rp($b,E);return N.open&&G.position==="popper"?H.jsx(WE,{...L,...C,ref:b}):null});Jk.displayName=$b;var eN="SelectBubbleInput",MA=ne.forwardRef(({__scopeSelect:m,value:b,...E},C)=>{const L=ne.useRef(null),N=Xr(C,L),G=qO(b);return ne.useEffect(()=>{const r=L.current;if(!r)return;const Z=window.HTMLSelectElement.prototype,ie=Object.getOwnPropertyDescriptor(Z,"value").set;if(G!==b&&ie){const oe=new Event("change",{bubbles:!0});ie.call(r,b),r.dispatchEvent(oe)}},[G,b]),H.jsx(ur.select,{...E,style:{...YE,...E.style},ref:N,defaultValue:b})});MA.displayName=eN;function CA(m){return m===""||m===void 0}function RA(m){const b=Ih(m),E=ne.useRef(""),C=ne.useRef(0),L=ne.useCallback(G=>{const r=E.current+G;b(r),function Z($){E.current=$,window.clearTimeout(C.current),$!==""&&(C.current=window.setTimeout(()=>Z(""),1e3))}(r)},[b]),N=ne.useCallback(()=>{E.current="",window.clearTimeout(C.current)},[]);return ne.useEffect(()=>()=>window.clearTimeout(C.current),[]),[E,L,N]}function IA(m,b,E){const L=b.length>1&&Array.from(b).every($=>$===b[0])?b[0]:b,N=E?m.indexOf(E):-1;let G=tN(m,Math.max(N,0));L.length===1&&(G=G.filter($=>$!==E));const Z=G.find($=>$.textValue.toLowerCase().startsWith(L.toLowerCase()));return Z!==E?Z:void 0}function tN(m,b){return m.map((E,C)=>m[(b+C)%m.length])}var iN=aA,nN=sA,rN=cA,aN=uA,oN=hA,sN=dA,lN=gA,cN=xA,uN=bA,hN=TA,dN=SA,fN=EA;function pN({...m}){return H.jsx(iN,{"data-slot":"select",...m})}function mN({...m}){return H.jsx(rN,{"data-slot":"select-value",...m})}function gN({className:m,size:b="default",children:E,...C}){return H.jsxs(nN,{"data-slot":"select-trigger","data-size":b,className:Sr("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",m),...C,children:[E,H.jsx(aN,{asChild:!0,children:H.jsx(gE,{className:"size-4 opacity-50"})})]})}function _N({className:m,children:b,position:E="popper",...C}){return H.jsx(oN,{children:H.jsxs(sN,{"data-slot":"select-content",className:Sr("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",E==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",m),position:E,...C,children:[H.jsx(yN,{}),H.jsx(lN,{className:Sr("p-1",E==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:b}),H.jsx(vN,{})]})})}function _S({className:m,children:b,...E}){return H.jsxs(cN,{"data-slot":"select-item",className:Sr("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",m),...E,children:[H.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:H.jsx(hN,{children:H.jsx(w3,{className:"size-4"})})}),H.jsx(uN,{children:b})]})}function yN({className:m,...b}){return H.jsx(dN,{"data-slot":"select-scroll-up-button",className:Sr("flex cursor-default items-center justify-center py-1",m),...b,children:H.jsx(E3,{className:"size-4"})})}function vN({className:m,...b}){return H.jsx(fN,{"data-slot":"select-scroll-down-button",className:Sr("flex cursor-default items-center justify-center py-1",m),...b,children:H.jsx(gE,{className:"size-4"})})}function xN({onSearch:m,profiles:b}){const[E,C]=ne.useState(""),[L,N]=ne.useState("all"),[G,r]=ne.useState([]);ne.useEffect(()=>{if(b.length>0){const oe=Array.from(new Set(b.map(fe=>fe.location.country))).sort();r(oe)}},[b]);const Z=()=>{m(E,{country:L})},$=()=>{C(""),N("all"),m("",{country:"all"})},ie=oe=>{oe.key==="Enter"&&Z()};return H.jsx("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm",children:H.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[H.jsxs("div",{className:"relative flex-1",children:[H.jsx(kb,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),H.jsx(dl,{placeholder:"Search by name, city, or country...",value:E,onChange:oe=>C(oe.target.value),onKeyDown:ie,className:"pl-9"}),E&&H.jsxs("button",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",onClick:()=>C(""),children:[H.jsx(g0,{className:"h-4 w-4"}),H.jsx("span",{className:"sr-only",children:"Clear search"})]})]}),H.jsx("div",{className:"w-full md:w-[200px]",children:H.jsxs(pN,{value:L,onValueChange:N,children:[H.jsx(gN,{className:"cursor-pointer",children:H.jsx(mN,{placeholder:"Select country"})}),H.jsxs(_N,{children:[H.jsx(_S,{value:"all",children:"All Countries"}),G.map(oe=>H.jsx(_S,{className:"cursor-pointer",value:oe,children:oe},oe))]})]})}),H.jsxs("div",{className:"flex gap-2",children:[H.jsxs(ba,{onClick:Z,className:"flex-1 md:flex-none cursor-pointer",children:[H.jsx(kb,{className:"h-4 w-4 mr-2"}),"Search"]}),H.jsxs(ba,{variant:"outline",onClick:$,className:"flex-1 md:flex-none cursor-pointer",children:[H.jsx(g0,{className:"h-4 w-4 mr-2"}),"Reset"]})]})]})})}function bN(){const[m,b]=ne.useState(()=>localStorage.getItem("theme")||"light");ne.useEffect(()=>{document.documentElement.classList.toggle("dark",m==="dark"),localStorage.setItem("theme",m)},[m]);const E=()=>{b(C=>C==="light"?"dark":"light")};return H.jsxs(ba,{variant:"ghost",size:"icon",onClick:E,className:"transition-transform hover:scale-110 relative cursor-pointer",children:[H.jsx(Q3,{className:"h-[1.2rem] w-[1.2rem] transition-all transform dark:rotate-90 dark:scale-0"}),H.jsx(V3,{className:"absolute h-[1.2rem] w-[1.2rem] transition-all transform rotate-90 scale-0 dark:rotate-0 dark:scale-100"}),H.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}function wN(m,b){return ne.useReducer((E,C)=>b[E][C]??E,m)}var Yd=m=>{const{present:b,children:E}=m,C=TN(b),L=typeof E=="function"?E({present:C.isPresent}):ne.Children.only(E),N=Xr(C.ref,SN(L));return typeof E=="function"||C.isPresent?ne.cloneElement(L,{ref:N}):null};Yd.displayName="Presence";function TN(m){const[b,E]=ne.useState(),C=ne.useRef(null),L=ne.useRef(m),N=ne.useRef("none"),G=m?"mounted":"unmounted",[r,Z]=wN(G,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return ne.useEffect(()=>{const $=r0(C.current);N.current=r==="mounted"?$:"none"},[r]),Ss(()=>{const $=C.current,ie=L.current;if(ie!==m){const fe=N.current,Re=r0($);m?Z("MOUNT"):Re==="none"||($==null?void 0:$.display)==="none"?Z("UNMOUNT"):Z(ie&&fe!==Re?"ANIMATION_OUT":"UNMOUNT"),L.current=m}},[m,Z]),Ss(()=>{if(b){let $;const ie=b.ownerDocument.defaultView??window,oe=Re=>{const be=r0(C.current).includes(Re.animationName);if(Re.target===b&&be&&(Z("ANIMATION_END"),!L.current)){const ke=b.style.animationFillMode;b.style.animationFillMode="forwards",$=ie.setTimeout(()=>{b.style.animationFillMode==="forwards"&&(b.style.animationFillMode=ke)})}},fe=Re=>{Re.target===b&&(N.current=r0(C.current))};return b.addEventListener("animationstart",fe),b.addEventListener("animationcancel",oe),b.addEventListener("animationend",oe),()=>{ie.clearTimeout($),b.removeEventListener("animationstart",fe),b.removeEventListener("animationcancel",oe),b.removeEventListener("animationend",oe)}}else Z("ANIMATION_END")},[b,Z]),{isPresent:["mounted","unmountSuspended"].includes(r),ref:ne.useCallback($=>{C.current=$?getComputedStyle($):null,E($)},[])}}function r0(m){return(m==null?void 0:m.animationName)||"none"}function SN(m){var C,L;let b=(C=Object.getOwnPropertyDescriptor(m.props,"ref"))==null?void 0:C.get,E=b&&"isReactWarning"in b&&b.isReactWarning;return E?m.ref:(b=(L=Object.getOwnPropertyDescriptor(m,"ref"))==null?void 0:L.get,E=b&&"isReactWarning"in b&&b.isReactWarning,E?m.props.ref:m.props.ref||m.ref)}var H0="Dialog",[DA,zA]=Wd(H0),[EN,Nu]=DA(H0),PA=m=>{const{__scopeDialog:b,children:E,open:C,defaultOpen:L,onOpenChange:N,modal:G=!0}=m,r=ne.useRef(null),Z=ne.useRef(null),[$,ie]=Wg({prop:C,defaultProp:L??!1,onChange:N,caller:H0});return H.jsx(EN,{scope:b,triggerRef:r,contentRef:Z,contentId:Ch(),titleId:Ch(),descriptionId:Ch(),open:$,onOpenChange:ie,onOpenToggle:ne.useCallback(()=>ie(oe=>!oe),[ie]),modal:G,children:E})};PA.displayName=H0;var LA="DialogTrigger",OA=ne.forwardRef((m,b)=>{const{__scopeDialog:E,...C}=m,L=Nu(LA,E),N=Xr(b,L.triggerRef);return H.jsx(ur.button,{type:"button","aria-haspopup":"dialog","aria-expanded":L.open,"aria-controls":L.contentId,"data-state":R1(L.open),...C,ref:N,onClick:pn(m.onClick,L.onOpenToggle)})});OA.displayName=LA;var M1="DialogPortal",[AN,kA]=DA(M1,{forceMount:void 0}),NA=m=>{const{__scopeDialog:b,forceMount:E,children:C,container:L}=m,N=Nu(M1,b);return H.jsx(AN,{scope:b,forceMount:E,children:ne.Children.map(C,G=>H.jsx(Yd,{present:E||N.open,children:H.jsx(B0,{asChild:!0,container:L,children:G})}))})};NA.displayName=M1;var T0="DialogOverlay",BA=ne.forwardRef((m,b)=>{const E=kA(T0,m.__scopeDialog),{forceMount:C=E.forceMount,...L}=m,N=Nu(T0,m.__scopeDialog);return N.modal?H.jsx(Yd,{present:C||N.open,children:H.jsx(CN,{...L,ref:b})}):null});BA.displayName=T0;var MN=Em("DialogOverlay.RemoveScroll"),CN=ne.forwardRef((m,b)=>{const{__scopeDialog:E,...C}=m,L=Nu(T0,E);return H.jsx(j0,{as:MN,allowPinchZoom:!0,shards:[L.contentRef],children:H.jsx(ur.div,{"data-state":R1(L.open),...C,ref:b,style:{pointerEvents:"auto",...C.style}})})}),Rm="DialogContent",FA=ne.forwardRef((m,b)=>{const E=kA(Rm,m.__scopeDialog),{forceMount:C=E.forceMount,...L}=m,N=Nu(Rm,m.__scopeDialog);return H.jsx(Yd,{present:C||N.open,children:N.modal?H.jsx(RN,{...L,ref:b}):H.jsx(IN,{...L,ref:b})})});FA.displayName=Rm;var RN=ne.forwardRef((m,b)=>{const E=Nu(Rm,m.__scopeDialog),C=ne.useRef(null),L=Xr(b,E.contentRef,C);return ne.useEffect(()=>{const N=C.current;if(N)return E1(N)},[]),H.jsx(jA,{...m,ref:L,trapFocus:E.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:pn(m.onCloseAutoFocus,N=>{var G;N.preventDefault(),(G=E.triggerRef.current)==null||G.focus()}),onPointerDownOutside:pn(m.onPointerDownOutside,N=>{const G=N.detail.originalEvent,r=G.button===0&&G.ctrlKey===!0;(G.button===2||r)&&N.preventDefault()}),onFocusOutside:pn(m.onFocusOutside,N=>N.preventDefault())})}),IN=ne.forwardRef((m,b)=>{const E=Nu(Rm,m.__scopeDialog),C=ne.useRef(!1),L=ne.useRef(!1);return H.jsx(jA,{...m,ref:b,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:N=>{var G,r;(G=m.onCloseAutoFocus)==null||G.call(m,N),N.defaultPrevented||(C.current||(r=E.triggerRef.current)==null||r.focus(),N.preventDefault()),C.current=!1,L.current=!1},onInteractOutside:N=>{var Z,$;(Z=m.onInteractOutside)==null||Z.call(m,N),N.defaultPrevented||(C.current=!0,N.detail.originalEvent.type==="pointerdown"&&(L.current=!0));const G=N.target;(($=E.triggerRef.current)==null?void 0:$.contains(G))&&N.preventDefault(),N.detail.originalEvent.type==="focusin"&&L.current&&N.preventDefault()}})}),jA=ne.forwardRef((m,b)=>{const{__scopeDialog:E,trapFocus:C,onOpenAutoFocus:L,onCloseAutoFocus:N,...G}=m,r=Nu(Rm,E),Z=ne.useRef(null),$=Xr(b,Z);return m1(),H.jsxs(H.Fragment,{children:[H.jsx(P0,{asChild:!0,loop:!0,trapped:C,onMountAutoFocus:L,onUnmountAutoFocus:N,children:H.jsx(z0,{role:"dialog",id:r.contentId,"aria-describedby":r.descriptionId,"aria-labelledby":r.titleId,"data-state":R1(r.open),...G,ref:$,onDismiss:()=>r.onOpenChange(!1)})}),H.jsxs(H.Fragment,{children:[H.jsx(zN,{titleId:r.titleId}),H.jsx(LN,{contentRef:Z,descriptionId:r.descriptionId})]})]})}),C1="DialogTitle",UA=ne.forwardRef((m,b)=>{const{__scopeDialog:E,...C}=m,L=Nu(C1,E);return H.jsx(ur.h2,{id:L.titleId,...C,ref:b})});UA.displayName=C1;var VA="DialogDescription",GA=ne.forwardRef((m,b)=>{const{__scopeDialog:E,...C}=m,L=Nu(VA,E);return H.jsx(ur.p,{id:L.descriptionId,...C,ref:b})});GA.displayName=VA;var HA="DialogClose",qA=ne.forwardRef((m,b)=>{const{__scopeDialog:E,...C}=m,L=Nu(HA,E);return H.jsx(ur.button,{type:"button",...C,ref:b,onClick:pn(m.onClick,()=>L.onOpenChange(!1))})});qA.displayName=HA;function R1(m){return m?"open":"closed"}var $A="DialogTitleWarning",[DN,ZA]=pL($A,{contentName:Rm,titleName:C1,docsSlug:"dialog"}),zN=({titleId:m})=>{const b=ZA($A),E=`\`${b.contentName}\` requires a \`${b.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${b.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${b.docsSlug}`;return ne.useEffect(()=>{m&&(document.getElementById(m)||console.error(E))},[E,m]),null},PN="DialogDescriptionWarning",LN=({contentRef:m,descriptionId:b})=>{const C=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${ZA(PN).contentName}}.`;return ne.useEffect(()=>{var N;const L=(N=m.current)==null?void 0:N.getAttribute("aria-describedby");b&&L&&(document.getElementById(b)||console.warn(C))},[C,m,b]),null},XA=PA,WA=OA,YA=NA,KA=BA,QA=FA,ON=UA,kN=GA,I1=qA;function NN({...m}){return H.jsx(XA,{"data-slot":"sheet",...m})}function BN({...m}){return H.jsx(WA,{"data-slot":"sheet-trigger",...m})}function FN({...m}){return H.jsx(YA,{"data-slot":"sheet-portal",...m})}function jN({className:m,...b}){return H.jsx(KA,{"data-slot":"sheet-overlay",className:Sr("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",m),...b})}function UN({className:m,children:b,side:E="right",...C}){return H.jsxs(FN,{children:[H.jsx(jN,{}),H.jsxs(QA,{"data-slot":"sheet-content",className:Sr("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",E==="right"&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",E==="left"&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",E==="top"&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",E==="bottom"&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",m),...C,children:[b,H.jsxs(I1,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[H.jsx(g0,{className:"size-4"}),H.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function qg(){const m=ip(),[b,E]=ne.useState(!1);ne.useEffect(()=>{const L=()=>{E(window.scrollY>10)};return window.addEventListener("scroll",L),()=>window.removeEventListener("scroll",L)},[]);const C=L=>m.pathname===`/ProfileMap/${L}`;return H.jsx("header",{className:`sticky top-0 z-50 w-full transition-all duration-200 ${b?"bg-white/80 dark:bg-gray-950/80 backdrop-blur-md shadow-sm":"bg-white dark:bg-gray-950"}`,children:H.jsxs("div",{className:"container flex h-16 items-center justify-between px-4",children:[H.jsxs("div",{className:"flex items-center gap-2",children:[H.jsxs(NN,{children:[H.jsx(BN,{asChild:!0,children:H.jsxs(ba,{variant:"ghost",size:"icon",className:"md:hidden",children:[H.jsx(j3,{className:"h-5 w-5"}),H.jsx("span",{className:"sr-only",children:"Toggle menu"})]})}),H.jsx(UN,{side:"left",children:H.jsxs("div",{className:"flex flex-col gap-6 mt-8 pl-4",children:[H.jsxs(Gd,{to:"/ProfileMap/",className:"flex items-center gap-2 text-lg font-semibold",children:[H.jsx(z3,{className:"h-5 w-5"}),"Home"]}),H.jsxs(Gd,{to:"/ProfileMap/profiles",className:"flex items-center gap-2 text-lg font-semibold",children:[H.jsx(Zg,{className:"h-5 w-5"}),"Profiles"]}),H.jsxs(Gd,{to:"/ProfileMap/admin",className:"flex items-center gap-2 text-lg font-semibold",children:[H.jsx(yE,{className:"h-5 w-5"}),"Admin"]})]})})]}),H.jsxs(Gd,{to:"/ProfileMap/",className:"flex items-center gap-2",children:[H.jsxs("div",{className:"relative",children:[H.jsx(Lu,{className:"h-6 w-6 text-emerald-600 dark:text-emerald-400"}),H.jsx("div",{className:"absolute -top-1 -right-1",children:H.jsx(Zg,{className:"h-3 w-3 text-teal-700 dark:text-teal-300"})})]}),H.jsxs("span",{className:"font-bold text-xl hidden sm:inline-block",children:["Profile",H.jsx("span",{className:"text-emerald-600 dark:text-emerald-400",children:"Map"})]})]})]}),H.jsxs("nav",{className:"hidden md:flex items-center gap-6",children:[H.jsx(Gd,{to:"/ProfileMap/",className:`text-sm font-medium transition-colors hover:text-emerald-600 dark:hover:text-emerald-400 ${C("/ProfileMap/")?"text-emerald-600 dark:text-emerald-400":"text-gray-600 dark:text-gray-300"}`,children:"Home"}),H.jsx(Gd,{to:"/ProfileMap/profiles",className:`text-sm font-medium transition-colors hover:text-emerald-600 dark:hover:text-emerald-400 ${C("/ProfileMap/profiles")||m.pathname.startsWith("/ProfileMap/profiles")?"text-emerald-600 dark:text-emerald-400":"text-gray-600 dark:text-gray-300"}`,children:"Profiles"}),H.jsx(Gd,{to:"/ProfileMap/admin",className:`text-sm font-medium transition-colors hover:text-emerald-600 dark:hover:text-emerald-400 ${C("/ProfileMap/admin")?"text-emerald-600 dark:text-emerald-400":"text-gray-600 dark:text-gray-300"}`,children:"Admin"})]}),H.jsx("div",{className:"flex items-center gap-2",children:H.jsx(bN,{})})]})})}var Tb="rovingFocusGroup.onEntryFocus",VN={bubbles:!1,cancelable:!0},Oy="RovingFocusGroup",[Zb,JA,GN]=p1(Oy),[HN,q0]=Wd(Oy,[GN]),[qN,$N]=HN(Oy),eM=ne.forwardRef((m,b)=>H.jsx(Zb.Provider,{scope:m.__scopeRovingFocusGroup,children:H.jsx(Zb.Slot,{scope:m.__scopeRovingFocusGroup,children:H.jsx(ZN,{...m,ref:b})})}));eM.displayName=Oy;var ZN=ne.forwardRef((m,b)=>{const{__scopeRovingFocusGroup:E,orientation:C,loop:L=!1,dir:N,currentTabStopId:G,defaultCurrentTabStopId:r,onCurrentTabStopIdChange:Z,onEntryFocus:$,preventScrollOnEntryFocus:ie=!1,...oe}=m,fe=ne.useRef(null),Re=Xr(b,fe),Ie=D0(N),[be,ke]=Wg({prop:G,defaultProp:r??null,onChange:Z,caller:Oy}),[Oe,Be]=ne.useState(!1),je=Ih($),at=JA(E),ut=ne.useRef(!1),[Xe,Tt]=ne.useState(0);return ne.useEffect(()=>{const vt=fe.current;if(vt)return vt.addEventListener(Tb,je),()=>vt.removeEventListener(Tb,je)},[je]),H.jsx(qN,{scope:E,orientation:C,dir:Ie,loop:L,currentTabStopId:be,onItemFocus:ne.useCallback(vt=>ke(vt),[ke]),onItemShiftTab:ne.useCallback(()=>Be(!0),[]),onFocusableItemAdd:ne.useCallback(()=>Tt(vt=>vt+1),[]),onFocusableItemRemove:ne.useCallback(()=>Tt(vt=>vt-1),[]),children:H.jsx(ur.div,{tabIndex:Oe||Xe===0?-1:0,"data-orientation":C,...oe,ref:Re,style:{outline:"none",...m.style},onMouseDown:pn(m.onMouseDown,()=>{ut.current=!0}),onFocus:pn(m.onFocus,vt=>{const ni=!ut.current;if(vt.target===vt.currentTarget&&ni&&!Oe){const Pi=new CustomEvent(Tb,VN);if(vt.currentTarget.dispatchEvent(Pi),!Pi.defaultPrevented){const xi=at().filter(Je=>Je.focusable),Fi=xi.find(Je=>Je.active),Ei=xi.find(Je=>Je.id===be),yi=[Fi,Ei,...xi].filter(Boolean).map(Je=>Je.ref.current);nM(yi,ie)}}ut.current=!1}),onBlur:pn(m.onBlur,()=>Be(!1))})})}),tM="RovingFocusGroupItem",iM=ne.forwardRef((m,b)=>{const{__scopeRovingFocusGroup:E,focusable:C=!0,active:L=!1,tabStopId:N,children:G,...r}=m,Z=Ch(),$=N||Z,ie=$N(tM,E),oe=ie.currentTabStopId===$,fe=JA(E),{onFocusableItemAdd:Re,onFocusableItemRemove:Ie,currentTabStopId:be}=ie;return ne.useEffect(()=>{if(C)return Re(),()=>Ie()},[C,Re,Ie]),H.jsx(Zb.ItemSlot,{scope:E,id:$,focusable:C,active:L,children:H.jsx(ur.span,{tabIndex:oe?0:-1,"data-orientation":ie.orientation,...r,ref:b,onMouseDown:pn(m.onMouseDown,ke=>{C?ie.onItemFocus($):ke.preventDefault()}),onFocus:pn(m.onFocus,()=>ie.onItemFocus($)),onKeyDown:pn(m.onKeyDown,ke=>{if(ke.key==="Tab"&&ke.shiftKey){ie.onItemShiftTab();return}if(ke.target!==ke.currentTarget)return;const Oe=YN(ke,ie.orientation,ie.dir);if(Oe!==void 0){if(ke.metaKey||ke.ctrlKey||ke.altKey||ke.shiftKey)return;ke.preventDefault();let je=fe().filter(at=>at.focusable).map(at=>at.ref.current);if(Oe==="last")je.reverse();else if(Oe==="prev"||Oe==="next"){Oe==="prev"&&je.reverse();const at=je.indexOf(ke.currentTarget);je=ie.loop?KN(je,at+1):je.slice(at+1)}setTimeout(()=>nM(je))}}),children:typeof G=="function"?G({isCurrentTabStop:oe,hasTabStop:be!=null}):G})})});iM.displayName=tM;var XN={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function WN(m,b){return b!=="rtl"?m:m==="ArrowLeft"?"ArrowRight":m==="ArrowRight"?"ArrowLeft":m}function YN(m,b,E){const C=WN(m.key,E);if(!(b==="vertical"&&["ArrowLeft","ArrowRight"].includes(C))&&!(b==="horizontal"&&["ArrowUp","ArrowDown"].includes(C)))return XN[C]}function nM(m,b=!1){const E=document.activeElement;for(const C of m)if(C===E||(C.focus({preventScroll:b}),document.activeElement!==E))return}function KN(m,b){return m.map((E,C)=>m[(b+C)%m.length])}var rM=eM,aM=iM,$0="Tabs",[QN,vF]=Wd($0,[q0]),oM=q0(),[JN,D1]=QN($0),sM=ne.forwardRef((m,b)=>{const{__scopeTabs:E,value:C,onValueChange:L,defaultValue:N,orientation:G="horizontal",dir:r,activationMode:Z="automatic",...$}=m,ie=D0(r),[oe,fe]=Wg({prop:C,onChange:L,defaultProp:N??"",caller:$0});return H.jsx(JN,{scope:E,baseId:Ch(),value:oe,onValueChange:fe,orientation:G,dir:ie,activationMode:Z,children:H.jsx(ur.div,{dir:ie,"data-orientation":G,...$,ref:b})})});sM.displayName=$0;var lM="TabsList",cM=ne.forwardRef((m,b)=>{const{__scopeTabs:E,loop:C=!0,...L}=m,N=D1(lM,E),G=oM(E);return H.jsx(rM,{asChild:!0,...G,orientation:N.orientation,dir:N.dir,loop:C,children:H.jsx(ur.div,{role:"tablist","aria-orientation":N.orientation,...L,ref:b})})});cM.displayName=lM;var uM="TabsTrigger",hM=ne.forwardRef((m,b)=>{const{__scopeTabs:E,value:C,disabled:L=!1,...N}=m,G=D1(uM,E),r=oM(E),Z=pM(G.baseId,C),$=mM(G.baseId,C),ie=C===G.value;return H.jsx(aM,{asChild:!0,...r,focusable:!L,active:ie,children:H.jsx(ur.button,{type:"button",role:"tab","aria-selected":ie,"aria-controls":$,"data-state":ie?"active":"inactive","data-disabled":L?"":void 0,disabled:L,id:Z,...N,ref:b,onMouseDown:pn(m.onMouseDown,oe=>{!L&&oe.button===0&&oe.ctrlKey===!1?G.onValueChange(C):oe.preventDefault()}),onKeyDown:pn(m.onKeyDown,oe=>{[" ","Enter"].includes(oe.key)&&G.onValueChange(C)}),onFocus:pn(m.onFocus,()=>{const oe=G.activationMode!=="manual";!ie&&!L&&oe&&G.onValueChange(C)})})})});hM.displayName=uM;var dM="TabsContent",fM=ne.forwardRef((m,b)=>{const{__scopeTabs:E,value:C,forceMount:L,children:N,...G}=m,r=D1(dM,E),Z=pM(r.baseId,C),$=mM(r.baseId,C),ie=C===r.value,oe=ne.useRef(ie);return ne.useEffect(()=>{const fe=requestAnimationFrame(()=>oe.current=!1);return()=>cancelAnimationFrame(fe)},[]),H.jsx(Yd,{present:L||ie,children:({present:fe})=>H.jsx(ur.div,{"data-state":ie?"active":"inactive","data-orientation":r.orientation,role:"tabpanel","aria-labelledby":Z,hidden:!fe,id:$,tabIndex:0,...G,ref:b,style:{...m.style,animationDuration:oe.current?"0s":void 0},children:fe&&N})})});fM.displayName=dM;function pM(m,b){return`${m}-trigger-${b}`}function mM(m,b){return`${m}-content-${b}`}var eB=sM,tB=cM,iB=hM,nB=fM;function Z0({className:m,...b}){return H.jsx(eB,{"data-slot":"tabs",className:Sr("flex flex-col gap-2",m),...b})}function X0({className:m,...b}){return H.jsx(tB,{"data-slot":"tabs-list",className:Sr("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",m),...b})}function Jf({className:m,...b}){return H.jsx(iB,{"data-slot":"tabs-trigger",className:Sr("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",m),...b})}function ep({className:m,...b}){return H.jsx(nB,{"data-slot":"tabs-content",className:Sr("flex-1 outline-none",m),...b})}function rB(){const m=Ry(),{profiles:b,loading:E,error:C}=s1(),[L,N]=ne.useState([]),[G,r]=ne.useState(null),[Z,$]=ne.useState("grid"),[ie,oe]=ne.useState("profiles");ne.useEffect(()=>{b&&N(b)},[b]);const fe=(Ie,be)=>{if(!b)return;let ke=[...b];if(Ie){const Oe=Ie.toLowerCase();ke=ke.filter(Be=>Be.name.toLowerCase().includes(Oe)||Be.location.city.toLowerCase().includes(Oe)||Be.location.country.toLowerCase().includes(Oe))}be.country&&be.country!=="all"&&(ke=ke.filter(Oe=>Oe.location.country===be.country)),N(ke)},Re=Ie=>{r(Ie),oe("map")};return C?H.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-red-50 dark:bg-red-950 p-4",children:[H.jsx("div",{className:"text-red-600 dark:text-red-400 text-xl font-semibold mb-4",children:"Error loading profiles"}),H.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:C}),H.jsx(ba,{onClick:()=>window.location.reload(),children:"Try Again"})]}):H.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50 dark:bg-gray-950",children:[H.jsx(qg,{}),H.jsx("main",{className:"flex-1 container mx-auto px-4 py-6",children:E?H.jsxs("div",{className:"flex flex-col items-center justify-center h-[70vh]",children:[H.jsx(Py,{className:"h-12 w-12 text-emerald-600 dark:text-emerald-400 animate-spin mb-4"}),H.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Loading profiles..."})]}):H.jsxs(H.Fragment,{children:[H.jsx("div",{className:"mb-6 animate-fadeIn",children:H.jsx(xN,{onSearch:fe,profiles:b||[]})}),H.jsxs(Z0,{defaultValue:"profiles",value:ie,onValueChange:oe,className:"w-full animate-fadeIn",children:[H.jsxs("div",{className:"flex justify-between items-center mb-4",children:[H.jsxs(X0,{children:[H.jsxs(Jf,{value:"profiles",className:"flex items-center gap-2 cursor-pointer",children:[H.jsx($2,{className:"h-4 w-4"}),"Profiles"]}),H.jsxs(Jf,{value:"map",className:"flex items-center gap-2 cursor-pointer",children:[H.jsx(Lu,{className:"h-4 w-4"}),"Map View"]})]}),ie==="profiles"&&H.jsxs("div",{className:"flex gap-2",children:[H.jsxs(ba,{variant:Z==="grid"?"default":"outline",size:"sm",onClick:()=>$("grid"),className:"h-9 px-2.5 cursor-pointer",children:[H.jsx($2,{className:"h-4 w-4"}),H.jsx("span",{className:"sr-only",children:"Grid View"})]}),H.jsxs(ba,{variant:Z==="list"?"default":"outline",size:"sm",onClick:()=>$("list"),className:"h-9 px-2.5 cursor-pointer",children:[H.jsx(L3,{className:"h-4 w-4"}),H.jsx("span",{className:"sr-only",children:"List View"})]})]})]}),H.jsx(ep,{value:"profiles",className:"mt-0",children:H.jsx(cL,{profiles:L,viewMode:Z,onProfileSelect:Re,onProfileClick:Ie=>m(`/ProfileMap/profiles/${Ie.id}`)})}),H.jsx(ep,{value:"map",className:"mt-0",children:H.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden h-[70vh]",children:H.jsx(bE,{profiles:L,selectedProfile:G,onProfileSelect:Ie=>m(`/ProfileMap/profiles/${Ie.id}`)})})})]})]})})]})}function aB(){const m=Ry();return ne.useEffect(()=>{const b=setTimeout(()=>{m("/ProfileMap/profiles")},2500);return()=>clearTimeout(b)},[m]),H.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-teal-50 to-emerald-100 dark:from-teal-950 dark:to-emerald-900",children:[H.jsxs("div",{className:"text-center space-y-6 animate-fadeIn",children:[H.jsx("div",{className:"flex items-center justify-center mb-6",children:H.jsxs("div",{className:"relative",children:[H.jsx(Lu,{className:"h-16 w-16 text-emerald-600 dark:text-emerald-400 animate-pulse"}),H.jsx("div",{className:"absolute -top-2 -right-2",children:H.jsx(Zg,{className:"h-8 w-8 text-teal-700 dark:text-teal-300"})})]})}),H.jsxs("h1",{className:"text-4xl font-bold tracking-tight text-teal-800 dark:text-teal-200 sm:text-5xl md:text-6xl",children:["Profile",H.jsx("span",{className:"text-emerald-600 dark:text-emerald-400",children:"Map"})]}),H.jsx("p",{className:"max-w-md mx-auto text-lg text-teal-700 dark:text-teal-300",children:"Explore profiles and their locations interactively"}),H.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mt-8 justify-center",children:[H.jsxs(ba,{size:"lg",className:"bg-emerald-600 hover:bg-emerald-700 text-white cursor-pointer",onClick:()=>m("/ProfileMap/profiles"),children:[H.jsx(Zg,{className:"mr-2 h-5 w-5"}),"Browse Profiles"]}),H.jsxs(ba,{size:"lg",variant:"outline",className:"border-emerald-600 text-emerald-700 hover:bg-emerald-100 dark:border-emerald-500 dark:text-emerald-400 dark:hover:bg-emerald-950 cursor-pointer",onClick:()=>m("/ProfileMap/admin"),children:[H.jsx(yE,{className:"mr-2 h-5 w-5"}),"Admin Panel"]})]})]}),H.jsx("div",{className:"absolute bottom-8 animate-bounce",children:H.jsx(Lu,{className:"h-8 w-8 text-emerald-500 dark:text-emerald-400"})})]})}function oB({className:m,...b}){return H.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:H.jsx("table",{"data-slot":"table",className:Sr("w-full caption-bottom text-sm",m),...b})})}function sB({className:m,...b}){return H.jsx("thead",{"data-slot":"table-header",className:Sr("[&_tr]:border-b",m),...b})}function lB({className:m,...b}){return H.jsx("tbody",{"data-slot":"table-body",className:Sr("[&_tr:last-child]:border-0",m),...b})}function Sb({className:m,...b}){return H.jsx("tr",{"data-slot":"table-row",className:Sr("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",m),...b})}function Fg({className:m,...b}){return H.jsx("th",{"data-slot":"table-head",className:Sr("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",m),...b})}function xm({className:m,...b}){return H.jsx("td",{"data-slot":"table-cell",className:Sr("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",m),...b})}var Xb=["Enter"," "],cB=["ArrowDown","PageUp","Home"],gM=["ArrowUp","PageDown","End"],uB=[...cB,...gM],hB={ltr:[...Xb,"ArrowRight"],rtl:[...Xb,"ArrowLeft"]},dB={ltr:["ArrowLeft"],rtl:["ArrowRight"]},ky="Menu",[Ey,fB,pB]=p1(ky),[Dm,_M]=Wd(ky,[pB,N0,q0]),W0=N0(),yM=q0(),[mB,zm]=Dm(ky),[gB,Ny]=Dm(ky),vM=m=>{const{__scopeMenu:b,open:E=!1,children:C,dir:L,onOpenChange:N,modal:G=!0}=m,r=W0(b),[Z,$]=ne.useState(null),ie=ne.useRef(!1),oe=Ih(N),fe=D0(L);return ne.useEffect(()=>{const Re=()=>{ie.current=!0,document.addEventListener("pointerdown",Ie,{capture:!0,once:!0}),document.addEventListener("pointermove",Ie,{capture:!0,once:!0})},Ie=()=>ie.current=!1;return document.addEventListener("keydown",Re,{capture:!0}),()=>{document.removeEventListener("keydown",Re,{capture:!0}),document.removeEventListener("pointerdown",Ie,{capture:!0}),document.removeEventListener("pointermove",Ie,{capture:!0})}},[]),H.jsx($E,{...r,children:H.jsx(mB,{scope:b,open:E,onOpenChange:oe,content:Z,onContentChange:$,children:H.jsx(gB,{scope:b,onClose:ne.useCallback(()=>oe(!1),[oe]),isUsingKeyboardRef:ie,dir:fe,modal:G,children:C})})})};vM.displayName=ky;var _B="MenuAnchor",z1=ne.forwardRef((m,b)=>{const{__scopeMenu:E,...C}=m,L=W0(E);return H.jsx(ZE,{...L,...C,ref:b})});z1.displayName=_B;var P1="MenuPortal",[yB,xM]=Dm(P1,{forceMount:void 0}),bM=m=>{const{__scopeMenu:b,forceMount:E,children:C,container:L}=m,N=zm(P1,b);return H.jsx(yB,{scope:b,forceMount:E,children:H.jsx(Yd,{present:E||N.open,children:H.jsx(B0,{asChild:!0,container:L,children:C})})})};bM.displayName=P1;var Dc="MenuContent",[vB,L1]=Dm(Dc),wM=ne.forwardRef((m,b)=>{const E=xM(Dc,m.__scopeMenu),{forceMount:C=E.forceMount,...L}=m,N=zm(Dc,m.__scopeMenu),G=Ny(Dc,m.__scopeMenu);return H.jsx(Ey.Provider,{scope:m.__scopeMenu,children:H.jsx(Yd,{present:C||N.open,children:H.jsx(Ey.Slot,{scope:m.__scopeMenu,children:G.modal?H.jsx(xB,{...L,ref:b}):H.jsx(bB,{...L,ref:b})})})})}),xB=ne.forwardRef((m,b)=>{const E=zm(Dc,m.__scopeMenu),C=ne.useRef(null),L=Xr(b,C);return ne.useEffect(()=>{const N=C.current;if(N)return E1(N)},[]),H.jsx(O1,{...m,ref:L,trapFocus:E.open,disableOutsidePointerEvents:E.open,disableOutsideScroll:!0,onFocusOutside:pn(m.onFocusOutside,N=>N.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>E.onOpenChange(!1)})}),bB=ne.forwardRef((m,b)=>{const E=zm(Dc,m.__scopeMenu);return H.jsx(O1,{...m,ref:b,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>E.onOpenChange(!1)})}),wB=Em("MenuContent.ScrollLock"),O1=ne.forwardRef((m,b)=>{const{__scopeMenu:E,loop:C=!1,trapFocus:L,onOpenAutoFocus:N,onCloseAutoFocus:G,disableOutsidePointerEvents:r,onEntryFocus:Z,onEscapeKeyDown:$,onPointerDownOutside:ie,onFocusOutside:oe,onInteractOutside:fe,onDismiss:Re,disableOutsideScroll:Ie,...be}=m,ke=zm(Dc,E),Oe=Ny(Dc,E),Be=W0(E),je=yM(E),at=fB(E),[ut,Xe]=ne.useState(null),Tt=ne.useRef(null),vt=Xr(b,Tt,ke.onContentChange),ni=ne.useRef(0),Pi=ne.useRef(""),xi=ne.useRef(0),Fi=ne.useRef(null),Ei=ne.useRef("right"),fi=ne.useRef(0),yi=Ie?j0:ne.Fragment,Je=Ie?{as:wB,allowPinchZoom:!0}:void 0,jt=$t=>{var ri,Yi;const Fe=Pi.current+$t,zt=at().filter(Vi=>!Vi.disabled),_i=document.activeElement,Jt=(ri=zt.find(Vi=>Vi.ref.current===_i))==null?void 0:ri.textValue,bi=zt.map(Vi=>Vi.textValue),Ci=LB(bi,Fe,Jt),pi=(Yi=zt.find(Vi=>Vi.textValue===Ci))==null?void 0:Yi.ref.current;(function Vi(rn){Pi.current=rn,window.clearTimeout(ni.current),rn!==""&&(ni.current=window.setTimeout(()=>Vi(""),1e3))})(Fe),pi&&setTimeout(()=>pi.focus())};ne.useEffect(()=>()=>window.clearTimeout(ni.current),[]),m1();const _t=ne.useCallback($t=>{var zt,_i;return Ei.current===((zt=Fi.current)==null?void 0:zt.side)&&kB($t,(_i=Fi.current)==null?void 0:_i.area)},[]);return H.jsx(vB,{scope:E,searchRef:Pi,onItemEnter:ne.useCallback($t=>{_t($t)&&$t.preventDefault()},[_t]),onItemLeave:ne.useCallback($t=>{var Fe;_t($t)||((Fe=Tt.current)==null||Fe.focus(),Xe(null))},[_t]),onTriggerLeave:ne.useCallback($t=>{_t($t)&&$t.preventDefault()},[_t]),pointerGraceTimerRef:xi,onPointerGraceIntentChange:ne.useCallback($t=>{Fi.current=$t},[]),children:H.jsx(yi,{...Je,children:H.jsx(P0,{asChild:!0,trapped:L,onMountAutoFocus:pn(N,$t=>{var Fe;$t.preventDefault(),(Fe=Tt.current)==null||Fe.focus({preventScroll:!0})}),onUnmountAutoFocus:G,children:H.jsx(z0,{asChild:!0,disableOutsidePointerEvents:r,onEscapeKeyDown:$,onPointerDownOutside:ie,onFocusOutside:oe,onInteractOutside:fe,onDismiss:Re,children:H.jsx(rM,{asChild:!0,...je,dir:Oe.dir,orientation:"vertical",loop:C,currentTabStopId:ut,onCurrentTabStopIdChange:Xe,onEntryFocus:pn(Z,$t=>{Oe.isUsingKeyboardRef.current||$t.preventDefault()}),preventScrollOnEntryFocus:!0,children:H.jsx(XE,{role:"menu","aria-orientation":"vertical","data-state":BM(ke.open),"data-radix-menu-content":"",dir:Oe.dir,...Be,...be,ref:vt,style:{outline:"none",...be.style},onKeyDown:pn(be.onKeyDown,$t=>{const zt=$t.target.closest("[data-radix-menu-content]")===$t.currentTarget,_i=$t.ctrlKey||$t.altKey||$t.metaKey,Jt=$t.key.length===1;zt&&($t.key==="Tab"&&$t.preventDefault(),!_i&&Jt&&jt($t.key));const bi=Tt.current;if($t.target!==bi||!uB.includes($t.key))return;$t.preventDefault();const pi=at().filter(ri=>!ri.disabled).map(ri=>ri.ref.current);gM.includes($t.key)&&pi.reverse(),zB(pi)}),onBlur:pn(m.onBlur,$t=>{$t.currentTarget.contains($t.target)||(window.clearTimeout(ni.current),Pi.current="")}),onPointerMove:pn(m.onPointerMove,Ay($t=>{const Fe=$t.target,zt=fi.current!==$t.clientX;if($t.currentTarget.contains(Fe)&&zt){const _i=$t.clientX>fi.current?"right":"left";Ei.current=_i,fi.current=$t.clientX}}))})})})})})})});wM.displayName=Dc;var TB="MenuGroup",k1=ne.forwardRef((m,b)=>{const{__scopeMenu:E,...C}=m;return H.jsx(ur.div,{role:"group",...C,ref:b})});k1.displayName=TB;var SB="MenuLabel",TM=ne.forwardRef((m,b)=>{const{__scopeMenu:E,...C}=m;return H.jsx(ur.div,{...C,ref:b})});TM.displayName=SB;var S0="MenuItem",yS="menu.itemSelect",Y0=ne.forwardRef((m,b)=>{const{disabled:E=!1,onSelect:C,...L}=m,N=ne.useRef(null),G=Ny(S0,m.__scopeMenu),r=L1(S0,m.__scopeMenu),Z=Xr(b,N),$=ne.useRef(!1),ie=()=>{const oe=N.current;if(!E&&oe){const fe=new CustomEvent(yS,{bubbles:!0,cancelable:!0});oe.addEventListener(yS,Re=>C==null?void 0:C(Re),{once:!0}),wE(oe,fe),fe.defaultPrevented?$.current=!1:G.onClose()}};return H.jsx(SM,{...L,ref:Z,disabled:E,onClick:pn(m.onClick,ie),onPointerDown:oe=>{var fe;(fe=m.onPointerDown)==null||fe.call(m,oe),$.current=!0},onPointerUp:pn(m.onPointerUp,oe=>{var fe;$.current||(fe=oe.currentTarget)==null||fe.click()}),onKeyDown:pn(m.onKeyDown,oe=>{const fe=r.searchRef.current!=="";E||fe&&oe.key===" "||Xb.includes(oe.key)&&(oe.currentTarget.click(),oe.preventDefault())})})});Y0.displayName=S0;var SM=ne.forwardRef((m,b)=>{const{__scopeMenu:E,disabled:C=!1,textValue:L,...N}=m,G=L1(S0,E),r=yM(E),Z=ne.useRef(null),$=Xr(b,Z),[ie,oe]=ne.useState(!1),[fe,Re]=ne.useState("");return ne.useEffect(()=>{const Ie=Z.current;Ie&&Re((Ie.textContent??"").trim())},[N.children]),H.jsx(Ey.ItemSlot,{scope:E,disabled:C,textValue:L??fe,children:H.jsx(aM,{asChild:!0,...r,focusable:!C,children:H.jsx(ur.div,{role:"menuitem","data-highlighted":ie?"":void 0,"aria-disabled":C||void 0,"data-disabled":C?"":void 0,...N,ref:$,onPointerMove:pn(m.onPointerMove,Ay(Ie=>{C?G.onItemLeave(Ie):(G.onItemEnter(Ie),Ie.defaultPrevented||Ie.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:pn(m.onPointerLeave,Ay(Ie=>G.onItemLeave(Ie))),onFocus:pn(m.onFocus,()=>oe(!0)),onBlur:pn(m.onBlur,()=>oe(!1))})})})}),EB="MenuCheckboxItem",EM=ne.forwardRef((m,b)=>{const{checked:E=!1,onCheckedChange:C,...L}=m;return H.jsx(IM,{scope:m.__scopeMenu,checked:E,children:H.jsx(Y0,{role:"menuitemcheckbox","aria-checked":E0(E)?"mixed":E,...L,ref:b,"data-state":B1(E),onSelect:pn(L.onSelect,()=>C==null?void 0:C(E0(E)?!0:!E),{checkForDefaultPrevented:!1})})})});EM.displayName=EB;var AM="MenuRadioGroup",[AB,MB]=Dm(AM,{value:void 0,onValueChange:()=>{}}),MM=ne.forwardRef((m,b)=>{const{value:E,onValueChange:C,...L}=m,N=Ih(C);return H.jsx(AB,{scope:m.__scopeMenu,value:E,onValueChange:N,children:H.jsx(k1,{...L,ref:b})})});MM.displayName=AM;var CM="MenuRadioItem",RM=ne.forwardRef((m,b)=>{const{value:E,...C}=m,L=MB(CM,m.__scopeMenu),N=E===L.value;return H.jsx(IM,{scope:m.__scopeMenu,checked:N,children:H.jsx(Y0,{role:"menuitemradio","aria-checked":N,...C,ref:b,"data-state":B1(N),onSelect:pn(C.onSelect,()=>{var G;return(G=L.onValueChange)==null?void 0:G.call(L,E)},{checkForDefaultPrevented:!1})})})});RM.displayName=CM;var N1="MenuItemIndicator",[IM,CB]=Dm(N1,{checked:!1}),DM=ne.forwardRef((m,b)=>{const{__scopeMenu:E,forceMount:C,...L}=m,N=CB(N1,E);return H.jsx(Yd,{present:C||E0(N.checked)||N.checked===!0,children:H.jsx(ur.span,{...L,ref:b,"data-state":B1(N.checked)})})});DM.displayName=N1;var RB="MenuSeparator",zM=ne.forwardRef((m,b)=>{const{__scopeMenu:E,...C}=m;return H.jsx(ur.div,{role:"separator","aria-orientation":"horizontal",...C,ref:b})});zM.displayName=RB;var IB="MenuArrow",PM=ne.forwardRef((m,b)=>{const{__scopeMenu:E,...C}=m,L=W0(E);return H.jsx(WE,{...L,...C,ref:b})});PM.displayName=IB;var DB="MenuSub",[xF,LM]=Dm(DB),yy="MenuSubTrigger",OM=ne.forwardRef((m,b)=>{const E=zm(yy,m.__scopeMenu),C=Ny(yy,m.__scopeMenu),L=LM(yy,m.__scopeMenu),N=L1(yy,m.__scopeMenu),G=ne.useRef(null),{pointerGraceTimerRef:r,onPointerGraceIntentChange:Z}=N,$={__scopeMenu:m.__scopeMenu},ie=ne.useCallback(()=>{G.current&&window.clearTimeout(G.current),G.current=null},[]);return ne.useEffect(()=>ie,[ie]),ne.useEffect(()=>{const oe=r.current;return()=>{window.clearTimeout(oe),Z(null)}},[r,Z]),H.jsx(z1,{asChild:!0,...$,children:H.jsx(SM,{id:L.triggerId,"aria-haspopup":"menu","aria-expanded":E.open,"aria-controls":L.contentId,"data-state":BM(E.open),...m,ref:c1(b,L.onTriggerChange),onClick:oe=>{var fe;(fe=m.onClick)==null||fe.call(m,oe),!(m.disabled||oe.defaultPrevented)&&(oe.currentTarget.focus(),E.open||E.onOpenChange(!0))},onPointerMove:pn(m.onPointerMove,Ay(oe=>{N.onItemEnter(oe),!oe.defaultPrevented&&!m.disabled&&!E.open&&!G.current&&(N.onPointerGraceIntentChange(null),G.current=window.setTimeout(()=>{E.onOpenChange(!0),ie()},100))})),onPointerLeave:pn(m.onPointerLeave,Ay(oe=>{var Re,Ie;ie();const fe=(Re=E.content)==null?void 0:Re.getBoundingClientRect();if(fe){const be=(Ie=E.content)==null?void 0:Ie.dataset.side,ke=be==="right",Oe=ke?-5:5,Be=fe[ke?"left":"right"],je=fe[ke?"right":"left"];N.onPointerGraceIntentChange({area:[{x:oe.clientX+Oe,y:oe.clientY},{x:Be,y:fe.top},{x:je,y:fe.top},{x:je,y:fe.bottom},{x:Be,y:fe.bottom}],side:be}),window.clearTimeout(r.current),r.current=window.setTimeout(()=>N.onPointerGraceIntentChange(null),300)}else{if(N.onTriggerLeave(oe),oe.defaultPrevented)return;N.onPointerGraceIntentChange(null)}})),onKeyDown:pn(m.onKeyDown,oe=>{var Re;const fe=N.searchRef.current!=="";m.disabled||fe&&oe.key===" "||hB[C.dir].includes(oe.key)&&(E.onOpenChange(!0),(Re=E.content)==null||Re.focus(),oe.preventDefault())})})})});OM.displayName=yy;var kM="MenuSubContent",NM=ne.forwardRef((m,b)=>{const E=xM(Dc,m.__scopeMenu),{forceMount:C=E.forceMount,...L}=m,N=zm(Dc,m.__scopeMenu),G=Ny(Dc,m.__scopeMenu),r=LM(kM,m.__scopeMenu),Z=ne.useRef(null),$=Xr(b,Z);return H.jsx(Ey.Provider,{scope:m.__scopeMenu,children:H.jsx(Yd,{present:C||N.open,children:H.jsx(Ey.Slot,{scope:m.__scopeMenu,children:H.jsx(O1,{id:r.contentId,"aria-labelledby":r.triggerId,...L,ref:$,align:"start",side:G.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:ie=>{var oe;G.isUsingKeyboardRef.current&&((oe=Z.current)==null||oe.focus()),ie.preventDefault()},onCloseAutoFocus:ie=>ie.preventDefault(),onFocusOutside:pn(m.onFocusOutside,ie=>{ie.target!==r.trigger&&N.onOpenChange(!1)}),onEscapeKeyDown:pn(m.onEscapeKeyDown,ie=>{G.onClose(),ie.preventDefault()}),onKeyDown:pn(m.onKeyDown,ie=>{var Re;const oe=ie.currentTarget.contains(ie.target),fe=dB[G.dir].includes(ie.key);oe&&fe&&(N.onOpenChange(!1),(Re=r.trigger)==null||Re.focus(),ie.preventDefault())})})})})})});NM.displayName=kM;function BM(m){return m?"open":"closed"}function E0(m){return m==="indeterminate"}function B1(m){return E0(m)?"indeterminate":m?"checked":"unchecked"}function zB(m){const b=document.activeElement;for(const E of m)if(E===b||(E.focus(),document.activeElement!==b))return}function PB(m,b){return m.map((E,C)=>m[(b+C)%m.length])}function LB(m,b,E){const L=b.length>1&&Array.from(b).every($=>$===b[0])?b[0]:b,N=E?m.indexOf(E):-1;let G=PB(m,Math.max(N,0));L.length===1&&(G=G.filter($=>$!==E));const Z=G.find($=>$.toLowerCase().startsWith(L.toLowerCase()));return Z!==E?Z:void 0}function OB(m,b){const{x:E,y:C}=m;let L=!1;for(let N=0,G=b.length-1;N<b.length;G=N++){const r=b[N],Z=b[G],$=r.x,ie=r.y,oe=Z.x,fe=Z.y;ie>C!=fe>C&&E<(oe-$)*(C-ie)/(fe-ie)+$&&(L=!L)}return L}function kB(m,b){if(!b)return!1;const E={x:m.clientX,y:m.clientY};return OB(E,b)}function Ay(m){return b=>b.pointerType==="mouse"?m(b):void 0}var NB=vM,BB=z1,FB=bM,jB=wM,UB=k1,VB=TM,GB=Y0,HB=EM,qB=MM,$B=RM,ZB=DM,XB=zM,WB=PM,YB=OM,KB=NM,K0="DropdownMenu",[QB,bF]=Wd(K0,[_M]),Ks=_M(),[JB,FM]=QB(K0),jM=m=>{const{__scopeDropdownMenu:b,children:E,dir:C,open:L,defaultOpen:N,onOpenChange:G,modal:r=!0}=m,Z=Ks(b),$=ne.useRef(null),[ie,oe]=Wg({prop:L,defaultProp:N??!1,onChange:G,caller:K0});return H.jsx(JB,{scope:b,triggerId:Ch(),triggerRef:$,contentId:Ch(),open:ie,onOpenChange:oe,onOpenToggle:ne.useCallback(()=>oe(fe=>!fe),[oe]),modal:r,children:H.jsx(NB,{...Z,open:ie,onOpenChange:oe,dir:C,modal:r,children:E})})};jM.displayName=K0;var UM="DropdownMenuTrigger",VM=ne.forwardRef((m,b)=>{const{__scopeDropdownMenu:E,disabled:C=!1,...L}=m,N=FM(UM,E),G=Ks(E);return H.jsx(BB,{asChild:!0,...G,children:H.jsx(ur.button,{type:"button",id:N.triggerId,"aria-haspopup":"menu","aria-expanded":N.open,"aria-controls":N.open?N.contentId:void 0,"data-state":N.open?"open":"closed","data-disabled":C?"":void 0,disabled:C,...L,ref:c1(b,N.triggerRef),onPointerDown:pn(m.onPointerDown,r=>{!C&&r.button===0&&r.ctrlKey===!1&&(N.onOpenToggle(),N.open||r.preventDefault())}),onKeyDown:pn(m.onKeyDown,r=>{C||(["Enter"," "].includes(r.key)&&N.onOpenToggle(),r.key==="ArrowDown"&&N.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(r.key)&&r.preventDefault())})})})});VM.displayName=UM;var e4="DropdownMenuPortal",GM=m=>{const{__scopeDropdownMenu:b,...E}=m,C=Ks(b);return H.jsx(FB,{...C,...E})};GM.displayName=e4;var HM="DropdownMenuContent",qM=ne.forwardRef((m,b)=>{const{__scopeDropdownMenu:E,...C}=m,L=FM(HM,E),N=Ks(E),G=ne.useRef(!1);return H.jsx(jB,{id:L.contentId,"aria-labelledby":L.triggerId,...N,...C,ref:b,onCloseAutoFocus:pn(m.onCloseAutoFocus,r=>{var Z;G.current||(Z=L.triggerRef.current)==null||Z.focus(),G.current=!1,r.preventDefault()}),onInteractOutside:pn(m.onInteractOutside,r=>{const Z=r.detail.originalEvent,$=Z.button===0&&Z.ctrlKey===!0,ie=Z.button===2||$;(!L.modal||ie)&&(G.current=!0)}),style:{...m.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});qM.displayName=HM;var t4="DropdownMenuGroup",i4=ne.forwardRef((m,b)=>{const{__scopeDropdownMenu:E,...C}=m,L=Ks(E);return H.jsx(UB,{...L,...C,ref:b})});i4.displayName=t4;var n4="DropdownMenuLabel",r4=ne.forwardRef((m,b)=>{const{__scopeDropdownMenu:E,...C}=m,L=Ks(E);return H.jsx(VB,{...L,...C,ref:b})});r4.displayName=n4;var a4="DropdownMenuItem",$M=ne.forwardRef((m,b)=>{const{__scopeDropdownMenu:E,...C}=m,L=Ks(E);return H.jsx(GB,{...L,...C,ref:b})});$M.displayName=a4;var o4="DropdownMenuCheckboxItem",s4=ne.forwardRef((m,b)=>{const{__scopeDropdownMenu:E,...C}=m,L=Ks(E);return H.jsx(HB,{...L,...C,ref:b})});s4.displayName=o4;var l4="DropdownMenuRadioGroup",c4=ne.forwardRef((m,b)=>{const{__scopeDropdownMenu:E,...C}=m,L=Ks(E);return H.jsx(qB,{...L,...C,ref:b})});c4.displayName=l4;var u4="DropdownMenuRadioItem",h4=ne.forwardRef((m,b)=>{const{__scopeDropdownMenu:E,...C}=m,L=Ks(E);return H.jsx($B,{...L,...C,ref:b})});h4.displayName=u4;var d4="DropdownMenuItemIndicator",f4=ne.forwardRef((m,b)=>{const{__scopeDropdownMenu:E,...C}=m,L=Ks(E);return H.jsx(ZB,{...L,...C,ref:b})});f4.displayName=d4;var p4="DropdownMenuSeparator",m4=ne.forwardRef((m,b)=>{const{__scopeDropdownMenu:E,...C}=m,L=Ks(E);return H.jsx(XB,{...L,...C,ref:b})});m4.displayName=p4;var g4="DropdownMenuArrow",_4=ne.forwardRef((m,b)=>{const{__scopeDropdownMenu:E,...C}=m,L=Ks(E);return H.jsx(WB,{...L,...C,ref:b})});_4.displayName=g4;var y4="DropdownMenuSubTrigger",v4=ne.forwardRef((m,b)=>{const{__scopeDropdownMenu:E,...C}=m,L=Ks(E);return H.jsx(YB,{...L,...C,ref:b})});v4.displayName=y4;var x4="DropdownMenuSubContent",b4=ne.forwardRef((m,b)=>{const{__scopeDropdownMenu:E,...C}=m,L=Ks(E);return H.jsx(KB,{...L,...C,ref:b,style:{...m.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});b4.displayName=x4;var w4=jM,T4=VM,S4=GM,E4=qM,A4=$M;function M4({...m}){return H.jsx(w4,{"data-slot":"dropdown-menu",...m})}function C4({...m}){return H.jsx(T4,{"data-slot":"dropdown-menu-trigger",...m})}function R4({className:m,sideOffset:b=4,...E}){return H.jsx(S4,{children:H.jsx(E4,{"data-slot":"dropdown-menu-content",sideOffset:b,className:Sr("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",m),...E})})}function vS({className:m,inset:b,variant:E="default",...C}){return H.jsx(A4,{"data-slot":"dropdown-menu-item","data-inset":b,"data-variant":E,className:Sr("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",m),...C})}var ZM="AlertDialog",[I4,wF]=Wd(ZM,[zA]),Kd=zA(),XM=m=>{const{__scopeAlertDialog:b,...E}=m,C=Kd(b);return H.jsx(XA,{...C,...E,modal:!0})};XM.displayName=ZM;var D4="AlertDialogTrigger",z4=ne.forwardRef((m,b)=>{const{__scopeAlertDialog:E,...C}=m,L=Kd(E);return H.jsx(WA,{...L,...C,ref:b})});z4.displayName=D4;var P4="AlertDialogPortal",WM=m=>{const{__scopeAlertDialog:b,...E}=m,C=Kd(b);return H.jsx(YA,{...C,...E})};WM.displayName=P4;var L4="AlertDialogOverlay",YM=ne.forwardRef((m,b)=>{const{__scopeAlertDialog:E,...C}=m,L=Kd(E);return H.jsx(KA,{...L,...C,ref:b})});YM.displayName=L4;var $g="AlertDialogContent",[O4,k4]=I4($g),N4=s3("AlertDialogContent"),KM=ne.forwardRef((m,b)=>{const{__scopeAlertDialog:E,children:C,...L}=m,N=Kd(E),G=ne.useRef(null),r=Xr(b,G),Z=ne.useRef(null);return H.jsx(DN,{contentName:$g,titleName:QM,docsSlug:"alert-dialog",children:H.jsx(O4,{scope:E,cancelRef:Z,children:H.jsxs(QA,{role:"alertdialog",...N,...L,ref:r,onOpenAutoFocus:pn(L.onOpenAutoFocus,$=>{var ie;$.preventDefault(),(ie=Z.current)==null||ie.focus({preventScroll:!0})}),onPointerDownOutside:$=>$.preventDefault(),onInteractOutside:$=>$.preventDefault(),children:[H.jsx(N4,{children:C}),H.jsx(F4,{contentRef:G})]})})})});KM.displayName=$g;var QM="AlertDialogTitle",JM=ne.forwardRef((m,b)=>{const{__scopeAlertDialog:E,...C}=m,L=Kd(E);return H.jsx(ON,{...L,...C,ref:b})});JM.displayName=QM;var eC="AlertDialogDescription",tC=ne.forwardRef((m,b)=>{const{__scopeAlertDialog:E,...C}=m,L=Kd(E);return H.jsx(kN,{...L,...C,ref:b})});tC.displayName=eC;var B4="AlertDialogAction",iC=ne.forwardRef((m,b)=>{const{__scopeAlertDialog:E,...C}=m,L=Kd(E);return H.jsx(I1,{...L,...C,ref:b})});iC.displayName=B4;var nC="AlertDialogCancel",rC=ne.forwardRef((m,b)=>{const{__scopeAlertDialog:E,...C}=m,{cancelRef:L}=k4(nC,E),N=Kd(E),G=Xr(b,L);return H.jsx(I1,{...N,...C,ref:G})});rC.displayName=nC;var F4=({contentRef:m})=>{const b=`\`${$g}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${$g}\` by passing a \`${eC}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${$g}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return ne.useEffect(()=>{var C;document.getElementById((C=m.current)==null?void 0:C.getAttribute("aria-describedby"))||console.warn(b)},[b,m]),null},j4=XM,U4=WM,V4=YM,G4=KM,H4=iC,q4=rC,$4=JM,Z4=tC;function X4({...m}){return H.jsx(j4,{"data-slot":"alert-dialog",...m})}function W4({...m}){return H.jsx(U4,{"data-slot":"alert-dialog-portal",...m})}function Y4({className:m,...b}){return H.jsx(V4,{"data-slot":"alert-dialog-overlay",className:Sr("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",m),...b})}function K4({className:m,...b}){return H.jsxs(W4,{children:[H.jsx(Y4,{}),H.jsx(G4,{"data-slot":"alert-dialog-content",className:Sr("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",m),...b})]})}function Q4({className:m,...b}){return H.jsx("div",{"data-slot":"alert-dialog-header",className:Sr("flex flex-col gap-2 text-center sm:text-left",m),...b})}function J4({className:m,...b}){return H.jsx("div",{"data-slot":"alert-dialog-footer",className:Sr("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",m),...b})}function eF({className:m,...b}){return H.jsx($4,{"data-slot":"alert-dialog-title",className:Sr("text-lg font-semibold",m),...b})}function tF({className:m,...b}){return H.jsx(Z4,{"data-slot":"alert-dialog-description",className:Sr("text-muted-foreground text-sm",m),...b})}function iF({className:m,...b}){return H.jsx(H4,{className:Sr(u1(),m),...b})}function nF({className:m,...b}){return H.jsx(q4,{className:Sr(u1({variant:"outline"}),m),...b})}function rF({profiles:m,onEdit:b,onDelete:E}){const[C,L]=ne.useState(null),[N,G]=ne.useState(""),r=m.filter(oe=>oe.name.toLowerCase().includes(N.toLowerCase())||oe.email.toLowerCase().includes(N.toLowerCase())||oe.location.city.toLowerCase().includes(N.toLowerCase())||oe.location.country.toLowerCase().includes(N.toLowerCase())),Z=oe=>{L(oe)},$=()=>{C&&(E(C),L(null))},ie=()=>{L(null)};return H.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden",children:[H.jsx("div",{className:"p-4 border-b dark:border-gray-700",children:H.jsxs("div",{className:"relative",children:[H.jsx(kb,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),H.jsx("input",{type:"text",placeholder:"Search profiles...",value:N,onChange:oe=>G(oe.target.value),className:"w-full pl-9 py-2 pr-4 rounded-md border border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 focus:border-transparent"})]})}),H.jsx("div",{className:"overflow-x-auto",children:H.jsxs(oB,{children:[H.jsx(sB,{children:H.jsxs(Sb,{children:[H.jsx(Fg,{className:"w-[50px]",children:"Avatar"}),H.jsx(Fg,{children:"Name"}),H.jsx(Fg,{children:"Email"}),H.jsx(Fg,{children:"Location"}),H.jsx(Fg,{children:"Occupation"}),H.jsx(Fg,{className:"text-right",children:"Actions"})]})}),H.jsx(lB,{children:r.length===0?H.jsx(Sb,{children:H.jsx(xm,{colSpan:6,className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No profiles found"})}):r.map(oe=>H.jsxs(Sb,{children:[H.jsx(xm,{children:H.jsx("div",{className:"relative h-10 w-10 rounded-full overflow-hidden",children:H.jsx("img",{src:oe.avatar||_0,alt:oe.name,className:"object-cover h-10 w-10 rounded-full"})})}),H.jsx(xm,{className:"font-medium",children:oe.name}),H.jsx(xm,{children:oe.email}),H.jsx(xm,{children:H.jsxs("div",{className:"flex items-center",children:[H.jsx(Lu,{className:"h-3.5 w-3.5 mr-1 text-emerald-600 dark:text-emerald-400"}),H.jsxs("span",{children:[oe.location.city,", ",oe.location.country]})]})}),H.jsx(xm,{children:oe.occupation}),H.jsx(xm,{className:"text-right",children:H.jsxs(M4,{children:[H.jsx(C4,{asChild:!0,children:H.jsxs(ba,{className:"cursor-pointer",variant:"ghost",size:"icon",children:[H.jsx(M3,{className:"h-4 w-4"}),H.jsx("span",{className:"sr-only",children:"Open menu"})]})}),H.jsxs(R4,{align:"end",children:[H.jsxs(vS,{onClick:()=>b(oe),className:"cursor-pointer",children:[H.jsx(H3,{className:"h-4 w-4 mr-2"}),"Edit"]}),H.jsxs(vS,{onClick:()=>Z(oe.id),className:"text-red-600 dark:text-red-400 focus:text-red-700 dark:focus:text-red-300 cursor-pointer",children:[H.jsx(iL,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]},oe.id))})]})}),H.jsx(X4,{open:C!==null,onOpenChange:()=>L(null),children:H.jsxs(K4,{children:[H.jsxs(Q4,{children:[H.jsx(eF,{children:"Are you sure?"}),H.jsx(tF,{children:"This action cannot be undone. This will permanently delete the profile and remove the data from the server."})]}),H.jsxs(J4,{children:[H.jsx(nF,{onClick:ie,children:"Cancel"}),H.jsx(iF,{onClick:$,className:"bg-red-600 hover:bg-red-700 text-white",children:"Delete"})]})]})})]})}function aF({className:m,...b}){return H.jsx("textarea",{"data-slot":"textarea",className:Sr("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",m),...b})}var oF="Label",aC=ne.forwardRef((m,b)=>H.jsx(ur.label,{...m,ref:b,onMouseDown:E=>{var L;E.target.closest("button, input, select, textarea")||((L=m.onMouseDown)==null||L.call(m,E),!E.defaultPrevented&&E.detail>1&&E.preventDefault())}}));aC.displayName=oF;var sF=aC;function Ws({className:m,...b}){return H.jsx(sF,{"data-slot":"label",className:Sr("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",m),...b})}function lF({profile:m,onSubmit:b,onCancel:E}){const[C,L]=ne.useState({id:"",name:"",email:"",phone:"",occupation:"",bio:"",avatar:"/a1.jpg",joinedDate:new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),interests:[],location:{street:"",city:"",state:"",postalCode:"",country:"",coordinates:{lat:0,lng:0}}}),[N,G]=ne.useState(""),[r,Z]=ne.useState(!1),[$,ie]=ne.useState("basic");ne.useEffect(()=>{L(m||{id:tE(),name:"",email:"",phone:"",occupation:"",bio:"",avatar:"",joinedDate:new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),interests:[],location:{street:"",city:"",state:"",postalCode:"",country:"",coordinates:{lat:0,lng:0}}})},[m]);const oe=Be=>{const{name:je,value:at}=Be.target;if(je.includes(".")){const[ut,Xe]=je.split(".");L(Tt=>({...Tt,[ut]:{...Tt[ut],[Xe]:at}}))}else L(ut=>({...ut,[je]:at}))},fe=Be=>{const{name:je,value:at}=Be.target,ut=Number.parseFloat(at)||0;L(Xe=>({...Xe,location:{...Xe.location,coordinates:{...Xe.location.coordinates,[je]:ut}}}))},Re=()=>{N.trim()&&!C.interests.includes(N.trim())&&(L(Be=>({...Be,interests:[...Be.interests,N.trim()]})),G(""))},Ie=Be=>{L(je=>({...je,interests:je.interests.filter(at=>at!==Be)}))},be=Be=>{Be.key==="Enter"&&(Be.preventDefault(),Re())},ke=async Be=>{Be.preventDefault(),Z(!0);try{await new Promise(je=>setTimeout(je,800)),b(C)}catch(je){console.error("Error submitting form:",je)}finally{Z(!1)}},Oe=()=>C.name.trim()!==""&&C.email.trim()!==""&&C.phone.trim()!==""&&C.bio.trim()!==""&&C.location.city.trim()!==""&&C.location.country.trim()!==""&&C.location.coordinates.lat!==0&&C.location.coordinates.lng!==0;return H.jsx(Tm,{className:"animate-fadeIn",children:H.jsx(vy,{className:"p-6",children:H.jsx("form",{onSubmit:ke,children:H.jsxs(Z0,{value:$,onValueChange:ie,children:[H.jsxs(X0,{className:"grid w-full grid-cols-2 mb-6",children:[H.jsxs(Jf,{value:"basic",className:"flex items-center gap-2 cursor-pointer",children:[H.jsx(vE,{className:"h-4 w-4"}),"Basic Information"]}),H.jsxs(Jf,{value:"location",className:"flex items-center gap-2 cursor-pointer",children:[H.jsx(Lu,{className:"h-4 w-4"}),"Location Details"]})]}),H.jsxs(ep,{value:"basic",className:"space-y-6",children:[H.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[H.jsxs("div",{className:"space-y-2",children:[H.jsxs(Ws,{htmlFor:"name",children:["Full Name ",H.jsx("span",{className:"text-red-500",children:"*"})]}),H.jsx(dl,{id:"name",name:"name",value:C.name,onChange:oe,placeholder:"John Doe",required:!0})]}),H.jsxs("div",{className:"space-y-2",children:[H.jsx(Ws,{htmlFor:"avatar",children:"Avatar URL"}),H.jsx(dl,{id:"avatar",name:"avatar",value:C.avatar,onChange:oe,placeholder:"Use online url or use: /ProfileMap/assets/image_name.jpg"})]}),H.jsxs("div",{className:"space-y-2",children:[H.jsxs(Ws,{htmlFor:"email",children:["Email Address ",H.jsx("span",{className:"text-red-500",children:"*"})]}),H.jsxs("div",{className:"flex items-center",children:[H.jsx(d1,{className:"h-4 w-4 mr-2 text-gray-400"}),H.jsx(dl,{id:"email",name:"email",type:"email",value:C.email,onChange:oe,placeholder:"john.doe@example.com",required:!0})]})]}),H.jsxs("div",{className:"space-y-2",children:[H.jsxs(Ws,{htmlFor:"phone",children:["Phone Number ",H.jsx("span",{className:"text-red-500",children:"*"})]}),H.jsxs("div",{className:"flex items-center",children:[H.jsx(f1,{className:"h-4 w-4 mr-2 text-gray-400"}),H.jsx(dl,{id:"phone",name:"phone",value:C.phone,onChange:oe,placeholder:"+1 (555) 123-4567",required:!0})]})]}),H.jsxs("div",{className:"space-y-2",children:[H.jsxs(Ws,{htmlFor:"occupation",children:["Occupation ",H.jsx("span",{className:"text-red-500",children:"*"})]}),H.jsxs("div",{className:"flex items-center",children:[H.jsx(h1,{className:"h-4 w-4 mr-2 text-gray-400"}),H.jsx(dl,{id:"occupation",name:"occupation",value:C.occupation,onChange:oe,placeholder:"Software Engineer",required:!0})]})]}),H.jsxs("div",{className:"space-y-2",children:[H.jsx(Ws,{htmlFor:"interests",children:"Interests"}),H.jsxs("div",{className:"flex items-center",children:[H.jsx(eL,{className:"h-4 w-4 mr-2 text-gray-400"}),H.jsxs("div",{className:"flex-1 flex",children:[H.jsx(dl,{id:"interests",value:N,onChange:Be=>G(Be.target.value),onKeyDown:be,placeholder:"Add an interest",className:"rounded-r-none"}),H.jsx(ba,{type:"button",onClick:Re,className:"rounded-l-none cursor-pointer",children:H.jsx(_E,{className:"h-4 w-4"})})]})]}),H.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[C.interests.map((Be,je)=>H.jsxs(Ug,{variant:"secondary",className:"flex items-center gap-1",children:[Be,H.jsxs("button",{type:"button",onClick:()=>Ie(Be),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:[H.jsx(g0,{className:"h-3 w-3"}),H.jsxs("span",{className:"sr-only",children:["Remove ",Be]})]})]},je)),C.interests.length===0&&H.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No interests added yet"})]})]})]}),H.jsxs("div",{className:"space-y-2",children:[H.jsxs(Ws,{htmlFor:"bio",children:["Bio ",H.jsx("span",{className:"text-red-500",children:"*"})]}),H.jsx(aF,{id:"bio",name:"bio",value:C.bio,onChange:oe,placeholder:"Write a short bio...",rows:4,required:!0})]}),H.jsx("div",{className:"flex justify-end gap-2",children:H.jsx(ba,{type:"button",variant:"outline",className:"cursor-pointer",onClick:()=>ie("location"),children:"Next: Location Details"})})]}),H.jsxs(ep,{value:"location",className:"space-y-6",children:[H.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[H.jsxs("div",{className:"space-y-2",children:[H.jsx(Ws,{htmlFor:"location.street",children:"Street Address"}),H.jsx(dl,{id:"location.street",name:"location.street",value:C.location.street,onChange:oe,placeholder:"123 Main St"})]}),H.jsxs("div",{className:"space-y-2",children:[H.jsxs(Ws,{htmlFor:"location.city",children:["City ",H.jsx("span",{className:"text-red-500",children:"*"})]}),H.jsx(dl,{id:"location.city",name:"location.city",value:C.location.city,onChange:oe,placeholder:"New York",required:!0})]}),H.jsxs("div",{className:"space-y-2",children:[H.jsx(Ws,{htmlFor:"location.state",children:"State/Province"}),H.jsx(dl,{id:"location.state",name:"location.state",value:C.location.state,onChange:oe,placeholder:"NY"})]}),H.jsxs("div",{className:"space-y-2",children:[H.jsx(Ws,{htmlFor:"location.postalCode",children:"Postal Code"}),H.jsx(dl,{id:"location.postalCode",name:"location.postalCode",value:C.location.postalCode,onChange:oe,placeholder:"10001"})]}),H.jsxs("div",{className:"space-y-2",children:[H.jsxs(Ws,{htmlFor:"location.country",children:["Country ",H.jsx("span",{className:"text-red-500",children:"*"})]}),H.jsx(dl,{id:"location.country",name:"location.country",value:C.location.country,onChange:oe,placeholder:"United States",required:!0})]})]}),H.jsxs("div",{className:"space-y-2",children:[H.jsxs(Ws,{children:["Map Coordinates ",H.jsx("span",{className:"text-red-500",children:"*"})]}),H.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"Enter the latitude and longitude coordinates for the map marker"}),H.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[H.jsxs("div",{className:"space-y-2",children:[H.jsx(Ws,{htmlFor:"lat",children:"Latitude"}),H.jsx(dl,{id:"lat",name:"lat",type:"number",step:"any",value:C.location.coordinates.lat||"",onChange:fe,placeholder:"40.7128",required:!0})]}),H.jsxs("div",{className:"space-y-2",children:[H.jsx(Ws,{htmlFor:"lng",children:"Longitude"}),H.jsx(dl,{id:"lng",name:"lng",type:"number",step:"any",value:C.location.coordinates.lng||"",onChange:fe,placeholder:"-74.0060",required:!0})]})]}),H.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:`Tip: You can find coordinates by right-clicking on Google Maps and selecting "What's here?"`})]}),H.jsxs("div",{className:"block md:flex justify-between gap-2 pt-4",children:[H.jsx(ba,{type:"button",variant:"outline",className:"cursor-pointer",onClick:()=>ie("basic"),children:"Back: Basic Information"}),H.jsxs("div",{className:"flex gap-2 mt-3 md:mt-0 justify-between",children:[H.jsx(ba,{type:"button",variant:"outline",className:"cursor-pointer",onClick:E,children:"Cancel"}),H.jsx(ba,{type:"submit",disabled:r||!Oe(),className:"min-w-[100px] cursor-pointer",children:r?H.jsxs(H.Fragment,{children:[H.jsx(Py,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):H.jsxs(H.Fragment,{children:[H.jsx(X3,{className:"h-4 w-4 mr-2 cursor-pointer"}),m?"Update":"Create"]})})]})]})]})]})})})})}function cF(){Ry();const{profiles:m,loading:b,error:E,addProfile:C,updateProfile:L,deleteProfile:N}=s1(),[G,r]=ne.useState(null),[Z,$]=ne.useState("profiles"),ie=Ie=>{C(Ie),$("profiles")},oe=Ie=>{L(Ie),r(null),$("profiles")},fe=Ie=>{r(Ie),$("add-edit")},Re=()=>{r(null),$("profiles")};return E?H.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50 dark:bg-gray-950",children:[H.jsx(qg,{}),H.jsxs("div",{className:"flex-1 container mx-auto px-4 py-8 flex flex-col items-center justify-center",children:[H.jsxs("div",{className:"text-xl font-semibold mb-4 text-red-600 dark:text-red-400",children:["Error: ",E]}),H.jsx(ba,{onClick:()=>window.location.reload(),children:"Try Again"})]})]}):H.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50 dark:bg-gray-950",children:[H.jsx(qg,{}),H.jsxs("main",{className:"flex-1 container mx-auto px-4 py-6",children:[H.jsx("div",{className:"text-center mb-6",children:H.jsx("h1",{className:"text-2xl font-bold text-center text-gray-800 dark:text-gray-200",children:"Admin Dashboard"})}),b?H.jsxs("div",{className:"flex flex-col items-center justify-center h-[60vh]",children:[H.jsx(Py,{className:"h-12 w-12 text-emerald-600 dark:text-emerald-400 animate-spin mb-4"}),H.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Loading profiles..."})]}):H.jsxs(Z0,{value:Z,onValueChange:$,className:"w-full animate-fadeIn",children:[H.jsxs(X0,{className:"grid w-full max-w-md mx-auto grid-cols-2 mb-8",children:[H.jsxs(Jf,{value:"profiles",className:"flex items-center justify-center gap-2 cursor-pointer",children:[H.jsx(Zg,{className:"h-4 w-4"}),"Manage Profiles"]}),H.jsxs(Jf,{value:"add-edit",className:"flex items-center justify-center gap-2 cursor-pointer",children:[H.jsx(rL,{className:"h-4 w-4"}),G?"Edit Profile":"Add Profile"]})]}),H.jsx(ep,{value:"profiles",className:"mt-0",children:m&&m.length>0?H.jsx(rF,{profiles:m,onEdit:fe,onDelete:N}):H.jsxs("div",{className:"text-center py-12 bg-white dark:bg-gray-800 rounded-lg shadow-sm",children:[H.jsx(Zg,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),H.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No profiles yet"}),H.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:"Get started by creating a new profile"}),H.jsxs(ba,{onClick:()=>$("add-edit"),children:[H.jsx(_E,{className:"h-4 w-4 mr-2"}),"Add Profile"]})]})}),H.jsx(ep,{value:"add-edit",className:"mt-0",children:H.jsx(lF,{profile:G,onSubmit:G?oe:ie,onCancel:Re})})]})]})]})}var uF="Separator",xS="horizontal",hF=["horizontal","vertical"],oC=ne.forwardRef((m,b)=>{const{decorative:E,orientation:C=xS,...L}=m,N=dF(C)?C:xS,r=E?{role:"none"}:{"aria-orientation":N==="vertical"?N:void 0,role:"separator"};return H.jsx(ur.div,{"data-orientation":N,...r,...L,ref:b})});oC.displayName=uF;function dF(m){return hF.includes(m)}var fF=oC;function bS({className:m,orientation:b="horizontal",decorative:E=!0,...C}){return H.jsx(fF,{"data-slot":"separator-root",decorative:E,orientation:b,className:Sr("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",m),...C})}function pF(){const m=Ry();C2();const{profiles:b,loading:E,error:C}=s1(),[L,N]=ne.useState(null),{id:G}=C2();return ne.useEffect(()=>{if(b&&G){const r=b.find(Z=>String(Z.id)===G);N(r)}},[b,G]),L?E?H.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50 dark:bg-gray-950",children:[H.jsx(qg,{}),H.jsx("div",{className:"flex-1 flex items-center justify-center",children:H.jsx(Py,{className:"h-12 w-12 text-emerald-600 dark:text-emerald-400 animate-spin"})})]}):C||!L?H.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50 dark:bg-gray-950",children:[H.jsx(qg,{}),H.jsxs("div",{className:"flex-1 container mx-auto px-4 py-8 flex flex-col items-center justify-center",children:[H.jsx("div",{className:"text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200",children:C||"Profile not found"}),H.jsxs(ba,{onClick:()=>m("/ProfileMap/profiles"),children:[H.jsx(q2,{className:"mr-2 h-4 w-4"}),"Back to Profiles"]})]})]}):H.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50 dark:bg-gray-950",children:[H.jsx(qg,{}),H.jsxs("main",{className:"flex-1 container mx-auto px-4 py-6",children:[H.jsxs(ba,{variant:"ghost",className:"mb-6",onClick:()=>m("/ProfileMap/profiles"),children:[H.jsx(q2,{className:"mr-2 h-4 w-4"}),"Back to Profiles"]}),H.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[H.jsx("div",{className:"lg:col-span-1 animate-slide-in-left",children:H.jsxs(Tm,{className:"overflow-hidden",children:[H.jsx("div",{className:"aspect-square relative",children:H.jsx("img",{src:L.avatar||_0,alt:L.name,className:"object-cover w-fit h-full"})}),H.jsxs(vy,{className:"p-6",children:[H.jsx("h1",{className:"text-2xl font-bold mb-2",children:L.name}),H.jsxs("div",{className:"flex items-center text-gray-600 dark:text-gray-400 mb-4",children:[H.jsx(Lu,{className:"h-4 w-4 mr-1"}),H.jsxs("span",{children:[L.location.city,", ",L.location.country]})]}),H.jsx(bS,{className:"my-4"}),H.jsxs("div",{className:"space-y-4",children:[H.jsxs("div",{className:"flex items-start gap-3",children:[H.jsx(d1,{className:"h-5 w-5 text-emerald-600 dark:text-emerald-400 mt-0.5"}),H.jsxs("div",{children:[H.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Email"}),H.jsx("div",{children:L.email})]})]}),H.jsxs("div",{className:"flex items-start gap-3",children:[H.jsx(f1,{className:"h-5 w-5 text-emerald-600 dark:text-emerald-400 mt-0.5"}),H.jsxs("div",{children:[H.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Phone"}),H.jsx("div",{children:L.phone})]})]}),H.jsxs("div",{className:"flex items-start gap-3",children:[H.jsx(h1,{className:"h-5 w-5 text-emerald-600 dark:text-emerald-400 mt-0.5"}),H.jsxs("div",{children:[H.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Occupation"}),H.jsx("div",{children:L.occupation})]})]}),H.jsxs("div",{className:"flex items-start gap-3",children:[H.jsx(x3,{className:"h-5 w-5 text-emerald-600 dark:text-emerald-400 mt-0.5"}),H.jsxs("div",{children:[H.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Joined"}),H.jsx("div",{children:L.joinedDate})]})]})]}),H.jsx(bS,{className:"my-4"}),H.jsx("div",{className:"flex flex-wrap gap-2",children:L.interests.map((r,Z)=>H.jsx(Ug,{variant:"secondary",children:r},Z))})]})]})}),H.jsxs("div",{className:"lg:col-span-2 space-y-6 animate-slide-in-right",children:[H.jsx(Tm,{children:H.jsxs(vy,{className:"p-6",children:[H.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[H.jsx(vE,{className:"h-5 w-5 mr-2 text-emerald-600 dark:text-emerald-400"}),"About"]}),H.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed",children:L.bio})]})}),H.jsxs(Z0,{defaultValue:"map",children:[H.jsxs(X0,{className:"mb-4",children:[H.jsxs(Jf,{value:"map",className:"flex items-center gap-2",children:[H.jsx(Lu,{className:"h-4 w-4"}),"Location"]}),H.jsxs(Jf,{value:"details",className:"flex items-center gap-2",children:[H.jsx(R3,{className:"h-4 w-4"}),"Address Details"]})]}),H.jsx(ep,{value:"map",children:H.jsx(Tm,{children:H.jsx("div",{className:"h-[400px] rounded-lg overflow-hidden",children:H.jsx(bE,{profiles:[L],selectedProfile:L,singleProfileMode:!0})})})}),H.jsx(ep,{value:"details",children:H.jsx(Tm,{children:H.jsx(vy,{className:"p-6",children:H.jsxs("div",{className:"space-y-4",children:[H.jsxs("div",{children:[H.jsx("h3",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Street Address"}),H.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:L.location.street})]}),H.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[H.jsxs("div",{children:[H.jsx("h3",{className:"font-medium text-gray-700 dark:text-gray-300",children:"City"}),H.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:L.location.city})]}),H.jsxs("div",{children:[H.jsx("h3",{className:"font-medium text-gray-700 dark:text-gray-300",children:"State/Province"}),H.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:L.location.state})]})]}),H.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[H.jsxs("div",{children:[H.jsx("h3",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Postal Code"}),H.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:L.location.postalCode})]}),H.jsxs("div",{children:[H.jsx("h3",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Country"}),H.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:L.location.country})]})]}),H.jsxs("div",{children:[H.jsx("h3",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Coordinates"}),H.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:[L.location.coordinates.lat.toFixed(6),", ",L.location.coordinates.lng.toFixed(6)]})]})]})})})})]})]})]})]})]}):H.jsx("div",{className:"text-center p-6",children:"Loading profile..."})}const mF=xz([{path:"/ProfileMap/",element:H.jsx(aB,{})},{path:"/ProfileMap/profiles",element:H.jsx(rB,{})},{path:"/ProfileMap/profiles/:id",element:H.jsx(pF,{})},{path:"/ProfileMap/admin",element:H.jsx(cF,{})}]);function gF(){return H.jsxs(H.Fragment,{children:[H.jsx(Pz,{router:mF}),H.jsx(pP,{})]})}MI.createRoot(document.getElementById("root")).render(H.jsx(ne.StrictMode,{children:H.jsx(gF,{})}));
